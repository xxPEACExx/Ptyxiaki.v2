<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2678796-A2" country="EP" doc-number="2678796" kind="A2" date="20140101" family-id="45922632" file-reference-id="318301" date-produced="20180826" status="corrected" lang="DE"><bibliographic-data><publication-reference fvid="146551273" ucid="EP-2678796-A2"><document-id><country>EP</country><doc-number>2678796</doc-number><kind>A2</kind><date>20140101</date><lang>DE</lang></document-id></publication-reference><application-reference ucid="EP-12711339-A" is-representative="NO"><document-id mxw-id="PAPP154825196" load-source="docdb" format="epo"><country>EP</country><doc-number>12711339</doc-number><kind>A</kind><date>20120222</date><lang>DE</lang></document-id><document-id mxw-id="PAPP186634479" load-source="docdb" format="original"><country>EP</country><doc-number>12711339.7</doc-number><date>20120222</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140454766" ucid="DE-102011012227-A" load-source="docdb"><document-id format="epo"><country>DE</country><doc-number>102011012227</doc-number><kind>A</kind><date>20110224</date></document-id></priority-claim><priority-claim mxw-id="PPC140452924" ucid="EP-2012000763-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>2012000763</doc-number><kind>W</kind><date>20120222</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2090239665" load-source="docdb">G06F  21/36        20130101AFI20150226BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2090240047" load-source="docdb">G06F  21/42        20130101ALI20150226BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2090241613" load-source="docdb">G06F  21/53        20130101ALI20150226BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2090243156" load-source="docdb">G06F  21/60        20130101ALI20150226BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2090244394" load-source="docdb">G06F  21/74        20130101ALI20150226BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2090246108" load-source="docdb">G06F  21/71        20130101ALI20150226BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1991311278" load-source="docdb" scheme="CPC">G06F  21/74        20130101 LI20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991312277" load-source="docdb" scheme="CPC">G06F  21/71        20130101 LI20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991313135" load-source="docdb" scheme="CPC">G06F  21/36        20130101 LI20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991314116" load-source="docdb" scheme="CPC">G06F  21/606       20130101 FI20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991314930" load-source="docdb" scheme="CPC">H04W  88/02        20130101 LA20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991316067" load-source="docdb" scheme="CPC">G06F  21/42        20130101 LI20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991317207" load-source="docdb" scheme="CPC">G06F  21/53        20130101 LI20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991318614" load-source="docdb" scheme="CPC">H04L  63/105       20130101 LI20140106BHEP        </classification-cpc><classification-cpc mxw-id="PCL2076395091" load-source="docdb" scheme="CPC">G06F2221/2149      20130101 LA20140519BHEP        </classification-cpc><classification-cpc mxw-id="PCL2076395273" load-source="docdb" scheme="CPC">G06F2221/2105      20130101 LA20140519BHEP        </classification-cpc><classification-cpc mxw-id="PCL2076398404" load-source="docdb" scheme="CPC">G06F2221/2141      20130101 LA20140520BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132186303" lang="DE" load-source="patent-office">VERFAHREN ZUM DATENAUSTAUSCH IN EINER GESICHERTEN LAUFZEITUMGEBUNG</invention-title><invention-title mxw-id="PT132186304" lang="EN" load-source="patent-office">METHOD FOR INTERCHANGING DATA IN A SECURE RUNTIME ENVIRONMENT</invention-title><invention-title mxw-id="PT132186305" lang="FR" load-source="patent-office">PROCÉDÉ D'ÉCHANGE DE DONNÉES DANS UN ENVIRONNEMENT D'EXÉCUTION SÉCURISÉ</invention-title><citations><non-patent-citations><nplcit><text>See references of WO 2012113545A2</text><sources><source mxw-id="PNPL67451921" load-source="docdb" name="SEA"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918140254" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>TRUSTONIC LTD</last-name><address><country>GB</country></address></addressbook></applicant><applicant mxw-id="PPAR918149215" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>TRUSTONIC LIMITED</last-name></addressbook></applicant><applicant mxw-id="PPAR918980077" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Trustonic Limited</last-name><iid>101400656</iid><address><street>20 Station Road</street><city>Cambridge CB1 2JD</city><country>GB</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918163731" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SPITZ STEPHAN</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918146432" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SPITZ, STEPHAN</last-name></addressbook></inventor><inventor mxw-id="PPAR918983074" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SPITZ, STEPHAN</last-name><address><street>Parkstrasse 18</street><city>85757 Karlsfeld</city><country>DE</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918983298" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Robinson, Nigel Alexander Julian</last-name><iid>100032844</iid><address><street>D Young &amp; Co LLP 120 Holborn</street><city>London EC1N 2DY</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="EP-2012000763-W"><document-id><country>EP</country><doc-number>2012000763</doc-number><kind>W</kind><date>20120222</date><lang>DE</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012113545-A2"><document-id><country>WO</country><doc-number>2012113545</doc-number><kind>A2</kind><date>20120830</date><lang>DE</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548930509" load-source="docdb">AL</country><country mxw-id="DS548913943" load-source="docdb">AT</country><country mxw-id="DS548865646" load-source="docdb">BE</country><country mxw-id="DS548837082" load-source="docdb">BG</country><country mxw-id="DS548927014" load-source="docdb">CH</country><country mxw-id="DS548865647" load-source="docdb">CY</country><country mxw-id="DS548929300" load-source="docdb">CZ</country><country mxw-id="DS548930582" load-source="docdb">DE</country><country mxw-id="DS548865648" load-source="docdb">DK</country><country mxw-id="DS548865649" load-source="docdb">EE</country><country mxw-id="DS548934653" load-source="docdb">ES</country><country mxw-id="DS548837083" load-source="docdb">FI</country><country mxw-id="DS548837084" load-source="docdb">FR</country><country mxw-id="DS548930583" load-source="docdb">GB</country><country mxw-id="DS548865650" load-source="docdb">GR</country><country mxw-id="DS548930584" load-source="docdb">HR</country><country mxw-id="DS548929301" load-source="docdb">HU</country><country mxw-id="DS548927015" load-source="docdb">IE</country><country mxw-id="DS548865651" load-source="docdb">IS</country><country mxw-id="DS548837085" load-source="docdb">IT</country><country mxw-id="DS548865652" load-source="docdb">LI</country><country mxw-id="DS548837086" load-source="docdb">LT</country><country mxw-id="DS548913944" load-source="docdb">LU</country><country mxw-id="DS548837087" load-source="docdb">LV</country><country mxw-id="DS548837088" load-source="docdb">MC</country><country mxw-id="DS548913945" load-source="docdb">MK</country><country mxw-id="DS548913946" load-source="docdb">MT</country><country mxw-id="DS548913947" load-source="docdb">NL</country><country mxw-id="DS548927016" load-source="docdb">NO</country><country mxw-id="DS548913948" load-source="docdb">PL</country><country mxw-id="DS548934654" load-source="docdb">PT</country><country mxw-id="DS548816076" load-source="docdb">RO</country><country mxw-id="DS548934655" load-source="docdb">RS</country><country mxw-id="DS548913949" load-source="docdb">SE</country><country mxw-id="DS548930585" load-source="docdb">SI</country><country mxw-id="DS548927017" load-source="docdb">SK</country><country mxw-id="DS548927018" load-source="docdb">SM</country><country mxw-id="DS548865653" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA99626159" ref-ucid="WO-2012113545-A2" lang="DE" load-source="patent-office"><p num="0000">Die Erfindung betrifft ein Verfahren zum Datenaustausch zwischen einer gesicherten Laufzeitumgebung (SWd), in welcher eine Anzahl an sicheren Applikationen (TL) ausführbar ist, und einer unsicheren Umgebung (NWd) einer Mikroprozessoreinheit (MP), insbesondere in einem mobilen Endgerät, bei dem die Übertragung von Applikationsdaten (AD) und Steuerdaten (MCP, NQ) über verschiedene Puffer erfolgt.</p></abstract><abstract mxw-id="PA99824678" ref-ucid="WO-2012113545-A2" lang="DE" source="national office" load-source="docdb"><p>Die Erfindung betrifft ein Verfahren zum Datenaustausch zwischen einer gesicherten Laufzeitumgebung (SWd), in welcher eine Anzahl an sicheren Applikationen (TL) ausführbar ist, und einer unsicheren Umgebung (NWd) einer Mikroprozessoreinheit (MP), insbesondere in einem mobilen Endgerät, bei dem die Übertragung von Applikationsdaten (AD) und Steuerdaten (MCP, NQ) über verschiedene Puffer erfolgt.</p></abstract><abstract mxw-id="PA99626160" ref-ucid="WO-2012113545-A2" lang="EN" load-source="patent-office"><p num="0000">The invention relates to a method for interchanging data between a secure runtime environment (SWd), in which a number of secure applications (TL) can be executed, and a non-secure environment (NWd) of a microprocessor unit (MP), in particular in a mobile terminal, in which application data (AD) and control data (MCP, NQ) are transmitted via different buffers.</p></abstract><abstract mxw-id="PA99824679" ref-ucid="WO-2012113545-A2" lang="EN" source="national office" load-source="docdb"><p>The invention relates to a method for interchanging data between a secure runtime environment (SWd), in which a number of secure applications (TL) can be executed, and a non-secure environment (NWd) of a microprocessor unit (MP), in particular in a mobile terminal, in which application data (AD) and control data (MCP, NQ) are transmitted via different buffers.</p></abstract><abstract mxw-id="PA99626161" ref-ucid="WO-2012113545-A2" lang="FR" load-source="patent-office"><p num="0000">La présente invention concerne un procédé d'échange de données entre un environnement d'exécution sécurisé (SWd), dans lequel un certain nombre d'applications (TL) sécurisées peuvent être mises en oeuvre, et un environnement non sécurisé (NWd) d'une unité de microprocesseur (MP), notamment dans un terminal mobile, procédé selon lequel le transfert de données d'application (AD) et de données de commande (MCP, NQ) est réalisé par l'intermédiaire de différentes mémoires tampon.</p></abstract><abstract mxw-id="PA99824680" ref-ucid="WO-2012113545-A2" lang="FR" source="national office" load-source="docdb"><p>La présente invention concerne un procédé d'échange de données entre un environnement d'exécution sécurisé (SWd), dans lequel un certain nombre d'applications (TL) sécurisées peuvent être mises en oeuvre, et un environnement non sécurisé (NWd) d'une unité de microprocesseur (MP), notamment dans un terminal mobile, procédé selon lequel le transfert de données d'application (AD) et de données de commande (MCP, NQ) est réalisé par l'intermédiaire de différentes mémoires tampon.</p></abstract><description mxw-id="PDES50931528" ref-ucid="WO-2012113545-A2" lang="DE" load-source="patent-office"><!-- EPO <DP n="3"/>--><p id="p0001" num="0001"> V e r f a hr e n z u m D a te na u s t a u s c h i n e i n e r g e s i c h e r te n L a u f z e i t u m ge b u n g </p><p id="p0002" num="0002">Die Erfindung betrifft ein Verfahren zum Datenaustausch zwischen einer gesicherten Lauf zeitumgebung, in welcher eine Anzahl an sicheren Applikationen ausführbar ist, und einer unsicheren Umgebung einer Mikroprozessoreinheit, insbesondere in einem mobilen Endgerät. Gesicherte Lauf Zeitumgebungen sind aus dem Stand der Technik bekannt und ermöglichen eine gegen Angriffe geschützte Ausführung von Programmen mit einer Mikroprozessoreinheit. Unter Mikroprozessoreinheit ist dabei die Gesamtheit der zur Programmausführung verwendeten Hardware zu verstehen, insbesondere der eigentliche Mikroprozessor sowie entsprechen- de flüchtige und nicht-flüchtige Speicher, welche bei der Programmausführung zur Ablage von Daten verwendet werden. </p><p id="p0003" num="0003">Um den Sicherheitsanforderungen, den Speicherbeschränkungen und Kommunikationsmechanismen von Mikroprozessoreinheiten mit gesicherten Laufzeitumgebungen gerecht zu werden, ist es erforderlich, eine Multitasking-Eigenschaft zu optimieren. </p><p id="p0004" num="0004">Es ist Aufgabe der vorliegenden Erfindung, ein Verfahren zum Datenaustausch zwischen einer gesicherten Laufzeitumgebung und einer unsicheren Umgebung einer Mikroprozessoreinheit anzugeben, welches eine verbesserte Multitasking-Eigenschaft ermöglicht. Eine weitere Aufgabe der Erfindung besteht darin, eine Mikroprozessoreinheit anzugeben, welche verbesserte Multitasking-Eigenschaften aufweist. Diese Aufgaben werden gelöst durch ein Verfahren gemäß den Merkmalen des Patentanspruches 1 sowie eine Mikroprozessoreinheit gemäß den Merk- 
<!-- EPO <DP n="4"/>-->
 malen des Patentanspruches 13. Vorteilhafte Ausgestaltungen der Erfindung sind in den abhängigen Patentansprüchen angegeben. </p><p id="p0005" num="0005">Bei dem erfindungsgemäßen Verfahren von Datenaustausch zwischen einer gesicherten Laufzeitumgebung, in welcher eine Anzahl an sicheren Applikationen ausführbar ist, und einer unsicheren Umgebung einer Mikroprozessoreinheit, insbesondere in einem mobilen Endgerät, erfolgt die Übertragung von Applikationsdaten und Steuerdaten über verschiedene Puffer. Hierdurch wird eine strikte Prozessisolierung ermöglicht, die das sichere Nachladen von Binär-Code ermöglicht. Weiterhin wird ein schnellerer Datenaustausch von Applikationen der unsicheren Umgebung mit Prozessen in der gesicherten Laufzeitumgebung ermöglicht. Es ist bevorzugt, wenn die Steuerdaten unterschiedlicher Art über unterschiedliche Puffer übertragen werden. Ebenso ist es bevorzugt, wenn, die Umschaltung zwischen der gesicherten Laufzeitumgebung und der unsicheren Umgebung betreffende, Kontrolldaten über einen eigenen, sicheren Puffer übertragen werden. Anhand der Kontrolldaten kann ein Wechsel zwi- sehen gesicherter Laufzeitumgebung und unsicherer Umgebung erfolgen. Hierdurch können insbesondere schnelle Kontextwechselzeiten erzielt werden, wodurch sich eine gute Performance bei einem Taskwechsel zwischen Prozessen ergibt. In einer weiteren zweckmäßigen Ausgestaltung basiert die Übertragung der Applikationsdaten und der Steuerdaten sowie optional der Kontrolldaten auf einem ARM-Monitorcode, der in einer Monitor-Einheit implementiert ist, welche Schnittstellen zu der gesicherten Laufzeitumgebung und der unsicheren Umgebung aufweist. 
<!-- EPO <DP n="5"/>-->
 Es ist weiter bevorzugt, wenn die Übertragung der Applikationsdaten und der Steuerdaten zwischen der gesicherten Laufzeitumgebung und einem Treiber der unsicheren Umgebung erfolgt. Zweckmäßigerweise legt ein in der unsicheren Umgebung, insbesondere in einer Schnittstelle des Treibers für die Steuerdaten, implementierter Scheduler fest, welche der sicheren Applikationen in der gesicherten Lauf zeitumgebung zur Ausführung gebracht wird. Es ist weiterhin zweckmäßig, wenn der Datenaustausch unter Nutzung eines, von der gesicherten Laufzeitumgebung und der unsicheren Umgebung les- und/ oder beschreibbaren, Speicherbereichs eines Speichers erfolgt. Der Speicherbereich wird vorzugsweise durch eine Kontrollnachricht initialisiert. Insbesondere ist hierbei vorgesehen, dass die über Steuernachrichten gesi- cherte Laufzeitumgebung über für diese bestimmte Daten in dem Speicherbereich benachrichtigt wird. Dabei werden die Steuerdaten vorzugsweise mit einem eindeutigen Sitzungs-Kennzeichner (Session-ID) versehen, anhand dem die gesicherte Lauf zeitumgebung die Steuernachricht einer der in der gesicherten Laufzeitumgebung ausgeführten Applikation zuordnen kann. </p><p id="p0006" num="0006">In einer weiteren vorteilhaften Ausgestaltung wird jedem in der gesicherten Laufzeitumgebung ablaufenden Prozess eine definierte, nicht überschreitbare Rechenzeit zugewiesen. Diese darf aus Sicherheitsgründen nicht überschritten werden. Hierdurch kann eine strikte Prozessisolierung erzielt wer- den. </p><p id="p0007" num="0007">Gemäß einer weiteren zweckmäßigen Ausgestaltung weist der in der gesicherten Laufzeitumgebung ablaufende Prozess nachfolgende Threadstruktur auf: Kennzeichner (ID) des Threads; aktueller Zustand des Threads; lokaler 
<!-- EPO <DP n="6"/>-->
 Exception Handler der Thread; Priorität des Threads. Vorzugsweise weist ein jeweiliger Prozess nachfolgende Task-Struktur auf: Momentaner Zustand der Task; Task-Kennzeichner der Erzeuger-Task; externer Exception Handler der Task; Rechenzeitkontingent der Task; Anzahl der Threads, die die Task aktivieren oder bereitstellen kann; Priorität und Rechte der Task. Durch die beschriebenen Thread- und/ oder Task-Strukturen müssen bei einem Kontextwechsel keine großen Datenmengen umkopiert werden. Hierdurch lassen sich schnelle Kontextwechselzeiten erzielen. Die Erfindung schafft weiterhin eine Mikroprozessoreinheit mit einer gesicherten Lauf zeitumgebung und einer unsicheren Umgebung, welche derart ausgestaltet ist, dass zum Datenaustausch zwischen der gesicherten Laufzeitumgebung und der unsicheren Umgebung die Übertragung von Applikationsdaten und Steuerdaten über verschiedene Puffer erfolgt. Der Begriff der Mikroprozessoreinheit ist dabei wiederum weit zu verstehen und um- fasst alle für die Ausführung des Datenaustauschs notwendigen Hardware- Komponenten, z.B. einen tragbaren Datenträger und insbesondere eine Chip- Karte. Die Erfindung betrifft darüber hinaus ein mobiles Endgerät, insbesondere ein Mobiltelefon, welches eine entsprechende Mikroprozessoreinheit beinhaltet. </p><p id="p0008" num="0008">Die Erfindung wird nachfolgend näher anhand von Ausführungsbeispielen in der Zeichnung erläutert. Es zeigen: </p><p id="p0009" num="0009">Fig. 1 eine schematische Darstellung des erfindungsgemäßen Verfahrens, 
<!-- EPO <DP n="7"/>-->
 Fig. 2 eine schematische Darstellung der zur Verwirklichung des erfindungsgemäßen Verfahrens notwendigen Komponenten einer Mikroprozessoreinheit, Fig. 3 eine schematische Darstellung, anhand der die Funktionsweise des erfindungsgemäßen Verfahrens erläutert wird, und </p><p id="p0010" num="0010">Fig. 4 eine schematische Darstellung eines Anwendungsbeispiels des erfindungsgemäßen Verfahrens. </p><p id="p0011" num="0011">Anhand von Fig. 1 wird der Datenaustausch zwischen einer gesicherten Lauf zeitumgebung SWd und einer unsicheren Umgebung NWd einer Mikroprozessoreinheit beschrieben, welche in der Form einer sog. ARM-Trust- Zone ausgebildet ist. Die ARM-Trust-Zone stellt eine bekannte Technologie dar, mit der in einer Mikroprozessoreinheit ein geschützter Bereich generiert wird, der als gesicherte Laufzeitumgebung SWd zur Durchführung von als Trustlets bezeichneten Applikationen verwendet wird. Die gesicherte Laufzeitumgebung wird als„Secure World" bezeichnet, die unsichere Umgebung als„Normal World". In der hier beschriebenen Ausführungsform ist die ARM-Trust-Zone in einer Hardware-Plattform, der sog. Trust-Zone- Hardware, eines mobilen Endgerätes, bspw. einem Mobiltelefon, implementiert. Die Laufzeitumgebung stellt dabei eine Software-Schicht zwischen der Applikations- und der Betriebssystem-Schicht der Mikroprozessoreinheit dar. </p><p id="p0012" num="0012">Fig. 1 zeigt schematisch eine solche Mikroprozessoreinheit mit einer gesicherten Laufzeitumgebung SWd mit einer Kommunikationseinheit MCCM, die als sog. MobiCore-Kommunikationsmodul ausgebildet ist. Die Kommunikationseinheit MCCM nutzt dabei das Betriebssystem MC (MobiCore) der 
<!-- EPO <DP n="8"/>-->
 gesicherten Laufzeitumgebung SWd. Ferner dargestellt ist die unsichere Umgebung NWd mit einem Treiber MCD, der als sog. MobiCore-Treiber ausgebildet ist. Als Betriebssystem wird Rieh OS verwendet. Gesicherte Lauf Zeitumgebung SWd und unsichere Umgebung NWd sind in einer sog. Trust-Zone-Hardware TZH verwirklicht. </p><p id="p0013" num="0013">Für den Datenaustausch zwischen gesicherter Laufzeitumgebung SWd und unsicherer Umgebung NWd ist eine Monitoreinheit M vorgesehen. Die Übertragung von Applikationsdaten AD, Steuerdaten MCP (MobiCore Control Protocol Daten), Steuerdaten NQ (Notification Queue) und Kontrolldaten FC (sog. Fast Calls) erfolgt über jeweilige, verschiedene Puffer. Die Übertragung der Applikationsdaten AD, der Steuerdaten MCP und NQ sowie der Kontrolldaten FC basiert auf ARM-Monitorcode, der in der Monitoreinheit M implementiert ist, welche Schnittstellen zu der gesicherten Lauf- zeitumgebung SWd und der unsicheren Umgebung NWd aufweist. </p><p id="p0014" num="0014">Fig. 2 zeigt die zur Verwirklichung des erfindungsgemäßen Verfahrens notwendigen Komponenten einer Mikroprozessoreinheit MP. Diese weist die bereits beschriebene gesicherte Laufzeitumgebung SWd und die unsichere Umgebung NWd auf. Die gesicherte Umgebung wird auch als Trust-Zone TZ bezeichnet. In dieser ist wenigstens ein als Trustlet TL bezeichnete Applikation enthalten. Über eine applikationsspezifische Schnittstelle (MC Trustlet API) kommuniziert diese mit einem Betriebssystem der gesicherten Laufzeitumgebung MC, bspw. MobiCore, (Block Bl). Darüber hinaus sind Treiber DRV in der gesicherten Lauf zeitumgebung SWd enthalten (Block B2). </p><p id="p0015" num="0015">In der unsicheren Umgebung, welches als Betriebssystem z.B. Rieh OS nutzt, ist wenigstens eine Applikation APP vorgesehen, welche über eine anwendungsspezifische Schnittstelle (Application specific API) mit einem Applika- 
<!-- EPO <DP n="9"/>-->
 tionsverbinder TLC (sog. Trustlet Connector) im Block AI Daten austauschen kann. Der Applikationsverbinder kann über eine Schnittstelle TCI mit einer Applikation TL in der gesicherten Laufzeitumgebung kommunizieren. In der unsicheren Umgebung NWd ist ferner in einem Block A2 ein Treiber MCD, bspw. ein MobiCore-Treiber, enthalten, dem eine applikationsspezifische Schnittstelle (MC-Driver API) zugeordnet ist. Darüber hinaus ist in einem Block A3 ein virtueller Treiber VDRV in der unsicheren Umgebung enthalten. Der MobiCore-Treiber MCD kann über eine Schnittstelle MCI mit dem Betriebssystem MC der gesicherten Laufzeitumgebung kommunizieren. Über eine Schnittstelle DCI ist eine Kommunikation zwischen dem virtuellen Treiber VDRV und dem Treiber DRV der gesicherten Lauf zeitumgebung möglich. </p><p id="p0016" num="0016">Erfindungsgemäße Eigenschaften der Mikroprozessoreinheit sind ein ausge- lagerter Prozess-Scheduler in der unsicheren Umgebung in dem MobiCore- Treiber MCD. In dem Betriebssystem der gesicherten Lauf zeitumgebung, bspw. MobiCore, ist ein optimierter μΚθΓηθΙ enthalten, welcher bspw. keine Inter-Prozess-Kommunikation umfasst. In MC erfolgt ein preemptives Multitasking mit Zeitkontingenten. Darüber hinaus umfasst MC einen optimierten Task-Kontext. Schließlich umfasst die Mikroprozessoreinheit ein mehrschichtiges Treiberkonzept in den Blöcken AI, A2, A3, welche optimiert auf eine asynchrone Kommunikation mit einer multitaskingfähigen Umgebung in Bl sind. Das mehrschichtige Treiberkonzept wird nachfolgend näher anhand Fig. 3 erläutert. Der MobiCore-Treiber MCD (Block A2) ist, wie in Fig. 3 dargestellt, aufgebaut und umfasst drei Schnittstellen für die Übertragung von Steuerdaten MCP und NQ sowie Kontrolldaten FC zwischen der unsicheren Umgebung und der gesicherten Lauf zeitumgebung SWd. In dem MobiCore- 
<!-- EPO <DP n="10"/>-->
 Betriebssystem (Block Bl) sind ferner eine Lauf Zeitmanagementeinheit MCRT und ein Kontrolldaten-Handler FCH vorgesehen. Darüber hinaus ist die eingangs bereits erwähnte Monitoreinheit M zur Koordination des Datenaustausche zwischen gesicherter Lauf zeitumgebung SWd und unsicherer Umgebung NWd dargestellt. </p><p id="p0017" num="0017">Die der Übertragung der Steuerdaten MCP zugeordnete Schnittstelle ist für die Steuerung des MobiCore-Betriebssystems MC hauptverantwortlich. Hier wird entschieden, welche Tasks des Betriebssystems gestartet und gestoppt werden. Die von dem MobiCore-Betriebssystem gelieferten Daten werden auf richtige Formatierung überprüft. Für die Kommunikation wird ein spezieller Puffer in einem Speicher reserviert, der über eine Kontrollnachricht FC initialisiert wird. Der Speicher wird als World Shared Memory bezeichnet. Auf diesen kann sowohl von der unsicheren Umgebung NWd als auch von der gesicherten Laufzeitumgebung SWd zugegriffen werden. </p><p id="p0018" num="0018">Die der Übertragung der Steuerdaten NQ zugeordnete Schnittstelle ist dafür verantwortlich, mittels Nachrichten die Laufzeitmanagementeinheit MCRT zu informieren, dass Daten zur Abholung in dem Speicher bereit liegen. Die- se Daten können von dem MobiCore-Treiber MCD stammen, d.h. zur Datenkommunikation zwischen einer Applikation der unsicheren Umgebung NWd mit einer bestimmten Applikation (Trustlet TL) der gesicherten Laufzeitumgebung SWd gehören. Im Falle einer Kommunikation auf der Schicht des MobiCore-Treibers MCD sind die Nachrichten mit einem Kennzeichner, einer sog. Session ID, versehen, anhand der das MobiCore-Betriebssystem MC die Nachricht eindeutig einer bestimmten Applikation TL der gesicherten Laufzeitumgebung SWd zuordnen kann. 
<!-- EPO <DP n="11"/>-->
 Ebenso können Steuerdaten aus der Schicht der Steuerdaten MCP im Puffer der Steuerdaten NQ sein. In beiden Fällen informiert die NQ zugeordnete Schnittstelle über das Auslösen eines speziellen Interrupts (vorzugsweise ein spezieller Trust-Zone-Interrupt SIQ) die Laufzeitmanagement-Einheit MCRP über bereitgestellte Daten. </p><p id="p0019" num="0019">Über die den Kontrolldaten FC zugeordnete Schnittstelle findet der eigentliche Wechsel zwischen der unsicheren Umgebung NWd und der gesicherten Lauf zeitumgebung SWd statt. Hierzu gibt es drei Möglichkeiten, wie mit der Monitoreinheit M interagiert werden kann. Über sog. Fast Calls, N-SIQ- Nachrichten oder NQ-IRQ-Nachrichten. Letztere werden als Notification IRQ bezeichnet. Die beiden ersten schalten lediglich von der unsicheren Umgebung in die gesicherte Lauf zeitumgebung um. Im Fall von NQ-IRQs ist auch eine Umschaltung in umgekehrter Richtung möglich. </p><p id="p0020" num="0020">Die Aufgabe des Schedulers übernimmt die den Steuerdaten MCP zugeordnete Schnittstelle im MobiCore-Treiber MCD der unsicheren Umgebung. Der Treiber entscheidet, welche MobiCore-Task zur Ausführung gebracht wird. Das beschriebene Konzept ermöglicht Optimierungen im μΚεΓ<sup>η</sup>εΙ- Ansatz. Im Vergleich zu klassischen μΚεΓηεΙ- Ansätzen ist im MobiCore-Betriebssystem MC keine Interprozesskommunikation IPC implementiert. MobiCore- Prozesse können dennoch Daten austauschen über einen gemeinsam benutzten Speicher (World Shared Memory). MobiCore-Prozessen wird darüber hinaus eine bestimmte Rechenzeit zugewiesen, die aus Sicherheitsgründen nicht überschritten werden kann. 
<!-- EPO <DP n="12"/>-->
 Ein MobiCore-Prozess besitzt einfache Threads- bzw. Task-Strukturen. Hierdurch müssen bei einem Kontextwechsel keine großen Datenmengen kopiert werden. Dadurch ergeben sich schnelle Kontextwechselseiten. Die Thread-Struktur ist wie folgt: ID des Threads, aktueller Zustand des Threads, lokaler Exception Handler der Threads, Priorität des Threads. Die Task-Struktur ist wie folgt: Momentaner Zustand der Task, Task ID der Er- zeuger-Task, externer Exception Handler der Task, Rechenzeitkontingent der Task, Anzahl der Threads, die die Task aktivieren oder spenden kann, Priori- tat und Rechte der Task. </p><p id="p0021" num="0021">Die Übertragung von Applikationsdaten, Steuerdaten und Kontrolldaten über verschiedene Puffer kann für die in Fig. 4 dargestellte Anwendung genutzt werden. </p><p id="p0022" num="0022">Eine Applikation in einem sicheren Bereich eines mobilen Telefons Hl, H2, ..., Hn kommuniziert mit einem zentralen Hintergrundsystem (Datenbank D) und bekommt von dort eine Information zur Darstellung im Display des Sicherheitsmodus übermittelt. Die darzustellende Information kann bspw. eine Zahlenkolonne, ein Bild, ein Logo usw. sein. In regelmäßigen Abständen modifiziert das Hintergrundsystem D die im Sicherheitsmodus darzustellende Information. Die darzustellende Information wird zusätzlich einem breiten Nutzerkreis zeitgleich öffentlich bekannt gegeben. Der Anwender des Endgeräts Hl, H2, Hn, das eine sichere Anzeigevorrichtung umfasst, kann über einen zweiten Kommunikationskanal die aktuell gültige Information überprüfen. Der zweite Kommunikationskanal kann bspw. ein Internetfähiger Rechner, der Browser des Mobiltelefons, das eine Web-Verbindung aus der sicheren Welt umfasst, eine Tageszeitung usw. sein. 
<!-- EPO <DP n="13"/>-->
 Hiermit steht nicht der Schutz von sicherheitskritischen Daten, z.B. kryp- tografische Schlüssel, im Vordergrund. Stattdessen ist hier die Nutzerwahrnehmung eines sicheren Displays oder eines sicheren Eingabemittels von Bedeutung. Hierdurch kann das Vertrauen von Endanwendern in mobile Endgeräte, bspw. für mobile Bankanwendungen oder Zahlungsanwendungen, erhöht werden. </p><p id="p0023" num="0023">Hierzu sind in dem Datenbanksystem D Informationen hinterlegt, die in den Endgeräten Hl, H2, ..., Hn mittels eines in den Endgeräten implementierten Aktualisierungs-Servers über einen Aktualisierungs-Client der Datenbank ausgewechselt werden. Die Information ist in Fig. 4 beispielhaft ein Weihnachtsbaum. Dieselbe Information wird auch über einen in dem Datenbanksystem integrierten Web-Server öffentlich beliebigen Systemen zur Verifikation VS über einen öffentlichen Kanal v zugänglich gemacht. Der Ablauf der Aktualisierung der Information ist wie folgt: </p><p id="p0024" num="0024">Der Update-Server kontaktiert über einen sicheren Kanal s alle in der Datenbank D gelisteten mobilen Endgeräte Hl, H2, ..., Hn, um eine neue Information zu verschicken. Dies bedeutet, in regelmäßigen Abständen modifiziert das Hintergrundsystem die im Sicherheitsmodus des mobilen Endgeräts Hl, H2, ..., Hn darzustellende Information. Um eine erfolgreiche Aktualisierung durchzuführen, muss der Aktualisierungs-Client sich bei dem Aktualisierungs-Server in dem Endgerät authentisieren. Dies kann bspw. mit einem Client-Zertifikat erfolgen. Ebenso muss auch der Aktualisierungs-Server des Endgeräts beim Aktualisierungs-Client der Datenbank nachweisen, dass der richtige Server für die Aktualisierung kontaktiert wurde. Dies kann mittels eines Server-Zertifikats erfolgen. 
<!-- EPO <DP n="14"/>-->
 3. Nach der erfolgreichen gegenseitigen Authentisierung wird über den gesicherten Kanal s zwischen dem Aktualisierungs-Server der Handgeräte und dem Aktualisierungs-Client der Datenbank die neue Information (hier: Weihnachtsbaum) in das Endgerät in einem nur dem Sicher- heitsmodus zugänglichen Bereich eingespielt. </p><p id="p0025" num="0025"> 4. Optional ist die Information mit einem digitalen Wasserzeichen geschützt und für jedes Endgerät personalisiert. </p><p id="p0026" num="0026"> 5. Die Personalisierung kann bspw. in der gesicherten Laufzeitumgebung überprüft werden. Falls sie nicht für das Endgerät passend ist, werden bestimmte Funktionalitäten der gesicherten Laufzeitumgebung blockiert. Dies hat bspw. zur Folge, dass keine mobilen Zahlvorgänge möglich sind. </p><p id="p0027" num="0027">Der Ablauf der Verifikation durch den Endanwender ist wie folgt: </p><p id="p0028" num="0028">1. Der Endanwender führt eine Aktion durch, die das mobile Endgerät Hl, H2, ..., Hn in einen Sicherheitsmodus schaltet. </p><p id="p0029" num="0029"> 2. Das betreffende mobile Endgerät zeigt nun an einer bestimmten Stelle im sicheren Bildschirm eine beliebige Information, hier den Weih- nachtsbaum, an. </p><p id="p0030" num="0030"> 3. Der Anwender des Endgeräts kann nun über einen zweiten, parallelen Kanal überprüfen, ob die Information auf seinem mobilen Endgerät mit der anderweitig veröffentlichten Information überein stimmt. Hierdurch wird das Vertrauen des Endanwenders in ein Mobiltelefon, speziell für Bezahl- und Bankanwendungen, erhöht. Angriffe, die einen Sicherheitszustand eines elektronischen Endgeräts vortäuschen, werden deutlich erschwert. Der Benutzer wird in die Lage versetzt, zu überprüfen, ob sich 
<!-- EPO <DP n="15"/>-->
 das mobile Gerät im Sicherheitsmodus befindet. Hierdurch wird ein höheres Vertrauen des Anwenders in die oben genannten Applikationen geschaffen. 
</p></description><claims mxw-id="PCLM44727485" ref-ucid="WO-2012113545-A2" lang="DE" load-source="patent-office"><claim id="clm-0001" num="0001"><!-- EPO <DP n="16"/>--><claim-text/><claim-text>P a t e n t a n s p r ü c h e </claim-text><claim-text>Verfahren zum Datenaustausch zwischen einer gesicherten Laufzeitumgebung (SWd), in welcher eine Anzahl an sicheren Applikationen (TL) ausführbar ist, und einer unsicheren Umgebung (NWd) einer Mikroprozessoreinheit (MP), insbesondere in einem mobilen Endgerät, bei dem die Übertragung von Applikationsdaten (AD) und Steuerdaten (MCP, NQ) über verschiedene Puffer erfolgt. </claim-text><claim-text>Verfahren nach Anspruch 1, dadurch gekennzeichnet, dass die Steuerdaten (MCP, NQ) unterschiedlicher Art über unterschiedliche Puffer übertragen werden. </claim-text><claim-text>Verfahren nach Anspruch 1 oder 2, dadurch gekennzeichnet, dass, die Umschaltung zwischen der gesicherten Laufzeitumgebung (SWd) und der unsicheren Umgebung (NWd) betreffende, Kontrolldaten (FC) über einen eigenen sicheren Puffer übertragen werden. </claim-text><claim-text>Verfahren nach einem der vorhergehenden Ansprüche, dadurch gekennzeichnet, dass die Übertragung der Applikationsdaten (AD) und der Steuerdaten (MCP, NQ) sowie optional der Kontrolldaten (FC) auf einem ARM Monitorcode basiert, der in einer Monitoreinheit (M) implementiert ist, welche Schnittstellen zur der gesicherten Laufzeitumgebung (SWd) und der unsicheren Umgebung (NWd) aufweist. </claim-text><claim-text>Verfahren nach einem der vorhergehenden Ansprüche, dadurch gekennzeichnet, dass die Übertragung der Applikationsdaten (AD) und der Steuerdaten (MCP, NQ) zwischen der gesicherten Laufzeitumgebung (SWd) und einem Treiber (MCD) der unsicheren Umgebung (NWd) erfolgt. 
<!-- EPO <DP n="17"/>-->
 Verfahren nach Anspruch 5, dadurch gekennzeichnet, dass ein in der unsicheren Umgebung (NWd), insbesondere in einer Schnittstelle des Treibers (MCD) für die Steuerdaten (MCP), implementierter Schedu- ler festlegt, welche der sicheren Applikationen (TL) in der gesicherten Lauf zeitumgebung (SWd) zur Ausführung gebracht wird. </claim-text><claim-text>Verfahren nach einem der vorhergehenden Ansprüche, dadurch gekennzeichnet, dass der Datenaustausch unter Nutzung eines, von der gesicherten Laufzeitumgebung (SWd) und der unsicheren Umgebung (NWd) les- und/ oder beschreibbaren, Speicherbereichs eines Speichers (WSM) erfolgt. </claim-text><claim-text>Verfahren nach Anspruch 7, dadurch gekennzeichnet, dass über Steuernachrichten die gesicherte Laufzeitumgebung über für diese bestimmte Daten in dem Speicherbereich benachrichtigt wird. </claim-text><claim-text>Verfahren nach Anspruch 8, dadurch gekennzeichnet, dass die Steuernachrichten mit einem eindeutigen Sitzungs-Kennzeichner versehen werden, anhand dem die gesicherte Lauf zeitumgebung (SWd) die Steuernachricht einer der in der gesicherten Laufzeitumgebung (SWd) ausgeführten Applikationen (TL) zuordnen kann. </claim-text><claim-text>Verfahren nach einem der vorhergehenden Ansprüche, dadurch gekennzeichnet, dass jedem in der gesicherten Lauf zeitumgebung (SWd) ablaufenden Prozess eine definierte, nicht überschreitbare Rechenzeit zugewiesen wird. 
<!-- EPO <DP n="18"/>-->
 Verfahren nach Anspruch 10, dadurch gekennzeichnet, dass ein jeweiliger Prozess nachfolgende Threadstruktur aufweist: Kennzeichner (ID) des Threads; Aktueller Zustand des Threads; Lokaler Exception Handler der Threads; Priorität des Threads. </claim-text><claim-text>Verfahren nach Anspruch 10, dadurch gekennzeichnet, dass ein jeweiliger Prozess nachfolgende Taskstruktur aufweist: Momentaner Zustand der Task; Task-Kennzeichner der Erzeuger-Task; Externer Exception Handler der Task; Rechenzeitkontingent der Task; Anzahl der Threads, die die Task aktivieren oder bereitstellen kann; Priorität und Rechte der Task. </claim-text><claim-text>Mikroprozessoreinheit mit einer gesicherten Laufzeitumgebung (SWd) und einer unsicheren Umgebung (NWd), welche derart ausgestaltet ist, dass zum Datenaustausch zwischen der gesicherten Laufzeitumgebung (SWd) und der unsicheren Umgebung (NWd) die Übertragung von Applikationsdaten (AD) und Steuerdaten (MCP, NQ, FC) über verschiedene Puffer erfolgt. </claim-text><claim-text>Mikroprozessoreinheit nach Anspruch 13, dadurch gekennzeichnet, dass diese derart ausgestaltet ist, dass durch diese ein Verfahren nach einem der Ansprüche 2 bis 12 ausführbar ist. </claim-text><claim-text>Mobiles Endgerät, umfassend eine Mikroprozessoreinheit nach Anspruch 13 oder 14. 
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
