<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2678939-A2" country="EP" doc-number="2678939" kind="A2" date="20140101" family-id="46652199" file-reference-id="286464" date-produced="20180823" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146550558" ucid="EP-2678939-A2"><document-id><country>EP</country><doc-number>2678939</doc-number><kind>A2</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12750058-A" is-representative="NO"><document-id mxw-id="PAPP154824481" load-source="docdb" format="epo"><country>EP</country><doc-number>12750058</doc-number><kind>A</kind><date>20120220</date><lang>EN</lang></document-id><document-id mxw-id="PAPP220438183" load-source="docdb" format="original"><country>EP</country><doc-number>12750058.5</doc-number><date>20120220</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140453328" ucid="US-201113169407-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201113169407</doc-number><kind>A</kind><date>20110627</date></document-id></priority-claim><priority-claim mxw-id="PPC140446567" ucid="US-201161445650-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201161445650</doc-number><kind>P</kind><date>20110223</date></document-id></priority-claim><priority-claim mxw-id="PPC140454095" ucid="US-2012025796-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>2012025796</doc-number><kind>W</kind><date>20120220</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988107660" load-source="docdb">H02P   7/285       20060101AFI20120912BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1765415784" load-source="docdb" scheme="CPC">H02P  29/662       20161101 LI20170915BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1765415785" load-source="docdb" scheme="CPC">H02P  21/141       20130101 LI20170915BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988124972" load-source="docdb" scheme="CPC">H02P   7/285       20130101 FI20130420BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132184158" lang="DE" load-source="patent-office">VERFAHREN UND SYSTEM ZUR STEUERUNG EINES ELEKTROMOTORS MIT TEMPERATURKOMPENSATION</invention-title><invention-title mxw-id="PT132184159" lang="EN" load-source="patent-office">METHOD AND SYSTEM FOR CONTROLLING AN ELECTRICAL MOTOR WITH TEMPERATURE COMPENSATION</invention-title><invention-title mxw-id="PT132184160" lang="FR" load-source="patent-office">PROCÉDÉ ET SYSTÈME DE COMMANDE D'UN MOTEUR ÉLECTRIQUE AVEC COMPENSATION DE LA TEMPÉRATURE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918152276" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>DEERE &amp; CO</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR918170391" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>DEERE &amp; COMPANY</last-name></addressbook></applicant><applicant mxw-id="PPAR918980605" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Deere &amp; Company</last-name><iid>101333807</iid><address><street>1 John Deere Place</street><city>Moline, IL 61265</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918135571" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>WU LONG</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918150691" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>WU, LONG</last-name></addressbook></inventor><inventor mxw-id="PPAR918988259" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>WU, LONG</last-name><address><street>2824 37th Avenue South</street><city>Fargo, ND 58104</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918137707" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>SHAW ROBERT</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918149019" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>SHAW, ROBERT</last-name></addressbook></inventor><inventor mxw-id="PPAR918980474" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>SHAW, ROBERT</last-name><address><street>1622 42nd Avnue South</street><city>Moorhead, MN 56560</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918984900" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Holst, Sönke</last-name><iid>101371590</iid><address><street>John Deere GmbH &amp; Co. KG Mannheim Regional Center Global Intellectual Property Services John-Deere-Strasse 70</street><city>68163 Mannheim</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="US-2012025796-W"><document-id><country>US</country><doc-number>2012025796</doc-number><kind>W</kind><date>20120220</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012115897-A2"><document-id><country>WO</country><doc-number>2012115897</doc-number><kind>A2</kind><date>20120830</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548911561" load-source="docdb">AL</country><country mxw-id="DS548909215" load-source="docdb">AT</country><country mxw-id="DS548911570" load-source="docdb">BE</country><country mxw-id="DS548913214" load-source="docdb">BG</country><country mxw-id="DS548894795" load-source="docdb">CH</country><country mxw-id="DS548831866" load-source="docdb">CY</country><country mxw-id="DS548831867" load-source="docdb">CZ</country><country mxw-id="DS548859282" load-source="docdb">DE</country><country mxw-id="DS548911571" load-source="docdb">DK</country><country mxw-id="DS548911572" load-source="docdb">EE</country><country mxw-id="DS548812056" load-source="docdb">ES</country><country mxw-id="DS548913215" load-source="docdb">FI</country><country mxw-id="DS548913216" load-source="docdb">FR</country><country mxw-id="DS548859283" load-source="docdb">GB</country><country mxw-id="DS548911573" load-source="docdb">GR</country><country mxw-id="DS548859284" load-source="docdb">HR</country><country mxw-id="DS548831868" load-source="docdb">HU</country><country mxw-id="DS548894796" load-source="docdb">IE</country><country mxw-id="DS548911950" load-source="docdb">IS</country><country mxw-id="DS548913217" load-source="docdb">IT</country><country mxw-id="DS548911951" load-source="docdb">LI</country><country mxw-id="DS548859285" load-source="docdb">LT</country><country mxw-id="DS548909216" load-source="docdb">LU</country><country mxw-id="DS548913218" load-source="docdb">LV</country><country mxw-id="DS548859286" load-source="docdb">MC</country><country mxw-id="DS548909217" load-source="docdb">MK</country><country mxw-id="DS548909222" load-source="docdb">MT</country><country mxw-id="DS548812057" load-source="docdb">NL</country><country mxw-id="DS548919088" load-source="docdb">NO</country><country mxw-id="DS548812058" load-source="docdb">PL</country><country mxw-id="DS548909223" load-source="docdb">PT</country><country mxw-id="DS548894797" load-source="docdb">RO</country><country mxw-id="DS548909224" load-source="docdb">RS</country><country mxw-id="DS548812059" load-source="docdb">SE</country><country mxw-id="DS548831869" load-source="docdb">SI</country><country mxw-id="DS548919089" load-source="docdb">SK</country><country mxw-id="DS548919162" load-source="docdb">SM</country><country mxw-id="DS548913219" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA99619570" ref-ucid="WO-2012115897-A2" lang="EN" load-source="patent-office"><p num="0000">A temperature estimation module {104} estimates a change in temperature of the magnets associated with the rotor of the motor (117) based on an operational magnetic flux strength that is compared to a reference magnetic flux strength determined at a known- ambient temperature and for a predetermined operating range of the motor. The temperature estimation module (104) or the system (120) establishes a relationship between the estimated change in the temperature and a magnetic torque component of a target output torque of the motor (117) consistent with the predetermined operating range. The current adjustment module (107) or the system (120) adjusts a command (e.g., quadrature-axis current command) for the motor (117) to compensate for shaft torque variation associated with the estimated change in the temperature In conformance with the established relationship.</p></abstract><abstract mxw-id="PA99819251" ref-ucid="WO-2012115897-A2" lang="EN" source="national office" load-source="docdb"><p>A temperature estimation module {104} estimates a change in temperature of the magnets associated with the rotor of the motor (117) based on an operational magnetic flux strength that is compared to a reference magnetic flux strength determined at a known- ambient temperature and for a predetermined operating range of the motor. The temperature estimation module (104) or the system (120) establishes a relationship between the estimated change in the temperature and a magnetic torque component of a target output torque of the motor (117) consistent with the predetermined operating range. The current adjustment module (107) or the system (120) adjusts a command (e.g., quadrature-axis current command) for the motor (117) to compensate for shaft torque variation associated with the estimated change in the temperature In conformance with the established relationship.</p></abstract><abstract mxw-id="PA99619571" ref-ucid="WO-2012115897-A2" lang="FR" load-source="patent-office"><p num="0000">Le système selon l'invention comprend un module d'évaluation de la température (104) qui évalue un changement de température des aimants associés au rotor d'un moteur (117) sur la base d'une force de flux magnétique de fonctionnement qui est comparée à une force de flux magnétique de référence déterminée à une température ambiante connue et pour une plage de fonctionnement prédéterminée du moteur. Le module d'évaluation de la température (104) ou le système (120) établit une relation entre le changement de température estimé et une composante de couple magnétique d'un couple de sortie cible du moteur (117) en accord avec la plage de fonctionnement prédéterminée. Un module de régulation du courant (107) ou le système (120) adapte une commande (par exemple une commande de courant d'axe en quadrature) pour le moteur (117) afin de compenser les variations de couple de l'arbre associées au changement de température estimé en fonction de la relation établie.</p></abstract><abstract mxw-id="PA99819252" ref-ucid="WO-2012115897-A2" lang="FR" source="national office" load-source="docdb"><p>Le système selon l'invention comprend un module d'évaluation de la température (104) qui évalue un changement de température des aimants associés au rotor d'un moteur (117) sur la base d'une force de flux magnétique de fonctionnement qui est comparée à une force de flux magnétique de référence déterminée à une température ambiante connue et pour une plage de fonctionnement prédéterminée du moteur. Le module d'évaluation de la température (104) ou le système (120) établit une relation entre le changement de température estimé et une composante de couple magnétique d'un couple de sortie cible du moteur (117) en accord avec la plage de fonctionnement prédéterminée. Un module de régulation du courant (107) ou le système (120) adapte une commande (par exemple une commande de courant d'axe en quadrature) pour le moteur (117) afin de compenser les variations de couple de l'arbre associées au changement de température estimé en fonction de la relation établie.</p></abstract><description mxw-id="PDES50930329" ref-ucid="WO-2012115897-A2" lang="EN" load-source="patent-office"><!-- EPO <DP n="3"/>--><p id="p0001" num="0001"> METHOD AND SYSTEM CONTROLLING AN ELECTRICAL MOTOR WITH </p><p id="p0002" num="0002"> TEMPERATURE COMPENSATION </p><p id="p0003" num="0003">This document claims priority based on U.S. provisional application serial number 61/445,650, filed on 23 February 201 1 and entitled METHOD AND SYSTEM </p><p id="p0004" num="0004">CONTROLLING AN ELECTRICAL MOTOR WITH TEMPERATURE COMPENSATION, under 35 U.S.C. 1 19(e). </p><p id="p0005" num="0005">Field of the Invention </p><p id="p0006" num="0006"> This invention relates to a method and system for controlling an electrical motor with temperature compensation. </p><p id="p0007" num="0007">Background of the Invention </p><p id="p0008" num="0008"> An electric motor may feature a rotor with permanent magnets and a stator, such as an interior permanent magnet (IPM) motor or IPM synchronous motor. An interior permanent magnet (IPM) motor or IPM synchronous machine may have varying magnetic field strength because of a temperature change in the magnets associated with the rotor. In turn, if the magnetic field strength decreases, the output torque and operating efficiency of the motor tends to decrease. Certain motors have no direct temperature sensors that measure the temperature of the magnets on the rotor, as opposed to the stator housing or the stator windings. Further, the rotor magnet temperature may have a poorly defined, erratic or inconsistent relationship with the stator winding temperature or coolant temperature at different speed regions of the motor. Thus, there is a need for an improved method and system for controlling an electrical motor with temperature compensation. </p><p id="p0009" num="0009">Summary of the Invention </p><p id="p0010" num="0010"> In accordance with one embodiment, the method and system for controlling an electrical motor comprises a rotor with associated rotor magnets and a stator. A temperature estimation module estimates a change in temperature of the magnets associated with the rotor of the motor based on an operational magnetic flux strength that is compared to a reference magnetic flux strength determined at a known ambient temperature and for a predetermined operating range of the motor. The temperature estimation module or the system establishes a relationship between the 
<!-- EPO <DP n="4"/>-->
 estimated change in the temperature and a magnetic torque component of a target output torque of the motor consistent with the predetermined operating range. The current adjustment module or the data processing system adjusts a command (e.g., quadrature-axis current command or the quadrant axis current) for the motor to compensate for shaft torque variation associated with the estimated change in the temperature in conformance with the established relationship. </p><p id="p0011" num="0011">Brief Description of the Drawings </p><p id="p0012" num="0012"> FIG. 1 is a block diagram of one embodiment of a system for controlling an electrical motor with temperature compensation. </p><p id="p0013" num="0013"> FIG. 2 is a block diagram of an electronic data processing system consistent with FIG. 1 . </p><p id="p0014" num="0014"> FIG. 3 is a block diagram that shows a portion of the system in greater detail than FIG. 1 . </p><p id="p0015" num="0015"> FIG. 4 is a flow chart of a first embodiment of a method for controlling an electrical motor with temperature compensation. </p><p id="p0016" num="0016"> FIG. 5 is a flow chart of a second embodiment of a method for controlling an electrical motor with temperature compensation. </p><p id="p0017" num="0017"> FIG. 6 is a flow chart of a third embodiment for controlling an electrical motor with temperature compensation. </p><p id="p0018" num="0018">Description of the Preferred Embodiment </p><p id="p0019" num="0019"> In accordance with one embodiment, FIG. 1 discloses system for controlling a motor 1 17 (e.g., an interior permanent magnet (IPM) motor) or another alternating current machine. In one embodiment, the system, aside from the motor 1 17, may be referred to as an inverter or a motor controller. </p><p id="p0020" num="0020"> The system comprises electronic modules, software modules, or both. In one embodiment, the motor controller comprises an electronic data processing system 120 to support storing, processing or execution of software instructions of one or more software modules. The electronic data processing system 120 is indicated by 
<!-- EPO <DP n="5"/>-->
 the dashed lines in FIG. 1 and is shown in greater detail in FIG. 2. </p><p id="p0021" num="0021"> The data processing system 120 is coupled to an inverter circuit 188. The inverter circuit 188 comprises a semiconductor drive circuit that drives or controls switching semiconductors (e.g., insulated gate bipolar transistors (IGBT) or other power transistors) to output control signals for the motor 1 17. In turn, the inverter circuit 188 is coupled to the motor 1 17. The motor 1 17 is associated with a sensor 1 15 (e.g., a position sensor, a resolver or encoder position sensor) that is associated with the motor shaft 126 or the rotor. The sensor 1 15 and the motor 1 17 are coupled to the data processing system 120 to provide feedback data (e.g., current feedback data, such as i<sub>a</sub>, it<sub>&gt;</sub>, i<sub>c</sub>), raw position signals, among other possible feedback data or signals, for example. Other possible feedback data includes, but is not limited to, winding temperature readings, semiconductor temperature readings of the inverter circuit 188, three phase voltage data, or other thermal or performance information for the motor 1 17. </p><p id="p0022" num="0022"> In one embodiment, the torque command generation module 105 is coupled to a d-q axis current generation manager 109 (e.g., d-q axis current generation lookup tables). D-q axis current refers to the direct axis current and the quadrature axis current as applicable in the context of vector-controlled alternating current machines, such as the motor 1 17. The output of the d-q axis current generation manager 109 and the output of a current adjustment module 107 (e.g., d-q axis current adjustment module 107) are fed to a summer 1 19. In turn, one or more outputs (e.g., direct axis current data (id<sup>*</sup>) and quadrature axis current data (i<sub>q</sub><sup>*</sup>)) of the summer 1 19 are provided or coupled to a current regulation controller 1 1 1 . </p><p id="p0023" num="0023"> The current regulation controller 1 1 1 is capable of communicating with the pulse-width modulation (PWM) generation module 1 12 (e.g., space vector PWM generation module). The current regulation controller 1 1 1 receives respective d-q axis current commands (e.g., id<sup>*</sup> and i<sub>q</sub><sup>*</sup>) and actual d-q axis currents (e.g., id and i<sub>q</sub>) and outputs corresponding d-q axis voltage commands (e.g., v<sub>d</sub><sup>*</sup> and v<sub>q</sub><sup>*</sup> commands) for input to the PWM generation module 1 12. </p><p id="p0024" num="0024"> In one embodiment, the PWM generation module 1 12 converts the direct axis voltage and quadrature axis voltage data from two phase data representations into 
<!-- EPO <DP n="6"/>-->
 three phase representations (e.g., three phase voltage representations, such as v<sub>a</sub><sup>*</sup>, v<sub>b</sub><sup>*</sup> and v<sub>c</sub><sup>*</sup>) for control of the motor 1 17, for example. Outputs of the PWM </p><p id="p0025" num="0025">generation module 1 12 are coupled to the inverter 188. </p><p id="p0026" num="0026"> The inverter circuit 188 comprises power electronics, such as switching semiconductors to generate, modify and control pulse-width modulated signals or other alternating current signals (e.g., pulse, square wave, sinusoidal, or other waveforms) applied to the motor 1 17. The PWM generation module 1 12 provides inputs to a driver stage within the inverter circuit 188. An output stage of the inverter circuit 188 provides a pulse-width modulated voltage waveform, or other voltage signal for control of the motor. In one embodiment, the inverter 188 is powered by a direct current (DC) voltage bus. </p><p id="p0027" num="0027"> The motor 1 17 is associated with a sensor 1 15 (e.g., a resolver, encoder, speed sensor, or another position sensor or speed sensors) that estimates at least one of an angular position of the motor shaft 126, a speed or velocity of the motor shaft 126, and a direction of rotation of the motor shaft 126. The sensor 1 15 may be mounted on or integral with the motor shaft 126. The output of the sensor 1 15 is capable of communication with the primary processing module 1 14 (e.g., position and speed processing module). In one embodiment, the sensor 1 15 may be coupled to an analog-to-digital converter (not shown) that converts analog position data or velocity data to digital position or velocity data, respectively. In other embodiments, the sensor 1 15 (e.g., digital position encoder) may provide a digital data output of position data or velocity data for the motor shaft 126 or rotor. </p><p id="p0028" num="0028"> A first output (e.g., position data and speed data for the motor 1 17) of the primary processing module 1 14 is communicated to the phase converter 1 13 (e.g., three-phase to two-phase current Park transformation module) that converts respective three-phase digital representations of measured current into </p><p id="p0029" num="0029">corresponding two-phase digital representations of measured current. A second output (e.g., speed data) of the primary processing module 1 14 is communicated to the calculation module 1 10 (e.g., adjusted voltage over speed ratio module). </p><p id="p0030" num="0030"> An input of a sensing circuit 124 is coupled to terminals of the motor 1 17 for sensing at least the measured three-phase currents and a voltage level of the direct 
<!-- EPO <DP n="7"/>-->
 current (DC) bus (e.g., high voltage DC bus which may provide DC power to the inverter circuit 188). An output of the sensing circuit 124 is coupled to an analog-to- digital converter 122 for digitizing the output of the sensing circuit 124. In turn, the digital output of the analog-to-digital converter 122 is coupled to the secondary processing module 1 16 (e.g., Direct current (DC) bus and three phase current processing module). For example, the sensing circuit 124 is associated with the motor 1 17 for measuring three phase currents (e.g., current applied to the windings of the motor 1 17, back EMF induced into the windings, or both). </p><p id="p0031" num="0031"> Certain outputs of primary processing module 1 14 and the secondary processing module 1 16 feed the phase converter 1 13. For example, the phase converter 1 13 may apply a Park transformation or other conversion equations (e.g., certain conversion equations that are suitable are known to those of ordinary skill in the art) to convert the measured three-phase representations of current into two- phase representations of current based on the digital three-phase current data from the secondary processing module 1 16 and position data from the sensor 1 15. The output of the phase converter 1 13 module is coupled to the current regulation controller 1 1 1 . </p><p id="p0032" num="0032"> Other outputs of the primary processing module 1 14 and the secondary processing module 1 16 may be coupled to inputs of the calculation module 1 10 (e.g., adjusted voltage over-speed ratio calculation module). For example, the primary processing module 1 14 may provide speed data (e.g., motor shaft 126 revolutions per minute), whereas the secondary processing module 1 16 may provide a measured level of direct current voltage (e.g., on the direct current (DC) bus of a vehicle). The direct current voltage level on the DC bus that supplies the inverter circuit 188 with electrical energy may fluctuate or vary because of various factors, including, but not limited to, ambient temperature, battery condition, battery charge state, battery resistance or reactance, fuel cell state (if applicable), motor load conditions, respective motor torque and corresponding operational speed, and vehicle electrical loads (e.g., electrically driven air-conditioning compressor). The calculation module 1 10 is connected as an intermediary between the secondary processing module 1 16 and the dq-axis current generation manager 109. The output 
<!-- EPO <DP n="8"/>-->
 of the calculation module 1 10 can adjust or impact current commands generated by the d-q axis current generation manager 109 to compensate for fluctuation or variation in direct current bus voltage, among other things. </p><p id="p0033" num="0033"> The rotor magnet temperature estimation module 104, the current shaping module 106, and the terminal voltage feedback module 108 are coupled to or are capable of communicating with the dq-axis current adjustment module 107. In turn, the d-q axis current module 107 may communicate with the dq-axis current generation manager or the summer 1 19. </p><p id="p0034" num="0034"> The rotor magnet temperature module 104 estimates or determines the temperature of the rotor permanent magnet or magnets. In one embodiment, the rotor magnet temperature estimation module 104 may estimate the temperature of the rotor magnets from internal control variables calculation, one or more sensors located on the stator, in thermal communication with the stator, or secured to the housing of the motor 1 17. For example, the rotor magnet temperature module can estimate or facilitate the determination of the temperature of the rotor or a current adjustment based on the estimated temperature by observing a change in magnetic field strength or available torque of the motor 1 17 at an ambient or a reference temperature versus an actual elevated operating temperature. </p><p id="p0035" num="0035"> In one alternate embodiment, the rotor magnet temperature estimation module 104 may be replaced by or may estimate the temperature of the rotor magnets from one or more sensors located on the stator, in thermal communication with the stator, or secured to the housing of the motor 1 17. </p><p id="p0036" num="0036"> In another alternative embodiment, the rotor magnet temperature estimation module 104 may be replaced with a temperature detector (e.g., a thermistor or infrared thermal sensor coupled to wireless transmitter) mounted on the rotor or the magnet, where the detector provides a signal (e.g., wireless signal) indicative of the temperature of the magnet or magnets. </p><p id="p0037" num="0037"> In one embodiment, the method or system may operate in the following manner. The torque command generation module 105 receives an input control data message, such as a speed control data message, a voltage control data message, or a torque control data message, over a vehicle data bus 1 18. The torque 
<!-- EPO <DP n="9"/>-->
 command generation module 105 converts the received input control message into torque control command data 316. </p><p id="p0038" num="0038"> The d-q axis current generation manager 109 selects or determines the direct axis current command data and the quadrature axis current command data associated with respective torque control command data and respective detected motor shaft 126 speed data. For example, the d-q axis current generation manager 109 selects or determines the direct axis current command, the quadrature axis current command by accessing one or more of the following: (1 ) a look-up table, database or other data structure that relates respective torque commands to corresponding direct and quadrature axes currents, (2) a set of quadratic equations or linear equations that relate respective torque commands to corresponding direct and quadrature axes currents, or (3) a set of rules (e.g., if-then rules) that relates respective torque commands to corresponding direct and quadrature axes currents. The sensor 1 15 on the motor 1 17 facilitates provision of the detected speed data for the motor shaft 126, where the primary processing module 1 14 may convert position data provided by the sensor 1 15 into speed data. </p><p id="p0039" num="0039"> The current adjustment module 107 (e.g., d-q axis current adjustment module) provides current adjustment data to adjust the direct axis current command data and the quadrature axis current command data based on input data from the rotor magnet temperature estimation module 104 and the current shaping module 106 and terminal voltage feedback module 108. </p><p id="p0040" num="0040"> The current shaping module 106 may determine a correction or preliminary adjustment of the quadrature axis (q-axis) current command and the direct axis id- axis) current command based on one or more of the following factors: torque load on the motor 1 17 and speed of the motor 1 17, for example. The rotor magnet temperature estimation module 104 may generate a secondary adjustment of the q- axis current command and the d-axis current command based on an estimated change in rotor temperature or an estimated change in magnetic field strength of the rotor magnets with respect to a characterized rotor temperature or magnetic field strength at a known ambient temperature under known operational conditions, for example. The terminal voltage feedback module 108 may provide a third adjustment 
<!-- EPO <DP n="10"/>-->
 to the d-axis current command and q-axis current command based on a controller voltage command versus a voltage limit. The current adjustment module 107 may provide an aggregate current adjustment that considers the preliminary adjustment, one of the secondary adjustment and the third adjustment. </p><p id="p0041" num="0041"> In one embodiment, the motor 1 17 may comprise an interior permanent magnet (IPM) machine or a synchronous IPM machine (IPMSM). An IPMSM has many favorable advantages compared with conventional induction machines or surface mounted PM machines (SMPM) such as high efficiency, high power density, wide constant power operating region, maintenance free, for instance. </p><p id="p0042" num="0042"> If the motor 1 17 comprises an IPMSM, the output torque consists of two components, magnetic torque and reluctance torque, as follows: </p><p id="p0043" num="0043">3 3 </p><p id="p0044" num="0044"> = -PP + <sup>~</sup>PP ' ) " ' 0 ) </p><p id="p0045" num="0045">In Equation 1 , T<sub>shaft</sub> is the total torque of the motor, T<sub>mag</sub> is the magnetic torque component, Trei is the reluctance torque component, pp is the number of pole pairs of the motor or machine, 2<sub>/</sub> is the maximum flux linkage per phase, i<sub>d</sub> is the direct axis current, i<sub>q</sub> is the quadrature axis current, L<sub>d</sub> is the direct axis inductance, and L<sub>q</sub> is the quadrature axis inductance. </p><p id="p0046" num="0046"> In Equation 1 , the maximum flux linkage per phase i<sub>f</sub> ) can be determined by magnet strength and magnetic saturation level. L<sub>d</sub> and L<sub>q</sub> are machine d-q axis </p><p id="p0047" num="0047">inductances, which vary depending on magnetic saturation level. For the purpose of simplicity, the following assumptions apply to Equation 1 : </p><p id="p0048" num="0048"> 1. l<sub>f</sub> is directly proportional to magnet strength, as is the magnetic torque component</p><p id="p0049" num="0049">T </p><p id="p0050" num="0050"> 2. L<sub>d</sub> and L<sub>q</sub> are functions of ^ and i<sub>q</sub> only, although i<sub>f</sub> change has slight impact on L<sub>d</sub> and L<sub>q</sub> , where L<sub>d</sub> and L<sub>q</sub> can be derived from finite element analysis based simulations; and </p><p id="p0051" num="0051"> 3. (L<sub>d</sub> -L<sub>q</sub>) has negligible change when the d-q axis current (i<sub>d</sub> ,i<sub>q</sub>) varies slightly, and the reluctance torque component T<sub>rel</sub> has a negligible change with the d-q axis current varies slightly. 
<!-- EPO <DP n="11"/>-->
 Without adjusting current commands , magnet strength fluctuation due to magnet temperature change would cause a corresponding percentage change in the magnetic torque component^ . However, the net percentage change in the total output torque still depends on the weighting of each torque component, which varies with respect to operating conditions. </p><p id="p0052" num="0052"> In steady-state operation of an IMPSM (e.g., motor 1 17), the output of the current regulation controller 1 1 1 provides d-q axis terminal voltages can be expressed as follows: 
<img id="imgf000011_0001" he="5" wi="152" file="imgf000011_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0053" num="0053"> (3)</p><p id="p0054" num="0054">In Equations 2 and 3, v<sub>d</sub> is the direct axis voltage or command, v<sub>q</sub> is the quadrature axis voltage or command, r<sub>s</sub> is the stator resistance of the motor or machine, i<sub>d</sub> is the direct axis current, i<sub>q</sub> is the quadrature axis current, w<sub>e</sub> is the rotational electrical speed of the rotor with respect to the stator, i<sub>f</sub> is the maximum flux linkage per phase, L<sub>d</sub> is the direct axis inductance. </p><p id="p0055" num="0055"> In Equations 2 and 3, if neglecting stator resistance (r<sub>s</sub>) change with respect to stator winding temperature and assuming L<sub>d</sub> and L<sub>q</sub> are functions of d-q axis current (i<sub>d</sub> , i<sub>q</sub> ) only, the magnet temperature change that causes flux linkage fluctuation has no effect on d- axis terminal voltage command v<sub>d</sub> . The rotational electrical speed (w<sub>e</sub> ) of the rotor may be proportional to the rotational mechanical speed of the rotor, for example. However, q-axis terminal voltage command v<sub>q</sub> will vary accordingly to accommodate l<sub>f</sub> fluctuation. </p><p id="p0056" num="0056"> The sensor 1 15 (e.g., shaft or rotor speed detector) may comprise one or more of the following: a direct current motor, an optical encoder, a magnetic field sensor (e.g., Hall Effect sensor), magneto-resistive sensor, and a resolver (e.g., a brushless resolver). In one configuration, the sensor 1 15 comprises a position sensor, where position data and associated time data are processed to determine speed or velocity data for the motor shaft 126. In another configuration, the sensor 1 15 comprises a speed sensor, or the combination of a speed sensor and an integrator to determine the position of the motor shaft. 
<!-- EPO <DP n="12"/>-->
 In yet another configuration, the sensor 1 15 comprises an auxiliary, compact direct current generator that is coupled mechanically to the motor shaft 126 of the motor 1 17 to determine speed of the motor shaft 126, where the direct current generator produces an output voltage proportional to the rotational speed of the motor shaft 126. In still another configuration, the sensor 1 15 comprises an optical encoder with an optical source that transmits a signal toward a rotating object coupled to the shaft 126 and receives a reflected or diffracted signal at an optical detector, where the frequency of received signal pulses (e.g., square waves) may be proportional to a speed of the motor shaft 126. In an additional configuration, the sensor 1 15 comprises a resolver with a first winding and a second winding, where the first winding is fed with an alternating current, where the voltage induced in the second winding varies with the frequency of rotation of the rotor. </p><p id="p0057" num="0057"> In FIG. 2, the electronic data processing system 120 comprises an electronic data processor 264, a data bus 262, a data storage device 260, and one or more data ports (268, 270, 272, 274 and 276). The data processor 264, the data storage device 260 and one or more data ports are coupled to the data bus 262 to support communications of data between or among the data processor 264, the data storage device 260 and one or more data ports. </p><p id="p0058" num="0058"> In one embodiment, the data processor 264 may comprise an electronic data processor, a microprocessor, a microcontroller, a programmable logic array, a logic circuit, an arithmetic logic unit, an application specific integrated circuit, a digital signal processor, a proportional-integral-derivative (PID) controller, or another data processing device. </p><p id="p0059" num="0059"> The data storage device 260 may comprise any magnetic, electronic, or optical device for storing data. For example, the data storage device 260 may comprise an electronic data storage device, an electronic memory, non-volatile electronic random access memory, one or more electronic data registers, data latches, a magnetic disc drive, a hard disc drive, an optical disc drive, or the like. </p><p id="p0060" num="0060"> As shown in FIG. 2, the data ports comprise a first data port 268, a second data port 270, a third data port 272, a fourth data port 274 and a fifth data port 276, although any suitable number of data ports may be used. Each data port may comprise a transceiver and buffer memory, for example. In one embodiment, each data port may comprise any serial or parallel input/output port. </p><p id="p0061" num="0061"> In one embodiment as illustrated in FIG. 2, the first data port 268 is coupled to the vehicle data bus 1 18. In turn, the vehicle data bus 1 18 is coupled to the controller 266. In 
<!-- EPO <DP n="13"/>-->
 one configuration, the second data port 270 may be coupled to the inverter circuit 188; the third data port 272 may be coupled to the sensor 1 15; the fourth data port 274 may be coupled to the analog-to-digital converter 122; and the fifth data port 276 may be coupled to the terminal voltage feedback module 108. The analog-to-digital converter 122 is coupled to the sensing circuit 124. </p><p id="p0062" num="0062"> In one embodiment of the data processing system 120, the torque command generation module 105 is associated with or supported by the first data port 268 of the electronic data processing system 120. The first data port 268 may be coupled to a vehicle data bus 1 18, such as a controller area network (CAN) data bus. The vehicle data bus 1 18 may provide data bus messages with torque commands to the torque command generation module 105 via the first data port 268. The operator of a vehicle may generate the torque commands via a user interface, such as a throttle, a pedal, a controller 266, or other control device. </p><p id="p0063" num="0063"> In certain embodiments, the sensor 1 15 and the primary processing module 1 14 may be associated with or supported by a third data port 272 of the data processing system 120. </p><p id="p0064" num="0064"> In one embodiment, where an electrical motor (e.g., 1 17) comprises a rotor with associated magnets and a stator, a system for controlling the motor (e.g., 1 17) comprises a data processor 264 for estimating a change in temperature of the magnets associated with the rotor of the motor (e.g., 1 17) based on an operational magnetic flux strength that is compared to a reference magnetic flux strength determined at a known ambient temperature and for a predetermined operating range of the motor. A temperature estimation module 104 is adapted to establish a relationship between the estimated change in the temperature and a magnetic torque component of a target output torque of the motor consistent with the predetermined operating range. For example, in one configuration a temperature estimation module 104 comprises software instructions (e.g., stored in the data storage device 260 in permanent or non-transitory form) for the data processor 264 to establish a relationship between the estimated change in the temperature and a magnetic torque component of a target output torque of the motor consistent with the predetermined operating range. A current adjustment module 107 is adapted to 
<!-- EPO <DP n="14"/>-->
 adjust a command for the motor to compensate for shaft torque variation associated with the estimated change in the temperature in conformance with the established relationship. For example, in one configuration the current adjustment module 107 comprises software instructions (e.g., stored in the data storage device 260 in permanent or non-transitory form) for the data processor 264 to compensate for shaft torque variation associated with the estimated change in the temperature in conformance with the established relationship. </p><p id="p0065" num="0065"> In one embodiment, the data processor 264 is arranged to derive the operational magnetic flux strength from an operational quadrature-axis voltage command and wherein the data processor 264 is arranged to derive the reference magnetic flex strength from a reference quadrature-axis voltage command. The data processor 264 is adapted to execute software instructions of the temperature estimation module 104 to establish the relationship, where the relationship comprises the magnetic torque component of the target output torque as a function of the reference magnetic flux strength, a direct-axis current command, a </p><p id="p0066" num="0066">quadrature-axis current command, direct-axis inductance and quadrature-axis inductance. </p><p id="p0067" num="0067"> The current adjustment module 107 or the data processor 264 may generate the command in accordance with various examples, which may be applied alternately or cumulatively. Under a first example, the command comprises a quadrature-axis current command. Under a second example, the command comprises a respective increase in a quadrature-axis current command in response to a corresponding increase in the temperature. Under a third example, the command comprises an adjustment to a quadrature-axis current command based on the estimated change in the temperature and a magnetic torque component of the target output torque. </p><p id="p0068" num="0068"> In general, the data processor 264 may execute, determine, calculate or solve any equations or mathematical expressions set forth in this document, or variations thereof that fall within the scope of the claims, in furtherance of providing the command or other compensation for temperature change or magnetic flux strength change in the rotor magnets. 
<!-- EPO <DP n="15"/>-->
 FIG. 3 illustrates one possible exemplary configuration of the rotor magnet temperature estimation module 104, the current adjustment module 107, and the d-q axis current generation manager 109 in greater detail than FIG. 1 . In one </p><p id="p0069" num="0069">configuration, the 3-D (three dimensional) magnetic torque component weighting look-up table 304 receives a torque command 316 (e.g., expressed in percentage) and adjusted voltage-overspeed-ratio 318 as inputs. The 3-D (three dimensional) magnetic torque component weighting look-up table 304 provides an interpolated weighting of the magnetic torque component (e.g.,
<img id="imgf000015_0001" he="6" wi="14" file="imgf000015_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 as an output. The 3-D (three dimensional) magnetic torque look-up table 304 defines a first relationship between a respective combination of the inputted torque command data 316, the inputted adjusted voltage-over-speed ratio data 318 and a corresponding outputted interpolated weighting of the magnetic torque component (e.g.,
<img id="imgf000015_0002" he="6" wi="15" file="imgf000015_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0070" num="0070"> The torque command data 316 and the adjusted voltage-over-speed ratio data 318 is inputted to a 3-D quadrature-axis current (l<sub>q</sub>) look-up table 302, a 3-D direct-axis current (l<sub>d</sub>) look-up table 308, and a 3-D actual flux linkage look-up table 306. The 3-D quadrature-axis current (l<sub>q</sub>) look up table 302 defines a second relationship between a respective combination of the inputted torque command 316, the inputted adjusted voltage over-speed-ratio 318 and a corresponding outputted, interpolated quadrature-axis current command (e.g., i*<sub>q</sub>). The 3-D quadrature-axis current (l<sub>d</sub>) look-up table 308 defines a third relationship between a respective combination of the inputted torque command 316, the inputted adjusted voltage- over-speed ratio 318 and a corresponding outputted, interpolated direct-axis current command (e.g., i*d). The 3-d actual flux linkage look up table defines a fourth relationship between a respective combination of the inputted torque command 316, the inputted adjusted voltage-over-speed ratio 318 and a corresponding outputted interpolated actual flux linkage level (e.g.,
<img id="imgf000015_0003" he="6" wi="17" file="imgf000015_0003.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 or where V<sub>q</sub>*° is an average). </p><p id="p0071" num="0071"> The interpolated actual flux linkage level is inputted to the estimator 314 for magnetic temperature deviation from characterization. The estimator 314 also inputs stored values of magnetic flux strength (e.g., V<sub>q</sub>*° or its average) at ambient temperature and corresponding rotational electrical speed (e.g., ω<sub>β</sub>°) at ambient temperature or at a known reference temperature for the rotor. The stored values of 
<!-- EPO <DP n="16"/>-->
 magnetic flux strength and corresponding rotational speed are stored in data storage device 260 or register of nonvolatile memory, for example. The estimator 314 outputs a change in magnet temperature (e.g., A T<sub>magnet</sub>). The calculator 312 for calculating a q-axis current command adjustment coefficient calculates a q-axis current adjustment based on the received change in magnet temperature and the interpolated weighting of the magnetic torque component. At a multiplier 319 or an auxiliary summer 1 19, the interpolated quadrature-axis (q-axis) current command adjustment coefficient (e.g., J<sub>q</sub>) is multiplied or otherwise combined with the interpolated quadrature axis command (e.g., interpolated iq command or i<sub>q</sub>*) to yield an adjusted quadrature-axis current command (e.g., i*<sub>q</sub>_<sub>a</sub>djusted)-</p><p id="p0072" num="0072">The d-q axis current generation manager 109 stores characterizations of the operating torque curves versus operating rotor speed over a range of operating speeds. The moving average of the q-axis voltage command is recorded in the data storage device 260 during a characterization of the motor 1 17 or defining of the motor 1 17 operating points or operational output torque versus speed curve. The motor 1 17 (e.g., IPMSM) needs to be carefully characterized such that best operating trajectories can be determined at different operating speeds. During the characterization, best control angles are selected for a batch of current magnitudes at a specific motor speed of the motor shaft. In addition to recording output torque at each operating point, quadrature axis (q-axis) terminal voltage command calculated from the controller 1 1 1 should be recorded as well. </p><p id="p0073" num="0073"> In the data processing system 120 or current regulation controller 1 1 1 , the v<sub>q</sub> command is updated in every pulse width modulation (PWM) cycle or at another update interval, as follows: = <sup>G</sup><sub>cq</sub> (<sup>s</sup>)<sup>■</sup> ( <sup>"</sup> '<sub>?</sub> ) + ' ( + &gt; (4) where the first expression (of G<sub>cq</sub>(s)* (i*<sub>q</sub>-i<sub>q</sub>)) is current regulation proportional integral (PI) output and the remaining expression (of u)<sub>e</sub>*L<sub>d</sub>*fd +u)<sub>e</sub>*A<sup>R</sup><sub>f</sub>) relates to feed forward items, which reflect the cross-coupling of dq-axis and back electromotive force (EMF) effect . Because λ" is the reference flux linkage level at ambient (e.g., room) 
<!-- EPO <DP n="17"/>-->
 temperature, the integration item of i<sub>q</sub> proportional integral (PI) regulator will be adjusted to the proper value such that the actual flux linkage level can be </p><p id="p0074" num="0074">compensated for. </p><p id="p0075" num="0075"> Due to the proportional integral (PI) regulation action, the generated quadrature axis voltage ( v<sup>*</sup> ) actually fluctuates slightly around an average value even in steady state condition . In order to accurately reflect the true level of maximum flux linkage per phase { <sub>f</sub> ) during characterization, a moving average ofv<sup>*</sup> , v<sup>*</sup> , the average quadrature axis voltage command, shall be recorded corresponding to each operating point during characterization . </p><p id="p0076" num="0076"> Finally, at a specific operating point, its true flux linkage level during characterization can be calculated as follows: </p><p id="p0077" num="0077">- <sub>f</sub><sup>R</sup> +^η , (5) where x<sub>f</sub><sup>c</sup> is the calculated true flux l inkage level per phase during charactenzation</p><p id="p0078" num="0078">(e.g ., under various known operational conditions and corresponding temperatures), A<sup>R</sup>f is the flux l inkage level per phase at a reference operating condition and at a corresponding reference ambient temperature, v<sup>*c</sup> is the recorded quadrature-axis terminal voltage command moving average during characterization, and ω;<sup>Γ</sup> is the rotational electrical speed of the rotor during characterization . In one configuration, λ° or A<sup>R</sup>f may also include some compensation for inaccurate direct axis inductance</p><p id="p0079" num="0079">(e.g ., L<sub>d</sub> parameter) in the feed forward item (e.g ., AL<sub>d</sub> · <sup>*</sup> ). At the end of the characterization of a particular motor 1 17, three 3-D lookup tables shall be constructed, as illustrated in block 302, block 304, and block 306 of FIG. 3, for example. </p><p id="p0080" num="0080"> The rotor magnet temperature estimation module 104 estimates the runtime magnet temperature deviation from a characterization level (e.g., reference operational conditions). While the motor 1 17 (e.g., IPMSM) is running, the adjusted voltage-over-speed ratio 318 and torque command percentage 316 will determine the <sup>'*</sup> , commands from 3-D lookup tables. Then the q-axis terminal voltage command moving average value can be 
<!-- EPO <DP n="18"/>-->
 continuously calculated during the runtime operation. Therefore, the actual flux linkage level during runtime operation can be calculated as follows: </p><p id="p0081" num="0081">(6) where v ° is the runtime calculated q-axis terminal voltage command moving average value, ω° is the actual motor rotational electrical speed. Because of the DC bus voltage variation, the same set of '<sup>*</sup>, commands could be running at a different motor speed than the corresponding characterization speed, unless compensation for the DC bus voltage variation is provided by the calculation module 1 10 or otherwise by the data processing system 120. </p><p id="p0082" num="0082"> Based on Equation (5) and Equation (6), the flux linkage deviation at runtime away from characterization stage for the same set of d-q axis current commands '<sup>*</sup>, can be calculated as follows: </p><p id="p0083" num="0083">~*o ~*c </p><p id="p0084" num="0084"> Αλ<sub>{</sub> = λ° - <sub>f</sub><sup>c</sup> = ~ (7)</p><p id="p0085" num="0085">Similar to λ° , λ° may also include some compensation for inaccurate L<sub>d</sub> . However, (λ° -λ<sub>{</sub><sup>€</sup> should remove the dependence on L<sub>d</sub> compensation. The corresponding rotor magnet temperature change, AT<sub>magtiel</sub> , can be calculated as follows: </p><p id="p0086" num="0086">Αλ, </p><p id="p0087" num="0087"> AT (8) where ξ is a negative temperature coefficient for permanent magnet material, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at a reference temperature (e.g., ambient temperature) or at reference operating conditions. A positive value of AT<sub>magtiel</sub> means increased magnet temperature, while a negative value of AT<sub>magtiel</sub> means decreased magnet temperature. </p><p id="p0088" num="0088"> In FIG. 3, the magnetic torque component weighting is calculated for producing the 3-D magnetic torque component weighting look-up table, for example. IPMSM characterization procedure determines best operating trajectory over the full 
<!-- EPO <DP n="19"/>-->
 speed range. For a specific set of ( , <sup>*</sup>) command, corresponding magnetic torque component and reluctance torque component can be calculated using given machine parameters. Therefore, the nominal weighting percentage of magnetic torque component out of the total output torque can be calculated as follows: </p><p id="p0089" num="0089">3 </p><p id="p0090" num="0090"> — PP<sup>■</sup> - l </p><p id="p0091" num="0091"> 2 </p><p id="p0092" num="0092"> W<sub>MAG</sub> Ϊ ' (9)</p><p id="p0093" num="0093">-pp - A<sub>f</sub> - i + -pp - (L<sub>d</sub> - L<sub>q</sub> ) - i<sub>d</sub> - i<sub>q</sub> where W°<sub>mag</sub> is the weighting of the magnetic torque component, pp is the number of pole pairs of the motor or machine, i<sub>f</sub> <sup>R</sup> is the maximum flux linkage per phase at reference temperature or operating condition, i<sub>d</sub> <sup>*</sup> is the direct axis current command, i<sub>q</sub> <sup>*</sup> is the quadrature axis current command, L<sub>d</sub> is the direct axis inductance, and L<sub>q</sub> is the quadrature axis inductance. </p><p id="p0094" num="0094"> The calculated magnetic torque component weighing is obtained using nominal machine parameters (e.g., pole pairs and inductances) and will be slightly different from the true magnetic torque weighting during the characterization stage. The difference in the torque weighting could potentially cause some inaccuracy in the torque compensation stage, such that the data processing system 120 may apply additional compensation to the torque weighing based on supplemental or empirical tests. After this offline post-characterization calculation, we can generate the fourth 3-D lookup table as illustrated in block 304 of FIG. 3. </p><p id="p0095" num="0095"> FIG. 4 discloses a method for controlling an electrical motor 1 17 (e.g., an interior permanent magnet motor, induction motor or other alternating current machine) with temperature compensation. The method of FIG. 4 begins in step S200. </p><p id="p0096" num="0096"> In step S200, a rotor magnet temperature estimation module 104 or an electronic data processing system 120 estimates a change in temperature of one or more magnets associated with a rotor of a motor 1 17. For example, the rotor magnet temperature estimation module 104 or an electronic data processing system 120 estimates a change in temperature of one or more magnets based on an operational magnetic flux strength that is compared to a reference magnetic flux 
<!-- EPO <DP n="20"/>-->
 strength determined at a known ambient temperature (e.g., room temperature) for a predetermined operating range (e.g., revolutions per minute and torque load) of the motor 1 17. Ambient temperature could be set to any suitable reference temperature within the operational temperature range, but is preferable set at or near room temperature or at the middle of the operational temperature range (e.g., negative 40 degrees Celsius to 150 degrees Celsius). </p><p id="p0097" num="0097"> The rotor magnetic strength of permanent has a significant negative temperature coefficient, around 0.09% to around 0.12% per degree Celsius (C), with respect to the magnet temperature change. In practice, the magnet temperature can easily vary from negative 40 degrees Celsius at cold start up to 150 degrees Celsius at high speed full torque operation, particularly where the motor 1 17 is used in a vehicle in outdoor weather. Magnet strength could vary up to approximately twenty (20) percent and cause corresponding output torque change on the motor shaft 126 in the absence of the torque compensation provided in accordance with the methods of FIG. 4 through FIG. 6, inclusive. </p><p id="p0098" num="0098"> In one embodiment, the operational magnetic flux strength is derived from an operational quadrature-axis voltage command and the reference magnetic flux strength is derived from a reference quadrature-axis voltage command. The operating range (e.g., predetermined operating range) of the motor 1 17 may be determined by or expressed as a function of one or more of the following factors: the machine operating speed (e.g., rotational motor shaft 126 speed), the torque load on the motor 1 17 (e.g., as indicated by current magnitude or current draw), the motor 1 17 operating duration (e.g., continuous versus intermittent operation), and the coolant flow rate and temperature (if applicable). </p><p id="p0099" num="0099"> In an alternate embodiment, the data processing system 120 determines whether the motor 1 17 is operating at a motor shaft speed below a lower threshold. If the motor 1 17 is operating at a motor shaft speed below the lower threshold, the data processing system 120 may supplement the determination of rotor magnet temperature with a stator winding temperature sensor 1 15, a coolant temperature sensor 1 15, both. </p><p id="p0100" num="0100"> In step S202, the rotor magnet temperature estimation module 104, or the d-q 
<!-- EPO <DP n="21"/>-->
 axis current adjustment module 107, or the data processing system 120 establishes a relationship between the estimated change in the temperature and a magnetic torque component of a target output torque of the motor 1 17 consistent with the predetermined operating range. In accordance with a first example for executing step S202, the establishing of the relationship comprises determining the magnetic torque component of the target output torque as a function of the reference magnetic flux strength, a direct-axis current command, a quadrature-axis current command, direct- axis inductance and quadrature-axis inductance. In accordance with a second example for executing step S202, the relationship is determined in accordance with the following equation: </p><p id="p0101" num="0101"> j <sub>=</sub> I <sub>=</sub> I </p><p id="p0102" num="0102"> q W " m<sup>c</sup>ag - ( Vl-<sup>1</sup> + AT magnet - £ ¾ ) I + ( Vl-<sup>1</sup> - W " m<sup>c</sup>ag )i <sub>r</sub>θ ^ ^ Δλ, <sub>+</sub> ^ _ y <sub>r</sub>C ^ ' </p><p id="p0103" num="0103"> s<sup> s</sup> </p><p id="p0104" num="0104"> f where j<sub>q</sub> is the adjustment coefficient for q-axis current command, w^<sub>ag</sub> is magnetic torque weighting, AT<sub>magtiel</sub> is calculated magnet temperature change, ξ is a negative temperature coefficient for permanent magnet material of the rotor magnets, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at a reference temperature (e.g., ambient temperature) or at reference operating conditions. The above equation may assume the inductance difference between direct-axis inductance and quadrature-axis inductance (L<sub>d</sub> - L<sub>q</sub> ) has negligible change with slight variation in d-q axis current commands (i<sub>d</sub> , i<sub>q</sub> ) . </p><p id="p0105" num="0105"> In step S204, the d-q axis current adjustment module 107, or the d-q axis current generation manager 109, or the summer 1 19, or the data processing system 120 adjusts a command (e.g., for the quadrature axis current) for the motor 1 17 to compensate for shaft 126 torque variation associated with the estimated change in the temperature in conformance with the established relationship. Step S204 may be carried out in accordance with various techniques that may be applied alternately or cumulatively. In accordance with a first technique, the adjusting of the command further comprises adjusting a quadrature-axis current command. In accordance with a second technique, the command is determine in accordance with the following 
<!-- EPO <DP n="22"/>-->
 equations: </p><p id="p0106" num="0106">.* </p><p id="p0107" num="0107"> i - J„ and </p><p id="p0108" num="0108">W<sup>C</sup> - (1 + ΔΓ <sup>•</sup>i<sup>)</sup> + (i-0</p><p id="p0109" num="0109"><img id="imgf000022_0001" he="12" wi="40" file="imgf000022_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/></p><p id="p0110" num="0110">where i*<sub>q</sub>_<sub>a</sub>djusted is the product of the quadratic axis current command and the J<sub>q</sub> adjustment coefficient, j<sub>q</sub> is the adjustment coefficient for the q-axis current command, AT<sub>magtiel</sub> is calculated magnet temperature change, ξ is a negative temperature coefficient for permanent magnet material of the rotor magnets, w^<sub>ag</sub> is magnetic torque weighting, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at a reference temperature (e.g., ambient temperature) or at reference operating conditions. </p><p id="p0111" num="0111"> The above equation assumes the inductance difference (L<sub>d</sub> - L<sub>q</sub> ) has negligible change with slight variation in (i<sub>d</sub> , i<sub>q</sub> ) commands. In one embodiment, the adjustment coefficient (J<sub>q</sub>) facilitates the maintenance of an output torque that is within </p><p id="p0112" num="0112">approximately five percent (5 %) of the torque command throughout the whole operating range of the motor 1 17. Without the above proper adjustments of controller current commands of the data processing system 120, if the magnet strength becomes weaker from an increase in magnet temperature, the output torque and operating efficiency of the motor 1 17 would drop. Similarly, when the magnet strength becomes stronger from a decrease in magnet temperature, the output torque of the motor 1 17 would increase to overuse terminal voltage or tend to cause instability in current regulation (e.g., of the current regulation controller 1 1 1 ). </p><p id="p0113" num="0113"> The method of FIG. 5 is similar to the method of FIG. 4, except the method of FIG. 5 replaces step S204 with step S206. Like reference numbers in FIG. 4 and FIG. 5 indicate like procedures or steps. </p><p id="p0114" num="0114"> In step S206, the d-q axis current adjustment module 107, or the d-q axis current generation manager 109, or the summer 1 19, the multiplier 310, or the data processing system 120 adjusts a command (e.g., for the quadrature axis current) for the motor 1 17 to compensate for shaft 126 torque variation associated with the 
<!-- EPO <DP n="23"/>-->
 estimated change in the temperature in conformance with the established relationship, wherein the adjusting of the command comprises increasing a quadrature-axis current command in response to an increase in temperature of the magnets of the rotor of the motor 1 17. </p><p id="p0115" num="0115"> The method of FIG. 6 is similar to the method of FIG. 4, except the method of FIG. 6 replaces step S204 with step S208. Like reference numbers in FIG. 4 and FIG. 5 indicate like procedures or steps. </p><p id="p0116" num="0116"> In step S208, the d-q axis current adjustment module 107, or the d-q axis current generation manager 109, or the summer 1 19, or the data processing system 120 adjusts a command (e.g., for the quadrature axis current) for the motor 1 17 to compensate for shaft 126 torque variation associated with the estimated change in the temperature in conformance with the established relationship, wherein the adjusting of the command comprises adjusting a quadrature-axis current command based on the estimated change in the temperature and a magnetic torque </p><p id="p0117" num="0117">component of the target output command. Step S208 may be executed in </p><p id="p0118" num="0118">accordance with various procedures that may be applied alternately or cumulatively. Under a first procedure, the estimated change in the temperature is determined in accordance with the following equation : 
<img id="imgf000023_0001" he="12" wi="13" file="imgf000023_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0119" num="0119">where AT<sub>magtiel</sub> is the change in magnet temperature, with positive values o†AT<sub>magtiel</sub> indicate an increase in temperature and negative values of AT<sub>magtiel</sub> indicate a decrease in temperature, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at a reference temperature (e.g., ambient temperature) or at reference operating conditions, and ^ is a negative temperature coefficient for permanent magnet material. </p><p id="p0120" num="0120"> Under a second procedure, the magnetic torque component is determined in accordance with the following equation : 
<!-- EPO <DP n="24"/>-->
 
<img id="imgf000024_0001" he="18" wi="55" file="imgf000024_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="yes"/>
 </p><p id="p0121" num="0121">where V <sub>maq</sub> is nominal weighting percentage of the magnetic torque component of the total output torque, pp are the number of pole pairs of the motor, x<sub>f</sub> <sup>R</sup> is the maximum flux linkage per phase at reference temperature or operating condition, i<sub>d</sub> <sup>*</sup> is the respective direct axis current command, i<sub>q</sub> <sup>*</sup> is the corresponding quadrature axis current command, L<sub>d</sub> is the direct axis inductance, and L<sub>q</sub> is the quadrature axis inductance. In the above equation, (/<sup>*</sup> ) is a specific set or corresponding pair of d-q axis current commands (e.g., for a pulse cycle of the PWM signal). </p><p id="p0122" num="0122"> The method and system disclosed herein is well suited for achieving uniform torque of the motor 1 17 within a suitable tolerance (e.g., plus or minus five percent) of a target torque, regardless of variation in the temperature of the rotor magnets. For example, the temperature of the rotor magnets may vary because of a change in ambient temperature from weather conditions or because of the duty-cycle (e.g., continuous versus intermittent) of a vehicle or machine on which the motor operates. Further, the method and system disclosed herein is well-suited for improving machine operating efficiency under sundry magnet strength conditions. </p><p id="p0123" num="0123"> Having described the preferred embodiment, it will become apparent that various modifications can be made without departing from the scope of the invention as defined in the accompanying claims. 
</p></description><claims mxw-id="PCLM44726250" ref-ucid="WO-2012115897-A2" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="25"/>-->The following is claimed: </claim-statement><claim id="clm-0001" num="1"><claim-text>1 . A method for controlling an electrical motor comprising a rotor with associated magnets and a stator, the method comprising: </claim-text><claim-text> estimating a change in temperature of the magnets associated with the rotor of the motor based on an operational magnetic flux strength that is compared to a reference magnetic flux strength determined at a known ambient temperature and for a predetermined operating range of the motor; </claim-text><claim-text> establishing a relationship between the estimated change in the temperature and a magnetic torque component of a target output torque of the motor consistent with the predetermined operating range; and </claim-text><claim-text> adjusting a command for the motor to compensate for shaft torque variation associated with the estimated change in the temperature in conformance with the established relationship. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. The method according to claim 1 wherein the operational magnetic flux strength is derived from an operational quadrature-axis voltage command and wherein the reference magnetic flex strength is derived from a reference quadrature-axis voltage command. </claim-text></claim><claim id="clm-0003" num="3"><claim-text> 3. The method according to claim 1 wherein the establishing of the relationship comprises determining the magnetic torque component of the target output torque as a function of the reference magnetic flux strength, a direct-axis current command, a quadrature-axis current command, direct-axis inductance and quadrature-axis inductance. <!-- EPO <DP n="26"/>--> </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. The method according to claim 1 wherein the adjusting of the command further comprises adjusting a quadrature-axis current command. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. The method according to claim 1 wherein the adjusting of the command further comprises increasing a quadrature-axis current command in response to an increase in the temperature. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. The method according to claim 1 wherein the adjusting of the command further comprises adjusting a quadrature-axis current command based on the estimated change in the temperature and a magnetic torque component of the target output torque. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. The method according to claim 6 wherein the change in the estimated change in the temperature is determined in accordance with the following equation: « g where AT<sub>magtiel</sub> is the change in magnet temperature or the magnets, with positive values o†AT<sub>magtiel</sub> indicate an increase in temperature and negative values of AT<sub>magtiel</sub> indicate a decrease in temperature, ξ is a negative temperature coefficient for the magnets of the rotor, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at the known ambient temperature and for a predetermined operating range of the motor. <!-- EPO <DP n="27"/>--> </claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. The method according to claim 6 wherein the magnetic torque component is determined in accordance with the following equation: </claim-text><claim-text>3 </claim-text><claim-text> — PP<sup>■</sup> A - l </claim-text><claim-text> W m<sup>c</sup>ag = <sup>2</sup> ' ' </claim-text><claim-text> -pp -A<sub>f</sub> - i + -pp - (L<sub>d</sub> - L<sub>q</sub> ) - i<sub>d</sub> - i<sub>q</sub> where W°<sub>mag</sub> is a weighting of the magnetic torque component, pp is the number of pole pairs of the motor, i<sub>f</sub> <sup>R</sup> is a maximum flux linkage per phase at the known ambient temperature under the predetermined operating range, i<sub>d</sub> <sup>*</sup> is a respective direct axis current command, i<sub>q</sub> <sup>*</sup> is a corresponding quadrature axis current </claim-text><claim-text>command, L<sub>d</sub> is the direct axis inductance, and L<sub>q</sub> is the quadrature axis </claim-text><claim-text>inductance. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. The method according to claim 1 wherein the relationship is determined in accordance with the following equation : </claim-text><claim-text> j <sub>=</sub> I <sub>=</sub> I </claim-text><claim-text> q W<sup>c</sup> - (l + AT -£) + (l - W<sup>c</sup> ) <sub>r</sub> Αλ<sup>,</sup> <sub>r</sub> ' </claim-text><claim-text> m<sup>ag magnet ς&gt; mag )</sup> W^ - (l + ^-) + (l - W^) where j<sub>q</sub> is an adjustment coefficient for q-axis current command, w^<sub>ag</sub> is a magnetic torque weighting, AT<sub>magnet</sub> is calculated magnet temperature change, ξ is a negative temperature coefficient for permanent magnet material of the magnets, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at the known ambient temperature under the predetermined operating range. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. The method according to claim 1 wherein the command is determined in <!-- EPO <DP n="28"/>--> accordance with the following equations: i = i - J„ and </claim-text><claim-text> j <sub>=</sub> I <sub>=</sub> I </claim-text><claim-text> q W " m<sup>c</sup>ag - ( Vl-<sup>1</sup> + AT magnet - £ ¾ ) I + ( Vl-<sup>1</sup> - W " m<sup>c</sup>ag )i <sub>r</sub>θ ^ ^ Δλ<sup>,</sup> <sub>+</sub> ^ _ y <sub>r</sub>C ^ ' </claim-text><claim-text> s<sup> s</sup> </claim-text><claim-text> f </claim-text><claim-text>where i*<sub>q</sub>_<sub>a</sub>djusted is a product of the quadratic axis current command and the J<sub>q</sub> adjustment coefficient, j<sub>q</sub> is the adjustment coefficient for the q-axis current command, AT<sub>magtiel</sub> is calculated magnet temperature change, ξ is a negative temperature coefficient for permanent magnet material of the magnets, </claim-text><claim-text>w^<sub>ag</sub> is magnetic torque weighting, AA<sub>f</sub> is a change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at the known ambient temperature under the predetermined operating range. </claim-text></claim><claim id="clm-0011" num="11"><claim-text>1 1 . A system for controlling an electrical motor, where the motor comprises a rotor with associated magnets and a stator, the system comprising: a data processor for estimating a change in temperature of the magnets associated with the rotor of the motor based on an operational magnetic flux strength that is compared to a reference magnetic flux strength determined at a known ambient temperature and for a predetermined operating range of the motor; a temperature estimation module for establishing a relationship between the estimated change in the temperature and a magnetic torque component of a target output torque of the motor consistent with the predetermined operating range; and a current adjustment module for adjusting a command for the motor to compensate for shaft torque variation associated with the estimated change in the temperature in conformance with the established relationship. <!-- EPO <DP n="29"/>--> </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. The system according to claim 1 1 wherein the data processor is arranged to derive the operational magnetic flux strength from an operational quadrature-axis voltage command and wherein the data processor is arranged to derive the reference magnetic flex strength from a reference quadrature-axis voltage command.</claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. The system according to claim 1 1 wherein the data processor is adapted to execute software instructions of the temperature estimation module to establish the relationship, where the relationship comprises the magnetic torque component of the target output torque as a function of the reference magnetic flux strength, a direct- axis current command, a quadrature-axis current command, direct-axis inductance and quadrature-axis inductance. </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. The system according to claim 1 1 wherein the command comprises a </claim-text><claim-text>quadrature-axis current command. </claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. The system according to claim 1 1 wherein the command comprises a respective increase in a quadrature-axis current command in response to a corresponding increase in the temperature. </claim-text></claim><claim id="clm-0016" num="16"><claim-text>16. The system according to claim 1 1 wherein the command comprises an adjustment to a quadrature-axis current command based on the estimated change in the temperature and a magnetic torque component of the target output torque. </claim-text></claim><claim id="clm-0017" num="17"><claim-text>17. The system according to claim 16 wherein the change in the estimated change <!-- EPO <DP n="30"/>--> in the temperature is determined by the data processor in accordance with the following equation: <img id="imgf000030_0001" he="12" wi="13" file="imgf000030_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text>where AT<sub>magtiel</sub> is the change in magnet temperature or the magnets, with positive values o†AT<sub>magtiel</sub> indicate an increase in temperature and negative values of AT<sub>magtiel</sub> indicate a decrease in temperature, ξ is a negative temperature coefficient for the magnets of the rotor, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at the known ambient temperature and for a predetermined operating range of the motor. </claim-text></claim><claim id="clm-0018" num="18"><claim-text>18. The system according to claim 16 wherein the magnetic torque component is determined by the data processor in accordance with the following equation: <img id="imgf000030_0002" he="18" wi="62" file="imgf000030_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text>where W°<sub>mag</sub> is a weighting of the magnetic torque component, pp is the number of pole pairs of the motor, i<sub>f</sub> <sup>R</sup> is a maximum flux linkage per phase at the known ambient temperature under the predetermined operating range, i<sub>d</sub> <sup>*</sup> is a respective direct axis current command, i<sub>q</sub> <sup>*</sup> is a corresponding quadrature axis current </claim-text><claim-text>command , L<sub>d</sub> is the direct axis inductance, and L<sub>q</sub> is the quadrature axis </claim-text><claim-text>inductance. <!-- EPO <DP n="31"/>--> </claim-text></claim><claim id="clm-0019" num="19"><claim-text>19. The system according to claim 1 1 wherein the relationship is determined by the data processor in accordance with the following equation: j <sub>=</sub> I <sub>=</sub> I </claim-text><claim-text> q W<sup>c</sup> - (l + AT - £) + (l - W<sup>c</sup> ) <sub>r</sub> Αλ, <sub>r</sub> ' </claim-text><claim-text> s<sup> s</sup> where j<sub>q</sub> is an adjustment coefficient for q-axis current command, w^<sub>ag</sub> is a magnetic torque weighting, AT<sub>magtiel</sub> is calculated magnet temperature change, ξ is a negative temperature coefficient for permanent magnet material of the magnets, AA<sub>f</sub> is the change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at the known ambient temperature under the predetermined operating range. </claim-text></claim><claim id="clm-0020" num="20"><claim-text>20. The system according to claim 1 1 wherein the command is determined by the data processor in accordance with the following equations: </claim-text><claim-text>= ;<sup>*</sup> - J and </claim-text><claim-text>W<sup>c</sup> - (l + AT - £) + (l - W<sup>c</sup> ) <sub>r</sub> Αλ, <sub>r</sub> where i*<sub>q</sub>_<sub>a</sub>djusted is a product of the quadratic axis current command and the J<sub>q</sub> adjustment coefficient, j<sub>q</sub> is the adjustment coefficient for the q-axis current command, AT<sub>magtiel</sub> is calculated magnet temperature change, ξ is a negative temperature coefficient for permanent magnet material of the magnets, </claim-text><claim-text>w^<sub>ag</sub> is magnetic torque weighting, AA<sub>f</sub> is a change in magnet flux per phase, A<sub>f</sub><sup>R</sup> is the magnetic flux per phase at the known ambient temperature under the predetermined operating range. </claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
