<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680585-A2" country="EP" doc-number="2680585" kind="A2" date="20140101" family-id="45438569" file-reference-id="315070" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549103" ucid="EP-2680585-A2"><document-id><country>EP</country><doc-number>2680585</doc-number><kind>A2</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13004485-A" is-representative="NO"><document-id mxw-id="PAPP154823026" load-source="docdb" format="epo"><country>EP</country><doc-number>13004485</doc-number><kind>A</kind><date>20110708</date><lang>EN</lang></document-id><document-id mxw-id="PAPP168045523" load-source="docdb" format="original"><country>EP</country><doc-number>13004485.2</doc-number><date>20110708</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140452568" ucid="EP-11733763-A" linkage-type="3" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>11733763</doc-number><kind>A</kind><date>20110708</date></document-id></priority-claim><priority-claim mxw-id="PPC140446531" ucid="US-201113178427-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201113178427</doc-number><kind>A</kind><date>20110707</date></document-id></priority-claim><priority-claim mxw-id="PPC140446298" ucid="US-201113178434-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201113178434</doc-number><kind>A</kind><date>20110707</date></document-id></priority-claim><priority-claim mxw-id="PPC140452463" ucid="US-201113178438-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201113178438</doc-number><kind>A</kind><date>20110707</date></document-id></priority-claim><priority-claim mxw-id="PPC140453297" ucid="US-36312710-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>36312710</doc-number><kind>P</kind><date>20100709</date></document-id></priority-claim><priority-claim mxw-id="PPC140453925" ucid="US-37457310-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>37457310</doc-number><kind>P</kind><date>20100817</date></document-id></priority-claim><priority-claim mxw-id="PPC140453776" ucid="US-37742010-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>37742010</doc-number><kind>P</kind><date>20100826</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2036689779" load-source="docdb">H04N  19/96        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036690093" load-source="docdb">H04N  19/593       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036690281" load-source="docdb">H04N  19/61        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036690360" load-source="docdb">H04N  19/159       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036690367" load-source="docdb">H04N  19/60        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036691060" load-source="docdb">H04N  19/46        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036691419" load-source="docdb">H04N  19/85        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036692413" load-source="docdb">H04N  19/11        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036693712" load-source="docdb">H04N  19/13        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036694051" load-source="docdb">H04N  19/122       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036696101" load-source="docdb">H04N  19/132       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036696139" load-source="docdb">H04N  19/157       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036697362" load-source="docdb">H04N  19/14        20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036698140" load-source="docdb">H04N  19/129       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036698707" load-source="docdb">H04N  19/194       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036698783" load-source="docdb">H04N  19/176       20140101ALI20150714BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2036701032" load-source="docdb">H04N  19/196       20140101AFI20150714BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1772448951" load-source="docdb" scheme="CPC">H04N  19/61        20141101 FI20170818BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1772448952" load-source="docdb" scheme="CPC">H04N  19/194       20141101 LI20170818BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073182093" load-source="docdb" scheme="CPC">H04N  19/13        20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073182514" load-source="docdb" scheme="CPC">H04N  19/14        20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073182917" load-source="docdb" scheme="CPC">H04N  19/132       20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073183040" load-source="docdb" scheme="CPC">H04N  19/157       20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073185670" load-source="docdb" scheme="CPC">H04N  19/46        20130101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073187593" load-source="docdb" scheme="CPC">H04N  19/96        20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073187743" load-source="docdb" scheme="CPC">H04N  19/122       20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073188154" load-source="docdb" scheme="CPC">H04N  19/11        20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073188201" load-source="docdb" scheme="CPC">H04N  19/196       20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073188332" load-source="docdb" scheme="CPC">H04N  19/176       20130101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073188703" load-source="docdb" scheme="CPC">H04N  19/159       20130101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073189044" load-source="docdb" scheme="CPC">H04N  19/60        20141101 LA20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073189421" load-source="docdb" scheme="CPC">H04N  19/85        20141101 LA20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073189559" load-source="docdb" scheme="CPC">H04N  19/593       20141101 LI20150414BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2073189671" load-source="docdb" scheme="CPC">H04N  19/129       20141101 LI20150414BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132179793" lang="DE" load-source="patent-office">Signalisierung von ausgewählter direktionaler Umwandlung zur Videokodierung</invention-title><invention-title mxw-id="PT132179794" lang="EN" load-source="patent-office">Signaling selected directional transform for video coding</invention-title><invention-title mxw-id="PT132179795" lang="FR" load-source="patent-office">Signalisation de transformation directionnelle sélectionnée pour codage vidéo</invention-title><citations><non-patent-citations><nplcit><text>None</text><sources><source mxw-id="PNPL45130724" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><related-documents><relation type="division"><child-doc ucid="EP-13004485-A"><document-id load-source="patent-office" format="epo"><country>EP</country><doc-number>13004485</doc-number><kind>A</kind><date>20110708</date></document-id></child-doc><parent-doc ucid="EP-11733763.4"><document-id load-source="patent-office" format="epo"><country>EP</country><doc-number>11733763.4</doc-number><date>20110708</date></document-id><parent-grant-document ucid="EP-2591600-B1"><document-id><country>EP</country><doc-number>2591600</doc-number><kind>B1</kind><date>20141112</date></document-id></parent-grant-document></parent-doc></relation></related-documents><parties><applicants><applicant mxw-id="PPAR918138530" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>QUALCOMM INC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR918159255" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>QUALCOMM INCORPORATED</last-name></addressbook></applicant><applicant mxw-id="PPAR918984083" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Qualcomm Incorporated</last-name><iid>100204376</iid><address><street>5775 Morehouse Drive</street><city>San Diego, CA 92121-1714</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918170551" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>KARCZEWICZ MARTA</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918154325" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>KARCZEWICZ, MARTA</last-name></addressbook></inventor><inventor mxw-id="PPAR918989852" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>KARCZEWICZ, MARTA</last-name><address><street>5775 Morehouse Drive,</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918137304" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>COBAN MUHAMMED ZEYD</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918152782" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>COBAN, MUHAMMED, ZEYD</last-name></addressbook></inventor><inventor mxw-id="PPAR918981537" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>COBAN, MUHAMMED, ZEYD</last-name><address><street>5775 Morehouse Drive,</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918132645" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>CHEN PEISONG</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918161404" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>CHEN, PEISONG</last-name></addressbook></inventor><inventor mxw-id="PPAR918988118" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>CHEN, PEISONG</last-name><address><street>5775 Morehouse Drive,</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918165284" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>CHUANG HSIAO-CHIANG</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918148678" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>CHUANG, HSIAO-CHIANG</last-name></addressbook></inventor><inventor mxw-id="PPAR918987666" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>CHUANG, HSIAO-CHIANG</last-name><address><street>5775 Morehouse Drive,</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918133415" load-source="docdb" sequence="5" format="epo"><addressbook><last-name>JOSHI RAJAN LAXMAN</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918169574" load-source="docdb" sequence="5" format="intermediate"><addressbook><last-name>JOSHI, RAJAN, LAXMAN</last-name></addressbook></inventor><inventor mxw-id="PPAR918994188" load-source="patent-office" sequence="5" format="original"><addressbook><last-name>JOSHI, RAJAN, LAXMAN</last-name><address><street>5775 Morehouse Drive,</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918984884" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Wimmer, Hubert</last-name><iid>101225389</iid><address><street>Wagner &amp; Geyer Gewürzmühlstrasse 5</street><city>80538 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548846075" load-source="docdb">AL</country><country mxw-id="DS548841171" load-source="docdb">AT</country><country mxw-id="DS548846076" load-source="docdb">BE</country><country mxw-id="DS548842010" load-source="docdb">BG</country><country mxw-id="DS548834939" load-source="docdb">CH</country><country mxw-id="DS548841143" load-source="docdb">CY</country><country mxw-id="DS548841172" load-source="docdb">CZ</country><country mxw-id="DS548801295" load-source="docdb">DE</country><country mxw-id="DS548841144" load-source="docdb">DK</country><country mxw-id="DS548841145" load-source="docdb">EE</country><country mxw-id="DS548802168" load-source="docdb">ES</country><country mxw-id="DS548842011" load-source="docdb">FI</country><country mxw-id="DS548842012" load-source="docdb">FR</country><country mxw-id="DS548846077" load-source="docdb">GB</country><country mxw-id="DS548842194" load-source="docdb">GR</country><country mxw-id="DS548846078" load-source="docdb">HR</country><country mxw-id="DS548841173" load-source="docdb">HU</country><country mxw-id="DS548834940" load-source="docdb">IE</country><country mxw-id="DS548846079" load-source="docdb">IS</country><country mxw-id="DS548842013" load-source="docdb">IT</country><country mxw-id="DS548842195" load-source="docdb">LI</country><country mxw-id="DS548801296" load-source="docdb">LT</country><country mxw-id="DS548841174" load-source="docdb">LU</country><country mxw-id="DS548801297" load-source="docdb">LV</country><country mxw-id="DS548801298" load-source="docdb">MC</country><country mxw-id="DS548842447" load-source="docdb">MK</country><country mxw-id="DS548842448" load-source="docdb">MT</country><country mxw-id="DS548802169" load-source="docdb">NL</country><country mxw-id="DS548842014" load-source="docdb">NO</country><country mxw-id="DS548802170" load-source="docdb">PL</country><country mxw-id="DS548834941" load-source="docdb">PT</country><country mxw-id="DS548802171" load-source="docdb">RO</country><country mxw-id="DS548834942" load-source="docdb">RS</country><country mxw-id="DS548802172" load-source="docdb">SE</country><country mxw-id="DS548834943" load-source="docdb">SI</country><country mxw-id="DS548842449" load-source="docdb">SK</country><country mxw-id="DS548842450" load-source="docdb">SM</country><country mxw-id="DS548842196" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669774" lang="EN" load-source="patent-office"><p id="pa01" num="0001">In one example, a method of decoding video data, the method comprising: receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode; determining whether an edge is present in the block of video data;after determining that the edge is present in the block:determining an angle for the edge; and based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transforming the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge; and decoding the inverse transformed block.
<img id="iaf01" file="imgaf001.tif" wi="66" he="94" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499147" lang="EN" source="EPO" load-source="docdb"><p>In one example, a method of decoding video data, the method comprising: receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode; determining whether an edge is present in the block of video data;after determining that the edge is present in the block:determining an angle for the edge; and based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transforming the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge; and decoding the inverse transformed block.</p></abstract><description mxw-id="PDES63955204" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">This disclosure relates to video coding.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">Digital video capabilities can be incorporated into a wide range of devices, including digital televisions, digital direct broadcast systems, wireless broadcast systems, personal digital assistants (PDAs), laptop or desktop computers, digital cameras, digital recording devices, digital media players, video gaming devices, video game consoles, cellular or satellite radio telephones, video teleconferencing devices, and the like. Digital video devices implement video compression techniques, such as those described in the standards defined by MPEG-2, MPEG-4, ITU-T H.263, ITU-T H.264/MPEG-4, Part 10, Advanced Video Coding (AVC), the upcoming High Efficiency Video Coding (HEVC) standard (also referred to as H.265), and extensions of such standards, to transmit and receive digital video information more efficiently.</p><p id="p0003" num="0003">Video compression techniques perform spatial prediction and/or temporal prediction to reduce or remove redundancy inherent in video sequences. For block-based video coding, a video frame or slice may be partitioned into macroblocks. Each macroblock can be further partitioned. Macroblocks in an intra-coded (I) frame or slice are encoded using spatial prediction with respect to neighboring macroblocks. Macroblocks in an inter-coded (P or B) frame or slice may use spatial prediction with respect to neighboring macroblocks in the same frame or slice or temporal prediction with respect to other reference frames.</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0004" num="0004">In general, this disclosure describes techniques for coding video data. This disclosure describes techniques for transforming residual video data and scanning transform coefficients during a video coding process. In general, blocks of a picture to be coded may be intra-mode encoded (e.g., encoded relative to other blocks of the same picture) or inter-mode encoded (e.g., encoded relative to blocks of a previously coded picture). In either case, a video encoder forms predictive data and residual data. The<!-- EPO <DP n="2"> --> video encoder may transform the residual value, using one or more various transforms, such as discrete sine transforms, discrete cosine transforms, directional transforms and/or rotational transforms. The video encoder may be configured to select one or more transforms to apply based on certain criteria such as, for example, a prediction direction used when intra-mode encoding the block.</p><p id="p0005" num="0005">The video encoder may calculate transform coefficients by transforming residual data for a block of video data, where the residual data corresponds to pixel difference values between an original block and a predicted block. The transform coefficients may correspond to a two-dimensional matrix having the same size (in terms of the number of coefficients) as the block that was transformed. The video encoder may scan the transform coefficients to convert the two-dimensional matrix into a one-dimensional array, thereby serializing the transform coefficients. In accordance with the techniques of this disclosure, the video encoder may apply a predetermined scan pattern selected based on the transform(s) used to transform the block. In some examples, in accordance with the techniques of this disclosure, the video encoder may apply an adaptive scan pattern, rather than a predetermined scan pattern, where the video encoder may periodically update the adaptive scan pattern. The scan pattern may be based on the transform(s) and/or intra-prediction mode used to predict the block, in some examples.</p><p id="p0006" num="0006">In one example, a method of encoding video data includes calculating a residual block for a block of video data based on a predicted block formed using an intra-prediction mode, and transforming the residual block using a transform mapped from the intra-prediction mode.</p><p id="p0007" num="0007">In another example, an apparatus for encoding video data, the apparatus comprising a video encoder configured to calculate a residual block for a block of video data based on a predicted block formed using an intra-prediction mode, and transform the residual block using a transform mapped from the intra-prediction mode.</p><p id="p0008" num="0008">In another example, an apparatus for encoding video data includes means for calculating a residual block for a block of video data based on a predicted block formed using an intra-prediction mode, and means for transforming the residual block using a transform mapped from the intra-prediction mode.</p><p id="p0009" num="0009">In another example, a computer program product includes a computer-readable storage medium having stored thereon instructions that, when executed, cause a processor of a device for encoding video data to calculate a residual block for a block of<!-- EPO <DP n="3"> --> video data based on a predicted block formed using an intra-prediction mode, and transform the residual block using a transform mapped from the intra-prediction mode.</p><p id="p0010" num="0010">In another example, a method of decoding video data includes determining an intra-prediction mode to be used to predict a block of video data, and inverse transforming transformed residual data of the block using an inverse transform mapped from the intra-prediction mode.</p><p id="p0011" num="0011">In another example, an apparatus for decoding video data includes a video decoder configured to determine an intra-prediction mode to be used to predict a block of video data, and to inverse transform transformed residual data of the block using an inverse transform mapped from the intra-prediction mode.</p><p id="p0012" num="0012">In another example, an apparatus for decoding video data includes means for determining an intra-prediction mode to be used to predict a block of video data, and means for inverse transforming transformed residual data of the block using an inverse transform mapped from the intra-prediction mode.</p><p id="p0013" num="0013">In another example, a computer program product comprising a computer-readable storage medium having stored thereon instructions that, when executed, cause a processor of a device for decoding video data to determine an intra-prediction mode to be used to predict a block of video data, and inverse transform transformed residual data of the block using an inverse transform mapped from the intra-prediction mode.</p><p id="p0014" num="0014">In another example, a method of encoding video data includes receiving an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of video data, determining a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, determining a directional transform to which the second intra-prediction mode is mapped, and applying the directional transform to residual data of the block.</p><p id="p0015" num="0015">In another example, an apparatus for encoding video data includes a video encoder configured to receive an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of video data, determine a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, determine a directional transform to which the second intra-prediction mode is mapped, and apply the directional transform to residual data of the block.<!-- EPO <DP n="4"> --></p><p id="p0016" num="0016">In another example, an apparatus for encoding video data includes means for receiving an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of video data, means for determining a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, means for determining a directional transform to which the second intra-prediction mode is mapped, and means for applying the directional transform to residual data of the block.</p><p id="p0017" num="0017">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for encoding video data to receive an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of video data, determine a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, determine a directional transform to which the second intra-prediction mode is mapped, and apply the directional transform to residual data of the block.</p><p id="p0018" num="0018">In another example, a method of decoding video data includes receiving an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of encoded video data, determining a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, determining an inverse directional transform to which the second intra-prediction mode is mapped, and applying the inverse directional transform to transformed residual data of the block.</p><p id="p0019" num="0019">In another example, an apparatus for decoding video data includes a video decoder configured to receive an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of encoded video data, determine a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, determine an inverse directional transform to which the second intra-prediction mode is mapped, and apply the inverse directional transform to transformed residual data of the block.<!-- EPO <DP n="5"> --></p><p id="p0020" num="0020">In another example, an apparatus for decoding video data includes means for receiving an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of encoded video data, means for determining a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, means for determining an inverse directional transform to which the second intra-prediction mode is mapped, and means for applying the inverse directional transform to transformed residual data of the block.</p><p id="p0021" num="0021">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for decoding video data to receive an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of encoded video data, determine a second intra-prediction mode from a second set of intra-prediction modes, smaller than the first set of intra-prediction modes, to which the first intra-prediction mode is mapped, determine an inverse directional transform to which the second intra-prediction mode is mapped, and apply the inverse directional transform to transformed residual data of the block.</p><p id="p0022" num="0022">In another example, a method of encoding video data includes selecting an intra-prediction mode to use to encode a block of video data, and determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode. When the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, the method includes selecting one of the multiple possible transforms, transforming the sub-block using the selected one of the multiple possible transforms, and providing an indication of the selected one of the multiple possible transforms for the size of the block.</p><p id="p0023" num="0023">In another example, an apparatus for encoding video data includes a video encoder configured to select an intra-prediction mode to use to encode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, select one of the multiple possible transforms, transform the sub-block<!-- EPO <DP n="6"> --> using the selected one of the multiple possible transforms, and provide an indication of the selected one of the multiple possible transforms for the size of the block.</p><p id="p0024" num="0024">In another example, an apparatus for encoding video data includes means for selecting an intra-prediction mode to use to encode a block of video data, means for determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, means for selecting one of the multiple possible transforms, means for transforming the sub-block using the selected one of the multiple possible transforms, and means for providing an indication of the selected one of the multiple possible transforms for the size of the block.</p><p id="p0025" num="0025">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for encoding video data to select an intra-prediction mode to use to encode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, select one of the multiple possible transforms, transform the sub-block using the selected one of the multiple possible transforms, and provide an indication of the selected one of the multiple possible transforms for the size of the block.</p><p id="p0026" num="0026">In another example, a method of decoding video data includes receiving a first indication of an intra-prediction mode to use to decode a block of video data, determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, receiving a second indication of one of the multiple possible inverse transforms, and inverse transforming the sub-block using the indicated one of the multiple possible inverse transforms.</p><p id="p0027" num="0027">In another example, an apparatus for decoding video data includes a video decoder configured to receive a first indication of an intra-prediction mode to use to<!-- EPO <DP n="7"> --> decode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, receive a second indication of one of the multiple possible inverse transforms, and inverse transform the sub-block using the indicated one of the multiple possible inverse transforms.</p><p id="p0028" num="0028">In another example, an apparatus for decoding video data includes means for receiving a first indication of an intra-prediction mode to use to decode a block of video data, means for determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, means for receiving a second indication of one of the multiple possible inverse transforms, and means for inverse transforming the sub-block using the indicated one of the multiple possible inverse transforms.</p><p id="p0029" num="0029">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for decoding video data to receive a first indication of an intra-prediction mode to use to decode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, receive a second indication of one of the multiple possible inverse transforms, and inverse transform the sub-block using the indicated one of the multiple possible inverse transforms.</p><p id="p0030" num="0030">In another example, a method of encoding video data includes scanning a two-dimensional block of transform coefficients to produce a one-dimensional vector of the transform coefficients, determining values indicative of whether the transform coefficients in the one-dimensional vector are significant, and entropy encoding at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values encoded before the at least one of the values.<!-- EPO <DP n="8"> --></p><p id="p0031" num="0031">In another example, an apparatus for encoding video data includes a video encoder configured to scan a two-dimensional block of transform coefficients to produce a one-dimensional vector of the transform coefficients, determine values indicative of whether the transform coefficients in the one-dimensional vector are significant, and entropy encode at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values encoded before the at least one of the values.</p><p id="p0032" num="0032">In another example, an apparatus for encoding video data includes means for scanning a two-dimensional block of transform coefficients to produce a one-dimensional vector of the transform coefficients, means for determining values indicative of whether the transform coefficients in the one-dimensional vector are significant, and means for entropy encoding at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values encoded before the at least one of the values.</p><p id="p0033" num="0033">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for encoding video data to scan a two-dimensional block of transform coefficients to produce a one-dimensional vector of the transform coefficients, determine values indicative of whether the transform coefficients in the one-dimensional vector are significant, and entropy encode at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values encoded before the at least one of the values.</p><p id="p0034" num="0034">In another example, a method of decoding video data includes receiving values indicative of whether encoded transform coefficients in a received one-dimensional vector of encoded transform coefficients are significant, entropy decoding at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values decoded before the at least one of the values, and inverse scanning the one-dimensional vector to produce two-dimensional block of the transform coefficients.</p><p id="p0035" num="0035">In another example, an apparatus for decoding video data includes a video decoder configured to receive values indicative of whether encoded transform coefficients in a received one-dimensional vector of encoded transform coefficients are significant, entropy decode at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of<!-- EPO <DP n="9"> --> the values decoded before the at least one of the values, and inverse scan the one-dimensional vector to produce two-dimensional block of the transform coefficients.</p><p id="p0036" num="0036">In another example, an apparatus for decoding video data includes means for receiving values indicative of whether encoded transform coefficients in a received one-dimensional vector of encoded transform coefficients are significant, means for entropy decoding at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values decoded before the at least one of the values, and means for inverse scanning the one-dimensional vector to produce two-dimensional block of the transform coefficients.</p><p id="p0037" num="0037">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for decoding video data to receive values indicative of whether encoded transform coefficients in a received one-dimensional vector of encoded transform coefficients are significant, entropy decode at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values decoded before the at least one of the values, and inverse scan the one-dimensional vector to produce two-dimensional block of the transform coefficients.</p><p id="p0038" num="0038">In one example, a method of encoding video data includes transforming residual data for a block of video data using a first transform to produce an intermediate, two-dimensional block of transform coefficients, transforming the intermediate, two-dimensional block of transform coefficients using a rotational transform to produce a two-dimensional block of transform coefficients, selecting a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively scanning the two-dimensional block of transform coefficients based on the selected set of statistics.</p><p id="p0039" num="0039">In another example, an apparatus for encoding video data includes a video encoder configured to transform residual data for a block of video data using a first transform to produce an intermediate, two-dimensional block of transform coefficients, transform the intermediate, two-dimensional block of transform coefficients using a rotational transform to produce a two-dimensional block of transform coefficients, select a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in<!-- EPO <DP n="10"> --> the two-dimensional block of transform coefficients will be non-zero, and adaptively scan the two-dimensional block of transform coefficients based on the selected set of statistics.</p><p id="p0040" num="0040">In another example, an apparatus for encoding video data includes means for transforming residual data for a block of video data using a first transform to produce an intermediate, two-dimensional block of transform coefficients, means for transforming the intermediate, two-dimensional block of transform coefficients using a rotational transform to produce a two-dimensional block of transform coefficients, means for selecting a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and means for adaptively scanning the two-dimensional block of transform coefficients based on the selected set of statistics.</p><p id="p0041" num="0041">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for encoding video data to transform residual data for a block of video data using a first transform to produce an intermediate, two-dimensional block of transform coefficients, transform the intermediate, two-dimensional block of transform coefficients using a rotational transform to produce a two-dimensional block of transform coefficients, select a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively scan the two-dimensional block of transform coefficients based on the selected set of statistics.</p><p id="p0042" num="0042">In another example, a method of decoding video data includes receiving an indication that residual data for a block of video data was transformed using both a first transform and a rotational transform to produce a two-dimensional block of transform coefficients, selecting a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively inverse scanning a received one-dimensional vector including an encoded version of the residual data for the block based on the selected set of statistics to produce a two-dimensional matrix of transform coefficients for the block.<!-- EPO <DP n="11"> --></p><p id="p0043" num="0043">In another example, an apparatus for decoding video data includes a video decoder configured to receive an indication that residual data for a block of video data was transformed using both a first transform and a rotational transform to produce a two-dimensional block of transform coefficients, select a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively inverse scanning a received one-dimensional vector including an encoded version of the residual data for the block based on the selected set of statistics to produce a two-dimensional matrix of transform coefficients for the block.</p><p id="p0044" num="0044">In another example, an apparatus for decoding video data includes means for receiving an indication that residual data for a block of video data was transformed using both a first transform and a rotational transform to produce a two-dimensional block of transform coefficients, means for selecting a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and means for adaptively inverse scanning a received one-dimensional vector including an encoded version of the residual data for the block based on the selected set of statistics to produce a two-dimensional matrix of transform coefficients for the block.</p><p id="p0045" num="0045">In another example, a computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor of a device for decoding video data to receive an indication that residual data for a block of video data was transformed using both a first transform and a rotational transform to produce a two-dimensional block of transform coefficients, select a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively inverse scan a received one-dimensional vector including an encoded version of the residual data for the block based on the selected set of statistics to produce a two-dimensional matrix of transform coefficients for the block.</p><p id="p0046" num="0046">In another example, a method of decoding video data includes receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode, determining whether an edge is present in the block of video<!-- EPO <DP n="12"> --> data, after determining that the edge is present in the block, determining an angle for the edge, based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transforming the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge, and decoding the inverse transformed block.</p><p id="p0047" num="0047">In another example, an apparatus for decoding video data includes a video decoder configured to receive information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode, determine whether an edge is present in the block of video data, after determining that the edge is present in the block, determine an angle for the edge, based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transform the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge, and decode the inverse transformed block.</p><p id="p0048" num="0048">In another example, an apparatus for decoding video data includes means for receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode, means for determining whether an edge is present in the block of video data, means for determining, after determining that the edge is present in the block an angle for the edge, means for inverse transforming, after determining the angle of the edge, the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, and means for decoding the inverse transformed block.</p><p id="p0049" num="0049">In another example, a computer program product includes a computer-readable medium having stored thereon instructions that, when executed, cause a processor to receive information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode, determine whether an edge is present in the block of video data, after determining that the edge is present in the block, determine an angle for the edge, and based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transform the block using a directional inverse transform mapped from a directional<!-- EPO <DP n="13"> --> intra-prediction mode having an angle that approximates the angle of the edge, and decode the inverse transformed block.</p><p id="p0050" num="0050">In another example, a method of encoding video data includes determining that a block to be intra-prediction encoded contains an edge within the block, calculating a residual block for the block based on a prediction value calculated using an edge directed intra-prediction mode, based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, transforming the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge, and outputting information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</p><p id="p0051" num="0051">In another example, an apparatus for encoding video data includes a video encoder configured to determine that a block to be intra-prediction encoded contains an edge within the block, calculate a residual block for the block based on a prediction value calculated using an edge directed intra-prediction mode, based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, transform the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge, and output information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</p><p id="p0052" num="0052">In another example, an apparatus for encoding video data includes means for determining that a block to be intra-prediction encoded contains an edge within the block, means for calculating a residual block for the block based on a prediction value calculated using an edge directed intra-prediction mode, means for transforming, based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge, and means for outputting information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</p><p id="p0053" num="0053">In another example, a computer program product includes a computer-readable storage medium having stored thereon instructions that, when executed, cause a processor to determine that a block to be intra-prediction encoded contains an edge<!-- EPO <DP n="14"> --> within the block, calculate a residual block for the block based on a prediction value calculated using an edge directed intra-prediction mode, based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, transform the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge, and output information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0054" num="0054"><figref idrefs="f0001">FIG. 1</figref> is a block diagram illustrating an example video encoding and decoding system that may utilize techniques for encoding and decoding transform units of a coding unit.</p><p id="p0055" num="0055"><figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating an example of a video encoder that may implement any or all of the techniques for encoding transform units of video data described in this disclosure.</p><p id="p0056" num="0056"><figref idrefs="f0003">FIG. 3</figref> is a block diagram illustrating an example of a video decoder, which decodes an encoded video sequence.</p><p id="p0057" num="0057"><figref idrefs="f0004">FIG. 4</figref> is a conceptual diagram illustrating a graph that depicts an example set of prediction directions associated with various intra-prediction modes.</p><p id="p0058" num="0058"><figref idrefs="f0005">FIG. 5</figref> is a conceptual diagram illustrating various intra-prediction modes specified by the ITU-T H.264/AVC standard.</p><p id="p0059" num="0059"><figref idrefs="f0006">FIG. 6</figref> is a conceptual diagrams illustrating a zig-zag scan for a block of transform coefficients.</p><p id="p0060" num="0060"><figref idrefs="f0007">FIGS. 7A and 7B</figref> are conceptual diagrams illustrating an example quadtree and a corresponding largest coding unit (LCU).</p><p id="p0061" num="0061"><figref idrefs="f0008">FIG. 8</figref> is a flowchart illustrating an example method for selecting a transform and a scan to apply to a block based on an intra-prediction mode selected for the block.</p><p id="p0062" num="0062"><figref idrefs="f0009">FIG. 9</figref> is a flowchart illustrating another example method for selecting a transform and scan to apply to a block based on an intra-prediction mode selected for the block.</p><p id="p0063" num="0063"><figref idrefs="f0010">FIG. 10</figref> is a flowchart illustrating an example method for applying an intra-prediction mode and transform to particular-sized sub-CUs.<!-- EPO <DP n="15"> --></p><p id="p0064" num="0064"><figref idrefs="f0011">FIG. 11</figref> is a flowchart illustrating an example method for performing an adaptive scan of transform coefficients based on a selected transform applied to a block of residual values.</p><p id="p0065" num="0065"><figref idrefs="f0012">FIG. 12</figref> is a flowchart illustrating an example method for selecting a context model to use when scanning and entropy encoding syntax elements that describe adaptively scanned coefficients.</p><p id="p0066" num="0066"><figref idrefs="f0013">FIG. 13</figref> is a flowchart illustrating an example method for decoding a transform unit that has been encoded using one or more of the techniques of this disclosure.</p><p id="p0067" num="0067"><figref idrefs="f0014">FIG. 14</figref> is a flowchart illustrating an example method for selecting a transform to apply to an intra-coded block including an edge for which DC intra-prediction mode is signaled.</p><heading id="h0005"><b>DETAILED DESCRIPTION</b></heading><p id="p0068" num="0068">In general, this disclosure describes techniques for coding video data. More specifically, this disclosure describes techniques relating to transforming residual data and scanning transform coefficients during a video coding process. Encoded video data may include prediction data and residual data. A video encoder may produce the prediction data during an intra-prediction mode or an inter-prediction mode. Intra-prediction generally involves predicting a block of a picture relative to neighboring, previously coded blocks of the same picture. Inter-prediction generally involves predicting a block of a picture relative to data of a previously coded picture.</p><p id="p0069" num="0069">Following intra- or inter-prediction, a video encoder may calculate a residual value for the block. The residual value generally corresponds to the difference between the predicted data for the block and the true value of the block. To further compress the residual value of a block, the residual value may be transformed into a set of transform coefficients that compact as much data (also referred to as "energy") as possible into as few coefficients as possible. The transform coefficients correspond to a two-dimensional matrix of coefficients that is the same size as the original block. In other words, there are just as many transform coefficients as pixels in the original block. However, due to the transform, many of the transform coefficients may have values equal to zero.</p><p id="p0070" num="0070">In some cases a secondary transform, such as a rotational transform, may be applied to a subset of the transform coefficients generated by the first transform. For<!-- EPO <DP n="16"> --> example, after transforming a 16×16 residual block into 16×16 matrix of transform coefficients, a rotational transform may be applied to the 8×8 block of lowest frequency transform coefficients. While this example describes a rotational transform as a secondary transform, other secondary transforms (e.g., KLTs, DCTs, and the like) may also be applied as secondary transforms. Such secondary transforms may also be selected based on a signaled intra-prediction mode for the block.</p><p id="p0071" num="0071">References to "DCT transforms" should be understood to include both fixed-point implementations and floating point implementations. That is, an implementation of a DCT transform may actually comprise an approximation of a DCT, such that the DCT transform has integer coefficients (that is, fixed point coefficients) rather than rational number coefficients.</p><p id="p0072" num="0072">In some examples, a transform may comprise a non-separable transform. Non-separable transforms are typically computationally expensive, and therefore, video coding devices may instead apply separable transforms. In general, separable transforms include a horizontal component applied to rows of the block and a vertical component applied to columns of the block. In this manner, a separable transform may have a row transform component and a column transform component, also referred to as two orthogonal transform components. Two matrices may be used to define a separable transform, each of the matrices corresponding to one of the orthogonal transform components. A non-separable transform may include only one matrix that, when applied, produces a conceptually similar result to application of the separable transform, but through relatively more intensive calculations.</p><p id="p0073" num="0073">Transforming a block of residual data produces a set of transform coefficients for the block. The video encoder may then quantize the transform coefficients to further compress the video data. Quantization generally involves mapping values within a relatively large set to values in a relatively small set, thus reducing the amount of data needed to represent the quantized transform coefficients. Following quantization, the video encoder may scan the transform coefficients, producing a one-dimensional vector from the two-dimensional matrix including the quantized transform coefficients. The video encoder may zero out certain coefficients prior to or following the scan, e.g., all but the upper-left corner of the matrix or all coefficients in the array from a position N to the end of the array.</p><p id="p0074" num="0074">The video encoder may then entropy encode the resulting array, to even further compress the data. In some examples, the video encoder may be configured to use<!-- EPO <DP n="17"> --> variable length codes (VLCs) to represent various possible quantized transform coefficients of the array, e.g., using context-adaptive variable-length coding (CAVLC). In other examples, the video encoder may be configured to use binary arithmetic coding to encode the resulting quantized coefficients, e.g., using context-adaptive binary arithmetic coding (CABAC).</p><p id="p0075" num="0075">This disclosure describes several techniques related to transformation, quantization, scanning, and entropy encoding of residual values during a video coding process. The techniques may be applied by both video encoding and decoding units, including video encoder/decoders (CODECs) and processing units configured to perform video encoding and/or decoding. References to "video coding units" or "video coding devices" should be understood to refer to units or devices capable of encoding, decoding, or both encoding and decoding video data.</p><p id="p0076" num="0076">Efforts are currently in progress to develop a new video coding standard, currently referred to as High Efficiency Video Coding (HEVC). The upcoming standard is also referred to as H.265. The standardization efforts are based on a model of a video coding device referred to as the HEVC Test Model (HM). The HM presumes several capabilities of video coding devices over devices according to, e.g., ITU-T H.264/AVC. For example, whereas H.264 provides nine intra-prediction encoding modes, HM provides as many as thirty-four intra-prediction encoding modes.</p><p id="p0077" num="0077">HM refers to a block of video data as a coding unit (CU), which may include one or more prediction units (PUs) and/or one or more transform units (TUs). Syntax data within a bitstream may define a largest coding unit (LCU), which is a largest coding unit in terms of the number of pixels. In general, a CU has a similar purpose to a macroblock of H.264, except that a CU does not have a size distinction. Thus, a CU may be split into sub-CUs. In general, references in this disclosure to a CU may refer to a largest coding unit of a picture or a sub-CU of an LCU. An LCU may be split into sub-CUs, and each sub-CU may be further split into sub-CUs. Syntax data for a bitstream may define a maximum number of times an LCU may be split, referred to as CU depth. Accordingly, a bitstream may also defme a smallest coding unit (SCU). This disclosure also uses the term "block" to refer to any of a CU, PU, or TU.</p><p id="p0078" num="0078">An LCU may be associated with a quadtree data structure. In general, a quadtree data structure includes one node per CU, where a root node corresponds to the LCU. If a CU is split into four sub-CUs, the node corresponding to the CU includes four leaf nodes, each of which corresponds to one of the sub-CUs. Each node of the<!-- EPO <DP n="18"> --> quadtree data structure may provide syntax data for the corresponding CU. For example, a node in the quadtree may include a split flag, indicating whether the CU corresponding to the node is split into sub-CUs. Syntax elements for a CU may be defined recursively, and may depend on whether the CU is split into sub-CUs. If a CU is not split further, it is referred as a leaf-CU. In this disclosure, 4 sub-CUs of a leaf-CU will also be referred to as leaf-CUs although there is no explicit splitting of the original leaf-CU. For example if a CU at 16x16 size is not split further, the four 8x8 sub-CUs will also be referred to as leaf-CUs although the 16x16 CU was never split.</p><p id="p0079" num="0079">Moreover, TUs of leaf-CUs may also be associated with respective quadtree data structures. That is, a leaf-CU may include a quadtree indicating how the leaf-CU is partitioned into TUs. This disclosure refers to the quadtree indicating how an LCU is partitioned as a CU quadtree and the quadtree indicating how a leaf-CU is partitioned into TUs as a TU quadtree. The root node of a TU quadtree generally corresponds to a leaf-CU, while the root node of a CU quadtree generally corresponds to an LCU. TUs of the TU quadtree that are not split are referred to as leaf-TUs.</p><p id="p0080" num="0080">A leaf-CU may include one or more prediction units (PUs). In general, a PU represents all or a portion of the corresponding CU, and may include data for retrieving a reference sample for the PU. For example, when the PU is inter-mode encoded, the PU may include data defining a motion vector for the PU. The data defining the motion vector may describe, for example, a horizontal component of the motion vector, a vertical component of the motion vector, a resolution for the motion vector (e.g., one-quarter pixel precision or one-eighth pixel precision), a reference frame to which the motion vector points, and/or a reference list (e.g., list 0 or list 1) for the motion vector. Data for the leaf-CU defining the PU(s) may also describe, for example, partitioning of the CU into one or more PUs. Partitioning modes may differ depending on whether the CU is uncoded, intra-prediction mode encoded, or inter-prediction mode encoded. For intra coding, a PU may be treated the same as a leaf transform unit described below.</p><p id="p0081" num="0081">A leaf-CU may include one or more transform units (TUs). The transform units may be specified using a TU quadtree structure, as discussed above. That is, a split flag may indicate whether a leaf-CU is split into four transform units. Then, each transform unit may be split further into 4 sub TUs. When a TU is not split further, it may be referred to as a leaf-TU. Generally, for intra coding, all the leaf-TUs belonging to a leaf-CU share the same intra prediction mode. That is, the same intra-prediction mode is generally applied to calculate predicted values for all TUs of a leaf-CU. For intra<!-- EPO <DP n="19"> --> coding, a video encoder may calculate a residual value for each leaf-TU using the intra prediction mode, as a difference between the portion of the predictive values corresponding to the TU and the original block. The residual value may be transformed, quantized, and scanned. For inter coding, a video encoder may perform prediction at the PU level and may calculate a residual for each PU. The residual values corresponding to a leaf-CU may be transformed, quantized, and scanned. For inter coding, a leaf-TU may be larger or smaller than a PU. For intra coding, a PU may be collocated with a corresponding leaf-TU. In some examples, the maximum size of a leaf-TU may be the size of the corresponding leaf-CU.</p><p id="p0082" num="0082">In general, this disclosure uses the terms CU and TU to refer to leaf-CU and leaf-TU, respectively, unless noted otherwise. In general, the techniques of this disclosure relate to transforming, quantizing, scanning, and entropy encoding data of a CU. As an example, the techniques of this disclosure include selection of a transform to use to transform a residual value of an intra-predicted block based on an intra-prediction mode used to predict the block. This disclosure also uses the term "directional transform" or "designed transform" to refer to such a transform that depends on intra-prediction mode direction. That is, a video encoder may select a directional transform to apply to a transform unit (TU). As noted above, intra-prediction includes predicting a TU of a current CU of a picture from previously coded CUs and TUs of the same picture. More specifically, a video encoder may intra-predict a current TU of a picture using a particular intra-prediction mode.</p><p id="p0083" num="0083">The techniques of this disclosure include associating certain transforms with intra-prediction modes. Thus, there may be a one-to-one correspondence between intra-prediction modes and transforms in accordance with techniques of this disclosure. In some examples, there may be a many-to-one correspondence between intra-prediction modes and transforms thereof. For example, a large set of intra-prediction modes may be mapped to a smaller set of intra-prediction modes, and each of the smaller set of intra-prediction modes may be mapped one-to-one to respective transforms.</p><p id="p0084" num="0084">The transforms may also be mapped to respective scan patterns. In some examples, intra-prediction modes may be mapped to both transforms and scans, while in other examples, intra-prediction modes may be mapped to transforms, and transforms may be mapped to scans. In various examples, various combinations of transforms and coefficient scans may be used. For example, intra-prediction modes may be mapped to mode dependent directional transforms, and a zig-zag scan may be used in all cases.<!-- EPO <DP n="20"> --></p><p id="p0085" num="0085">In some examples, rather than mapping intra-prediction modes to transforms and/or scan patterns, video encoder 20 may be configured to signal a combination of one or more transforms and a scan pattern to apply. Likewise, video decoder 30 may be configured to determine a transform and scan pattern to apply based on a received indication, rather than a mapping between an intra-prediction mode and the transforms and scan pattern.</p><p id="p0086" num="0086">The transforms may include a discrete cosine transform (DCT) and eight directional transforms, also referred to as Karhunen-Loève transforms (KLTs). The DCT is generally a sum of cosine functions having different frequencies, where the functions are applied to the residual values. The KLTs generally each include two matrices. Each matrix in the KLT is the same size as the residual block to be transformed. The KLTs may be derived from training set data or derived analytically assuming a model for the video frames and/or prediction residual.</p><p id="p0087" num="0087">An HM encoder may be configured with thirty-four intra-prediction modes for certain block sizes. Therefore, to support a one-to-one mapping between directional intra-prediction modes and directional transforms, HM encoders and decoders would need to store up to 68 matrices for each supported transform size. Furthermore, the block sizes for which all thirty-four intra-prediction modes are supported may be relatively large blocks, e.g., 16x16 pixels, 32x32 pixels, or even larger.</p><p id="p0088" num="0088">In some examples, this disclosure provides techniques for reducing the number of directional transforms that encoders and decoders need to support. That is, encoders and decoders may support fewer directional transforms than the number of available intra-prediction modes. An encoder according to these techniques, for example, may map a relatively large set of intra-prediction modes to a subset of the intra-prediction modes. Each of the intra-prediction modes in the subset may be associated with a directional transform. That is, the intra-prediction modes in the subset may have a one-to-one correspondence with a set of directional transforms. Therefore, the intra-prediction modes in the large set may have a many-to-one correspondence with the set of directional transforms.</p><p id="p0089" num="0089">For example, each of the 34 HM directional intra-prediction modes may be mapped to one of the eight directional intra-prediction modes of H.264. The video encoder may therefore select a directional prediction mode to intra-predict a value for a current TU, determine an intra-prediction mode from the subset to which the selected mode is mapped, then use the directional transform mapped to the intra-prediction mode<!-- EPO <DP n="21"> --> from the subset to transform the current TU. In addition, each of the directional transforms may be associated with a respective scan pattern. Thus, the encoder may perform the scan associated with the directional transform to produce a vector of transform coefficients that can then be quantized. Moreover, the encoder may be configured with a maximum size for the vector. That is, the encoder may stop scanning the transform coefficients upon reaching the maximum size, whether or not the next coefficient to be scanned is non-zero.</p><p id="p0090" num="0090">By applying the techniques described above, the encoder need not signal the transform used for a particular TU when the techniques described above are used. That is, the encoder and decoder may each be configured with the many-to-one mapping of intra-prediction modes of the large set to intra-prediction modes of the subset, and the one-to-one mapping of intra-prediction modes of the subset to directional transforms. Thus, by signaling the intra-prediction mode from the large set, the decoder can derive the transform used to transform the block. Moreover, these techniques may be implemented by legacy devices that have limited memory that can be allocated to storage of matrices for the various directional transforms.</p><p id="p0091" num="0091">An HM encoder may be configured such that the available set of intra-prediction modes for a block differs based on the size of the block. That is, the size of a CU may determine the number of intra-prediction modes available for the CU, from which the encoder may select an intra-prediction mode to predict values used to calculate coefficients of the TUs. Table 1 below illustrates one example of a correspondence between CU sizes and the number of intra-prediction modes available for CUs of that size. In this disclosure, 4 sub-CUs of a leaf-CU are also referred to as leaf-CUs, although there is no explicit splitting of the original leaf-CU. If the leaf-CU has the smallest CU size, these 4 sub-CUs can select different intra prediction modes. Hence, the table has an entry for 4x4 CU size.
<tables id="tabl0001" num="0001"><table frame="all"><title><b>TABLE 1</b></title><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="16mm"/><colspec colnum="2" colname="col2" colwidth="56mm"/><thead><row><entry align="center" valign="top"><b>CU Size</b></entry><entry align="center" valign="top"><b>Number of Intra-Prediction Modes</b></entry></row></thead><tbody><row><entry align="center">4x4</entry><entry align="center">17</entry></row><row><entry align="center">8x8</entry><entry align="center">34</entry></row><row><entry align="center">16x16</entry><entry align="center">34</entry></row><row><entry align="center">32x32</entry><entry align="center">34</entry></row><row><entry align="center">64x64</entry><entry align="center">5</entry></row></tbody></tgroup></table></tables><!-- EPO <DP n="22"> --></p><p id="p0092" num="0092">In general, a video encoder may signal a prediction direction for a block, in order for a video decoder to properly decode the block. In some examples, a video encoder may be configured to determine a single prediction direction for a CU that may be applied to all TUs belonging to the CU. However, as noted above in Table 1, certain sizes of blocks have less intra-prediction modes available compared to other sizes of blocks. Such cases can be resolved by allowing the number of prediction directions at the CU block size to be used for the TU blocks sizes. Alternatively, the intra-prediction modes of a larger set may be mapped to intra-prediction modes of a smaller set, e.g., a subset. As discussed above, there may be a many-to-one relationship between intra-prediction modes of the larger set and intra-prediction modes of a smaller set.</p><p id="p0093" num="0093">TU quadtree structures may lead to decomposition of a large block (CU) into smaller blocks (TUs). The spatial prediction mode of the root block (for the CU) may be explicitly signaled in the bitstream. The resulting smaller TU quadtree blocks (TUs) may inherit their prediction modes from that of the root block of the TU quadtree (which corresponds to the CU). However, the number of spatial prediction directions supported by the smaller blocks (TUs) can be different from that of the root block (CU). This can be resolved by allowing more prediction directions for the smaller blocks (TUs). Alternatively, the prediction modes of the smaller blocks (TUs) may be derived from that of the root block (CU) by a many-to-one or one-to-one mapping according to a predetermined criterion such as minimizing the prediction direction angle difference between the intra prediction direction for the CU and the supported prediction directions in the smaller block. Directional transforms and scan patterns may be selected based on this mapping.</p><p id="p0094" num="0094">In this manner, the video encoder may signal an intra-prediction direction once for a CU. Assuming that the CU includes a TU of a size that does not support the signaled intra-prediction direction, the video encoder may determine the intra-prediction mode for the TU based on the mapping. That is, the video encoder may intra-predict a predicted block used to calculate a TU using the intra-prediction mode of the smaller set to which the signaled intra-prediction mode of the larger set is mapped. Likewise, a video decoder may include the same configuration, such that the video decoder can determine intra-prediction modes for each TU of a received CU. Alternatively, the number of prediction modes for a TU may be increased to match the number of prediction modes for the corresponding CU.<!-- EPO <DP n="23"> --></p><p id="p0095" num="0095">In some examples, for some intra-prediction modes, multiple transforms may be possible for TUs of particular sizes. In such cases, a video decoder might not be able to derive the transform to apply to the TU solely from the intra-prediction mode. Thus, the video encoder may need to signal the transform to use for TUs of sizes for which multiple transforms are possible. Rather than signaling the transform for each such TU, this information may be signaled at the CU level. In such a case, this transform may apply to all TUs contained in the CU. For TUs of sizes for which only one transform is mapped to the signaled intra-prediction mode, the mapped transform may be used.</p><p id="p0096" num="0096">Moreover, the syntax specifying the transform need only be present if the CU includes a TU of a size for which multiple transforms are possible. For TUs for which only one transform is possible, the video encoder and decoder may determine the transform to use based on the selected intra-prediction mode. However, for TUs of a size for which multiple transforms are possible, the video encoder may explicitly signal the transform to use for all similarly-sized TUs in the CU, e.g., by signaling the transform to use at the root of the TU quadtree for the CU.</p><p id="p0097" num="0097">In this manner, if a video decoder encounters a TU of a size for which multiple transforms are possible based on the intra-prediction mode for the CU corresponding to the TU, the decoder may determine the transform to apply based on the explicit signaling. For other TUs, the video decoder may use the transform associated with the intra-prediction mode signaled for the CU.</p><p id="p0098" num="0098">In some examples, a video encoder may apply more than one transform (e.g., more than one separable transform) to a residual value for a CU. For example, the video encoder may transform a TU of the CU once using a first transform, producing a first set of transform coefficients, then apply a second transform to the first set of transform coefficients, producing a second set of transform coefficients. This process of applying two or more transforms to a TU may be referred to as a cascaded transform. In some examples, the second transform may be applied only to a subset of coefficients produced by the first transform. It should be understood that the second transform may comprise a second separable transform, while the first transform may comprise a first separable transform. Thus, cascaded transforms may be applied by applying four matrices total to the coefficients: two for the first separable transform and another two for the second separable transform.</p><p id="p0099" num="0099">In some examples, the second transform (that is, the second separable transform) may correspond to a rotational transform (ROT). A rotational transform can generally<!-- EPO <DP n="24"> --> be considered to change the coordinate system of the transform basis. For example, a video encoder may first apply a directional transform, then a rotational transform, to a TU. As another example, the video encoder may first apply a DCT to a TU, then apply a rotational transform to the TU. The video encoder may be configured with multiple rotational transforms. The video encoder may further be configured to apply a rotational transform following certain directional transforms and/or in conjunction with certain intra-prediction modes. That is, the video encoder may be configured to apply a rotational transform for certain combinations of directional transforms and certain intra-prediction modes. The different rotational transforms may be indexed by a certain value, e.g., the angle of rotation. In some examples, not all of the coefficients are transformed using a rotational transform. For example, a video encoder may be configured to only rotationally transform low-frequency transform coefficients of a TU.</p><p id="p0100" num="0100">Furthermore, in some examples, the techniques of this disclosure include intra-mode predicting a TU having a detected edge within the TU. For example, a video coding unit may detect the presence of an edge in a neighboring block, and then determine that the edge continues into the current TU. Edge-handing prediction modes may be provided for intra-predicting such a TU. The video encoder may determine whether to predict the TU using the edge-based prediction mode or another directional intra-prediction mode. When an edge is determined to exist in the TU, and when the edge-based prediction mode is selected, a value indicative of DC prediction mode may be used to signal the intra-prediction mode used, but due to determination of existence of the edge, this value may be interpreted to indicate the edge-handling prediction mode. Moreover, the angle of the edge may be determined and mapped to a directional transform in a manner similar to the mapping of directional intra-prediction modes to directional transforms discussed above. Similarly, a scan pattern mapped to the directional transform may also be used in this example.</p><p id="p0101" num="0101">This disclosure also provides techniques for scanning transform coefficients in order to produce a one-dimensional vector that can then be entropy encoded. In accordance with these techniques, a video encoder may be configured to select a fixed scan pattern based on various factors, or to perform an adaptive scan. For example, a video encoder may include a set of fixed scan patterns. The video encoder may select one of the fixed scan patterns based on various criteria, such as, for example, an intra-prediction mode, a transform selected for a TU, whether the TU is transformed using a cascaded transform, a rotational transform selected for the TU, or any combination<!-- EPO <DP n="25"> --> thereof. For example, the video encoder may select one of a set of predefined scans based on an intra-prediction mode, a secondary transform, or a combination thereof. In some examples, the video encoder may select a scan index based on one or more of the factors discussed above, where the scan index may correspond to either a fixed or an adaptive scan.</p><p id="p0102" num="0102">In some examples, a video encoder may be configured to adaptively scan transform coefficients. The video encoder may store an initial, fixed scan pattern. As the video encoder encodes blocks of a picture, the video encoder may update the scan pattern adaptively. The video encoder may, for example, collect statistics indicative of whether coefficients at locations tend to be zero-valued, and if a coefficient at a particular location is commonly zero-valued, the video encoder may elect to scan that coefficient later than other coefficients that commonly have non-zero values. Moreover, the video encoder may store separate fixed scans and/or scan statistics for various combinations of factors, such as, for example, an intra-prediction mode, a transform selected for a TU, whether the TU is transformed using a cascaded transform, a rotational transform selected for the TU, or any combination thereof. In some examples, a video encoder may store separate statistics for each combination of cascaded transforms, e.g., a first transform followed by a rotational transform. In some examples, the video encoder may use an adaptive scan when the video encoder applies a cascaded transform, and a fixed scan when the video encoder applies a single transform.</p><p id="p0103" num="0103">As noted above, scanning a two-dimensional matrix of transform coefficients produces a one-dimensional vector that can then be entropy encoded. In some examples, a video encoder may entropy encode the transform coefficients using context-adaptive binary arithmetic coding (CABAC). The video encoder may also entropy-encode syntax elements such as, for example, a significant coefficient flag and a last coefficient flag. When adaptively scanning transform coefficients, a video encoder may set the value of the significant coefficient flag to indicate whether the coefficient is significant or not. The video encoder may, for example, be configured to determine that a coefficient is significant when the value of the coefficient is non-zero. The video encoder may also set the value of the last coefficient flag to indicate the last coefficient in the vector produced by the adaptive scan. A video decoder may use these syntax elements to update locally stored statistics, in order to inverse adaptively scan the entropy encoded coefficients. This disclosure provides techniques for selecting a context model when performing CABAC to encode such syntax elements. The video<!-- EPO <DP n="26"> --> encoder may select the context model based on, for example, an intra-prediction mode for the CU being encoded, among other elements.</p><p id="p0104" num="0104"><figref idrefs="f0001">FIG. 1</figref> is a block diagram illustrating an example video encoding and decoding system 10 that may utilize techniques for encoding and decoding transform units of a coding unit. As shown in <figref idrefs="f0001">FIG. 1</figref>, system 10 includes a source device 12 that transmits encoded video to a destination device 14 via a communication channel 16. Source device 12 and destination device 14 may comprise any of a wide range of devices. In some cases, source device 12 and destination device 14 may comprise wireless communication devices, such as wireless handsets, so-called cellular or satellite radiotelephones, or any wireless devices that can communicate video information over a communication channel 16, in which case communication channel 16 is wireless.</p><p id="p0105" num="0105">The techniques of this disclosure, however, which concern encoding and decoding of transform units, are not necessarily limited to wireless applications or settings. For example, these techniques may apply to over-the-air television broadcasts, cable television transmissions, satellite television transmissions, Internet video transmissions, encoded digital video that is encoded onto a storage medium, or other scenarios. Accordingly, communication channel 16 may comprise any combination of wireless or wired media suitable for transmission or storage of encoded video data.</p><p id="p0106" num="0106">In the example of <figref idrefs="f0001">FIG. 1</figref>, source device 12 includes a video source 18, video encoder 20, a modulator/demodulator (modem) 22 and a transmitter 24. Destination device 14 includes a receiver 26, a modem 28, a video decoder 30, and a display device 32. In accordance with this disclosure, video encoder 20 of source device 12 may be configured to apply the techniques for encoding and decoding of transform units of this disclosure. In other examples, a source device and a destination device may include other components or arrangements. For example, source device 12 may receive video data from an external video source 18, such as an external camera. Likewise, destination device 14 may interface with an external display device, rather than including an integrated display device.</p><p id="p0107" num="0107">The illustrated system 10 of <figref idrefs="f0001">FIG. 1</figref> is merely one example. Techniques for encoding and decoding of transform units may be performed by any digital video encoding and/or decoding device. Although the techniques of this disclosure are generally performed by a video encoding device or a video decoding device, the techniques may also be performed by a video encoder/decoder, typically referred to as a "CODEC." Source device 12 and destination device 14 are merely examples of such<!-- EPO <DP n="27"> --> coding devices in which source device 12 generates coded video data for transmission to destination device 14. In some examples, devices 12, 14 may operate in a substantially symmetrical manner such that each of devices 12, 14 include video encoding and decoding components. Hence, system 10 may support one-way or two-way video transmission between video devices 12, 14, e.g., for video streaming, video playback, video broadcasting, or video telephony.</p><p id="p0108" num="0108">Video source 18 of source device 12 may include a video capture device, such as a video camera, a video archive containing previously captured video, and/or a video feed from a video content provider. As a further alternative, video source 18 may generate computer graphics-based data as the source video, or a combination of live video, archived video, and computer-generated video. In some cases, if video source 18 is a video camera, source device 12 and destination device 14 may form so-called camera phones or video phones. As mentioned above, however, the techniques described in this disclosure may be applicable to video coding in general, and may be applied to wireless and/or wired applications. In each case, the captured, pre-captured, or computer-generated video may be encoded by video encoder 20. The encoded video information may then be modulated by modem 22 according to a communication standard, and transmitted to destination device 14 via transmitter 24. Modem 22 may include various mixers, filters, amplifiers or other components designed for signal modulation. Transmitter 24 may include circuits designed for transmitting data, including amplifiers, filters, and one or more antennas.</p><p id="p0109" num="0109">Receiver 26 of destination device 14 receives information over channel 16, and modem 28 demodulates the information. Again, the video encoding process may implement one or more of the techniques described herein to encode and decode transform units. The information communicated over channel 16 may include syntax information defined by video encoder 20, which is also used by video decoder 30, that includes syntax elements that describe characteristics and/or processing of coding units or other units of coded video data, e.g., groups of pictures (GOPs), slices, frames and the like. A CU quadtree data structure may form part of the syntax information for a largest coding unit. That is, each LCU may include syntax information in the form of a CU quadtree, which may describe how the LCU is split into sub-CUs as well as signaling information on how the LCU and sub-CUs are encoded. Likewise, TU quadtree data structures may form part of the syntax information for leaf-CUs of the LCU, which may describe how the respective leaf-CUs are split into TUs.<!-- EPO <DP n="28"> --></p><p id="p0110" num="0110">Video decoder 30 may use the CU quadtree and TU quadtrees to determine how to decode CUs of a received picture, including TUs of the CUs. Video decoder 30 may then decode the CUs and send decoded video data to display device 32. Display device 32 displays the decoded video data to a user, and may comprise any of a variety of display devices such as a cathode ray tube (CRT), a liquid crystal display (LCD), a plasma display, an organic light emitting diode (OLED) display, or another type of display device.</p><p id="p0111" num="0111">In the example of <figref idrefs="f0001">FIG. 1</figref>, communication channel 16 may comprise any wireless or wired communication medium, such as a radio frequency (RF) spectrum or one or more physical transmission lines, or any combination of wireless and wired media. Communication channel 16 may form part of a packet-based network, such as a local area network, a wide-area network, or a global network such as the Internet. Communication channel 16 generally represents any suitable communication medium, or collection of different communication media, for transmitting video data from source device 12 to destination device 14, including any suitable combination of wired or wireless media. Communication channel 16 may include routers, switches, base stations, or any other equipment that may be useful to facilitate communication from source device 12 to destination device 14.</p><p id="p0112" num="0112">Video encoder 20 and video decoder 30 may operate according to a video compression standard, such as the ITU-T H.264 standard, alternatively referred to as MPEG-4, Part 10, Advanced Video Coding (AVC). As another example, video encoder 20 and video decoder 30 may operate according to the High Efficiency Video Coding (HEVC) standard, and may conform to the HEVC Test Model (HM). The techniques of this disclosure, however, are not limited to any particular coding standard. Other examples include MPEG-2 and ITU-T H.263. Although not shown in <figref idrefs="f0001">FIG. 1</figref>, in some aspects, video encoder 20 and video decoder 30 may each be integrated with an audio encoder and decoder, and may include appropriate MUX-DEMUX units, or other hardware and software, to handle encoding of both audio and video in a common data stream or separate data streams. If applicable, MUX-DEMUX units may conform to the ITU H.223 multiplexer protocol, or other protocols such as the user datagram protocol (UDP).</p><p id="p0113" num="0113">The ITU-T H.264/MPEG-4 (AVC) standard was formulated by the ITU-T Video Coding Experts Group (VCEG) together with the ISO/IEC Moving Picture Experts Group (MPEG) as the product of a collective partnership known as the Joint Video<!-- EPO <DP n="29"> --> Team (JVT). In some aspects, the techniques described in this disclosure may be applied to devices that generally conform to the H.264 standard. The H.264 standard is described in ITU-T Recommendation H.264, Advanced Video Coding for generic audiovisual services, by the ITU-T Study Group, and dated March, 2005, which may be referred to herein as the H.264 standard or H.264 specification, or the H.264/AVC standard or specification. The Joint Video Team (JVT) continues to work on extensions to H.264/MPEG-4 AVC.</p><p id="p0114" num="0114">Video encoder 20 and video decoder 30 each may be implemented as any of a variety of suitable encoder circuitry, such as one or more microprocessors, digital signal processors (DSPs), application specific integrated circuits (ASICs), field programmable gate arrays (FPGAs), discrete logic, software, hardware, firmware or any combinations thereof. When the techniques are implemented in software, a device may store instructions for the software in a suitable, non-transitory computer-readable medium and execute the instructions using one or more processors to perform the techniques of this disclosure. Each of video encoder 20 and video decoder 30 may be included in one or more encoders or decoders, either of which may be integrated as part of a combined encoder/decoder (CODEC) in a respective camera, computer, mobile device, subscriber device, broadcast device, set-top box, server, or the like.</p><p id="p0115" num="0115">A video sequence typically includes a series of video frames. A group of pictures (GOP) generally comprises a series of one or more video frames. A GOP may include syntax data in a header of the GOP, a header of one or more frames of the GOP, or elsewhere, that describes a number of frames included in the GOP. Each frame may include frame syntax data that describes an encoding mode for the respective frame. Video encoder 20 typically operates on coding units within individual video frames in order to encode the video data. A coding unit may correspond to an LCU or a sub-CU, and the term CU may refer to an LCU or a sub-CU. Header information for an LCU may describe the size of the LCU, the number of times the LCU may be split (referred to as CU depth in this disclosure), and other information. Each video frame may include a plurality of slices, and each slice may include a plurality of LCUs.</p><p id="p0116" num="0116">In some examples prediction may be performed for various CU sizes. The size of an LCU may be defined by syntax information. Assuming that the size of a particular leaf-node CU is 2Nx2N, intra-prediction sizes may include 2Nx2N or NxN, in some examples, and inter-prediction symmetric sizes may include 2Nx2N, 2NxN, Nx2N, or NxN. In some examples, asymmetric splitting may be used for inter-prediction with<!-- EPO <DP n="30"> --> sizes of 2NxnU, 2NxnD, nLx2N, and nRx2N. In asymmetric splitting, one direction of a CU is not split, while the other direction is split into 25% and 75%. Which portion of the CU is the 25% split is indicated by an "n" followed by an indication of "Up", "Down," "Left," or "Right." Thus, for example, "2NxnU" refers to a 2Nx2N CU that is split horizontally with a .2Nx.5N PU on top and a 2Nx1.5N PU on bottom.</p><p id="p0117" num="0117">In this disclosure, "NxN" and "N by N" may be used interchangeably to refer to the pixel dimensions of a block (e.g., CU, PU, or TU) in terms of vertical and horizontal dimensions, e.g., 16x16 pixels or 16 by 16 pixels. In general, a 16x16 block will have 16 pixels in a vertical direction (y = 16) and 16 pixels in a horizontal direction (x = 16). Likewise, an NxN block generally has N pixels in a vertical direction and N pixels in a horizontal direction, where N represents a nonnegative integer value. The pixels in a block may be arranged in rows and columns. Moreover, blocks need not necessarily have the same number of pixels in the horizontal direction as in the vertical direction. For example, blocks may comprise NxM pixels, where M is not necessarily equal to N.</p><p id="p0118" num="0118">PUs of a CU may comprise pixel data in the spatial domain (also referred to as the pixel domain), while TUs of the CU may be transformed to produce coefficients in the transform domain, e.g., following application of a transform such as a discrete cosine transform (DCT), an integer transform, a wavelet transform, or a conceptually similar transform to residual video data. The residual data generally represents pixel differences between values of a PU and the values of collocated, unencoded pixels from the input video data. The coefficients may further be quantized. The transformed coefficients of the TU may be said to be in the frequency domain.</p><p id="p0119" num="0119">Video encoder 20 may implement any or all of the techniques of this disclosure to improve encoding of transform units of a coding unit. Likewise, video decoder 30 may implement any or all of these techniques to improve decoding of transform units of a coding unit. In general the techniques of this disclosure are directed to the transforming of coefficients of transform units following calculation of the coefficients based on intra-mode prediction. However, certain aspects of this disclosure may also be implemented with respect to inter-prediction encoding. For purposes of example, these techniques are described relative to intra-prediction encoding of TUs. It should be understood that certain aspects of these techniques may also be performed in conjunction with inter-prediction encoding.</p><p id="p0120" num="0120">Video encoder 20 may receive an LCU and determine whether to split the LCU into four quadrants, each comprising a sub-CU, or whether to encode the LCU without<!-- EPO <DP n="31"> --> splitting. Following a decision to split an LCU into sub-CUs, video encoder 20 may determine whether to split each sub-CU into four quadrants, each comprising a sub-CU. Video encoder 20 may continue to recursively determine whether to split a CU, with a maximum number of splits indicated by the LCU depth. Video encoder 20 may provide a CU quadtree data structure indicative of the splitting of an LCU and sub-CUs of the LCU. The LCU may correspond to a root node of the CU quadtree. Each node of the CU quadtree may correspond to a CU of the LCU. Moreover, each node may include a split flag value indicative of whether the corresponding CU is split.</p><p id="p0121" num="0121">If the LCU is split, for example, video encoder 20 may set the value of the split flag in the root node to indicate that the LCU is split. Then, video encoder 20 may set values of child nodes of the root node to indicate which, if any, of the sub-CUs of the LCU are split. A CU that is not split may correspond to a leaf node of the CU quadtree data structure, where a leaf node has no child nodes. Moreover, each leaf-node CU may include one or more TUs, as indicated by a TU quadtree for the leaf-node CU.</p><p id="p0122" num="0122">Video encoder 20 may encode each sub-CU of the LCU corresponding to a leaf node in the quadtree data structure. For purposes of example, this disclosure describes the techniques relative to intra-prediction encoding of TUs corresponding to the leaf-node CU. In intra-mode encoding, video encoder 20 may form prediction units (PUs) for each TU corresponding to a leaf-node in the TU quadtree data structure. In some examples, video encoder 20 may select one of thirty-four different intra-prediction modes for the CU and signal the selected intra-prediction mode in the root node of the TU quadtree. Starting with a first, largest TU (equal in size to the leaf-node CU in the CU quadtree), video encoder 20 may determine whether to partition the largest TU, and, recursively, whether to partition sub-TUs of the parent TU. Video encoder 20 may further signal an intra-prediction mode in the leaf-node CU quadtree for the CU including the TU quadtree, where the signaled intra-prediction mode may describe the intra-prediction mode to be used to calculate predicted values for each of the TUs in the TU quadtree corresponding to the CU. Video encoder 20 retrieves the prediction data for the TUs from neighboring, previously coded video data, according to the selected intra-prediction mode. In this manner, PUs of a CU predicted using an intra-prediction mode are the same size as TUs of the CU.</p><p id="p0123" num="0123">In accordance with the techniques of this disclosure, if the selected intra-prediction mode is not available for the current CU, e.g., due to its size, video encoder 20 may select an intra-prediction mode to which the mode signaled at the root of the<!-- EPO <DP n="32"> --> quadtree is mapped. That is, video encoder 20 may include information that maps each of the modes of a large set of modes to modes of a smaller set, e.g., a subset of the large set, in a many-to-one correspondence. Video encoder 20 may then intra-predict one or more PUs for the CU using the intra-prediction mode from the smaller set. In this manner, video encoder 20 need only signal one intra-prediction mode for the LCU, although video encoder 20 may use multiple modes to intra-predict sub-CUs of the LCU without explicitly signaling each of the modes and the sub-CUs for which the modes are used. Therefore, multiple intra-prediction modes may be used without increasing the amount of information included in the bitstream, thereby reducing overhead. In another embodiment, a larger number of prediction directions may be allowed at the CU level to enable using the same intra-prediction mode for the LCU irrespective of sub-CU sizes or PU sizes.</p><p id="p0124" num="0124">Video encoder 20 may further be configured with edge-based prediction modes for predicting TUs in a CU that video encoder 20 determines include an edge. In general, an edge corresponds to a high-frequency change along a relatively straight line through the TU. For example, an edge may occur along the boundary of an object represented in the TU contrasted against a background also represented in the TU. To detect an edge in a TU, video encoder 20 may calculate gradients for pixels in the TU and determine whether the gradients identify a line though the TU. After determining that a current TU includes an edge, video encoder 20 may determine whether to use the edge-based prediction mode. If such an edge is detected, and when the edge-based prediction mode is selected, video encoder 20 may signal the use of the edge-based prediction mode using a value that would otherwise indicate use of DC prediction mode. That is, after detecting the presence of an edge in a current block, video encoder 20 may select an intra-prediction mode from a set including the edge-based prediction mode and other directional prediction modes (but excluding DC mode), and when the edge-based prediction mode is selected, signal the use of the edge-based prediction mode as if signaling use of the DC prediction mode.</p><p id="p0125" num="0125">Following intra-predictive or inter-predictive coding to produce predicted data for a TU of a CU, video encoder 20 may calculate residual data, comprising coefficients of the TUs representative of pixel-by-pixel differences between the predicted data and the original data for the TU. Video encoder 20 may form one or more TUs including residual data for the CU in this manner. Video encoder 20 may then transform the TUs. In accordance with the techniques of this disclosure, video encoder 20 may select a<!-- EPO <DP n="33"> --> transform to apply to a TU based on an intra-prediction mode used to intra-mode predict data for the TU.</p><p id="p0126" num="0126">In some examples, video encoder 20 may include configuration data that provides a many-to-one mapping between a large set of intra-prediction modes, and a smaller set of intra-prediction modes. For example, video encoder 20 may include configuration data that provides a mapping between the 34 intra-prediction modes of HM and the nine intra-prediction modes of H.264. Moreover, video encoder 20 may include configuration data that provides a mapping between the smaller set of intra-prediction modes and directional transforms. The set of directional transforms may be the same size as the smaller set of intra-prediction modes, such that there is a one-to-one mapping between the smaller set of intra-prediction modes and the set of directional transforms. In this manner, the configuration data for video encoder 20 may provide an indirect, many-to-one mapping between the large set of intra-prediction modes and the set of directional transforms. Alternatively, in some examples, there may be a one-to-one mapping of the large set of directional transforms to a large set of directional transforms or other designed transforms, such as discrete cosine transforms, discrete sine transforms, or other conceptually similar transforms. In any case, using the mapping, video encoder 20 may select a transform for each TU based on the intra-prediction mode selected for a CU including the TU.</p><p id="p0127" num="0127">In some examples, there may be multiple directional transforms possible for a TU of a particular size. In some examples, video encoder 20 may signal a selected intra-prediction mode (e.g., a selected intra-prediction direction) at the root of a TU quadtree data structure corresponding to a CU (that is, a leaf-node CU in the CU quadtree), and the selected intra-prediction mode may apply to all TUs of the CU. If all TUs in the CU have sizes for which only one transform is possible, then video encoder 20 may proceed according to the example above, in which the transform can be derived from a signaled intra-prediction mode for the LCU. If at least one TU in the CU is of a size for which multiple transforms are possible, however, then video encoder 20 may select one of the possible transforms and signal the selected transform in the root node of the TU quadtree. Accordingly, video encoder 20 may use the signaled transform to transform each TU in the CU having a size associated with multiple possible transforms. In this manner, video encoder 20 may explicitly signal a transform, without consuming excess additional bandwidth.<!-- EPO <DP n="34"> --></p><p id="p0128" num="0128">In some examples, when video encoder 20 applies an edge-based intra-prediction mode to predict a value for a TU, video encoder 20 may select a transform to apply to the TU based on an angle of the edge. As discussed above, video encoder 20 may determine that an edge is present in a current TU based on detection of an edge in a neighboring TU that shares a boundary with the current TU. In accordance with the techniques of this disclosure, video encoder 20 may calculate a relative angle of the edge and use the angle of the edge to select a directional transform, in a manner similar to selecting a directional transform for an intra-prediction mode. For example, video encoder 20 may compare the angle of the edge to angles for the directional intra-prediction modes, determine a directional intra-prediction mode having an angle that is closest to the angle of the edge, and then transform the edge-based prediction mode-predicted TU using the transform that is mapped to the determined intra-prediction mode.</p><p id="p0129" num="0129">In some examples, video encoder 20 may be configured to apply more than one transform to a TU, which this disclosure refers to as a cascaded transform. For example, the first transform may correspond to a discrete cosine transform (DCT) or a Karhunen-Loève Transform (KLT), also generally referred to as a directional transform. When a directional transform is selected based on an intra-prediction mode mapped to the directional transform, the transform may be referred to as a mode-dependent directional transform (MDDT). This disclosure also refers to a transform selected based on an intra-prediction mode as a designed transform, which may include directional transforms, discrete cosine transforms, discrete sine transforms, or other conceptually similar transforms selected specifically for a prediction mode.</p><p id="p0130" num="0130">The second transform may correspond to a rotational transform. In some examples, video encoder 20 may be configured with multiple rotational transforms. Video encoder 20 may select one of the rotational transforms to apply through calculating Rate-Distortion costs for each of the rotational transforms, in some examples. Video encoder 20 may be configured to apply the rotational transform to a smaller number of coefficients than the first transform. In accordance with the techniques of this disclosure, video encoder 20 may include configuration data for mode-dependent rotational transforms (MDROT), including a column transform matrix and a row transform matrix. The intra-prediction modes may be mapped both to a first transforms, e.g., one of the MDDTs, as well as one of the rotational transforms, e.g., one of the MDROTs. Thus, a signaled intra-prediction mode for a CU may also provide an<!-- EPO <DP n="35"> --> indication of a first transform to apply to a TU of the LCU and a second transform to apply to the TU. Although MDROTs are described as examples, it should be understood that the second transform may comprise other transforms, such as directional transforms,</p><p id="p0131" num="0131">By transforming coefficients of a TU, video encoder 20 produces a matrix of transform coefficients. This matrix has the same size as the TU. In general, the transform process prepares the residual data for quantization, which further compresses the data. Quantization generally refers to a process in which the transform coefficients are quantized to possibly reduce the amount of data used to represent the coefficients. The quantization process may reduce the bit depth associated with some or all of the coefficients. For example, an n-bit value may be rounded down to an m-bit value during quantization, where n is greater than m.</p><p id="p0132" num="0132">In some examples, video encoder 20 may utilize a predefined scan order to scan the quantized transform coefficients to produce a vector that can be entropy encoded. For example, following a conventional transform or a mode-dependent transform, video encoder 20 may be configured to apply a zig-zag scan. Video encoder 20 may also be configured to apply a scan based on an intra-prediction mode and/or one or more transforms applied to the block. In some examples, video encoder 20 may perform an adaptive scan following transformation and quantization of coefficients of a TU. In some examples, video encoder 20 may comprise configuration data defining different scanning schemes for each possible transform scheme. For example, video encoder 20 may include configuration data comprising a one-to-one mapping between a set of directional transforms and a set of predefined scan patterns. The scan patterns may be defined based on empirical testing of scans following a particular directional transform, to optimize the placement of transform coefficients in the vector following the corresponding directional transform. Alternatively, video encoder 20 may include configuration data defining scan indices to which intra-prediction modes (or transform schemes) may be mapped, where the scan indices may indicate either predefined scans or adaptive scans.</p><p id="p0133" num="0133">Accordingly, each directional transform may have an associated scan pattern that is relatively optimized for that directional transform, based on empirical testing. As noted above, video encoder 20 need not signal the directional transform or scan pattern used for a particular TU, assuming that there is a mapping between an intra-prediction mode signaled in a TU quadtree for a CU including the TU and the directional transform<!-- EPO <DP n="36"> --> and scan pattern. In various examples, the scan patterns can be dependent on a selected first transform (e.g., DCT or MDDT), selected second transform (e.g., MDROT, DCT, or other secondary separable transform), or a combination of both. In some examples, one of two cascaded transforms may comprise a designed transform applied in a particular direction (e.g., horizontal or vertical), and video encoder 20 may select a scan order generally corresponding to the same direction or an orthogonal direction, based on the configuration data.</p><p id="p0134" num="0134">In examples where video encoder 20 applies a cascaded transform to a TU, video encoder 20 may adaptively scan coefficients resulting from resulting from the cascaded transform. To perform an adaptive scan, video encoder 20 may generally track statistics indicative of whether a particular position in the matrix of transform coefficients is more or less likely to be significant (e.g., non-zero). Video encoder 20 may adapt the scan pattern over time such that the scan pattern corresponds to these statistical likelihoods. That is, the adaptive scan pattern may attempt to ensure that the transform coefficients having a relatively higher probability of being significant (e.g., non-zero) are scanned before transform coefficients having a relatively lower probability of being significant. Alternatively, video encoder 20 may select a scan index to which the cascaded transform is mapped.</p><p id="p0135" num="0135">Video encoder 20 may track scan statistics for each possible cascaded transform separately. For example, the likelihood that a particular coefficient location in the transform matrix may differ based on the first and second transforms applied during cascaded transformation. Therefore, video encoder 20 may track separate, independent sets of statistics for each possible cascaded transform. As an example, assuming intra-prediction modes are mapped to both an MDDT and an MDROT (or other secondary separable transform), video encoder 20 may track independent statistics for each combination of MDDT and MDROT (or other secondary transform) applied to TUs. As another example, video encoder 20 may be configured to perform cascaded transform only when video encoder 20 applies a DCT to a TU. Thus, video encoder 20 may perform adaptive scanning, and track independent statistics for performing adaptive scanning, based on a selected MDROT (or other secondary separable transform) for the TU applied following the DCT.</p><p id="p0136" num="0136">In some examples, whether using an adaptive scan or a predetermined scan, video encoder 20 may zero out coefficients in the array following the san. That is, video encoder 20 may set values for coefficients a positions <i>N</i> through the end of the array<!-- EPO <DP n="37"> --> equal to zero. The value of <i>N</i> may relate to the size of the CU and/or the size of the TU. In some examples, video encoder 20 may zero out transform coefficients in the matrix prior to be scanned, e.g., all coefficients in the matrix other than the coefficients in the upper-left corner of the matrix.</p><p id="p0137" num="0137">After scanning the transform matrix to form a one-dimensional vector, video encoder 20 may entropy encode the one-dimensional vector, e.g., according to content adaptive variable length coding (CAVLC), context adaptive binary arithmetic coding (CABAC), syntax-based context-adaptive binary arithmetic coding (SBAC), or another entropy coding methodology.</p><p id="p0138" num="0138">To perform CAVLC, video encoder 20 may select a variable length code for a symbol to be transmitted. Codewords in VLC may be constructed such that relatively shorter codes correspond to more likely symbols, while longer codes correspond to less likely symbols. In this way, the use of VLC may achieve a bit savings over, for example, using equal-length codewords for each symbol to be transmitted.</p><p id="p0139" num="0139">To perform CABAC, video encoder 20 may select a context model to apply to a certain context to encode symbols to be transmitted. The context may relate to, for example, whether neighboring values are non-zero or not. Video encoder 20 may also entropy encode syntax elements, such as a significant coefficient flag and a last coefficient flag produced when performing an adaptive scan. In accordance with the techniques of this disclosure, video encoder 20 may select the context model used to encode these syntax elements based on, for example, an intra-prediction direction, a scan position of the coefficient corresponding to the syntax elements, block type, and/or transform type, among other factors used for context model selection.</p><p id="p0140" num="0140">Video decoder 30 may operate in a manner essentially symmetrical to that of video encoder 20. For example, video decoder 30 may receive entropy encoded data representative of an encoded CU, including encoded TU data. This received data may include information indicative of an intra-prediction mode used to encode the PU data, assuming the CU was intra-prediction encoded. Video decoder 30 may inverse entropy encode the received data, forming encoded quantization coefficients. When video encoder 20 entropy encodes data using a variable length code algorithm, video decoder 30 may use one or more VLC tables to determine a symbol corresponding to a received codeword. When video encoder 20 entropy encodes data using an arithmetic coding algorithm, video decoder 30 may use a context model to decode the data, which may correspond to the same context model used by video encoder 20 to encode the data.<!-- EPO <DP n="38"> --></p><p id="p0141" num="0141">Video decoder 30 may then inverse scan the decoded coefficients, using an inverse scan that mirrors the scan used by video encoder 20. To inverse adaptively scan the coefficients, video decoder 30 may decode syntax elements including significant coefficient flags and last coefficient flags to regenerate the statistics used by video encoder 20 to perform the adaptive scan. Video decoder 30 may thereby form a two-dimensional matrix, from the one-dimensional vector resulting from the entropy decoding process.</p><p id="p0142" num="0142">Next, video decoder 30 may inverse quantize the coefficients in the two-dimensional matrix produced by the inverse scan. Video decoder 30 may then apply one or more inverse transforms to the two-dimensional matrix. The inverse transforms may correspond to the transforms applied by video encoder 20. Video decoder 30 may determine the inverse transforms to apply based on, for example, the intra-prediction mode used to calculate coefficients for the TU, and if multiple transforms are available for a TU of a particular size, information signaled at the root of a TU quadtree corresponding to the CU including the TU currently being decoded. In this manner, video decoder 30 may select one or more inverse transforms to be applied to inverse quantized coefficients for a TU to reproduce the TU, based on an intra-prediction mode signaled for the TU. Moreover, video decoder 30 may calculate a predicted value for the TU using an intra-prediction mode corresponding to a signaled indication of the intra-prediction mode, e.g., in the TU quadtree. In some examples, video decoder 30 may determine that an edge is present in the TU, based on an edge detected in a neighboring TU, and, when a DC mode is signaled, instead use an edge-based mode to predict a value for the TU.</p><p id="p0143" num="0143">Video encoder 20 and video decoder 30 each may be implemented as any of a variety of suitable encoder or decoder circuitry, as applicable, such as one or more microprocessors, digital signal processors (DSPs), application specific integrated circuits (ASICs), field programmable gate arrays (FPGAs), discrete logic circuitry, software, hardware, firmware or any combinations thereof. Each of video encoder 20 and video decoder 30 may be included in one or more encoders or decoders, either of which may be integrated as part of a combined video encoder/decoder (CODEC). An apparatus including video encoder 20 and/or video decoder 30 may comprise an integrated circuit, a microprocessor, and/or a wireless communication device, such as a cellular telephone.<!-- EPO <DP n="39"> --></p><p id="p0144" num="0144"><figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating an example of video encoder 20 that may implement any or all of the techniques for encoding transform units of video data described in this disclosure. Video encoder 20 may perform intra- and inter-coding of CUs within video frames. Intra-coding relies on spatial prediction to reduce or remove spatial redundancy in video within a given video frame. Inter-coding relies on temporal prediction to reduce or remove temporal redundancy between a current frame and previously coded frames of a video sequence. Intra-mode (I-mode) may refer to any of several spatial based compression modes and inter-modes such as uni-directional prediction (P-mode) or bi-directional prediction (B-mode) may refer to any of several temporal-based compression modes.</p><p id="p0145" num="0145">As shown in <figref idrefs="f0002">FIG. 2</figref>, video encoder 20 receives a current video block within a video frame to be encoded. In the example of <figref idrefs="f0002">FIG. 2</figref>, video encoder 20 includes motion compensation unit 44, motion estimation unit 42, intra-prediction unit 46, reference frame store 64, summer 50, transform unit 52, quantization unit 54, and entropy coding unit 56. Transform unit 52 illustrated in <figref idrefs="f0002">FIG. 2</figref> is the unit that performs the actual transformation, not to be confused with a TU of a CU. For video block reconstruction, video encoder 20 also includes inverse quantization unit 58, inverse transform unit 60, and summer 62. In addition, video encoder 20 may include configuration data, such as mapping data 66. A deblocking filter (not shown in <figref idrefs="f0002">FIG. 2</figref>) may also be included to filter block boundaries to remove blockiness artifacts from reconstructed video. If desired, the deblocking filter would typically filter the output of summer 62.</p><p id="p0146" num="0146">During the encoding process, video encoder 20 receives a video frame or slice to be coded. The frame or slice may be divided into multiple video blocks, e.g., largest coding units (LCUs). Motion estimation unit 42 and motion compensation unit 44 perform inter-predictive coding of the received video block relative to one or more blocks in one or more reference frames to provide temporal compression. Intra-prediction unit 46 may perform intra-predictive coding of the received video block relative to one or more neighboring blocks in the same frame or slice as the block to be coded to provide spatial compression.</p><p id="p0147" num="0147">Mode select unit 40 may select one of the coding modes, intra or inter, e.g., based on error results (sometimes referred to as distortion), and provides the resulting intra- or inter-coded block to summer 50 to generate residual block data and to summer 62 to reconstruct the encoded block for use in a reference frame. Some video frames may be designated I-frames, where all blocks in an I-frame are encoded in an intra-prediction<!-- EPO <DP n="40"> --> mode. In some cases, intra-prediction unit 46 may perform intra-prediction encoding of a block in a P- or B-frame, e.g., when motion search performed by motion estimation unit 42 does not result in a sufficient prediction of the block.</p><p id="p0148" num="0148">Motion estimation unit 42 and motion compensation unit 44 may be highly integrated, but are illustrated separately for conceptual purposes. Motion estimation is the process of generating motion vectors, which estimate motion for video blocks. A motion vector, for example, may indicate the displacement of a prediction unit in a current frame relative to a reference sample of a reference frame. A reference sample is a block that is found to closely match the portion of the CU including the PU being coded in terms of pixel difference, which may be determined by sum of absolute difference (SAD), sum of square difference (SSD), or other difference metrics. Motion compensation, performed by motion compensation unit 44, may involve fetching or generating values for the prediction unit based on the motion vector determined by motion estimation. Again, motion estimation unit 42 and motion compensation unit 44 may be functionally integrated, in some examples.</p><p id="p0149" num="0149">Motion estimation unit 42 calculates a motion vector for a prediction unit of an inter-coded frame by comparing the prediction unit to reference samples of a reference frame stored in reference frame store 64. In some examples, video encoder 20 may calculate values for sub-integer pixel positions of reference frames stored in reference frame store 64. For example, video encoder 20 may calculate values of one-quarter pixel positions, one-eighth pixel positions, or other fractional pixel positions of the reference frame. Therefore, motion estimation unit 42 may perform a motion search relative to the full pixel positions and fractional pixel positions and output a motion vector with fractional pixel precision. Motion estimation unit 42 sends the calculated motion vector to entropy coding unit 56 and motion compensation unit 44. The portion of the reference frame identified by a motion vector may be referred to as a reference sample. Motion compensation unit 44 may calculate a prediction value for a prediction unit of a current CU, e.g., by retrieving the reference sample identified by a motion vector for the PU.</p><p id="p0150" num="0150">Intra-prediction unit 46 may intra-prediction encode the received block, as an alternative to inter-prediction performed by motion estimation unit 42 and motion compensation unit 44. Intra-prediction unit 46 may encode the received block relative to neighboring, previously coded blocks, e.g., blocks above, above and to the right, above and to the left, or to the left of the current block, assuming a left-to-right, top-to-bottom<!-- EPO <DP n="41"> --> encoding order for blocks (such as a raster scan ordering). Intra-prediction unit 46 may be configured with a variety of different intra-prediction modes. For example, intra-prediction unit 46 may be configured with a certain number of directional prediction modes, e.g., 34 directional prediction modes, based on the size of the CU being encoded.</p><p id="p0151" num="0151">Intra-prediction unit 46 may select an intra-prediction mode by, for example, calculating error values for various intra-prediction modes and selecting a mode that yields the lowest error value. Directional prediction modes may include functions for combining values of spatially neighboring pixels and applying the combined values to one or more pixel positions in a PU. Once values for all pixel positions in the PU have been calculated, intra-prediction unit 46 may calculate an error value for the prediction mode based on pixel differences between the PU and the received block to be encoded. Intra-prediction unit 46 may continue testing intra-prediction modes until an intra-prediction mode that yields an acceptable error value is discovered. Intra-prediction unit 46 may then send the PU to summer 50.</p><p id="p0152" num="0152">In accordance with the techniques of this disclosure, intra-prediction unit 46 may be configured to predict a block including an edge using an edge-based prediction mode. In particular, intra-prediction unit 46 may analyze pixels of neighboring, previously coded blocks to determine whether an edge is detected in at least one of the neighboring blocks, and whether the edge crosses a border between the previously coded block and the current block. To detect the edge, intra-prediction unit 46 may calculate gradients for pixels in the neighboring, previously coded blocks in both the horizontal and vertical directions. When the gradients for a plurality of pixels in one of the neighboring blocks are relatively perpendicular to a common line that crosses a border between the neighboring block and the current block, intra-prediction unit 46 may determine that the current block also includes an edge (in particular, an edge along the line detected as described above). It should be understood that the term "edge" in this context refers to a high frequency change along a relatively straight line within a block of pixels, and not to the border or boundary between separately coded blocks.</p><p id="p0153" num="0153">Accordingly, when an edge is detected in the block, intra-prediction unit 46 may determine whether to predict the block using an edge-based prediction mode or a directional intra-prediction mode. When intra-prediction unit 46 selects the edge-based prediction mode, intra-prediction unit 46 may signal that DC prediction mode was used to predict the block, in order to avoid increasing the number of values needed to signal<!-- EPO <DP n="42"> --> intra-prediction modes. Thus, as discussed in greater detail with respect to <figref idrefs="f0003">FIG. 3</figref>, a video decoder such as video decoder 30 may be configured to interpret an indication (e.g., a signal or syntax information) that DC prediction mode was used to predict a block as an indication of an edge-based prediction mode when the video decoder determines that an edge is present in the block.</p><p id="p0154" num="0154">Video encoder 20 forms a residual block by subtracting the prediction data calculated by motion compensation unit 44 or intra-prediction unit 46 from the original video block being coded. Summer 50 represents the component or components that perform this subtraction operation. The residual block may correspond to a two-dimensional matrix of values, where the number of values in the residual block is the same as the number of pixels in the PU corresponding to the residual block. The values in the residual block may correspond to the differences between collocated pixels in the PU and in the original block to be coded.</p><p id="p0155" num="0155">Transform unit 52 may form one or more transform units (TUs) from the residual block. Transform unit 52 applies a transform, such as a discrete cosine transform (DCT), a directional transform, or a conceptually similar transform, to the TU, producing a video block comprising transform coefficients. In accordance with the techniques of this disclosure, intra-prediction unit 46 may send an indication of the intra-prediction mode selected for the TU to transform unit 52, e.g., by signaling the mode in a node of a TU quadtree corresponding to the TU. Accordingly, transform unit 52 may select a transform to apply to the TU based on the indication of the intra-prediction mode received from intra-prediction unit 46.</p><p id="p0156" num="0156">In some examples, transform unit 52 is configured to select a transform, such as a directional transform, to apply to the TU based on an intra-prediction mode used to predict the TU. That is, mapping data 66 may store configuration data that describes a transform to be applied based on the intra-prediction mode used to predict the TU. In this manner, transform unit 52 may transform a residual block using a transform mapped to an intra-prediction mode used to calculate the residual block. Likewise, mapping data 66 may map an intra-prediction mode, a transform, or both, to a particular scan index, which may be used to select a scan to be applied to quantized transform coefficients of the block.</p><p id="p0157" num="0157">In some examples, mapping data 66 may store configuration data including a many-to-one mapping between a large set of intra-prediction modes and a smaller set of intra-prediction modes. The smaller set may comprise a subset of the intra-prediction<!-- EPO <DP n="43"> --> modes. In some examples, the large set may comprise intra-prediction modes supported by the HEVC Test Model, while the smaller set may comprise intra-prediction modes supported by H.264. Mapping data 66 may also include a mapping, such as a one-to-one mapping, between the smaller set of intra-prediction modes and transforms. The smaller set of intra-prediction modes may be one-to-one mapped to directional transforms that are designed to provide the empirically best transform results for the corresponding intra-prediction mode.</p><p id="p0158" num="0158">In some examples, intra-prediction modes of the large set and of the smaller set may be associated with respective prediction angles. The mapping between the large set of prediction modes and the smaller set may therefore be determined by selecting a prediction angle of one of the intra-prediction modes in the smaller set that approximates the prediction angle of an intra-prediction modes of the large set. Let α represent the prediction angle of one of the intra-prediction modes of the large set, and let β<i>i</i> represent the prediction angle of the <i>i</i><sup>th</sup> intra-prediction mode of the smaller set. To map the intra-prediction mode to one of the intra-prediction modes of the smaller set, video encoder 20 may, given α, find β<i>i</i> such that equation 1 below is satisfied: <maths id="math0001" num="(1)"><math display="block"><msub><mi>arg</mi><mfenced open="{" close="}"><mi mathvariant="normal">βi</mi></mfenced></msub><mspace width="1em"/><mi>min</mi><mspace width="1em"/><mfenced separators=""><mi>min</mi><mo>⁢</mo><mfenced separators=""><mi>abs</mi><mo>⁢</mo><mfenced separators=""><mi mathvariant="normal">α</mi><mo>-</mo><mi mathvariant="normal">βi</mi></mfenced><mo>,</mo><mi>abs</mi><mo>⁢</mo><mfenced separators=""><mo>-</mo><mi mathvariant="normal">α</mi><mo>-</mo><mi mathvariant="normal">βi</mi></mfenced></mfenced></mfenced></math><img id="ib0001" file="imgb0001.tif" wi="137" he="5" img-content="math" img-format="tif"/></maths></p><p id="p0159" num="0159">Transform unit 52 may receive the indication of the selected intra-prediction mode from intra-prediction unit 46, then query mapping data 66 to determine a transform to use to transform a TU including the residual values received from summer 50. If the TU is of a size for which multiple possible transforms are possible, transform unit 52 or another unit of video encoder 20 may select a transform for TUs of that size, such that transform unit 52 may apply the same transform to all TUs of that size in the same CU. In some examples, transform unit 52 may further be configured to perform a rotational transform cascaded from the first transform. That is, following the first transform, transform unit 52 may select and apply a rotational transform to the transform coefficients. Transform unit 52 may select the rotational transform based on, for example, the intra-prediction mode used to predict the PU for the current TU.</p><p id="p0160" num="0160">As discussed above, in some examples, intra-prediction unit 46 is configured to determine whether a block includes an edge (that is, a high-frequency change between pixels within the block). When an edge is detected, intra-prediction unit 46 may select either an edge- based prediction mode or a conventional directional intra-prediction mode. That is, intra-prediction unit 46 may substitute DC prediction mode for the edge-based prediction mode. In some examples, when the block is predicted using the edge-based<!-- EPO <DP n="44"> --> prediction mode, transform unit 52 selects a transform (such as a directional transform) mapped to the direction of an intra-prediction mode having an angle that closely approximates an angle of the edge. That is, transform unit 52 in some examples determines an angle of the edge within the block and selects a transform that is mapped to a directional intra-prediction mode having an angle that closely approximates (e.g., has a minimum distance relative to) the angle of the edge. In some examples, transform unit 52 is configured to select a transform that is mapped to a directional intra-prediction mode having an angle that closely approximates the angle of an edge detected in a block.</p><p id="p0161" num="0161">Video encoder 20 may also signal the use of the edge-based prediction mode using a value that would otherwise be used to signal use of DC prediction mode. Thus, although DC prediction mode is signaled, the edge-based prediction mode may be used to predict the block. Likewise, although the edge-based prediction mode may be used to predict the block, transform unit 52 may use the transform mapped to the intra-prediction mode having an angle that approximates the angle of the edge detected in the block.</p><p id="p0162" num="0162">Mapping data 66 may provide configuration data that indicates that when an edge is detected in a block for which DC prediction mode is signaled, transform unit 52 is to select a transform having an angle that approximates the angle of the edge. Moreover, as discussed above, mapping data 66 may include a mapping from intra-prediction modes and angles for the intra-prediction modes (which may define the intra-prediction modes) to directional transforms. Accordingly, transform unit 52 may query mapping data 66 to determine an intra-prediction mode having an angle that closely approximates the angle of an edge in a block, as well as to determine the transform that is mapped to the determined intra-prediction mode.</p><p id="p0163" num="0163">In this manner, video encoder 20 is an example of a video encoder configured to calculate a residual block for a block of video data based on a predicted block formed using an intra-prediction mode, and transform the residual block using a transform mapped to the intra-prediction mode. Video encoder 20 is also an example of a video encoder configured to receive an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of video data, determine a second intra-prediction mode from a smaller set of intra-prediction modes to which the first intra-prediction mode is mapped, determine a directional transform to which the second intra-prediction mode is mapped, and apply the directional transform to residual data of the block.<!-- EPO <DP n="45"> --></p><p id="p0164" num="0164">Furthermore, video encoder 20 is also an example of a video encoder configured to select an intra-prediction mode to use to encode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, select one of the multiple possible transforms, transform the sub-block using the selected one of the multiple possible transforms, and provide an indication of the selected one of the multiple possible transforms for the size of the block.</p><p id="p0165" num="0165">Moreover, video encoder 20 is an example of a video encoder configured to determine that a block to be intra-prediction encoded contains an edge within the block, calculate a residual block for the block based on a prediction value calculated using an edge directed intra-prediction mode, transform the residual block using a directional transform mapped to a directional intra-prediction mode having an angle that approximates an angle of the edge, and output information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</p><p id="p0166" num="0166">Transform unit 52 may send the resulting transform coefficients to quantization unit 54. Quantization unit 54 may then quantize the transform coefficients. In some examples, quantization unit 54 may then perform a scan of the matrix including the quantized transform coefficients. Alternatively, entropy coding unit 56 may perform the scan. This disclosure describes entropy coding unit 56 as performing the scan, although it should be understood that, in other examples, other processing units, such as quantization unit 54, may perform the scan.</p><p id="p0167" num="0167">In some examples, entropy coding unit 56 may receive an indication of the selected intra-prediction mode from intra-prediction unit 46 or from transform unit 52. Entropy coding unit 56 may select a scan to apply to the matrix of transform coefficients, to convert the two-dimensional matrix into a one-dimensional vector. In some examples, entropy coding unit 56 selects a scan from a predetermined set of scans. Mapping data 66 may map the smaller set of intra-prediction modes to the predetermined set of scans. Entropy coding unit 56 may select the scan based on various characteristics of the current TU, such as, for example, block type (inter or intra), the intra-prediction mode (assuming an intra-coded block), and/or a type of transform applied to the TU (e.g., DCT or KLT).<!-- EPO <DP n="46"> --></p><p id="p0168" num="0168">In some examples, entropy coding unit 56 may be configured to perform an adaptive scan. Initially (e.g., for a first TU of a current frame), entropy coding unit 56 may use a predetermined scan pattern. Over time, entropy coding unit 56 may update the scan pattern to perform the adaptive scan. In general, the goal of the adaptive scan is to determine a probability that a particular transform coefficient will be non-zero. Then, the scan order generally proceeds from coefficients with the highest probability of being non-zero to the lowest probability of being non-zero. Entropy coding unit 56 may determine these probabilities over time using various statistics and calculations. Moreover, entropy coding unit 56 may track separate statistics for each intra-prediction mode, transform, cascaded transform, or any combination thereof.</p><p id="p0169" num="0169">Entropy coding unit 56 may use a high-dynamic-range table and dynamically-updating scan tables to determine the probabilities of transform coefficients being non-zero, and to determine the adaptive scan order. Assuming an NxN TU, each of these tables may be NxN tables with values corresponding to the transform coefficients of the TU. The high-dynamic-range table may be a fixed, pre-determined table providing probabilities that each transform coefficient is non-zero. This table may be calculated based on a set of training data. Moreover, this table may be used to provide the starting point for the adaptive scan order.</p><p id="p0170" num="0170">Entropy coding unit 56 may update the dynamically-updating scan table over time to reflect recently determined statistics for transform coefficients. Entropy coding unit 56 may keep a count of the number of times each coefficient in a particular location in the NxN transform matrix is non-zero. That is, for each TU of a current frame, entropy coding unit 56 may increment values in the dynamically-updating scan table corresponding to non-zero coefficients in the current transform block, specifically, in the dynamically-updating scan table associated with the intra-prediction mode, transform, and/or cascaded transform for the current CU. For example, if the transform coefficient in row 2 and column 1 is non-zero, entropy coding unit 56 may add one to the value in the dynamically updating scan table in row 2 and column 1. Entropy coding unit 56 may also periodically normalize the values in the dynamically-updating scan table, to prevent the values from exceeding a maximum value.</p><p id="p0171" num="0171">To perform the adaptive scan for a first TU of a current frame, entropy coding unit 56 may scan based on the high-dynamic-range table alone. Entropy coding unit 56 may also initialize the dynamically-updating scan table by, e.g., setting all values in the dynamically-updating scan table to zero. For each non-zero coefficient in the transform<!-- EPO <DP n="47"> --> block, entropy coding unit 56 may add one to the collocated value in the dynamically-updating scan table associated with the intra-prediction mode and transform or cascaded transform for the current TU. For subsequent TUs using the same intra-prediction mode and transform or cascaded transform, entropy coding unit 56 may first refer to the dynamically-updating scan table to determine which of the transform coefficients is most likely to be non-zero, then scan in order of decreasing likelihood of coefficients being non-zero. In some cases, two or more values in the dynamically-updating scan table may be equal. In such a case, entropy coding unit 56 refers to the high-dynamic-range table to determine which coefficient to scan next. In this manner, entropy coding unit 56 may perform an adaptive scan for each intra-prediction mode, transform, or cascaded transform (or any combination thereof) based on a combination of a high-dynamic-range table and a dynamically-updating scan table.</p><p id="p0172" num="0172">By scanning the two-dimensional matrix of transform coefficients, entropy coding unit 56 may produce a one-dimensional array including the transform coefficients. Entropy coding unit 56 may then scan the TU to form an array and quantize the transform coefficients in the array following the scan to further reduce bit rate. The quantization process may reduce the bit depth associated with some or all of the coefficients. The degree of quantization may be modified by adjusting a quantization parameter.</p><p id="p0173" num="0173">Entropy coding unit 56 may also entropy encode syntax elements for the coefficients of the matrix prior to or during the adaptive scan. The syntax elements may include a significant coefficient flag that indicates whether a particular coefficient is significant (e.g., non-zero) and a last coefficient flag that indicates whether a particular coefficient is the last coefficient scanned in the adaptive scan. A video decoder may use these syntax elements to reconstruct the dynamically updating scan table, such that the video decoder can inverse scan the coefficients encoded by entropy coding unit 56.</p><p id="p0174" num="0174">To entropy encode the syntax elements, entropy coding unit 56 may perform CABAC and select context models based on, for example, the number of significant coefficients in the previously scanned <i>N</i> coefficients, where <i>N</i> is an integer value that may be related to the size of the block being scanned. Entropy coding unit 56 may also select the context model based on a prediction mode used to calculate residual data that was transformed into the block of transform coefficients, and a type of transform used to transform the residual data into the block of transform coefficients. When the corresponding prediction data was predicted using an intra-prediction mode, entropy<!-- EPO <DP n="48"> --> coding unit 56 may further base the selection of the context model on the direction of the intra-prediction mode.</p><p id="p0175" num="0175">In this manner, video encoder 20 represents an example of a video encoder configured to transform residual data for a block of video data using a first transform to produce an intermediate, two-dimensional block of transform coefficients, transform the intermediate, two-dimensional block of transform coefficients using a rotational transform to produce a two-dimensional block of transform coefficients, select a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively scan the two-dimensional block of transform coefficients based on the selected set of statistics.</p><p id="p0176" num="0176">Video encoder 20 also represents an example of a video encoder configured to scan a two-dimensional block of transform coefficients to produce a one-dimensional vector of the transform coefficients, determine values indicative of whether the transform coefficients in the one-dimensional vector are significant, and entropy encode at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values encoded before the at least one of the values.</p><p id="p0177" num="0177">In some examples, transform unit 52 may be configured to zero out certain transform coefficients (that is, transform coefficients in certain locations). For example, transform unit 52 may be configured to zero out all transform coefficients outside of the upper-left quadrant of the TU following the transform. As another example, entropy coding unit 56 may be configured to zero out transform coefficients in the array following a certain position in the array. In some examples, entropy coding unit 56 may quantize a two-dimensional matrix, and entropy coding unit 56 may perform the scan. In any case, video encoder 20 may be configured to zero out a certain portion of the transform coefficients, e.g., before or after the scan. The phrase "zero out" is used to mean setting the value of the coefficient equal to zero, but not necessarily skipping or discarding the coefficient.</p><p id="p0178" num="0178">Following quantization, entropy coding unit 56 entropy codes the quantized transform coefficients. For example, entropy coding unit 56 may perform content adaptive variable length coding (CAVLC), context adaptive binary arithmetic coding (CABAC), or another entropy coding technique. Following the entropy coding by entropy coding unit 56, the encoded video may be transmitted to another device or<!-- EPO <DP n="49"> --> archived for later transmission or retrieval. In the case of context adaptive binary arithmetic coding, context may be based on neighboring blocks.</p><p id="p0179" num="0179">In some cases, entropy coding unit 56 or another unit of video encoder 20 may be configured to perform other coding functions, in addition to entropy coding. For example, entropy coding unit 56 may be configured to determine coded block pattern (CBP) values for the blocks. Also, in some cases, entropy coding unit 56 may perform run length coding of the coefficients in a block.</p><p id="p0180" num="0180">Inverse quantization unit 58 and inverse transform unit 60 apply inverse quantization and inverse transformation, respectively, to reconstruct the residual block in the pixel domain, e.g., for later use as a reference block. Motion compensation unit 44 may calculate a reference block by adding the residual block to a predictive block of one of the frames of reference frame store 64. Motion compensation unit 44 may also apply one or more interpolation filters to the reconstructed residual block to calculate sub-integer pixel values for use in motion estimation. Summer 62 adds the reconstructed residual block to the motion compensated prediction block produced by motion compensation unit 44 to produce a reconstructed video block for storage in reference frame store 64. The reconstructed video block may be used by motion estimation unit 42 and motion compensation unit 44 as a reference block to inter-code a block in a subsequent video frame.</p><p id="p0181" num="0181"><figref idrefs="f0003">FIG. 3</figref> is a block diagram illustrating an example of video decoder 30, which decodes an encoded video sequence. In the example of <figref idrefs="f0003">FIG. 3</figref>, video decoder 30 includes an entropy decoding unit 70, motion compensation unit 72, intra prediction unit 74, inverse quantization unit 76, inverse transformation unit 78, reference frame store 82 and summer 80. Video decoder 30 may, in some examples, perform a decoding pass generally reciprocal to the encoding pass described with respect to video encoder 20 (<figref idrefs="f0002">FIG. 2</figref>). Motion compensation unit 72 may generate prediction data based on motion vectors received from entropy decoding unit 70. Intra-prediction unit 74 may generate prediction data for a current block of a current frame based on a signaled intra-prediction mode and data from previously decoded blocks of the current frame.</p><p id="p0182" num="0182">In some examples, entropy decoding unit 70 or inverse quantization unit 76 may scan the received values using a scan mirroring that used by video encoder 20. In the example of <figref idrefs="f0003">FIG. 3</figref>, video decoder 30 includes mapping data 84, which may include data similar or identical to that of mapping data 66. Accordingly, video decoder 30 may select a scan based on, for example, an indication of an intra-coding mode for a current<!-- EPO <DP n="50"> --> block (e.g., presented at the root node of a quadtree for the LCU including the current block), a transform for the current block, a cascaded transform for the current block, or the other factors used by video encoder 20 to select the scan. Likewise, video decoder 30 may be configured to perform an adaptive scan, or to select a predetermined scan based on these factors. In this manner, video decoder 30 may produce a two-dimensional matrix of quantized transform coefficients from a received, one dimensional array of coefficients.</p><p id="p0183" num="0183">Inverse quantization unit 76 inverse quantizes, i.e., de-quantizes, the quantized transform coefficients provided in the bitstream and decoded by entropy decoding unit 70. The inverse quantization process may include a conventional process, e.g., as defined by the H.264 decoding standard or by HEVC. The inverse quantization process may include use of a quantization parameter QP<sub>Y</sub> calculated by video encoder 20 for the CU to determine a degree of quantization and, likewise, a degree of inverse quantization that should be applied.</p><p id="p0184" num="0184">Inverse transform unit 58 applies an inverse transform, e.g., an inverse DCT, an inverse integer transform, an inverse rotational transform, or an inverse directional transform. In some examples, inverse transform unit 78 may determine an inverse transform based on an intra-prediction mode signaled for a received intra-prediction encoded block. If the block is of a size for which more than one transform is possible, based on the intra-prediction mode, then inverse transform unit 78 may determine a transform to apply to the current block based on a signaled transform at the root node of a quadtree for an LCU including the current block. In some examples, inverse transform unit 78 may apply a cascaded inverse transform, e.g., first an inverse rotational transform followed by an inverse directional transform.</p><p id="p0185" num="0185">In some examples, e.g., where the signaled intra-prediction mode is DC prediction mode, inverse transform unit 58 (or another unit of video decoder 30) may determine whether an edge is present in the current block. Inverse transform unit 58 may determine whether the edge is present using techniques that correspond substantially to those described with respect to video encoder 20 of <figref idrefs="f0002">FIG. 2</figref>. If an edge is present in the current block, inverse transform unit 78 may determine an angle of the edge within the block and select an inverse transform that is mapped to an intra-prediction mode having an angle that approximates the angle of the edge.</p><p id="p0186" num="0186">As discussed above, mapping data 84 may provide angles for intra-prediction modes and mappings between intra-prediction modes and inverse transforms.<!-- EPO <DP n="51"> --> Accordingly, inverse transform unit 78 may query mapping data 84 to determine an inverse transform mapped to an intra-prediction mode having an angle that closely approximates the angle of the edge, when DC prediction mode is signaled. Furthermore, intra-preidction unit 74 may apply an edge-based prediction mode to predict the block, rather than DC prediction mode as signaled for the block, when the edge is detected in the block. Mapping data 84 may also provide a mapping from an intra-prediction mode, a secondary transform such as a rotational transform, or a combination thereof, to a scan index, to select an inverse scan for received quantized transform coefficients.</p><p id="p0187" num="0187">Motion compensation unit 72 produces motion compensated blocks, possibly performing interpolation based on interpolation filters. Identifiers for interpolation filters to be used for motion estimation with sub-pixel precision may be included in the syntax elements. Motion compensation unit 72 may use interpolation filters as used by video encoder 20 during encoding of the video block to calculate interpolated values for sub-integer pixels of a reference block. Motion compensation unit 72 may determine the interpolation filters used by video encoder 20 according to received syntax information and use the interpolation filters to produce predictive blocks.</p><p id="p0188" num="0188">Motion compensation unit 72 and intra-prediction unit 74 use some of the syntax information (e.g., provided by a quadtree) to determine sizes of LCUs used to encode frame(s) of the encoded video sequence, split information that describes how each CU of a frame of the encoded video sequence is split (and likewise, how sub-CUs are split), modes indicating how each split is encoded (e.g., intra- or inter-prediction, and for intra-prediction an intra-prediction encoding mode), one or more reference frames (and/or reference lists containing identifiers for the reference frames) for each inter-encoded PU, and other information to decode the encoded video sequence.</p><p id="p0189" num="0189">Summer 80 combines the residual blocks with the corresponding prediction blocks generated by motion compensation unit 72 or intra-prediction unit 74 to form decoded blocks. If desired, a deblocking filter may also be applied to filter the decoded blocks in order to remove blockiness artifacts. The decoded video blocks are then stored in reference frame store 82, which provides reference blocks for subsequent motion-compensation and also produces decoded video for presentation on a display device (such as display device 32 of <figref idrefs="f0001">FIG. 1</figref>).</p><p id="p0190" num="0190">In this manner, video decoder 30 is an example of a video decoder configured to determine an intra-prediction mode to be used to predict a block of video data, and to<!-- EPO <DP n="52"> --> inverse transform transformed residual data of the block using an inverse transform mapped to the intra-prediction mode. Video decoder 30 is also an example of a video decoder configured to receive an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of encoded video data, determine a second intra-prediction mode from a smaller set of intra-prediction modes to which the first intra-prediction mode is mapped, determine an inverse directional transform to which the second intra-prediction mode is mapped, and apply the inverse directional transform to transformed residual data of the block.</p><p id="p0191" num="0191">Video decoder 30 is also an example of a video decoder configured to receive a first indication of an intra-prediction mode to use to decode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, receive a second indication of one of the multiple possible inverse transforms, and inverse transform the sub-block using the indicated one of the multiple possible inverse transforms.</p><p id="p0192" num="0192">Video decoder 30 is also an example of a video decoder configured to receive values indicative of whether encoded transform coefficients in a received one-dimensional vector of encoded transform coefficients are significant, entropy decode at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values decoded before the at least one of the values, and inverse scan the one-dimensional vector to produce two-dimensional block of the transform coefficients.</p><p id="p0193" num="0193">Video decoder 30 is also an example of a video decoder configured to receive an indication that residual data for a block of video data was transformed using both a first transform and a rotational transform to produce a two-dimensional block of transform coefficients, select a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively inverse scanning a received one-dimensional vector including an encoded version of the residual data for the block based on the selected set of statistics to produce a two-dimensional matrix of transform coefficients for the block.<!-- EPO <DP n="53"> --></p><p id="p0194" num="0194">Video decoder 30 is further an example of a video decoder configured to receive information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode, determine an angle for an edge in the block of video data based on the indication of the DC intra-prediction mode for the block, inverse transform the block using a directional inverse transform mapped to a directional intra-prediction mode having an angle that approximates the angle of the edge, and decode the inverse transformed block.</p><p id="p0195" num="0195"><figref idrefs="f0004">FIG. 4</figref> is a conceptual diagram illustrating graph 104 depicting an example set of directions associated with intra-prediction modes. In the example of <figref idrefs="f0004">FIG. 4</figref>, block 106 can be predicted from neighboring pixels 100A-100AG (neighboring pixels 100) depending on a selected intra-prediction mode. Arrows 102A-102AG (arrows 102) are representative of directions or angles associated with various intra-prediction modes. The example of <figref idrefs="f0004">FIG. 4</figref> is representative of intra-prediction modes provided by the HM. However, in other examples, more or fewer intra-prediction modes may be provided. Although the example of block 106 is an 8x8 pixel block, in general, a block may have any number of pixels, e.g., 4x4, 8x8, 16x16, 32x32, 64x64, 128x128, etc. Although the HM provides for square PUs, the techniques of this disclosure may also be applied to other block sizes, e.g., NxM blocks, where N is not necessarily equal to M.</p><p id="p0196" num="0196">An intra-prediction mode may be defined according to an angle of the prediction direction relative to, for example, a horizontal axis that is perpendicular to the vertical sides of block 106. Thus, each of arrows 102 may represent a particular angle of a prediction direction of a corresponding intra-prediction mode. In some examples, an intra-prediction direction mode may be defined by an integer pair (dx, dy), which may represent the direction the corresponding intra-prediction mode uses for context pixel extrapolation. That is, the angle of the intra-prediction mode may be calculated as dy/dx. In other words, the angle may be represented according to the horizontal offset dx and the vertical offset dy. The value of a pixel at location (x, y) in block 106 may be determined from the one of neighboring pixels 100 through which a line passes that also passes through location (x, y) with an angle of dy/dx.</p><p id="p0197" num="0197">In some examples, each of the intra-prediction modes corresponding to angles represented by arrows 102 may be mapped to a particular transform. Two or more intra-prediction modes may be mapped to the same transform, in some examples. The transforms may correspond to directional transforms, KLTs, rotational transforms, discrete cosine transforms, discrete sine transforms, Fourier transforms, or other<!-- EPO <DP n="54"> --> transforms that are specifically selected for particular intra-prediction modes. Such transforms may be generally referred to as "designed" transforms, in that the transforms are selected for particular intra-prediction modes.</p><p id="p0198" num="0198">As discussed above, in some examples, a set of intra-prediction modes may be mapped, by a many-to-one correspondence, to a smaller set, e.g., a subset, of intra-prediction modes. Stated another way, the angles for the intra-prediction modes in a large set of modes may be mapped to the angles of intra-prediction modes in a smaller set of modes. In some examples, the mapping may be realized using a mathematical formula. For example, the formula may provide a mapping that minimizes the absolute prediction angle difference between the actual prediction direction angle, referred to here as α, and prediction direction angles of a smaller set of intra-prediction modes, referred to here as βi's. Given a prediction direction angle α, the formula may provide a βi such that formula (1) above is satisfied. Formula (1) is restated below for convenience: <maths id="math0002" num="(1)"><math display="block"><msub><mi>arg</mi><mfenced open="{" close="}"><mi mathvariant="normal">βi</mi></mfenced></msub><mspace width="1em"/><mi>min</mi><mspace width="1em"/><mfenced separators=""><mi>min</mi><mo>⁢</mo><mfenced separators=""><mi>abs</mi><mo>⁢</mo><mfenced separators=""><mi mathvariant="normal">α</mi><mo>-</mo><mi mathvariant="normal">βi</mi></mfenced><mo>,</mo><mi>abs</mi><mo>⁢</mo><mfenced separators=""><mo>-</mo><mi mathvariant="normal">α</mi><mo>-</mo><mi mathvariant="normal">βi</mi></mfenced></mfenced></mfenced></math><img id="ib0002" file="imgb0002.tif" wi="137" he="5" img-content="math" img-format="tif"/></maths></p><p id="p0199" num="0199">In one example, the smaller set of intra-prediction modes may have angles that are the same as arrows 102E, 102I, 102M, 102Q, 102U, 102Y, 102AC, and 102AG. Thus, each of the angles of arrows 102 may be mapped to one of the angles for arrows 102E, 102I, 102M, 102Q, 102U, 102Y, 102AC, and 102AG. As one example, angles for arrows 102A-102E may be mapped to the angle for arrow 102E, angles for arrows 102F-102I may be mapped to the angle for arrow 102I, angles for arrows 102J-102M may be mapped to the angle for arrow 102M, angles for arrows 102N-102Q may be mapped to the angle for arrow 102Q, angles for arrows 102R-102U may be mapped to the angle for arrow 102U, angles for arrows 102V-102Y may be mapped to the angle for arrow 102Y, angles for arrows 102Z-102AC may be mapped to the angle for arrow 102AC, and angles for arrows 102AD-102AG may be mapped to the angle for arrow 102AG.</p><p id="p0200" num="0200">Other mappings may also be provided. In some examples, video encoder 20 and video decoder 30 may be configured with a variety of different mappings, and video encoder 20 may provide information indicative of the mapping used for a particular bitstream, e.g., in header data, a sequence parameter set (SPS), or other signaled data.</p><p id="p0201" num="0201">As discussed above, in some examples, a video coding device (such as video encoder 20 or video decoder 30) may be configured to determine whether an edge is present in a block. For example, the video coding device may be configured to<!-- EPO <DP n="55"> --> determine whether an edge is present in block 106 based on an analysis of pixels of one or more neighboring blocks, where the neighboring blocks may include one or more of neighboring pixels 100. In general, a neighboring, previously coded block may share a border with block 106, where the border may correspond to one or more of neighboring pixels 100. For example, a left-neighboring block to block 106 may include neighboring pixels 100I-100P , which define a border between the left-neighboring block and block 106.</p><p id="p0202" num="0202">The video coding device may be configured to calculate gradients for pixels in a neighboring, previously coded block to determine whether an edge is present in the neighboring, previously coded block. The video coding device may further determine whether the edge crosses (that is, intersects) a border between the neighboring, previously coded block and a current block, such as block 106. With respect to the example of the left-neighboring block to block 106 described above, the video coding device may determine whether gradients for pixels in the left-neighboring block indicate the presence of an edge that intersects the border between the left-neighboring block and block 106, where the border is defmed by pixels 100I-100P, in this example. When the video coding device determines that gradients for pixels in the left-neighboring block indicate the presence of an edge and that the edge crosses the border defined by pixels 100I-100P, the video coding device may determine that the edge proceeds into block 106, and as such, that block 106 includes an edge.</p><p id="p0203" num="0203">In some examples, when the video coding device determines that a signaled intra-prediction mode for block 106 is DC prediction mode, and that block 106 includes an edge, the video coding device may predict block 106 using an edge-based intra-prediction mode. Moreover, the video coding device may determine an angle of the edge. The video coding device may then determine an angle of a prediction mode, generally indicated by arrows 102, that most closely approximates the angle of the edge. The video coding device may then select a transform (which may correspond to an inverse transform when decoding) that is mapped to the intra-prediction mode having the angle that most closely approximates the angle of the edge, and apply the selected transform to residual data of block 106. During an encoding process, the video coding device may apply the transform to a TU of block 106, whereas during a decoding process, the video coding device may apply an inverse transform to transformed residual data for block 106.<!-- EPO <DP n="56"> --></p><p id="p0204" num="0204"><figref idrefs="f0005">FIG. 5</figref> is a conceptual diagram illustrating intra-prediction modes 110A-110I (intra-prediction modes 110) of H.264. Intra-prediction mode 110C corresponds to a DC intra-prediction mode, and is therefore not necessarily associated with an actual angle. The remaining intra-prediction modes 110 may be associated with an angle, similar to angles of arrows 102 of <figref idrefs="f0004">FIG. 4</figref>. For example, the angle of intra-prediction mode 110A corresponds to arrow 102Y, the angle of intra-prediction mode 110B corresponds to arrow 102I, the angle of intra-prediction mode 110D corresponds to arrow 102AG, the angle of intra-prediction mode 110E corresponds to arrow 102Q, the angle of intra-prediction mode 110F corresponds to arrow 102U, the angle of intra-prediction mode 110G corresponds to arrow 102M, the angle of intra-prediction mode 110H corresponds to arrow 102AD, and the angle of intra-prediction mode 110I corresponds to arrow 102E.</p><p id="p0205" num="0205">Angles of arrows 102 that do not directly correspond to one of intra-prediction modes 110 may be mapped to one of intra-prediction modes 110. For example, the angle for one of intra-prediction modes 110 that approximates the angle of one of arrows 102 may correspond to the angle to which the one of arrows 102 is mapped.</p><p id="p0206" num="0206">Each of intra-prediction modes 110 may be mapped to a particular transform, e.g., with a one-to-one correspondence. For example, a video coding device, such as video encoder 20 or video decoder 30, may include configuration data that maps intra-prediction mode 110C to a DCT, and each of the other intra-prediction modes 110 to a particular directional transform, e.g., a KLT. Accordingly, angles for each of the intra-prediction modes associated with arrows 102 (<figref idrefs="f0004">FIG. 4</figref>) may be mapped to angles of intra-prediction modes 110 (<figref idrefs="f0005">FIG. 5</figref>). Intra-prediction modes 110 may, in turn, be mapped to transforms, e.g., directional transforms. In this manner, angles for each of the intra-prediction modes associated with arrows 102 (<figref idrefs="f0004">FIG. 4</figref>) may be mapped to directional transforms. Accordingly, video encoder 20 and video decoder 30 may determine a directional transform to apply to a TU based on an intra-prediction mode selected for a PU corresponding to the TU.</p><p id="p0207" num="0207"><figref idrefs="f0006">FIG. 6</figref> is a conceptual diagram illustrating an example zig-zag scan of coefficients 120A-120P (coefficients 120). Coefficeints 120 generally correspond to quantized transform coefficients, resulting from transformation and quantization of pixels of a TU. Video encoder 20 may be configured to scan a block of coefficients using the zig-zag scan of <figref idrefs="f0006">FIG. 6</figref> following, e.g., application of a DCT to a residual block. In this example, the zig-zag scan starts at coefficient 120A, then proceeds to<!-- EPO <DP n="57"> --> coefficient 120B, then to coefficient 120E, then to coefficient 120I, then to coefficient 120F, then to coefficient 120C, then to coefficient 120D, then to coefficient 120G, then to coefficient 120J, then to coefficient 120M, then to coefficient 120N, then to coefficient 120K, then to coefficient 120H, then to coefficient 120L, then to coefficient 1200, and finally to coefficient 120P.</p><p id="p0208" num="0208">By performing this scan, the two-dimensional arrangement of coefficients for pixels may be converted into a one-dimensional array including values for each of coefficients 120. These values may be arranged in the array in the order of the scan. For example, the value for coefficient 120A may be first in the array, followed by values for coefficients 120B, 120E, 120I, 120F, and so on.</p><p id="p0209" num="0209">Other predefined scan patterns may also be defined for other transforms. For example, each directional transform may be associated with a scan pattern that is designed to place low frequency coefficients resulting from the directional transform earlier in an array than higher frequency coefficients. One of the directional transforms may cause lower frequency coefficients to occur along the far left column of a block of transform coefficients, in which case a corresponding scan may be defined that starts at coefficient 120A, then proceeds to coefficient 120E, then to coefficient 120I, then to coefficient 120M, then to 120B, and so on. As another example, another one of the directional transforms may cause lower frequency coefficients to occur along the top row of a block of transform coefficients, in which case a corresponding scan may be defined that starts at coefficient 120A, then proceeds to coefficient 120B, then to coefficient 120C, then to coefficient 120D, then to coefficient 120E, and so on.</p><p id="p0210" num="0210">In some examples, video encoder 20 may be configured to perform an adaptive scan, rather than a predefined scan. The adaptive scan may vary over time based on statistics indicative of whether particular coefficients (that is, coefficients corresponding to coefficients 120) are significant. Moreover, video encoder 20 may calculate separate sets of statistics based on, for example, an intra-prediction mode selected to predict a block, an index of a rotational transform to apply following an initial transform, or other factors.</p><p id="p0211" num="0211">In some examples, video encoder 20 may include two tables for these statistics: a high-dynamic-range table and a dynamically-updating scan table. Assuming that the block to be scanned has NxN coefficients, each of these two tables may also have NxN sizes. The high-dynamic-range table may be a fixed, pre-determined table providing probabilities that each transform coefficient is non-zero. This table may be calculated<!-- EPO <DP n="58"> --> based on a set of training data. Moreover, this table may be used to provide the starting point for the adaptive scan order. In general, the high-dynamic-range table may be static (that is, unchanged) for a bitstream.</p><p id="p0212" num="0212">The dynamically-updating scan table may be updated over time to reflect recently determined statistics for transform coefficients. In particular, video encoder 20 may keep a count of the number of times each coefficient is non-zero. That is, for each transform block, video encoder 20 may increment values in the dynamically-updating scan table corresponding to non-zero coefficients in the current transform block. For example, if the transform coefficient corresponding to coefficient 120E is non-zero, video encoder 20 may add one to the value in the dynamically updating scan table corresponding to coefficient 120E. The values in the dynamically-updating scan table may also be periodically normalized, to prevent the values from exceeding a maximum value.</p><p id="p0213" num="0213">To perform the adaptive scan for a first transform unit of a frame, video encoder 20 may scan based on the high-dynamic-range table alone. Video encoder 20 may also initialize the dynamically-updating scan table by, e.g., setting all values in the dynamically-updating scan table to zero. For each non-zero coefficient in the transform block, video encoder 20 may add one to the collocated value in the dynamically-updating scan table. For subsequent blocks, video encoder 20 may first refer to the dynamically-updating scan table to determine which of the transform coefficients is most likely to be non-zero, then scan in order of decreasing likelihood of coefficients being non-zero. In some cases, two or more values in the dynamically-updating scan table may be equal. In such a case, quantization unit 54 refers to the high-dynamic-range table to determine which coefficient to scan next. In this manner, quantization unit 54 may perform an adaptive scan based on a combination of a high-dynamic-range table and a dynamically-updating scan table.</p><p id="p0214" num="0214">The high-dynamic-range table may be the same for all adaptive scan statistics, in some examples. Thus, video encoder 20 may include dynamically-updating scan tables specific to, for example, the selected intra-prediction mode, the rotational transform index, or a combination thereof. In some examples, video encoder 20 may be configured to select from among predetermined, static scans when a rotational transform is not applied, and to perform an adaptive scan when a rotational transform is applied, and moreover, to select statistics for performing the adaptive scan based on either or both of the selected intra-prediction mode and the index of the selected rotational<!-- EPO <DP n="59"> --> transform. Alternatively, video encoder 20 may be configured to select a predefined scan based on an index of the rotational transform, an intra-prediction mode, or a combination thereof. Video decoder 30 may be configured similarly to video encoder 20 to select an appropriate scan.</p><p id="p0215" num="0215"><figref idrefs="f0007">FIGS. 7A and 7B</figref> are conceptual diagrams illustrating an example quadtree 150 and a corresponding largest coding unit 172. <figref idrefs="f0007">FIG. 7A</figref> depicts an example quadtree 150, which includes nodes arranged in a hierarchical fashion. Each node in a quadtree, such as quadtree 150, may be a leaf node with no children, or have four child nodes. In the example of <figref idrefs="f0007">FIG. 7A</figref>, quadtree 150 includes root node 152. Root node 152 has four child nodes, including leaf nodes 156A-156C (leaf nodes 156) and node 154. Because node 154 is not a leaf node, node 154 includes four child nodes, which in this example, are leaf nodes 158A-158D (leaf nodes 158).</p><p id="p0216" num="0216">Quadtree 150 may include data describing characteristics of a corresponding largest coding unit (LCU), such as LCU 172 in this example. For example, quadtree 150, by its structure, may describe splitting of the LCU into sub-CUs. Assume that LCU 172 has a size of 2Nx2N. LCU 172, in this example, has four sub-CUs 176A-176C (sub-CUs 176) and 174, each of size NxN. Sub-CU 174 is further split into four sub-CUs 178A-178D (sub-CUs 178), each of size N/2xN/2. The structure of quadtree 150 corresponds to the splitting of LCU 172, in this example. That is, root node 152 corresponds to LCU 172, leaf nodes 156 correspond to sub-CUs 176, node 154 corresponds to sub-CU 174, and leaf nodes 158 correspond to sub-CUs 178.</p><p id="p0217" num="0217">Data for nodes of quadtree 150 may describe whether the CU corresponding to the node is split. If the CU is split, four additional nodes may be present in quadtree 150. In some examples, a node of a quadtree may be implemented similar to the following pseudocode:
<pre listing-type="program-listing">       quadtree_node {
               boolean split_flag(1);
              // signaling data
               if (split_flag) {
                      quadtree_node child1;
                      quadtree_node child2;
                      quadtree_node child3;
                      quadtree_node child4;
               }<!-- EPO <DP n="60"> -->
        }</pre>
The split_flag value may be a one-bit value representative of whether the CU corresponding to the current node is split. If the CU is not split, the split_flag value may be '0', while if the CU is split, the split_flag value may be '1'. With respect to the example of quadtree 150, an array of split flag values may be 101000000.</p><p id="p0218" num="0218">In some examples, each of sub-CUs 176 and sub-CUs 178 may be intra-prediction encoded using the same intra-prediction mode. Accordingly, video encoder 20 may provide an indication of the intra-prediction mode in root node 152. Moreover, certain sizes of sub-CUs may have multiple possible transforms for a particular intra-prediction mode. In accordance with the techniques of this disclosure, video encoder 20 may provide an indication of the transform to use for such sub-CUs in root node 152. For example, sub-CUs of size N/2xN/2 may have multiple possible transforms available. Video encoder 20 may signal the transform to use in root node 152. Accordingly, video decoder 30 may determine the transform to apply to sub-CUs 178 based on the intra-prediction mode signaled in root node 152 and the transform signaled in root node 152.</p><p id="p0219" num="0219">As such, video encoder 20 need not signal transforms to apply to sub-CUs 176 and sub-CUs 178 in leaf nodes 156 and leaf nodes 158, but may instead simply signal an intra-prediction mode and, in some examples, a transform to apply to certain sizes of sub-CUs, in root node 152, in accordance with the techniques of this disclosure. In this manner, these techniques may reduce the overhead cost of signaling transform functions for each sub-CU of an LCU, such as LCU 172.</p><p id="p0220" num="0220">In some examples, intra-prediction modes for sub-CUs 176 and/or sub-CUs 178 may be different than intra-prediction modes for LCU 172. Video encoder 20 and video decoder 30 may be configured with functions that map an intra-prediction mode signaled at root node 152 to an available intra-prediction mode for sub-CUs 176 and/or sub-CUs 178. The function may provide a many-to-one mapping of intra-prediction modes available for LCU 172 to intra-prediction modes for sub-CUs 176 and/or sub-CUs 178.</p><p id="p0221" num="0221">While <figref idrefs="f0007">FIG. 7A</figref> illustrates an example of a CU quadtree, it should be understood that a similar quadtree may be applied to TUs of a leaf-node CU. That is, a leaf-node CU may include a TU quadtree that describes partitioning of TUs for the CU. A TU quadtree may generally resemble a CU quadtree, except that the TU quadtree may signal intra-prediction modes for TUs of the CU individually.<!-- EPO <DP n="61"> --></p><p id="p0222" num="0222"><figref idrefs="f0008">FIG. 8</figref> is a flowchart illustrating an example method for selecting a transform and a scan to apply to a block based on an intra-prediction mode selected for the block. Although generally described as performed by components of video encoder 20 (<figref idrefs="f0002">FIG. 2</figref>) for purposes of explanation, it should be understood that other video encoding units, such as processors, processing units, hardware-based coding units such as encoder/decoders (CODECs), and the like, may also be configured to perform the method of <figref idrefs="f0008">FIG. 8</figref>.</p><p id="p0223" num="0223">In the example of <figref idrefs="f0008">FIG. 8</figref>, transform unit 52 may initially receive residual data for a current TU (180). In addition, transform unit 52 may also receive an indication of an intra-prediction mode selected for the TU. From this indication, transform unit 52 may determine a prediction direction the TU (182). For example, transform unit 52 may determine an angle of the prediction direction for the indicated intra-prediction mode.</p><p id="p0224" num="0224">In any case, after determining the intra-prediction mode, transform unit 52 may select a transform to apply to the residual data based on a mapping from the intra-prediction mode to the transform (186). For example, transform unit 52 may select the transform to apply by querying mapping data 66 with the intra-prediction direction and determine the transform to which the intra-prediction direction is mapped. The transform may correspond to a discrete cosine transform or a directional transform, such as a mode dependent directional transform (MDDT). Transform unit 52 may then apply the selected transform to the residual data to transform the residual data (188). In some examples, mapping data 66 may further include an indication that transform unit 52 should apply two or more transforms, such as a rotational transform following the first transform, in which case transform unit 52 may further apply the indicated rotational transform.</p><p id="p0225" num="0225">By transforming the residual data, transform unit 52 may produce a two-dimensional matrix of transform coefficients having the same number of coefficients as the residual data. In the example of <figref idrefs="f0008">FIG. 8</figref>, quantization unit 54 may then quantize the transform coefficients (190). In some examples, quantization unit 54 may scan the two-dimensional matrix of coefficients to produce a one-dimensional array, e.g., before or after quantizing the coefficients. Alternatively, entropy coding unit 56 may scan the two-dimensional matrix.</p><p id="p0226" num="0226">In this example, entropy coding unit 56 may query mapping data 66 to select a scan to apply to the quantized transform coefficients (192). In some examples, mapping data 66 may include data that maps intra-prediction modes to particular, predefined scan<!-- EPO <DP n="62"> --> patterns. In some examples, mapping data 66 may include data that maps transforms to predefined scan patterns. In some examples, e.g., where mapping data 66 indicates that a rotational transform is to be applied to transform coefficients, mapping data 66 may further indicate that an adaptive scan should be performed, or a predefined scan to which the rotational transform is mapped. In examples for which an adaptive scan is performed, mapping data 66 may further include scan statistics, e.g., a high-dynamic-range table and a dynamically-updating scan table, mapped to the intra-prediction mode, an index of the first transform, an index of the rotational transform, a combination thereof, and/or other factors.</p><p id="p0227" num="0227">Entropy coding unit 56 may then scan the quantized transform coefficients using the selected scan (194), e.g., the predefined scan or the adaptive scan based on selected scan statistics. In some examples, entropy coding unit 56 may be configured with a scan position (which may be less than or equal to the number of transform coefficients) after which entropy coding unit 56 may zero out the coefficient values in the array. After scanning a number of coefficients equal to the scan position, entropy coding unit 56 may set remaining array values equal to zero. Zeroing out transform coefficients may occur before or after the scan, in some examples.</p><p id="p0228" num="0228">In some examples, entropy coding unit 56 may then entropy encode the scanned coefficients in the array following the scan (196). Alternatively, in some examples, entropy coding unit 56 may entropy encode the coefficients as they are scanned. In any case, entropy coding unit 56 may utilize either CABAC or CAVLC to entropy encode the coefficients.</p><p id="p0229" num="0229">When using CABAC, and when performing an adaptive scan, entropy coding unit 56 may entropy encode syntax elements including significant coefficient flags and last coefficient flag. Entropy coding unit 56 may select context models for entropy encoding significant coefficient flags based on a block type (intra or inter), a selected intra-prediction mode (assuming that the block is predicted in an intra-mode), and/or a type of transform applied (e.g., DCT or directional/KLT). Entropy coding unit 56 may select context models for entropy encoding last coefficient flags based on the order index in the adaptive scan, block type, spatial prediction direction, and/or a selected transform.</p><p id="p0230" num="0230">In this manner, the method of <figref idrefs="f0008">FIG. 8</figref> represents an example of a method including calculating a residual block for a block of video data based on a predicted<!-- EPO <DP n="63"> --> block formed using an intra-prediction mode, and transforming the residual block using a transform mapped to the intra-prediction mode.</p><p id="p0231" num="0231"><figref idrefs="f0009">FIG. 9</figref> is a flowchart illustrating another example method for selecting a transform and scan to apply to a block of residual data. In general, <figref idrefs="f0009">FIG. 9</figref> conforms substantially to <figref idrefs="f0008">FIG. 8</figref>. However, in the example of <figref idrefs="f0009">FIG. 9</figref>, after receiving the residual data (180) and the indication of an intra-prediction mode selected for the TU, transform unit 52 may determine a first prediction direction for predicting the TU (183). For example, transform unit 52 may determine an angle of the prediction direction for the indicated intra-prediction mode.</p><p id="p0232" num="0232">Transform unit 52 may then determine a second direction mapped to the first prediction direction (184). For example, transform unit 52 may query mapping data 66 to determine a second intra-prediction mode to which the first intra-prediction mode is mapped. In some examples, transform unit 52 may determine an angle that approximates the angle of the indicated intra-prediction mode, and select a second intra-prediction mode corresponding to the determined angle. Transform unit 52 may then select a transform mapped to the second prediction data (185). After selecting the transform, which may correspond to selecting multiple transforms, video encoder 20 generally performs the remaining steps of <figref idrefs="f0009">FIG. 9</figref> in a manner similar to the corresponding steps described with respect to <figref idrefs="f0008">FIG. 8</figref>.</p><p id="p0233" num="0233">In this manner, the method of <figref idrefs="f0009">FIG. 9</figref> is an example of a method including receiving an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of video data, determining a second intra-prediction mode from a smaller set of intra-prediction modes to which the first intra-prediction mode is mapped, determining a directional transform to which the second intra-prediction mode is mapped, and applying the directional transform to residual data of the block.</p><p id="p0234" num="0234"><figref idrefs="f0010">FIG. 10</figref> is a flowchart illustrating an example method for applying an intra-prediction mode and transform to particular-sized sub-CUs. Although generally described as performed by components of video encoder 20 (<figref idrefs="f0002">FIG. 2</figref>) for purposes of explanation, it should be understood that other video encoding units, such as processors, processing units, hardware-based coding units such as encoder/decoders (CODECs), and the like, may also be configured to perform the method of <figref idrefs="f0010">FIG. 10</figref>. It should also be understood that in other examples, similar methods may include additional or alternative steps to those illustrated in <figref idrefs="f0010">FIG. 10</figref>, or may perform the illustrated steps in a different order, without departing from the described techniques.<!-- EPO <DP n="64"> --></p><p id="p0235" num="0235">Techniques for selecting and applying a transform as described with respect to <figref idrefs="f0010">FIG. 10</figref> may correspond to steps 186 and 188 of <figref idrefs="f0008">FIG. 8</figref>. Techniques for applying various intra-prediction modes to blocks of various sizes as described with respect to <figref idrefs="f0010">FIG. 10</figref> may be performed prior to step 180 of <figref idrefs="f0008">FIG. 8</figref>.</p><p id="p0236" num="0236">Intra-prediction unit 46 may receive a block of pixels, e.g., an LCU (200). Intra-prediction unit 46 may then determine an intra-prediction mode to apply to the LCU and signal the determined intra-prediction mode for the LCU (201), e.g., at a root node of a quadtree data structure corresponding to the LCU. Intra-prediction unit 46 may then determine sizes of sub-CUs for which only a subset of intra-prediction modes are available (202). Intra-prediction unit 46 may further partition LCU into one or more sub-CUs and determine whether any of the sub-CUs have a size for which only a subset of the intra-prediction modes are available (204).</p><p id="p0237" num="0237">If the LCU includes sub-CUs of a size for which only a subset of intra-prediction modes are available ("YES" branch of 184), intra-prediction unit 46 may intra-predict the sub-CUs using an intra-prediction mode to which the intra-prediction mode selected for the LCU is mapped (206). On the other hand, if the LCU does not include any sub-CUs that are of such a size ("NO" branch of 184), intra-prediction unit 46 may apply the mode signaled for the LCU to all sub-blocks of the LCU (208).</p><p id="p0238" num="0238">Video encoder 20 may then calculate residual values for sub-CUs of the LCU. Then, transform unit 52 may determine sub-CU sizes for which multiple transforms are possible based on the signaled intra-prediction mode for the LCU (210). Transform unit 52 may further determine whether any of the sub-CUs of the LCU are of a size for which multiple transforms are possible (212). If at least one sub-CU is of a size for which multiple transforms are possible ("YES" branch of 192), transform unit 52 may select and signal a transform to apply for sub-CUs of that size (214). For example, transform unit 52 may signal the transform to apply to sub-CUs of that size in the root node of the quadtree for the LCU. Transform unit 52 may also apply the signaled transform to all sub-blocks in the LCU of that size (216). On the other hand, if the LCU does not contain any sub-CUs for which multiple transforms are possible ("NO" branch of 192), transform unit 52 may apply transforms to sub-CUs of the LCU based purely on the signaled intra-prediction mode for the LCU (218), such that no signaling regarding transforms is necessary.</p><p id="p0239" num="0239">In this manner, the method of <figref idrefs="f0010">FIG. 10</figref> is an example of a method including selecting an intra-prediction mode to use to encode a block of video data, determining<!-- EPO <DP n="65"> --> whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode selecting one of the multiple possible transforms, transforming the sub-block using the selected one of the multiple possible transforms, and providing an indication of the selected one of the multiple possible transforms for the size of the block.</p><p id="p0240" num="0240"><figref idrefs="f0011">FIG. 11</figref> is a flowchart illustrating an example method for performing a adaptive scan based on a selected transform applied to a block. Although generally described as performed by components of video encoder 20 (<figref idrefs="f0002">FIG. 2</figref>) for purposes of explanation, it should be understood that other video encoding units, such as processors, processing units, hardware-based coding units such as encoder/decoders (CODECs), and the like, may also be configured to perform the method of <figref idrefs="f0011">FIG. 11</figref>.</p><p id="p0241" num="0241">It should also be understood that in other examples, similar methods may include additional or alternative steps to those illustrated in <figref idrefs="f0011">FIG. 11</figref>, or may perform the illustrated steps in a different order, without departing from the described techniques. Techniques for adaptively scanning coefficients following a cascaded transform as illustrated in <figref idrefs="f0011">FIG. 11</figref> may correspond to steps 192 and 194 of <figref idrefs="f0008">FIG. 8</figref>. The techniques for adaptively scanning residual coefficients of <figref idrefs="f0011">FIG. 11</figref> may be applied to residual data following intra-prediction or inter-prediction.</p><p id="p0242" num="0242">Initially, transform unit 52 of video encoder 20 may receive a residual block (230). The residual block may correspond to the residual following intra-prediction or inter-prediction of a CU. The residual block may be the same size or a different size than a corresponding prediction unit of the CU. Transform unit 52 may then transform the residual block (232). In some examples, transform unit 52 may apply a directional transform corresponding to an intra-prediction mode from a subset of intra-prediction modes, in accordance with techniques of this disclosure. In other examples, transform unit 52 may apply a discrete cosine transform.</p><p id="p0243" num="0243">Transform unit 52 may then apply a rotational transform to the transformed block (234). For transform units (TUs) of sizes 8x8 and larger to which transform unit 52 applies a DCT, transform unit 52 may apply the rotational transform to the lowest frequency 8x8 DCT coefficients. For TUs smaller than 8x8, transform unit 52 may apply the rotational transform to the entire TU. If the PU corresponding to the TU was intra-prediction encoded, transform unit 52 may select a rotational transform based on<!-- EPO <DP n="66"> --> the intra-prediction mode used to predict the PU, e.g., where a subset of intra-prediction modes may be mapped to rotational transforms. These rotational transforms may be referred to as mode dependent rotational transforms (MDROTs). In some examples, transform unit 52 may cascade a rotational transform (or other secondary separable transform) following a mode dependent directional transform (MDDT), which may be a KLT.</p><p id="p0244" num="0244">Following the rotational transform, quantization unit 54 may quantize the transformed coefficients, in some examples. Then, entropy coding unit 56 may select a set of statistics to use to perform an adaptive scan of the transform coefficients. The set of statistics may include a high dynamic range (HDR) table and a dynamically updating (DU) table. Either or both of the HDR and DU tables may be selected for a particular scenario, e.g., whether intra-prediction or inter-prediction was used to predict a PU, a particular intra-prediction mode for the PU when intra-prediction is used, whether a DCT or KLT was applied to the TU corresponding to the PU, the index of the rotational transform used, or any combination thereof. In this manner, entropy coding unit 56 may select the HDR and/or DU tables for use during the adaptive scan (236).</p><p id="p0245" num="0245">As discussed above, the HDR table may include a predefined set of data indicating probabilities that coefficients of each location in a matrix are non-zero. The HDR table may be produced using a set of training data, and may remain the same throughout an entire bitstream. Entropy coding unit 56 may collect statistics individual to a frame, slice, group of pictures, or other unit of video data to calculate values for the DU table. The DU table may therefore also indicate probabilities that coefficients of each location in the matrix are non-zero.</p><p id="p0246" num="0246">To perform the adaptive scan, entropy coding unit 56 may first determine the location in the matrix having the highest probability of including a non-zero coefficient using the DU table (238). In some cases, there may be two or more locations in the matrix with equal probabilities of having non-zero coefficients. Thus, entropy coding unit 56 may determine whether there are multiple locations in the matrix with the same probabilities of including non-zero coefficients (240). If there are multiple locations in the matrix with the same probabilities of including non-zero coefficients ("YES" branch of 240), entropy coding unit 56 may determine the location in the matrix having the highest probability of including a non-zero coefficient using the HDR table (242).</p><p id="p0247" num="0247">Entropy coding unit 56 may then scan and entropy encode the coefficient in the determined location (244). Entropy coding unit 56 may also determine whether the<!-- EPO <DP n="67"> --> scanned coefficient was in fact non-zero and set the value for a significant coefficient flag to indicate whether the scanned coefficient was non-zero, and hence significant. Entropy coding unit 56 may then determine whether all coefficients in the matrix have been scanned (246). If not ("NO" branch of 246), entropy coding unit 56 may determine the location in the matrix having the next highest probability of including a non-zero coefficient using the DU table (or possibly the HDR table), and scan the coefficient in this location.</p><p id="p0248" num="0248">After all coefficients have been scanned ("YES branch of 246), entropy coding unit may stop the scan. Moreover, in some examples, entropy coding unit 56 may set the value of a last coefficient flag for each coefficient to indicate whether the corresponding coefficient is the last coefficient in the flag. After determining that all coefficients have been scanned ("YES" branch of 246), entropy coding unit 56 may set the value for the last coefficient flag corresponding to the last scanned coefficient equal to one. Using the techniques of <figref idrefs="f0012">FIG. 12</figref> as described below, entropy coding unit 56 may encode syntax elements including the significant coefficient flags and last coefficient flags.</p><p id="p0249" num="0249">In some examples, following the scan (whether adaptive or fixed), video encoder 20 may zero out coefficients in the array produced by the scan, e.g., all coefficients after position N in the array, where N is an integer between zero and the length of the array. In other examples, video encoder 20 may zero out coefficients in certain locations of the matrix following the transform(s) or quantization. These locations may correspond to an upper-left corner of the matrix, for example. In general, zeroing out these coefficients may result in zeroing out of higher frequency coefficients, which may improve coding efficiency without much impact on quality.</p><p id="p0250" num="0250">In this manner, the method of <figref idrefs="f0011">FIG. 11</figref> is an example of a method including transforming residual data for a block of video data using a first transform to produce an intermediate, two-dimensional block of transform coefficients, transforming the intermediate, two-dimensional block of transform coefficients using a rotational transform to produce a two-dimensional block of transform coefficients, selecting a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively scanning the two-dimensional block of transform coefficients based on the selected set of statistics.<!-- EPO <DP n="68"> --></p><p id="p0251" num="0251"><figref idrefs="f0012">FIG. 12</figref> is a flowchart illustrating an example method for selecting a context model to use when scanning and entropy encoding syntax elements that describe adaptively scanned coefficients. Although generally described as performed by components of video encoder 20 (<figref idrefs="f0002">FIG. 2</figref>) for purposes of explanation, it should be understood that other video encoding units, such as processors, processing units, hardware-based coding units such as encoder/decoders (CODECs), and the like, may also be configured to perform the method of <figref idrefs="f0012">FIG. 12</figref>.</p><p id="p0252" num="0252">It should also be understood that in other examples, similar methods may include additional or alternative steps to those illustrated in <figref idrefs="f0012">FIG. 12</figref>, or may perform the illustrated steps in a different order, without departing from the described techniques. Techniques for selecting a context model to use when scanning and entropy encoding syntax elements that describe adaptively scanned coefficients as illustrated in <figref idrefs="f0011">FIG. 11</figref> may correspond to steps 192-196 of <figref idrefs="f0008">FIG. 8</figref>. The techniques of <figref idrefs="f0012">FIG. 12</figref> may be performed prior to, during, or after the adaptive scan of <figref idrefs="f0011">FIG. 11</figref> is performed.</p><p id="p0253" num="0253">Entropy coding unit 56 may receive a matrix of quantized transform coefficients (250), e.g., from quantization unit 54. In general, using the example method of <figref idrefs="f0012">FIG. 12</figref>, entropy coding unit 56 may encode syntax elements that describe the received coefficients. The syntax elements may include, for each coefficient, a significant coefficient flag and a last coefficient flag. The significant coefficient flag may indicate whether the corresponding coefficient is significant, e.g., whether the value of the corresponding coefficient is greater than zero. The last coefficient flag may indicate whether the corresponding coefficient is the last coefficient of an adaptive scan.</p><p id="p0254" num="0254">Entropy coding unit 56 may determine positions of significant coefficients in the received matrix. Entropy coding unit 56 may form syntax elements indicating positions of significant coefficients in the received matrix (252). For example, for each coefficient in the matrix, entropy coding unit 56 may determine whether the coefficient is greater than zero, and if so, set a value in a syntax element matrix collocated with the coefficient equal to one, otherwise, entropy coding unit may set the value collocated with the coefficient equal to zero. Entropy coding unit 56 may then update a dynamically updating scan table using the syntax element matrix (254). For example, entropy coding unit 56 may add, to the current value of each element in the dynamically updating scan table, the value of the collocated syntax element in the syntax element matrix.<!-- EPO <DP n="69"> --></p><p id="p0255" num="0255">Entropy coding unit 56 may then scan a first one of the syntax elements in the syntax element matrix (256). Entropy coding unit 56 may apply a zig-zag scan, such as that shown in <figref idrefs="f0006">FIG. 6A</figref>, or a scan selected based on a block type (inter- or intra-predicted block), a spatial prediction direction if the block is an intra-prediction encoded block, and/or a type of transform used (e.g., DCT or directional transform). Next, entropy coding unit 56 may select a context model for encoding the scanned syntax element (258). In general, the context model may be selected based on the number of significant (e.g., non-zero) coefficients in the previously scanned N coefficients, where N is a non-zero integer value. N may be selected based on the size of the block.</p><p id="p0256" num="0256">After selecting the context model to use to encode the current syntax element, entropy coding unit 56 may entropy encode the scanned syntax element using the selected context model (260). Entropy coding unit 56 may then determine whether the encoded syntax element is the last syntax element to be encoded (262). If the syntax element is the last syntax element ("YES" branch of 262), entropy coding unit 56 may stop scanning coefficients. On the other hand, if the syntax element is not the last syntax element ("NO" branch of 262), entropy coding unit 56 may scan the next syntax element (264), and again select a context model for encoding the scanned syntax element, e.g., based on a number of significant coefficients in the previously scanned N coefficients.</p><p id="p0257" num="0257">The example of <figref idrefs="f0012">FIG. 12</figref> is primary discussed with respect to syntax elements describing whether particular coefficients are significant or not. These syntax elements may include, for example, significant coefficient flags, e.g., one-bit flags indicative of whether corresponding coefficients are significant, e.g., non-zero. It should be understood that similar techniques may be applied with respect to syntax elements describing whether a particular coefficient is the last coefficient in the adaptive scan. For example, similar techniques may be applied to a last coefficient flag. When encoding last coefficient flags using CABAC, the context model may be based on the order index in the adaptive scan that is based on block type, spatial prediction direction, and/or a selected transform.</p><p id="p0258" num="0258">The techniques of <figref idrefs="f0012">FIG. 12</figref> may be performed by a video encoding device, such as video encoder 20. A video decoder may perform an inverse scan using the syntax elements encoded according to <figref idrefs="f0012">FIG. 12</figref>. For example, video decoder 30 may receive an indication of an intra-prediction mode used to predict an encoded block, an indication of a rotational transform used to transform the encoded block, or other such data. Video<!-- EPO <DP n="70"> --> encoder 20 and video decoder 30 may each be configured with the same high dynamic range table. In examples where video encoder 20 includes multiple high dynamic range tables, video encoder 20 and video decoder 30 may each be configured with the same set of high dynamic range tables. In such examples, video decoder 30 may use received information to select the same high dynamic range table as that used by video encoder 20 to perform the adaptive scan.</p><p id="p0259" num="0259">As noted above, video encoder 20 may perform the adaptive scan based on statistics indicative of the likelihood (or probability) that a coefficient in a particular position in a matrix is non-zero. Video encoder 20 may maintain a dynamically updating scan table that indicates this likelihood, updating the dynamically updating scan table for each scanned block. By encoding syntax elements indicative of which of the coefficients of a certain block are significant, and which coefficient is the last in the adaptive scan, video encoder 20 may provide video decoder 30 with information that can be used to inverse scan received coefficients.</p><p id="p0260" num="0260">For example, video decoder 30 may decode the syntax elements, then update a local version of the dynamically updating scan table using the syntax elements. Video decoder 30 may then entropy decode encoded coefficients and place the decoded coefficients in a corresponding position of a matrix having a next-highest probability of being significant (e.g., non-zero). In this manner, video decoder 30 may reconstruct a matrix of quantized transform coefficients from a received vector of entropy encoded coefficients using an adaptive inverse scan.</p><p id="p0261" num="0261">In this manner, the method of <figref idrefs="f0012">FIG. 12</figref> is an example of a method including scanning a two-dimensional block of transform coefficients to produce a one-dimensional vector of the transform coefficients, determining values indicative of whether the transform coefficients in the one-dimensional vector are significant, and entropy encoding at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values encoded before the at least one of the values.</p><p id="p0262" num="0262"><figref idrefs="f0013">FIG. 13</figref> is a flowchart illustrating an example method for decoding a TU that has been encoded using one or more of the techniques of this disclosure. Although generally described as performed by components of video decoder 30 (<figref idrefs="f0003">FIG. 3</figref>) for purposes of explanation, it should be understood that other video decoding units, such as processors, processing units, hardware-based coding units such as encoder/decoders (CODECs), and the like, may also be configured to perform the method of <figref idrefs="f0013">FIG. 13</figref>. It<!-- EPO <DP n="71"> --> should also be understood that in other examples, similar methods may include additional or alternative steps to those illustrated in <figref idrefs="f0013">FIG. 13</figref>, or may perform the illustrated steps in a different order, without departing from the described techniques.</p><p id="p0263" num="0263">Initially, video decoder 30 may receive encoded residual data (300). In the example of <figref idrefs="f0013">FIG. 13</figref>, the residual data corresponds to the residual of a CU including one or more PUs predicted in an intra-prediction mode, for purposes of illustration. In accordance with the techniques of this disclosure, video decoder 30 may determine a first prediction direction for prediction data associated with the received residual data (302). The prediction direction may correspond to an intra-prediction mode signaled at the root of a quadtree corresponding to the CU.</p><p id="p0264" num="0264">Video decoder 30 may determine a second prediction direction mapped to the first prediction direction (304). For example, mapping data 84 may provide a many-to-one mapping of a set of intra-prediction modes to a smaller set, e.g., a subset, of intra-prediction modes. Accordingly, video decoder 30 may refer to mapping data 84 to determine the second prediction direction mapped to the first prediction direction. Entropy decoding unit 70 of video decoder 30 may then begin entropy decoding the received coefficients (306).</p><p id="p0265" num="0265">Entropy decoding unit 70 may also inverse scan the coefficients during or following entropy decoding (308). In some examples, entropy decoding unit 70 may inverse a fixed scan to which the second prediction direction is mapped, e.g., as indicated by mapping data 84. In other examples, e.g., when a first transform is cascaded by a rotational transform, entropy decoding unit 70 may inverse a dynamic scan. As discussed above, entropy decoding unit 70 may, in such examples, receive and decode syntax elements, such as significant coefficient flags and last coefficient flags, such that entropy decoding unit 70 can produce a dynamically updating table identical to that used by an encoder, such as video encoder 20, when the encoder adaptively scanned the residual data.</p><p id="p0266" num="0266">In any case, following the inverse scan, entropy decoding unit 70 may produce a two-dimensional matrix including quantized transform coefficients. Thus, inverse quantization unit 76 may inverse quantize the quantized transform coefficients of the matrix (310). Inverse transform unit 78 may select an inverse transform mapped to the second prediction direction (312) and inverse transform the transform coefficients using the selected inverse transform (314). For example, inverse transform unit 76 may refer to mapping data 84 to select the inverse transform. In some examples, mapping data 84<!-- EPO <DP n="72"> --> may indicate both an inverse rotational transform and another inverse transform to apply, in which case inverse transform unit 78 may first apply the inverse rotational transform then apply the other inverse transform to the transform coefficients.</p><p id="p0267" num="0267">In accordance with the techniques of this disclosure, in some examples, there may be a sub-block of the transform coefficients for which multiple inverse transforms are possible. In such examples, video decoder 30 may determine the inverse transform to apply using an indication of the transform applied by the video encoder. For example, video decoder 30 may receive an indication of the transform used for the sub-block in the root node of a quadtree corresponding to the block including the residual data.</p><p id="p0268" num="0268">After applying the inverse transform(s), video decoder 30 obtains residual blocks similar to those calculated by video encoder 20 during encoding of the video data. Intra-prediction unit 74 may provide a prediction unit for the residual data to summer 80, which may combine the prediction unit and the residual data to produce a decoded CU (316). Video decoder 30 may assemble a decoded frame including the decoded CU in reference frame store 82. The decoded frame can then be rendered for display and/or used for reference when decoding other frames.</p><p id="p0269" num="0269">In this manner, the method of <figref idrefs="f0013">FIG. 13</figref> is an example of a method including receiving an indication of a first intra-prediction mode in a first set of intra-prediction modes for a block of encoded video data, determining a second intra-prediction mode from a smaller set of intra-prediction modes to which the first intra-prediction mode is mapped, determining an inverse directional transform to which the second intra-prediction mode is mapped, and applying the inverse directional transform to transformed residual data of the block. '</p><p id="p0270" num="0270">The method of <figref idrefs="f0013">FIG. 13</figref> is also an example of a method including receiving a first indication of an intra-prediction mode to use to decode a block of video data, determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, receiving a second indication of one of the multiple possible inverse transforms, and inverse transforming the sub-block using the indicated one of the multiple possible inverse transforms.<!-- EPO <DP n="73"> --></p><p id="p0271" num="0271">The method of <figref idrefs="f0013">FIG. 13</figref> is also an example of a method including receiving an indication that residual data for a block of video data was transformed using both a first transform and a rotational transform to produce a two-dimensional block of transform coefficients, selecting a set of statistics associated with at least one of the first transform and the rotational transform, wherein the set of statistics provides likelihoods that locations in the two-dimensional block of transform coefficients will be non-zero, and adaptively inverse scanning a received one-dimensional vector including an encoded version of the residual data for the block based on the selected set of statistics to produce a two-dimensional matrix of transform coefficients for the block.</p><p id="p0272" num="0272">The method of <figref idrefs="f0013">FIG. 13</figref> is also an example of a method including receiving values indicative of whether encoded transform coefficients in a received one-dimensional vector of encoded transform coefficients are significant, entropy decoding at least one of the values using a context model selected based on at least a percentage of significant coefficients in a predetermined number of the values decoded before the at least one of the values, and inverse scanning the one-dimensional vector to produce two-dimensional block of the transform coefficients.</p><p id="p0273" num="0273"><figref idrefs="f0014">FIG. 14</figref> is a flowchart illustrating an example method for selecting a transform to apply to an intra-coded block including an edge for which DC intra-prediction mode is signaled. Although described with respect to video decoder 30 of <figref idrefs="f0003">FIG. 3</figref>, it should be understood that similar (reciprocal) techniques may be applied by video encoder 20 of <figref idrefs="f0002">FIG. 2</figref>, or other video coding devices.</p><p id="p0274" num="0274">Video encoder 30 may receive an intra-coded block, e.g., a TU (180). The block may comprise a block of transform coefficients corresponding to a node in a TU quadtree. The TU quadtree node may include an indication of the intra-prediction mode to be applied to calculate a prediction value for the block. Accordingly, video decoder 30 may determine the prediction mode and whether DC prediction mode is signaled for the block (352). If DC prediction mode is signaled for the block ("YES" branch of 352), video decoder 30 may further determine whether an edge exists in the block (354). For example, as discussed above, video decoder 30 may examine neighboring, previously coded blocks to determine if an edge is detected in the previously coded blocks, and whether the edge intersects a boundary between the previously coded block and the current block.</p><p id="p0275" num="0275">If an edge is determined to exist in the block ("YES" branch of 354), video decoder 30 may calculate a predicted value for the block using an edge-based prediction<!-- EPO <DP n="74"> --> mode (356). Furthermore, video decoder 30 may determine an angle of the edge (358) and determine an intra-mode with an angle that closely approximates the angle of the edge (360). For example, video decoder 30 may calculate differences between angles for one or more of the possible intra-prediction modes and the angle of the edge, and select the intra-prediction mode having the lowest difference.</p><p id="p0276" num="0276">Determining this prediction mode is generally performed only to determine the transform that is mapped to that prediction mode, though, as video decoder 30 generally predicts a value for the block using the edge-based prediction mode, in this example. That is, video decoder 30 may then select a transform mapped to the determined intra-prediction mode (362), that is, the intra-prediction mode having an angle that closely approximates the angle of the edge. Video decoder 30 may then transform the block using the selected transform (364).</p><p id="p0277" num="0277">On the other hand, if DC prediction mode was not signaled for the block ("NO" branch of 352), video decoder 30 may predict the block using the signaled mode (353). If an edge is not determined to exist in the block when DC prediction mode is signaled ("NO" branch of 354), video decoder 30 may predict the block using DC prediction mode, as signaled (366). Video decoder 30 may also select the transform mapped to the prediction mode (e.g., DC or directional, as signaled) (368) or in some examples a default transform, such as a DCT. Video decoder 30 may also transform the block using the selected transform in this case (364).</p><p id="p0278" num="0278">After transforming the block, which in this example corresponds to inverse transforming the block, video decoder 30 reproduces a block of residual values in the spatial domain. To decode the block, video decoder 30 may add the block of residual values to the predicted block (resulting from step 353, 356, or 366). The steps of adding the residual value to the predicted value are not shown in <figref idrefs="f0014">FIG. 14</figref> for brevity, but may be performed after step 364.</p><p id="p0279" num="0279">In this manner, the method of <figref idrefs="f0014">FIG. 14</figref> is an example of a method including receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode, determining an angle for an edge in the block of video data based on the indication of the DC intra-prediction mode for the block, inverse transforming the block using a directional inverse transform mapped to a directional intra-prediction mode having an angle that approximates the angle of the edge, and decoding the inverse transformed block.<!-- EPO <DP n="75"> --></p><p id="p0280" num="0280">As noted above, a similar method may be performed by, e.g., video encoder 20. Such a method may include determining that a block to be intra-prediction encoded contains an edge within the block, calculating a residual block for the block based on a prediction value calculated using an edge directed intra-prediction mode, transforming the residual block using a directional transform mapped to a directional intra-prediction mode having an angle that approximates an angle of the edge, and outputting information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</p><p id="p0281" num="0281">In one or more examples, the functions described may be implemented in hardware, software, firmware, or any combination thereof. If implemented in software, the functions may be stored on or transmitted over, as one or more instructions or code, a computer-readable medium and executed by a hardware-based processing unit. Computer-readable media may include computer-readable storage media, which corresponds to a tangible medium such as data storage media, or communication media including any medium that facilitates transfer of a computer program from one place to another, e.g., according to a communication protocol. In this manner, computer-readable media generally may correspond to (1) tangible computer-readable storage media which is non-transitory or (2) a communication medium such as a signal or carrier wave. Data storage media may be any available media that can be accessed by one or more computers or one or more processors to retrieve instructions, code and/or data structures for implementation of the techniques described in this disclosure. A computer program product may include a computer-readable medium.</p><p id="p0282" num="0282">By way of example, and not limitation, such computer-readable storage media can comprise RAM, ROM, EEPROM, CD-ROM or other optical disk storage, magnetic disk storage, or other magnetic storage devices, flash memory, or any other medium that can be used to store desired program code in the form of instructions or data structures and that can be accessed by a computer. Also, any connection is properly termed a computer-readable medium. For example, if instructions are transmitted from a website, server, or other remote source using a coaxial cable, fiber optic cable, twisted pair, digital subscriber line (DSL), or wireless technologies such as infrared, radio, and microwave, then the coaxial cable, fiber optic cable, twisted pair, DSL, or wireless technologies such as infrared, radio, and microwave are included in the definition of medium. It should be understood, however, that computer-readable storage media and data storage media do not include connections, carrier waves, signals, or other transient<!-- EPO <DP n="76"> --> media, but are instead directed to non-transient, tangible storage media. Disk and disc, as used herein, includes compact disc (CD), laser disc, optical disc, digital versatile disc (DVD), floppy disk and Blu-ray disc, where disks usually reproduce data magnetically, while discs reproduce data optically with lasers. Combinations of the above should also be included within the scope of computer-readable media.</p><p id="p0283" num="0283">Instructions may be executed by one or more processors, such as one or more digital signal processors (DSPs), general purpose microprocessors, application specific integrated circuits (ASICs), field programmable logic arrays (FPGAs), or other equivalent integrated or discrete logic circuitry. Accordingly, the term "processor," as used herein may refer to any of the foregoing structure or any other structure suitable for implementation of the techniques described herein. In addition, in some aspects, the functionality described herein may be provided within dedicated hardware and/or software modules configured for encoding and decoding, or incorporated in a combined codec. Also, the techniques could be fully implemented in one or more circuits or logic elements.</p><p id="p0284" num="0284">The techniques of this disclosure may be implemented in a wide variety of devices or apparatuses, including a wireless handset, an integrated circuit (IC) or a set of ICs (e.g., a chip set). Various components, modules, or units are described in this disclosure to emphasize functional aspects of devices configured to perform the disclosed techniques, but do not necessarily require realization by different hardware units. Rather, as described above, various units may be combined in a codec hardware unit or provided by a collection of interoperative hardware units, including one or more processors as described above, in conjunction with suitable software and/or firmware.<!-- EPO <DP n="77"> --></p><heading id="h0006"><b>FURTHER SUMMARY OF THE INVENTION</b></heading><p id="p0285" num="0285"><ol><li>1. A method of encoding video data, the method comprising:
<ul><li>selecting an intra-prediction mode to use to encode a block of video data;</li><li>determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode;</li><li>when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode:
<ul><li>selecting one of the multiple possible transforms;</li><li>transforming the sub-block using the selected one of the multiple possible transforms; and</li><li>providing an indication of the selected one of the multiple possible transforms for the size of the block.</li></ul></li></ul></li><li>2. The method of 1, further comprising, when the block does not include the sub-block of the size for which multiple transforms are possible, transforming the block using a transform associated with the intra-prediction mode selected for the block.</li><li>3. The method of 1, further comprising transforming all sub-blocks of the block having the size for which multiple transforms are possible using the selected one of the multiple possible transforms.</li><li>4. The method of 1, wherein the intra-prediction mode comprises a first intra-prediction mode, and wherein the sub-block comprises a first sub-block, the method further comprising:
<ul><li>determining whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available;</li><li>when the block includes the second sub-block of the size for which the first intra-prediction mode is not available:
<ul><li>determining a second intra-prediction mode to which the first intra-prediction mode is mapped; and</li><li>predicting the second sub-block using the second intra-prediction mode.</li></ul></li></ul></li><li>5. The method of 4, wherein the first sub-block and the second sub-block are the same sub-block.<!-- EPO <DP n="78"> --></li><li>6. The method of 4, further comprising, when the first intra-prediction mode is available for all sub-blocks of the block, predicting all sub-blocks using the first intra-prediction mode.</li><li>7. The method of 1, wherein providing the indication comprises providing the indication in a root node of a quadtree data structure corresponding to the block of video data.</li><li>8. An apparatus for encoding video data, the apparatus comprising a video encoder configured to select an intra-prediction mode to use to encode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode, select one of the multiple possible transforms, transform the sub-block using the selected one of the multiple possible transforms, and provide an indication of the selected one of the multiple possible transforms for the size of the block.</li><li>9. The apparatus of 8, wherein when the block does not include the sub-block of the size for which multiple transforms are possible, the video encoder is configured to transform the block using a transform associated with the intra-prediction mode selected for the block.</li><li>10. The apparatus of 8, wherein the video encoder is configured to transform all sub-blocks of the block having the size for which multiple transforms are possible using the selected one of the multiple possible transforms.</li><li>11. The apparatus of 8, wherein the intra-prediction mode comprises a first intra-prediction mode, wherein the sub-block comprises a first sub-block, and wherein the video encoder is further configured to determine whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available, and when the block includes the second sub-block of the size for which the first intra-prediction mode is not available, determine a second intra-prediction mode to which the first intra-prediction mode is mapped, and predict the second sub-block using the second intra-prediction mode.<!-- EPO <DP n="79"> --></li><li>12. The apparatus of 11, wherein when the first intra-prediction mode is available for all sub-blocks of the block, the video encoder is configured to predict all sub-blocks using the first intra-prediction mode.</li><li>13. The apparatus of 8, wherein the video encoder is configured to provide the indication of the selected one of the multiple possible transforms in a root node of a quadtree data structure corresponding to the block of video data.</li><li>14. The apparatus of 8, wherein the apparatus comprises at least one of:
<ul><li>an integrated circuit;</li><li>a microprocessor; and</li><li>a wireless communication device that includes the video encoder.</li></ul></li><li>15. An apparatus for encoding video data, the apparatus comprising:
<ul><li>means for selecting an intra-prediction mode to use to encode a block of video data;</li><li>means for determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode;</li><li>means for selecting one of the multiple possible transforms when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode;</li><li>means for transforming the sub-block using the selected one of the multiple possible transforms when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode; and</li><li>means for providing an indication of the selected one of the multiple possible transforms for the size of the block when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode.</li></ul><!-- EPO <DP n="80"> --></li><li>16. The apparatus of 15, wherein the intra-prediction mode comprises a first intra-prediction mode, and wherein the sub-block comprises a first sub-block, further comprising:
<ul><li>means for determining whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available;</li><li>means for determining a second intra-prediction mode to which the first intra-prediction mode is mapped when the block includes the second sub-block of the size for which the first intra-prediction mode is not available; and</li><li>means for predicting the second sub-block using the second intra-prediction mode when the block includes the second sub-block of the size for which the first intra-prediction mode is not available.</li></ul></li><li>17. A computer program product comprising a computer-readable storage medium having stored thereon instructions that, when executed, cause a processor of a device for encoding video data to:
<ul><li>select an intra-prediction mode to use to encode a block of video data;</li><li>determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode;</li><li>when the block includes the sub-block of the size for which multiple transforms are possible based on the size of the sub-block and the selected intra-prediction mode:
<ul><li>select one of the multiple possible transforms;</li><li>transform the sub-block using the selected one of the multiple possible transforms; and</li><li>provide an indication of the selected one of the multiple possible transforms for the size of the block.</li></ul></li></ul><!-- EPO <DP n="81"> --></li><li>18. The computer program product of 17, wherein the intra-prediction mode comprises a first intra-prediction mode, and wherein the sub-block comprises a first sub-block, further comprising instructions that cause the processor to:
<ul><li>determine whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available;</li><li>when the block includes the second sub-block of the size for which the first intra-prediction mode is not available:
<ul><li>determine a second intra-prediction mode to which the first intra-prediction mode is mapped; and</li><li>predict the second sub-block using the second intra-prediction mode.</li></ul></li></ul></li><li>19. A method of decoding video data, the method comprising:
<ul><li>receiving a first indication of an intra-prediction mode to use to decode a block of video data;</li><li>determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode;</li><li>when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode:
<ul><li>receiving a second indication of one of the multiple possible inverse transforms; and</li><li>inverse transforming the sub-block using the indicated one of the multiple possible inverse transforms.</li></ul></li></ul></li><li>20. The method of 19, further comprising, when the block does not include the sub-block of the size for which multiple inverse transforms are possible, inverse transforming the block using an inverse transform associated with the intra-prediction mode indicated for the block.</li><li>21. The method of 19, further comprising inverse transforming all sub-blocks of the block having the size for which multiple inverse transforms are possible using the indicated one of the multiple possible transforms.<!-- EPO <DP n="82"> --></li><li>22. The method of 19, wherein the intra-prediction mode comprises a first intra-prediction mode, and wherein the sub-block comprises a first sub-block, the method further comprising:
<ul><li>determining whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available;</li><li>when the block includes the second sub-block of the size for which the first intra-prediction mode is not available:
<ul><li>determining a second intra-prediction mode to which the first intra-prediction mode is mapped; and</li><li>predicting the second sub-block using the second intra-prediction mode.</li></ul></li></ul></li><li>23. The method of 22, further comprising, when the first intra-prediction mode is available for all sub-blocks of the block, predicting all sub-blocks using the first intra-prediction mode.</li><li>24. The method of 19, wherein receiving the first indication comprises receiving the first indication in a root node of a quadtree data structure corresponding to the block of video data.</li><li>25. An apparatus for decoding video data, the apparatus comprising a video decoder configured to receive a first indication of an intra-prediction mode to use to decode a block of video data, determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode, receive a second indication of one of the multiple possible inverse transforms, and inverse transform the sub-block using the indicated one of the multiple possible inverse transforms.</li><li>26. The apparatus of 25, wherein when the block does not include the sub-block of the size for which multiple inverse transforms are possible, the video decoder is configured to inverse transform the block using an inverse transform associated with the intra-prediction mode indicated for the block.<!-- EPO <DP n="83"> --></li><li>27. The apparatus of 25, wherein the video decoder is configured to inverse transform all sub-blocks of the block having the size for which multiple inverse transforms are possible using the indicated one of the multiple possible transforms.</li><li>28. The apparatus of 25, wherein the intra-prediction mode comprises a first intra-prediction mode, wherein the sub-block comprises a first sub-block, and wherein the video decoder is configured to determine whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available, when the block includes the second sub-block of the size for which the first intra-prediction mode is not available, determine a second intra-prediction mode to which the first intra-prediction mode is mapped, and predict the second sub-block using the second intra-prediction mode.</li><li>29. The apparatus of 28, wherein when the first intra-prediction mode is available for all sub-blocks of the block, the video decoder is configured to predict all sub-blocks using the first intra-prediction mode.</li><li>30. The apparatus of 25, wherein the video decoder is configured to receive the first indication in a root node of a quadtree data structure corresponding to the block of video data.</li><li>31. The apparatus of 25, wherein the apparatus comprises at least one of:
<ul><li>an integrated circuit;</li><li>a microprocessor; and</li><li>a wireless communication device that includes the video decoder.</li></ul><!-- EPO <DP n="84"> --></li><li>32. An apparatus for decoding video data, the apparatus comprising:
<ul><li>means for receiving a first indication of an intra-prediction mode to use to decode a block of video data;</li><li>means for determining whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode;</li><li>means for receiving a second indication of one of the multiple possible inverse transforms when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode; and</li><li>means for inverse transforming the sub-block using the indicated one of the multiple possible inverse transforms when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode.</li></ul></li><li>33. The apparatus of 32, wherein the intra-prediction mode comprises a first intra-prediction mode, and wherein the sub-block comprises a first sub-block, further comprising:
<ul><li>means for determining whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available;</li><li>means for determining a second intra-prediction mode to which the first intra-prediction mode is mapped when the block includes the second sub-block of the size for which the first intra-prediction mode is not available; and</li><li>means for predicting the second sub-block using the second intra-prediction mode when the block includes the second sub-block of the size for which the first intra-prediction mode is not available.</li></ul><!-- EPO <DP n="85"> --></li><li>34. A computer program product comprising a computer-readable storage medium having stored thereon instructions that, when executed, cause a processor of a device for decoding video data to:
<ul><li>receive a first indication of an intra-prediction mode to use to decode a block of video data;</li><li>determine whether the block includes a sub-block of a size for which multiple transforms are possible based on the size of the sub-block and the indicated intra-prediction mode;</li><li>when the block includes the sub-block of the size for which multiple inverse transforms are possible based on the size of the sub-block and the indicated intra-prediction mode:
<ul><li>receive a second indication of one of the multiple possible inverse transforms; and</li><li>inverse transform the sub-block using the indicated one of the multiple possible inverse transforms.</li></ul></li></ul></li><li>35. The computer program product of 34, wherein the intra-prediction mode comprises a first intra-prediction mode, and wherein the sub-block comprises a first sub-block, further comprising instructions that cause the processor to:
<ul><li>determine whether the block includes a second sub-block of a size for which the first intra-prediction mode is not available;</li><li>when the block includes the second sub-block of the size for which the first intra-prediction mode is not available:
<ul><li>determine a second intra-prediction mode to which the first intra-prediction mode is mapped; and</li><li>predict the second sub-block using the second intra-prediction mode.</li></ul></li></ul><!-- EPO <DP n="86"> --></li><li>36. A method of decoding video data, the method comprising:
<ul><li>receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode;</li><li>determining whether an edge is present in the block of video data;</li><li>after determining that the edge is present in the block:
<ul><li>determining an angle for the edge; and</li><li>based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transforming the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge; and</li></ul></li><li>decoding the inverse transformed block.</li></ul></li><li>37. The method of 36, wherein the block comprises a current block, and wherein determining that the edge is present in the current block comprises:
<ul><li>analyzing pixels of one or more neighboring, previously coded blocks to the current block; and</li><li>based on the analysis, determining that the edge is present in the current block when an edge is present in a neighboring, previously coded block and that the edge in the neighboring, previously coded block intersects a border between the neighboring, previously coded block and the current block.</li></ul></li><li>38. The method of 36, further comprising determining the directional inverse transform mapped from the directional intra-prediction mode as the directional inverse transform having an angle with a minimum difference relative to the angle of the edge.</li><li>39. The method of 36, wherein decoding the inverse transformed block comprises:
<ul><li>calculating a predicted value using an edge-based intra-prediction mode; and</li><li>adding the predicted value to the inverse transformed block.</li></ul><!-- EPO <DP n="87"> --></li><li>40. An apparatus for decoding video data, the apparatus comprising a video decoder configured to receive information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode, determine whether an edge is present in the block of video data, after determining that the edge is present in the block, determine an angle for the edge, based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transform the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge, and decode the inverse transformed block.</li><li>41. The apparatus of 40, wherein the block comprises a current block, and wherein to determine that the edge is present in the current block, the video decoder is configured to analyze pixels of one or more neighboring, previously coded blocks to the current block, and, based on the analysis, determine that the edge is present in the current block when an edge is present in a neighboring, previously coded block and that the edge in the neighboring, previously coded block intersects a border between the neighboring, previously coded block and the current block.</li><li>42. The apparatus of 40, wherein the video decoder is further configured to determine the directional inverse transform mapped from the directional intra-prediction mode as the directional inverse transform having an angle with a minimum difference relative to the angle of the edge.</li><li>43. The apparatus of 40, wherein to decode the inverse transformed block, the video decoder is configured to calculate a predicted value using an edge-based intra-prediction mode, and add the predicted value to the inverse transformed block.</li><li>44. The apparatus of 40, wherein the apparatus comprises at least one of:
<ul><li>an integrated circuit;</li><li>a microprocessor; and</li><li>a wireless communication device that includes the video decoder.</li></ul><!-- EPO <DP n="88"> --></li><li>45. An apparatus for decoding video data, the apparatus comprising:
<ul><li>means for receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode;</li><li>means for determining whether an edge is present in the block of video data;</li><li>means for determining, after determining that the edge is present in the block, an angle for an edge in the block of video data based on the indication of the DC intra-prediction mode for the block;</li><li>means for inverse transforming, after determining the angle of the edge, the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block,; and</li><li>means for decoding the inverse transformed block.</li></ul></li><li>46. A computer program product comprising a computer-readable medium having stored thereon instructions that, when executed, cause a processor to:
<ul><li>receive information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode;</li><li>determine whether an edge is present in the block of video data;</li><li>after determining that the edge is present in the block:
<ul><li>determine an angle for an edge in the block of video data based on the indication of the DC intra-prediction mode for the block; and</li><li>based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transform the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge; and</li><li>decode the inverse transformed block.</li></ul></li></ul><!-- EPO <DP n="89"> --></li><li>47. A method of encoding video data, the method comprising:
<ul><li>determining that a block to be intra-prediction encoded contains an edge within the block;</li><li>selecting an edge-based intra-prediction mode to predict the block;</li><li>calculating a residual block for the block based on a prediction value calculated using the edge-based intra-prediction mode;</li><li>based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, transforming the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge; and</li><li>outputting information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</li></ul></li><li>48. The method of 47, wherein the block comprises a current block, and wherein determining that the edge is present in the current block comprises:
<ul><li>analyzing pixels of one or more neighboring, previously coded blocks to the current block; and</li><li>based on the analysis, determining that the edge is present in the current block when an edge is present in a neighboring, previously coded block and that the edge in the neighboring, previously coded block intersects a border between the neighboring, previously coded block and the current block.</li></ul></li><li>49. The method of 47, further comprising determining the directional transform mapped from the directional intra-prediction mode as the directional transform having an angle with a minimum difference relative to the angle of the edge.</li><li>50. The method of 47, wherein calculating the residual block comprises:
<ul><li>calculating a predicted value for the block using the edge-based intra-prediction mode; and</li><li>subtracting the predicted value from an original value for the block.</li></ul><!-- EPO <DP n="90"> --></li><li>51. An apparatus for encoding video data, the apparatus comprising a video encoder configured to determine that a block to be intra-prediction encoded contains an edge within the block, select an edge-based intra-prediction mode to predict the block, calculate a residual block for the block based on a prediction value calculated using the edge-based intra-prediction mode, based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, transform the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge, and output information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</li><li>52. The apparatus of 51, wherein the block comprises a current block, and wherein to determine that the edge is present in the current block, the video encoder is configured to analyze pixels of one or more neighboring, previously coded blocks to the current block, and, based on the analysis, determine that the edge is present in the current block when an edge is present in a neighboring, previously coded block and that the edge in the neighboring, previously coded block intersects a border between the neighboring, previously coded block and the current block.</li><li>53. The apparatus of 51, wherein the video encoder is further configured to determine the directional transform mapped from the directional intra-prediction mode as the directional transform having an angle with a minimum difference relative to the angle of the edge.</li><li>54. The apparatus of 51, wherein to calculate the residual block, the video encoder is configured to calculate a predicted value for the block using the edge-based intra-prediction mode, and subtract the predicted value from an original value for the block.</li><li>55. The apparatus of 51, wherein the apparatus comprises at least one of:
<ul><li>an integrated circuit;</li><li>a microprocessor; and</li><li>a wireless communication device that includes the video encoder.</li></ul><!-- EPO <DP n="91"> --></li><li>56. An apparatus for encoding video data, the apparatus comprising:
<ul><li>means for determining that a block to be intra-prediction encoded contains an edge within the block;</li><li>means for selecting an edge-based intra-prediction mode to predict the block;</li><li>means for calculating a residual block for the block based on a prediction value calculated using the edge-based intra-prediction mode;</li><li>means for transforming, based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge; and</li><li>means for outputting information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</li></ul></li><li>57. A computer program product comprising a computer-readable storage medium having stored thereon instructions that, when executed, cause a processor to:
<ul><li>determine that a block to be intra-prediction encoded contains an edge within the block;</li><li>select an edge-based intra-prediction mode to predict the block;</li><li>calculate a residual block for the block based on a prediction value calculated using the edge-based intra-prediction mode;</li><li>based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, transform the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge; and</li><li>output information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</li></ul></li></ol></p></description><claims mxw-id="PCLM56976117" lang="EN" load-source="patent-office"><!-- EPO <DP n="92"> --><claim id="c-en-0001" num="0001"><claim-text>A method of decoding video data, the method comprising:
<claim-text>receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode;</claim-text>
<claim-text>determining whether an edge is present in the block of video data;</claim-text>
<claim-text>after determining that the edge is present in the block:
<claim-text>determining an angle for the edge; and</claim-text>
<claim-text>based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block, inverse transforming the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge; and</claim-text>
<claim-text>decoding the inverse transformed block.</claim-text></claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method of claim 1, wherein the block comprises a current block, and wherein determining that the edge is present in the current block comprises:
<claim-text>analyzing pixels of one or more neighboring, previously coded blocks to the current block; and</claim-text>
<claim-text>based on the analysis, determining that the edge is present in the current block when an edge is present in a neighboring, previously coded block and that the edge in the neighboring, previously coded block intersects a border between the neighboring, previously coded block and the current block.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method of claim 1, further comprising determining the directional inverse transform mapped from the directional intra-prediction mode as the directional inverse transform mapped from a directional intra-prediction direction having an angle with a minimum difference relative to the angle of the edge.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method of claim 1, wherein decoding the inverse transformed block comprises:
<claim-text>calculating a predicted value using an edge-based intra-prediction mode; and</claim-text>
<claim-text>adding the predicted value to the inverse transformed block.</claim-text><!-- EPO <DP n="93"> --></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>An apparatus for decoding video data, the apparatus comprising:
<claim-text>means for receiving information indicating that an intra-prediction mode for a block of video data is a DC intra-prediction mode;</claim-text>
<claim-text>means for determining whether an edge is present in the block of video data;</claim-text>
<claim-text>means for determining, after determining that the edge is present in the block, an angle for an edge in the block of video data based on the indication of the DC intra-prediction mode for the block;</claim-text>
<claim-text>means for inverse transforming, after determining the angle of the edge, the block using a directional inverse transform mapped from a directional intra-prediction mode having an angle that approximates the angle of the edge based on the information indicating that the intra-prediction mode is the DC intra-prediction mode and the determination that the edge is present in the block; and</claim-text>
<claim-text>means for decoding the inverse transformed block.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>An apparatus for decoding video data of claim 5, the apparatus comprising a video decoder.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The apparatus of claim 6, wherein the apparatus comprises at least one of:
<claim-text>an integrated circuit;</claim-text>
<claim-text>a microprocessor; and</claim-text>
<claim-text>a wireless communication device that includes the video decoder.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A method of encoding video data, the method comprising:
<claim-text>determining that a block to be intra-prediction encoded contains an edge within the block;</claim-text>
<claim-text>selecting an edge-based intra-prediction mode to predict the block;</claim-text>
<claim-text>calculating a residual block for the block based on a prediction value calculated using the edge-based intra-prediction mode;</claim-text>
<claim-text>based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode, transforming the residual<!-- EPO <DP n="94"> --> block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge; and</claim-text>
<claim-text>outputting information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method of claim 8, wherein the block comprises a current block, and wherein determining that the edge is present in the current block comprises:
<claim-text>analyzing pixels of one or more neighboring, previously coded blocks to the current block; and</claim-text>
<claim-text>based on the analysis, determining that the edge is present in the current block when an edge is present in a neighboring, previously coded block and that the edge in the neighboring, previously coded block intersects a border between the neighboring, previously coded block and the current block.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The method of claim 8, further comprising determining the directional transform mapped from the directional intra-prediction mode as the directional transform mapped from a directional intra-prediction direction having an angle with a minimum difference relative to the angle of the edge.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The method of claim 8, wherein calculating the residual block comprises:
<claim-text>calculating a predicted value for the block using the edge-based intra-prediction mode; and</claim-text>
<claim-text>subtracting the predicted value from an original value for the block.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>An apparatus for encoding video data, the apparatus comprising:
<claim-text>means for determining that a block to be intra-prediction encoded contains an edge within the block;</claim-text>
<claim-text>means for selecting an edge-based intra-prediction mode to predict the block;</claim-text>
<claim-text>means for calculating a residual block for the block based on a prediction value calculated using the edge-based intra-prediction mode;</claim-text>
<claim-text>means for transforming, based on the determination that the edge is present in the block and the selection of the edge-based intra-prediction mode,<!-- EPO <DP n="95"> --> the residual block using a directional transform mapped from a directional intra-prediction mode having an angle that approximates an angle of the edge; and</claim-text>
<claim-text>means for outputting information representative of the transformed residual block and information indicating that the block was predicted using a DC intra-prediction mode.</claim-text></claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>An apparatus for encoding video data of claim 12, the apparatus comprising a video encoder.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The apparatus of claim 13, wherein the apparatus comprises at least one of:
<claim-text>an integrated circuit;</claim-text>
<claim-text>a microprocessor; and</claim-text>
<claim-text>a wireless communication device that includes the video encoder.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>A computer program product comprising a computer-readable storage medium having stored thereon instructions that, when executed, cause a processor to perform the method of any one of claims 1 to 4 or 8 to 11.</claim-text></claim></claims><drawings mxw-id="PDW16666902" load-source="patent-office"><!-- EPO <DP n="96"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="161" he="224" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="97"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="160" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="98"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="151" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="99"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="165" he="201" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="100"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="165" he="222" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="101"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="105" he="115" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="102"> --><figure id="f0007" num="7A,7B"><img id="if0007" file="imgf0007.tif" wi="136" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="103"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="99" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="104"> --><figure id="f0009" num="9"><img id="if0009" file="imgf0009.tif" wi="107" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="105"> --><figure id="f0010" num="10"><img id="if0010" file="imgf0010.tif" wi="161" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="106"> --><figure id="f0011" num="11"><img id="if0011" file="imgf0011.tif" wi="156" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="107"> --><figure id="f0012" num="12"><img id="if0012" file="imgf0012.tif" wi="123" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="108"> --><figure id="f0013" num="13"><img id="if0013" file="imgf0013.tif" wi="110" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="109"> --><figure id="f0014" num="14"><img id="if0014" file="imgf0014.tif" wi="165" he="226" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
