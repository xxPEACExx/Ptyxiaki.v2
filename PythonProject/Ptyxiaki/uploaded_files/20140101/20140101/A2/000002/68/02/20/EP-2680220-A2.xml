<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680220-A2" country="EP" doc-number="2680220" kind="A2" date="20140101" family-id="48655986" file-reference-id="318319" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549384" ucid="EP-2680220-A2"><document-id><country>EP</country><doc-number>2680220</doc-number><kind>A2</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13172393-A" is-representative="NO"><document-id mxw-id="PAPP154823307" load-source="docdb" format="epo"><country>EP</country><doc-number>13172393</doc-number><kind>A</kind><date>20130618</date><lang>EN</lang></document-id><document-id mxw-id="PAPP189754537" load-source="docdb" format="original"><country>EP</country><doc-number>13172393.4</doc-number><date>20130618</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140448105" ucid="EP-12305779-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12305779</doc-number><kind>A</kind><date>20120629</date></document-id></priority-claim><priority-claim mxw-id="PPC140445700" ucid="EP-13172393-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>13172393</doc-number><kind>A</kind><date>20130618</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2081675984" load-source="docdb">G06T   3/00        20060101AFI20150326BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2081683821" load-source="docdb">H04N   5/14        20060101ALI20150326BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2135383564" load-source="docdb" scheme="CPC">G06T   3/0012      20130101 LI20141119BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991316496" load-source="docdb" scheme="CPC">H04N   5/14        20130101 FI20131226BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180636" lang="DE" load-source="patent-office">Verfahren zum Reframing von Bildern einer Videosequenz sowie Vorrichtung zum Reframing von Bildern einer Videosequenz</invention-title><invention-title mxw-id="PT132180637" lang="EN" load-source="patent-office">Method for reframing images of a video sequence, and apparatus for reframing images of a video sequence</invention-title><invention-title mxw-id="PT132180638" lang="FR" load-source="patent-office">Procédé de recadrage d'images d'une séquence vidéo et appareil de recadrage d'images d'une séquence vidéo</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918171407" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>THOMSON LICENSING</last-name><address><country>FR</country></address></addressbook></applicant><applicant mxw-id="PPAR918137215" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>THOMSON LICENSING</last-name></addressbook></applicant><applicant mxw-id="PPAR918989748" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Thomson Licensing</last-name><iid>101157220</iid><address><street>1-5, rue Jeanne d'Arc</street><city>92130 Issy-Les-Moulineaux</city><country>FR</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918135319" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>CHAMARET CHRISTEL</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918153125" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>Chamaret, Christel</last-name></addressbook></inventor><inventor mxw-id="PPAR918993408" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Chamaret, Christel</last-name><address><street>Nantiveul</street><city>35135 Chantepie</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918149792" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>URBAN FABRICE</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918167255" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>Urban, Fabrice</last-name></addressbook></inventor><inventor mxw-id="PPAR918979379" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>Urban, Fabrice</last-name><address><street>38 Rue Denis Bülher</street><city>35235 Thorigné Fouillard</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918134980" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>CHEVANCE CHRISTOPHE</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918159235" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>CHEVANCE, CHRISTOPHE</last-name></addressbook></inventor><inventor mxw-id="PPAR918994314" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>CHEVANCE, CHRISTOPHE</last-name><address><street>32 rue du Rocher</street><city>35530 Brécé</city><country>FR</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918986227" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>König, Uwe</last-name><iid>101282520</iid><address><street>Deutsche Thomson OHG Karl-Wiechert-Allee 74</street><city>30625 Hannover</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548803561" load-source="docdb">AL</country><country mxw-id="DS548840826" load-source="docdb">AT</country><country mxw-id="DS548803566" load-source="docdb">BE</country><country mxw-id="DS548890148" load-source="docdb">BG</country><country mxw-id="DS548864929" load-source="docdb">CH</country><country mxw-id="DS548858331" load-source="docdb">CY</country><country mxw-id="DS548858332" load-source="docdb">CZ</country><country mxw-id="DS548878070" load-source="docdb">DE</country><country mxw-id="DS548803567" load-source="docdb">DK</country><country mxw-id="DS548803568" load-source="docdb">EE</country><country mxw-id="DS548860706" load-source="docdb">ES</country><country mxw-id="DS548890149" load-source="docdb">FI</country><country mxw-id="DS548890326" load-source="docdb">FR</country><country mxw-id="DS548878071" load-source="docdb">GB</country><country mxw-id="DS548803569" load-source="docdb">GR</country><country mxw-id="DS548878072" load-source="docdb">HR</country><country mxw-id="DS548858333" load-source="docdb">HU</country><country mxw-id="DS548864930" load-source="docdb">IE</country><country mxw-id="DS548803582" load-source="docdb">IS</country><country mxw-id="DS548890327" load-source="docdb">IT</country><country mxw-id="DS548803583" load-source="docdb">LI</country><country mxw-id="DS548878073" load-source="docdb">LT</country><country mxw-id="DS548840827" load-source="docdb">LU</country><country mxw-id="DS548890328" load-source="docdb">LV</country><country mxw-id="DS548878074" load-source="docdb">MC</country><country mxw-id="DS548840828" load-source="docdb">MK</country><country mxw-id="DS548840829" load-source="docdb">MT</country><country mxw-id="DS548840830" load-source="docdb">NL</country><country mxw-id="DS548858334" load-source="docdb">NO</country><country mxw-id="DS548840831" load-source="docdb">PL</country><country mxw-id="DS548803584" load-source="docdb">PT</country><country mxw-id="DS548804635" load-source="docdb">RO</country><country mxw-id="DS548803585" load-source="docdb">RS</country><country mxw-id="DS548840832" load-source="docdb">SE</country><country mxw-id="DS548878076" load-source="docdb">SI</country><country mxw-id="DS548858335" load-source="docdb">SK</country><country mxw-id="DS548858336" load-source="docdb">SM</country><country mxw-id="DS548860707" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128670054" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A reframing application crops a sub-part of a video source, based on its content. The reframing application involves a visual attention model that produces a saliency map, and a dedicated reframing algorithm that extrapolates a cropping window based on that saliency map. After cropping, only the reframed portion of each video image remains visible. A method for processing images of a video sequence comprises steps of determining (21) parameters of the video sequence, parameters of a previously decoded subsequence of the video sequence and user settings, determining (22) a portion to be cropped according to the determined parameters, and cropping (23) in a reframing step the determined portion for being displayed. An advantage of the invention is that an advanced automatic solution is provided for tuning automatically the reframing parameters, based on the content of a video.
<img id="iaf01" file="imgaf001.tif" wi="62" he="84" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499427" lang="EN" source="EPO" load-source="docdb"><p>A reframing application crops a sub-part of a video source, based on its content. The reframing application involves a visual attention model that produces a saliency map, and a dedicated reframing algorithm that extrapolates a cropping window based on that saliency map. After cropping, only the reframed portion of each video image remains visible. A method for processing images of a video sequence comprises steps of determining (21) parameters of the video sequence, parameters of a previously decoded subsequence of the video sequence and user settings, determining (22) a portion to be cropped according to the determined parameters, and cropping (23) in a reframing step the determined portion for being displayed. An advantage of the invention is that an advanced automatic solution is provided for tuning automatically the reframing parameters, based on the content of a video.</p></abstract><description mxw-id="PDES63955484" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><u>Field of the invention</u></heading><p id="p0001" num="0001">This invention relates to a method and an apparatus for processing images of a video sequence, and in particular for reframing images of a video sequence.</p><heading id="h0002"><u>Background</u></heading><p id="p0002" num="0002">A reframing application, as known e.g. from <patcit id="pcit0001" dnum="EP1956550A"><text>EP 1 956 550 A</text></patcit>, is initially designed to crop a sub-part of a video source based on its content. After cropping, only the reframed portion of each video image remains visible. The reframing application involves a visual attention model and a dedicated reframing algorithm. The visual attention model produces a saliency map, whereas the reframing algorithm extrapolates a cropping window based on that saliency map. This cropping window is variable in terms of location and size, depending on the video content. The reframing algorithm is complementary to an encoding or decoding process. Depending on a use case, the reframing application may be used differently. E.g., the reframing application can be used as a pre-processing before mobile video encoding. In another example, the reframing application is performed just after video decoding.</p><p id="p0003" num="0003">A problem is that currently there is no advanced or automatic solution available for tuning automatically the reframing parameters, based on the content of a video.</p><heading id="h0003"><u>Summary of the Invention</u></heading><p id="p0004" num="0004">The present invention enables tuning automatically the settings or input parameters of the reframing application, by taking advantage of information that is available when decoding video source data. The disclosed solution for automatically tuning settings or input parameters for a decoded video sequence takes advantage of properties of a previously decoded sequence.<!-- EPO <DP n="2"> --></p><p id="p0005" num="0005">According to the invention, a method for processing images of a video sequence comprises steps of determining parameters of the video sequence, parameters of a previously decoded GOP (Group Of Pictures) of the video sequence and determining user settings, determining a portion to be cropped according to the determined parameters, and cropping the determined portion for being displayed.</p><p id="p0006" num="0006">Various parameters of the video sequence can be determined and utilized, such as a GOP size, a temporal subsampling factor, minimum and maximum zoom factors or a bounding box velocity. The parameters can be utilized separately or combined. E.g., in one embodiment, the determined and utilized parameters comprise (from the above-mentioned parameters) only a bounding box velocity.</p><p id="p0007" num="0007">In one embodiment, the determined and utilized parameters comprise a minimum and a maximum zoom factor.</p><p id="p0008" num="0008">In one embodiment, the determined and utilized parameters comprise a GOP size, a temporal subsampling factor, a minimum and a maximum zoom factor, and a bounding box velocity.</p><p id="p0009" num="0009">In one embodiment of the invention, a method for processing images of a video sequence comprises steps of<br/>
determining in a previous image a sub-area or sub-set of pixels being the most salient portion of the previous image for being included in a reframed window, determining a first bounding box around said sub-area or sub-set of pixels, determining in a current image a sub-area or sub-set of pixels being the most salient portion of the current image for being included in a reframed window, and a second bounding box around said area,<br/>
determining a maximum bounding box velocity for moving a bounding box between successive images,<br/>
determining a new bounding box from the first and second bounding boxes and the determined maximum velocity of the bounding box, and<br/>
cropping in the current image the sub-area according to the determined new bounding box for being displayed.<!-- EPO <DP n="3"> --></p><p id="p0010" num="0010">The maximum bounding box velocity may be determined from parameters of a previously decoded GOP of the video sequence. The maximum bounding box velocity may also be a predefined value retrievable from a register or storage, which is then also valid for previously decoded GOPs of the video sequence.</p><p id="p0011" num="0011">An apparatus that utilizes the method comprises image analysis means for determining parameters of the video sequence, determining parameters of a previously decoded GOP (Group Of Pictures) of the video sequence and determining user settings (e.g. user interface means), and image processing means for determining a portion to be cropped according to the determined parameters, and for cropping the determined portion for being displayed. Various parameters of the video sequence can be determined and utilized separately or combined, as described above.</p><p id="p0012" num="0012">In one embodiment of the invention, an apparatus for processing images of a video sequence comprises<br/>
means for determining in a previous image a sub-area or sub-set of pixels being the most salient portion of the previous image for being included in a reframed window, means for determining a first bounding box around said sub-area or sub-set of pixels, means for determining in a current image a sub-area or sub-set of pixels being the most salient portion of the current image for being included in a reframed window, and a second bounding box around said area,<br/>
means for determining, from parameters of a previously decoded GOP of the video sequence, a maximum bounding box velocity for moving a bounding box between successive images,<br/>
means for determining a new bounding box from the first and second bounding boxes and the determined maximum velocity of the bounding box, and means for cropping in the current image the sub-area according to the determined new bounding box for being displayed.</p><p id="p0013" num="0013">In one aspect, the invention relates to a computer readable medium having executable instructions stored thereon to cause a computer to perform a method as disclosed above. In one embodiment, the computer is caused to perform a<!-- EPO <DP n="4"> --> method for processing images of a video sequence, comprising steps of determining parameters of the video sequence, determining parameters of a previously decoded GOP of the video sequence and determining user settings, determining a portion to be cropped according to the determined parameters, and cropping the determined portion for being displayed.</p><p id="p0014" num="0014">Advantageous embodiments of the invention are disclosed in the dependent claims, the following description and the figures.</p><heading id="h0004"><u>Brief description of the drawings</u></heading><p id="p0015" num="0015">Exemplary embodiments of the invention are described with reference to the accompanying drawings, which show in
<ul><li><figref idrefs="f0001">Fig.1</figref> the structure of a video decoder with reframing application,</li><li><figref idrefs="f0001">Fig.2</figref> a flow-chart of the method for processing images of a video sequence,</li><li><figref idrefs="f0001">Fig.3</figref> a diagram of the evolution of buffer size as a function of GOP size,</li><li><figref idrefs="f0002">Fig.4</figref> selection of an optimal temporal subsampling mode/factor regarding the<br/>
computational context and real-time requirements,</li><li><figref idrefs="f0002">Fig.5</figref> a flow-chart of the mode selection regarding the GOP arrangement, size and<br/>
environment constraints,</li><li><figref idrefs="f0003">Fig.6</figref> exemplary MB cost maps for I-frames at different bit rates,</li><li><figref idrefs="f0003">Fig.7</figref> a diagram of the evolution of bounding box velocity as a function of <i>IntraMap</i><br/>
correlation between frames for a complete GOP,</li><li><figref idrefs="f0004">Fig.8</figref> a diagram explaining limited bounding box velocity,</li><li><figref idrefs="f0004">Fig.9</figref> a diagram explaining limited bounding box zoom factor, and</li><li><figref idrefs="f0004">Fig.10</figref> the structure of an apparatus for processing images of a video sequence.</li></ul></p><heading id="h0005"><u>Detailed description of the invention</u></heading><p id="p0016" num="0016"><figref idrefs="f0001">Fig.1</figref> shows the structure of a video decoder DEC with an automatic reframing unit AR. The decoder DEC receives an encoded input video sequence 11, and decodes it to obtain a decoded video sequence 12. A parameter extractor PE<!-- EPO <DP n="5"> --> extracts parameters and/or reframing settings 14 from the decoded video sequence and/or the decoder settings 13. The automatic reframing unit AR generates, from the decoded video 12 and the extracted parameters and/or reframing settings 14, a reframed (i.e. cropped) video sequence 16.</p><p id="p0017" num="0017">A reframing application has a certain number of settings S that, according to the invention, are tuned automatically from the decoded stream or the decoding process. In one embodiment, the settings comprise a buffer size, a temporal subsampling factor, two zoom factors z<sub>min</sub> and z<sub>max</sub> , and a bounding box velocity. The settings s<sub>1</sub>,s<sub>2</sub>,s<sub>3</sub>,s<sub>4</sub> are described below. <maths id="math0001" num="(eq.1)"><math display="block"><mi>S</mi><mo>=</mo><msup><mfenced separators=""><msub><mi>s</mi><mn>1</mn></msub><mo>⁢</mo><msub><mi>s</mi><mn>2</mn></msub><mo>⁢</mo><msub><mi>s</mi><mn>3</mn></msub><mo>⁢</mo><msub><mi>s</mi><mn>4</mn></msub></mfenced><mi>T</mi></msup><mo>=</mo><mfenced><mtable><mtr><mtd><mi mathvariant="italic">Buffer size</mi></mtd></mtr><mtr><mtd><mi mathvariant="italic">Temporal subsampling factor</mi></mtd></mtr><mtr><mtd><mi mathvariant="italic">zoom factors</mi><mo>:</mo><msub><mi mathvariant="italic">z</mi><mi mathvariant="italic">min</mi></msub><mo>,</mo><msub><mi mathvariant="italic">z</mi><mi mathvariant="italic">max</mi></msub></mtd></mtr><mtr><mtd><mi mathvariant="italic">Bounding box velocity</mi></mtd></mtr></mtable></mfenced></math><img id="ib0001" file="imgb0001.tif" wi="161" he="28" img-content="math" img-format="tif"/></maths></p><p id="p0018" num="0018">The <i>Buffer size (s</i><sub>1</sub><i>)</i> is the size of the buffer that is used in the reframing process to smooth the cropping window parameters over time. In one embodiment, the buffer size is adjusted according to the GOP size.</p><p id="p0019" num="0019">The <i>Temporal subsampling factor (s</i><sub>2</sub><i>)</i> is used to limit the number of frames to which the reframing process is applied, thus reducing and controlling the computational complexity of the application; e.g., apply the reframing process only to one frame over <i>s</i><sub>2</sub>, or one frame out of <i>s</i><sub>2</sub> frames. In one embodiment, possible temporal subsampling factors/modes are "full mode" (all frames), "intermediary mode" (only I- and P-frames) and "light mode" (only I-frames), depending on GOP length and s<sub>2</sub>.</p><p id="p0020" num="0020">The <i>Zoom factors (s<sub>3</sub></i> = <i>(z<sub>min</sub>,z<sub>max</sub>))</i> defines the boundaries between which the cropping window may change over time. This limits changes in the size of the cropping window. The user may set this feature to avoid too big or too small zoom effects. In one embodiment, in the first picture after scene cut a MB cost map is created to find the most important blocks. Then the MB cost map is used to determine the zoom factor.</p><p id="p0021" num="0021">The <i>Bounding box velocity (s<sub>4</sub>)</i> is the velocity with which the cropping window may move within the picture. The Bounding box refers, in one embodiment, to the sub-area<!-- EPO <DP n="6"> --> or sub-set of pixels selected as being the most salient, which is to be included in a reframed window. The allowable velocity depends on the image content: it is limited to low values when a correlation between intra-predicted MBs of subsequent images is quite low or quite high; high correlation means static image or low motion, so that a stable bounding box position is preferable; low correlation means a scene change (i.e. new "shot"), which would overstrain the algorithm since it cannot be compensated by a bounding box shift. Thus, the <i>Bounding box velocity s</i><sub>4</sub> may be adapted to the sequence to better fit the natural camera motion of the camera, depending on the content. In one embodiment, a Kalman filter is applied to the bounding box coordinates for filtering them, and the bounding box velocity is the noise factor that is injected in the Kalman filter.</p><p id="p0022" num="0022"><figref idrefs="f0001">Fig.2</figref> shows a flow-chart of the method for processing images of a video sequence. The method comprises steps of determining 21 parameters of the video sequence, parameters of a previously decoded GOP (Group Of Pictures) of the video sequence and user settings, determining 22 a portion to be cropped according to the determined parameters, and cropping 23 the determined portion for being displayed.</p><p id="p0023" num="0023">In one embodiment, the decoding parameters are determined as follows.</p><p id="p0024" num="0024">The <i><b>Buffer size</b> s<sub>1</sub></i> is adjusted according to the GOP size (<i>Gsize</i>). In principle, the buffer size is reduced for small GOPs, while the full buffer <i>Size<sub>max</sub></i> is used for GOP sizes above a certain limit. The GOP size is a predefined parameter that the decoder DEC may retrieve from a storage or extract from the encoded bitstream. The following rule may be applied: <maths id="math0002" num="(eq.2)"><math display="block"><msub><mi>s</mi><mn>1</mn></msub><mo>=</mo><mrow><mo>{</mo></mrow><mtable><mtr><mtd><msub><mi mathvariant="italic">Size</mi><mi mathvariant="italic">max</mi></msub></mtd><mtd columnalign="right"><mi mathvariant="italic">if Gsize</mi><mo>≥</mo><msub><mi mathvariant="italic">Gsize</mi><mi mathvariant="italic">max</mi></msub></mtd></mtr><mtr><mtd><msub><mi>log</mi><mn>2</mn></msub><mfenced><mi mathvariant="italic">Gsize</mi></mfenced><mo>+</mo><mfrac><mi mathvariant="italic">Gsize</mi><mn>2</mn></mfrac><mo>+</mo><mn>1</mn></mtd><mtd columnalign="right"><mi mathvariant="italic">otherwise</mi></mtd></mtr></mtable></math><img id="ib0002" file="imgb0002.tif" wi="158" he="17" img-content="math" img-format="tif"/></maths></p><p id="p0025" num="0025">For an exemplary concrete application, <i>Gsize<sub>max</sub></i> is set to 40 and <i>Size<sub>max</sub></i> to 25. That is, the cropping window parameters of <i>Size<sub>max</sub></i> previous frames are buffered and considered for obtaining cropping window parameters of a current frame, if the GOP size is 40 or more. In this way, sudden changes in cropping window parameters are avoided, so that the cropping window parameters are smoothed over time. Then, a curve for the buffer size results as depicted in <figref idrefs="f0001">Fig.3</figref>.<!-- EPO <DP n="7"> --></p><p id="p0026" num="0026">The <i><b>Temporal subsampling factor</b> s</i><sub>2</sub> may be set according to the GOP size and scheme. The philosophy is to maintain the computation of the reframing process (and then of the saliency map) at least on I-frames, since they have the highest quality and may potentially be at the beginning of scene (i.e. just after scene cut). Then, the P-frames are less interesting to be processed. Finally, the B-frames would be the first frames to be omitted if there is any need for removing frames by temporal subsampling.</p><p id="p0027" num="0027">By using the GOP scheme, an improvement can even be made compared to the known solution of <patcit id="pcit0002" dnum="EP1956550A"><text>EP 1 956 550 A</text></patcit>, because now it is possible to choose which frame type and which frames will be impacted.</p><p id="p0028" num="0028">Then, instead of defining a factor, it is possible to define three modes or use cases, such as depicted in <figref idrefs="f0002">Fig.4</figref>. In Full mode FM, there is no temporal subsampling, so that reframing processing is performed on all frames. In Intermediary mode IM, some or all of the B-frames of a sequence are removed from computation. In Light mode LM, some or all of the P-frames as well as all the B-frames of a sequence are removed from computation. The mode selection is controlled by computing issues, or the available computing environment CI/Env respectively. This means that according to the context (high/low bit rate or low/high quality) requirements, one of the three modes is selected: high quality means full mode, medium quality means intermediary mode and low quality means light mode.</p><p id="p0029" num="0029"><figref idrefs="f0002">Fig.5</figref> shows a detailed flow-chart explaining the selection of a mode. Basically, the presence of B-frames is checked, and then their computation is skipped in Intermediary mode IM and Light mode LM. Then, depending on the environment constraints, the P-frames (or a subset) will be discarded as well. As shown in <figref idrefs="f0002">Fig.5</figref>, one of the three possible modes described above can be selected in the mode selection MS.<!-- EPO <DP n="8"> --></p><p id="p0030" num="0030">In Full mode FM, all frames are kept, and in a step 50 the <i>Temporal subsampling factor</i> parameter <i>s<sub>2</sub></i> is set accordingly, e.g. to 1. That is, all frames are processed 59.</p><p id="p0031" num="0031">In Intermediary mode IM, it is checked 51 if there are any B-frames. If not, all frames are processed 59. If there is at least one B-frame, the next step 52 removes NbB B-frames and calculates the <i>Temporal subsampling factor</i> parameter <i>s<sub>2</sub></i> according to s<sub>2</sub>=G<sub>size</sub> - NbB (with G<sub>size</sub> being the GOP size). The calculated <i>Temporal subsampling factor</i> parameter <i>s<sub>2</sub></i> is compared 53 with a given threshold, e.g. according to "s<sub>2</sub> &gt; G<sub>size</sub>/2 ?". If the Temporal subsampling factor is not below the threshold, the number of B-frames to be removed is increased and the calculation repeated. NbB is a variable that is initialized to 1 and incremented with every execution of the loop. nb<sub>iter</sub> is a count variable, counting executions of the loop and therefore (in Intermediary mode) also the number of B-frames to be skipped. Alternatively, it is also possible to calculate s<sub>2,min</sub> = G<sub>size</sub> - NbB<sub>max</sub> (with NbB<sub>max</sub> being the total number of B-frames in the GOP) and add single B-frames back, i.e. decrease NbB<sub>max</sub> , as long as the resulting s<sub>2</sub> is below the threshold. Note that in the thresholding step 53 other thresholds thr<sub>tSubs</sub> can be used for comparison with the <i>Temporal subsampling factor</i> parameter <i>s<sub>2</sub></i>, according to "s<sub>2</sub> &gt; thr<sub>tSubs</sub> ?". Preferably the threshold is substantially near G<sub>size</sub>/2.</p><p id="p0032" num="0032">In Light mode LM, it is first checked 54 if there are any B-frames. If so, all B-frames are removed in the next step 55. Then, the obtained <i>Temporal subsampling factor</i> parameter <i>s<sub>2</sub></i> is calculated 56 according to s<sub>2</sub>=G<sub>size</sub> - NbB, and compared 57 with a given threshold, e.g. according to "s<sub>2</sub> &lt; G<sub>size</sub>/2 ?" (or similar, as in Intermediary mode). If the <i>Temporal subsampling factor</i> parameter <i>s<sub>2</sub></i> is below the threshold, all remaining frames are processed 59. If not, the next step 58 removes NbP P-frames. The resulting <i>Temporal subsampling factor s<sub>2</sub></i> is calculated again 56 according to s<sub>2</sub>=G<sub>size</sub> - NbP - NbB, and compared again 57 with the given threshold. If the <i>Temporal subsampling factor</i> is not yet below the threshold, the number of P-frames to be removed is further increased and the calculation repeated. NbP is a variable that is initialized to 1 and incremented with every execution of the loop. nb<sub>iter</sub> is a count variable, counting executions of the<!-- EPO <DP n="9"> --> loop and therefore (in Light mode) also the number of P-frames to be skipped. Alternatively, it is also possible to calculate s<sub>2,min</sub> = G<sub>size</sub> - NbP<sub>max</sub> - NbB (with NbP<sub>max</sub> being the total number of P-frames in the GOP) and add single P-frames back, i.e. decrease NbP<sub>max</sub> , as long as the resulting s<sub>2</sub> is below the threshold.</p><p id="p0033" num="0033">Finally, all remaining frames are processed 59, including cropping etc.</p><p id="p0034" num="0034">Another parameter is the maximum allowed <b>Zoom factor</b> s<sub>3</sub>, or pair of Zoom factors (<i>s<sub>3</sub></i> = <i>(z<sub>min</sub>,z<sub>max</sub>)</i>). For determining the zoom factor s<sub>3</sub>, in one embodiment the macroblock (MB) cost map is used that corresponds to the first frame of a GOP or scene, which is usually an I-frame. The MB cost map indicates for each MB its coding cost. <figref idrefs="f0003">Fig.6</figref> shows exemplarily four different MB cost maps for different bit rates and different scenes. Each MB cost map is depicted to the right of the original picture. The most important blocks can clearly be identified (light blocks, which have highest coding cost), and then the minimal and maximal zoom boundaries to be used in the reframing process can be derived from that. In one embodiment of the invention, the zoom factors are re-adjusted at every scene cut. In that case, a scene cut detection is performed before the processing.</p><p id="p0035" num="0035">The zoom factor z of the cropping window may change over time between the defined <i>Zoom factors</i> according to Z<sub>min</sub> ≤ z ≤ z<sub>max</sub>. However, one of z<sub>min</sub>,Z<sub>max</sub> may be implicitly or explicitly given.</p><p id="p0036" num="0036">In one embodiment, <i>s</i><sub>3</sub> = (<i>z<sub>min</sub></i>,<i>z<sub>max</sub></i>) can be defined according to <maths id="math0003" num="(eq.3)"><math display="block"><msub><mi>s</mi><mn>3</mn></msub><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">z</mi><mi mathvariant="italic">min</mi></msub><mo>=</mo><mfrac><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MBadji</mi></msub><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MB</mi></msub></mfrac></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">z</mi><mi mathvariant="italic">max</mi></msub><mo>=</mo><mfrac><mrow><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MB</mi></msub><mo>-</mo><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MBcosto</mi></msub></mrow><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MB</mi></msub></mfrac></mtd></mtr></mtable></mfenced></math><img id="ib0003" file="imgb0003.tif" wi="144" he="19" img-content="math" img-format="tif"/></maths><br/>
where nb<sub>MB</sub> is the total number of MBs within the picture, <i>nb<sub>MBcost0</sub></i> is the number of MB with a cost equal to 0 (dark MBs in <figref idrefs="f0003">Fig.6</figref>, e.g. on upper and lower edges), which need not necessarily be adjacent to each other, and <i>nb<sub>MBadj</sub></i> is the number of MBs which have a high cost (&gt; max cost / 2) and which are spatially adjacent to each other. In one embodiment, it is the largest group of adjacent MBs with a highest cost (&gt; max cost / 2) in the picture.<!-- EPO <DP n="10"> --></p><p id="p0037" num="0037">Another parameter is the <i><b>Bounding box velocity</b> s<sub>4</sub>.</i> In the same way as the zoom factor, the bounding box velocity may be tuned smartly, particularly if it is tuned on a per-scene basis. In one embodiment, the bounding box velocity is set according to similarity with an adjacent picture, which can be expressed by a correlation coefficient between a current <i>IntraMap</i> and the adjacent picture's <i>IntraMap,</i> where an <i>IntraMap</i> is a map of intra-coded MBs in P- or B-pictures. The more the average correlation coefficient of intra-coded MBs in the adjacent pictures deviates from its average, the lower is the allowed bounding box velocity. The <i>IntraMaps</i> provide information about complexity of the scene, since difficult MBs to be encoded are usually intra-coded. From this information, a value that describes the correlation between consecutive IntraMaps is deduced. It has been found that if the correlation is high (i.e. little or no global motion, little or no local motion), the bounding box velocity should be low in order to fix the window. On the other hand, if the correlation is very low, this probably results from strong camera motion or a strong change of content (e.g. someone moving in front of the camera). In this case, no adaptation is more preferable than a strong adaptation of the bounding box location, which may have no sense in terms of content, and which may be disturbing. Therefore also for low correlation the bounding box velocity should be low. For a medium correlation, the changes in content can easier be handled, and higher velocity can be used to allow a fast re-positioning of the bounding box.</p><p id="p0038" num="0038">In one embodiment, the Bounding box velocity can be calculated according to <maths id="math0004" num="(eq.4)"><math display="block"><msub><mi mathvariant="normal">s</mi><mn mathvariant="normal">4</mn></msub><mo>=</mo><mi mathvariant="normal">f</mi><mfenced separators=""><mi>GOPsize</mi><mo>⁢</mo><msub><mi>IntraMap</mi><mi>GOP</mi></msub></mfenced></math><img id="ib0004" file="imgb0004.tif" wi="145" he="9" img-content="math" img-format="tif"/></maths><br/>
for example <maths id="math0005" num="(eq.5)"><math display="block"><msub><mi>s</mi><mn>4</mn></msub><mo>=</mo><msub><mi>V</mi><mi mathvariant="italic">max</mi></msub><mn>.</mn><msup><mi>e</mi><mrow><mo>-</mo><msup><mfenced><mfrac><mrow><mi>x</mi><mo>-</mo><mi>m</mi></mrow><mi>σ</mi></mfrac></mfenced><mn>2</mn></msup></mrow></msup></math><img id="ib0005" file="imgb0005.tif" wi="147" he="12" img-content="math" img-format="tif"/></maths><br/>
with <maths id="math0006" num="(eq.6)"><math display="block"><mi>x</mi><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi mathvariant="italic">Gop</mi><mi mathvariant="italic">size</mi></msub><mo>-</mo><mn>1</mn></mrow></mfrac><mn>.</mn><msubsup><mi mathvariant="normal">Σ</mi><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><msub><mi mathvariant="italic">Gop</mi><mi mathvariant="italic">size</mi></msub><mo>-</mo><mn>1</mn></mrow></msubsup><mo>⁢</mo><mi mathvariant="italic">CC</mi><mo>⁢</mo><mfenced separators=""><msub><mi mathvariant="italic">IntraMap</mi><mi mathvariant="italic">i</mi></msub><mo>⁢</mo><msub><mi mathvariant="italic">IntraMap</mi><mrow><mi mathvariant="italic">i</mi><mo>+</mo><mn>1</mn></mrow></msub></mfenced></math><img id="ib0006" file="imgb0006.tif" wi="160" he="14" img-content="math" img-format="tif"/></maths><br/>
where <i>IntraMap</i> is the map of intra-coded MBs in P- or B-pictures, CC is the correlation coefficient between the current <i>IntraMap</i> and an adjacent one (i.e. the next one or previous one), and V<sub>max</sub> is the maximal allowed velocity of the bounding box. In eq.6, x refers to a current and a previous GOP. Then the<!-- EPO <DP n="11"> --> bounding box is changing over time as a Gaussian function, as depicted in <figref idrefs="f0003">Fig.7</figref>. m and σ are the mean and the standard deviation, respectively, of the distribution of the velocity. They may be tuned e.g. to m=0.5 and σ=0.2. Note that m, σ and V<sub>max</sub> are fixed parameters defined as maximum values in the system. As described above, maximum bounding box velocity is allowed when the correlation has a medium value.</p><p id="p0039" num="0039"><figref idrefs="f0004">Fig.8</figref> shows, exemplarily and in a simplified manner, a limitation of the bounding box velocity. Note that the depicted scale may be unrealistic, and has just been used for clarification. In a previous image im<sub>n-1</sub> a first bounding box bb<sub>1</sub> around a most salient area sa<sub>1</sub> is determined, and in a current image im<sub>n</sub> a second bounding box bb<sub>2</sub> around a most salient area sa<sub>2</sub> is determined, as described above. Then, a shift vector or shift distance d<sub>det</sub> between the first and second bounding boxes is determined, and compared with a maximum allowed shift vector or shift distance d<sub>max</sub>.</p><p id="p0040" num="0040">Alternatively, when considering the temporal distance (using the frame rate f) between the images im<sub>n-1</sub>, im<sub>n</sub>, a determined actual bounding box velocity can be calculated according to v<sub>det</sub> = d<sub>det</sub> * f. The determined actual bounding box velocity is compared with a maximum allowed bounding box velocity v<sub>max</sub>.</p><p id="p0041" num="0041">If the determined bounding box shift vector d<sub>det</sub> is above (i.e. longer than) the maximum allowed bounding box shift vector d<sub>max</sub>, or if the determined bounding box velocity v<sub>det</sub> is above the maximum allowed bounding box velocity v<sub>max</sub>, then a position and/or size of a new bounding box is determined, and the sub-area according to the determined new bounding box position is cropped in the current image for being displayed (i.e. only the portion of the image that is identified by the bounding box is displayed). Otherwise, if the determined bounding box shift vector d<sub>det</sub> is not above the maximum allowed bounding box shift vector d<sub>max</sub> or if the determined bounding box velocity v<sub>det</sub> is not above the maximum allowed bounding box velocity v<sub>max</sub>, then the second bounding box can be used as it is. Similarly, the zoom factor can be explained. <figref idrefs="f0004">Fig.9</figref> shows, exemplarily and in a simplified manner, a limitation of the bounding box zoom factor. Note that the<!-- EPO <DP n="12"> --> depicted scale may be unrealistic. In a previous image im<sub>n-1</sub> a first bounding box bb<sub>1</sub> around a most salient area is determined, and in a current image im<sub>n</sub> a second bounding box bb<sub>2</sub> around a most salient area is determined, as described above. In this example, the second bounding box bb<sub>2</sub> is considerably smaller than the first bounding box bb<sub>1</sub>. Then, a zoom factor is calculated. In principle, the zoom factor may be calculated from the number of pixels with the bounding boxes, e.g. according to z = n<sub>bb2</sub>/n<sub>bb1</sub>. The calculated zoom factor is compared with a maximum allowed zoom factor z<sub>max</sub>.</p><p id="p0042" num="0042">If the determined zoom factor z<sub>det</sub> is not above the maximum allowed zoom factor z<sub>max</sub>, the second bounding box can be used as it is. Otherwise, if the determined zoom factor z<sub>det</sub> is above the maximum allowed zoom factor z<sub>max</sub>, then a size of a new bounding box bb<sub>det</sub> is determined such that the maximum allowed zoom factor z<sub>max</sub> is met. The new bounding box bb<sub>det</sub> is concentric with the second bounding box bb<sub>2</sub>. The sub-area according to the determined new bounding box bb<sub>det</sub> position is cropped in the current image for being displayed.</p><p id="p0043" num="0043">It is to be noted that the above with respect to <figref idrefs="f0004">Fig.8 and Fig.9</figref> is an explanation of the principle of the bounding box concept. In real implementations, e.g. for bounding box velocity, a filter (e.g. Kalman filter) is applied to the bounding box coordinates, and the bounding box velocity is a noise factor that is injected in the filter in order to smooth the trajectory of the bounding box coordinates and the bounding box size.</p><p id="p0044" num="0044">Bounding box (or cropping window) refers to the sub-area or sub-set of pixels that are selected, in one embodiment, as being the most salient to be included in a window. In one embodiment, this window is set to a targeted pre-defined aspect ratio (e.g. defined by the user). Then, in one embodiment, in the reframing application the window varies in location (x and y axis) and/or in size. The velocity refers only to the position of the box, i.e. the way the bounding box changes its location over time. Therefore it is influenced e.g. by camera motion. Practically, the bounding box velocity can be considered as the velocity at which the visible portion of the frames moves.<!-- EPO <DP n="13"> --></p><p id="p0045" num="0045"><figref idrefs="f0004">Fig.10</figref> shows a principle block diagram of an apparatus 100 for processing images of an input video sequence seq<sub>in</sub> according to the invention. The apparatus comprises an image analysis module 102 and an image processing module 110. The image analysis module comprises a first parameter determining module 103 for determining parameters of the video sequence, a second parameter determining module 104 for determining parameters of a previously decoded GOP of the video sequence, and a user interface module 105 for determining user settings. Further, the apparatus comprises a crop window positioning module 106 for determining a portion to be cropped according to the determined parameters, and a cropping module 107 for cropping the determined portion for being displayed. A sequence of cropped images seq<sub>cr</sub> is provided on the output. Various parameters of the video sequence can be determined and utilized separately or combined, as described above. The above-mentioned modules can be implemented either as hardware modules, as software-supported hardware modules, or as software modules.</p><p id="p0046" num="0046">In one embodiment, the apparatus further comprises a scene change detection module. Where the subsequence is a scene (i.e. a "shot"), the scene (or rather: a scene change) is detected by the scene change detection module.</p><p id="p0047" num="0047">In one embodiment, the apparatus further comprises at least one of: means for determining in a previous image (im<sub>n-1</sub>) a sub-area or sub-set of pixels (sa<sub>1</sub>) being the most salient portion of the previous image, means for determining a first bounding box (bb<sub>1</sub>) around said sub-area or sub-set of pixels of the previous image, means for determining in the current image (im<sub>n</sub>) a sub-area or sub-set of pixels (sa<sub>2</sub>) being the most salient portion of the current image, means for determining a second bounding box (bb<sub>2</sub>) around said area of the current image, means for calculating from positions of the first bounding box (bb<sub>1</sub>) and the second bounding box (bb<sub>2</sub>) a bounding box shift (d<sub>det</sub>), or calculating from positions of the first bounding box (bb<sub>1</sub>) and the second bounding box (bb<sub>2</sub>) and the video frame rate a bounding box velocity, means for comparing the determined bounding box shift (d<sub>det</sub>) or bounding box velocity with a maximum<!-- EPO <DP n="14"> --> allowed bounding box shift or bounding box velocity between successive images, and means for determining a position and/or size of a new bounding box (bb<sub>det</sub>) and cropping in the current image the sub-area according to the determined new bounding box for being displayed, if the determined bounding box shift is above the maximum allowed bounding box shift, or if the determined bounding box velocity is above the maximum allowed bounding box velocity, and for otherwise, if the determined bounding box shift (d<sub>det</sub>) or bounding box velocity is at or below the maximum allowed bounding box shift or bounding box velocity, cropping in the current image the sub-area according to the determined second bounding box (bb<sub>2</sub>) for being displayed.</p><p id="p0048" num="0048">An advantage of the present invention is that it performs automatic tuning of reframing parameters, based on reliable and useful decoding information of the content. That is, the reframing parameters are tuned automatically based on the content by using information available when decoding the video (in particular, properties of the previously decoded sequence). Conventionally encoded video sequences can be used, since no additional information needs to be inserted during encoding. Some settings S of the reframing application can be tuned automatically from the decoding process or decoded stream. These parameters are one or more of: the buffer size s<sub>1</sub>, a temporal subsampling factor s<sub>2</sub>, the zoom factors s<sub>3</sub>=(z<sub>min</sub>,z<sub>max</sub>) and the bounding box velocity s<sub>4</sub>, as described above.</p><p id="p0049" num="0049">In one embodiment, settings or input parameters for a decoded video sequence are automatically tuned according to properties of its immediate preceding decoded sequence.<br/>
In one embodiment of the present invention, the reframing application is performed after video decoding.</p><p id="p0050" num="0050">The invention can be implemented in devices capable of displaying video, or devices for pre-processing video for being displayed. The invention is particularly useful for video displaying devices with a small screen size.<br/>
It will be understood that the present invention has been described purely by way of example, and modifications of detail can be made without departing from the<!-- EPO <DP n="15"> --> scope of the invention. While there has been shown, described, and pointed out fundamental novel features of the present invention as applied to preferred embodiments thereof, it will be understood that various omissions and substitutions and changes in the apparatus and method described, in the form and details of the devices disclosed, and in their operation, may be made by those skilled in the art, without departing from the spirit of the present invention. It is expressly intended that all combinations of those elements that perform substantially the same function in substantially the same way to achieve the same results are within the scope of the invention. Substitutions of elements from one described embodiment to another are also fully intended and contemplated.</p><p id="p0051" num="0051">Each feature disclosed in the description and (where appropriate) the claims and drawings may be provided independently or in any appropriate combination. Features may, where appropriate be implemented in hardware, software, or a combination of the two. Reference numerals appearing in the claims are by way of illustration only and shall have no limiting effect on the scope of the claims.<!-- EPO <DP n="16"> --></p><heading id="h0006"><u>Cited References</u></heading><p id="p0052" num="0052">European patent application <patcit id="pcit0003" dnum="EP1956550A"><text>EP 1 956 550 A</text></patcit> (ref. PF070015)</p></description><claims mxw-id="PCLM56976401" lang="EN" load-source="patent-office"><!-- EPO <DP n="17"> --><claim id="c-en-0001" num="0001"><claim-text>A method for processing images of a video sequence, comprising steps of
<claim-text>- determining parameters of the video sequence, parameters of a previously decoded subsequence of the video sequence and user settings;</claim-text>
<claim-text>- determining a portion to be cropped according to the determined parameters, wherein the portion to be cropped is defined by a bounding box having at least one of a variable position and a variable size, wherein the variable position depends on a correlation between intra-coded macroblocks of adjacent frames in the video sequence, wherein for a first correlation value of said correlation the bounding box position varies faster than for a correlation value higher or lower than the first correlation value, and wherein the variable size depends on a maximum zoom factor that is calculated from parameters of a macroblock cost map of a first frame of a current GOP or scene, wherein a higher maximum zoom factor is allowed if a percentage of macroblocks with a cost equal to zero is lower; and</claim-text>
<claim-text>- cropping in a reframing step the determined portion for being displayed.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein said subsequence is a GOP or a scene, the scene being detected by scene change detection.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 1 or 2, wherein parameters of the video sequence or parameters of a previously decoded subsequence comprise at least one of a GOP size, a scene length, a temporal subsampling factor, minimum and maximum zoom factors and a bounding box velocity.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to any of the claims 1-3, wherein said determining parameters of the video sequence comprises, for a current image,
<claim-text>- determining in a previous image (im<sub>n-1</sub>) a sub-area or sub-set of pixels (sa<sub>1</sub>) being the most salient portion of the previous image;</claim-text>
<claim-text>- determining a first bounding box (bb<sub>1</sub>) around said sub-area or sub-set of pixels of the previous image;</claim-text>
<claim-text>- determining in the current image (im<sub>n</sub>) a sub-area or sub-set of pixels (sa<sub>2</sub>) being the most salient portion of the current image;<!-- EPO <DP n="18"> --></claim-text>
<claim-text>- determining a second bounding box (bb<sub>2</sub>) around said area of the current image, the second bounding box having said variable bounding box position;</claim-text>
<claim-text>- calculating from positions of the first bounding box (bb<sub>1</sub>) and the second bounding box (bb<sub>2</sub>) a bounding box shift (d<sub>det</sub>), or calculating from positions of the first bounding box (bb<sub>1</sub>) and the second bounding box (bb<sub>2</sub>) and the video frame rate a bounding box shift (d<sub>det</sub>) and a bounding box velocity;</claim-text>
<claim-text>- comparing the determined bounding box shift (d<sub>det</sub>) or bounding box velocity with a maximum allowed bounding box shift or bounding box velocity between successive images; and</claim-text>
<claim-text>- if the determined bounding box shift is above the maximum allowed bounding box shift, or if the determined bounding box velocity is above the maximum allowed bounding box velocity, then determining a position and/or size of a new bounding box (bb<sub>det</sub>) and cropping in the current image the sub-area according to the determined new bounding box for being displayed;</claim-text>
<claim-text>- otherwise, if the determined bounding box shift (d<sub>det</sub>) or bounding box velocity is at or below the maximum allowed bounding box shift or maximum allowed bounding box velocity, cropping in the current image the sub-area according to the determined second bounding box (bb<sub>2</sub>) for being displayed.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to one of the claims 1-4, wherein the maximum allowed bounding box shift or bounding box velocity is determined from parameters of a previously decoded subsequence of the video sequence.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method according to one of the claims 1-5, wherein the maximum allowed bounding box velocity is calculated according to <maths id="math0007" num=""><math display="block"><msub><mi>s</mi><mn>4</mn></msub><mo>=</mo><msub><mi>V</mi><mi mathvariant="italic">max</mi></msub><mn>.</mn><msup><mi>e</mi><mrow><mo>-</mo><msup><mfenced><mfrac><mrow><mi>x</mi><mo>-</mo><mi>m</mi></mrow><mi>σ</mi></mfrac></mfenced><mn>2</mn></msup></mrow></msup></math><img id="ib0007" file="imgb0007.tif" wi="42" he="13" img-content="math" img-format="tif"/></maths> with <maths id="math0008" num=""><math display="block"><mi>x</mi><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi mathvariant="italic">Gop</mi><mi mathvariant="italic">size</mi></msub><mo>-</mo><mn>1</mn></mrow></mfrac><mn>.</mn><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><msub><mi mathvariant="italic">Gop</mi><mi mathvariant="italic">size</mi></msub><mo>-</mo><mn>1</mn></mrow></munderover></mstyle><mi mathvariant="italic">CC</mi><mo>⁢</mo><mfenced separators=""><msub><mi mathvariant="italic">IntraMap</mi><mi mathvariant="italic">i</mi></msub><mo>⁢</mo><msub><mi mathvariant="italic">IntraMap</mi><mrow><mi mathvariant="italic">i</mi><mo>+</mo><mn>1</mn></mrow></msub></mfenced></math><img id="ib0008" file="imgb0008.tif" wi="98" he="18" img-content="math" img-format="tif"/></maths> wherein <i>IntraMap</i> is a map of intra-coded MBs in P- or B-pictures, CC is a<!-- EPO <DP n="19"> --> correlation coefficient between a current <i>IntraMap</i> and an adjacent <i>IntraMap,</i> and V<sub>max</sub> is the maximal velocity of the bounding box, and m and σ are mean and standard deviation of a distribution of the bounding box velocity.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>Method according to any of claims 1-6, further comprising a step of smoothing the cropping window parameters over time, wherein a buffer is used in the reframing step to smooth the cropping window parameters over time, and wherein the buffer size s<sub>1</sub> is adjusted according to the GOP size.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>Method according to any of claims 1-7, wherein a Temporal Subsampling factor or a Temporal Subsampling scheme is set according to a temporal subsampling mode, wherein in a first subsampling mode (FM) the reframing step is applied to all frames, and in a second subsampling mode (IM) the reframing step is applied to all I-frames and P-frames and is not applied to zero or more B-frames, and in a third subsampling mode (LM) the reframing step is applied to all I-frames and is not applied to any B-frame and not applied to zero or more P-frames.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>Method according to claim 8, wherein one of the subsampling modes is selected according to at least one of bitrate requirements and image quality requirements.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>Method according to any of claims 1-9, wherein the portion to be cropped is defined by a cropping window, further comprising a step of determining a maximum or minimum allowed zoom factor or a pair of zoom factors, the maximum or minimum allowed zoom factor defining a boundary up to which the cropping window may change over time, or the pair of zoom factors defining two boundaries between which the cropping window may change over time.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>Method according to claim 10, wherein the pair of zoom factors is calculated from said parameters of a macroblock cost map of a first frame of a current<!-- EPO <DP n="20"> --> GOP or scene.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>Method according to one of the claims 1-11, wherein a minimum allowed zoom factor is calculated according to <maths id="math0009" num=""><math display="inline"><msub><mi>z</mi><mi mathvariant="italic">min</mi></msub><mo>=</mo><mfrac><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MBadj</mi></msub><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MB</mi></msub></mfrac></math><img id="ib0009" file="imgb0009.tif" wi="28" he="9" img-content="math" img-format="tif" inline="yes"/></maths> and a maximum allowed zoom factor is calculated according to <maths id="math0010" num=""><math display="inline"><msub><mi>z</mi><mi mathvariant="italic">max</mi></msub><mo>=</mo><mfrac><mrow><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MB</mi></msub><mo>-</mo><msub><mi mathvariant="italic">nb</mi><mrow><mi mathvariant="italic">MBcost</mi><mo>⁢</mo><mn>0</mn></mrow></msub></mrow><msub><mi mathvariant="italic">nb</mi><mi mathvariant="italic">MB</mi></msub></mfrac><mo>,</mo></math><img id="ib0010" file="imgb0010.tif" wi="42" he="9" img-content="math" img-format="tif" inline="yes"/></maths><br/>
wherein <i>nb<sub>MB</sub></i> is the total number of MBs within the image, <i>nb<sub>MBcost0</sub></i> is the number of MBs with a cost equal to 0, <i>nb<sub>MBadj</sub></i> is the number of adjacent MBs with a highest cost.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>An apparatus for processing images of a video sequence, comprising
<claim-text>- image analysis means for determining parameters of the video sequence, determining parameters of a previously decoded subsequence of the video sequence and determining user settings; and</claim-text>
<claim-text>- image processing means for determining a portion to be cropped according to the determined parameters and for cropping the determined portion for being displayed, wherein the portion to be cropped is defined by a bounding box having at least one of a variable position and a variable size, wherein the variable position depends on a correlation between intra-coded macroblocks of adjacent frames in the video sequence, wherein for a first correlation value of said correlation the bounding box position varies faster than for a correlation value higher or lower than the first correlation value, and wherein the variable size depends on a zoom factor that is calculated from parameters of a macroblock cost map of a first frame of a current GOP or scene, wherein a higher maximum zoom factor is allowed if a percentage of macroblocks with a cost equal to zero is lower.</claim-text></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The apparatus according to claim 13, further comprising a scene change detection module, wherein said subsequence is a GOP or a scene, the scene being detected by the scene change detection module.</claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The apparatus according to claim 13 or 14, further comprising<!-- EPO <DP n="21"> -->
<claim-text>- means for determining in a previous image (im<sub>n-1</sub>) a sub-area or sub-set of pixels (sa<sub>1</sub>) being the most salient portion of the previous image;</claim-text>
<claim-text>- means for determining a first bounding box (bb<sub>1</sub>) around said sub-area or sub-set of pixels of the previous image;</claim-text>
<claim-text>- means for determining in the current image (im<sub>n</sub>) a sub-area or sub-set of pixels (sa<sub>2</sub>) being the most salient portion of the current image;</claim-text>
<claim-text>- means for determining a second bounding box (bb<sub>2</sub>) around said area of the current image;</claim-text>
<claim-text>- means for calculating from positions of the first bounding box (bb<sub>1</sub>) and the second bounding box (bb<sub>2</sub>) a bounding box shift (d<sub>det</sub>), or calculating from positions of the first bounding box (bb<sub>1</sub>) and the second bounding box (bb<sub>2</sub>) and the video frame rate a bounding box velocity;</claim-text>
<claim-text>- means for comparing the determined bounding box shift (d<sub>det</sub>) or bounding box velocity with a maximum allowed bounding box shift or bounding box velocity between successive images; and</claim-text>
<claim-text>- means for determining a position and/or size of a new bounding box (bb<sub>det</sub>) and cropping in the current image the sub-area according to the determined new bounding box for being displayed, if the determined bounding box shift is above the maximum allowed bounding box shift, or if the determined bounding box velocity is above the maximum allowed bounding box velocity, and for otherwise, if the determined bounding box shift (d<sub>det</sub>) or bounding box velocity is at or below the maximum allowed bounding box shift or bounding box velocity, cropping in the current image the sub-area according to the determined second bounding box (bb<sub>2</sub>) for being displayed.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16667182" load-source="patent-office"><!-- EPO <DP n="22"> --><figure id="f0001" num="1,2,3"><img id="if0001" file="imgf0001.tif" wi="146" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="23"> --><figure id="f0002" num="4,5"><img id="if0002" file="imgf0002.tif" wi="146" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="24"> --><figure id="f0003" num="6a,6b,6c,6d,7"><img id="if0003" file="imgf0003.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="25"> --><figure id="f0004" num="8a,8b,9a,9b,10"><img id="if0004" file="imgf0004.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
