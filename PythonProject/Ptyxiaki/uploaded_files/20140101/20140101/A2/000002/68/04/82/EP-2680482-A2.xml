<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680482-A2" country="EP" doc-number="2680482" kind="A2" date="20140101" family-id="45567528" file-reference-id="316852" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549206" ucid="EP-2680482-A2"><document-id><country>EP</country><doc-number>2680482</doc-number><kind>A2</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13186101-A" is-representative="NO"><document-id mxw-id="PAPP154823129" load-source="docdb" format="epo"><country>EP</country><doc-number>13186101</doc-number><kind>A</kind><date>20110729</date><lang>EN</lang></document-id><document-id mxw-id="PAPP228536462" load-source="docdb" format="original"><country>EP</country><doc-number>13186101.5</doc-number><date>20110729</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140447674" ucid="EP-11816222-A" linkage-type="3" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>11816222</doc-number><kind>A</kind><date>20110729</date></document-id></priority-claim><priority-claim mxw-id="PPC140445970" ucid="JP-2010181344-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2010181344</doc-number><kind>A</kind><date>20100813</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988116834" load-source="docdb">H04L   1/18        20060101AFI20131007BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1744177486" load-source="docdb" scheme="CPC">H04W  72/048       20130101 LI20171019BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1744177487" load-source="docdb" scheme="CPC">H04L   5/0055      20130101 FI20171019BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1744177488" load-source="docdb" scheme="CPC">H04L   5/0051      20130101 LI20171019BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1744177489" load-source="docdb" scheme="CPC">H04L   5/0026      20130101 LI20171019BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1744177490" load-source="docdb" scheme="CPC">H04W  72/042       20130101 LA20171019BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1744177491" load-source="docdb" scheme="CPC">H04W  72/04        20130101 LI20171020BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766675" load-source="docdb" scheme="CPC">H04L  25/03949     20130101 LI20170325BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766676" load-source="docdb" scheme="CPC">H04L  25/03929     20130101 LI20170325BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766677" load-source="docdb" scheme="CPC">H04L   1/1861      20130101 LI20170325BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766678" load-source="docdb" scheme="CPC">H04L   1/1819      20130101 LA20170325BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766679" load-source="docdb" scheme="CPC">H04L   1/0026      20130101 LI20170325BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766680" load-source="docdb" scheme="CPC">H04J  13/18        20130101 LI20170325BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766681" load-source="docdb" scheme="CPC">H04J  13/004       20130101 LI20170325BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833766682" load-source="docdb" scheme="CPC">H04B   7/0456      20130101 LI20170325BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180102" lang="DE" load-source="patent-office">Übertragungswiederholungsverfahren und Endgerät dafür</invention-title><invention-title mxw-id="PT132180103" lang="EN" load-source="patent-office">Retransmission method and terminal device thereof</invention-title><invention-title mxw-id="PT132180104" lang="FR" load-source="patent-office">Procédé de retransmission et dispositif terminal correspondant</invention-title><citations><non-patent-citations><nplcit><text>PANASONIC, SAMSUNG, MOTOROLA, NTT DOCOMO, NEC, PANATECH: "R1-104219, "Way Forward on CS and OCC signalling for UL DMRS"", UNKNOWN</text><sources><source mxw-id="PNPL70844491" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><related-documents><relation type="division"><child-doc ucid="EP-13186101-A"><document-id load-source="patent-office" format="epo"><country>EP</country><doc-number>13186101</doc-number><kind>A</kind><date>20110729</date></document-id></child-doc><parent-doc ucid="EP-11816222.1"><document-id load-source="patent-office" format="epo"><country>EP</country><doc-number>11816222.1</doc-number><date>20110729</date></document-id></parent-doc></relation></related-documents><parties><applicants><applicant mxw-id="PPAR918154015" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>PANASONIC CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR918163462" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>PANASONIC CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR918981768" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Panasonic Corporation</last-name><iid>101067135</iid><address><street>1006, Oaza Kadoma</street><city>Kadoma-shi Osaka 571-8501</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918170225" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HOSHINO MASAYUKI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918145908" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HOSHINO, MASAYUKI</last-name></addressbook></inventor><inventor mxw-id="PPAR918992112" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>HOSHINO, MASAYUKI</last-name><address><street>Panasonic Corporation c/o Panasonic Corporation Intellectual Property Centre IP Development Group 7th Floor OBP, Panasonic Tower 2-1-61</street><city>Shiromi-Chuo-Ku, Kanagawa 540-6207</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918170540" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>NISHIO AKIHIKO</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918151068" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>NISHIO, AKIHIKO</last-name></addressbook></inventor><inventor mxw-id="PPAR918990434" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>NISHIO, AKIHIKO</last-name><address><street>Panasonic Corporation c/o Panasonic Corporation Intellectual Property Centre IP Development Group 7th Floor OBP, Panasonic Tower 2-1-61</street><city>Shiromi-Chuo-Ku, Osaka 540-6207</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918163646" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>IMAMURA DAICHI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918148976" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>IMAMURA, DAICHI</last-name></addressbook></inventor><inventor mxw-id="PPAR918982202" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>IMAMURA, DAICHI</last-name><address><street>Panasonic Corporation c/o Panasonic Corporation Intellectual Property Centre IP Development Group 7th Floor OBP, Panasonic Tower 2-1-61</street><city>Shiromi-Chuo-Ku, Kanagawa 540-6207</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918983993" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Grünecker, Kinkeldey, Stockmair &amp; Schwanhäusser Anwaltssozietät</last-name><iid>100060488</iid><address><street>Leopoldstrasse 4</street><city>80802 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548872321" load-source="docdb">AL</country><country mxw-id="DS548848980" load-source="docdb">AT</country><country mxw-id="DS548872331" load-source="docdb">BE</country><country mxw-id="DS548855025" load-source="docdb">BG</country><country mxw-id="DS548854952" load-source="docdb">CH</country><country mxw-id="DS548803361" load-source="docdb">CY</country><country mxw-id="DS548848981" load-source="docdb">CZ</country><country mxw-id="DS548872332" load-source="docdb">DE</country><country mxw-id="DS548803366" load-source="docdb">DK</country><country mxw-id="DS548803367" load-source="docdb">EE</country><country mxw-id="DS548837508" load-source="docdb">ES</country><country mxw-id="DS548855026" load-source="docdb">FI</country><country mxw-id="DS548801903" load-source="docdb">FR</country><country mxw-id="DS548872333" load-source="docdb">GB</country><country mxw-id="DS548803368" load-source="docdb">GR</country><country mxw-id="DS548872338" load-source="docdb">HR</country><country mxw-id="DS548849666" load-source="docdb">HU</country><country mxw-id="DS548854953" load-source="docdb">IE</country><country mxw-id="DS548803369" load-source="docdb">IS</country><country mxw-id="DS548801904" load-source="docdb">IT</country><country mxw-id="DS548803374" load-source="docdb">LI</country><country mxw-id="DS548855027" load-source="docdb">LT</country><country mxw-id="DS548849223" load-source="docdb">LU</country><country mxw-id="DS548855028" load-source="docdb">LV</country><country mxw-id="DS548855029" load-source="docdb">MC</country><country mxw-id="DS548849224" load-source="docdb">MK</country><country mxw-id="DS548849225" load-source="docdb">MT</country><country mxw-id="DS548801905" load-source="docdb">NL</country><country mxw-id="DS548837509" load-source="docdb">NO</country><country mxw-id="DS548854954" load-source="docdb">PL</country><country mxw-id="DS548849226" load-source="docdb">PT</country><country mxw-id="DS548801906" load-source="docdb">RO</country><country mxw-id="DS548849227" load-source="docdb">RS</country><country mxw-id="DS548854955" load-source="docdb">SE</country><country mxw-id="DS548849667" load-source="docdb">SI</country><country mxw-id="DS548837510" load-source="docdb">SK</country><country mxw-id="DS548854956" load-source="docdb">SM</country><country mxw-id="DS548855031" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669876" lang="EN" load-source="patent-office"><p id="pa01" num="0001">The present invention provides a terminal device that allows constraints on user allocation to be prevented and spread codes to be allocated in a scheduler when non-adaptive HARQ is employed using a PHICH. A codeword generator (103) generates code words (CW) by encoding data, a layer mapping unit (108) places each CW in one or a plurality of layers, a DMRS generator (110) generates a reference signal for each layer in which a CW is placed by using any resource among a plurality of resources defined by a mutually orthogonal plurality of OCCs, and an ACK/NACK demodulator (102) receives a response signal indicating a retransmission request. When a response signal requesting retransmission of only a CW placed in a plurality of layers is received, the DMRS generator (110) uses each resource having the same OCC among the plurality of resources for the reference signals generated in the corresponding layers.
<img id="iaf01" file="imgaf001.tif" wi="123" he="74" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499249" lang="EN" source="EPO" load-source="docdb"><p>The present invention provides a terminal device that allows constraints on user allocation to be prevented and spread codes to be allocated in a scheduler when non-adaptive HARQ is employed using a PHICH. A codeword generator (103) generates code words (CW) by encoding data, a layer mapping unit (108) places each CW in one or a plurality of layers, a DMRS generator (110) generates a reference signal for each layer in which a CW is placed by using any resource among a plurality of resources defined by a mutually orthogonal plurality of OCCs, and an ACK/NACK demodulator (102) receives a response signal indicating a retransmission request. When a response signal requesting retransmission of only a CW placed in a plurality of layers is received, the DMRS generator (110) uses each resource having the same OCC among the plurality of resources for the reference signals generated in the corresponding layers.</p></abstract><description mxw-id="PDES63955306" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">Technical Field</heading><p id="p0001" num="0001">The present invention relates to a terminal apparatus, a base station apparatus, a retransmission method and a resource allocating method.</p><heading id="h0002">Background Art</heading><p id="p0002" num="0002">In recent years, attempts have been made to improve throughput by providing a plurality of antennas on both a base station apparatus (referred to simply as a base station hereinafter) and a terminal apparatus (referred to simply as a terminal hereinafter) to introduce the MIMO (multiple-input multiple-output) communication technology on uplink. In this MIMO communication technology, a study is made on data transmission using precoding control in a terminal. In the precoding control, the base station estimates a channel condition between the base station and the terminal, from a receiving condition of a reference signal (Sounding Reference Signal: SRS) independently transmitted from each antenna of the terminal, selects a precoder which is optimal for the estimated channel condition and applies the precoder to data transmission.<!-- EPO <DP n="2"> --></p><p id="p0003" num="0003">Particularly, precoding control based on a transmission rank is applied to LTE-Advanced (Long Term Evolution-Advanced: hereinafter, referred to as a LTE-A). Specifically, the base station selects the most suitable rank and precoder for the channel matrix formed by the values of observed SRSs transmitted from the terminal. Herein, a rank refers to the number of space multiplexing (the number of layers) in space division multiplexing (SDM) and is the number of independent data transmitted at the same time. To be more specific, code books having different sizes are employed for respective ranks. The base station receives a reference signal transmitted from the terminal, estimates a channel matrix from the received signal, and selects a rank and a precoder which is optimal for the estimated channel matrix.</p><p id="p0004" num="0004">In a communication path such as mobile communication, having a relatively large channel variation, a hybrid automatic repeat request (HARQ) is applied for an error controlling technique. HARQ is a technique whereby the transmitting side retransmits data, and the receiving side combines the received data and the retransmitted data to improve error correction performance and achieve high quality transmission. As a HARQ method, adaptive HARQ and non-adaptive HARQ are under study. Adaptive HARQ is a method for allocating retransmitted data to any resource. On the other hand, non-adaptive HARQ is a method for allocating retransmitted data to predetermined resources. In an uplink of LTE, the non-adaptive HARQ scheme<!-- EPO <DP n="3"> --> is employed among HARQ schemes.</p><p id="p0005" num="0005">A non-adaptive HARQ scheme will be described with reference to <figref idrefs="f0001">Fig. 1</figref>. In non-adaptive HARQ, the base station determines resources for allocating data in the first data allocation. The base station then reports transmission parameters to a terminal through a downlink control channel (PDCCH: Physical Downlink Control Channel). The transmission parameters include information such as allocated frequency resources indicating information on resource allocation, a transmission rank number, a precoder, and a modulation scheme/a coding rate. The terminal acquires the transmission parameters transmitted through the PDCCH and transmits first data, using a predetermined resource in accordance with the aforementioned resource allocation information.</p><p id="p0006" num="0006">The base station receives the first data and reports, to the terminal, a NACK corresponding to data which could not be demodulated in the first data, through a HARQ reporting channel (PHICH: Physical Hybrid-ARQ Indicator Channel). The terminal receives the NACK and controls retransmission by using the transmission parameters reported through the PDCCH, the parameters including information resource allocation and the like. Specifically, the terminal generates and transmits retransmission data, using an allocation frequency resource, a precoder, a modulation scheme, and the like, which are the same as those in the first transmission. The terminal changes an RV<!-- EPO <DP n="4"> --> (Redundancy Version) parameter depending on the number of retransmission requests. The RV parameter represents a reading position in a memory (referred to as a circular buffer) for storing Turbo-coded data. For example, when the memory is equally divided into approximately four regions and tops of the areas are assigned zero, one, two, and three respectively, the terminal changes an RV parameter (a reading position) in order of zero, two, one, three, and zero depending on the number of retransmission requests.</p><p id="p0007" num="0007">Non-adaptive HARQ is often used together with Synchronous HARQ employing the constant transmission interval. In LTE, retransmission data is retransmitted eight subframes after the report of the NACK.</p><p id="p0008" num="0008">Non-adaptive HARQ is performed on a per predetermined control unit basis, the control unit is referred to as a code word (CW). The CW is a control unit to which the same modulation scheme and coding rate are applied. As with the CW processed in a physical layer dealing with modulation and coding, the control unit may be referred to as a transport block (TB) since the control unit is processed in a MAC layer dealing with HARQ, and the CW may be distinguished from the TB. The present embodiment however employs uniform notation "CW" without a distinction therebetween hereafter.</p><p id="p0009" num="0009">In LTE, the transmission of one CW is generally applied to rank 1 (in transmission in a single rank) in the first transmission, and the transmission of two CWs is applied to<!-- EPO <DP n="5"> --> ranks 2, 3, and 4 (in transmission in multiple ranks) in the first transmission. In the transmission in multiple ranks, CW0 is allocated to Layer 0 and CW1 is allocated to Layer 1 in rank 2. In rank 3, CW0 is allocated to Layer 0, and CW1 is allocated to Layer 1 and Layer 2. In rank 4, CW0 is allocated to Layer 0 and Layer 1, and CW1 is allocated to Layer 2 and Layer 3.</p><p id="p0010" num="0010">When retransmitting only CWs allocated to a plurality of layers, the terminal transmits one CW at a time in rank 2. To be more specific, when retransmitting CW1 in rank 3 and CW0 or CW1 in rank 4, the terminal transmits these CWs as one CW in rank 2.</p><p id="p0011" num="0011">Since the base station includes a larger number of antennas compared to the terminal, the base station is flexibly installed relatively. For this reason, a so-called multiuser MIMO, which assigns the same resource to a plurality of terminals, can be applied through an adequate process on a received signal in the base station. An example case will be described where the same resource is allocated to two terminals through the terminal having one transmitting antenna and the base station having two receiving antennas. This case can be equivalently treated as a MIMO channel with two transmitting antennas and two receiving antennas, and the base station can process a received signal. To be more specific, the base station performs a general MIMO received-signal process such as spatial filtering, canceller, and maximum likelihood estimation, thereby detecting respective signals transmitted from a plurality of<!-- EPO <DP n="6"> --> terminals. With multiuser MIMO, the base station estimates interference values between terminals based on the channel condition between the base station and each terminal, and sets transmission parameters for the respective terminals by considering interference values, in order to more stably operate a communication system.</p><p id="p0012" num="0012">As described above, a MIMO operation for a single terminal (a single user) provided with a plurality of antennas is sometimes referred to as a single-user MIMO to distinguish it from the multiuser MIMO. An operation to allocate a plurality of terminals, each of which is capable of a single-user MIMO operation and has more than one transmission antennas provided thereon, to the same resource is also referred to as a multiuser MIMO.</p><p id="p0013" num="0013">The terminal transmits not only the SRS described above but also a demodulation reference signal (Demodulation RS or DMRS) to the base station, and the base station uses the received DMRS for demodulating data. In LTE-A, the DMRS is transmitted for each layer. The terminal transmits the DMRS using the same precoding vector as that of the signal transmitted for each layer. In order for a plurality of terminals to transmit the DMRSs for a plurality of layers in the same frequency resource, some multiplexing process is needed. In LTE-A, as a process of multiplexing the DMRSs, multiplexing using an orthogonal cover code (OCC) is used in addition to multiplexing using a cyclic shift sequence used in LTE to multiplex a plurality<!-- EPO <DP n="7"> --> of terminals.</p><p id="p0014" num="0014">The cyclic shift sequence is generated by cyclic shift of a predetermined one of CAZAC (constant amplitude zero auto-correlation) sequences having good auto-correlation characteristics and a constant amplitude. For example, twelve cyclic shift sequences each of which having a starting point at one of twelve points that equally divide a CAZAC sequence along the code length are used. In the following, the starting point will be expressed as ncs.</p><p id="p0015" num="0015">As for the OCC, spreading codes having a sequence length of 2 are formed using a DMRS, which includes two symbols per sub-frame, taking into consideration the transmission format of the uplink data. To be more specific, in LTE-A, as OCCs, two spreading codes having a sequence length of 2, {+1, +1} and {+1, -1}, are formed. In the following, a spreading code according to the OCC will be expressed as n<sub>OCC</sub>. For example, the two spreading codes {+1, +1} and {+1, -1} are expressed as n<sub>OCC</sub> = 0 and 1, respectively.</p><p id="p0016" num="0016">Further, n<sub>CS</sub> and n<sub>OCC</sub> are included in transmission parameters reported from the base station to the terminal through the PDCCH. A specific method of reporting the transmission parameters including ncs and nocc, in particular, a specific reporting method using the single-user MIMO, will be described later.</p><p id="p0017" num="0017">Next, interference between DMRSs multiplexed in the same frequency resource will be described. <figref idrefs="f0002">Fig. 2</figref> is a<!-- EPO <DP n="8"> --> schematic diagram showing interference between DMRSs to which n<sub>CS</sub> = 6 and n<sub>OCC</sub> = 0 are allocated. The interference between the DMRSs formed by the cyclic shift sequence and the OCC described above is characterized in that the DMRSs having the same value of n<sub>OCC</sub> and adjacent values of n<sub>CS</sub> interfere with each other. For example, reference signals having the same value of n<sub>OCC</sub> and adjacent values of n<sub>CS</sub> that differ from each other by up to 3 or so (indicated by the arrows in <figref idrefs="f0002">Fig. 2</figref>) (that is, reference signals whose n<sub>OCC</sub> is 0 and whose ncs falls within a range of 3 to 5 or a range of 7 to 9 in <figref idrefs="f0002">Fig. 2</figref>) interfere with each other. Therefore, as for n<sub>CS</sub>, in order for reference signals to be allocatable at the same time, the values of n<sub>CS</sub> of the reference signals preferably differ by 6 or so.</p><p id="p0018" num="0018">As for nocc, on the other hand, if reference signals to be allocated (to be multiplexed) at the same time have the same code length, that is, the same bandwidth allocated thereto, the reference signals are expected to be orthogonal to each other if they have different values of n<sub>OCC</sub>. The degree of the orthogonality (referred to simply as orthogonality) depends on the fading correlation between the two symbols in one sub-frame to which the reference signals (DMRSs) are allocated. For example, in a low-speed moving environment, which is a primary application of MIMO, high orthogonality is expected to be assured.</p><p id="p0019" num="0019">Next, a method of reporting a spreading code of a DMRS in the single-user MIMO will be described. According to a<!-- EPO <DP n="9"> --> method of reporting a spreading code of a DMRS in LTE, the base station sets arbitrary spreading codes using a parameter n<sub>DMRS</sub><sup>(1)</sup> set for each user in a higher layer assuming a relatively long period and a parameter n<sub>DMRS</sub><sup>(2)</sup> that is a transmission parameter reported through the PDCCH and set for a relevant transmission sub-frame by decision of the scheduler, and indicates the spreading codes to the terminal. The terminal generates a DMRS using a prescribed n<sub>CS</sub> calculated from the indicated parameter (n<sub>DMRS</sub><sup>(1)</sup> or n<sub>DMRS</sub><sup>(2)</sup>).</p><p id="p0020" num="0020">In LTE-A, there is proposed a method of expanding the reporting method described above to the single-user MIMO (see Non-Patent Literature 1, for example). In Non-Patent Literature 1, the starting point of the cyclic shift sequence and the set value of OCC for the k-th layer (k = 0 to 3) are set as n<sub>DMRS,k</sub><sup>(2)</sup> (corresponding to n<sub>CS</sub> described above) and n<sub>OCC,k</sub>, respectively. In Non-Patent Literature 1, information reported through higher layers or the PDCCH is only the set values (n<sub>DMRS,0</sub><sup>(2)</sup> and n<sub>OCC,0</sub>) for the 0-th layer (k = 0, Layer 0), and the set values for the remaining layers (k = 1 to 3, Layers 1 to 3) are determined by calculation from the set values for the 0-th layer (k = 0, Layer 0). This is an attempt to minimize the overhead involved in reporting of the controlling signal.</p><p id="p0021" num="0021">To be more specific, Non-Patent Literature 1 discloses that each set value is set as follows in order to avoid the interference between the reference signals as far as possible in the single-user MIMO.<!-- EPO <DP n="10"> --></p><p id="p0022" num="0022">Specifically, n<sub>DMRS,0</sub><sup>(2)</sup> is defined as (n<sub>DMRS,0</sub><sup>(2)</sup> + Δ<sub>k</sub>) mod 12<br/>
where<br/>
in transmission using two layers, Δ<sub>k</sub> = 0 for k = 0, and Δ<sub>k</sub> = 6 for k = 1,<br/>
in transmission using three layers, Δ<sub>k</sub> = 0 for k = 0, Δ<sub>k</sub> = 6 for k = 1, and Δ<sub>k</sub> = 3 for k = 2, or<br/>
Δ <sub>k</sub> = 0 for k = 0, Δ<sub>k</sub> = 4 for k = 1, and Δ<sub>k</sub> = 8 for k = 2, and<br/>
in transmission using four layers, Δ<sub>k</sub> = 0 for k = 0, Δ<sub>k</sub> = 6 for k = 1, Δ<sub>k</sub> = 3 for k = 2, and Δ<sub>k</sub> = 9 for k = 3.</p><p id="p0023" num="0023">Further, n<sub>OCC,k</sub> is defined as n<sub>OCC,0</sub> or (1 - n<sub>OCC,0</sub>) where<br/>
n<sub>OCC,k</sub> = n<sub>OCC,0</sub> for k = 1, and n<sub>OCC,k</sub> = (1 - nocc,o) for k = 2 or 3.</p><heading id="h0003">Citation List</heading><heading id="h0004">Non-Patent Literature</heading><p id="p0024" num="0024"><ul><li>NPL 1<br/>
R1-104219, "Way Forward on CS and OCC signalling for UL DMRS", Panasonic, Samsung, Motorola, NTT DOCOMO, NEC, Panatech</li></ul></p><heading id="h0005">Summary of Invention</heading><heading id="h0006">Technical Problem</heading><p id="p0025" num="0025">A case where a terminal transmits data using the<!-- EPO <DP n="11"> --> above-described conventional method for allocating spreading codes of a reference signal (DMRS), and a base station applies non-adaptive HARQ control using a PHICH will be described. In this case, the PHICH used for instructing data retransmission cannot carry information on transmission parameters. As a result, the same spreading codes for the reference signal as those used in the first transmission are used in retransmission of data, more specifically, retransmission of a CW in response to a NACK returned from the base station.</p><p id="p0026" num="0026">For example, in the case where the first transmission is transmission using three layers (rank 3 transmission) as shown in <figref idrefs="f0003">Fig. 3</figref>, the spreading codes (CS (starting point n<sub>CS,k</sub>) and OCC (code n<sub>OCC,k</sub>)) used for each layer (k = 0 to 3) are the following three sets: n<sub>CS,0</sub> = 0 and n<sub>OCC,0</sub> = 0, n<sub>CS,1</sub> = 6 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 3 and n<sub>OCC,2</sub> = 1. As shown in <figref idrefs="f0003">Fig. 3</figref>, it is assumed that the base station reports an instruction for retransmission of only CW1 in the PHICH to the terminal (CWO: ACK, CW1: NACK). Then, the spreading codes used in retransmission of CW1 are the same two sets as those used in the first transmission: n<sub>CS,1</sub> = 6 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 3 and n<sub>OCC,2</sub> = 1. The two sets of spreading codes occupy both OCCs (n<sub>OCC,k</sub> = 0 and 1).</p><p id="p0027" num="0027">As a result, only the resources of spreading codes (referred to as a spreading code resource, hereinafter) in the region enclosed by the dashed line in the right half (in retransmission) of <figref idrefs="f0003">Fig. 3</figref> are available for allocation to a new user to be multiplexed in the same resource. To be more<!-- EPO <DP n="12"> --> specific, as shown in the right half of <figref idrefs="f0003">Fig. 3</figref>, for both OCCs (n<sub>OCC,k</sub> = 0 and 1), spreading code resources having ncs whose values differ by 6 or so are not available for allocation to a new user.</p><p id="p0028" num="0028">Thus, as shown in <figref idrefs="f0003">Fig. 3</figref>, when the scheduler at the base station is to multiplex a new user that performs transmission using two layers as a multiuser MIMO operation (when spreading codes having the same value of OCC and values of n<sub>CS</sub> that differ by 6 or so are to be used), there are no available spreading code resources, and no spreading code resources can be allocated to the new user.</p><p id="p0029" num="0029">As described above, when non-adaptive HARQ control is applied using the PHICH, there are restrictions on allocation of spreading codes to a new user by the scheduler.</p><p id="p0030" num="0030">An object of the present invention is to provide a terminal apparatus, a base station apparatus, a retransmitting method and a resource allocating method that allow a scheduler to perform a spreading code allocating operation by avoiding restrictions on allocation of a spreading code to a new user even in the case where non-adaptive HARQ control is applied using a PHICH.</p><heading id="h0007">Solution to Problem</heading><p id="p0031" num="0031">A terminal apparatus reflecting an aspect of the present invention has: a code word generating section that generates a code word by encoding a data sequence; a mapping section that<!-- EPO <DP n="13"> --> allocates each code word to one or a plurality of layers; a reference signal generating section that generates a reference signal for each of the layers to which the code word is allocated, using any of resources from among a plurality of resources defined by a plurality of codes orthogonal to each other; and a receiving section that receives a response signal indicating a retransmission request for the code word, and in a case where the received response signal is to request for retransmission of only a single code word allocated to the plurality of layers, the reference signal generating section uses resources having a same code from among the plurality of resources, for the reference signal generated for each of the plurality of layers.</p><p id="p0032" num="0032">According to another aspect, the terminal apparatus, further comprises: a storage section that stores the resources used for the reference signal generated for each of the plurality of layers in a first transmission, wherein the reference signal generating section uses resources having a same code from among the resources stored in the storage section, for the reference signal generated for each of the plurality of layers in a retransmission.</p><p id="p0033" num="0033">According to a further aspect, the terminal apparatus wherein the reference signal generates section changes, for each retransmission, the same code used for the reference signal generated for each of the plurality of layers.</p><p id="p0034" num="0034">A base station reflecting an aspect of the present invention has: a receiving section that receives a code word<!-- EPO <DP n="14"> --> allocated to one or a plurality of layers; a detecting section that detects an error of the received code word; a response signal generating section that generates a response signal indicating a result of error detection of the code word; and a scheduling section that allocates any of resources from among a plurality of resources defined by a plurality of codes orthogonal to each other, to the reference signal to be transmitted from each terminal apparatus and to be generated for each of the layers to which the code word is allocated, and in a case where only the result of error detection of a single code word allocated to the plurality of layers shows a NACK, the scheduling section identifies resources used for the reference signal for each of the plurality of layers transmitted from a terminal apparatus to retransmit the single code word, as resources having a same code from among the plurality of resources, and allocates a resource having a different code than the same code from among the plurality of resources, to the reference signal transmitted from another terminal apparatus different from the terminal apparatus to perform the retransmission.</p><p id="p0035" num="0035">A retransmitting method reflecting an aspect of the present invention includes: generating a code word by encoding a data sequence; allocating each code word to one or a plurality of layers; generating a reference signal for each of the layers to which the code word is allocated, using any of resources from among a plurality of resources defined by a plurality of codes orthogonal to each other; and receiving a response signal<!-- EPO <DP n="15"> --> indicating a retransmission request for the code word, and in a case where the received response signal is to request for retransmission of only a single code word allocated to the plurality of layers, resources having a same code from among the plurality of resources are used for the reference signal generated for each of the plurality of layers.</p><p id="p0036" num="0036">A resource allocating method reflecting an aspect of the present invention includes: receiving a code word allocated to one or a plurality of layers; detecting an error of the received code word; generating a response signal indicating a result of error detection of the code word; and allocating any of resources from among a plurality of resources defined by a plurality of codes orthogonal to each other, to the reference signal to be transmitted from each terminal apparatus and to be generated for each of the layers to which the code word is allocated, and in a case where only the result of error detection of a single code word allocated to the plurality of layers shows a NACK, resources used for the reference signal for each of the plurality of layers transmitted from a terminal apparatus to retransmit the single code word are identified as resources having a same code from among the plurality of resources, and a resource having a different code than the same code from among the plurality of resources is allocated to the reference signal transmitted from another terminal apparatus different from the terminal apparatus to perform the retransmission.<!-- EPO <DP n="16"> --></p><heading id="h0008">Advantageous Effects of Invention</heading><p id="p0037" num="0037">According to the present invention, even in the case where non-adaptive HARQ control is applied using a PHICH, it is possible for a scheduler to perform a spreading code allocating operation by avoiding restrictions on allocation of a spreading code to a new user.</p><heading id="h0009">Brief Description of Drawings</heading><p id="p0038" num="0038"><ul><li><figref idrefs="f0001">Fig. 1</figref> illustrates a non-adaptive HARQ scheme;</li><li><figref idrefs="f0002">Fig. 2</figref> is a diagram for illustrating interference between reference signals (DMRSs);</li><li><figref idrefs="f0003">Fig. 3</figref> illustrates the scheme disclosed in Non-Patent Literature 1;</li><li><figref idrefs="f0004">Fig. 4</figref> is a block diagram showing a configuration of main components of a transmitting apparatus according to Embodiment 1 of the present invention;</li><li><figref idrefs="f0005">Fig. 5</figref> is a block diagram showing a configuration of main components of a receiving apparatus according to Embodiment 1 of the present invention;</li><li><figref idrefs="f0006">Fig. 6</figref> is a diagram for illustrating a spreading code allocating process according to Embodiment 1 of the present invention;</li><li><figref idrefs="f0007">Fig. 7</figref> is a block diagram showing a configuration of main components of a transmitting apparatus according to Embodiment 2 of the present invention;<!-- EPO <DP n="17"> --></li><li><figref idrefs="f0008">Fig. 8</figref> is a block diagram showing a configuration of main components of a transmitting apparatus according to Embodiment 3 of the present invention;</li><li><figref idrefs="f0009">Fig. 9</figref> is a diagram for illustrating a spreading code setting process according to Embodiment 3 of the present invention; and</li><li><figref idrefs="f0010">Fig. 10</figref> is a diagram for illustrating a spreading code allocating process according to Embodiment 3 of the present invention;</li></ul></p><heading id="h0010">Description of Embodiments</heading><p id="p0039" num="0039">Embodiments of the present invention will now be described in detail with reference to the drawings.</p><heading id="h0011">(Embodiment 1)</heading><p id="p0040" num="0040"><figref idrefs="f0004">Fig. 4</figref> is a block diagram showing a configuration of main components of a transmitting apparatus according to the present embodiment. Transmitting apparatus 100 in <figref idrefs="f0004">Fig. 4</figref> is applied to, for example, an LTE-A terminal. In order to avoid complicated explanation, <figref idrefs="f0004">Fig. 4</figref> shows components associated with transmission of uplink data which is closely related to the present invention and components associated with reception of downlink response signals to that uplink data, and the illustration and explanation of components associated with reception of downlink data will be omitted.</p><p id="p0041" num="0041">PDCCH demodulating section 101 demodulates transmission parameters (parameters associated with data<!-- EPO <DP n="18"> --> transmission) determined in a base station, from a PDCCH included in a signal transmitted from the base station (a receiving apparatus described later). The transmission parameters include information such as allocated frequency resources (allocated resource blocks (RBs), for example), a transmission rank number, a precoder, a modulation scheme, a coding rate, RV parameters used in retransmission, or spreading codes for the reference signal (DMRS) associated with a 0-th layer (k = 0, Layer 0) (n<sub>CS,0</sub> (or n<sub>DMRS,0</sub><sup>(2)</sup>) and n<sub>OCC,0</sub> described above, for example). PDCCH demodulating section 101 outputs the demodulated transmission parameters to rate matching section 105, modulating section 107, layer mapping section 108, DMRS generating section 110 and SC-FDMA signal generating section 113.</p><p id="p0042" num="0042">ACK/NACK demodulating section 102 demodulates, for each CW, ACK/NACK information indicating the result of error detection of the received signal at the base station, from a PHICH included in the signal transmitted from the base station (the receiving apparatus described later). Then, ACK/NACK demodulating section 102 outputs the demodulated ACK/NACK information to rate matching section 105, layer mapping section 108 and DMRS generating section 110.</p><p id="p0043" num="0043">The number of code word generating sections 103 depends on the number of code words (CW), and code word generating section 103 generates a CW by encoding input transmission data (a data sequence). Each code word generating<!-- EPO <DP n="19"> --> section 103 includes coding section 104, rate matching section 105, interleaving/scrambling section 106 and modulating section 107.</p><p id="p0044" num="0044">Coding section 104 receives transmission data, provides CRC (Cyclic Redundancy Checking) to the transmission data, encodes the data to generate coded data, and outputs the generated coded data to rate matching section 105.</p><p id="p0045" num="0045">Rate matching section 105 includes a buffer and stores the coded data in the buffer. Rate matching section 105 then performs a rate matching process on the coded data based on the transmission parameters outputted from PDCCH demodulating section 101 to adaptively adjust an M-ary modulation value or a coding rate. Rate matching section 105 then outputs the coded data subjected to the rate matching process to interleaving/scrambling section 106. In retransmission (if the ACK/NACK information from ACK/NACK demodulating section 102 shows a NACK), rate matching section 105 reads a predetermined amount of coded data depending on the M-ary modulation value and the coding rate as retransmission data, from the starting position in the buffer indicated by the RV parameter outputted from PDCCH demodulating section 101. Rate matching section 105 then outputs the read retransmission data to interleaving/scrambling section 106.</p><p id="p0046" num="0046">Interleaving/scrambling section 106 performs an interleaving/scrambling process on the coded data received from rate matching section 105 and outputs the coded data subjected<!-- EPO <DP n="20"> --> to the interleaving/scrambling process to modulating section 107.</p><p id="p0047" num="0047">Modulating section 107 performs an M-ary modulation on the coded data based on the transmission parameters received from PDCCH demodulating section 101 to generate modulated signals and outputs the modulated signals to layer mapping section 108.</p><p id="p0048" num="0048">Layer mapping section 108 maps, to each layer on a CW basis, the modulated signals received from modulating section 107 in each code word generating section 103 based on the transmission parameters received from PDCCH demodulating section 101 and the ACK/NACK information received from ACK/NACK demodulating section 102. Herein, layer mapping section 108 maps (allocates) each CW to one or more layers depending on the transmission rank number included in the transmission parameters, as described above. Layer mapping section 108 then outputs the mapped CWs to precoding section 109.</p><p id="p0049" num="0049">Precoding section 109 performs precoding process on the DMRS received from DMRS generating section 110 or the CWs received from layer mapping section 108 to apply a weight to each DMRS or CW. Precoding section 109 then outputs precoded CWs and DMRS to SC-FDMA (Single Carrier Frequency Division Multiple Access) signal generating section 113.</p><p id="p0050" num="0050">DMRS generating section 110 generates a DMRS for each of the layers, which depends on the transmission rank<!-- EPO <DP n="21"> --> number, based on the transmission parameters received from PDCCH demodulating section 101 and the ACK/NACK information received from ACK/NACK demodulating section 102. In the present embodiment, a plurality of spreading code resources for DMRSs are defined based on cyclic shift sequences that can be separated from each other using different amounts of cyclic shift (n<sub>CS,k</sub> = 0 to 11, for example) and OCCs that are orthogonal to each other (n<sub>OCC,k</sub> = 0, 1, for example). DMRS generating section 110 generates a DMRS for each layer to which a CW is allocated, using any of the plurality of spreading code resources for DMRSs.</p><p id="p0051" num="0051">To be more specific, DMRS generating section 110 calculates, based on the spreading codes (ncs,o and n<sub>OCC,0</sub>, for example) used in the DMRS associated with the 0-th layer (k = 0, Layer 0), included in the transmission parameters, as described above, the spreading codes used in the DMRS associated with each of the other layers (k = 1, 2 and 3, Layers 1, 2 and 3). DMRS generating section 110 outputs the spreading codes generated based on the transmission parameters received from PDCCH demodulating section 101 (that is, the spreading codes used in the DMRS indicated by the base station through the PDCCH) to retransmission spreading code storage section 111. If the ACK/NACK information received from ACK/NACK demodulating section 102 shows a NACK (that is, if retransmission is required), DMRS generating section 110 sets spreading codes used in the DMRS in CW retransmission based<!-- EPO <DP n="22"> --> on the CW associated with the NACK and the spreading codes stored in retransmission spreading code storage section 111. A DMRS generating process conducted by DMRS generating section 110 in retransmission will be described later.</p><p id="p0052" num="0052">Retransmission spreading code storage section 111 stores the spreading codes received from DMRS generating section 110 (that is, the spreading code resource used for the DMRS generated for each layer in the first transmission and indicated through the PDCCH). Retransmission spreading code storage section 111 outputs the spreading codes stored therein to DMRS generating section 110 in response to a request from DMRS generating section 110.</p><p id="p0053" num="0053">SRS (Sounding Reference Signal) generating section 112 generates reference signal for measuring channel quality (SRS) and outputs the generated SRS to SC-FDMA signal generating section 113.</p><p id="p0054" num="0054">SC-FDMA signal generating section 113 performs SC-FDMA modulation on the reference signal (SRS) received from SRS generating section 112 or the precoded CW and DMRS to generate an SC-FDMA signal. SC-FDMA signal generating section 113 then performs a radio transmitting process (S/P (Serial/Parallel) transform, inverse Fourier transform, upconvert, amplification, and the like) on the generated SC-FDMA signal and transmits the signal subjected to the radio transmitting process through transmitting antennas. In view of the above, the first transmission data or retransmission data is transmitted<!-- EPO <DP n="23"> --> to the receiving apparatus.</p><p id="p0055" num="0055"><figref idrefs="f0005">Fig. 5</figref> is a block diagram showing a configuration of main components of a receiving apparatus according to the present embodiment. Receiving apparatus 200 in <figref idrefs="f0005">Fig. 5</figref> is applied to, for example, an LTE-A base station. Note that, to avoid complication of explanation, <figref idrefs="f0005">Fig. 5</figref> shows components associated with reception of uplink data which is closely related to the present invention and components associated with transmission of downlink response signals to that uplink data, and illustration and explanation of components associated with transmission of downlink data will be omitted.</p><p id="p0056" num="0056">The number of receiving RF section 201 depends on the number of antennas. Each receiving RF section 201 receives a signal transmitted from a terminal (transmitting apparatus 100 shown in <figref idrefs="f0004">Fig. 4</figref>) through antennas, transforms the received signal into a baseband signal through a radio receiving process (downconvert, Fourier transform, P/S transform and the like), and outputs the transformed baseband signal to channel estimating section 202 and spatial demultiplexing synchronization detecting section 203.</p><p id="p0057" num="0057">The number of sections for each of the sections from channel estimating sections 202 to PDCCH generating sections 211 depends on the number of terminals which the base station (receiving apparatus 200) can communicate with at the same time.</p><p id="p0058" num="0058">Channel estimating section 202 performs channel<!-- EPO <DP n="24"> --> estimation based on a reference signal (DMRS) included in the baseband signal and calculates a channel estimation value. In this process, channel estimating section 202 identifies the spreading codes used in the DMRS in accordance with an instruction from scheduling section 212. Channel estimating section 202 then outputs the calculated channel estimation value to PDCCH generating section 211 and spatial demultiplexing synchronization detecting section 203.</p><p id="p0059" num="0059">Spatial demultiplexing synchronization detecting section 203 demultiplexes the baseband signals mapped to a plurality of layers, using the channel estimation value and outputs the demultiplexed baseband signals to layer demapping section 204.</p><p id="p0060" num="0060">Layer demapping section 204 combines the demultiplexed baseband signals for each CW and outputs the combined CW to likelihood generating section 206.</p><p id="p0061" num="0061">The number of error detecting sections 205 depends on the number of CWs. Each of error detecting section 205 includes likelihood generating section 206, retransmission combining section 207, decoding section 208, and CRC detecting section 209.</p><p id="p0062" num="0062">Likelihood generating section 206 calculates a likelihood for each CW and outputs the calculated likelihood to retransmission combining section 207.</p><p id="p0063" num="0063">Retransmission combining section 207 stores past likelihoods for each CW and performs a<!-- EPO <DP n="25"> --> retransmission-combining process on the retransmission data, based on the RV parameter and outputs the combining-processed likelihood to decoding section 208.</p><p id="p0064" num="0064">Decoding section 208 decodes a likelihood obtained through the retransmission-combining process to generate decoded data and outputs the generated decoded data to CRC detecting section 209.</p><p id="p0065" num="0065">CRC detecting section 209 performs an error detecting process by CRC on the decoded data outputted from decoding section 208 and outputs the result of error detection for each CW to PHICH generating section 210 and scheduling section 212. CRC detecting section 209 outputs the decoded data as received data.</p><p id="p0066" num="0066">PHICH generating section 210 allocates ACK/NACK information indicating the result of error detection received from CRC detecting section 209 associated with each CW to a PHICH for each CW. The PHICH is provided with an ACK/NACK resource as a response resource for each CW. For example, PHICH generating section 210 allocates an ACK to the ACK/NACK resource for the CW0 when the result of error detection for the CW0 indicates the absence of an error, and allocates a NACK to the ACK/NACK resource for the CW0 when the result of error detection for the CW0 indicates the presence of an error. Similarly, PHICH generating section 210 allocates an ACK to an ACK/NACK resource corresponding to CW1 when the result of error detection with respect to CW1 indicates the<!-- EPO <DP n="26"> --> absence of an error, and allocates a NACK to the ACK/NACK resource corresponding to CW1 when the result of error detection with respect to CW1 indicates the presence of an error. In view of the above, PHICH generating section 210, as a response signal generating section, allocates an ACK or a NACK to a response resource provided in the PHICH for each CW. In this way, the ACK/NACK information indicating the result of error detection for each CW is allocated to the PHICH and transmitted to the terminal (transmitting apparatus 100) (not shown).</p><p id="p0067" num="0067">PDCCH generating section 211 estimates the channel condition based on the channel estimation value calculated by channel estimating section 202. Then, PDCCH generating section 211 determines transmission parameters for a plurality of terminals based on the estimated channel condition. In this process, PDCCH generating section 211 sets a spreading code resource used for the DMRS allocated to each terminal in accordance with an instruction from scheduling section 212. PDCCH generating section 211 allocates the set transmission parameters to the PDCCH. In this way, the transmission parameters for each terminal are allocated to the PDCCH and transmitted to each terminal (not shown).</p><p id="p0068" num="0068">Scheduling section 212 allocates any of a plurality of spreading code resources to the DMRS transmitted from each terminal and generated for each layer to which the CW transmitted by the terminal is allocated, based on the result of error detection inputted from CRC detecting section 209<!-- EPO <DP n="27"> --> associated with each CW. Then, scheduling section 212 indicates the spreading code resource allocated to each terminal to PDCCH generating section 211 associated with that terminal. Furthermore, scheduling section 212 indicates the spreading code resource allocated to each terminal to channel estimating section 202 associated with that terminal.</p><p id="p0069" num="0069">The operations of transmitting apparatus 100 (hereinafter, referred to as "a terminal") and receiving apparatus 200 (hereinafter, referred to as "a base station") configured as described above will now be described.</p><p id="p0070" num="0070">The terminal transmits a reference signal (SRS: Sounding Reference Signal) for estimating a channel condition (for measuring channel quality) in accordance with an instruction from the base station.</p><p id="p0071" num="0071">The base station receives the reference signal (SRS) and, based on the result of observation of the received signal, determines transmission parameters including allocated frequency resources (allocated RBs), a transmission rank number, a precoder, a modulation scheme, a coding rate, RV parameters used in retransmission, or spreading codes used in the reference signal (DMRS) associated with the 0-th layer (k = 0, Layer 0). The base station reports the determined transmission parameters to the terminal through PDCCH. The terminal needs time corresponding to about four subframes to generate transmission data in LTE, for example. Thus, the base station needs to report resource allocation in the (n-4)-th subframe in order to generate<!-- EPO <DP n="28"> --> transmission data transmitted in the n-th subframe. Therefore, the base station determines and reports transmission parameters based on a channel condition in the (n-4)-th subframe.</p><p id="p0072" num="0072">Then, the terminal extracts the transmission parameters from the PDCCH, generates the DMRS and a data signal for each layer based on the extracted transmission parameters, and performs a precoding on the DMRS and the data signal, thereby forming a transmission signal to be transmitted from each transmission antenna. The terminal transmits the generated transmission signal to the base station.</p><p id="p0073" num="0073">The spreading codes used in the DMRS associated with each layer (k = 1, 2 or 3, Layer 1, 2 or 3) is determined based on the value for that layer relative to the value for the 0-th layer (k = 0, Layer 0) which is included in the transmission parameters, as described above. In other words, the spreading codes for each of Layers 1, 2 and 3 is determined based on the spreading codes for Layer 0 (the spreading code included in the transmission parameters). The terminal also retains the spreading codes of the DMRS indicated through the PDCCH.</p><p id="p0074" num="0074">The base station performs a receiving process on the transmission signal transmitted from the terminal in the n-th subframe and generates the PHICH based on the result of error detection for each CW. In LTE, the base station can issue a retransmission instruction through the PDCCH as well as through the PHICH. However, such a situation is not closely related to the present invention and thus will not be described in detail.<!-- EPO <DP n="29"> --></p><p id="p0075" num="0075">The terminal refers to the PDCCH and the PHICH at a timing when the result of error detection is reported from the base station (in this case, the (n+4)-th subframe in LTE). The PHICH includes an instruction for HARQ.</p><p id="p0076" num="0076">When detecting an ACK from the PHICH, the terminal determines that the base station could successfully demodulate the corresponding CW and stops retransmission of the CW. On the other hand, when not detecting an ACK in the PHICH, the terminal determines that the base station could not demodulate the corresponding CW and instructs the CW to be retransmitted, and retransmits the CW at predetermined timing.</p><p id="p0077" num="0077">According to the aforementioned example, when not detecting an ACK corresponding to a CW transmitted in the n-th subframe, the terminal transmits retransmission data of the CW in the n+8-th subframe. For this transmission, as described above, the terminal uses the same transmission parameters (precoder, for example) as those indicated through the PDCCH in the (n-4)-th subframe, except that a predetermined value depending on the number of retransmission requests is used as the RV parameter, and values (spreading code resources) set in accordance with values (spreading code resources) stored in retransmission spreading code storage section 111 and the occurrences of ACKs and NACKs are used for the spreading codes of the DMRSs. A method of setting the spreading codes used in the DMRS in retransmission will be described hereinafter.<!-- EPO <DP n="30"> --></p><p id="p0078" num="0078">When the result of error detection of a CW indicates the absence of an error, the base station reports an ACK to the terminal, through a PHICH and instructs the transmission of the corresponding CW to be stopped. When the result of error detection of a CW indicates the presence of an error, the base station reports a NACK to the terminal through the PHICH. The base station performs a retransmission combining process and repeats a demodulating process. The base station performs demodulation of the retransmission data and resource allocation to another terminal based on the spreading code resources set in accordance with the spreading code resources indicated to the terminal in the first transmission and the result of error detection of the CW.</p><p id="p0079" num="0079">Next, a method of setting the spreading codes used in the DMRS in retransmission will be described.</p><p id="p0080" num="0080">In the following, as shown in <figref idrefs="f0006">Fig. 6</figref>, a case where the first transmission is transmission using three layers, as in the case shown in <figref idrefs="f0003">Fig. 3</figref>, will be described. That is, in the first transmission, CW0 is transmitted in the 0-th layer (k = 0, Layer 0), CW1 is transmitted in two layers of the first layer (k = 1, Layer 1) and the second layer (k = 2, Layer 2). The spreading codes used for Layers 0 to 2 in the first transmission are n<sub>CS,0</sub> = 0 and n<sub>OCC,0</sub> = 0, n<sub>CS,1</sub> = 6 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 3 and n<sub>OCC,2</sub> = 1, respectively. As shown in <figref idrefs="f0006">Fig. 6</figref>, it is assumed that only CW1 is retransmitted (reTX) as a result of error detection at the base station (that is, CW0: ACK, and CW1: NACK).<!-- EPO <DP n="31"> --></p><p id="p0081" num="0081">In retransmission of CW1 shown in <figref idrefs="f0006">Fig. 6</figref>, if the terminal uses the same spreading code resource for the DMRS (that is, set values stored in retransmission spreading code storage section 111) as that used in the first transmission, different OCCs (n<sub>OCC,2</sub> = 0 and 1) are applied to the two layers, Layers 1 and 2, to which CW1 is allocated, as in the case shown in <figref idrefs="f0003">Fig. 3</figref>.</p><p id="p0082" num="0082">Thus, when DMRS generating section 110 receives a response signal requesting for retransmission of only a single CW allocated to a plurality of layers, DMRS generating section 110 uses, for the DMRS generated for the plurality of layers, spreading code resources having the same OCC from among the plurality of spreading code resources defined by the plurality of OCCs (n<sub>OCC,k</sub> = 0, 1, in this example). That is, in a situation where different OCCs are applied to a plurality of layers to which the CW to be retransmitted is allocated when the spreading code resources for the DMRSs used in the first transmission are used in the retransmission, the terminal adjusts the spreading code resources for the DMRSs so that the spreading code resources having the same OCC for the plurality of layers to which the CW to be retransmitted is allocated are applied to the DMRSs.</p><p id="p0083" num="0083">To be more specific, the terminal uses spreading code resources having the same OCC from among the spreading code resources used for the DMRSs generated for a plurality of layers in the first transmission (that is, set values stored in<!-- EPO <DP n="32"> --> retransmission spreading code storage section 111), for the DMRSs generated for the plurality of layers to which the CW to be retransmitted is allocated. For example, in <figref idrefs="f0006">Fig. 6</figref>, the terminal uses two spreading codes having the same OCC (n<sub>OCC,k</sub> = 0) in retransmission, from among the three spreading code resources used in the first transmission. As shown in <figref idrefs="f0006">Fig. 6</figref>, two spreading codes n<sub>CS,1</sub> = 0 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 6 and n<sub>OCC,2</sub> = 0 are used for Layers 1 and 2, respectively, to which CW1 to be retransmitted is allocated, and these spreading codes occupy only one OCC (n<sub>OCC,k</sub> = 0).</p><p id="p0084" num="0084">As a result, as spreading code resources that are other than those occupied by Layers 1 and 2 to which CW1 to be retransmitted is allocated and that do not interfere with the spreading code resources used for CW1, the spreading code resources in the region enclosed by the dashed line in <figref idrefs="f0006">Fig. 6</figref> (the spreading code resources having an OCC of 1 (n<sub>OCC,k</sub> = 1) and any cyclic shift sequence (n<sub>CS,k</sub> = 0 to 11)) are available.</p><p id="p0085" num="0085">On the other hand, in a situation where different OCCs are applied to a plurality of layers to which the CW to be retransmitted is allocated when the spreading code resources for the DMRSs allocated to the terminal in the first transmission are used in the retransmission, the base station recognizes that the CW (DMRS) is to be retransmitted using the spreading code resources having the same OCC from among the spreading code resources for the DMRSs allocated to the terminal in the first transmission. And the base station demodulates the<!-- EPO <DP n="33"> --> retransmitted CW using the spreading codes having the same OCC described above from among the spreading code resources for the DMRS allocated to the terminal in the first transmission. Furthermore, the base station performs resource allocation to another terminal (a new user) taking into consideration that, from among the spreading code resources for the DMRS allocated in the first transmission, the spreading codes having the same OCC are used for the CW retransmitted.</p><p id="p0086" num="0086">That is, when only the result of error detection of a single CW allocated to a plurality of layers shows a NACK, the base station identifies the spreading code resources used for the DMRS for the plurality of layers transmitted by the terminal that retransmits the single code word as spreading code resources having the same OCC from among the plurality of spreading code resources. Furthermore, the base station allocates, from among the plurality of spreading code resources, spreading code resources having different OCCs than the OCC used by the terminal that performs the retransmission (the identified OCC) to the DMRSs transmitted by another terminal apparatus (a new user) different from the terminal that performs the retransmission.</p><p id="p0087" num="0087">For example, in <figref idrefs="f0006">Fig. 6</figref>, the result of error detection of the data received from CRC detecting section 209 is "CW0: absence of an error and CW1: presence of an error". Therefore, scheduling section 212 identifies that CW1 to be retransmitted next time from the terminal is generated using the DMRSs for the<!-- EPO <DP n="34"> --> spreading code resources different from those in the first transmission (n<sub>OCC,1</sub> = 0, n<sub>OCC,2</sub> = 1 shown in <figref idrefs="f0006">Fig. 6</figref>) and having the same OCC (n<sub>OCC,1</sub> = 0, n<sub>OCC,2</sub> = 0 shown in <figref idrefs="f0006">Fig. 6</figref>). Then, scheduling section 212 indicates to channel estimating section 202 that the two spreading code resources, n<sub>CS,1</sub> = 0 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 6 and n<sub>OCC,2</sub> = 0, are the spreading code resources applied to CW1 to be retransmitted.</p><p id="p0088" num="0088">Furthermore, as resources to be allocated to the DMRSs for another terminal (a new user) different from the terminal that retransmits CW1 shown in <figref idrefs="f0006">Fig. 6</figref>, scheduling section 212 uses spreading code resources that are other than the spreading code resources used for CW1 to be retransmitted (n<sub>OCC,1</sub> = 0 shown in <figref idrefs="f0006">Fig. 6</figref>) and do not interfere with the spreading code resources used for CW1. In other words, scheduling section 212 can allocate the spreading code resources in the region enclosed by the dashed line in <figref idrefs="f0006">Fig. 6</figref>, where the spreading code resources have an OCC of 1 (n<sub>OCC,k</sub> = 1) and any cyclic shift sequences (n<sub>CS,k</sub> = 0 to 11), to the DMRSs for another terminal.</p><p id="p0089" num="0089">Therefore, for example, even in the case where a scheduler is to multiplex a new user that performs transmission using two layers as a multiuser MIMO operation (that is, in the case where spreading codes having the same value of OCC and values of n<sub>CS,k</sub> that differ by 6 or so are used), spreading code resources whose values of n<sub>CS,k</sub> differ by 6 or so in the region enclosed by the dashed line in <figref idrefs="f0006">Fig. 6</figref> can be allocated. In this way, as shown in <figref idrefs="f0006">Fig. 6</figref>, the DMRS for the retransmission data<!-- EPO <DP n="35"> --> (CW1) and DMRSs for another terminal can be multiplexed.</p><p id="p0090" num="0090">As described above, on the side of the terminal (transmitting apparatus 100), in the case where a response signal that requests for retransmission of only a single code word allocated to a plurality of layers is received, DMRS generating section 110 uses spreading code resources having the same OCC from among a plurality of spreading code resources, for the DMRSs generated for the plurality of layers to which the code word to be retransmitted is allocated. As a result, a shortage of spreading code resources in retransmission can be prevented. In other words, even in the case where non-adaptive HARQ control is applied using the PHICH, it is possible to avoid restrictions on allocation of resources to a new user by the scheduler that would otherwise be imposed due to the continuation of use, for retransmission, of the spreading code resources for different OCCs set for DMRSs for a plurality of layers in the first transmission.</p><p id="p0091" num="0091">On the side of the base station (receiving apparatus 200), in the case where only the result of error detection of a single code word allocated to a plurality of layers shows a NACK, scheduling section 212 identifies that the spreading code resources used for the DMRSs for a plurality of layers transmitted by the terminal that retransmits the single code word are spreading code resources having the same OCC from among a plurality of spreading code resources. Furthermore, from among a plurality of spreading code resources, scheduling<!-- EPO <DP n="36"> --> section 212 allocates, to DMRSs transmitted by another terminal (a new user) different from the terminal that performs the retransmission, spreading code resources having different OCCs than the OCC used by the terminal that performs the retransmission (the same OCC for the layers). Accordingly, resources are adequately allocated to each terminal in application of multiuser MIMO.</p><p id="p0092" num="0092">Therefore, according to the present embodiment, the scheduler can perform spreading code allocation by avoiding restrictions on allocation of resources to a new user even in the case where non-adaptive HARQ control is applied using the</p><heading id="h0012">PHICH.</heading><heading id="h0013">(Embodiment 2)</heading><p id="p0093" num="0093">According to Embodiment 2, spreading code resources for the same OCC are used for DMRS generated for a plurality of layers to which one CW to be retransmitted is allocated, as in Embodiment 1. However, the present embodiment differs from Embodiment 1 in that the OCC used by the terminal (the same OCC for the layers) is changed each time retransmission occurs.</p><p id="p0094" num="0094">In the following, the present embodiment will be described in detail.</p><p id="p0095" num="0095"><figref idrefs="f0007">Fig. 7</figref> is a block diagram showing a configuration of main components of a transmitting apparatus according to the present embodiment. In transmitting apparatus 300 according to the present embodiment in <figref idrefs="f0007">Fig. 7</figref>, components in <figref idrefs="f0007">Fig. 7</figref> common to <figref idrefs="f0004">Fig. 4</figref> are assigned the same reference numerals as in<!-- EPO <DP n="37"> --> <figref idrefs="f0004">Fig. 4</figref>, and descriptions thereof are omitted here. Transmitting apparatus 300 shown in <figref idrefs="f0007">Fig. 7</figref> is transmitting apparatus 100 shown in <figref idrefs="f0004">Fig. 4</figref> in which retransmission number counting section 301 is additionally provided, and retransmission spreading code storage section 111 is replaced with retransmission spreading code storage section 302.</p><p id="p0096" num="0096">For each CW received from ACK/NACK demodulating section 102, if the ACK/NACK information shows a NACK, retransmission number counting section 301 increments the number of retransmissions for the CW and stores the number in the interior. In other words, retransmission number counting section 301 counts the number of retransmissions for each CW and stores the counted number of retransmissions for each CW. In addition, for each CW, if the ACK/NACK information shows an ACK, retransmission number counting section 301 resets the number of retransmissions for the CW. Then, retransmission number counting section 301 outputs the counted number of retransmissions for each CW to retransmission spreading code storage section 302.</p><p id="p0097" num="0097">Retransmission spreading code storage section 302 sets the OCC in accordance with the number of retransmissions received from retransmission number counting section 301 in accordance with a predetermined rule concerning the OCCs included in the spreading code resources. For example, in an odd-numbered retransmission, retransmission spreading code storage section 302 outputs the stored spreading code resources<!-- EPO <DP n="38"> --> without change to DMRS generating section 110, as in Embodiment 1. On the other hand, in an even-numbered retransmission, retransmission spreading code storage section 302 outputs the stored spreading code resources with their OCCs inverted to DMRS generating section 110. Note that the operations of retransmission spreading code storage section 302 are not limited to the processes described above, and the operation in the odd-numbered retransmission and the operation in the even-numbered retransmission may be interchanged.</p><p id="p0098" num="0098">As in Embodiment 1, in retransmission of only a single CW allocated to a plurality of layers, DMRS generating section 110 uses spreading code resources having the same OCC for the DMRSs generated for the plurality of layers to which the CW to be retransmitted is allocated. However, for each retransmission, DMRS generating section 110 changes the OCC used for the DMRSs generated for the plurality of layers to which the single CW to be retransmitted is allocated (the same OCC for the layers).</p><p id="p0099" num="0099">For example, as shown in <figref idrefs="f0006">Fig. 6</figref>, it is assumed that the first transmission is transmission using three layers, and the spreading codes used for the layers (k = 0, 1 and 2, Layers 0, 1 and 2) are ncs,o = 0 and n<sub>OCC,0</sub> = 0, n<sub>CS,1</sub> = 6 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 3 and n<sub>OCC,2</sub> = 1.</p><p id="p0100" num="0100">Here, as shown in <figref idrefs="f0006">Fig. 6</figref>, it is assumed that only CW1 allocated to Layers 1 and 2 (k = 1, 2) is to be retransmitted. In this case, in the odd-numbered (first, third, fifth and so on)<!-- EPO <DP n="39"> --> retransmissions, DMRS generating section 110 uses the two spreading codes (n<sub>CS,1</sub> = 0 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 6 and n<sub>OCC,2</sub> = 0) having the same OCC (n<sub>OCC,k</sub> = 0) without change, as shown in <figref idrefs="f0006">Fig. 6</figref>.</p><p id="p0101" num="0101">On the other hand, in the even-numbered (second, fourth, sixth and so on) retransmissions, DMRS generating section 110 uses the spreading code resources (n<sub>CS, 1</sub> = 0 and n<sub>OCC,1</sub> = 1, and n<sub>CS,2</sub> = 6 and n<sub>OCC,2</sub> = 1) obtained by inverting the OCC of the two spreading codes for the same OCC (n<sub>OCC,k</sub> = 0) (n<sub>CS, 1</sub> = 0 and n<sub>OCC,1</sub> = 0, and n<sub>CS,2</sub> = 6 and n<sub>OCC,2</sub> = 0) (that is, the OCC is inverted from n<sub>OCC,k</sub> = 0 to n<sub>OCC,k</sub> = 1) (not shown).</p><p id="p0102" num="0102">As a result, the DMRSs generated for the plurality of layers to which the CW to be retransmitted is allocated occupy spreading code resources having different OCCs in each retransmission. For example, in <figref idrefs="f0006">Fig. 6</figref>, in each of Layers 1 and 2 (k = 1, 2) to which CW1 to be retransmitted is allocated, spreading code resources having one OCC (n<sub>OCC,k</sub> = 0) are occupied in the odd-numbered retransmissions, and spreading code resources having the other OCC (n<sub>OCC,k</sub> = 1) are occupied in the even-numbered retransmissions.</p><p id="p0103" num="0103">On the other hand, on the side of the base station (receiving apparatus 200 (<figref idrefs="f0005">Fig. 5</figref>)), scheduling section 212 has the same function (not shown) as that of retransmission number counting section 301 of the terminal and outputs spreading code resources having different OCCs changed in accordance with the counted number of retransmissions of each CW to channel<!-- EPO <DP n="40"> --> estimating section 202 in the same manner as the terminal (transmitting apparatus 300). Furthermore, as in Embodiment 1, from among a plurality of spreading code resources, scheduling section 212 allocates spreading code resources having different OCCs than the OCC used by the terminal that performs the retransmission (the same OCC for a plurality of layers) to the DMRSs transmitted by another terminal (a new user) different from the terminal instructed to retransmit the CW allocated to the plurality of layers.</p><p id="p0104" num="0104">With such a configuration, according to the present embodiment, it is possible to avoid using a particular OCC (either one of n<sub>OCC,k</sub> = 0 or 1, for example) on the terminal that retransmits only the CW allocated to a plurality of layers. Therefore, the present embodiment not only achieves the same advantages as those of Embodiment 1 but also allows multiplexing of another terminal using different spreading codes for each retransmission of the CW.</p><heading id="h0014">(Embodiment 3)</heading><p id="p0105" num="0105">In Embodiments 1 and 2, cases have been described in which spreading code resources used for DMRSs used in CW retransmission are adjusted in accordance with the spreading code resources used in the first transmission and the occurrences of ACKs and NACKs. According to the present embodiment, spreading code resources used for DMRSs used in CW transmissions (the first transmission and the subsequent retransmissions) are adjusted in accordance with the spreading<!-- EPO <DP n="41"> --> code resources and the number of transmission layers (the transmission rank number) reported through the PDCCH.</p><p id="p0106" num="0106">In the following, the present embodiment will be described in detail.</p><p id="p0107" num="0107"><figref idrefs="f0008">Fig. 8</figref> is a block diagram showing a configuration of main components of a transmitting apparatus according to the present embodiment. In transmitting apparatus 400 according to the present embodiment in <figref idrefs="f0008">Fig. 8</figref>, components in <figref idrefs="f0008">Fig. 8</figref> common to <figref idrefs="f0004">Fig. 4</figref> are assigned the same reference numerals as in <figref idrefs="f0004">Fig. 4</figref>, and descriptions thereof are omitted here. Transmitting apparatus 400 shown in <figref idrefs="f0008">Fig. 8</figref> is transmitting apparatus 100 shown in <figref idrefs="f0004">Fig. 4</figref> in which retransmission spreading code storage section 111 is replaced with spreading code adjusting section 401.</p><p id="p0108" num="0108">In transmitting apparatus 400 (terminal) shown in <figref idrefs="f0008">Fig. 8</figref>, DMRS generating section 110 calculates, based on the spreading codes (ncs,o and n<sub>OCC,0</sub>, for example) used for the DMRS associated with the 0-th layer (k = 0, Layer 0) included in the transmission parameters reported from the base station through the PDCCH, spreading codes used for the DMRS associated with each of the other layers (k = 1, 2 and 3, Layers 1, 2 and 3), as in Embodiment 1. Then, DMRS generating section 110 outputs the calculated spreading codes (the spreading codes used for each of the layers (k = 0 to 3)) and the transmission rank number (that is, the number of transmission layers) included in the transmission parameters to spreading code adjusting section 401.<!-- EPO <DP n="42"> --></p><p id="p0109" num="0109">Spreading code adjusting section 401 adjusts the spreading codes received from DMRS generating section 110 based on the transmission rank number received from DMRS generating section 110. To be more specific, spreading code adjusting section 401 adjusts (resets) the spreading codes used for the respective number of transmission layers so that spreading code resources having the same OCC are allocated to the DMRSs generated for each of the plurality of layers to which the same CW is allocated, by referring to the relationship between the layers determined by the value of the transmission rank number (the number of transmission layers) and the CWs.</p><p id="p0110" num="0110">Then, DMRS generating section 110 generates DMRSs using the spreading codes (adjusted spreading codes) received from spreading code adjusting section 401 and outputs the generated DMRSs to precoding section 109. If the ACK/NACK information received from ACK/NACK demodulating section 102 shows a NACK (that is, if a retransmission is required), DMRS generating section 110 uses the same spreading codes used in the first transmission (adjusted spreading codes) without change.</p><p id="p0111" num="0111">Next, a spreading code adjusting process performed by spreading code adjusting section 401 will be described in detail.</p><p id="p0112" num="0112">Spreading code adjusting section 401 receives spreading code resources used for the DMRS for each layer (Layer 0 to 3), from DMRS generating section 110. To be more specific, as shown in the left half of <figref idrefs="f0009">Fig. 9</figref>, the spreading codes for Layer 0 (k = 0) are n<sub>CS,0</sub> = 0 and n<sub>OCC,0</sub> = 0, the spreading codes for Layer<!-- EPO <DP n="43"> --> 1 (k = 1) are n<sub>CS,1</sub> = 6 and n<sub>OCC,1</sub> = 0, the spreading codes for Layer 2 (k = 2) are n<sub>CS,2</sub> = 3 and n<sub>OCC,2</sub> = 1, and the spreading codes for Layer 3 (k = 3) are n<sub>CS,3</sub> = 9 and n<sub>OCC,3</sub> = 1.</p><p id="p0113" num="0113">As described above, in transmission using three layers, as the relationship between the layers and the CWs, CW0 is allocated to Layer 0 (k = 0), and CW1 is allocated to Layers 1 and 2 (k = 1, 2). Accordingly, as shown in the left half of <figref idrefs="f0009">Fig. 9</figref>, if the terminal uses the spreading code resources for the DMRSs indicated through the PDCCH (that is, the set values inputted to spreading code adjusting section 401) without change, different OCCs (n<sub>OCC,2</sub> = 0, 1) are applied to the two layers, Layers 1 and 2, to which CW1 is allocated, as in the case shown in <figref idrefs="f0003">Fig. 3</figref>. In other words, different OCCs are used in the DMRSs generated for the plurality of layers to which the same CW is allocated.</p><p id="p0114" num="0114">In view of this, spreading code adjusting section 401 adjusts the spreading code resource used in each layer for the respective number of transmission layers so that spreading code resources for the same OCC are used for the DMRSs generated for the plurality of layers to which the same CW is allocated.</p><p id="p0115" num="0115">To be more specific, as shown in the right half of <figref idrefs="f0009">Fig. 9</figref>, spreading code adjusting section 401 adjusts spreading code resources n<sub>CS,0</sub> = 0 and n<sub>OCC,0</sub> = 0 for k = 0, n<sub>CS,2</sub> = 3 and n<sub>OCC,2</sub> = 1 for k = 2, and n<sub>CS,3</sub> = 9 and n<sub>OCC,3</sub> = 1 for k = 3 as the spreading code resources used in transmission using three layers (three layers shown in <figref idrefs="f0009">Fig. 9</figref>). In other words, spreading code adjusting section 401 uses the spreading codes n<sub>CS,3</sub> = 9 and<!-- EPO <DP n="44"> --> n<sub>OCC,3</sub> = 1 for = 3 used in transmission using four layers, instead of the spreading codes n<sub>CS,1</sub> = 6 and n<sub>OCC,1</sub> = 0 for k = 1 that would otherwise be used in transmission using three layers.</p><p id="p0116" num="0116">As a result, as shown in the left half of <figref idrefs="f0010">Fig. 10</figref>, in the first transmission using three layers, DMRS generating section 110 generates a DMRS using n<sub>CS,0</sub> = 0 and n<sub>OCC,0</sub> = 0 for Layer 0 (k = 0) to which CW0 is allocated, and generates a DMRS using n<sub>CS,1</sub> = 3 and n<sub>OCC,1</sub> = 1, and n<sub>CS, 2</sub> = 9 and n<sub>OCC,2</sub> = 1 for Layers 1 and 2 to which CW1 is allocated, respectively.</p><p id="p0117" num="0117">In other words, spreading code resources for the same OCC (n<sub>OCC,k</sub> = 1) are used for the DMRSs generated for the two layers, Layers 1 and 2, to which CW1 is allocated.</p><p id="p0118" num="0118">In the case where the terminal (transmitting apparatus 400) detects no ACK for a CW transmitted therefrom, the terminal is to transmit retransmission data for the CW. In the retransmission, DMRS generating section 110 uses the spread code resources used for the DMRSs in the first transmission (that is, the adjusted spreading code resources shown in the right half of <figref idrefs="f0009">Fig. 9</figref>) without change. For example, in <figref idrefs="f0010">Fig. 10</figref>, in the case where retransmission of only CW1 occurs, DMRS generating section 110 uses the spreading code resources (n<sub>CS,1</sub> = 3 and n<sub>OCC,1</sub> = 1, and n<sub>CS,2</sub> = 9 and n<sub>OCC,2</sub> = 1) used in the first transmission for the DMRSs generated for the two layers, Layers 1 and 2, to which CW1 is allocated.</p><p id="p0119" num="0119">As a result, as shown in the right half of <figref idrefs="f0010">Fig. 10</figref>, even when only CW1 allocated to a plurality of layers is to be<!-- EPO <DP n="45"> --> retransmitted, the spreading code resources having an OCC of 0 (n<sub>OCC,k</sub> = 0) and any cyclic shift sequence (n<sub>CS,k</sub> = 0 to 11), that is, the spreading code resources in the region enclosed by the dashed line, are available as spreading code resources that can be allocated to another terminal (a new user) that can be multiplexed in the same resource.</p><p id="p0120" num="0120">On the other hand, on the side of the base station (receiving apparatus 200 (<figref idrefs="f0005">Fig. 5</figref>)), scheduling section 212 has the same function (not shown) as that of spreading code adjusting section 401 of the terminal and outputs the adjusted (reset) spreading code resources to channel estimating section 202 in the same manner as the terminal (transmitting apparatus 400). Furthermore, from among a plurality of spreading code resources, scheduling section 212 allocates, to the DMRSs transmitted by another terminal (a new user) different from the terminal instructed to retransmit only the CW allocated to the plurality of layers, spreading code resources having different OCCs than the OCC used by the terminal that performs the retransmission (the same OCC for a plurality of layers). As a result, an appropriate resource is allocated to each terminal even in the case where the multiuser MIMO is applied.</p><p id="p0121" num="0121">Therefore, for example, in <figref idrefs="f0010">Fig. 10</figref>, even in the case where the scheduler is to multiplex an LTE terminal (a new user) that is only capable of an multiuser MIMO operation using an OCC of 0 (n<sub>OCC,k</sub> = 0), a sufficient amount of resources can be provided for the LTE terminal.<!-- EPO <DP n="46"> --></p><p id="p0122" num="0122">As described above, according to the present embodiment, in preparation for occurrence of retransmission, the terminal (transmitting apparatus 400) uses, in the first transmission, spreading code resources having the same OCC from among a plurality of spreading codes for DMRSs generated for a plurality of layers to which the same CW, which is a unit of retransmission, is allocated. As a result, a shortage of spreading code resources in retransmission can be prevented. In other words, even in the case where non-adaptive HARQ control is applied using the PHICH (even in the case where the spreading codes for the DMRS cannot be reported through the PHICH), it is possible to avoid restrictions on allocation of resources to a new user by the scheduler that would otherwise be imposed due to the use, for retransmission, of spreading code resources for different OCCs.</p><p id="p0123" num="0123">Therefore, according to the present embodiment, as in Embodiment 1, the scheduler can perform spreading code allocation by avoiding restrictions on allocation of resources to a new user even in the case where non-adaptive HARQ control is applied using the PHICH.</p><p id="p0124" num="0124">Embodiments of the present invention have been described above.</p><p id="p0125" num="0125">Although the present invention has been described above with embodiments using antennas, the present invention is equally applicable to antenna ports.</p><p id="p0126" num="0126">An antenna port refers to a theoretical antenna<!-- EPO <DP n="47"> --> comprised of one or a plurality of physical antennas. In other words, "antenna port" does not necessarily refer to one physical antenna, but may refer to an array antenna and so forth composed of a plurality of antennas.</p><p id="p0127" num="0127">For example, 3 GPP LTE does not define how many physical antennas an antenna port is formed with, but defines that an antenna port is the minimum unit for transmitting different reference signals in a base station.</p><p id="p0128" num="0128">In addition, an antenna port may be defined as a minimum unit for multiplying a precoding vector as weighting.</p><p id="p0129" num="0129">Although an example of the present invention configured as hardware has been described in the present embodiments, the present invention may also implement software in collaboration with hardware.</p><p id="p0130" num="0130">Furthermore, each function block employed in the above descriptions of embodiments may typically be implemented as an LSI constituted by an integrated circuit. These may be implemented individually as single chips, or a single chip may incorporate some or all of the function blocks. "LSI" is adopted here but this may also be referred to as "IC," "system LSI," "super LSI," or "ultra LSI" depending on differing extents of integration.</p><p id="p0131" num="0131">Further, the method of circuit integration is not limited to LSI's, and implementation using dedicated circuitry or general purpose processors is also possible. After LSI production, utilization of an FPGA (Field Programmable Gate Array) or a<!-- EPO <DP n="48"> --> reconfigurable processor where connections and settings of circuit cells in an LSI can be reconfigured may also be possible.</p><p id="p0132" num="0132">In the event of the introduction of a circuit implementation technology whereby LSI is replaced by a different technology, which is advanced in or derived from semiconductor technology, integration of the function blocks may of course be performed using technology therefrom. An application to biotechnology and/or the like is also possible.</p><p id="p0133" num="0133">The disclosure of Japanese patent application No. <patcit id="pcit0001" dnum="JP2010181344A"><text>2010-181344, filed on August 13, 2010</text></patcit>, including the specifications, drawings and abstracts, is incorporated herein by reference in its entirety.</p><heading id="h0015">Industrial Applicability</heading><p id="p0134" num="0134">A terminal apparatus, a base station apparatus, a retransmission method, and a resource allocation method according to the present invention are suitable for performing a method of controlling retransmission using non-adaptive HARQ in a radio communication system using a MIMO communication technique.</p><heading id="h0016">Reference Signs List</heading><p id="p0135" num="0135"><dl id="dl0001"><dt>100, 300, 400</dt><dd>Transmitting apparatus</dd><dt>101</dt><dd>PDCCH demodulating section</dd><dt>102</dt><dd>ACK/NACK demodulating section<!-- EPO <DP n="49"> --></dd><dt>103</dt><dd>Code word generating section</dd><dt>104</dt><dd>Coding section</dd><dt>105</dt><dd>Rate matching section</dd><dt>106</dt><dd>Interleaving/scrambling section</dd><dt>107</dt><dd>Modulating section</dd><dt>108</dt><dd>Layer mapping section</dd><dt>109</dt><dd>Precoding section</dd><dt>110</dt><dd>DMRS generating section</dd><dt>111, 302</dt><dd>Retransmission spreading code storage section</dd><dt>112</dt><dd>SRS generating section</dd><dt>113</dt><dd>SC-FDMA signal generating section</dd><dt>200</dt><dd>Receiving apparatus</dd><dt>201</dt><dd>Receiving RF section</dd><dt>202</dt><dd>Channel estimating section</dd><dt>203</dt><dd>Spatial demultiplexing synchronization detecting section</dd><dt>204</dt><dd>Layer demapping section</dd><dt>205</dt><dd>Error detecting section</dd><dt>206</dt><dd>Likelihood generating section</dd><dt>207</dt><dd>Retransmission combining section</dd><dt>208</dt><dd>Decoding section</dd><dt>209</dt><dd>CRC detecting section</dd><dt>210</dt><dd>PHICH generating section</dd><dt>211</dt><dd>PDCCH generating section</dd><dt>212</dt><dd>Scheduling section</dd><dt>301</dt><dd>Retransmission number counting section</dd><dt>401</dt><dd>Spreading code adjusting section</dd></dl></p></description><claims mxw-id="PCLM56976222" lang="EN" load-source="patent-office"><!-- EPO <DP n="50"> --><claim id="c-en-0001" num="0001"><claim-text>A terminal apparatus comprising:
<claim-text>a layer mapping section configured to map each of a plurality of codewords to one or a plurality of layers, at least one of the plurality of codewords is mapped to the plurality of layers;</claim-text>
<claim-text>a transmitting section configured to transmit the mapped plurality of codewords;</claim-text>
<claim-text>a receiving section configured to receive ACK/NACK information indicating an error detection result of respective one of the transmitted plurality of codewords; and</claim-text>
<claim-text>a reference signal generating section configured to generate, for each of the one or a plurality of layers, a demodulation reference signal using a cyclic shift value among a plurality of cyclic shift values and an orthogonal sequence among a plurality of orthogonal sequences, a plurality of combinations being prepared for a combination of an index specifying the cyclic shift value and the orthogonal sequence, and wherein when the received ACK/NACK information denotes a retransmission request of one codeword that is mapped to the plurality of layers, a common orthogonal sequence is used to generate the demodulation reference signal among the plurality of layers;</claim-text>
<claim-text>wherein the transmitting section transmits the generated demodulation reference signal.</claim-text><!-- EPO <DP n="51"> --></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The terminal apparatus according to claim 1, wherein<br/>
a number of layers used to retransmit the one codeword of which a retransmission is requested is smaller than a total number of layers used to transmit the plurality of codewords.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The terminal apparatus according to claim 1 or 2, wherein<br/>
the ACK/NACK information is transmitted using a HARQ reporting channel (PHICH).</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The terminal apparatus according to one of claims 1 to 3, wherein<br/>
the plurality of codewords includes a first codeword and a second codeword;<br/>
the first codeword is mapped to a first layer and the second codeword is mapped to a second layer and a third layer; and<br/>
the ACK/NACK information indicates that an error was not detected for the first codeword and that an error was detected for the second codeword.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The terminal apparatus according to one of claims 1 to 4,<br/>
wherein<br/>
when retransmission of the one codeword is performed a plurality of times, the reference signal generating section changes the common orthogonal sequence each time the<!-- EPO <DP n="52"> --> retransmission is performed.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The terminal apparatus according to one of claims 1 to 5, wherein<br/>
the reference signal generating section sets the common orthogonal sequence such that a different orthogonal sequence is set between an odd number retransmission and an even number retransmission of the one codeword.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>A communication method comprising:
<claim-text>mapping each of a plurality of codewords to one or a plurality of layers, at least one of the plurality of codewords is mapped to the plurality of layers;</claim-text>
<claim-text>transmitting the mapped plurality of codewords;</claim-text>
<claim-text>receiving ACK/NACK information indicating an error detection result of respective one of the transmitted plurality of codewords;</claim-text>
<claim-text>generating, for each of the one or a plurality of layers, a demodulation reference signal using a cyclic shift value among a plurality of cyclic shift values and an orthogonal sequence among a plurality of orthogonal sequences, a plurality of combinations being prepared for a combination of an index specifying the cyclic shift value and the orthogonal sequence, and wherein when the received ACK/NACK information denotes a retransmission request of one codeword that is mapped to the plurality of layers, a common orthogonal sequence is used to<!-- EPO <DP n="53"> --> generate the demodulation reference signal among the plurality of layers; and</claim-text>
<claim-text>transmitting the generated demodulation reference signal.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The communication method according to claim 7, wherein<br/>
a number of layers used to retransmit the one codeword of which a retransmission is requested is smaller than a total number of layers used to transmit the plurality of codewords.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The communication method according to claim 7 or 8, wherein<br/>
the ACK/NACK information is transmitted using a HARQ reporting channel (PHICH).</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The communication method according to one of claims 7 to 9, wherein<br/>
the plurality of codewords includes a first codeword and a second codeword;<br/>
the first codeword is mapped to a first layer and the second codeword is mapped to a second layer and a third layer; and<br/>
the ACK/NACK information indicates that an error was not detected for the first codeword and that an error was detected for the second codeword.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The communication method according to one of claims 7<!-- EPO <DP n="54"> --> to 10, wherein<br/>
when retransmission of the one codeword is performed a plurality of times, the common orthogonal sequence is changed each time the retransmission is performed.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The communication method according to one of claims 7 to 11, wherein<br/>
the common orthogonal sequence is set such that a different orthogonal sequence is set between an odd number retransmission and an even number retransmission of the one codeword.</claim-text></claim></claims><drawings mxw-id="PDW16667004" load-source="patent-office"><!-- EPO <DP n="55"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="146" he="199" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="56"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="108" he="162" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="57"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="156" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="58"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="136" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="59"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="136" he="224" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="60"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="146" he="215" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="61"> --><figure id="f0007" num="7"><img id="if0007" file="imgf0007.tif" wi="146" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="62"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="146" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="63"> --><figure id="f0009" num="9"><img id="if0009" file="imgf0009.tif" wi="146" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="64"> --><figure id="f0010" num="10"><img id="if0010" file="imgf0010.tif" wi="146" he="222" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
