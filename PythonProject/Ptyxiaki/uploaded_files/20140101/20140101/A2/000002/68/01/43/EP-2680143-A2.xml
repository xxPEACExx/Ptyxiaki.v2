<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680143-A2" country="EP" doc-number="2680143" kind="A2" date="20140101" family-id="48747926" file-reference-id="271873" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549487" ucid="EP-2680143-A2"><document-id><country>EP</country><doc-number>2680143</doc-number><kind>A2</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13173627-A" is-representative="YES"><document-id mxw-id="PAPP154823410" load-source="docdb" format="epo"><country>EP</country><doc-number>13173627</doc-number><kind>A</kind><date>20130625</date><lang>EN</lang></document-id><document-id mxw-id="PAPP204735588" load-source="docdb" format="original"><country>EP</country><doc-number>13173627.4</doc-number><date>20130625</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140445475" ucid="US-201213537526-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201213537526</doc-number><kind>A</kind><date>20120629</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1944039523" load-source="ipcr">G06F   9/455       20060101ALN20160425BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1944042294" load-source="ipcr">G06F   9/50        20060101ALI20160425BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1944043882" load-source="ipcr">G06F   9/48        20060101AFI20160425BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2079669498" load-source="docdb" scheme="CPC">G06F   9/4856      20130101 FI20150401BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2079671756" load-source="docdb" scheme="CPC">G06F   9/5077      20130101 LI20150401BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180945" lang="DE" load-source="patent-office">Migration virtueller Maschinen zwischen Rechnergeräten</invention-title><invention-title mxw-id="PT132180946" lang="EN" load-source="patent-office">Migrating Virtual Machines Between Computing Devices</invention-title><invention-title mxw-id="PT132180947" lang="FR" load-source="patent-office">Migration de machines virtuelles entre des dispositifs de calcul</invention-title><citations><non-patent-citations><nplcit><text>C. PERKINS: "IP Mobility Support for IPv4", RFC 3344, August 2002 (2002-08-01)</text><sources><source mxw-id="PNPL60225289" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>C. PERKINS: "IP Mobility Support for IPv4, Revised", RFC 5944, November 2010 (2010-11-01)</text><sources><source mxw-id="PNPL60225290" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>S. DEERING: "ICMP Router Discovery Messages", RFC 1256, September 1991 (1991-09-01)</text><sources><source mxw-id="PNPL60225291" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918153735" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>JUNIPER NETWORKS INC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR918147560" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>JUNIPER NETWORKS, INC.</last-name></addressbook></applicant><applicant mxw-id="PPAR918985877" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Juniper Networks, Inc.</last-name><iid>100153534</iid><address><street>1194 North Mathilda Avenue</street><city>Sunnyvale, CA 94089-1206</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918166803" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>BOSCH HENDRIKUS G P</last-name><address><country>NL</country></address></addressbook></inventor><inventor mxw-id="PPAR918151947" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>Bosch, Hendrikus G.P</last-name></addressbook></inventor><inventor mxw-id="PPAR918985252" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Bosch, Hendrikus G.P</last-name><address><street>Distelvlinderstraat 4</street><city>1432 Aalsmeer</city><country>NL</country></address></addressbook></inventor><inventor mxw-id="PPAR918162467" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>MEDVED JAN</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918152378" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>MEDVED, JAN</last-name></addressbook></inventor><inventor mxw-id="PPAR918985829" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>MEDVED, JAN</last-name><address><street>7687 Glenbrook Ct.</street><city>Pleasanton, CA California 94588</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918981853" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Moulin, Bénédicte</last-name><iid>101353598</iid><address><street>D Young &amp; Co LLP 120 Holborn</street><city>London EC1N 2DY</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548805271" load-source="docdb">AL</country><country mxw-id="DS548864995" load-source="docdb">AT</country><country mxw-id="DS548805273" load-source="docdb">BE</country><country mxw-id="DS548871339" load-source="docdb">BG</country><country mxw-id="DS548896623" load-source="docdb">CH</country><country mxw-id="DS548842940" load-source="docdb">CY</country><country mxw-id="DS548864996" load-source="docdb">CZ</country><country mxw-id="DS548805274" load-source="docdb">DE</country><country mxw-id="DS548842941" load-source="docdb">DK</country><country mxw-id="DS548842942" load-source="docdb">EE</country><country mxw-id="DS548884056" load-source="docdb">ES</country><country mxw-id="DS548871340" load-source="docdb">FI</country><country mxw-id="DS548871341" load-source="docdb">FR</country><country mxw-id="DS548805275" load-source="docdb">GB</country><country mxw-id="DS548842943" load-source="docdb">GR</country><country mxw-id="DS548805276" load-source="docdb">HR</country><country mxw-id="DS548864997" load-source="docdb">HU</country><country mxw-id="DS548896624" load-source="docdb">IE</country><country mxw-id="DS548805277" load-source="docdb">IS</country><country mxw-id="DS548871342" load-source="docdb">IT</country><country mxw-id="DS548842944" load-source="docdb">LI</country><country mxw-id="DS548868724" load-source="docdb">LT</country><country mxw-id="DS548864998" load-source="docdb">LU</country><country mxw-id="DS548868725" load-source="docdb">LV</country><country mxw-id="DS548868726" load-source="docdb">MC</country><country mxw-id="DS548805946" load-source="docdb">MK</country><country mxw-id="DS548805947" load-source="docdb">MT</country><country mxw-id="DS548884057" load-source="docdb">NL</country><country mxw-id="DS548871343" load-source="docdb">NO</country><country mxw-id="DS548805948" load-source="docdb">PL</country><country mxw-id="DS548896625" load-source="docdb">PT</country><country mxw-id="DS548884058" load-source="docdb">RO</country><country mxw-id="DS548896634" load-source="docdb">RS</country><country mxw-id="DS548805949" load-source="docdb">SE</country><country mxw-id="DS548896635" load-source="docdb">SI</country><country mxw-id="DS548871344" load-source="docdb">SK</country><country mxw-id="DS548805974" load-source="docdb">SM</country><country mxw-id="DS548842945" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128670156" lang="EN" load-source="patent-office"><p id="pa01" num="0001">In one example, a system includes a first computing device configured to execute a virtual machine, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters, stop execution of the virtual machine, and create checkpoint data for the virtual machine, and a second computing device configured to execute the virtual machine, using at least some of the checkpoint data, and to cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters. The system may further include a first provider edge (PE) routing device communicatively coupled to the first computing device via the first attachment circuit, and a second PE routing device communicatively coupled to the second computing device via the second attachment circuit.
<img id="iaf01" file="imgaf001.tif" wi="78" he="104" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499529" lang="EN" source="EPO" load-source="docdb"><p>In one example, a system includes a first computing device configured to execute a virtual machine, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters, stop execution of the virtual machine, and create checkpoint data for the virtual machine, and a second computing device configured to execute the virtual machine, using at least some of the checkpoint data, and to cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters. The system may further include a first provider edge (PE) routing device communicatively coupled to the first computing device via the first attachment circuit, and a second PE routing device communicatively coupled to the second computing device via the second attachment circuit.</p></abstract><description mxw-id="PDES63955586" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">This disclosure relates to computer networks and, more particularly, to management of network devices within computer networks.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">A data center is a specialized facility that houses web sites, provides data serving and backup, and/or other network-based services for subscribers. For example, data centers are often used to provide software as a service (SaaS), platform as a service (PaaS), and/or infrastructure as a service (IaaS), which are generally referred to as cloud computing services. A relatively simple form of data center generally includes a single facility that hosts infrastructure equipment, such as networking and storage systems, redundant power supplies, and environmental controls. Cloud services may be provided by multiple geographically dispersed data centers.</p><p id="p0003" num="0003">Computing devices of data centers provide various services to client devices. Typically, these computing devices are configured to execute a hypervisor, which executes various operating systems (typically referred to as "guest operating systems,") and one or more applications execute over each of the guest operating systems. These applications include applications for providing services to client devices, such as data storage and retrieval services. Collectively, one guest operating system and the applications executing over that guest operating system are referred to as a "virtual machine." Thus, the hypervisor of a computing device may execute a plurality of virtual machines. Moreover, a data center may include one or more computing devices, each executing a plurality of virtual machines.</p><p id="p0004" num="0004">In some cases, virtual machines hosted on computing devices of separate data centers may be communicatively coupled, e.g., via a virtual private network (VPN). In this manner, client devices can connect to the VPN and access any of the virtual machines connected to the VPN. Thus, data stored to the VPN may in fact be stored in separate hardware devices at disparate physical locations, e.g., within separate data centers.</p><p id="p0005" num="0005">Administrators of the data centers may wish to move virtual machines from one data center to another. For example, administrators may move a computing device hosting the virtual machines to perform maintenance on the computing device. As another example, administrators may move a virtual machine to a computing device that is closest to client devices that use services provided by the virtual machine most often. Typically, moving a virtual machine from one data center or another, or from one computing device to another, requires saving a state of an operating system of the virtual machine, then restarting the virtual machine from the saved state on the destination computing device.<!-- EPO <DP n="2"> --></p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0006" num="0006">In general, this disclosure describes techniques for migrating virtual machines between computing devices. In some cases, a saved state of a virtual machine may not include sufficient information for the virtual machine to become active on a destination computing device. For example, a network stack of a guest operating system of the virtual machine may need to be rebuilt, e.g., when the destination computing device has a different attachment circuit for attaching to a virtual private network than an original computing device from which the virtual machine was moved. Accordingly, this disclosure provides techniques for rebuilding a network stack of a guest operating system after the virtual machine has been moved.</p><p id="p0007" num="0007">In one example, a method includes, after execution of a virtual machine by a first computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the first computing device, receiving, by a second computing device, checkpoint data for the virtual machine, executing, by the second computing device, the virtual machine using at least some of the checkpoint data, and causing the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</p><p id="p0008" num="0008">In another example, a device includes a network interface and a control unit configured to execute a virtual machine using at least some checkpoint data for the virtual machine, after execution of the virtual machine by a separate computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the separate computing device, wherein the control unit is configured to execute the virtual machine and to cause the virtual machine to become communicatively coupled, using the network interface, to the VPN via a second attachment circuit having a second set of network parameters different from the first set of network parameters.</p><p id="p0009" num="0009">In another example, a first computing device configured to execute a virtual machine, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters, to stop execution of the virtual machine, and to create checkpoint data for the virtual machine, and a second computing device configured to execute the virtual machine using at least some of the checkpoint data, and to cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters. The system may further include a first provider edge (PE) routing device communicatively coupled to the first computing device via the first attachment circuit, and a second PE routing device communicatively coupled to the second computing device via the second attachment circuit. Moreover, the system may include a network management system configured to cause the virtual machine to migrate from the first computing device to the second<!-- EPO <DP n="3"> --> computing device and to send a message to the second PE routing device indicating that the virtual machine has migrated to the second computing device.</p><p id="p0010" num="0010">In another example, a computer-readable medium, such as a computer-readable storage medium, contains, e.g., is encoded with, instructions that cause a processor of a computing device to, after execution of a virtual machine by a separate computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the separate computing device, receive checkpoint data for the virtual machine, execute the virtual machine using at least some of the checkpoint data, and cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</p><p id="p0011" num="0011">In another example, a method includes determining, by a provider edge (PE) routing device, that a virtual machine has migrated from a first computing device to a second computing device, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the first computing device, and wherein the PE routing device is communicatively coupled to the second computing device, and in response to determining that the virtual machine has migrated to the second computing device, sending an Internet control message protocol (ICMP) router advertisement message to the second computing device including a second set of network parameters for causing the virtual machine to become communicatively coupled to the VPN via a second attachment circuit, wherein the second set of network parameters are different from the first set of network parameters, and wherein the second attachment circuit couples the virtual machine to the PE routing device.</p><p id="p0012" num="0012">The details of one or more examples are set forth in the accompanying drawings and the description below. Other features, objects, and advantages will be apparent from the description and drawings, and from the claims.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0013" num="0013"><figref idrefs="f0001">FIG. 1</figref> is a block diagram illustrating an example system in which virtual machines (VMs) can be moved between data centers in accordance with the techniques of this disclosure.</p><p id="p0014" num="0014"><figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating an example set of devices included in a data center.</p><p id="p0015" num="0015"><figref idrefs="f0003">FIG. 3</figref> is a block diagram illustrating an example set of components of a computing device.</p><p id="p0016" num="0016"><figref idrefs="f0004">FIG. 4</figref> is a flowchart illustrating an example method for migrating a virtual machine between computing devices that are communicatively coupled to a virtual private network (VPN) using different types of attachment circuits.<!-- EPO <DP n="4"> --></p><heading id="h0005"><b>DETAILED DESCRIPTION</b></heading><p id="p0017" num="0017"><figref idrefs="f0001">FIG. 1</figref> is a block diagram illustrating an example system 100 in which virtual machines (VMs) can be moved between data centers in accordance with the techniques of this disclosure. System 100 includes client devices 102A-102M (client devices 102), network management system 116 (NMS 116), provider edge (PE) routing devices 106A - 106N, and data centers 108A-108N (data centers 108). Devices of data centers 108 are communicatively coupled to respective PE routing devices 106 via connections 112A-112N (connections 112). Client devices 102 and PE routing devices 106 are also communicatively coupled via network 104, which may represent the Internet.</p><p id="p0018" num="0018">In addition, any or all of data centers 108 may form a virtual network at Layer 2 of the open systems interconnection (OSI) model of computer networks. For example, any or all of data centers 108 may form an Internet protocol virtual private network (IP VPN). As shown in the example of <figref idrefs="f0001">FIG. 1</figref>, data center 108A and data center 108N are connected to a common VPN 118. VPN 118 may correspond to an IP VPN in accordance with E. Rosen &amp; Y. Rekhter, "BGP/MPLS IP Virtual Private Networks (VPNs)," RFC 4364, Feb. 2006, which is hereby incorporated by reference in its entirety. PE routing devices 106 maintain virtual routing and forwarding (VRF) tables for each VPN. In this manner, PE routing devices 106 isolate routing and forwarding information of a VPN from other VPNs and from general network traffic. Client devices 102 may also connect to a VPN via network 104. Accordingly, network 104 may include network devices, such as routing devices, that also maintain VRFs for the various VPNs.</p><p id="p0019" num="0019">Data centers 108 represent a collection of devices, such as computing devices, interconnected by a Layer 2 switch. An example of such devices is shown in <figref idrefs="f0002">FIG. 2</figref>, as described in greater detail below. Computing devices of data centers 108 execute respective sets of VMs 110A-110N (VMs 110). VMs 110 generally execute applications for providing services to client devices 102. For example, VMs 110 allow client devices 102 to store and retrieve data to and from storage devices (not shown) of data center 108.</p><p id="p0020" num="0020">In general, each of VMs 110 includes an operating system (OS) that provides an application space in which one or more applications execute for providing services to client devices 102. The OSes of VMs 110 are executed by hypervisors of computing devices of data centers 108. Thus, computing devices of data centers 108 may execute a respective operating system, which in turn provides an application space in which the hypervisor executes, and which in turn executes OSes of respective VMs 110. Accordingly, the OSes of VMs 110 may be referred to as "guest OSes," in that these guest OSes are not the operating system of the computing device but provide an interface between resources of the underlying hypervisor and applications executing in application spaces of the guest OSes.</p><p id="p0021" num="0021">Connections 112 in some cases also represent attachment circuits, e.g., to VPN 118 or another VPN. Different types of attachment circuits for connecting to an IP VPN may be used. For example, connection 112A may represent a virtual local area network (VLAN), whereas connection 112N may represent a generic routing encapsulation (GRE) tunnel. Another example<!-- EPO <DP n="5"> --> of an attachment circuit is an IP Security (IPSec) tunnel. Alternatively, two or more of the same type of attachment circuits for connecting to an IP VPN may be used, but may differ in that the attachment circuits may have different network parameters. For example, two different VLANs may have different VLAN tags, while two different GREs may have different GRE session keys. In general, guest OSes, such as Linux, hosted on VMs 110 are attached to a Layer 2 VPN, such as VPN 118, via attachment circuits represented by connections 112.</p><p id="p0022" num="0022">Each of the OSes of VMs 110 maintains its own respective network stack. For example, each of the OSes of VMs 110 may maintain network session data for network sessions with one or more client devices 102 when providing services to client devices 102. VMs 110 are also assigned unique media access control (MAC) addresses and IP addresses, in order to be reachable via network 104. The network stacks include data specific to the respective attachment circuit used to connect to respective PE routing devices 106. Continuing the example above, VMs 110A may maintain data for a VLAN connection to PE routing device 106A via connection 112A, while VMs 110N may maintain data for a GRE tunnel connection to PE routing device 106N via connection 112N.</p><p id="p0023" num="0023">Network management system 116 generally enables a user, such as administrator 114, to maintain network devices, such as PE routing devices 106 and devices of data centers 108. In accordance with the techniques of this disclosure, administrator 114 may use NMS 116 to move VMs 110 between data centers 108. For example, administrator 114 may cause one of VMs 110A to move from data center 108A to data center 108N. This movement of a VM is also referred to in this disclosure as VM migration. In the example of <figref idrefs="f0001">FIG. 1</figref>, migrating one of VMs 110A from data center 108A to data center 108N would allow the migrated VM to remain connected to VPN 118. Administrator 114 may migrate a VM for various reasons, e.g., to perform maintenance on a computing device executing the VM or after determining that one of client devices 102 using services provided by the VM are spatially closer to data center 108N than 108A.</p><p id="p0024" num="0024">When administrator 114 uses NMS 116 to migrate one of VMs from a computing device of one of data centers 108 to another, NMS 116 provides a message indicating details for this VM migration to a PE routing device. For example, NMS 116 may provide an indication of a MAC address of the VM being migrated, an IP address of the VM being migrated, and an indication of the computing device of the one of data centers 108 to which the VM is being migrated. Specifically, NMS 116 provides this information to the one of PE routing devices 106 to which the destination computing device for the migrating VM is communicatively coupled. For example, when NMS 116 migrates one of VMs 110A to a computing device of data center 108N, NMS 116 provides this information to PE routing device 106N, which is communicatively coupled to the computing device of data center 108N via connection 112N.</p><p id="p0025" num="0025">PE routing device 106N may then, continuing the example above, update a VRF associated with VPN 118. Specifically, PE routing device 106N may ensure that an output interface associated with the destination computing device of data center 108N is also associated<!-- EPO <DP n="6"> --> with the MAC address and/or IP address of the migrated virtual machine. In this manner, when PE routing device 106N receives network traffic of VPN 118 destined for the MAC address and/or IP address of the migrated virtual machine, PE routing device 106N can determine to send the network traffic via the network interface connected to the destination computing device for the migrated virtual machine.</p><p id="p0026" num="0026">In this manner, administrator 114 represents an example of an external party who may decide to move a VM from one attachment point (e.g., computing device of a data center) to another, each of which are connected to the same IP VPN. In this example, administrator 114 may cause a VM to be relocated from one data center to another. By way of VM mobility at the time the VM migration commences, the guest operating system may be suspended and check pointed into a file. The file may then be copied across a network to a receiving VM and restarted at the destination. That is, a destination computing device of a different data center may restart the migrated VM at the check point.</p><p id="p0027" num="0027">One problem with conventional VM mobility procedures is that as a VM moves from one attachment circuit to another (e.g. VLAN A to VLAN B, GRE tunnel A to GRE tunnel B, or the like), the networking stack of the guest OS of the migrated VM may contain invalid parameters for the new attachment circuit, or an attachment circuit to the IP VPN may be completely non-existent. For instance, as a Linux/VM relocates between two VLANs, the Linux address resolution protocol (ARP) cache may contain Ethernet MAC addresses of the source VLAN that are non-addressable in the destination VLAN. Similarly, as a Linux VM relocates from a VLAN attachment circuit to a GRE attachment circuit (for example, as described in <nplcit id="ncit0001" npl-type="s"><text>P. Marques et al., "End-system Support for BGP-Signaled IP/VPNs," draft-marques-13vpn-end-system-00, Network Working Group, Internet Draft, Oct. 6, 2011, available at http://tools.ietf.org/html/draft-marques-13vpn-end-system-00</text></nplcit>, which is hereby incorporated by reference in its entirety), the GRE tunnel between the Linux IP stack and IP VPN's Virtual Routing and Forwarding (VRF) function needs to be established.</p><p id="p0028" num="0028">In <nplcit id="ncit0002" npl-type="s"><text>X. Xu, "Virtual Subnet: A Scalable Data Center Interconnection Solution," draft-xu-virtual-subnet-06, Network Working Group, Internet Draft, Aug. 27, 2011, available at http://tools.ietf.org/html/draft-xu-virtual-subnet-06</text></nplcit>, it is argued that the Linux/VM sends a gratuitous ARP when the VM arrives at the destination to the receiving Provider Edge (PE). However, the Linux/VM will do no such thing by itself. If networking stacks in migrated guest operating systems are not re-organized after mobility events, ongoing session layer connections, such as transmission control protocol (TCP) sessions, are disrupted or terminated.</p><p id="p0029" num="0029">As noted above, VMs 110A may maintain data specific to the attachment circuit represented by connection 112A. Moreover, the attachment circuit represented by connection 112N is not necessarily the same type of attachment circuit as the attachment circuit represented by connection 112A. Therefore, after migrating a VM from a computing device of data center 108A to a computing device of data center 108N, a network stack of the migrated VM may need to be rebuilt to accommodate a new type of attachment circuit. Whereas a conventional guest<!-- EPO <DP n="7"> --> operating system may continue exactly where it was suspended and not execute any mobility-specific functionality, this disclosure provides techniques for a guest OS to determine that it has been moved to a new attachment point (e.g., a new one of data centers 108), and in response, to connect to the attachment circuit (e.g., one of connections 112) to which the new attachment point is connected.</p><p id="p0030" num="0030">The problem of guest operating system mobility by way of VMs today has been previously addressed at Layer 2. By defining a large Ethernet across data centers, potentially connected together by way of a Layer 2 VPN, a networking solution has been formed that is effectively a single attachment circuit. Given that every Layer 2 Ethernet address is addressable from any point in this attachment circuit, a guest operating system's ARP cache does not get inconsistent when the VM relocates. A potential downside of this approach is that one needs to create potentially large Ethernets with associated spanning trees, potentially across multiple data centers. To keep the spanning tree consistent, a fair amount of signaling is required. Such VM mobility solutions using a single Layer 2 technology does not enable mixing attachment circuit types: for instance, one cannot move a VM and guest operating system from a VLAN attachment circuit to a GRE attachment circuit: it is difficult to see how to disconnect a Linux/VM from a VLAN and re-attach the VM by way of a GRE tunnel, IPSEC tunnel, or other Layer 2 attachment type. This disclosure provides techniques in which a VM can be migrated between attachment points having different types of attachment circuits.</p><p id="p0031" num="0031">In accordance with the techniques of this disclosure, administrator 114 may use NMS 116 to cause the PE routing device to which the computing device of the data center to which a VM is moved to send a router advertisement message to the computing device of the data center to which the VM is moved. The router advertisement message may correspond to an Internet control message protocol (ICMP) message in accordance with <nplcit id="ncit0003" npl-type="s"><text>S. Deering, "ICMP Router Discovery Messages," RFC 1256, Sept. 1991</text></nplcit>; <nplcit id="ncit0004" npl-type="s"><text>C. Perkins, "IP Mobility Support for IPv4," RFC 3344, Aug. 2002</text></nplcit>; or <nplcit id="ncit0005" npl-type="s"><text>C. Perkins, "IP Mobility Support for IPv4, Revised," RFC 5944, Nov. 2010</text></nplcit>, which are hereby incorporated by reference in their respective entireties. The router advertisement message includes all parameters necessary for the guest OS of the migrated VM to re-attach to VPN 118, including an indication of an attachment circuit and parameters to use to connect to the attachment circuit. NMS 116 may send the ICMP router advertisement message to the VM by sending the ICMP router advertisement message to the MAC address and/or IP address of the VM. The MAC address and IP address of the VM typically do not change after moving the VM from one of data centers 108 to another.</p><p id="p0032" num="0032">For example, if the attachment circuit is a VLAN, the parameters may include VLAN tags and instructions on how to update the address resolution protocol (ARP) cache of the guest operating system. As another example, if the attachment circuit is a GRE tunnel, the router advertisement may include parameters for the PE "home agent" address as per RFC3344, the protocol to use to establish the GRE attachment circuit (e.g. client Mobile IP, XMPP, etc.), potentially a new default gateway for the VM, and a GRE session key. The router advertisement<!-- EPO <DP n="8"> --> may additionally include instructions for a migrated relocated guest operating system to re-authenticate the attachment circuit to the IP VPN by way of IEEE 802.1x or other authentication protocols. The latter can be needed to establish a secure attachment circuit between guest operating system and IP VPN.</p><p id="p0033" num="0033">With respect to the example above, one of VMs 110A may be migrated to a computing device of data center 108N. Connection 112N may represent a GRE tunnel, while connection 112A may represent a VLAN. Accordingly, administrator 114 may use NMS 116 to cause PE routing device 106N to send the migrated VM, executing on a computing device of data center 108N, parameters for connecting to the GRE tunnel represented by connection 112N, as discussed above. After receiving these parameters, the OS of the migrated VM may rebuild its network stack to connect to the GRE tunnel, represented by connection 112N, to PE routing device 106N. Alternatively, if one of VMs 110N were to be migrated to a computing device of data center 108A, administrator 114 may use NMS 116 to cause PE routing device 106A to send the migrated VM parameters for connecting to the VLAN represented by connection 112A, as discussed above. After receiving these parameters, the OS of the migrated VM may rebuild its network stack to connect to the VLAN, represented by connection 112A, to PE routing device 106A.</p><p id="p0034" num="0034">In this manner, the techniques of this disclosure may extend a guest operating system of a VM with a mobility function (e.g., a software agent) whose task is to re-attach the guest operating system to the IP VPN after the VM has relocated to a new attachment point in the IP VPN. As a relocated guest operating system is installed in the destination computing device to restart the migrated VM, the PE to which the VM is (or will be) connected submits a router advertisement ICMP message, akin to client Mobile IP mobility events, to the relocated guest operating system and VM, as discussed above.</p><p id="p0035" num="0035">Thus, the techniques of this disclosure allow a VM to be relocated between computing devices of different data centers connected to an IP VPN via different types of attachment circuits. One potential advantage of extending a guest operating system with a mobility agent is that this allows a migrated guest operating system of a VM to re-establish an attachment circuit after the VM has been migrated. Because networking stack internal parameters may become inconsistent after such a move, a mobility agent can be used to patch up the parameters for connecting to the PE via the attachment circuit.</p><p id="p0036" num="0036">The PE hosting the migrated VM may solicit the ICMP router advertisement via any medium by which the VM and guest operating system are capable of receiving datagrams. For example, the PE may solicit the ICMP router advertisement to the VM and guest operating system by sending a unicast message to the IP address and MAC address associated with the migrated VM.</p><p id="p0037" num="0037">System 100 of <figref idrefs="f0001">FIG. 1</figref> represents an example of a system including a first computing device configured to execute a virtual machine, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of<!-- EPO <DP n="9"> --> network parameters, to stop execution of the virtual machine, and to create checkpoint data for the virtual machine, and a second computing device configured to execute the virtual machine using at least some of the checkpoint data, and to cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</p><p id="p0038" num="0038"><figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating an example set of devices included in data center 120. Data centers 108 of <figref idrefs="f0001">FIG. 1</figref> may each include components similar to those of data center 120 of <figref idrefs="f0002">FIG. 2</figref>. In the example of <figref idrefs="f0002">FIG. 2</figref>, data center 120 includes switch 122, computing devices 124A-124N (computing devices 124), and data stores 128A-128N (data stores 128). Each of computing devices 124 executes a respective set of VMs 126A-126N (VMs 126). For example, each of computing devices 124 may execute a respective hypervisor, which allows computing devices 124 to execute a plurality of virtual machines, each including its own operating system (referred to herein as a "guest" operating system) and application space in which one or more applications execute over the guest operating system.</p><p id="p0039" num="0039">Computing devices 124 are also coupled to respective data stores 128. In various examples, each of data stores 128 may include one or a plurality of physical storage units, e.g., hard drives, flash drives, or other storage media. Moreover, in some examples, one or more of data stores 128 may be connected to a plurality of computing devices 124. In general, computing devices 124 maintain data stored in respective data stores 128. For example, VMs 126 executed by computing devices 124 may provide services for accessing (retrieving data from and/or storing data to) respective data stores 128.</p><p id="p0040" num="0040">Computing devices 124 are interconnected (that is, communicatively coupled) via switch 122. Switch 122 represents an example of a Layer 2 device for connecting a plurality of devices at Layer 2 of the OSI model. Switch 122 may execute a Layer 2 protocol, such as Ethernet, to achieve this interconnection. In this manner, computing devices 124 and switch 122 may form a physical Layer 2 network. Thus, computing devices 124 may access resources, such as data of data stores 128, managed by other computing devices 124 by communicating via switch 122. For example, computing device 124N may retrieve data of data store 128A by sending a request for the data to computing device 124A via switch 122.</p><p id="p0041" num="0041">In some examples, one or more of VMs 126 may form a virtual private network (VPN). Thus, rather than forming a physical Layer 2 network, these VMs may form a virtual private network (VPN). A PE router (not shown in <figref idrefs="f0002">FIG. 2</figref>) may maintain a VRF table associated with the VPN, and the VMs may be communicatively coupled to the VPN using a first type of attachment circuit, such as a VLAN, a GRE tunnel, an IPSec tunnel, or other type of attachment circuit. The VRF may include addresses for the VPN, and the PE router generally uses a network protocol associated with the attachment circuit to determine whether network data should be routed and forwarded according to the VRF or according to a general routing and forwarding table.<!-- EPO <DP n="10"> --></p><p id="p0042" num="0042">Moreover, one of VMs 126 may be migrated to a computing device of a separate data center, and/or one of computing devices 124 may be configured to begin executing a migrated virtual machine from a separate data center. Attachment circuits for migrated virtual machines may differ between computing devices of different data centers. For example, a source computing device may provide a VLAN attachment circuit to communicate with devices of a VPN, while a destination computing device may provide a GRE tunnel to communicate with devices of the VPN.</p><p id="p0043" num="0043">In accordance with the techniques of this disclosure, when one of computing devices 124 receives a migrated virtual machine, the one of computing devices 124 may also receive network parameters for the migrated virtual machine. The computing device may begin executing the migrated virtual machine and provide the network parameters to the migrated virtual machine to cause the migrated virtual machine to rebuild a network stack for an attachment circuit for the one of computing devices 124. In this manner, the migrated virtual machine can become reconnected to the VPN using a different type of attachment circuit.</p><p id="p0044" num="0044"><figref idrefs="f0003">FIG. 3</figref> is a block diagram illustrating an example set of components of computing device 130. Computing devices of various data centers, such as computing devices 124 of data center 120 (<figref idrefs="f0002">FIG. 2</figref>) and/or computing devices of data centers 108 (<figref idrefs="f0001">FIG. 1</figref>) may include components similar to those of computing device 130. In the example of <figref idrefs="f0003">FIG. 3</figref>, computing device 130 includes control unit 132, network interface 146, and storage interface 148.</p><p id="p0045" num="0045">Control unit 132 may include hardware, software, firmware, or a combination thereof for performing the techniques attributed to control unit 132. When including software or firmware, it should be understood that requisite hardware may also be provided, e.g., one or more processing units and/or a computer-readable medium, such as a hard disk, flash memory, optical media, magnetic media, read-only memory (ROM), or a combination thereof. The processing units may be hardware-based, in that the processing units may include one or more microprocessors, field programmable gate arrays (FPGAs), digital signal processors (DSPs), logic circuitry, or any combination thereof.</p><p id="p0046" num="0046">In the example of <figref idrefs="f0003">FIG. 3</figref>, control unit 132 includes hypervisor 140, network protocols 142, and storage management unit 144. Storage management unit 144 represents a unit for interacting with storage media via storage interface 148, e.g., for reading data from and/or writing data to a storage medium. Storage interface 148 may comprise, for example, a universal serial bus (USB), a serial ATA (SATA) interface, a Fibre Channel interface, a FireWire interface, or other interface for coupling computing device 130 to a storage medium. In some examples, data to be stored to a storage medium may be communicated via network interface 146, rather than storage interface 148. Storage interface 148 may include requisite hardware, such as a physical port to which a physical cable can be connected and, potentially, associated logic circuitry, for storing data to a computer-readable medium.</p><p id="p0047" num="0047">Network interface 146 allows computing device 130 to communicate over a network. Network interface 146 may support wired and/or wireless network communication. Network<!-- EPO <DP n="11"> --> interface 146 generally converts electrical and/or optical signals communicated across the network to or from data used by control unit 132. Network interface 146, accordingly, provides Layer 1, and in some cases, Layer 2, network functionality. For example, network interface 146 may correspond to a network interface card (NIC), a wireless adaptor for communicating according to an IEEE 802.11-series protocol, or the like.</p><p id="p0048" num="0048">Network protocols 142 represent protocols for communicating over a network at or above Layer 2 of the OSI model. For example, network protocols 142 may include instructions for establishing or maintaining an attachment circuit, such as a VLAN, a GRE tunnel, an IPSec tunnel, or the like. Control unit 132 may execute one or more network protocols 142 to receive and/or send data across a network, e.g., via network interface 146.</p><p id="p0049" num="0049">Hypervisor 140 represents an intermediate layer between resources of computing device 130 and virtual machines 138A-138N (virtual machines 138). Thus, virtual machines 138 access resources of computing device 130 via hypervisor 140. Likewise, hypervisor 140 receives input, such as network communications, for virtual machines 138 and provides the input to the appropriate one of virtual machines 138. Each of virtual machines 138 includes a respective one of operating systems (OSes) 136A-136N (OSes 136), which provide respective application spaces 134A-134N (application spaces 134). In this manner, virtual machines 138 may execute one or more applications in the corresponding application spaces 134. The applications may provide various services, such as data storage and/or manipulation services. Because OSes 136 are OSes for virtual machines 138 and not a host OS for computing device 130, OSes 136 may also be referred to as "guest OSes" or "guest operating systems."</p><p id="p0050" num="0050">In accordance with the techniques of this disclosure, OSes 136 may be communicatively coupled to a VPN via network interface 146. Moreover, computing device 130 represents an example of an attachment point for virtual machines 138 to connect to a VPN. Accordingly, virtual machines 138 may be communicatively coupled to a VPN using a particular type of attachment circuit, such as a VLAN, a GRE tunnel, an IPSec tunnel, or the like.</p><p id="p0051" num="0051">In some cases, a virtual machine may be migrated to computing device 130. That is, computing device 130 may receive checkpoint data for a virtual machine, as well as a set of instructions for the virtual machine, including an operating system and instructions for one or more applications to be executed in an application space provided by the operating system. Control unit 132 executes the instructions for the operating system and the applications, using the checkpoint data to resume execution from a previous state of the virtual machine, as executed by a separate computing device. During execution by the separate computing device, the virtual machine may have been connected to a VPN by a first type of attachment circuit. However, while executed by control unit 132 of computing device 130, the virtual machine may need to connect to the VPN using a different type of attachment circuit.</p><p id="p0052" num="0052">Thus, in accordance with the techniques of this disclosure, control unit 132 may receive an Internet control message protocol (ICMP) router advertisement message destined for the migrated virtual machine. Assume, for purposes of example, that the migrated virtual machine is<!-- EPO <DP n="12"> --> virtual machine 138N. In this example, control unit 132 of computing device 130 would receive the ICMP router advertisement via network interface 146. Hypervisor 140 would then determine a network address for which the ICMP router advertisement message is destined, e.g., a MAC address and/or an IP address, and determine which of virtual machines 138 corresponds to that MAC address and/or IP address. In this example, hypervisor 140 would determine that virtual machine 138N has a MAC address and/or IP address that matches the destination address(es) of the ICMP router advertisement message. Accordingly, hypervisor 140 would provide the ICMP router advertisement message to virtual machine 138N.</p><p id="p0053" num="0053">Moreover, in accordance with the techniques of this disclosure, each of virtual machines 138 executes an application (e.g., a software agent) tasked with re-attaching the corresponding one of OSes 136 to a VPN, in the event that one of virtual machines 138 is migrated to a different computing device. With respect to the example above, after virtual machine 138N receives the ICMP router advertisement message from hypervisor 140, OS 136N of virtual machine 138N provides the ICMP router advertisement message to this application. This application, in turn, extracts network parameters from the ICMP router advertisement message and uses the extracted network parameters to rebuild a network stack of OS 136N. For example, the application may connect to an existing attachment circuit to a PE routing device to which computing device 130 is communicatively coupled, or establish such an attachment circuit if one does not already exist.</p><p id="p0054" num="0054">The ICMP router advertisement message generally includes all parameters needed for OS 136N to re-attach to the IP VPN, and may include a list specifying one or more attachment circuits with the appropriate parameters. For a VLAN attachment circuit, the parameters may include VLAN tags and instructions how to update the ARP cache of OS 136N. If the new attachment circuit is a GRE tunnel, the ICMP router advertisement may include parameters for the PE "home agent" address, per RFC3344, the protocol to use to establish the GRE attachment circuit (e.g., client Mobile IP, XMPP, etc.), potentially a new default gateway for virtual machine 138N, and a GRE session key. The ICMP router advertisement may additionally include instructions for OS 136N to re-authenticate the attachment circuit to the IP VPN by way of IEEE 802.1x or other authentication protocols. The latter can be needed to establish a secure attachment circuit between OS 136N and an IP VPN. In this manner, using the network parameters specified in the ICMP router advertisement message, virtual machine 138N may rebuild a network stack of OS 136N and establish or re-establish an attachment circuit to a VPN, to which virtual machine 138N had been attached prior to being migrated to computing device 130.</p><p id="p0055" num="0055">In some examples, control unit 132 of computing device 130 receives instructions to migrate one of virtual machines 138 (e.g., virtual machine 138A) to a different computing device. In response to such instructions, control unit 132 stores checkpoint data for virtual machine 138A, in this example, where the checkpoint data represents a current state of OS 136A and applications executing in application space 134A. Control unit 132 may then send the<!-- EPO <DP n="13"> --> checkpoint data to a destination computing device to which virtual machine 138A is being migrated. In some cases, control unit 132 may also provide instructions for OS 136A and applications executing in application space 134A to the destination computing device. As discussed above, the attachment circuit for a VPN to which virtual machine 138A is communicatively coupled while being executed by control unit 132, for connecting to a VPN, may differ from an attachment circuit to which the destination computing device is communicatively coupled. Virtual machine 138A may use the techniques of this disclosure to re-attach to the VPN using a different type of attachment circuit while being executed by the destination computing device.</p><p id="p0056" num="0056">In this manner, computing device 130 represents an example of a computing device including a network interface and a control unit configured to execute a virtual machine using at least some checkpoint data for the virtual machine, after execution of the virtual machine by a separate computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the separate computing device. The control unit is configured to execute the virtual machine and to cause the virtual machine to become communicatively coupled, using the network interface, to the VPN via a second attachment circuit having a second set of network parameters different from the first set of network parameters.</p><p id="p0057" num="0057"><figref idrefs="f0004">FIG. 4</figref> is a flowchart illustrating an example method for migrating a virtual machine between computing devices that are communicatively coupled to a virtual private network (VPN) using different types of attachment circuits. The method of <figref idrefs="f0004">FIG. 4</figref> is described as being performed by a PE router, such as one of PE routing devices 106 (<figref idrefs="f0001">FIG. 1</figref>), and a virtual machine, such as one of VMs 110 (<figref idrefs="f0001">FIG. 1</figref>), VMs 126 (<figref idrefs="f0002">FIG. 2</figref>), or VMs 138 (<figref idrefs="f0003">FIG. 3</figref>). In general, it is assumed that the PE router represents a PE router that is communicatively coupled, via an attachment circuit, to a destination computing device for the migrated virtual machine.</p><p id="p0058" num="0058">For example, with respect to <figref idrefs="f0001">FIG. 1</figref>, assuming that a virtual machine is being migrated from a computing device of data center 108A to a computing device of data center 108N, the PE router may correspond to PE routing device 106N, and the attachment circuit may correspond to connection 112N. Furthermore, continuing the example above, connection 112N may represent an attachment circuit of a different type than the attachment circuit represented by connection 112A. Moreover, using this method, the virtual machine may reconnect to VPN 118 after resuming execution on the computing device of data center 108N after migrating from a computing device of data center 108A, and while executing on the computing device of data center 108A, the virtual machine may also have been communicatively coupled to VPN 118.</p><p id="p0059" num="0059">Initially, the PE router receives a message from a network management system (NMS), such as NMS 116 of <figref idrefs="f0001">FIG. 1</figref>, indicating that a virtual machine has migrated to a connected computing device (200). That is, the PE router receives a message indicating that a virtual machine has migrated to a computing device to which the PE router is communicatively coupled. The migrated virtual machine will either establish or attach to the attachment circuit between the<!-- EPO <DP n="14"> --> destination computing device (that is, the computing device to which the virtual machine has been migrated) and the PE router. The message from the NMS may indicate an IP address and/or a MAC address of the virtual machine, as well as an indication of the destination computing device.</p><p id="p0060" num="0060">Using this information from the NMS, the PE router may update a VRF associated with the VPN to indicate that traffic destined for the virtual machine is to be forwarded to the destination computing device. In this manner, the PE router may receive traffic of the VPN destined for the virtual machine, and use the VRF associated with the VPN to determine how to forward the traffic destined for the virtual machine.</p><p id="p0061" num="0061">Moreover, in response to receiving this indication from the NMS, the PE router constructs an ICMP router advertisement message including network parameters for connecting to the attachment circuit between the destination computing device and the PE router (202). As discussed above, the ICMP router advertisement message includes all parameters needed for a guest operating system of the migrated virtual machine to re-attach to the VPN. The PE router then sends the ICMP router advertisement message to the virtual machine (204). For example, the PE router may send the ICMP router advertisement message to the destination computing device, addressed to the MAC address and/or the IP address of the migrated virtual machine.</p><p id="p0062" num="0062">In this manner, the method of <figref idrefs="f0004">FIG. 4</figref> represents an example of a method including determining, by a provider edge (PE) routing device, that a virtual machine has migrated from a first computing device to a second computing device, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the first computing device, and wherein the PE routing device is communicatively coupled to the second computing device, and in response to determining that the virtual machine has migrated to the second computing device, sending an Internet control message protocol (ICMP) router advertisement message to the second computing device including a second set of network parameters for causing the virtual machine to become communicatively coupled to the VPN via a second attachment circuit, wherein the second set of network parameters are different from the first set of network parameters, and wherein the second attachment circuit couples the virtual machine to the PE routing device.</p><p id="p0063" num="0063">The destination computing device receives checkpoint data for the virtual machine, and resumes execution of the virtual machine from a state represented by the checkpoint data. Furthermore, the virtual machine subsequently receives the ICMP router advertisement message (206). In particular, the destination computing device receives the ICMP router advertisement message, and a hypervisor of the destination computing device directs the ICMP router advertisement message to the migrated virtual machine.</p><p id="p0064" num="0064">A guest operating system of the migrated virtual machine may then direct the ICMP router advertisement message to a particular application executing in an application space of the virtual machine, where the application includes mobility functionality whose task is to re-attach the guest operating system to the VPN. Accordingly, the application extracts the network<!-- EPO <DP n="15"> --> parameters from the ICMP router advertisement message (208) and rebuilds a network stack of the guest operating system using the network parameters (210). In this manner, the virtual machine becomes attached to the attachment circuit to the PE router, and may thereby reestablish a communicative connection to the VPN (212).</p><p id="p0065" num="0065">In this manner, the method of <figref idrefs="f0004">FIG. 4</figref> also represents an example of a method including, after execution of a virtual machine by a first computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the first computing device, receiving, by a second computing device, checkpoint data for the virtual machine, executing, by the second computing device, the virtual machine using at least some of the checkpoint data, and causing the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</p><p id="p0066" num="0066">The techniques of this disclosure may be implemented according to various examples. In one example, a computing device includes a network interface, and a control unit configured to execute a virtual machine using at least some checkpoint data for the virtual machine, after execution of the virtual machine by a separate computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the separate computing device, wherein the control unit is configured to execute the virtual machine and to cause the virtual machine to become communicatively coupled, using the network interface, to the VPN via a second attachment circuit having a second set of network parameters different from the first set of network parameters.</p><p id="p0067" num="0067">In another example, which may be implemented in addition to the example above, the control unit is configured to determine the second set of network parameters for the second attachment circuit, and construct a network stack for a guest operating system of the virtual machine based on the second set of network parameters.</p><p id="p0068" num="0068">In another example, which may be implemented in addition to any of the examples above, the first attachment circuit comprises a first type of attachment circuit, and wherein the second attachment circuit comprises a second type of attachment circuit different from the first type of attachment circuit.</p><p id="p0069" num="0069">In another example, which may be implemented in addition to any of the examples above, when the second attachment circuit comprises a virtual local area network (VLAN), the second set of network parameters comprise VLAN tags and instructions for updating an address resolution protocol (ARP) cache of the guest operating system.</p><p id="p0070" num="0070">In another example, which may be implemented in addition to any of the examples above, when the second attachment circuit comprises a generic routing encapsulation (GRE) tunnel, the second set of network parameters comprise a home agent address of a provider edge (PE) routing device for the GRE tunnel, a protocol for the GRE tunnel, and a GRE session key.<!-- EPO <DP n="16"> --></p><p id="p0071" num="0071">In another example, which may be implemented in addition to any of the examples above, the second set of network parameters further comprise data representative of a new default gateway for the virtual machine.</p><p id="p0072" num="0072">In another example, which may be implemented in addition to any of the examples above, the second set of network parameters further comprise instructions for causing the guest operating system to re-authenticate the second attachment circuit to the VPN using an authentication protocol.</p><p id="p0073" num="0073">In another example, which may be implemented in addition to any of the examples above, to determine the second set of network parameters, the control unit is configured to receive a message from a provider edge (PE) routing device to which the computing device is communicatively coupled, wherein the message includes data specifying the second set of network parameters.</p><p id="p0074" num="0074">In another example, which may be implemented in addition to any of the examples above, the message comprises an ICMP router advertisement message.</p><p id="p0075" num="0075">In another example, which may be implemented in addition to any of the examples above, the message further includes an indication of a type for the second attachment circuit.</p><p id="p0076" num="0076">In another example, which may be implemented in addition to any of the examples above, the virtual machine comprises one of a plurality of virtual machines, and wherein the control unit is further configured to execute a hypervisor that manages the plurality of virtual machines.</p><p id="p0077" num="0077">In another example, a computer-readable medium has stored thereon instructions that, when executed, cause a processor of a computing device to, after execution of a virtual machine by a separate computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the separate computing device, receive checkpoint data for the virtual machine, execute the virtual machine using at least some of the checkpoint data, and cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</p><p id="p0078" num="0078">In another example, which may be implemented in addition to the example above, the instructions that cause the processor to execute the virtual machine to cause the virtual machine to become communicatively coupled to the VPN via the second attachment circuit comprise instructions that cause the processor to determine the second set of network parameters for the second attachment circuit, and construct a network stack for a guest operating system of the virtual machine based on the second set of network parameters.</p><p id="p0079" num="0079">In another example, which may be implemented in addition to any of the examples above, the first attachment circuit comprises a first type of attachment circuit, and wherein the second attachment circuit comprises a second type of attachment circuit different from the first type of attachment circuit.<!-- EPO <DP n="17"> --></p><p id="p0080" num="0080">In another example, which may be implemented in addition to any of the examples above, when the second attachment circuit comprises a virtual local area network (VLAN), the second set of network parameters comprise VLAN tags and instructions for updating an address resolution protocol (ARP) cache of the guest operating system.</p><p id="p0081" num="0081">In another example, which may be implemented in addition to any of the examples above, when the second attachment circuit comprises a generic routing encapsulation (GRE) tunnel, the second set of network parameters comprise a home agent address of a provider edge (PE) routing device for the GRE tunnel, a protocol for the GRE tunnel, and a GRE session key.</p><p id="p0082" num="0082">In another example, which may be implemented in addition to any of the examples above, the second set of network parameters further comprise data representative of a new default gateway for the virtual machine.</p><p id="p0083" num="0083">In another example, which may be implemented in addition to any of the examples above, the second set of network parameters further comprise instructions for causing the guest operating system to re-authenticate the second attachment circuit to the VPN using an authentication protocol.</p><p id="p0084" num="0084">In another example, which may be implemented in addition to any of the examples above, the instructions that cause the processor to determine the second set of network parameters comprise instructions that cause the processor to receive a message from a provider edge (PE) routing device to which the second computing device is communicatively coupled, wherein the message includes data specifying the second set of network parameters.</p><p id="p0085" num="0085">In another example, which may be implemented in addition to any of the examples above, the instructions that cause the processor to receive the message comprise instructions that cause the processor to receive an ICMP router advertisement message.</p><p id="p0086" num="0086">In another example, which may be implemented in addition to any of the examples above, the message further includes an indication of the second attachment circuit.</p><p id="p0087" num="0087">In another example, a system includes a first computing device configured to execute a virtual machine, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters, to stop execution of the virtual machine, and to create checkpoint data for the virtual machine, and a second computing device configured to execute the virtual machine using at least some of the checkpoint data, and to cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</p><p id="p0088" num="0088">In another example, which may be implemented in addition to the example above, the system further includes a first provider edge (PE) routing device communicatively coupled to the first computing device via the first attachment circuit, and a second PE routing device communicatively coupled to the second computing device via the second attachment circuit.</p><p id="p0089" num="0089">In another example, which may be implemented in addition to any of the examples above, the first attachment circuit comprises a first type of attachment circuit, and wherein the<!-- EPO <DP n="18"> --> second attachment circuit comprises a second type of attachment circuit different from the first type of attachment circuit.</p><p id="p0090" num="0090">In another example, which may be implemented in addition to any of the examples above, the system further includes a network management system (NMS) configured to cause the virtual machine to migrate from the first computing device to the second computing device and to send a message to the second PE routing device indicating that the virtual machine has migrated to the second computing device, wherein the second PE routing device is configured to send a message to the second computing device, the message including the second set of network parameters for causing the virtual machine to become communicatively coupled to the VPN via the second attachment circuit.</p><p id="p0091" num="0091">In another example, which may be implemented in addition to any of the examples above, the message comprises an ICMP message.</p><p id="p0092" num="0092">In another example, which may be implemented in addition to any of the examples above, when the second attachment circuit comprises a virtual local area network (VLAN), the second set of network parameters comprise VLAN tags and instructions for updating an address resolution protocol (ARP) cache of the guest operating system.</p><p id="p0093" num="0093">In another example, which may be implemented in addition to any of the examples above, when the second attachment circuit comprises a generic routing encapsulation (GRE) tunnel, the second set of network parameters comprise a home agent address of the second PE routing device, a protocol for the GRE tunnel, and a GRE session key.</p><p id="p0094" num="0094">In another example, a method includes determining, by a provider edge (PE) routing device, that a virtual machine has migrated from a first computing device to a second computing device, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the first computing device, and wherein the PE routing device is communicatively coupled to the second computing device, and, in response to determining that the virtual machine has migrated to the second computing device, sending a message to the second computing device including a second set of network parameters for causing the virtual machine to become communicatively coupled to the VPN via a second attachment circuit, wherein the second set of network parameters are different from the first set of network parameters, and wherein the second attachment circuit couples the virtual machine to the PE routing device.</p><p id="p0095" num="0095">In another example, which may be implemented in addition to the example above, determining that the virtual machine has migrated comprises receiving information from a network management system (NMS) indicating that the virtual machine has migrated to the second computing device.</p><p id="p0096" num="0096">In another example, which may be implemented in addition to any of the examples above, the first attachment circuit comprises a first type of attachment circuit, and wherein the second attachment circuit comprises a second type of attachment circuit different from the first type of attachment circuit.<!-- EPO <DP n="19"> --></p><p id="p0097" num="0097">In another example, which may be implemented in addition to any of the examples above, determining the second set of network parameters comprises receiving a message from a provider edge (PE) routing device to which the second computing device is communicatively coupled, wherein the message includes data specifying the second set of network parameters based on configuration data of the PE routing device.</p><p id="p0098" num="0098">In another example, which may be implemented in addition to any of the examples above, to determine the second set of network parameters, the control unit is configured to receive a message from a provider edge (PE) routing device to which the computing device is communicatively coupled, wherein the message includes data specifying the second set of network parameters.</p><p id="p0099" num="0099">In another example, which may be implemented in addition to any of the examples above, the instructions that cause the processor to determine the second set of network parameters comprise instructions that cause the processor to receive a message from a provider edge (PE) routing device to which the second computing device is communicatively coupled, wherein the message includes data specifying the second set of network parameters.</p><p id="p0100" num="0100">In another example, which may be implemented in addition to any of the examples above, the message comprises an Internet control message protocol (ICMP) router advertisement message.</p><p id="p0101" num="0101">The techniques described in this disclosure may be implemented, at least in part, in hardware, software, firmware or any combination thereof. For example, various aspects of the described techniques may be implemented within one or more processors, including one or more microprocessors, digital signal processors (DSPs), application specific integrated circuits (ASICs), field programmable gate arrays (FPGAs), or any other equivalent integrated or discrete logic circuitry, as well as any combinations of such components. The term "processor" or "processing circuitry" may generally refer to any of the foregoing logic circuitry, alone or in combination with other logic circuitry, or any other equivalent circuitry. A control unit comprising hardware may also perform one or more of the techniques of this disclosure.</p><p id="p0102" num="0102">Such hardware, software, and firmware may be implemented within the same device or within separate devices to support the various operations and functions described in this disclosure. In addition, any of the described units, modules or components may be implemented together or separately as discrete but interoperable logic devices. Depiction of different features as modules or units is intended to highlight different functional aspects and does not necessarily imply that such modules or units must be realized by separate hardware or software components. Rather, functionality associated with one or more modules or units may be performed by separate hardware or software components, or integrated within common or separate hardware or software components.</p><p id="p0103" num="0103">The techniques described in this disclosure may also be embodied or encoded in a computer-readable medium, such as a computer-readable storage medium, containing instructions. Instructions embedded or encoded in a computer-readable medium may cause a<!-- EPO <DP n="20"> --> programmable processor, or other processor, to perform the method, e.g., when the instructions are executed. Computer-readable media may include non-transitory computer-readable storage media and transient communication media. Computer readable storage media, which is tangible and non-transitory, may include random access memory (RAM), read only memory (ROM), programmable read only memory (PROM), erasable programmable read only memory (EPROM), electronically erasable programmable read only memory (EEPROM), flash memory, a hard disk, a CD-ROM, a floppy disk, a cassette, magnetic media, optical media, or other computer-readable storage media. It should be understood that the term "computer-readable storage media" refers to physical storage media, and not signals, carrier waves, or other transient media.</p><p id="p0104" num="0104">In one example, a system includes a first computing device configured to execute a virtual machine, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters, stop execution of the virtual machine, and create checkpoint data for the virtual machine, and a second computing device configured to execute the virtual machine, using at least some of the checkpoint data, and to cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters. The system may further include a first provider edge (PE) routing device communicatively coupled to the first computing device via the first attachment circuit, and a second PE routing device communicatively coupled to the second computing device via the second attachment circuit.</p><p id="p0105" num="0105">Various examples have been described. These and other examples are within the scope of the following claims.</p></description><claims mxw-id="PCLM56976504" lang="EN" load-source="patent-office"><!-- EPO <DP n="21"> --><claim id="c-en-0001" num="0001"><claim-text>A method for migrating a virtual machine between computing devices comprising:
<claim-text>after execution of a virtual machine by a first computing device has stopped, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the first computing device, receiving, by a second computing device, checkpoint data for the virtual machine, wherein the checkpoint data represents state information for the virtual machine;</claim-text>
<claim-text>executing, by the second computing device, the virtual machine using at least some of the checkpoint data to move execution of the virtual machine from the first computing device to the second computing device; and</claim-text>
<claim-text>causing the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method of claim 1, wherein causing the virtual machine to become communicatively coupled to the VPN via the second attachment circuit comprises:
<claim-text>determining the second set of network parameters for the second attachment circuit; and</claim-text>
<claim-text>constructing a network stack for a guest operating system of the virtual machine based on the second set of network parameters.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method of claim 2, wherein the first attachment circuit comprises a first type of attachment circuit, and wherein the second attachment circuit comprises a second type of attachment circuit different from the first type of attachment circuit.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method of any of claims 1-3, wherein when the second attachment circuit comprises a virtual local area network (VLAN), the second set of network parameters comprise VLAN tags and instructions for updating an address resolution protocol (ARP) cache of the guest operating system.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method of any of claims 1-3, wherein when the second attachment circuit comprises a generic routing encapsulation (GRE) tunnel, the second set of network parameters comprise a home agent address of a provider edge (PE) routing device for the GRE tunnel, a protocol for the GRE tunnel, and a GRE session key.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method of claim 5, wherein the second set of network parameters further comprise data representative of a new default gateway for the virtual machine.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method of any of claims 1-6, wherein the second set of network parameters further comprise instructions for causing the guest operating system to re-authenticate the second type of attachment circuit to the VPN using an authentication protocol.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method of any of claims 2-3, wherein determining the second set of network parameters comprises receiving a message from a provider edge (PE) routing device to which the second computing device is communicatively coupled, wherein the message includes data specifying the second set of network parameters based on configuration data of the PE routing device.<!-- EPO <DP n="22"> --></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method of claim 8, wherein receiving the message comprises receiving an Internet control message protocol (ICMP) router advertisement message that contains the data specifying the second set of network parameters to coupling the virtual machine to the VPN via the second attachment circuit.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The method of claim 8, wherein the message further includes an indication of a type for the second attachment circuit.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>A computing device comprising means for performing the method of any of claims 1-10.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The computing device of claim 11, wherein the means comprise a network interface and a control unit.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>A computer-readable storage medium comprising instructions that, when executed, cause a processor of a computing device to perform the method of any of claims 1-10.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A system comprising:
<claim-text>a first computing device configured to execute a virtual machine, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters, to stop execution of the virtual machine, and to create checkpoint data for the virtual machine, wherein the checkpoint data represents state information for the virtual machine; and</claim-text>
<claim-text>a second computing device configured to execute the virtual machine using at least some of the checkpoint data, and to cause the virtual machine to become communicatively coupled to the VPN via a second attachment circuit using a second set of network parameters different from the first set of network parameters.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>A method comprising:
<claim-text>determining, by a routing device, that a virtual machine has migrated from a first computing device to a second computing device, wherein the virtual machine is communicatively coupled to a virtual private network (VPN) via a first attachment circuit using a first set of network parameters while executed by the first computing device, and wherein the routing device is communicatively coupled to the second computing device; and</claim-text>
<claim-text>in response to determining that the virtual machine has migrated to the second computing device, sending a message from the routing device to the second computing device including a second set of network parameters for causing the virtual machine to become communicatively coupled to the VPN via a second attachment circuit, wherein the second set of network parameters are different from the first set of network parameters, and wherein the second attachment circuit couples the virtual machine to the routing device.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16667284" load-source="patent-office"><!-- EPO <DP n="23"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="213" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="24"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="213" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="25"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="165" he="211" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="26"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="165" he="231" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
