<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680625-A2" country="EP" doc-number="2680625" kind="A2" date="20140101" family-id="44712667" file-reference-id="318291" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549063" ucid="EP-2680625-A2"><document-id><country>EP</country><doc-number>2680625</doc-number><kind>A2</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-11762027-A" is-representative="YES"><document-id mxw-id="PAPP154822986" load-source="docdb" format="epo"><country>EP</country><doc-number>11762027</doc-number><kind>A</kind><date>20110503</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP179671980" load-source="docdb" format="original"><country>EP</country><doc-number>11762027.8</doc-number><date>20110503</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140450689" ucid="CN-2011073614-W" linkage-type="A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2011073614</doc-number><kind>W</kind><date>20110503</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1949013599" load-source="docdb">H04W  68/00        20090101ALN20160408BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1949013600" load-source="docdb">H04W  60/04        20090101ALI20160408BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1949013601" load-source="docdb">H04W   4/14        20090101AFI20160408BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1873986540" load-source="docdb" scheme="CPC">H04W  68/005       20130101 LI20161126BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1873986541" load-source="docdb" scheme="CPC">H04W  60/06        20130101 FI20161124BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1873986542" load-source="docdb" scheme="CPC">H04W   4/14        20130101 LI20161126BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2001296889" load-source="docdb" scheme="CPC">H04W   8/06        20130101 LI20151107BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2032824036" load-source="docdb" scheme="CPC">H04W  60/04        20130101 LI20150805BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132179673" lang="DE" load-source="patent-office">VERFAHREN UND VORRICHTUNG ZUM EMPFANGEN ODER SENDEN VON KURZNACHRICHTEN</invention-title><invention-title mxw-id="PT132179674" lang="EN" load-source="patent-office">METHOD AND DEVICE FOR RECEIVING OR TRANSMITTING SHORT MESSAGE</invention-title><invention-title mxw-id="PT132179675" lang="FR" load-source="patent-office">PROCÉDÉ ET DISPOSITIF DE RÉCEPTION OU D'ÉMISSION DE MESSAGE COURT</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918167407" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI TECH CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR918166635" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI TECHNOLOGIES CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR918982040" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Technologies Co., Ltd.</last-name><iid>101233704</iid><address><street>Huawei Administration Building Bantian Longgang District</street><city>Shenzhen, Guangdong 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918145548" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>YU YIJUN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918172552" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>YU, YIJUN</last-name></addressbook></inventor><inventor mxw-id="PPAR918979431" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>YU, YIJUN</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918982985" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Pfenning, Meinig &amp; Partner GbR</last-name><iid>101244111</iid><address><street>Theresienhöhe 13</street><city>80339 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2011073614-W"><document-id><country>CN</country><doc-number>2011073614</doc-number><kind>W</kind><date>20110503</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2011120453-A2"><document-id><country>WO</country><doc-number>2011120453</doc-number><kind>A2</kind><date>20111006</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548840072" load-source="docdb">AL</country><country mxw-id="DS548838629" load-source="docdb">AT</country><country mxw-id="DS548835998" load-source="docdb">BE</country><country mxw-id="DS548841148" load-source="docdb">BG</country><country mxw-id="DS548801031" load-source="docdb">CH</country><country mxw-id="DS548835999" load-source="docdb">CY</country><country mxw-id="DS548838630" load-source="docdb">CZ</country><country mxw-id="DS548840073" load-source="docdb">DE</country><country mxw-id="DS548836000" load-source="docdb">DK</country><country mxw-id="DS548836001" load-source="docdb">EE</country><country mxw-id="DS548835846" load-source="docdb">ES</country><country mxw-id="DS548841149" load-source="docdb">FI</country><country mxw-id="DS548801032" load-source="docdb">FR</country><country mxw-id="DS548840074" load-source="docdb">GB</country><country mxw-id="DS548836002" load-source="docdb">GR</country><country mxw-id="DS548840075" load-source="docdb">HR</country><country mxw-id="DS548838631" load-source="docdb">HU</country><country mxw-id="DS548801033" load-source="docdb">IE</country><country mxw-id="DS548836003" load-source="docdb">IS</country><country mxw-id="DS548841150" load-source="docdb">IT</country><country mxw-id="DS548836004" load-source="docdb">LI</country><country mxw-id="DS548841151" load-source="docdb">LT</country><country mxw-id="DS548801819" load-source="docdb">LU</country><country mxw-id="DS548841152" load-source="docdb">LV</country><country mxw-id="DS548841153" load-source="docdb">MC</country><country mxw-id="DS548801820" load-source="docdb">MK</country><country mxw-id="DS548801821" load-source="docdb">MT</country><country mxw-id="DS548835847" load-source="docdb">NL</country><country mxw-id="DS548833319" load-source="docdb">NO</country><country mxw-id="DS548835848" load-source="docdb">PL</country><country mxw-id="DS548842514" load-source="docdb">PT</country><country mxw-id="DS548838632" load-source="docdb">RO</country><country mxw-id="DS548842515" load-source="docdb">RS</country><country mxw-id="DS548835849" load-source="docdb">SE</country><country mxw-id="DS548801034" load-source="docdb">SI</country><country mxw-id="DS548833320" load-source="docdb">SK</country><country mxw-id="DS548833321" load-source="docdb">SM</country><country mxw-id="DS548801826" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669734" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Disclosed are a method and an apparatus for receiving or sending a short message. The method includes: receiving a first message sent by an MSC/VLR; determining that a user equipment is in an abnormal state according to the first message; and sending a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR. The apparatus includes a receiving module, a first determining module and a sending module. According to the method and apparatus for receiving or sending a short message provided by embodiments of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, and improving the user experience.<img id="iaf01" file="imgaf001.tif" wi="146" he="93" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499107" lang="EN" source="EPO" load-source="docdb"><p>Disclosed are a method and an apparatus for receiving or sending a short message. The method includes: receiving a first message sent by an MSC/VLR; determining that a user equipment is in an abnormal state according to the first message; and sending a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR. The apparatus includes a receiving module, a first determining module and a sending module. According to the method and apparatus for receiving or sending a short message provided by embodiments of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, and improving the user experience.</p></abstract><description mxw-id="PDES63955164" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>FIELD OF THE INVENTION</b></heading><p id="p0001" num="0001">The present invention relates to the field of communications, and in particular, to a method and apparatus for receiving or sending a short message.</p><heading id="h0002"><b>BACKGROUND OF THE INVENTION</b></heading><p id="p0002" num="0002">An evolved packet system (Evolved Packet System, "EPS" for short) includes an evolved universal mobile telecommunication system territorial access network (Evolved Universal Mobile Telecommunication System Territorial Access Network, "E-UTRAN" for short) and an evolved packet core network (Evolved Packet Core Network, "EPC" for short). In order to support a circuit switched (Circuit Switched, "CS" for short) service, for example, a CS voice and a CS short message (Short Message Service, "SMS" for short), in the EPS, an SGs interface is deployed between a mobility management entity (Mobility Management Entity, "MME" for short) of the EPS and a mobile switch center/visitor location register (Mobile Switch Center/Visitor Location Register, "MSC/VLR" for short) of a circuit switched network (Circuit Switched Network) to enable a user equipment (user equipment, "UE" for short) to originate and receive the CS service at the EPS network, and return to a circuit domain (for example, a 2G/3G network) via an E-UTRAN, so as to complete the CS service, where the network architecture and the processing method may be referred to as "CS Fallback" (CS Fallback, "CSFB" for short).</p><p id="p0003" num="0003">In the CSFB, the processing way of the short message service differs from those of other CS services (for example, the voice and the CS supplementary service), that is, the short message service does not need to fall back into the 2G/3G network, but short message delivery between the UE and the MSC/VLR is directly completed via the MME in the EPS network; therefore, it is generally referred to as an "SMS over SGs (SMS over SGs)" technology. In the prior art, the SMS over SGs (Mobile Originating SMS, "MO SMS" for short) processing process originated by the user can achieve sending of a short message, and the SMS over SGs (Mobile Terminated SMS, "MT SMS" for short) processing process received by the user can achieve receiving of a short message. In the MO SMS process, when the user equipment is in an abnormal state, for example, the context of the user equipment in the MSC/VLR is lost, or the MSC/VLR cannot process the short message<!-- EPO <DP n="2"> --> of the user, due to reasons such as a failure of the MSC/VLR (for example, the board reset), or the MSC/VLR recovering from a fault. At this time, the MSC/VLR indicates the MME that the current process fails, so the MME marks in the context of the UE in the MME, and indicates the UE to re-originate the registration to the MSC/VLR when the UE subsequently originates the tracking area update process. While it is not determined when the UE can originate the tracking area update process, and generally, at least several hours are needed, in this time period, the user cannot send the short message, that is, the sending of the short message cannot be achieved.</p><p id="p0004" num="0004">In the MT SMS process, when the user equipment is in an abnormal state, for example, the context of the user equipment in the MSC/VLR is lost, due to reasons such as a failure of the MSC/VLR (for example, the board reset), or the MSC/VLR recovering from the fault. At this time, the MSC/VLR can still receive a short message sent by an SMS-gateway mobile switching center (SMS-Gateway Mobile Switching Center, "SMS-GMSC" for short), and further send a paging message to the MME, and the MME further sends a service request message to the MSC/VLR, so as to indicate the MSC/VLR to start sending the short message. However, the user equipment context of the UE in the MSC/VLR is lost, so the MSC/VLR ignores the service request message sent by the MME, and cannot send the short message to the UE, that is, the receiving of a short message cannot be achieved. However, the MSC/VLR ignores the paging response sent by the MME, that is, the service request message, so the MSC/VLR considers that this paging fails, and pages repeatedly, resulting in a waste of network resources.</p><heading id="h0003"><b>SUMMARY OF THE INVENTION</b></heading><p id="p0005" num="0005">Accordingly, embodiments of the present invention provide a method and an apparatus for receiving or sending a short message, which can achieve receiving or sending of a short message service when a user equipment is in an abnormal state due to a failure of an MSC/VLR.</p><p id="p0006" num="0006">According to an aspect, an embodiment of the present invention provides a method for receiving or sending a short message, where the method includes: receiving a first message sent by a mobile switch center MSC/visitor location register VLR; determining that a user equipment is in an abnormal state according to the first message; and sending a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</p><p id="p0007" num="0007">According to another aspect, an embodiment of the present invention provides an apparatus for receiving or sending a short message, where the apparatus includes: a receiving module, configured to receive a first message sent by a mobile switch center MSC/visitor location register VLR; a first determining module, configured to determine that a user equipment is in an abnormal state<!-- EPO <DP n="3"> --> according to the first message; and a sending module, configured to send a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</p><p id="p0008" num="0008">According to another aspect, an embodiment of the present invention provides an apparatus for receiving or sending a short message, and the apparatus includes: a receiving module, configured to receive a second message sent by a mobile management device, where the second message is used to instruct the apparatus to initiate attachment to a mobile switch center MSC/visitor location register VLR; and a first sending module, configured to send a third message to the mobile management device according to the second message, so as to initiate attachment to the MSC/VLR. Based on the technical solutions described above, according to the method and apparatus for receiving or sending a short message provided by the embodiments of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improve the user experience.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF THE DRAWINGS</b></heading><p id="p0009" num="0009">To illustrate the technical solutions according to the embodiments of the present invention more clearly, the following introduces the accompanying drawings for describing the embodiments. Apparently, the accompanying drawings in the following description are only some embodiments of the present invention, and a person skilled in the art can derive other drawings from the accompanying drawings without creative efforts.
<ul><li><figref idrefs="f0001">FIG. 1</figref> is a schematic flow chart of a method for receiving or sending a short message according to an embodiment of the present invention;</li><li><figref idrefs="f0001">FIG. 2</figref> is a schematic flow chart of a method for receiving a short message according to an embodiment of the present invention;</li><li><figref idrefs="f0002">FIG. 3</figref> is a schematic flow chart of a method for receiving a short message according to another embodiment of the present invention;</li><li><figref idrefs="f0002">FIG. 4</figref> is a schematic flow chart of a method for receiving or sending a short message according to another embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 5</figref> is a schematic flow chart of a method for sending a short message according to an embodiment of the present invention;<!-- EPO <DP n="4"> --></li><li><figref idrefs="f0004">FIG. 6</figref> is a schematic flow chart of a method for receiving a short message according to another embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 7</figref> is a schematic flow chart of a method for sending a short message according to another embodiment of the present invention;</li><li><figref idrefs="f0006">FIG. 8</figref> is a schematic block diagram of an apparatus for receiving or sending a short message according to an embodiment of the present invention;</li><li><figref idrefs="f0006">FIG. 9A and FIG. 9B</figref> are a schematic block diagram of an apparatus for receiving or sending a short message according to another embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 10</figref> is a schematic block diagram of an apparatus for receiving or sending a short message according to another embodiment of the present invention; and</li><li><figref idrefs="f0007">FIG. 11</figref> is a schematic block diagram of an apparatus for receiving or sending a short message according to another embodiment of the present invention.</li></ul></p><heading id="h0005"><b>DETAILED DESCRIPTION OF THE EMBODIMENTS</b></heading><p id="p0010" num="0010">The following clearly and completely describes the technical solutions according to the embodiments of the present invention with reference to the accompanying drawings in the embodiments of the present invention. Apparently, the embodiments in the following description are merely a part rather than all of the embodiments of the present invention. All other embodiments obtained by a person skilled in the art based on the embodiments of the present invention without creative efforts shall fall within the protection scope of the present invention.</p><p id="p0011" num="0011"><figref idrefs="f0001">FIG. 1</figref> shows a schematic process chart of a method 100 for receiving or sending a short message according to an embodiment of the present invention. As shown in <figref idrefs="f0001">FIG. 1</figref>, the method 100 includes: S110: Receive a first message sent by an MSC/VLR.</p><p id="p0012" num="0012">S 120: Determine that a user equipment is in an abnormal state according to the first message. S130: Send a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</p><p id="p0013" num="0013">When the user equipment is in an abnormal state, for example, the context of the user equipment in the MSC/VLR is lost, or the MSC/VLR cannot process the short message of the user, due to reasons such as a failure of the MSC/VLR (for example, a board reset), or the recovery of the MSC/VLR from the failure. At this time, the MSC/VLR indicates a mobile management device that the current process fails. Therefore, when the mobile management device receives the first message sent by the MSC/VLR, and determines that the user equipment is in an abnormal state according to the first message, the mobile management device sends a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR, so<!-- EPO <DP n="5"> --> that the user equipment can receive or send a short message normally.</p><p id="p0014" num="0014">According to the method for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. It should be understood that in the embodiment of the present invention, the user equipment being in an abnormal state includes the board reset, the user context losing and other situations that affect receiving or sending a short message normally, for example, the MSC/VLR may detect that the MSC/VLR does not have the context of the UE, or does not have a valid context of the UE (for example, the context is not confirmed by a wireless network, that is, a "Confirmed by Radio Contact" mark in the context of the UE in the MSC/VLR is set to be False; or not confirmed by a home location register (Home Location Register, "HLR" for short)), or no SGs connection of the UE exists. In the embodiment of the present invention, the situation that the MSC/VLR does not have the context of the UE, or the MSC/VLR does not have the valid context of the UE, or no SGs connection of the UE exists is taken as an example to illustrate that the user equipment is in an abnormal state, but the embodiments of the present invention are not limited thereto. It should further be understood that, in the embodiment of the present invention, the mobile management device may include a mobility management entity MME.</p><p id="p0015" num="0015">In the embodiments of the present invention, the method according to the embodiments of the present invention may include a method for receiving a short message and a method for sending a short message, which are described in the following.</p><p id="p0016" num="0016">When the user equipment is in an abnormal state and the receiving of a short message is influenced, the first message sent by the MSC/VLR and received by the mobile management device may be a first paging message, and at this time, the method for receiving a short message according to an embodiment of the present invention is shown in <figref idrefs="f0001">FIG. 2</figref> and <figref idrefs="f0002">FIG. 3</figref>. <figref idrefs="f0001">FIG. 2</figref> shows a schematic flow chart of a method 200 for receiving a short message according to an embodiment of the present invention. As shown in <figref idrefs="f0001">FIG. 2</figref>, the method 200 includes:
<ul><li>In S210, a mobile management device receives a first paging (Paging) message sent by the MSC/VLR, where the first paging message carries an international mobile subscriber identification number (International Mobile Subscriber Identification Number, "IMSI" for short) of the UE, and a service type carried by the first paging message is a short message. Because the MSC/VLR cannot<!-- EPO <DP n="6"> --> process the short message service for the UE, for example, the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, for example, a context of the UE is lost, or an SGs connection established for the UE in the MSC/VLR is released, that is, in a SGs-Null state. At this time, the MSC/VLR executes the IMSI paging processing, that is, the first paging message does not carry information such as a UE location area identity (Location Area Identity, "LAI" for short) and/or a temporary mobile subscriber identity (Temporary Mobile Subscriber Identity, "TMSI" for short).</li></ul></p><p id="p0017" num="0017">In S220, the mobile management device determines that the user equipment is in an abnormal state according to the first paging message. Specifically, according to that the first paging message does not carry the location area identity LAI or does not carry the TMSI of the user equipment, or according to that the first paging information does not carry the LAI and the TMSI, the mobile management device may determine that the user equipment is in an abnormal state, for example, the context of the UE does not exist, or the SGs connection is released.</p><p id="p0018" num="0018">In S230, the mobile management device determines that the user equipment is in an idle state.</p><p id="p0019" num="0019">In S240, when the user equipment is in the idle state, the mobile management device sends a second paging message to the user equipment, where the second paging message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</p><p id="p0020" num="0020">In the embodiment of the present invention, a paging type and/or a paging cause value of the second paging message may be used to instruct the user equipment to initiate the attachment to the MSC/VLR. Optionally, the paging type of the second paging message may be set to be IMSI detach (IMSI Detach), IMSI attach (IMSI Attach) or IMSI re-attach (IMSI re-attach), and so on. The paging cause value of the second paging message may be a paging cause value corresponding to the paging type, for example, may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context). It should be understood that under the teaching of the embodiment of the present invention, other paging types and/or paging cause values may be set for the second paging message, so as to instruct the user equipment to initiate attachment to the MSC/VLR, which all shall fall in the protection scope of the present invention.</p><p id="p0021" num="0021">At this time, the user equipment identity in the second paging message may be a temporary identity S-TMSI (S-Temporary Mobile Subscriber Identity) assigned for the UE by an EPS network, the S-TMSI may be obtained from the context of the UE existing in the MME by the MME according to the IMSI of the UE, and a core network domain indicator in the second paging message may be set to be a PS or a CS.</p><p id="p0022" num="0022">In the embodiment of the present invention, the second paging message may include a specific<!-- EPO <DP n="7"> --> combination of the user equipment identity and the core network domain identity, the specific combination of the user equipment identity and the core network domain identity is used to instruct the user equipment to initiate the attachment to the MSC/VLR. Optionally, when the context of the UE exists in the MME, the second paging message may include a specific combination of the user equipment identity being the IMSI and the core network domain identity being the CS. Optionally, when the MME does not have the valid context of the UE, the second paging message may include a specific combination of the user equipment identity being the IMSI and the core network domain identity being the PS.</p><p id="p0023" num="0023"><figref idrefs="f0002">FIG. 3</figref> shows a schematic flow chart of a method 300 for receiving a short message according to another embodiment of the present invention. As shown in <figref idrefs="f0002">FIG. 3</figref>, the method 300 includes:
<ul><li>S310: Receive a first paging message sent by an MSC/VLR.</li><li>S320: Determine that a user equipment is in an abnormal state according to that the first paging message does not include an LAI and/or a TMSI.</li><li>S330: Determine that the user equipment is in a connected state.</li><li>S340: Send a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</li><li>S310 and S320 in the method 300 are the same as S210 and S220 in the method 200, which are not described herein again for conciseness.</li></ul></p><p id="p0024" num="0024">In S330, a mobile management device determines that the user equipment is in an idle state, and sends a paging message to the user equipment, and the user equipment executes the service request processing to respond to the paging message and transfers the state of the user equipment to the connected state. The processing described above is an existing standard processing method, which is not described herein again.</p><p id="p0025" num="0025">In S340, when the user equipment is in a connected state, the mobile management device sends the second message to the user equipment, where the second message is used to instruct the user equipment to initiate the attachment to the MSC/VLR. Specifically, the type of the second message and/or the cause value included in the second message may be used to instruct the user equipment to initiate attachment to the MSC/VLR.</p><p id="p0026" num="0026">In the embodiments of the present invention, optionally, the second message is a detach request (Detach Request) message, and the detach type of the detach request message and/or the cause value included in the detach request message are used to instruct the user equipment to initiate attachment to the MSC/VLR. Specifically, the detach type of the detach request message may be set to be IMSI detach (IMSI Detach), IMSI attach (IMSI Attach) or IMSI re-attach (IMSI re-attach), and so on, and the detach cause value of the detach request message may be a cause value<!-- EPO <DP n="8"> --> corresponding to the detach type, for example, may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on. It should be understood that the embodiment of the present invention is described by merely taking the three detach types as examples for illustration, but the present invention is not limited thereto. Under the teaching of the embodiment of the present invention, other types and/or cause values may be set for the detach request message, to instruct the user equipment to initiate attachment to the MSC/VLR, which all shall fall in the protection scope of the present invention.</p><p id="p0027" num="0027">Optionally, the second message is a circuit switched CS service notification (CS Service Notification) message, and the CS service notification message includes information of instructing the user equipment to initiate attachment to the MSC/VLR. The type of the CS service notification message and/or the cause value included in the CS service notification message are used to instruct the user equipment to initiate attachment to the MSC/VLR. Specifically, the CS service notification message carries an information element indicating that the UE needs to initiate attachment to the MSC/VLR (that is, the type and/or the cause value of the message), and the type of the CS service notification message is set to be, for example, IMSI detach (IMSI Detach), IMSI attach (IMSI Attach), and IMSI re-attach (IMSI re-attach), and the cause value included by the CS service notification message may be the cause value corresponding to the type, for example, may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.</p><p id="p0028" num="0028">Optionally, the second message is a notification (Notification) message, and the notification message carries information of instructing the user equipment to initiate attachment to the MSC/VLR. The type of the notification message and/or the cause value included in the notification message are used to instruct the user equipment to initiate attachment to the MSC/VLR. Specifically, the notification message carries an information element indicating that the UE needs to initiate attachment to the MSC/VLR (that is, the type and/or the cause value of the message). For example, the information element may be set to be one of the following types: IMSI detach (IMSI Detach), IMSI attach (IMSI Attach) or IMSI re-attach (IMSI re-attach), and the cause value of the information element may be the cause value corresponding to the type, for example, it may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.</p><p id="p0029" num="0029">According to the method for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be<!-- EPO <DP n="9"> --> established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. When the user equipment is in an abnormal state and therefore the sending of a short message is affected, the first message sent by the MSC/VLR and received by the mobile management device may be a release request message.</p><p id="p0030" num="0030">At this time, as shown in <figref idrefs="f0001">FIG. 1</figref>, in S120, the determining that the user equipment is in an abnormal state according to the first message includes: determining that the user equipment is in an abnormal state according to the cause value of the release request message.</p><p id="p0031" num="0031">Specifically, for example, when the context of the UE is lost, or the MSC/VLR does not have the valid context of the UE, or the SGs connection of the UE is released due to reasons such as a failure of the MSC/VLR, the MSC/VLR sends a release request (Release Request) message to the MME, and the cause value of the release request message indicates that the IMSI of the user equipment is unknown ("IMSI Unknown"); and when the SGs connection established for the UE is released due to a failure of the MSC/VLR, that is, the SGs connection is in the SGs-Null state, the cause value of the release request message sent by the MSC/VLR to the MME indicates that the IMSI of the user equipment is detached ("IMSI detached for non-EPS services").</p><p id="p0032" num="0032">In S130, the mobile management device sends the second message to the user equipment, and the second message is used to instruct the user equipment to initiate the attachment to the MSC/VLR, so that the user equipment can receive and send a short message. Optionally, the type of the second message and/or the cause value included in the second message may be used to instruct the user equipment to initiate attachment to the MSC/VLR. Optionally, the second message is a detach request (Detach Request) message, a CS service notification (CS Service Notification) message or a notification (Notification) message. Optionally, the type of the second message may be IMSI detach (IMSI Detach), IMSI attach (IMSI Attach) or IMSI re-attach (IMSI re-attach), and so on. The cause value of the second message may be the cause value corresponding to the type, for example, may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.</p><p id="p0033" num="0033">According to the method for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a<!-- EPO <DP n="10"> --> failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. In the above, the method for receiving or sending a short message provided by the embodiment of the present invention is described in detail from the perspective of the mobile management device, and in the following, the method for receiving or sending a short message provided by the embodiments of the present invention in detail from the perspective of the user equipment.</p><p id="p0034" num="0034"><figref idrefs="f0002">FIG. 4</figref> shows a schematic flow chart of a method 400 for sending a short message according to another embodiment of the present invention. As shown in <figref idrefs="f0002">FIG. 4</figref>, the method 400 includes:
<ul><li>S410: Receive a second message sent by a mobile management device, where the second message is used to instruct the user equipment needs to initiate attachment to the MSC/VLR.</li><li>S420: Send a third message to the mobile management device according to the second message, so as to initiate the attachment to the MSC/VLR.</li></ul></p><p id="p0035" num="0035">When the user equipment is in an abnormal state, for example, the context of the user equipment in the MSC/VLR is lost, or the MSC/VLR cannot process the short message of the user, due to reasons such as a failure of the MSC/VLR, for example, a board reset, or the recovery of the MSC/VLR from the failure, and at this time, the MSC/VLR indicates the mobile management device that the current process fails. In order to achieve receiving or sending a short message, according to the embodiment of the present invention, the mobile management device sends the second message that is used to instruct the user equipment to initiate attachment to the MSC/VLR, to the user equipment, and after receiving the second message, the user equipment sends the third message to the mobile management device, so as to initiate the attachment to the MSC/VLR, so that the user equipment can receive or send a short message normally.</p><p id="p0036" num="0036">According to the method for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. In the embodiment of the present invention, the second message may be a second paging message, a detach request message, a CS service notification message, or a notification message, and these messages may all be used to instruct the user equipment to initiate attachment to the MSC/VLR, and are described in different situations in the following.</p><p id="p0037" num="0037">In the embodiment of the present invention, optionally, the third message is a tracking area update<!-- EPO <DP n="11"> --> request message or an attach request message. That is, according to the second message, the user equipment may send a tracking area update request message or an attach request message to the mobile management device, so that the user equipment can re-register on the MSC/VLR, and establish the context of the user equipment on the MSC/VLR, and the user equipment can receive or send a short message normally.</p><p id="p0038" num="0038">In the embodiment of the present invention, the method according to the embodiment of the present invention may include a method for receiving a short message and a method for sending a short message, which are described in the following.</p><p id="p0039" num="0039">When the user equipment is in an abnormal state and the receiving of a short message is affected, the MSC/VLR may send an IMSI paging message to the mobile management device, to enable the mobile management device to know that the user equipment is in an abnormal state and cannot receive the short message normally. At this time, when the user equipment is in an idle state, the mobile management device sends a second message, which is a second paging message, to the user equipment, where the second paging message instruct the user equipment to initiate attachment to the MSC/VLR, and the user equipment may send a tracking area update request message or an attach request message to the mobile management device according to the second paging message, thereby facilitating receiving the short message.</p><p id="p0040" num="0040">Optionally, the user equipment sends a tracking area update request (Tracking Area Update Request) message or an attach request (Attach Request) message to the mobile management device according to the paging type or the paging cause value of the second paging message. The type of the tracking area update request message may be a combined TA/LA update (Combined TA/LA Update, where the tracking area Tracking Area is referred to as "TA" for short, and the location area Location Area is referred to as "LA" for short) or a periodic TA update (Periodic TA Update). The type of the attach request message may be a combined EPS/IMSI attach (Combined EPS/IMSI Attach). Specifically, when the user equipment receives the second paging message a paging type of which is IMSI detach (IMSI Detach), IMSI attach (IMSI Attach) or IMSI re-attach (IMSI re-attach), or when the user equipment receives the second paging message a paging cause value of which is the cause value corresponding to the paging type, for example, the value is that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), the user equipment may send a tracking area update request message or an attach request message to the mobile management device.</p><p id="p0041" num="0041">In the embodiment of the present invention, the user equipment may send a tracking area update request message or an attach request message to the mobile management device according to a specific combination of a user equipment identity and a core network domain identity in the second<!-- EPO <DP n="12"> --> paging message.</p><p id="p0042" num="0042">Optionally, the user equipment sends the tracking area update request message or the attach request message to the mobile management device according to that the specific combination of the user equipment identity and the core network domain identity in the second paging message is a specific combination of the international mobile subscriber identification number IMSI and the circuit switched CS, where the type of the tracking area update request message may be combined TA/LA update or periodic TA update, and the type of the attach request message may be combined EPS/IMSI attach (Combined EPS/IMSI Attach).</p><p id="p0043" num="0043">Optionally, the user equipment sends the attach request (Attach Request) message to the mobile management device according to that the specific combination of the user equipment identity and the core network domain identity in the second paging message is the specific combination of the IMSI and the packet switch PS. The type of the attach request message is combined EPS/IMSI attach (Combined EPS/IMSI Attach).</p><p id="p0044" num="0044">When the mobile management device receives the IMSI paging message sent by the MSC/VLR, which demonstrates that the user equipment is in an abnormal state and the receiving of a short message is influenced, if the user equipment is in a connected state or is transferred from an idle state to a connected state, the mobile management device sends the second message to the user equipment, so as to instruct the user equipment to initiate attachment to the MSC/VLR.</p><p id="p0045" num="0045">When the user equipment is in an abnormal state and therefore the sending of a short message is affected, the mobile management device receives the first message sent by the MSC/VLR, where the first message may be a release request message. The mobile management device may send the second message to the user equipment to instruct the user equipment to initiate attachment to the MSC/VLR, after it is determined that the user equipment is in an abnormal state according to the cause value of the release request message.</p><p id="p0046" num="0046">In the embodiment of the present invention, the type of the second message and/or the cause value included in the second message may be used to instruct the user equipment to initiate attachment to the MSC/VLR. Optionally, the second message is a detach request message, a CS service notification message or a notification message. For detailed description of the second message, reference may be made to the relevant description in the methods 100 to 300 described above, which is not be described herein again for briefness.</p><p id="p0047" num="0047">After a user equipment receives a second message sent by a mobile management device, the method 500 for sending a short message according to the embodiment of the present invention may further include:
<ul><li>S530: The user equipment sends a fourth message for responding to the second message to the<!-- EPO <DP n="13"> --> mobile management device. For example, the fourth message may be a detach accept (Detach Accept) message.</li></ul></p><p id="p0048" num="0048">Before, after or at the same time that the user equipment sends a tracking area update request message or an attach request message to the mobile management device, the method 500 may further include:
<ul><li>S540: Send a pause indicator to a short message service protocol stack or an application on the user equipment, where the pause indicator is used to instruct to pause the sending of a short message.</li></ul></p><p id="p0049" num="0049">Optionally, the method 500 may further include:
<ul><li>S550: Send a resend indicator to the short message service protocol stack or the application on the user equipment after receiving a message responding to the third message sent by the mobile management device, where the resend indicator is used to instruct to restart the sending of the short message.</li></ul></p><p id="p0050" num="0050">For example, after the user equipment receives a tracking area update accept (Tracking Area Accept) message or an attach accept (Attach Accept) message that is sent by the mobile management device and responds to the tracking area update request message or the attach request message, the user equipment sends the resend indicator to the short message service protocol stack or the application on the user equipment, to resend the short message.
<ul><li>S510 and S520 in the method 500 are the same as S410 and S420 in the method 400, which are not described herein again.</li></ul></p><p id="p0051" num="0051">It should be understood that the magnitude of serial numbers of the procedure described above does not mean the execution sequence, the execution sequence of the procedure should be determined by the function and the internal logic, and the implementing procedure of the embodiment of the present invention should not be restricted.</p><p id="p0052" num="0052">According to the method for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. The method for receiving or sending a short message according to the embodiment of the present invention are described in detail in the following by taking receiving or sending a short message in an EPS network.</p><p id="p0053" num="0053"><figref idrefs="f0004">FIG. 6</figref> shows a schematic flow chart of a method 600 for receiving a short message according to an<!-- EPO <DP n="14"> --> embodiment of the present invention, and the embodiment is for a scenario in which a user equipment receives the short message, that is, an MT SMS scenario. As shown in <figref idrefs="f0004">FIG. 6</figref>, the method 600 includes:
<ul><li>S601: A short message service center (SMS Center, "SC" for short) sends a short message to an SMS-GMSC.</li><li>S602: The SMS-GMSC executes route information query processing, and obtains the MSC/VLR where the UE attaches currently from a home location register (Home Location Register, "HLR" for short)/home subscriber server (Home Subscriber Server, "HSS" for short).</li><li>S603: The SMS-GMSC forwards the short message to the MSC/VLR where the UE attaches.</li><li>S604: When the user equipment is in an abnormal state and cannot process the short message service for the UE, for example, the context of the UE is lost due to a failure of the MSC/VLR, or SGs connection established for the UE in the MSC/VLR is released, that is, in the SGs-Null state, the MSC/VLR executes the IMSI paging processing, that is, sends a paging message to the MME, where the paging message carries the IMSI of the UE, but does not carry the location area identity LAI of the UE, and the service type of the paging message is a short message.</li></ul></p><p id="p0054" num="0054">At this time, the MSC/VLR may also immediately feedback the failure of sending the short message to the SC via the SMS-GMSC, and S607 is executed after the SC receives the feedback response. The MSC/VLR may also buffer the short message, so as to immediately send the buffered short message after the UE attaches to the MSC/VLR subsequently.</p><p id="p0055" num="0055">If the UE is in an idle state currently, the process proceeds to S605 and S606, then proceeds to S613; and if the UE is in a connected state currently, the paging process is not executed, and the process directly proceeds to S611.
<ul><li>S605: The UE is in an idle state currently, and at this time, the MME sends the paging message to an evolved node B (Evolved Node B, "eNB" for short), where the paging message carries an identity of the UE and a core network domain indicator (CN Domain).</li></ul></p><p id="p0056" num="0056">If the paging message does not include the information of instructing the user equipment to initiate the attachment to the MSC/VLR, the paging message sent by the eNB to the UE in step 606 does not include the information of instructing the user equipment to initiate the attachment to the MSC/VLR either, and step S610 is executed.</p><p id="p0057" num="0057">According to the UE context information recorded in the MME, the paging message may instruct the UE to initiate the attachment to the MSC/VLR or the attachment to the MME and the MSC/VLR:
<ol><li>1) When the context of the UE exists in the MME:
<ol><li>a) The paging message includes an indicator requiring the UE to initiate the attachment to the<!-- EPO <DP n="15"> --> MSC/VLR, the attachment indicator may be represented by an information element such as a specific paging cause value or a paging type, its value may be set to be the following types specifically: "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and so on, and the paging cause value may be set to be a cause value corresponding to the type, for example, it may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on. At this time, the user identity in the paging message may be a temporary identity S-TMSI assigned for the UE by an EPS network, and the core network domain indicator may be set to be the PS or the CS, where the temporary identity S-TMSI may be obtained from the context of the UE in the MME by the MME according to the IMSI of the UE.</li><li>b) The paging message described above instructs the user equipment to initiate the attachment to the MSC/VLR via the specific UE identity and the core network domain indicator, for example, the user identity in the paging message is the IMSI received by the MME in S604, and the core network domain indicator is set to be the CS.</li></ol></li><li>2) When no valid context of the UE exists in the MME, the user identity in the paging message described above is the IMSI received by the MME in S604, for instructing the user equipment to initiate a combined EPS/IMSI attach process to the MME and the MSC/VLR, and at this time, the core network domain indicator may be set to be the PS.
<ul><li>S606: The eNB sends the paging message to the UE according to the paging message received from the MME. The paging message carries the identity of the UE, the core network domain identity and the indicator instructing the UE to initiate the attachment provided in S605.</li><li>S607: When the short message service center SC cannot send the short message successfully, for example, the send timer is expired, or a short message sending failure indicator sent by the MSC/VLR is received, a UE reachability notification request (UE Reachability Notification Request) message is sent to the SMS-GMSC, and the short message is buffered.</li><li>S608: The SMS-GMSC sends the UE reachability notification request (UE Reachability Notification Request) message to the HLR/HSS.</li><li>S609: The HLR/HSS sends the UE reachability notification request (UE Reachability Notification Request) message to the MSC/VLR. The MSC/VLR may set the notification request identity.</li></ul></li></ol></p><p id="p0058" num="0058">It should be understood that the magnitude of serial numbers of the procedure described above does not mean the execution sequence, the execution sequence of the procedure should be determined by the function and the internal logic, and the implementing procedure of the embodiment of the present invention should not be restricted. For example, the S607 to S609, the previous S604 to S606, and the later S611 to S615 do not have time sequence relations.<!-- EPO <DP n="16"> -->
<ul><li>S610: If the paging message received by the UE in S606 does not include the indicator of instructing the UE to initiate the attachment to the MSC/VLR, the UE executes a service request (Service Request) process to establish a signaling connection to turn the user into the connected state, and the process proceeds to S611.</li></ul></p><p id="p0059" num="0059">If the paging message received by the UE in S606 includes the indicator of instructing the user equipment to initiate the attachment to the MSC/VLR, the UE does not execute S610, that is, the UE does not execute the service request process, and the process proceeds to S613.
<ul><li>S611: The UE is in a connected state currently, and at this time, the MME sends the notification message to the UE according to the indicator received in S604, so as to instruct the user equipment to initiate the attachment to the MSC/VLR.</li></ul></p><p id="p0060" num="0060">The notification request message instructing the user equipment to initiate the attachment to the MSC/VLR may include the following types of implementation:
<ol><li>1) The notification request message may be a detach request (Detach Request) message, where a detach type (Detach Type) in the detach request message or a cause (cause) value in the detach request message is set to indicate that the UE needs to initiate the attachment to the MSC/VLR. The detach type may be set to be the following types: "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and so on, and the detach cause value may be set to be the cause value corresponding to the detach type, for example, it may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.</li><li>2) The notification request message may be a CS service notification (CS Service Notification) message, the CS service notification message carries the information element indicating that the UE needs to initiate the attachment to the MSC/VLR (that is, the type and/or the cause value of the message). For example, the message type may be set to be the following types: "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and so on, and similarly, the cause value of the message may be set to be the cause value corresponding to the type, for example, it may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.</li><li>3) The notification request message may be a notification (Notification) message, and the notification message carries the information element indicating that the UE needs to initiate the attachment to the MSC/VLR, (that is, the type and/or the cause value of the message). For example, the notification indicator (Notification Indicator) information element in the notification message may be set to be one of the following types: "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and similarly, the cause value of the notification<!-- EPO <DP n="17"> --> indicator information element may be set to be the cause value corresponding to the type, for example, the cause value of the notification indicator information element may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.
<ul><li>S612: The UE may send a notification response message responding to the notification request message to the MME, where the notification response message is, for example, a detach accept (Detach Accept) message.</li><li>S613: The UE originates a tracking area update process or an attach process according to the indicator received in S606 or S611.</li></ul></li></ol></p><p id="p0061" num="0061">Specifically, when one of the following conditions is met, the UE originates the tracking area update process or the attach process, and sends a tracking area update request (Tracking Area Update Request) message to the MME, an update type is combined TA/LA update (Combined TA/LA Update) or periodic TA update (Periodic TA Update), and the type of the attach request message may be combined EPS/IMSI attach (Combined EPS/IMSI Attach).
<ol><li>1) The UE receives the indicator of instructing the user equipment to initiate the attachment to the MSC/VLR, for example, "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and so on.</li><li>2) The UE receives the specific combination of the UE identity and the core network domain indicator, for example, the identity of the UE is the IMSI, and the core network domain indicator is the CS.</li></ol></p><p id="p0062" num="0062">When one of the following conditions is met, the UE originates the attach process, and sends an attach request (Attach Request) message to the MME, and the attach type is combined EPS/IMSI attach (Combined EPS/IMSI Attach):
<ol><li>1) The UE receives the specific combination of the UE identity and the core network domain indicator, for example, the identity of the UE is the IMSI, and the core network domain indicator is the PS.
<ul><li>S614: The MME originates registration to the MSC/VLR, and sends a location update request message (Location Update Request) to the MSC/VLR.</li><li>S615: The MSC/VLR establishes the context of the UE, assigns a temporary mobile subscriber identity (Temporary Mobile Subscriber Identity, "TMSI" for short) for the UE, and sends the location update accept message (Location Update Accept) to the MME.</li><li>S616: The MME sends a tracking area accept (Tracking Area Accept) message or an attach accept (Attach Accept) message to the UE.</li><li>S617: The UE may send a tracking area complete (Tracking Area Complete) message or an attach<!-- EPO <DP n="18"> --> complete (Attach Complete) message to the MME.</li><li>S618: After receiving a complete message sent by the UE, the MME sends a TMSI reallocation (TMSI Reallocation Complete) message to the MSC/VLR.</li></ul></li></ol></p><p id="p0063" num="0063">If the MSC/VLR buffers the short message of the UE (for example, proceeding buffering in S604), the MSC/VLR may execute S625 directly, after receiving the service request message of S626, execute S627 to send the short message to the UE; and S625 and S626 may also be omitted, and execute S627 directly to send the short message to the UE. The processing may also be executed immediately after S615.
<ul><li>S619: If the MSC/VLR sets the notification request identity in S609, the MSC/VLR sends a UE activity notification (UE Activity Notification) message to the HLR/HSS.</li><li>S620: The HLR/HSS sends the UE activity notification (UE Activity Notification) message to the SMS-GMSC.</li><li>S621: The SMS-GMSC sends the UE activity notification (UE Activity Notification) message to the short message service center SC.</li><li>S622: The short message service center resends the buffered short message to the SMS-GMSC.</li><li>S623: The SMS-GMSC queries the HLR/HSS for the MSC/VLR where the UE attaches currently.</li><li>S624: The SMS-GMSC forwards the short message to the MSC/VLR where the UE attaches.</li><li>S625: The MSC/VLR sends a paging (Paging) message, which carries information such as the IMSI of the UE and the location area identity (LAI) of the user equipment, to the MME, and the service type is a short message.</li></ul></p><p id="p0064" num="0064">If the UE is in the idle state in the MME, after receiving the paging message, the MME needs to execute a standard paging process first, after the UE receives the paging message, originate the service request (Service Request) process, and turn the UE into the connected state, which is not described herein again for briefness.
<ul><li>S626: The MME sends a service request (Service Request) message to the MSC/VLR.</li><li>S627: The MSC/VLR encapsulates the short message into a downlink data transport (Downlink Unitdata) message and sends the message to the MME.</li><li>S628: The MME encapsulates the short message into a downlink NAS transport (Downlink NAS transport) message and sends the message to the UE.</li><li>S629: The UE encapsulates a short message determining message into an uplink NAS transport message and sends the message to the MME.</li><li>S630: The MME encapsulates the short message service determining message into an uplink data transport (Uplink Unitdata) message and sends the message to the MSC/VLR.</li><li>S631: The UE encapsulates a short message delivery report (delivery report) into the uplink NAS<!-- EPO <DP n="19"> --> transport message and sends the message to the MME.</li><li>S632: The MME encapsulates the short message delivery report (delivery report) into the uplink data transport (Uplink Unitdata) message and sends the message to the MSC/VLR.</li><li>S633: The MSC/VLR sends the short message delivery report (delivery report) to the SMS-GMSC. S634: The SMS-GMSC sends the short message delivery report (delivery report) to the SC.</li><li>S635: The MSC/VLR determines that the short message delivery report (delivery report) is encapsulated into the downlink data transport (Downlink Unitdata) message and sends the message to the MME.</li><li>S636: The MME determines that the short message delivery report (delivery report) is encapsulated into the downlink NAS transport (Downlink NAS Transport) message and sends the message to the UE.</li><li>S627: The MSC/VLR sends a release request (Release Request) message to the MME.</li></ul></p><p id="p0065" num="0065">It should be understood that the magnitude of serial numbers of the procedure described above does not mean the execution sequence, the execution sequence of the procedure should be determined by the function and the internal logic, and the implementing procedure of the embodiment of the present invention should not be restricted. For example, S635 and S633 do not have a time sequence relation.</p><p id="p0066" num="0066">According to the method for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. <figref idrefs="f0005">FIG. 7</figref> shows a schematic flow chart of a method 700 for sending a short message according to an embodiment of the present invention, and the embodiment is for a scenario in which a user equipment sends the short message, that is, an MO SMS scenario. As shown in <figref idrefs="f0005">FIG. 7</figref>, the method 700 includes:
<ul><li>S701: When a UE needs to send a short message, if the UE is in an idle state, the UE executes a service request (Service Request) process. That is, the UE sends a service request (Service Request) message to the MME, and establishes a signaling connection, to turn the UE into a connected state.</li></ul></p><p id="p0067" num="0067">If the UE is in a connected state currently, the process directly proceeds to S702.
<ul><li>S702: The UE encapsulates the short message, which needs to be sent, into a uplink non-access stratum (Non-Access Stratum, "NAS" for short) transport (Uplink NAS Transport) message and<!-- EPO <DP n="20"> --> sends the message to the MME.</li><li>S703: The MME encapsulates the received short message into an uplink data transport (Uplink Unitdata) message and sends the message to the MSC/VLR.</li><li>S704: When the user equipment is in an abnormal state in the MSC/VLR and cannot process the short message for the UE, for example, the context of the UE is lost due to a failure of the MSC/VLR, or the SGs connection established for the UE in the MSC/VLR is released, that is, in an SGs-Null state, and the MSC/VLR sends a release request (Release Request) message to the MME, indicating that IMSI of the user equipment is unknown ("IMSI Unknown") or the IMSI of the user equipment is detached ("IMSI detached for non-EPS services").</li></ul></p><p id="p0068" num="0068">The SGs is the name of an interface between the MME and the MSC/VLR, the SGs connection refers to a channel between the MME and the MSC/VLR established for the UE, and the state of the SGs connection is maintained on the MME and the MSC/VLR.
<ul><li>S705: The MME sends a notification request message to the UE according to the indicator received in S704 to instruct the UE to initiate the attachment to the MSC/VLR.</li></ul></p><p id="p0069" num="0069">The notification request message instructing the user equipment to initiate the attachment to the MSC/VLR may include the following types of implementation specifically:
<ol><li>1) The notification request message may be a detach request (Detach Request) message, where a detach type (Detach Type) in a detach request message or the cause (cause) value in the detach request message is set to indicate that the UE needs to initiate the attachment to the MSC/VLR. The detach type may be set to be the following types: "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and so on, and the detach cause value may be set to be the cause value corresponding to the detach type, for example, it may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.</li><li>2) The notification request message may be a CS service notification (CS Service Notification) message, the CS service notification message carries the information element indicating that the UE needs to initiate the attachment to the MSC/VLR (that is, the type and/or the cause value of the message). For example, the message type may be set to be the following types: "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and so on, and similarly, the cause value of the message may be set to be the cause value corresponding to the type, for example, it may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.</li><li>3) The notification request message may be a notification (Notification) message, and the notification message carries the information element indicating that the UE needs to initiate the<!-- EPO <DP n="21"> --> attachment to the MSC/VLR (that is, the type and/or the cause value of the message). For example, the notification indicator (Notification Indicator) information element in the notification message may be set to be one of the following types: "IMSI detach (IMSI Detach)", "IMSI attach (IMSI Attach)" or "IMSI re-attach (IMSI re-attach)", and so on, and similarly, the cause value of the notification indicator information element may be set to be the cause value corresponding to the type, for example, the cause value of the notification indicator information element may be set to that the CS Service is not allowed (CS Service is not allowed), that the IMSI is unknown (IMSI is unknown), or the invalid context (Invalid Context), and so on.
<ul><li>S706: The UE may send a notification response message responding to the notification request message to the MME, where the notification response message is, for example, a detach accept (Detach Accept) message, and so on.</li><li>S707: The UE originates a tracking area update process or the attach process, and sends a tracking area update request (Tracking Area Update Request, TAU Request) message or an attach request (Attach Request) message to the MME according to the received indicator of initiating the attachment to the MSC/VLR in S705, for example, "IMSI attach", "IMSI detach", and so on. The type of the tracking area update request message may be combined TA/LA update (Combined TA/LA Update), or periodic TA update (Periodic TA Update); and the type of the attach request message is combined update (Combined EPS/IMSI Attach).</li></ul></li></ol></p><p id="p0070" num="0070">Before or after originating the tracking area update, or at the same time, the UE may further indicate pausing the sending of the short message by the short message service protocol stack/application on the UE.
<ul><li>S708: The MME originates registration to the MSC/VLR, and sends a location update request message (Location Update Request) to the MSC/VLR.</li><li>S709: The MSC/VLR establishes the context of the UE, assigns the TMSI for the UE, and sends a location update accept message (Location Update Accept) to the MME.</li><li>S710: The MME sends a tracking area accept (Tracking Area Accept) message or an attach accept (Attach Accept) message to the UE.</li><li>S711: The UE may send a tracking area complete (Tracking Area Complete) message or an attach complete (Attach Complete) message to the MME.</li></ul></p><p id="p0071" num="0071">After receiving the accept message of S710, the UE may instruct the short message service protocol stack/application on the UE to resend the short message.
<ul><li>S712: After receiving the complete message in the S711, the MME sends a TMSI reallocation (TMSI Reallocation Complete) message to the MSC/VLR.</li><li>S713: The UE encapsulates the short message, which needs to be sent, into an uplink NAS transport<!-- EPO <DP n="22"> --> (Uplink NAS Transport) message and sends the message to the MME.</li><li>S714: The MME encapsulates the received short message into an uplink data transport (Uplink Unitdata) message and sends the message to the MSC/VLR.</li><li>S715: The MSC/VLR sends the received short message to an SMS-IWMSC.</li><li>S716: The SMS-IWMSC sends the received short message to the short message service center SC.</li><li>S717: The short message service center SC sends a short message delivery report (delivery report) to the SMS-IWMSC.</li><li>S718: The SMS-IWMSC sends the short message delivery report (delivery report) to the MSC/VLR.</li><li>S719: The MSC/VLR sends a short message determining message to the MME.</li><li>S720: The MME sends the short message determining message to the UE.</li><li>S721: After receiving the short message delivery report (delivery report) of S718, the MSC/VLR encapsulates the received short message delivery report into a downlink data transport (Downlink Unitdata) message and sends the message to the MME.</li><li>S722: The MME encapsulates the short message delivery report into a downlink NAS transport (Downlink NAS Transport) message and sends the message to the UE.</li><li>S723: The UE determines that the short message delivery report is received, and encapsulates a determining result into an uplink NAS transport (Uplink NAS Transport) message and sends the message to the MME.</li><li>S724: The MME encapsulates the received determining result into an uplink data transport (Uplink Unitdata) message and sends the message to the MSC/VLR.</li><li>5725: The MSC/VLR sends a release request (Release Request) message to the MME to finish the short message sending process.</li></ul></p><p id="p0072" num="0072">It should be understood that the magnitude of serial numbers of the procedure described above does not mean the execution sequence, the execution sequence of the procedure should be determined by the function and the internal logic, and the implementing procedure of the embodiment of the present invention should not be restricted. For example, the S719 does not have a time sequence relation with S714 to S717, and S719 may be sent before, after or at the same time with S714. According to the method for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a<!-- EPO <DP n="23"> --> self-recovery capability of a network, saving network resources, and improving the user experience. In the following, an apparatus for receiving or sending a short message according to an embodiment of the present invention is described in detail with reference to <figref idrefs="f0006 f0007">FIG. 8 to FIG. 11</figref>.</p><p id="p0073" num="0073"><figref idrefs="f0006">FIG. 8</figref> shows a schematic block diagram of an apparatus for receiving or sending the short message according to an embodiment of the present invention. As shown in <figref idrefs="f0006">FIG. 8</figref>, the apparatus 800 includes:
<ul><li>a receiving module 810, configured to receive a first message sent by an MSC/VLR;</li><li>a first determining module 820, configured to determine that a user equipment is in an abnormal state according to the first message; and</li><li>a sending module 830, configured to send a second message to the user equipment, where the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</li></ul></p><p id="p0074" num="0074">According to the apparatus for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. Optionally, as shown in <figref idrefs="f0006">FIG. 9A</figref>, an apparatus 800 for receiving or sending a short message according to the embodiment of the present invention further includes:
<ul><li>a second determining module 840, configured to determine that the user equipment is in an idle state when the first message is a first paging message; and</li><li>the sending module 830 is specifically configured to send a second paging message to the user equipment, where the second paging message instructing the user equipment to initiate attachment to the MSC/VLR.</li></ul></p><p id="p0075" num="0075">Optionally, as shown in <figref idrefs="f0006">FIG. 9B</figref>, the apparatus 800 further includes:
<ul><li>a third determining module 850, configured to determine that the user equipment is in a connected state when the first message is the first paging message and before the sending module sends the second paging message.</li></ul></p><p id="p0076" num="0076">The apparatus 800 for sending a short message according to the embodiment of the present invention may correspond to the mobile management device in the embodiments of the present invention, and the abovementioned and other operations and/or functions of the modules in the apparatus 800 are used to implement corresponding processes of the method 100 to the method 300 in <figref idrefs="f0001 f0002">FIG. 1 to FIG. 3</figref>, which are not described herein again for briefness.<!-- EPO <DP n="24"> --></p><p id="p0077" num="0077">According to the apparatus for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. <figref idrefs="f0007">FIG. 10</figref> shows a schematic block diagram of an apparatus 900 for receiving or sending a short message according to an embodiment of the present invention. As shown in <figref idrefs="f0007">FIG. 10</figref>, the apparatus 900 includes:
<ul><li>a receiving module 910, configured to receive a second message sent by a mobile management device, where the second message is used to instruct the device needs to initiate attachment to a mobile switch center MSC/visitor location register VLR; and</li><li>a first sending module 920, configured to send a third message to the mobile management device according to the second message, so as to initiate the attachment to the MSC/VLR.</li></ul></p><p id="p0078" num="0078">According to the apparatus for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. Optionally, as shown in <figref idrefs="f0007">FIG. 11</figref>, the apparatus 900 for receiving or sending a short message according to the embodiment of the present invention further includes:
<ul><li>a second sending module 930, configured to send a fourth message responding to the second message to the mobile management device after the receiving module receives the second message.</li></ul></p><p id="p0079" num="0079">Optionally, as shown in <figref idrefs="f0007">FIG. 11</figref>, the apparatus 900 further includes:
<ul><li>a third sending module 940, configured to send a pause indicator to a short message service protocol stack or an application on the apparatus, where the pause indicator is used to indicate pausing the sending of the short message.</li></ul></p><p id="p0080" num="0080">Optionally, as shown in <figref idrefs="f0007">FIG. 11</figref>, the apparatus 900 further includes:
<ul><li>a fourth sending module 950, configured to send a resend indicator to the short message service protocol stack or the application on the apparatus after the message responding to the third message sent by the mobile management device is received, where the resend indicator is used to indicate<!-- EPO <DP n="25"> --> restarting the sending of the short message.</li></ul></p><p id="p0081" num="0081">The apparatus 900 for sending a short message according to the embodiment of the present invention may correspond to the user equipment in the embodiments of the present invention, and the abovementioned and other operations and/or functions of the modules in the apparatus 900 are to implement corresponding processes of the method 400 to method 500 in <figref idrefs="f0002 f0003">FIG. 4 to FIG. 5</figref>, which is not described herein again for briefness.</p><p id="p0082" num="0082">According to the apparatus for receiving or sending a short message provided by the embodiment of the present invention, information of instructing the user equipment to initiate attachment to the MSC/VLR is sent to the user equipment, so that the context of the user equipment can be established on the MSC/VLR, thereby solving the problem that the user equipment cannot receive or send a short message when the user equipment is in an abnormal state due to reasons such as a failure of the MSC/VLR, thereby achieving receiving or sending of a short message, increasing a self-recovery capability of a network, saving network resources, and improving the user experience. A person skilled in the art should appreciate that, in combination with the examples described in the embodiments herein, units and algorithm steps can be implemented by electronic hardware, computer software, or a combination thereof. To clearly describe the interchangeability between the hardware and the software, the foregoing has generally described compositions and steps of every embodiment according to functions. Whether the functions are executed by hardware or software depends on the particular applications and design constraint conditions of the technical solutions. Persons skilled in the art can use different methods to implement the described functions for every particular application, but it should not be considered that the implementation goes beyond the scope of the present invention.</p><p id="p0083" num="0083">It can be clearly understood by persons skilled in the art that, for the purpose of convenient and brief description, for a detailed working process of the foregoing system, apparatus and unit, reference may be made to the corresponding process in the method embodiments, and the details will not be described herein again.</p><p id="p0084" num="0084">In the embodiments provided in the present application, it should be understood that the disclosed system, apparatus and method may be implemented in other modes. For example, the described apparatus embodiments are merely exemplary. For example, the unit division is merely logical function division and can be other division in actual implementation. For example, multiple units or components can be combined or integrated into another system, or some features can be ignored or not performed. In addition, the displayed or discussed mutual couplings or direct couplings or communication connections are implemented through some interfaces. The indirect couplings or communication connections between the apparatuses or units may be implemented in electronic,<!-- EPO <DP n="26"> --> mechanical, or other forms.</p><p id="p0085" num="0085">The units described as separate parts may or may not be physically separate, and parts displayed as units may or may not be physical units, may be located in one position, or may be distributed on multiple network elements. A part or all of the units herein may be selected according to the actual needs to achieve the objectives of the solutions of the embodiments of the present invention.</p><p id="p0086" num="0086">In addition, functional units in the embodiments of the present invention may be integrated into a processing unit, or each of the units may exist alone physically, or two or more units may be integrated into a unit. The integrated unit may be implemented in a form of hardware, or may be implemented in a form of a software functional unit.</p><p id="p0087" num="0087">When is implemented in the form of a software functional unit and sold or used as a separate product, the integrated unit may be stored in a computer-readable storage medium. Based on such understanding, the technical solutions of the present invention essentially, or the part contributing to the prior art, or all or a part of the technical solutions may be implemented in a form of software product. The computer software product is stored in a storage medium and includes several instructions for instructing a computer device (which may be a personal computer, a server, or a network device, and the like) to execute all or a part of steps of the method described in the embodiments of the present invention. The storage medium includes: any medium that can store program codes, such as a U-disk, a removable hard disk, a read-only memory (ROM, Read-Only Memory), a random access memory (RAM, Random Access Memory), a magnetic disk, or an optical disk.</p><p id="p0088" num="0088">The foregoing descriptions are merely some embodiments of the present invention, but not intended to limit the protection scope of the present invention. Any modification or replacement made by persons skilled in the art without departing from the technical scope disclosed by the present invention shall fall within the protection scope of the present invention. Therefore, the protection scope of the present invention shall be subject to the appended claims.</p></description><claims mxw-id="PCLM56976077" lang="EN" load-source="patent-office"><!-- EPO <DP n="27"> --><claim id="c-en-0001" num="0001"><claim-text>A method for receiving or sending a short message, comprising:
<claim-text>receiving a first message sent by a mobile switch center MSC/visitor location register VLR;</claim-text>
<claim-text>determining that a user equipment is in an abnormal state according to the first message; and</claim-text>
<claim-text>sending a second message to the user equipment, wherein the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein the first message is a first paging message, and the determining that the user equipment is in the abnormal state according to the first message comprises:
<claim-text>determining that the user equipment is in the abnormal state according to that the first paging message does not comprise a location area identity LAI or does not comprise a temporary mobile subscriber identity TMSI of the user equipment.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 2, further comprising:
<claim-text>determining that the user equipment is in an idle state, and</claim-text>
<claim-text>the sending the second message to the user equipment comprises:
<claim-text>sending a second paging message to the user equipment, wherein the second paging message instruct the user equipment to initiate the attachment to the MSC/VLR.</claim-text></claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to claim 3, wherein a paging type or a paging cause value of the second paging message is used to instruct the user equipment to initiate the attachment to the MSC/VLR.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to claim 3, wherein the second paging message comprises a combination of a user equipment identity and a core network domain identity, and the combination of the user equipment identity and the core network domain identity is used to instruct the user equipment to initiate the attachment to the MSC/VLR.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method according to claim 2, wherein before the sending the second message to the user equipment, the method further comprises:
<claim-text>determining that the user equipment is in a connected state.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method according to claim 1, wherein the first message is a release request message, and<br/>
the determining that the user equipment is in the abnormal state according to the first message comprises:
<claim-text>determining that the user equipment is in the abnormal state according to that an international<!-- EPO <DP n="28"> --> mobile subscriber identification number IMSI of the user equipment is unknown or IMSI detach of the user equipment indicated by a cause value of the release request message.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method according to claim 6 or 7, wherein the second message is a detach request message, and a detach type of the detach request message or a cause value comprised in the detach request message is used to instruct the user equipment to initiate the attachment to the MSC/VLR.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method according to claim 6 or 7, wherein the second message is a notification message or a circuit switched CS service notification message, and the notification message or the CS service notification message comprises information of instructing the user equipment to initiate the attachment to the MSC/VLR.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The method according to claim 6 or 7, wherein the second message is a notification message or a CS service notification message, and a type of the notification message or the CS service notification message or a cause value comprised in the notification message or the CS service notification message is used to instruct the user equipment to initiate the attachment to the MSC/VLR.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The method according to claim 1, wherein after the sending the second message to the user equipment, the method further comprises:
<claim-text>sending, by the user equipment, a pause indicator to a short message service protocol stack or an application on the user equipment, wherein the pause indicator is used to instruct to pause the sending of the short message.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The method according to claim 11, further comprising: after the user equipment receives a message responding to a third message sent by a mobile management device, the user equipment sends a resend indicator to the short message service protocol stack or the application on the user equipment, wherein the resend indicator is used to instruct to restart the sending of the short message.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>An apparatus for receiving or sending a short message, comprising:
<claim-text>a receiving module, configured to receive a first message sent by a mobile switch center MSC/visitor location register VLR;</claim-text>
<claim-text>a first determining module, configured to determine that a user equipment is in an abnormal state according to the first message; and</claim-text>
<claim-text>a sending module, configured to send a second message to the user equipment, wherein the second message is used to instruct the user equipment to initiate attachment to the MSC/VLR.</claim-text></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The apparatus according to claim 13, further comprising:
<claim-text>a second determining module, configured to determine that the user equipment is in an idle state when the first message is a first paging message; and<!-- EPO <DP n="29"> --></claim-text>
<claim-text>wherein the sending module is further configured to send a second paging message to the user equipment and the second paging message instructing the user equipment to initiate the attachment to the MSC/VLR.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The apparatus according to claim 13, further comprising:
<claim-text>a third determining module, configured to determine that the user equipment is in a connected state when the first message is a first paging message and before the sending module sends the second message.</claim-text></claim-text></claim><claim id="c-en-0016" num="0016"><claim-text>An apparatus for receiving or sending a short message, comprising:
<claim-text>a receiving module, configured to receive a second message sent by a mobile management device, wherein the second message is used to instruct the apparatus to initiate attachment to a mobile switch center MSC/visitor location register VLR; and</claim-text>
<claim-text>a first sending module, configured to send a third message to the mobile management device according to the second message, to initiate the attachment to the MSC/VLR.</claim-text></claim-text></claim><claim id="c-en-0017" num="0017"><claim-text>The apparatus according to claim 16, further comprising:
<claim-text>a sending module, configured to send a fourth message responding to the second message to the mobile management device after the receiving module receives the second message.</claim-text></claim-text></claim><claim id="c-en-0018" num="0018"><claim-text>The apparatus according to claim 16, further comprising:
<claim-text>a third sending module, configured to send a pause indicator to a short message service protocol stack or an application on the apparatus, wherein the pause indicator is used to instruct to pause the sending of the short message.</claim-text></claim-text></claim><claim id="c-en-0019" num="0019"><claim-text>The apparatus according to claim 18, further comprising:
<claim-text>a fourth sending module, configured to send a resend indicator to the short message service protocol stack or the application on the apparatus after a message responding to the third message sent by the mobile management device is received, wherein the resend indicator is used to instruct to restart the sending of the short message.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16666862" load-source="patent-office"><!-- EPO <DP n="30"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="158" he="222" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="152" he="202" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0003" num="5"><img id="if0003" file="imgf0003.tif" wi="152" he="184" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0004" num="6"><img id="if0004" file="imgf0004.tif" wi="165" he="200" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0005" num="7"><img id="if0005" file="imgf0005.tif" wi="155" he="200" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0006" num="8,9A,9B"><img id="if0006" file="imgf0006.tif" wi="157" he="196" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0007" num="10,11"><img id="if0007" file="imgf0007.tif" wi="138" he="158" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
