<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680168-A2" country="EP" doc-number="2680168" kind="A2" date="20140101" family-id="48745595" file-reference-id="312918" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549462" ucid="EP-2680168-A2"><document-id><country>EP</country><doc-number>2680168</doc-number><kind>A2</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13003242-A" is-representative="YES"><document-id mxw-id="PAPP154823385" load-source="docdb" format="epo"><country>EP</country><doc-number>13003242</doc-number><kind>A</kind><date>20130625</date><lang>EN</lang></document-id><document-id mxw-id="PAPP212131039" load-source="docdb" format="original"><country>EP</country><doc-number>13003242.8</doc-number><date>20130625</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140446395" ucid="US-201213532640-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201213532640</doc-number><kind>A</kind><date>20120625</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL2107022718" load-source="docdb">G06F  17/30        20060101AFI20140814BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1852739842" load-source="docdb" scheme="CPC">G06F  17/30598     20130101 FI20170128BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1852739843" load-source="docdb" scheme="CPC">G06F  17/30315     20130101 LI20170126BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1852739844" load-source="docdb" scheme="CPC">G06F  17/30241     20130101 LI20170128BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1916235580" load-source="docdb" scheme="CPC">G06F  17/3053      20130101 LI20160721BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180870" lang="DE" load-source="patent-office">Spaltenweise K-nächster-Nachbar-Bereichsanfragen</invention-title><invention-title mxw-id="PT132180871" lang="EN" load-source="patent-office">Columnwise range K-nearest neighbors search queries</invention-title><invention-title mxw-id="PT132180872" lang="FR" load-source="patent-office">Requêtes des K plus proches voisins d'une manière orientée en colonne</invention-title><citations><non-patent-citations><nplcit><text>None</text><sources><source mxw-id="PNPL45131090" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918173083" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SAP AG</last-name><address><country>DE</country></address></addressbook></applicant><applicant mxw-id="PPAR918144222" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SAP AG</last-name></addressbook></applicant><applicant mxw-id="PPAR918982465" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SAP AG</last-name><iid>100212555</iid><address><street>Dietmar-Hopp-Allee 16</street><city>69190 Walldorf</city><country>DE</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918146148" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>WEYERHAEUSER CHRISTOPH</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918159573" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>Weyerhaeuser, Christoph</last-name></addressbook></inventor><inventor mxw-id="PPAR918979574" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Weyerhaeuser, Christoph</last-name><address><street>c/o SAP AG, Global IP Group, Dietmar-Hopp-Allee 16,</street><city>69190 Walldorf</city><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918164942" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>MINDNICH TOBIAS</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918172922" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>Mindnich, Tobias</last-name></addressbook></inventor><inventor mxw-id="PPAR918988956" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>Mindnich, Tobias</last-name><address><street>c/o SAP AG, Global IP Group, Dietmar-Hopp-Allee 16,</street><city>69190 Walldorf</city><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918134647" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>BAEUMGES DANIEL</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918156537" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>Baeumges, Daniel</last-name></addressbook></inventor><inventor mxw-id="PPAR918986514" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>Baeumges, Daniel</last-name><address><street>c/o SAP AG, Global IP Group, Dietmar-Hopp-Allee 16,</street><city>69190 Walldorf</city><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918171471" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>KAZMAIER GERRIT SIMON</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918172838" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>KAZMAIER, GERRIT SIMON</last-name></addressbook></inventor><inventor mxw-id="PPAR918978743" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>KAZMAIER, GERRIT SIMON</last-name><address><street>c/o SAP AG, Global IP Group, Dietmar-Hopp-Allee 16,</street><city>69190 Walldorf</city><country>DE</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918984739" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Müller-Boré &amp; Partner Patentanwälte</last-name><iid>100060440</iid><address><street>Grafinger Strasse 2</street><city>81671 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548863542" load-source="docdb">AL</country><country mxw-id="DS548882214" load-source="docdb">AT</country><country mxw-id="DS548863544" load-source="docdb">BE</country><country mxw-id="DS548805098" load-source="docdb">BG</country><country mxw-id="DS548896074" load-source="docdb">CH</country><country mxw-id="DS548842426" load-source="docdb">CY</country><country mxw-id="DS548882215" load-source="docdb">CZ</country><country mxw-id="DS548863545" load-source="docdb">DE</country><country mxw-id="DS548842427" load-source="docdb">DK</country><country mxw-id="DS548842428" load-source="docdb">EE</country><country mxw-id="DS548870022" load-source="docdb">ES</country><country mxw-id="DS548805099" load-source="docdb">FI</country><country mxw-id="DS548805100" load-source="docdb">FR</country><country mxw-id="DS548863546" load-source="docdb">GB</country><country mxw-id="DS548842429" load-source="docdb">GR</country><country mxw-id="DS548863547" load-source="docdb">HR</country><country mxw-id="DS548882220" load-source="docdb">HU</country><country mxw-id="DS548896075" load-source="docdb">IE</country><country mxw-id="DS548863548" load-source="docdb">IS</country><country mxw-id="DS548805101" load-source="docdb">IT</country><country mxw-id="DS548842430" load-source="docdb">LI</country><country mxw-id="DS548866988" load-source="docdb">LT</country><country mxw-id="DS548882221" load-source="docdb">LU</country><country mxw-id="DS548866989" load-source="docdb">LV</country><country mxw-id="DS548866990" load-source="docdb">MC</country><country mxw-id="DS548805148" load-source="docdb">MK</country><country mxw-id="DS548805149" load-source="docdb">MT</country><country mxw-id="DS548863549" load-source="docdb">NL</country><country mxw-id="DS548805102" load-source="docdb">NO</country><country mxw-id="DS548866992" load-source="docdb">PL</country><country mxw-id="DS548896076" load-source="docdb">PT</country><country mxw-id="DS548863550" load-source="docdb">RO</country><country mxw-id="DS548896077" load-source="docdb">RS</country><country mxw-id="DS548863551" load-source="docdb">SE</country><country mxw-id="DS548896082" load-source="docdb">SI</country><country mxw-id="DS548805103" load-source="docdb">SK</country><country mxw-id="DS548866993" load-source="docdb">SM</country><country mxw-id="DS548842431" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128670131" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A range k-nearest neighbor search query of a database is processed by first defining an inner rectangle bounded within a circle around a center point specified by the range k-nearest neighbor search query. Thereafter, a distance to the center point is calculated for each point within the inner rectangle. Query results are returned if k or more points are within the inner rectangle. Otherwise, at least one additional query is executed. Related apparatus, systems, techniques and articles are also described.
<img id="iaf01" file="imgaf001.tif" wi="102" he="97" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499504" lang="EN" source="EPO" load-source="docdb"><p>A range k-nearest neighbor search query of a database is processed by first defining an inner rectangle bounded within a circle around a center point specified by the range k-nearest neighbor search query. Thereafter, a distance to the center point is calculated for each point within the inner rectangle. Query results are returned if k or more points are within the inner rectangle. Otherwise, at least one additional query is executed. Related apparatus, systems, techniques and articles are also described.</p></abstract><description mxw-id="PDES63955561" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">The current subject matter is directed to range k-nearest neighbor searching of point data stored columnwise storage in a data source such as a column oriented database.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">Geographic information systems (GIS), sometimes referred to as spatial information systems (SIS), are specialized information systems to capture, modeling, storage, retrieval, sharing, manipulation, analysis and presentation of spatial data. The main entities are spatial objects. The spatial component may embody both geometry (location, shape etc.) and topology (spatial relationships such as adjacency). The special traits of a geometric object differs significantly from any standard type, such as integers and strings.</p><p id="p0003" num="0003">For a range k-nearest neighbor query a center point (C), consisting of the X (C<sub>X</sub>) and Y (C<sub>Y</sub>) coordinate, is provided, the radius (R) is and the number of requested points (K). The result is a list of k or less than k points ordered by the minimal distance to C. For the processing all points have to be considered, and for all points the distance to C has to be calculated. With an increasing number of points the processing consumes more resources (and requires a longer amount of time to complete).</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0004" num="0004">In one aspect, a range k-nearest neighbor search query of a database is processed by first defining an inner rectangle bounded within a circle around a center<!-- EPO <DP n="2"> --> point specified by the range k-nearest neighbor search query. Thereafter, a distance to the center point is calculated for each point within the inner rectangle. Query results are returned if k or more points are within the inner rectangle. Otherwise, at least one additional query is executed.</p><p id="p0005" num="0005">Each point can be sorted according to their calculated distances such that the returned query results are presented according to the sorting.</p><p id="p0006" num="0006">In those cases in which the inner rectangle includes less than k point, a maximum bounding rectangle can be calculated that includes the circle if there are less than k points in the inner rectangle. A first query can then be executed using the inner rectangle and a bit vector can be generated that indicates indexes of all points in the first query. Thereafter, a second query can be generated and executed using the maximum bounding rectangle and the bit vector. In this case, the bit vector is used to skip those points retrieved by the first query. Subsequently, results are returned based on the first query and the second query.</p><p id="p0007" num="0007">A value of 1 at an index position in the bit vector can indicate that the corresponding point was retrieved by the first query. The results of the second query can be sorted according to distance from the center point. The returned query results can include only those results from the second query that, in combination with the results from the first query, are equal to or less than k.</p><p id="p0008" num="0008">In some implementations, results from the second query can be condensed. The results can be condensed by identifying minimal and maximal bounds relative to the center point, generating a second bit vector that identifies points outside<!-- EPO <DP n="3"> --> the minimal and maximal bounds, and accessing the second bit vector to determine a distance to the center point for only those points within the minimal and maximal bounds.</p><p id="p0009" num="0009">Non-transitory computer program products are also described that store instructions, which when executed, cause one or more data processors across one or more computing systems to implement various operations described herein. Similarly, computer systems are also described that may include at least one data processor and a memory coupled to the at least one data processor. The memory may temporarily or permanently store one or more programs that cause the at least one data processor to perform one or more of the operations described herein. In addition, operations specified by methods can be implemented by one or more data processors either within a single computing system or distributed among two or more computing systems.</p><p id="p0010" num="0010">The subject matter described herein provides many advantages. For example, the current subject matter reduces the number of calculated distances by reducing the list of points that has to be considered for a query. In particular, the current subject matter is advantageous in that the amount of points for which the distance to the center point has to be calculated can be reduced. In addition, an optimistic approach can be utilized that starts with a subset of points and that can extend such set of points if less than range k-nearest neighbors are found. Further, the current subject matter takes advantage of columnwise storage of points (one column for X values and one column for Y values of the points) for improved processing times.</p><p id="p0011" num="0011">The details of one or more variations of the subject matter described herein are set forth in the accompanying drawings and the description below. Other<!-- EPO <DP n="4"> --> features and advantages of the subject matter described herein will be apparent from the description and drawings, and from the claims.</p><heading id="h0004"><b>DESCRIPTION OF DRAWINGS</b></heading><p id="p0012" num="0012"><figref idrefs="f0001">FIG. 1</figref> is a diagram illustrating a system including a data storage application;</p><p id="p0013" num="0013"><figref idrefs="f0002">FIG. 2</figref> is a diagram illustrating details of the system of <figref idrefs="f0001">FIG. 1</figref>;</p><p id="p0014" num="0014"><figref idrefs="f0003">FIG. 3</figref> is a first process flow diagram illustrating returning results of a range k-nearest neighbor query;</p><p id="p0015" num="0015"><figref idrefs="f0004">FIG. 4</figref> is a diagram illustrating points with an inner rectangle and an maximum bounding rectangle in relation to a center point; and</p><p id="p0016" num="0016"><figref idrefs="f0005">FIG. 5</figref> is a second process flow diagram illustrating returning results of a range k-nearest neighbor query.</p><heading id="h0005"><b>DETAILED DESCRIPTION</b></heading><p id="p0017" num="0017"><figref idrefs="f0001">FIG. 1</figref> shows an example of a system 100 in which a computing system 102, which can include one or more programmable processors that can be collocated, linked over one or more networks, etc., executes one or more modules, software components, or the like of a data storage application 104. The data storage application 104 can include one or more of a database, an enterprise resource program, a distributed storage system (e.g. NetApp Filer available from NetApp of Sunnyvale, CA), or the like.</p><p id="p0018" num="0018">The one or more modules, software components, or the like can be accessible to local users of the computing system 102 as well as to remote users<!-- EPO <DP n="5"> --> accessing the computing system 102 from one or more client machines 106 over a network connection 110. One or more user interface screens produced by the one or more first modules can be displayed to a user, either via a local display or via a display associated with one of the client machines 106. Data units of the data storage application 104 can be transiently stored in a persistence layer 112 (e.g. a page buffer or other type of temporary persistency layer), which can write the data, in the form of storage pages, to one or more storages 114, for example via an input/output component 116. The one or more storages 114 can include one or more physical storage media or devices (e.g. hard disk drives, persistent flash memory, random access memory, optical media, magnetic media, and the like) configured for writing data for longer term storage. It should be noted that the storage 114 and the input/output component 116 can be included in the computing system 102 despite their being shown as external to the computing system 102 in <figref idrefs="f0001">FIG. 1</figref>.</p><p id="p0019" num="0019">Data retained at the longer term storage 114 can be organized in pages, each of which has allocated to it a defined amount of storage space. In some implementations, the amount of storage space allocated to each page can be constant and fixed. However, other implementations in which the amount of storage space allocated to each page can vary are also within the scope of the current subject matter.</p><p id="p0020" num="0020"><figref idrefs="f0002">FIG. 2</figref> shows a software architecture 200 consistent with one or more features of the current subject matter. A data storage application 104, which can be implemented in one or more of hardware and software, can include one or more of a database application, a network-attached storage system, or the like. According to at least some implementations of the current subject matter, such a data storage application<!-- EPO <DP n="6"> --> 104 can include or otherwise interface with a persistence layer 112 or other type of memory buffer, for example via a persistence interface 202. A page buffer 204 within the persistence layer 112 can store one or more logical pages 206, and optionally can include shadow pages 211, active pages 213, data pages of virtual files 215 (i.e., a data objects acting like a file) and the like. The logical pages 206 retained in the persistence layer 112 can be written to a storage (e.g. a longer term storage, etc.) 114 via an input/output component 116, which can be a software module, a sub-system implemented in one or more of software and hardware, or the like. The storage 114 can include one or more data volumes 210 where stored pages 212 are allocated at physical memory blocks.</p><p id="p0021" num="0021">In some implementations, the data storage application 104 can include a row store 203 and a column store 205. The row store 203 can comprise or be otherwise in communication with a page manager 214 and/or a savepoint manager 216. The page manager 214 can communicate with a page management module 220 at the persistence layer 112 that can include a free block manager 222 that monitors page status information 224, for example the status of physical pages within the storage 114 and logical pages in the persistence layer 112 (and optionally in the page buffer 204). The savepoint manager 216 can communicate with a savepoint coordinator 226 at the persistence layer 204 to handle savepoints, which are used to create a consistent persistent state of the database for restart after a possible crash. The row store 203 can access the persistence interface 202 via an absolute page API 207. The column store 205 which can store columns in contiguous memory can access the persistence interface 202 via a virtual file API 209.</p><p id="p0022" num="0022">In some implementations of a data storage application 104, the page management module of the persistence layer 112 can implement shadow paging. The<!-- EPO <DP n="7"> --> free block manager 222 within the page management module 220 can maintain the status of physical pages. The page buffer 204 can included a fixed page status buffer that operates as discussed herein. A converter component 240, which can be part of or in communication with the page management module 220, can be responsible for mapping between logical and physical pages written to the storage 114. The converter 240 can maintain the current mapping of logical pages to the corresponding physical pages in a converter table 242. The converter 240 can maintain a current mapping of logical pages 206 to the corresponding physical pages in one or more converter tables 242. When a logical page 206 is read from storage 114, the storage page to be loaded can be looked up from the one or more converter tables 242 using the converter 240. When a logical page is written to storage 114 the first time after a savepoint, a new free physical page is assigned to the logical page. The free block manager 222 marks the new physical page as "used" and the new mapping is stored in the one or more converter tables 242.</p><p id="p0023" num="0023">The persistence layer 112 can ensure that changes made in the data storage application 104 are durable and that the data storage application 104 can be restored to a most recent committed state after a restart. Writing data to the storage 114 need not be synchronized with the end of the writing transaction. As such, uncommitted changes can be written to disk and committed changes may not yet be written to disk when a writing transaction is finished. After a system crash, changes made by transactions that were not finished can be rolled back. Changes occurring by already committed transactions should not be lost in this process. A logger component 244 can also be included to store the changes made to the data of the data storage application in a linear log. The logger component 244 can be used during recovery to replay operations<!-- EPO <DP n="8"> --> since a last savepoint to ensure that all operations are applied to the data and that transactions with a logged "commit" record are committed before rolling back still-open transactions at the end of a recovery process.</p><p id="p0024" num="0024">With some data storage applications, writing data to a disk is not necessarily synchronized with the end of the writing transaction. Situations can occur in which uncommitted changes are written to disk and while, at the same time, committed changes are not yet written to disk when the writing transaction is finished. After a system crash, changes made by transactions that were not finished must be rolled back and changes by committed transaction must not be lost.</p><p id="p0025" num="0025">To ensure that committed changes are not lost, redo log information can be written by the logger component 244 whenever a change is made. This information can be written to disk at latest when the transaction ends. The log entries can be persisted in separate log volumes 217 while normal data is written to data volumes 210. With a redo log, committed changes can be restored even if the corresponding data pages were not written to disk. For undoing uncommitted changes, the persistence layer 112 can use a combination of undo log entries (from one or more logs) and shadow paging.</p><p id="p0026" num="0026">The persistence interface 202 can handle read and write requests of stores (e.g., in-memory stores, etc.). The persistence interface 202 can also provide write methods for writing data both with logging and without logging. If the logged write operations are used, the persistence interface 202 invokes the logger 244. In addition, the logger 244 provides an interface that allows stores (e.g., in-memory stores, etc.) to<!-- EPO <DP n="9"> --> directly add log entries into a log queue. The logger interface also provides methods to request that log entries in the in-memory log queue are flushed to disk.</p><p id="p0027" num="0027">Log entries contain a log sequence number, the type of the log entry and the identifier of the transaction. Depending on the operation type additional information is logged by the logger 244. For an entry of type "update", for example, this would be the identification of the affected record and the after image of the modified data.</p><p id="p0028" num="0028">When the data application 104 is restarted, the log entries need to be processed. To speed up this process the redo log is not always processed from the beginning. Instead, as stated above, savepoints can be periodically performed that write all changes to disk that were made (e.g., in memory, etc.) since the last savepoint. When starting up the system, only the logs created after the last savepoint need to be processed. After the next backup operation the old log entries before the savepoint position can be removed.</p><p id="p0029" num="0029">When the logger 244 is invoked for writing log entries, it does not immediately write to disk. Instead it can put the log entries into a log queue in memory. The entries in the log queue can be written to disk at the latest when the corresponding transaction is finished (committed or aborted). To guarantee that the committed changes are not lost, the commit operation is not successfully finished before the corresponding log entries are flushed to disk. Writing log queue entries to disk can also be triggered by other events, for example when log queue pages are full or when a savepoint is performed.<!-- EPO <DP n="10"> --></p><p id="p0030" num="0030">The column store 205 can store its tables to virtual files provided by the persistence layer 112 via the virtual file API 207. Internally the persistence layer 112 can map a virtual file to a chain of linked pages 215 stored in the page buffer 204. Data belonging to one columnar table can be stored in multiple virtual files: one virtual file per column for a main storage and one virtual file for a delta log. In addition, one virtual file can optionally be stored per column for the main storage of the history part of the table, and/or one virtual file can optionally be stored per table for the delta of the history part of the table. The persistence layer 112 can maintain a directory that stores for each virtual file the start page and additional information such as the size and the type of the virtual file.</p><p id="p0031" num="0031">With reference to the process flow diagram 300 of <figref idrefs="f0003">FIG. 3</figref>, a range k-nearest neighbor search query 310 can be split into first and second rectangle search queries 320, 330. In good cases, only the first rectangle search query 320 needs to be performed and the range k-nearest neighbor query can be answered, at 340, based in these results. In bad cases, the second rectangle search query 330 can be required, however, this second query can be reduced to a delta query. Afterwards the result set can be condensed, at 350, by exploiting the way how the points are stored in a column oriented database before the distances are calculated. Combining these optimizations can provide significant performance gains even on very big data sets.</p><p id="p0032" num="0032">With reference to the diagram 400 of <figref idrefs="f0004">FIG. 4</figref> and the process flow diagram 500 of <figref idrefs="f0004">FIG. 4</figref>, at 505, an inner rectangle (420) of a circle (410) that is described by a center point and a radius of a range k-nearest neighbor query is calculated. A first query is then executed at 510 that identifies results within the inner rectangle (420). For<!-- EPO <DP n="11"> --> the points that are included in this inner rectangle (420), at 515, the distance to the center point is calculated and, at 530, the points are sorted by the distance. If k or more than k points are in that inner rectangle (420), at 520, the sorted list is cut after the k-th entry and returned, at 525, as query result. If less than k points, at 530, are in the inner rectangle (420), at 535, the maximum bounding rectangle (MBR) (430) including the whole circle (410) (described by the center point and the radius) is calculated.</p><p id="p0033" num="0033">From the first search query, a bit vector is built, at 540, that indicates the indexes of the points that are returned by the first query. The MBR (430) together with the bit vector are used for a second query which, at 545, will return all points that are inside the MBR (430) whereby all points are skipped by default that are marked in the bit vector [a 1 at an index position in the bit vector indicates that the point was retrieved by the first search query]. This speeds up the second query and reduces the number of results by avoiding duplicate results. For the resulting points, the distance to the center point is calculated and the list is sorted by this distance. Lets assume query one returns R1 results and R1 is less than k so E2 = k - R1 results are missing. This means that the list of results of query two (R2) can be cut after the E2-th value and just appended to the result of query 1.</p><p id="p0034" num="0034">Furthermore the results from the MBR (430) search (the second query) can be condensed, at 550, before calculating the distances and sorting the results according to the distances (at 555). The result of the first rectangle search are two columns (X and Y) representing the points within the corresponding inner rectangle (420) plus an additional column holding the index of each result point in the corresponding base database table (that holds all points). The rectangle search itself is implemented in a<!-- EPO <DP n="12"> --> base building block in a low-level part within the database. To further condense the result R2 before calculating the distances , the minimum and maximum X value can be computed that a point has so that the point is still in the radius around the center point which is X<sub>min</sub> = C<sub>X</sub> - R and X<sub>max</sub> = C<sub>X</sub> + R. In a scan over all values (which is unexpensive from a resource point of view in a column oriented database) all points in R2 are marked as non-matching in a separate bit vector that have a greater X value than X<sub>max</sub> or a lower X value than X<sub>min</sub>. Afterwards, only for the remaining points the distance to the center point has to be calculated and compared to the radius. This reduction of results of the second query can also be done on the Y column (Y<sub>min</sub> = C<sub>Y</sub> - R resp. Y<sub>max</sub> = C<sub>Y</sub> + R). Thereafter, up to k results (based on the sorted distances) can be returned (at 560).</p><p id="p0035" num="0035">Aspects of the subject matter described herein can be embodied in systems, apparatus, methods, and/or articles depending on the desired configuration. In particular, various implementations of the subject matter described herein can be realized in digital electronic circuitry, integrated circuitry, specially designed application specific integrated circuits (ASICs), computer hardware, firmware, software, and/or combinations thereof. These various implementations can include implementation in one or more computer programs that are executable and/or interpretable on a programmable system including at least one programmable processor, which can be special or general purpose, coupled to receive data and instructions from, and to transmit data and instructions to, a storage system, at least one input device, and at least one output device.</p><p id="p0036" num="0036">These computer programs, which can also be referred to programs, software, software applications, applications, components, or code, include machine<!-- EPO <DP n="13"> --> instructions for a programmable processor, and can be implemented in a high-level procedural and/or object-oriented programming language, and/or in assembly/machine language. As used herein, the term "machine-readable medium" refers to any computer program product, apparatus and/or device, such as for example magnetic discs, optical disks, memory, and Programmable Logic Devices (PLDs), used to provide machine instructions and/or data to a programmable processor, including a machine-readable medium that receives machine instructions as a machine-readable signal. The term "machine-readable signal" refers to any signal used to provide machine instructions and/or data to a programmable processor. The machine-readable medium can store such machine instructions non-transitorily, such as for example as would a non-transient solid state memory or a magnetic hard drive or any equivalent storage medium. The machine-readable medium can alternatively or additionally store such machine instructions in a transient manner, such as for example as would a processor cache or other random access memory associated with one or more physical processor cores.</p><p id="p0037" num="0037">To provide for interaction with a user, the subject matter described herein can be implemented on a computer having a display device, such as for example a cathode ray tube (CRT) or a liquid crystal display (LCD) monitor for displaying information to the user and a keyboard and a pointing device, such as for example a mouse or a trackball, by which the user may provide input to the computer. Other kinds of devices can be used to provide for interaction with a user as well. For example, feedback provided to the user can be any form of sensory feedback, such as for example visual feedback, auditory feedback, or tactile feedback; and input from the user may be received in any form, including, but not limited to, acoustic, speech, or tactile input.<!-- EPO <DP n="14"> --> Other possible input devices include, but are not limited to, touch screens or other touch-sensitive devices such as single or multi-point resistive or capacitive trackpads, voice recognition hardware and software, optical scanners, optical pointers, digital image capture devices and associated interpretation software, and the like.</p><p id="p0038" num="0038">The subject matter described herein can be implemented in a computing system that includes a back-end component, such as for example one or more data servers, or that includes a middleware component, such as for example one or more application servers, or that includes a front-end component, such as for example one or more client computers having a graphical user interface or a Web browser through which a user can interact with an implementation of the subject matter described herein, or any combination of such back-end, middleware, or front-end components. A client and server are generally, but not exclusively, remote from each other and typically interact through a communication network, although the components of the system can be interconnected by any form or medium of digital data communication. Examples of communication networks include, but are not limited to, a local area network ("LAN"), a wide area network ("WAN"), and the Internet. The relationship of client and server arises by virtue of computer programs running on the respective computers and having a client-server relationship to each other.</p><p id="p0039" num="0039">The implementations set forth in the foregoing description do not represent all implementations consistent with the subject matter described herein. Instead, they are merely some examples consistent with aspects related to the described subject matter. Although a few variations have been described in detail herein, other modifications or additions are possible. In particular, further features and/or variations<!-- EPO <DP n="15"> --> can be provided in addition to those set forth herein. For example, the implementations described above can be directed to various combinations and sub-combinations of the disclosed features and/or combinations and sub-combinations of one or more features further to those disclosed herein. In addition, the logic flows depicted in the accompanying figures and/or described herein do not necessarily require the particular order shown, or sequential order, to achieve desirable results. The scope of the following claims may include other implementations or embodiments.</p></description><claims mxw-id="PCLM56976479" lang="EN" load-source="patent-office"><!-- EPO <DP n="16"> --><claim id="c-en-0001" num="0001"><claim-text>A computer-implemented method for processing a range k-nearest neighbor search query of a database comprising:
<claim-text>defining an inner rectangle bounded within a circle around a center point specified by the range k-nearest neighbor search query;</claim-text>
<claim-text>calculating, for each point within the inner rectangle, a distance to the center point; and</claim-text>
<claim-text>returning query results if k or more points are within the inner rectangle;</claim-text>
<claim-text>otherwise, executing at least one additional query.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>Method according to claim 1, further comprising:
<claim-text>sorting each point according to their corresponding calculated distances, and</claim-text>
<claim-text>wherein the returned query results are presented according to the sorting.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>Method according to claim 1 or 2, wherein executing the at least one additional query comprises:
<claim-text>calculating a maximum bounding rectangle including the circle if there are less than k points in the inner rectangle;</claim-text>
<claim-text>executing a first query using the inner rectangle;</claim-text>
<claim-text>generating a bit vector that indicates indexes of all points in the first query;</claim-text>
<claim-text>generating and executing a second query using the maximum bounding rectangle and the bit vector, the bit vector being used to skip those points retrieved by the first query; and<!-- EPO <DP n="17"> --></claim-text>
<claim-text>returning results based on the first query and the second query.</claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>Method according to claim 3, wherein a value of 1 at an index position in the bit vector indicates that the corresponding point was retrieved by the first query.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>Method according to claim 4, further comprising:
<claim-text>sorting the results of the second query according to distance from the center point.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>Method according to any one of claims 3 to 5, wherein only those results from the second query that, in combination with the results from the first query, are equal to or less than k are returned.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>Method according to any one of claims 3 to 6, further comprising:
<claim-text>condensing results from the second query.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>Method according to claim 7, wherein condensing the results comprises:
<claim-text>identifying minimal and maximal bounds relative to the center point;</claim-text>
<claim-text>generating a second bit vector that identifies points outside the minimal and maximal bounds; and</claim-text>
<claim-text>accessing the second bit vector to determine a distance to the center point for only those points within the minimal and maximal bounds.</claim-text><!-- EPO <DP n="18"> --></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>A non-transitory computer program product storing instructions for processing a range k-nearest neighbor search query of a database which, when executed, result in performing a method according to any one of the preceding claims.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A system comprising:
<claim-text>at least one data processor;</claim-text>
<claim-text>memory storing instructions, which when executed, result in operations comprising:
<claim-text>defining an inner rectangle bounded within a circle around a center point specified by a range k-nearest neighbor search query;</claim-text>
<claim-text>calculating, for each point within the inner rectangle, a distance to the center point; and</claim-text>
<claim-text>returning query results if k or more points are within the inner rectangle;</claim-text>
<claim-text>otherwise, executing at least one additional query.</claim-text></claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>A system according to claim 10, wherein the operations further comprise:
<claim-text>sorting each point according to their corresponding calculated distances, and</claim-text>
<claim-text>wherein the returned query results are presented according to the sorting.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>A system according to claim 10 or 11, wherein executing the at least one additional query comprises:
<claim-text>calculating a maximum bounding rectangle including the circle if there are less than k points in the inner rectangle;<!-- EPO <DP n="19"> --></claim-text>
<claim-text>executing a first query using the inner rectangle;</claim-text>
<claim-text>generating a bit vector that indicates indexes of all points in the first query;</claim-text>
<claim-text>generating and executing a second query using the maximum bounding rectangle and the bit vector, the bit vector being used to skip those points retrieved by the first query; and</claim-text>
<claim-text>sorting the results of the second query according to distance from the center point;</claim-text>
<claim-text>returning results based on the first query and the second query;</claim-text>
<claim-text>wherein a value of 1 at an index position in the bit vector indicates that the corresponding point was retrieved by the first query.</claim-text></claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>A system according to claim 12, wherein the operations further comprise:
<claim-text>condensing results from the second query by:
<claim-text>identifying minimal and maximal bounds relative to the center point;</claim-text>
<claim-text>generating a second bit vector that identifies points outside the minimal and maximal bounds; and</claim-text>
<claim-text>accessing the second bit vector to determine a distance to the center point for only those points within the minimal and maximal bounds.</claim-text></claim-text></claim-text></claim></claims><drawings mxw-id="PDW16667259" load-source="patent-office"><!-- EPO <DP n="20"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="169" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="21"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="181" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="22"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="165" he="181" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="23"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="165" he="181" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="24"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="165" he="181" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
