<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2080403-B1" country="EP" doc-number="2080403" kind="B1" date="20140101" family-id="39172238" file-reference-id="297914" date-produced="20180822" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146554174" ucid="EP-2080403-B1"><document-id><country>EP</country><doc-number>2080403</doc-number><kind>B1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-07844110-A" is-representative="NO"><document-id mxw-id="PAPP154828097" load-source="docdb" format="epo"><country>EP</country><doc-number>07844110</doc-number><kind>A</kind><date>20071010</date><lang>EN</lang></document-id><document-id mxw-id="PAPP254928018" load-source="docdb" format="original"><country>EP</country><doc-number>07844110.2</doc-number><date>20071010</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140449000" ucid="US-2007080982-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>2007080982</doc-number><kind>W</kind><date>20071010</date></document-id></priority-claim><priority-claim mxw-id="PPC140450701" ucid="US-82890206-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>82890206</doc-number><kind>P</kind><date>20061010</date></document-id></priority-claim><priority-claim mxw-id="PPC140450680" ucid="US-86444806-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>86444806</doc-number><kind>P</kind><date>20061106</date></document-id></priority-claim><priority-claim mxw-id="PPC140453108" ucid="US-86969807-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>86969807</doc-number><kind>A</kind><date>20071009</date></document-id></priority-claim></priority-claims><dates-of-public-availability><intention-to-grant-date><date>20130717</date></intention-to-grant-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988099233" load-source="docdb">H04L  29/06        20060101ALN20130702BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1988108682" load-source="docdb">H04W  76/02        20090101ALN20130702BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1988119681" load-source="docdb">H04W   4/02        20090101AFI20130702BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1699703220" load-source="docdb" scheme="CPC">H04W  76/10        20180201 LA20180203BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2081707743" load-source="docdb" scheme="CPC">H04W   4/02        20130101 FI20150324BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2081710204" load-source="docdb" scheme="CPC">H04L  63/0869      20130101 LA20150324BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2081712784" load-source="docdb" scheme="CPC">H04L  63/166       20130101 LA20150324BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132195006" lang="DE" load-source="patent-office">REGISTRIERUNG EINES ENDGERÄTES MIT EINEM LOKALISIERUNGSSERVER ZUR LOKALISIERUNG EINER BENUTZEREBENE</invention-title><invention-title mxw-id="PT132195007" lang="EN" load-source="patent-office">REGISTRATION OF A TERMINAL WITH A LOCATION SERVER FOR USER PLANE LOCATION</invention-title><invention-title mxw-id="PT132195008" lang="FR" load-source="patent-office">ENREGISTREMENT D'UN TERMINAL AUPRÈS D'UN SERVEUR DE LOCALISATION POUR LA LOCALISATION DE PLAN UTILISATEUR</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918158442" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>QUALCOMM INC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR918167062" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>QUALCOMM INCORPORATED</last-name></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918166496" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>EDGE STEPHEN</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918149738" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>EDGE, STEPHEN</last-name></addressbook></inventor><inventor mxw-id="PPAR918999029" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>EDGE, STEPHEN</last-name><address><street>5775 Morehouse Drive</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918171687" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>WACHTER ANDREAS</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918172609" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>WACHTER, ANDREAS</last-name></addressbook></inventor><inventor mxw-id="PPAR918999030" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>WACHTER, ANDREAS</last-name><address><street>5775 Morehouse Drive</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></inventor></inventors><assignees><assignee mxw-id="PPAR918999031" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>QUALCOMM Incorporated</last-name><iid>100982753</iid><address><street>Attn: International IP Administration 5775 Morehouse Drive</street><city>San Diego, CA 92121</city><country>US</country></address></addressbook></assignee></assignees><agents><agent mxw-id="PPAR918999032" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Howe, Steven</last-name><iid>101254192</iid><address><street>Reddie &amp; Grose LLP 16 Theobalds Road</street><city>London WC1X 8PL</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="US-2007080982-W"><document-id><country>US</country><doc-number>2007080982</doc-number><kind>W</kind><date>20071010</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2008045957-A2"><document-id><country>WO</country><doc-number>2008045957</doc-number><kind>A2</kind><date>20080417</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548985233" load-source="docdb">AT</country><country mxw-id="DS548992657" load-source="docdb">BE</country><country mxw-id="DS548832305" load-source="docdb">BG</country><country mxw-id="DS548986258" load-source="docdb">CH</country><country mxw-id="DS548887559" load-source="docdb">CY</country><country mxw-id="DS548985234" load-source="docdb">CZ</country><country mxw-id="DS548992658" load-source="docdb">DE</country><country mxw-id="DS548887560" load-source="docdb">DK</country><country mxw-id="DS548887561" load-source="docdb">EE</country><country mxw-id="DS548988324" load-source="docdb">ES</country><country mxw-id="DS548832306" load-source="docdb">FI</country><country mxw-id="DS548832307" load-source="docdb">FR</country><country mxw-id="DS548992659" load-source="docdb">GB</country><country mxw-id="DS548887562" load-source="docdb">GR</country><country mxw-id="DS548985235" load-source="docdb">HU</country><country mxw-id="DS548986259" load-source="docdb">IE</country><country mxw-id="DS548887563" load-source="docdb">IS</country><country mxw-id="DS548832308" load-source="docdb">IT</country><country mxw-id="DS548887564" load-source="docdb">LI</country><country mxw-id="DS548991037" load-source="docdb">LT</country><country mxw-id="DS548875679" load-source="docdb">LU</country><country mxw-id="DS548991038" load-source="docdb">LV</country><country mxw-id="DS548991039" load-source="docdb">MC</country><country mxw-id="DS548875680" load-source="docdb">MT</country><country mxw-id="DS548992660" load-source="docdb">NL</country><country mxw-id="DS548991040" load-source="docdb">PL</country><country mxw-id="DS548986260" load-source="docdb">PT</country><country mxw-id="DS548992661" load-source="docdb">RO</country><country mxw-id="DS548991041" load-source="docdb">SE</country><country mxw-id="DS548988329" load-source="docdb">SI</country><country mxw-id="DS548832309" load-source="docdb">SK</country><country mxw-id="DS548887565" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><description mxw-id="PDES63957648" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>BACKGROUND</b></heading><heading id="h0002"><b>I. Field</b></heading><p id="p0001" num="0001">The present disclosure relates generally to communication, and more specifically to techniques for supporting location services (LCS) for a terminal.</p><heading id="h0003"><b>II. Background</b></heading><p id="p0002" num="0002">It is often desirable, and sometimes necessary, to know the location of a terminal, e.g., a cellular phone. The terms "location" and "position" are synonymous and are used interchangeably herein. For example, an LCS client may desire to know the location of the terminal and may communicate with a location server in order to request location information for the terminal. The location server may then send a message to the terminal to start a location session. This message may be properly delivered to the terminal based on routing information available for the terminal. The location server and the terminal may then exchange messages, as necessary, to obtain location information for the terminal. The location server may then return the requested location information to the LCS client.</p><p id="p0003" num="0003">For network-initiated location service as described above, the location server or some other network entity may need routing information for the terminal in order to send the initial message to the terminal. In certain operating scenarios, the routing information for the terminal may not be available due to various reasons, as described below. Nevertheless, it may be desirable to support network-initiated location services even in such scenarios.<!-- EPO <DP n="2"> --></p><heading id="h0004"><b>SUMMARY</b></heading><p id="p0004" num="0004">This invention concerns a system for communication according to claim 1, a method for wireless communication according to claim 10 and a computer program product according to claim 12. Further embodiments are defined in the dependent claims.</p><p id="p0005" num="0005">Techniques for supporting network-initiated location services for a terminal are described herein. A location server may be able to reach the terminal based on various messaging mechanisms. However, each mechanism may require the terminal to perform registration with a designated network entity so that routing information is available for the terminal. The location server may not be able to reach the terminal in a normal manner based on any of these messaging mechanisms in certain operating scenarios, as described below.</p><p id="p0006" num="0006">In an embodiment, the terminal performs registration with the location server if the terminal determines that the location server may not be able to reach the terminal in the normal manner. For example, the terminal may decide to perform registration if it obtains Internet Protocol (IP) connectivity via an access network that is not associated with a home network of the terminal. For the registration, the terminal may identify itself to the location server, instigate mutual authentication of the terminal and the location server, and provide an IP address of the terminal to the location server. The terminal may perform registration with the location server whenever the IP address changes and/or periodically whenever a timer expires. The terminal may set the timer based on a timer value received from the location server. The location server may use the IP address to send messages to the terminal for network-initiated location services.</p><p id="p0007" num="0007">Various aspects and features of the disclosure are described in further detail below.</p><heading id="h0005"><b>BRIEF DESCRIPTION OF THE DRAWINGS</b></heading><p id="p0008" num="0008"><figref idrefs="f0001">FIGS. 1A</figref> and <figref idrefs="f0003">2B</figref> show two example network deployments.</p><p id="p0009" num="0009"><figref idrefs="f0003">FIG. 2</figref> shows communication between a terminal and a location server.</p><p id="p0010" num="0010"><figref idrefs="f0004">FIG. 3</figref> shows a message flow for network-initiated location service.</p><p id="p0011" num="0011"><figref idrefs="f0005">FIG. 4</figref> shows a message flow for registration with the location server.</p><p id="p0012" num="0012"><figref idrefs="f0006">FIG. 5</figref> shows communication between the terminal and the location server with network address translation (NAT).</p><p id="p0013" num="0013"><figref idrefs="f0007">FIG. 6</figref> shows a process performed by a terminal for registration.<!-- EPO <DP n="3"> --></p><p id="p0014" num="0014"><figref idrefs="f0007">FIG. 7</figref> shows a process performed by a location server for registration.</p><p id="p0015" num="0015"><figref idrefs="f0008">FIG. 8</figref> shows a block diagram of the terminal, an access network, and the location server.</p><heading id="h0006"><b>DETAILED DESCRIPTION</b></heading><p id="p0016" num="0016">The techniques described herein may be used for terminals communicating with wireline networks as well as wireless networks. The term "network" and "system" are often used interchangeably. For example, the techniques may be used for wireless networks defined by an organization named "3rd Generation Partnership Project" (3GPP) and wireless networks defined by an organization named "3rd Generation Partnership Project 2" (3GPP2).</p><p id="p0017" num="0017">The techniques may also be used for various user plane location architectures such as Secure User Plane Location (SUPL) from Open Mobile Alliance (OMA), V1 and V2 user plane from Code Division Multiple Access (CDMA) Development Group (CDG), X.S0024 user plane from 3GPP2, etc. SUPL is applicable for 3GPP, 3GPP2 and WLAN networks. X.S0024, V1 and V2 are applicable for 3GPP2 networks. A user plane is a mechanism for carrying messages/signaling for higher-layer applications and employing a user-plane bearer, which is typically implemented with protocols such as User Datagram Protocol (UDP), Transmission Control Protocol (TCP), and IP, all of which are known in the art. Messages/signaling supporting location services and positioning may be carried as part of data (from a network perspective) in a user plane architecture.</p><p id="p0018" num="0018">For clarity, certain aspects of the techniques are described below for SUPL. SUPL Version 1.0 (SUPL 1.0) is described in <nplcit id="ncit0001" npl-type="s"><text>OMA-AD-SUPL-V1, entitled "Secure User Plane Location Architecture," June 15, 2007</text></nplcit>, and <nplcit id="ncit0002" npl-type="s"><text>OMA-TS-ULP-V1, entitled "UserPlane Location Protocol," June 15, 2007</text></nplcit>. SUPL Version 2.0 (SUPL 2.0) is described in <nplcit id="ncit0003" npl-type="s"><text>OMA-AD-SUPL-V2, entitled "Secure User Plane Location Architecture," August 31, 2007</text></nplcit>, and <nplcit id="ncit0004" npl-type="s"><text>OMA-TS-ULP-V2, entitled "UserPlane Location Protocol," September 27, 2007</text></nplcit>. These SUPL documents are publicly available from OMA.</p><p id="p0019" num="0019"><figref idrefs="f0001"><b>FIG. 1A</b></figref> shows an example network deployment 100. A terminal 110 may communicate with an access network 120 to obtain communication services. Terminal 110 may be stationary or mobile and may also be referred to as a user equipment (UE),<!-- EPO <DP n="4"> --> a mobile station, an access terminal, a subscriber unit, a station, etc. Terminal 110 may be a cellular phone, a personal digital assistant (PDA), a wireless device, a handheld device, a wireless modem, a laptop computer, a telemetry device, a tracking device, etc. Terminal 110 may communicate with one or more base stations and/or one or more access points in access network 120. Terminal 110 may also receive signals from one or more satellites 180 in a satellite positioning system (SPS), which may be the United States Global Positioning System (GPS), the European Galileo system, the Russian GLONASS system, etc. Terminal 110 may measure signals from base stations in access network 120 and obtain timing measurements for the base stations. Terminal 110 may also measure signals from satellites 180 and obtain pseudo-range measurements for the satellites. The pseudo-range and/or timing measurements may be used to derive a position estimate for terminal 110. A position estimate may also be referred to as a location estimate, a position fix, etc.</p><p id="p0020" num="0020">Access network 120 supports communication for terminals located within its coverage. Access network 120 may be a wireless network and may also be referred to as a radio network, a radio access network, etc. Access network 120 may be a 3GPP access network, a 3GPP2 access network, a wireless local area network (WLAN), etc. A 3GPP access network may be a Global System for Mobile Communications (GSM) network, a GSM EDGE Radio Access Network (GERAN), a Universal Terrestrial Radio Access Network (UTRAN) utilizing Universal Terrestrial Radio Access (UTRA), e.g., Wideband CDMA (W-CDMA), an Evolved UTRAN (E-UTRAN) utilizing Long Term Evolution (LTE) radio access, etc. A 3GPP2 access network may be a CDMA2000 1X network utilizing cdma2000, CDMA2000 1xEV-DO network, etc. A WLAN may implement a radio technology such as any in the IEEE 802.11 family of standards, Hiperlan, etc. Access network 120 may also be a wireless network supporting other radio technology such as Ultra Mobile Broadband (UMB), IEEE 802.20, Flash-OFDM®, IEEE 802.16 (WiMax), etc. UTRA, E-UTRA and GSM are described in documents from 3GPP. cdma2000 and UMB are described in documents from 3GPP2. 3GPP and 3GPP2 documents are publicly available. Access network 120 may also be a wireline network such as a local area network (LAN), a digital subscriber line (DSL) network, a packet cable network, a telephone network, etc.<!-- EPO <DP n="5"> --></p><p id="p0021" num="0021">Visited network 130 is a network currently serving terminal 110 and may also be referred to as a Visited Public Land Mobile Network (V-PLMN). Visited network 130 may include various network entities that provide data and/or voice connectivity, location services, and/or other functionalities and services. For 3GPP, visited network 130 may include a Serving GPRS Support Node (SGSN) 132 and a WLAN Access Gateway (WAG) 134. SGSN 132 is part of a General Packet Radio Service (GPRS) core network and provides packet-switched services for terminals communicating with a 3GPP access network. WAG 134 is part of a 3GPP Inter-working WLAN (I-WLAN) core network and provides packet-switched services for terminals communicating with a WLAN access network. Visited network 130 may include other 3GPP network entities, e.g., network entities supporting location services and positioning, which are not shown in <figref idrefs="f0001">FIG. 1A</figref> for simplicity. For 3GPP2, visited network 130 may include network entities performing similar functions as those for 3GPP but referred to by other names. 3GPP and 3GPP2 generally use different network entities and, for clarity, much of the following description is for 3GPP-based networks.</p><p id="p0022" num="0022">A home network 140 is a network with which terminal 110 has subscription and may also be referred to as a Home PLMN (H-PLMN). Home network 140 may include various entities that provide data and/or voice connectivity, location services, and/or other functionalities and services. For 3GPP, home network 140 may include a Gateway GPRS Support Node (GGSN) 142, a Packet Data Gateway (PDG) 144, a Short Message Service Center/Message Center (SMSC/MC) 146, a Home Location Register/ Home Subscriber Server (HLR/HSS) 148, a Home SUPL Location Platform (H-SLP) 150, and an Access, Authorization, and Accounting (AAA) server 152. GGSN 142 performs functions such as routing and filtering to support packet-switched services. PDG 144 supports inter-working between 3GPP and WLAN and performs functions such as traffic security, IP address assignment, etc. SMSC/MC 146 supports Short Message Service (SMS) and delivers SMS messages for terminals. HLR/HSS 148 stores subscription-related information for terminals for which network 140 is the home network. HLR/HSS 148 also stores registration information and provides routing information for network-initiated calls and SMS for terminals in home network 140, e.g., whenever requested by network entities in visited network 130. H-SLP 150 supports SUPL for terminals in home network 140. AAA server 152 authorizes<!-- EPO <DP n="6"> --> terminals for services and performs accounting and billing functions. Home network 140 may include other 3GPP network entities that are not shown in <figref idrefs="f0001">FIG. 1A</figref> for simplicity.</p><p id="p0023" num="0023">Access network 120 (e.g., a WLAN) may exchange packets with a router 122, which may be coupled to the Internet 124. H-SLP 150 may communicate with other entities via the Internet 124, e.g., with terminal 110 via the Internet 124, router 122, and access network 120.</p><p id="p0024" num="0024"><figref idrefs="f0002"><b>FIG. 1B</b></figref> shows another example network deployment 102. In deployment 102, H-SLP 150 may be operated by a location service provider 108 that may not be the home network operator for terminal 110. Terminal 110 may or may not have a home network. GGSN 142, PDG 144 and H-SLP 150 may be coupled to the Internet 124. Terminal 110 may communicate with H-SLP 150 via visited network 130 and home network 140, e.g., via access network 120, SGSN 132, GGSN 142, and the Internet 124. Terminal 110 may also communicate with H-SLP 150 via access network 120, router 122, and the Internet 124.</p><p id="p0025" num="0025"><figref idrefs="f0001">FIGS. 1A</figref> and <figref idrefs="f0002">1B</figref> show two example network deployments supporting communication between terminal 110 and H-SLP 150. Terminal 110 may also communicate with H-SLP 150 in other network deployments involving other combinations of networks and/or network entities.</p><p id="p0026" num="0026"><figref idrefs="f0003"><b>FIG. 2</b></figref> shows communication between terminal 110 and H-SLP 150. Terminal 110 supports SUPL for location services and positioning and is referred to as a SUPL enabled terminal (SET) in SUPL. Terminal 110 may have a SUPL agent 210 that is resident within the terminal. A SUPL agent is a service access point that accesses network resources to obtain location information. A SUPL agent may contain a Mobile Location Services (MLS) application, which may include protocols used for communication between the SUPL agent and an H-SLP. H-SLP 150 may include a SUPL Location Center (SLC) 220 that supports location services for terminals in home network 140 and visited network 130 and a SUPL Positioning Center (SPC) 222 that supports positioning for these terminals. A SUPL agent 160 may communicate with H-SLP 150 to obtain location information for terminal 110.</p><p id="p0027" num="0027">SUPL supports SET-initiated services and network-initiated services. SET-initiated services are services that originate from a SET, with the SUPL agent residing<!-- EPO <DP n="7"> --> within the SET. Network-initiated services are services that originate from within a SUPL network, with the SUPL agent residing in the network.</p><p id="p0028" num="0028">SUPL supports 1-way communication from H-SLP 150 to terminal 110, which may be used by H-SLP 150 to send a SUPL INIT message to terminal 110 to start a network-initiated location session. H-SLP 150 may send the SUPL INIT message using various mechanisms including UDP/IP, Wireless Application Protocol (WAP) Push, SMS, and Session Initiation Protocol (SIP) Push. For UDP/IP, H-SLP 150 may send the SUPL INIT message to terminal 110 via various network entities, as described below for TCP/IP. For WAP Push, H-SLP 150 may send the SUPL INIT message to terminal 110 via WAP Push Proxy Gateway (PPG) or via WAP PPG coupled to SMSC/SC 146. For SMS, H-SLP 150 may send the SUPL INIT message to terminal 110 via SMSC/SC 146, SGSN 132, and access network 120. For SIP Push, H-SLP 150 may send the SUPL INIT message to terminal 110 via a SIP/IP core.</p><p id="p0029" num="0029">SUPL also supports 2-way communication between terminal 110 and H-SLP 150 using TCP/IP. The 2-way communication may be used to exchange SUPL messages between terminal 110 and H-SLP 150 for registration, location services, positioning, etc. For 3GPP GPRS, SUPL messages may be exchanged using TCP/IP between terminal 110 and H-SLP 150 via GGSN 142, SGSN 132, and access network 120, which may be a GSM network, a GERAN, a UTRAN, etc. For 3GPP I-WLAN, SUPL messages may be exchanged using TCP/IP between terminal 110 and H-SLP 150 via PDG 144, WAG 134, and access network 120, which may be a WLAN. SUPL messages may also be exchanged between terminal 110 and H-SLP 150 via the Internet 124, router 122, and access network 120, which may be a WLAN, a LAN, a DSL network, a packet cable network, etc. 1-way and 2-way communication between terminal 110 and H-SLP 150 is described in detail in the aforementioned OMA-AD-SUPL-V2 document.</p><p id="p0030" num="0030">For SET-initiated services, terminal 110 may send a SUPL START message to H-SLP 150 to start a location session. Terminal 110 may be provisioned with an IP address of H-SLP 150 and may send the SUPL START message to the H-SLP using this provisioned IP address. In general, an IP address may be a 32-bit IP Version 4 (IPv4) address or a 128-bit IP Version 6 (IPv6) address. Alternatively, terminal 110 may be provisioned with a fully qualified domain name (FQDN) of H-SLP 150 and may<!-- EPO <DP n="8"> --> use Domain Name System (DNS) to obtain the IP address of the H-SLP. Terminal 110 may then send the SUPL START message to H-SLP 150 using the fetched IP address.</p><p id="p0031" num="0031">For network-initiated services, H-SLP 150 may send a SUPL INIT message to terminal 110 to start a location session using any of the 1-way communication mechanisms shown in <figref idrefs="f0003">FIG. 2</figref>. H-SLP 150 may use UDP/IP if the IP address of terminal 110 is known to the H-SLP or can be obtained by the H-SLP, e.g., from HLR/HSS 148, GGSN 142, or AAA server 152. H-SLP 150 may then send the SUPL INIT message to terminal 110 using the IP address of the terminal. H-SLP 150 may use SIP Push if terminal 110 has performed SIP registration with home network 140 and routing information for terminal 110 is available, e.g., from HLR/HSS 148. H-SLP 150 may use SMS or WAP Push if terminal 110 has performed wireless access registration (e.g., GSM, UMTS, or CDMA registration) with home network 140 and routing information for terminal 110 is available, e.g., from HLR/HSS 148.</p><p id="p0032" num="0032">For normal SUPL, H-SLP 150 may send a SUPL INIT message to terminal 110 using SMS, WAP Push, or SIP Push without knowing the IP address of the terminal. H-SLP 150 may receive the IP address of terminal 110 later after the terminal establishes a secure IP connection to the H-SLP. However, as noted above, H-SLP 150 may use SMS or WAP Push only if terminal 110 has performed wireless access registration and may use SIP Push only if terminal 110 has performed SIP registration. H-SLP 150 may send the SUPL INIT message to terminal 110 using UDP/IP but would need to first obtain the IP address of terminal 110, e.g., by querying HLR/HSS 148 and/or other network entities such as GGSN 142, AAA server 152 (for WLAN access), etc. For IP access via 3GPP or 3GPP2-based network, the IP address of terminal 110 may be obtainable from HLR/HSS 148 or via a Dynamic DNS (DDNS) server. However, the IP address of terminal 110 may not be practically obtainable by H-SLP 150 if DDNS is not supported by the network entities normally providing DDNS support.</p><p id="p0033" num="0033">In some scenarios, terminal 110 may have communication access, e.g., via a WLAN, a LAN, a DSL, etc., but it may not be possible for H-SLP 150 to initiate a location session with terminal 110 by use of UDP/IP, WAP Push, SMS, or SIP Push. This may occur if H-SLP 150 cannot determine the IP address of terminal 110, and terminal 110 is accessing a network that does not (entirely or correctly) support inter-working<!-- EPO <DP n="9"> --> with WAP Push, SMS, or SIP Push, or does not support the types of registration described above needed to enable these transfers. In such scenarios, location requests initiated by SUPL agent 160 via H-SLP 150 would fail.</p><p id="p0034" num="0034">The scenarios described above may occur if terminal/SET 110 is not registered or not fully registered with HLR/HSS 148 in home network 140 when accessing packet mode IP-based services. Terminal 110 may not be registered or fully registered in any of the following user cases or situations:
<ol><li>(a) A user of terminal 110 has a temporary or permanent subscription to more than one Internet service provider (ISP) and/or VoIP provider and receives service from a provider that is neither its home operator nor a roaming partner of the home operator. For example, the user may be using a hotel or airport WLAN, a wireline-based VoIP provider, or a company-provided LAN/VoIP capability.</li><li>(b) The user accesses a WLAN with an association to home network 140 but chooses to use a WLAN Direct IP Access mode in which home network 140 provides AAA support but does not provide or receive the IP address of terminal 110.</li><li>(c) Terminal 110 receives TCP/IP access via another end device. For example, terminal/SET 110 may reside on a laptop computer that obtains TCP/IP access via an IP-enabled cellular phone.</li><li>(d) Terminal 110 receives TCP/IP access via a virtual private network (VPN); e.g., via a VPN tunnel to a corporate LAN.</li></ol></p><p id="p0035" num="0035">For the user cases described above, WAP Push and SMS would not work and UDP/IP would only work if H-SLP 150 already has the IP address of terminal 110; e.g., from a previous SET-initiated location session if there happened to be one. Furthermore, for the deployment shown in <figref idrefs="f0002">FIG. 1B</figref>, the 1-way communication from H-SLP 150 to terminal 110 using UDP/IP, SMS, WAP Push, or SIP Push shown in <figref idrefs="f0003">FIG. 2</figref> may not be possible because H-SLP 150 is not part of home network 140 and may seldom have the IP address of terminal 110.</p><p id="p0036" num="0036">In an aspect, terminal/SET 110 may register its current IP address with H-SLP 150 in order to support network-initiated location services for the user cases described above and possibly other user cases. Terminal 110 may perform registration<!-- EPO <DP n="10"> --> with H-SLP 150 whenever terminal 110 communicates with an access network that does not provide normal inter-working with home network 140. Upon detecting this situation, terminal 110 may perform registration with H-SLP 150 and provide its IP address to the H-SLP, which may use this IP address to send messages to terminal 110 for network-initiated services.</p><p id="p0037" num="0037">Terminal 110 may perform registration with H-SLP 150 for any kind of access (e.g., via WLAN, W-CDMA, LAN, DSL, etc.) for the deployment shown in <figref idrefs="f0002">FIG. 1B</figref>. For the normal case in which H-SLP 150 is part of home network 140, as shown in <figref idrefs="f0001">FIG. 1A</figref>, the need for registration with H-SLP 150 may be less common. However, for the case shown in <figref idrefs="f0002">FIG. 1B</figref>, registration with H-SLP 150 may always be needed. The registration with H-SLP 150 enables SUPL support by location service provider 108 that is different from the home network operator. Terminal 110 may be triggered to initiate registration with H-SLP 150 on a continual periodic basis, or as instructed by the H-SLP (e.g., the H-SLP may send information on when or how often to perform registration), etc.</p><p id="p0038" num="0038"><figref idrefs="f0004"><b>FIG. 3</b></figref> shows a design of a message flow 300 for network-initiated location services with H-SLP registration. Terminal 110 may initially detect that it may not be reachable in the normal manner via UDP/IP, WAP Push, SMS, or SIP Push by H-SLP 150 and that registration with the H-SLP is desired or necessary (step A). For example, terminal 110 may decide to perform registration with H-SLP 150 when terminal 110 acquires IP connectivity using neither its home network nor a roaming partner of its home network. Terminal 110 may then perform registration with H-SLP 150 and may provide its IP address to the H-SLP, as described below (step B).</p><p id="p0039" num="0039">At a later time, SUPL agent 160 may desire location information for terminal 110 and may send a Mobile Location Protocol (MLP) Standard Location Immediate Request (SLIR) message to H-SLP 150 (step C). H-SLP 150 may authenticate and authorize SUPL agent 160 for the requested location service. H-SLP 150 may then obtain routing information for terminal 110, which is the target SET (step D). Since terminal 110 has registered its IP address with H-SLP 150, the routing information may comprise the IP address of the terminal.</p><p id="p0040" num="0040">H-SLP 150 may then initiate a location session with terminal 110 by sending a SUPL INIT message using the IP address of the terminal (step E). WAP Push, SMS<!-- EPO <DP n="11"> --> and SIP Push may not be available to send the SUPL INIT message in this case. H-SLP 150 may be able to use UDP/IP to send the SUPL INIT message (because it has the IP address of terminal 110) or may be able to use TCP/IP if the TCP/IP connection used for the H-SLP registration in step B is still open (i.e., was not closed). The SUPL INIT message may contain a session-id used to identify the location session, an intended positioning method, the desired quality of positioning (QoP), etc. Upon receiving the SUPL INIT message, terminal 110 may perform a data connection setup procedure and attach itself to a packet data network if the terminal is not already attached (step F). Terminal 110 may then establish a secure TCP/IP connection to H-SLP 150 (also step F) if a secure TCP/IP connection is not already open (e.g., was not used to send the SUPL INIT message in step E). Terminal 110 may then send a SUPL POS INIT message to start a positioning session with H-SLP 150 (step G). The SUPL POS INIT message may include the session-id, SET capabilities (e.g., supported positioning methods and protocols), request for assistance data, etc.</p><p id="p0041" num="0041">Terminal 110 and H-SLP 150 may then exchange messages for a SUPL positioning session (step H). For SET-assisted positioning, H-SLP 150 may calculate a position estimate for terminal 110 based on positioning measurements received from the terminal. For SET-based positioning, terminal 110 may calculate the position estimate based on assistance obtained from H-SLP 150. In any case, upon completing the position calculation, H-SLP 150 may send a SUPL END message to inform terminal 110 that no further positioning procedure will be started and that the location session is finished (step I). Terminal 110 may then release the secure TCP/IP connection to H-SLP 150 and may also release resources related to the location session. H-SLP 150 may send the requested location information in an MLP Standard Location Immediate Answer (SLIA) message to SUPL agent 160 and may release resources related to the location session.</p><p id="p0042" num="0042"><figref idrefs="f0004">FIG. 3</figref> shows an example message flow for one case of network-initiated location service with H-SLP registration. H-SLP registration may also be used to support other message flows for other cases of network-initiated location services, which may cover roaming and non-roaming, proxy and non-proxy modes, triggered and non-triggered services, etc. SUPL agent 160 may communicate directly with H-SLP 150 for roaming and non-roaming scenarios or indirectly with H-SLP 150 via a<!-- EPO <DP n="12"> --> Requesting SLP (R-SLP). SPC 222 may communicate directly with terminal 110 in the non-proxy mode and may communicate indirectly with terminal 110 via SLC 220 in the proxy mode. H-SLP 150 may provide location information for terminal 110 to SUPL agent 160 once for non-triggered services and possibly more than once based on event or timer triggers for triggered services. In general, registration with H-SLP 150 may be performed for each of the various network-initiated message flows described in the aforementioned OMA-TS-LTLP-V1 and OMA-TS-ULP-V2 documents.</p><p id="p0043" num="0043"><figref idrefs="f0005"><b>FIG. 4</b></figref> shows a design of a message flow 400 for registration with H-SLP 150, which may be used for step B in <figref idrefs="f0004">FIG. 3</figref>. Terminal 110 may obtain IP connectivity via an access network that is not its home network or a roaming partner of its home network. Terminal 110 may then decide to instigate registration with H-SLP 150 (step A).</p><p id="p0044" num="0044">For the H-SLP registration, terminal 110 may establish a secure TCP/IP connection to H-SLP 150 using an IP address of the H-SLP, which may be provisioned at terminal 110 by home network 140 or may be obtained by the terminal in other manners (step B). A secure IP connection may be established in various manners, as described below. Terminal 110 may then send a SUPL REGISTRATION message to register its IP address with H-SLP 150 (step C). The SUPL REGISTRATION message may include a session-id identifying the current session, the IP address of terminal 110, etc. For Mobile IP, the IP address of terminal 110 may be a remote IP address assigned by a home agent (HA) within home network 140. H-SLP 150 may return a SUPL REGISTRATION ACK message containing a repeat timer (RT) value to terminal 110 (step D).</p><p id="p0045" num="0045">Terminal 110 may periodically perform registration with H-SLP 150 based on a repeat timer. For example, terminal 110 may set the repeat timer to the repeat timer value obtained from the SUPL REGISTRATION ACK message and may perform registration with H-SLP 150 when the repeat timer expires or whenever the IP address of terminal 110 changes. For each H-SLP registration, terminal 110 may establish a secure IP connection to H-SLP 150 if this connection was released or may retain and reuse the previous secure IP connection. Terminal 110 may then send a SUPL REGISTRATION message with the current IP address of the terminal to H-SLP 150 (step E). H-SLP 150 may return a SUPL REGISTRATION ACK message with the<!-- EPO <DP n="13"> --> same or different repeat timer value to terminal 110 (step F). Terminal 110 may skip or cancel registration with H-SLP 150 (steps E and F) if the terminal obtains IP connectivity from home network 140 or a roaming partner of the home network.</p><p id="p0046" num="0046">In general, terminal 1.10 may perform registration with H-SLP 150 just once (e.g., upon obtaining IP connectivity via an access network that is not associated with the home network) or multiple times (e.g., every time the repeat timer expires or the IP address of the terminal changes). A repeat timer value may or may not be sent in a SUPL REGISTRATION ACK message. If sent, the repeat timer value may be selected based on the expected life of the IP address of terminal 110 and/or other factors. The repeat timer value may also be constrained to be within a range of minimum and maximum values. In between steps D and E in <figref idrefs="f0005">FIG. 4</figref>, H-SLP 150 and/or terminal 110 may or may not instigate release of the secure IP connection established in step B.</p><p id="p0047" num="0047">H-SLP 150 may also provide other information in a SUPL REGISTRATION ACK message to assist terminal 110 in deciding when to perform registration again. For example, H-SLP 150 may include a flag in the SUPL REGISTRATION ACK message directing terminal 110 to send a SUPL REGISTRATION message if a new IP address is assigned to terminal 110. H-SLP 150 may include a different flag (e.g., no flag) in the SUPL REGISTRATION ACK message to direct terminal 110 to not send a SUPL REGISTRATION message if a new IP address is assigned to terminal 110. Such additional information in the SUPL REGISTRATION ACK message may be used by H-SLP 150 to ensure that it has the current IP address of terminal 110 and to limit the frequency of the SUPL REGISTRATION messages in order to avoid a network overload situation.</p><p id="p0048" num="0048"><figref idrefs="f0005">FIG. 4</figref> shows the use of the SUPL REGISTRATION message for registration with H-SLP 150. In general, terminal 110 may send any message that carries the IP address of the terminal explicitly (e.g., in a payload) and/or implicitly (e.g., in a source address). Terminal 110 may send this message after a secure IP connection is established, while it is being established, or just before it is established.</p><p id="p0049" num="0049">Terminal 110 may be assigned an IP address based on various mechanisms known in the art. This assigned IP address may be referred to as a private IP address. Terminal 110 may communicate with access network 120, which may perform network address translation (NAT) and may map the private IP address of terminal 110 to a<!-- EPO <DP n="14"> --> public IP address that can be used by external entities to send IP packets to terminal 110. NAT may be used for various purposes such as security (e.g., to prevent unauthorized IP access to terminal 110), enable sharing of the same public IP address by several terminals, etc. Terminal 110 may not be aware of NAT being performed by access network 120 and may also not be aware of the public IP address used for the terminal.</p><p id="p0050" num="0050"><figref idrefs="f0006"><b>FIG. 5</b></figref> shows communication between terminal 110 and H-SLP 150 with NAT. Terminal 110 may exchange IP packets with H-SLP 150 via a router/gateway 520 in access network 120 and other network entities, which are not shown in <figref idrefs="f0006">FIG. 5</figref> for simplicity. For registration with H-SLP 150 in <figref idrefs="f0005">FIG. 4</figref>, terminal 110 may send one or more IP packets for the SUPL REGISTRATION message (step C) to H-SLP 150 via router 520. Each IP packet sent by terminal 110 may have (i) a source address field set to the private IP address of terminal 110, (ii) a destination address field set to the IP address of H-SLP 150, and (iii) a payload field carrying the SUPL REGISTRATION message, which may include the private IP address of terminal 110. Router 520 may receive the IP packet(s) from terminal 110, perform NAT, replace the private IP address in each IP packet with the public IP address for terminal 110, and send the IP packet(s) to H-SLP 150.</p><p id="p0051" num="0051">H-SLP 150 may receive the IP packet(s) from router 520, extract the public IP address from the source address field, and extract the private IP address from the SUPL REGISTRATION message sent in the payload field. H-SLP 150 may compare the two IP addresses. If these IP addresses match, then H-SLP 150 may assume that a valid IP address has been received for terminal 110. If these IP addresses differ, then H-SLP 150 may assume that NAT was performed and may use the public IP address obtained from the source address field of the IP packet(s). H-SLP 150 may maintain the secure IP connection established in step B in <figref idrefs="f0005">FIG. 4</figref> in order to avoid the risk of losing the capability to send IP packets to terminal 110 due to packet filtering by router 520. Alternatively or additionally, H-SLP 150 may provide a smaller repeat timer value to terminal 110 to more frequently verify that the terminal still has the same public IP address. If NAT is performed, then a smaller repeat timer value may also help avoid removal of the public-private IP address binding for terminal 110 in router 520 due to lack of IP traffic to and from the terminal. The repeat timer value may be selected to be<!-- EPO <DP n="15"> --> smaller than the duration of the public-private IP address binding by router 520, if known.</p><p id="p0052" num="0052">For registration within H-SLP 150, terminal 110 may establish a secure IP connection to H-SLP 150 prior to sending the SUPL REGISTRATION message. For the secure IP connection establishment, terminal 110 may first establish an IP connection to H-SLP 150. Terminal 110 and H-SLP 150 may then perform mutual authentication in order to authenticate one another. The mutual authentication may be performed based on various mechanisms.</p><p id="p0053" num="0053">In one design that is applicable for 3GPP and 3GPP2, Transport Layer Security (TLS) may be used for mutual authentication of terminal 110 and H-SLP 150. TLS may be used if terminal 110 has performed wireless access registration, e.g., for GSM, UMTS, CDMA, etc. H-SLP 150 may authenticate terminal 1.10 by verifying that the IP address of the terminal is valid, e.g., by querying GGSN 142 or AAA server 152. H-SLP 150 may also provide a public key certificate to terminal 110 (using TLS) to allow the terminal to authenticate the H-SLP. TLS is described in <nplcit id="ncit0005" npl-type="s"><text>IETF RFC 2246, entitled "The TLS Protocol," January 1999</text></nplcit>, which is publicly available.</p><p id="p0054" num="0054">In another design that is applicable for 3GPP2, Pre-Shared Key (PSK) TLS (PSK-TLS) may be used for mutual authentication of terminal 110 and H-SLP 150. PSK-TLS relies on a shared secret key that is pre-stored securely in both terminal 110 and H-SLP 150. PSK-TLS is described in <nplcit id="ncit0006" npl-type="s"><text>IETF RFC 4279, entitled "Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)," December 2005</text></nplcit>, which is publicly available. The PSK-TLS authentication procedure is defined in SUPL 1.0 and SUPL 2.0 for 3GPP2 and may be extended to 3GPP.</p><p id="p0055" num="0055">In yet another design that is applicable for 3GPP and 3GPP2, a variant of a PSK-TLS Generic Bootstrap Architecture (GBA) procedure defined for SUPL 1.0 may be used for mutual authentication of terminal 110 and H-SLP 150. For the PSK-TLS GBA procedure, terminal 110 and H-SLP 150 both support GBA and can obtain a secure shared key from a Bootstrapping Server Function (BSF) in home network 140. This key may then be used to support PSK-TLS mutual authentication of terminal 110 and H-SLP 150, as described in 3GPP TS 33.222 or 3GPP2 TSG-S draft S.P0114. The key may also be used to support TLS with HTTP Digest authentication, or just HTTP Digest authentication between terminal 110 and H-SLP 150, or some other forms of<!-- EPO <DP n="16"> --> authentication. The GBA procedure involves terminal 110, H-SLP 150, and the BSF in home network 140. Hence, there may be no impact to both access network 120 and visited network 130. GBA is described in<nplcit id="ncit0007" npl-type="s"><text> 3GPP2 S.S0109-0, entitled "Generic Bootstrapping Architecture (GBA) Framework," March 2006</text></nplcit>, <nplcit id="ncit0008" npl-type="s"><text>3GPP2 S.S0114-0, entitled "Security Mechanisms using GBA," March 2006</text></nplcit>, <nplcit id="ncit0009" npl-type="s"><text>3GPP TS 33.220, entitled "Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture</text></nplcit>," and <nplcit id="ncit0010" npl-type="s"><text>3GPP TS 33.222, entitled "Generic Authentication Architecture (GAA)</text></nplcit>; Access to network application functions using Hypertext Transfer Protocol over Transport Layer Security (HTTPS)." These documents are publicly available.</p><p id="p0056" num="0056">In general, mutual authentication of terminal 110 and H-SLP 150 may be supported with GBA, a PSK-TLS alternative, etc. The capability to perform mutual authentication may support network-initiated location services for the user cases described above as well as SET-initiated location services that may require mutual authentication during establishment of a secure IP connection.</p><p id="p0057" num="0057"><figref idrefs="f0007"><b>FIG. 6</b></figref> shows a design of a process 600 performed by a terminal, e.g., a SET in SUPL. The terminal may initially determine whether to perform registration with a location server (block 612). The terminal may decide to perform registration if it obtains IP connectivity via (i) an access network that is not associated with a home network of the terminal, (ii) a WLAN or a wired network, or (iii) some other access network. The terminal may also decide to perform registration if the location server is operated by a service provider that is not the home network operator. The location server may be an H-SLP in SUPL, a Gateway Mobile Location Center (GMLC) in 3GPP, a Mobile Positioning Center (MPC) in 3GPP2, etc. The terminal may communicate with the location server to perform registration if registration is decided (block 614). The communication for the registration may identify the terminal to the location server, instigate mutual authentication of the terminal and the location server, and provide an IP address of the terminal to the location server. The IP address may be used by the location server to send messages to the terminal for network-initiated location services.</p><p id="p0058" num="0058">The terminal may establish a secure IP connection with the location server and may send the IP address of the terminal via the secure IP connection to the location server. The terminal may maintain the secure IP connection for a subsequent<!-- EPO <DP n="17"> --> registration or location session with the location server. The terminal may perform registration with the location server if the IP address changes. The terminal may also receive a timer value from the location server, set a timer based on the timer value, and perform registration when the timer expires.</p><p id="p0059" num="0059">The terminal may receive a message to start a network-initiated location session, with the message being sent by the location server to the terminal based on the IP address provided to the location server during the registration (block 616). The terminal may communicate with the location server for the location session (block 618).</p><p id="p0060" num="0060"><figref idrefs="f0007"><b>FIG. 7</b></figref> shows a design of a process 700 performed by a location server, e.g., an H-SLP, a GMLC, an MPC, etc. The location server may communicate with a terminal for registration of the terminal with the location server (block 712). The communication may identify the terminal to the location server, instigate mutual authentication of the terminal and the location server, and provide an IP address of the terminal to the location server. The location server may receive at least one IP packet from the terminal, obtain a first IP address from a source address field of the IP packet(s), obtain a second IP address from a payload of the IP packet(s), and compare the first and second IP addresses. The location server may use the second IP address as the IP address of the terminal if the first and second IP addresses match and may use the first IP address as the IP address of the terminal if the first and second IP addresses do not match. The location server may send a timer value to the terminal during the registration, and the terminal may use the timer value to perform a subsequent registration with the location server.</p><p id="p0061" num="0061">The location server may send a message to start a network-initiated location session (block 714). The message may be sent to the terminal based on the IP address received from the terminal during the registration. The location server may then communicate with the terminal for the location session (block 716).</p><p id="p0062" num="0062"><figref idrefs="f0008"><b>FIG. 8</b></figref> shows a block diagram of a design of terminal 110, access network 120, and H-SLP 150 in <figref idrefs="f0001">FIGS. 1A</figref> and <figref idrefs="f0002">1B</figref>. At terminal 110, a modem processor 824 may receive data to be sent by terminal 110, process (e.g., encode and modulate) the data, and generate output chips. A transmitter (TMTR) 832 may condition (e.g., convert to analog, filter, amplify, and frequency upconvert) the output chips and generate an uplink signal, which may be transmitted via an antenna 834. On the downlink, antenna<!-- EPO <DP n="18"> --> 834 may receive downlink signals from access network 120. A receiver (RCVR) 836 may condition (e.g., filter, amplify, frequency downconvert, and digitize) the received signal from antenna 834 and provide samples. Modem processor 824 may process (e.g., demodulate and decode) the samples and provide decoded data. Modem processor 824 may perform processing in accordance with a radio technology (e.g., W-CDMA, CDMA 1X, GSM, 802.11, etc.) utilized by access network 120. A digital signal processor 826 may perform various types of processing for terminal 110.</p><p id="p0063" num="0063">A GPS receiver 838 may receive and condition signals from satellites 180. These measurements may be processed to obtain an accurate location estimate for terminal 110. A coarse location estimate for terminal 110 may also be determined based on pilots received from base stations in access network 120.</p><p id="p0064" num="0064">A controller/processor 820 may direct the operation at terminal 110. Controller/processor 820 may perform processing for terminal 110 in message flow 300 in <figref idrefs="f0004">FIG. 3</figref> and message flow 400 in <figref idrefs="f0005">FIG. 4</figref>. Controller/processor 820 may also perform process 600 in <figref idrefs="f0007">FIG. 6</figref> and/or other processes for the techniques described herein. A memory 822 may store program codes, data, and an IP address of terminal 110. Processors 820, 824 and 826 and memory 822 may be implemented on an application specific integrated circuit (ASIC) 810.</p><p id="p0065" num="0065">For simplicity, <figref idrefs="f0008">FIG. 8</figref> shows one controller/processor 840, one memory 842, one transmitter/receiver (TMTR/RCVR) 844, and one communication (Comm) unit 846 for access network 120. In general, access network 120 may include any number of controllers, processors, memories, transmitters, receivers, communication units, etc. Controller/processor 840 may perform various functions for communication with the terminals, memory 842 may store program codes and data for access network 120, transmitter/receiver 844 may support radio communication with the terminal, and communication unit 846 may support communication with other network entities.</p><p id="p0066" num="0066"><figref idrefs="f0008">FIG. 8</figref> also shows a design of H-SLP 150. H-SLP 150 may include a controller/processor 850 that may perform various functions to support location services and/or positioning, a memory 852 that may store program codes and data for H-SLP 150, and a communication unit 854 that may support communication with other network entities. Controller/processor 850 may perform processing for H-SLP 150 in message flow 300 in <figref idrefs="f0004">FIG. 3</figref> and message flow 400 in <figref idrefs="f0005">FIG. 4</figref>. Controller/processor 850<!-- EPO <DP n="19"> --> may also perform process 700 in <figref idrefs="f0007">FIG. 7</figref> and/or other processes for the techniques described herein. Memory 852 may store the IP address of terminal 110, which may be received during registration performed by the terminal.</p><p id="p0067" num="0067">The techniques described herein may be implemented by various means depending upon the application. For example, these techniques may be implemented in hardware, firmware, software, or a combination thereof. For a hardware implementation, the processing units used to perform the techniques at an entity (e.g., a terminal or a location server) may be implemented within one or more ASICs, digital signal processors (DSPs), digital signal processing devices (DSPDs), programmable logic devices (PLDs), field programmable gate arrays (FPGAs), processors, controllers, micro-controllers, microprocessors, electronic devices, other electronic units designed to perform the functions described herein, a computer, or a combination thereof.</p><p id="p0068" num="0068">For a firmware and/or software implementation, the techniques may be implemented with modules (e.g., procedures, functions, etc.) that perform the functions described herein. In general, any machine/computer/processor-readable medium tangibly embodying firmware and/or software instructions/code may be used in implementing the techniques described herein. For example, the firmware and/or software instructions/code may be stored in a memory (e.g., memory 822 or 852 in <figref idrefs="f0008">FIG. 8</figref>) and executed by a processor (e.g., processor 820 or 850). The memory may be implemented within the processor or external to the processor. The firmware and/or software instructions/code may also be stored in a machine/computer/processor-readable medium such as random access memory (RAM), read-only memory (ROM), non-volatile random access memory (NVRAM), programmable read-only memory (PROM), electrically erasable PROM (EEPROM), FLASH memory, floppy disk, compact disc (CD), digital versatile disc (DVD), magnetic or optical data storage device, etc. The instructions/code may be executable by one or more processors and may cause the processor(s) to perform certain aspects of the functionality described herein.</p></description><claims mxw-id="PCLM56980433" lang="DE" load-source="patent-office"><!-- EPO <DP n="23"> --><claim id="c-de-01-0001" num="0001"><claim-text>System zur Kommunikation, das Folgendes umfasst:
<claim-text>Mittel (820) zum Ermitteln, ob eine Registrierung bei einem Standortserver durchgeführt werden soll; und</claim-text>
<claim-text>Mittel zum Kommunizieren mit dem Standortserver, um eine Registrierung durchzuführen, wenn eine Registrierung beschlossen wird, wobei die Kommunikation dem Standortserver ein Endgerät identifiziert, Veranlassen einer gegenseitigen Authentifizierung des Endgeräts und des Standortservers und Bereitstellen dem Standortserver einer IP-(Internet Protocol)-Adresse des Endgeräts, wobei die IP-Adresse zur Verwendung durch den Standortserver benutzt wird, um Nachrichten zum Endgerät für durch das Netzwerk eingeleitete Ortsdienste zu senden, wobei die dem Standortserver das Endgerät identifizierende Kommunikation eine erste IP-Adresse in einem Quelladressfeld und eine zweite IP-Adresse in einem Nutzlastfeld beinhaltet; und</claim-text>
<claim-text>Mittel am Standortserver zum Benutzen der zweiten IP-Adresse als die IP-Adresse des Endgeräts, wenn die erste und die zweite IP-Adresse übereinstimmen, und zum Benutzen der ersten IP-Adresse als die IP-Adresse des Endgeräts, wenn die erste und die zweite IP-Adresse nicht übereinstimmen.</claim-text></claim-text></claim><claim id="c-de-01-0002" num="0002"><claim-text>Vorrichtung nach Anspruch 1, die ferner Folgendes umfasst:
<claim-text>Mittel zum Empfangen eines Zeitgeberwertes vom Standortserver;</claim-text>
<claim-text>Mittel zum Einstellen eines Zeitgebers auf der Basis des Zeitgeberwertes; und</claim-text>
<claim-text>Mittel zum Durchführen einer Registrierung beim Standortserver, wenn der Zeitgeber abläuft.</claim-text><!-- EPO <DP n="24"> --></claim-text></claim><claim id="c-de-01-0003" num="0003"><claim-text>Vorrichtung nach Anspruch 1, wobei das Mittel zum Ermitteln, ob eine Registrierung durchgeführt werden soll, ferner die Aufgabe hat zu entscheiden, dass eine Registrierung beim Standortserver dann durchgeführt wird, wenn der Standortserver nicht zu einem Heimnetz des Endgeräts gehört.</claim-text></claim><claim id="c-de-01-0004" num="0004"><claim-text>Vorrichtung nach Anspruch 1, wobei das Mittel zum Ermitteln, ob eine Registrierung durchgeführt werden soll, ferner die Aufgabe hat zu entscheiden, dass eine Registrierung beim Standortserver dann durchgeführt wird, wenn sich die IP-Adresse des Endgeräts ändert.</claim-text></claim><claim id="c-de-01-0005" num="0005"><claim-text>Vorrichtung nach Anspruch 1, wobei das Mittel zum Ermitteln, ob eine Registrierung durchgeführt werden soll, ferner so ausgelegt ist, dass es entscheidet, dass eine Registrierung beim Standortserver durchgeführt wird, wenn ein Zeitgeber abläuft.</claim-text></claim><claim id="c-de-01-0006" num="0006"><claim-text>Vorrichtung nach Anspruch 1, wobei das Mittel zum Ermitteln, ob eine Registrierung durchgeführt werden soll, ferner so ausgelegt ist, dass es entscheidet, einen Zeitgeberwert vom Standortserver zu empfangen, einen Zeitgeber auf der Basis des Zeitgeberwertes einzustellen und eine Registrierung beim Standortserver durchzuführen, wenn der Zeitgeber abläuft.</claim-text></claim><claim id="c-de-01-0007" num="0007"><claim-text>Vorrichtung nach Anspruch 1, wobei das Mittel zum Ermitteln, ob eine Registrierung durchgeführt werden soll, ferner so ausgelegt ist, dass es entscheidet, eine sichere IP-Verbindung mit dem Standortserver herzustellen, die IP-Adresse des Endgeräts über die sichere IP-Verbindung zum Standortserver zu senden und die sichere IP-Verbindung für<!-- EPO <DP n="25"> --> eine nachfolgende Registrierung oder Standortsitzung mit dem Standortserver zu halten.</claim-text></claim><claim id="c-de-01-0008" num="0008"><claim-text>Vorrichtung nach Anspruch 1, wobei das Endgerät ein SUPL-(Secure User Plane Location)-befähigtes Endgerät SET ist und der Standortserver eine Home SUPL Location Platform H-SLP ist.</claim-text></claim><claim id="c-de-01-0009" num="0009"><claim-text>Vorrichtung nach Anspruch 1, wobei das Mittel zum Ermitteln, ob eine Registrierung durchgeführt werden soll, ferner so ausgelegt ist, dass es entscheidet, eine gegenseitige Authentifizierung mit dem Standortserver unter Verwendung von wenigstens einem aus Transport Layer Security TLS, Pre-Shared Key und Transport Layer Security PSK-TLS und Generic Bootstrap Architecture GBA durchzuführen.</claim-text></claim><claim id="c-de-01-0010" num="0010"><claim-text>Verfahren zur drahtlosen Kommunikation, das Folgendes beinhaltet:
<claim-text>Ermitteln (612), ob eine Registrierung bei einem Standortserver durchgeführt werden soll; und</claim-text>
<claim-text>Kommunizieren (614) mit dem Standortserver, um eine Registrierung durchzuführen, wenn die Registrierung beschlossen wird, wobei die dem Standortserver ein Endgerät identifizierende Kommunikation eine gegenseitige Authentifizierung des Endgeräts und des Standortservers einleitet und dem Standortserver eine IP-(Internet Protocol)-Adresse des Endgeräts bereitstellt, wobei die IP-Adresse zur Verwendung durch den Standortserver dient, um Nachrichten zum Endgerät für durch das Netzwerk eingeleitete Ortsdienste zu senden; wobei die dem Standortserver das Endgerät identifizierende Kommunikation<!-- EPO <DP n="26"> --> eine erste IP-Adresse in einem Quelladressfeld und eine zweite IP-Adresse in einem Nutzlastfeld beinhaltet; und</claim-text>
<claim-text>Benutzen, am Standortserver, der zweiten IP-Adresse als die IP-Adresse des Endgeräts, wenn die erste und die zweite IP-Adresse übereinstimmen, und Benutzen der ersten IP-Adresse als die IP-Adresse des Endgeräts, wenn die erste und die zweite IP-Adresse nicht übereinstimmen.</claim-text></claim-text></claim><claim id="c-de-01-0011" num="0011"><claim-text>Verfahren nach Anspruch 10, das ferner Folgendes beinhaltet:
<claim-text>Empfangen eines Zeitgeberwertes vom Standortserver;</claim-text>
<claim-text>Einstellen eines Zeitgebers auf der Basis des Zeitgeberwertes; und</claim-text>
<claim-text>Durchführen einer Registrierung beim Standortserver, wenn der Zeitgeber abläuft.</claim-text></claim-text></claim><claim id="c-de-01-0012" num="0012"><claim-text>Computerprogrammprodukt, das ein computerlesbares Medium mit einem Code umfasst, der bei Ausführung das Verfahren von Anspruch 10 oder 11 durchführt.</claim-text></claim></claims><claims mxw-id="PCLM56980434" lang="EN" load-source="patent-office"><!-- EPO <DP n="20"> --><claim id="c-en-01-0001" num="0001"><claim-text>A system for communication, comprising:
<claim-text>means (820) for determining whether to perform registration with a location server; and</claim-text>
<claim-text>means for communicating with the location server to perform registration if registration is decided, the communication identifying a terminal to the location server, instigating mutual authentication of the terminal and the location server, and providing an Internet Protocol, IP, address of the terminal to the location server, the IP address being for use by the location server to send messages to the terminal for network-initiated location services wherein the communication identifying the terminal to the location server includes a first IP address in a source address field and a second IP address in a payload field; and</claim-text>
<claim-text>means at the location server arranged to use the second IP address as the IP address of the terminal if the first and second IP address is matched and use the first IP address as the IP address of the terminal if the first and second IP addresses do not match.</claim-text></claim-text></claim><claim id="c-en-01-0002" num="0002"><claim-text>The apparatus of claim 1, further comprising:
<claim-text>means for receiving a timer value from the location server;</claim-text>
<claim-text>means for setting a timer based on the timer value; and</claim-text>
<claim-text>means for performing registration with the location server when the timer expires.</claim-text></claim-text></claim><claim id="c-en-01-0003" num="0003"><claim-text>The apparatus of claim 1, wherein the means for determining whether to perform registration is further arranged to decide to perform registration with the location server if the location server does not belong to a home network of the terminal.</claim-text></claim><claim id="c-en-01-0004" num="0004"><claim-text>The apparatus of claim 1, wherein the means for determining whether to perform registration is further arranged to decide to perform registration with the location server if the IP address of the terminal changes.<!-- EPO <DP n="21"> --></claim-text></claim><claim id="c-en-01-0005" num="0005"><claim-text>The apparatus of claim 1, wherein the means for determining whether to perform registration is further arranged to decide to perform registration with the location server when a timer expires.</claim-text></claim><claim id="c-en-01-0006" num="0006"><claim-text>The apparatus of claim 1, wherein the means for determining whether to perform registration is further arranged to decide to receive a timer value from the location server, set a timer based on the timer value, and perform registration with the location server when the timer expires.</claim-text></claim><claim id="c-en-01-0007" num="0007"><claim-text>The apparatus of claim 1, wherein the means for determining whether to perform registration is further arranged to decide to establish a secure IP connection with the location server, send the IP address of the terminal via the secure IP connection to the location server, and maintain the secure IP connection for a subsequent registration or location session with the location server.</claim-text></claim><claim id="c-en-01-0008" num="0008"><claim-text>The apparatus of claim 1, wherein the terminal is a Secure User Plane Location, SUPL, enabled terminal, SET, and the location server is a Home SUPL Location Platform, H-SLP.</claim-text></claim><claim id="c-en-01-0009" num="0009"><claim-text>The apparatus of claim 1, wherein the means for determining whether to perform registration is further arranged to decide to perform mutual authentication with the location server using at least one of Transport Layer Security, TLS, Pre-Shared Key and Transport Layer Security, PSK-TLS, and Generic Bootstrap Architecture, GBA.</claim-text></claim><claim id="c-en-01-0010" num="0010"><claim-text>A method for wireless communication, comprising:
<claim-text>determining (612) whether to perform registration with a location server; and</claim-text>
<claim-text>communicating (614) with the location server to perform registration if registration is decided, the communication identifying a terminal to the location server, instigating mutual authentication of the terminal and the location server, and providing an Internet Protocol,IP, address of the terminal to the location server, the IP address being for use by the location server to send messages to the terminal for network-initiated location services; wherein the communication identifying the terminal to the location server includes a first IP address in a source address field and a second IP address in a payload field; and<!-- EPO <DP n="22"> --></claim-text>
<claim-text>using, at the location server, the second IP address as the IP address of the terminal if the first and second IP address is matched and using the first IP address as the IP address of the terminal if the first and second IP addresses do not match.</claim-text></claim-text></claim><claim id="c-en-01-0011" num="0011"><claim-text>The method of claim 10, further comprising:
<claim-text>receiving a timer value from the location server;</claim-text>
<claim-text>setting a timer based on the timer value; and</claim-text>
<claim-text>performing registration with the location server when the timer expires.</claim-text></claim-text></claim><claim id="c-en-01-0012" num="0012"><claim-text>A computer program product comprising a computer readable medium having a code which when executed undertakes the method of claims 10 or 11.</claim-text></claim></claims><claims mxw-id="PCLM56980435" lang="FR" load-source="patent-office"><!-- EPO <DP n="27"> --><claim id="c-fr-01-0001" num="0001"><claim-text>Système de communication, comprenant :
<claim-text>un moyen (820) pour déterminer qu'il convient ou non d'effectuer un enregistrement auprès d'un serveur de localisation ; et</claim-text>
<claim-text>un moyen pour communiquer avec le serveur de positionnement afin d'effectuer un enregistrement s'il est décidé d'effectuer un enregistrement, la communication identifiant un terminal auprès du serveur de localisation, lancer une authentification mutuelle du terminal et du serveur de localisation, et fournir une adresse de Protocole Internet, IP, du terminal au serveur de localisation, l'adresse IP étant utilisée par le serveur de localisation pour envoyer au terminal des messages de services de localisation lancés par le réseau, la communication identifiant le terminal auprès du serveur de localisation comportant une première adresse IP dans un champ d'adresse source et une seconde adresse IP dans un champ de charge utile ; et</claim-text>
<claim-text>un moyen au niveau du serveur de localisation agencé pour utiliser la seconde adresse IP comme adresse IP du terminal si la première et la seconde adresse IP correspondent et utiliser la première adresse IP comme adresse IP du terminal si les première et seconde adresses IP ne correspondent pas.</claim-text></claim-text></claim><claim id="c-fr-01-0002" num="0002"><claim-text>Appareil selon la revendication 1, comprenant en outre :
<claim-text>un moyen de réception d'une valeur de temporisation depuis le serveur de localisation ;</claim-text>
<claim-text>un moyen de réglage d'une temporisation en fonction de la valeur de temporisation; et</claim-text>
<claim-text>un moyen d'exécution d'un enregistrement auprès du serveur de localisation quand la temporisation arrive à expiration.</claim-text></claim-text></claim><claim id="c-fr-01-0003" num="0003"><claim-text>Appareil selon la revendication 1, dans lequel le moyen de détermination qu'il convient ou non d'effectuer un enregistrement est agencé en outre pour décider d'effectuer un enregistrement auprès du serveur de localisation si le serveur de localisation n'appartient pas à un réseau de rattachement du terminal.</claim-text></claim><claim id="c-fr-01-0004" num="0004"><claim-text>Appareil selon la revendication 1, dans lequel le moyen de détermination qu'il convient ou non d'effectuer un enregistrement est agencé en outre pour décider d'effectuer un enregistrement auprès du serveur de localisation si l'adresse IP du terminal change.<!-- EPO <DP n="28"> --></claim-text></claim><claim id="c-fr-01-0005" num="0005"><claim-text>Appareil selon la revendication 1, dans lequel le moyen de détermination qu'il convient ou non d'effectuer un enregistrement est agencé en outre pour décider d'effectuer un enregistrement auprès du serveur de localisation quand une temporisation expire.</claim-text></claim><claim id="c-fr-01-0006" num="0006"><claim-text>Appareil selon la revendication 1, dans lequel le moyen de détermination qu'il convient ou non d'effectuer un enregistrement est agencé en outre pour décider de recevoir une valeur de temporisation depuis le serveur de localisation, régler une temporisation en fonction de la valeur de temporisation et effectuer un enregistrement auprès du serveur de localisation quand la temporisation arrive à expiration.</claim-text></claim><claim id="c-fr-01-0007" num="0007"><claim-text>Appareil selon la revendication 1, dans lequel le moyen de détermination qu'il convient ou non d'effectuer un enregistrement est agencé en outre pour décider d'établir une connexion IP sécurisée avec le serveur de localisation, envoyer l'adresse IP du terminal via la connexion IP sécurisée au serveur de localisation, et maintenir la connexion IP sécurisée pour un enregistrement ou une session de localisation ultérieur avec le serveur de localisation.</claim-text></claim><claim id="c-fr-01-0008" num="0008"><claim-text>Appareil selon la revendication 1, dans lequel le terminal est un terminal à fonction de Localisation de Plan Utilisateur Sécurisée, SUPL, soit SET, et le serveur de localisation est une Plate-forme de Localisation SUPL de rattachement.</claim-text></claim><claim id="c-fr-01-0009" num="0009"><claim-text>Appareil selon la revendication 1, dans lequel le moyen de détermination qu'il convient ou non d'effectuer un enregistrement est agencé en outre pour décider d'effectuer une authentification mutuelle avec le serveur de localisation en utilisant au moins l'une d'une Sécurité de Couche de Transport, TLS, d'une Sécurité à Clé Pré-Partagée et de Couche de Transport, PSK-TLS, et d'une Architecture d'Amorçage Générique, BGA.</claim-text></claim><claim id="c-fr-01-0010" num="0010"><claim-text>Procédé de communication sans fil, comprenant :
<claim-text>la détermination (612) qu'il convient ou non d'effectuer un enregistrement auprès d'un serveur de localisation ; et</claim-text>
<claim-text>la communication (614) avec le serveur de localisation afin d'effectuer un enregistrement s'il est décidé d'effectuer un enregistrement, la communication identifiant un terminal auprès du serveur de localisation, le lancement d'une authentification mutuelle du terminal et du serveur de localisation, et la fourniture d'une adresse de Protocole Internet, IP, du terminal au serveur de localisation, l'adresse IP étant utilisée par le serveur de<!-- EPO <DP n="29"> --> localisation pour envoyer au terminal des messages de services de localisation lancés par le réseau, la communication identifiant le terminal auprès du serveur de localisation comportant une première adresse IP dans un champ d'adresse source et une seconde adresse IP dans un champ de charge utile ; et</claim-text>
<claim-text>l'utilisation, au niveau du serveur de localisation, de la seconde adresse IP comme adresse IP du terminal si la première et la seconde adresse IP correspondent et l'utilisation de la première adresse IP comme adresse IP du terminal si les première et seconde adresses IP ne correspondent pas.</claim-text></claim-text></claim><claim id="c-fr-01-0011" num="0011"><claim-text>Procédé selon la revendication 10, comprenant en outre :
<claim-text>la réception d'une valeur de temporisation depuis le serveur de localisation ;</claim-text>
<claim-text>le réglage d'une temporisation en fonction de la valeur de temporisation ; et</claim-text>
<claim-text>l'exécution d'un enregistrement auprès du serveur de localisation quand la temporisation arrive à expiration.</claim-text></claim-text></claim><claim id="c-fr-01-0012" num="0012"><claim-text>Produit de programme informatique comprenant un support lisible par ordinateur ayant un code qui, lorsqu'il est exécuté, met en oeuvre le procédé des revendications 10 ou 11.</claim-text></claim></claims><drawings mxw-id="PDW16669158" load-source="patent-office"><!-- EPO <DP n="30"> --><figure id="f0001" num="1A"><img id="if0001" file="imgf0001.tif" wi="155" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0002" num="1B"><img id="if0002" file="imgf0002.tif" wi="155" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0003" num="2"><img id="if0003" file="imgf0003.tif" wi="117" he="201" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0004" num="3"><img id="if0004" file="imgf0004.tif" wi="165" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0005" num="4"><img id="if0005" file="imgf0005.tif" wi="165" he="209" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0006" num="5"><img id="if0006" file="imgf0006.tif" wi="151" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0007" num="6,7"><img id="if0007" file="imgf0007.tif" wi="165" he="178" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="37"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="142" he="233" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
