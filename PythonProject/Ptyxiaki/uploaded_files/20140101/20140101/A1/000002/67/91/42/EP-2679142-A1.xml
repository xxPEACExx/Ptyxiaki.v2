<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2679142-A1" country="EP" doc-number="2679142" kind="A1" date="20140101" family-id="46720403" file-reference-id="311170" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146550926" ucid="EP-2679142-A1"><document-id><country>EP</country><doc-number>2679142</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-11859300-A" is-representative="NO"><document-id mxw-id="PAPP154824849" load-source="docdb" format="epo"><country>EP</country><doc-number>11859300</doc-number><kind>A</kind><date>20111206</date><lang>JA</lang></document-id><document-id mxw-id="PAPP170521157" load-source="docdb" format="original"><country>EP</country><doc-number>11859300.3</doc-number><date>20111206</date><lang>JA</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140450460" ucid="JP-2011036168-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011036168</doc-number><kind>A</kind><date>20110222</date></document-id></priority-claim><priority-claim mxw-id="PPC140447498" ucid="JP-2011078141-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011078141</doc-number><kind>W</kind><date>20111206</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2083187465" load-source="docdb">A61B   1/04        20060101AFI20150313BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2083187820" load-source="docdb">G06T   5/20        20060101ALI20150313BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2083191172" load-source="docdb">G06T   1/00        20060101ALI20150313BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2083191462" load-source="docdb">A61B   5/00        20060101ALI20150313BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1861394621" load-source="docdb" scheme="CPC">G06T   7/12        20170101 LI20170102BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2068540247" load-source="docdb" scheme="CPC">A61B   5/489       20130101 LA20150310BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988100070" load-source="docdb" scheme="CPC">A61B   1/05        20130101 FI20130922BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988121127" load-source="docdb" scheme="CPC">G06T2207/10068     20130101 LA20130826BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988124355" load-source="docdb" scheme="CPC">G06T2207/30101     20130101 LA20130826BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988128304" load-source="docdb" scheme="CPC">A61B   1/00009     20130101 LI20130922BHEP        </classification-cpc><classification-cpc mxw-id="PCL2006762927" load-source="docdb" scheme="CPC">G06T2207/10024     20130101 LA20140128BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132185262" lang="DE" load-source="patent-office">VORRICHTUNG ZUR VERARBEITUNG MEDIZINISCHER BILDER UND VERFAHREN ZUR VERARBEITUNG MEDIZINISCHER BILDER</invention-title><invention-title mxw-id="PT132185263" lang="EN" load-source="patent-office">MEDICAL IMAGE PROCESSING DEVICE AND MEDICAL IMAGE PROCESSING METHOD</invention-title><invention-title mxw-id="PT132185264" lang="FR" load-source="patent-office">DISPOSITIF DE TRAITEMENT D'IMAGE MÉDICALE ET PROCÉDÉ DE TRAITEMENT D'IMAGE MÉDICALE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918133051" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>OLYMPUS MEDICAL SYSTEMS CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR918157860" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>OLYMPUS MEDICAL SYSTEMS CORP.</last-name></addressbook></applicant><applicant mxw-id="PPAR918988779" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Olympus Medical Systems Corp.</last-name><iid>101047431</iid><address><street>43-2, Hatagaya 2-chome Shibuya-ku</street><city>Tokyo 151-0072</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918141788" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>TANAKA KENICHI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1175452258" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>TANAKA, KENICHI</last-name></addressbook></inventor><inventor mxw-id="PPAR918993335" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>TANAKA KENICHI</last-name><address><street>c/o Olympus Medical Systems Corp. 43-2 Hatagaya 2-chome Shibuya-ku</street><city>Tokyo 151-0072</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918171975" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>NISHIMURA HIROKAZU</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1175452259" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>NISHIMURA, HIROKAZU</last-name></addressbook></inventor><inventor mxw-id="PPAR918986761" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>NISHIMURA HIROKAZU</last-name><address><street>c/o Olympus Medical Systems Corp. 43-2 Hatagaya 2-chome Shibuya-ku</street><city>Tokyo 151-0072</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918150823" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>SHIBATA Sawako</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1175452261" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>SHIBATA, SAWAKO</last-name></addressbook></inventor><inventor mxw-id="PPAR918983610" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>SHIBATA Sawako</last-name><address><street>c/o Olympus Medical Systems Corp. 43-2 Hatagaya 2-chome Shibuya-ku</street><city>Tokyo 151-0072</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918173152" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>NONAMI TETSUO</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1175452260" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>NONAMI, TETSUO</last-name></addressbook></inventor><inventor mxw-id="PPAR918994129" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>NONAMI TETSUO</last-name><address><street>c/o Olympus Medical Systems Corp. 43-2 Hatagaya 2-chome Shibuya-ku</street><city>Tokyo 151-0072</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918987745" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Gunzelmann, Rainer</last-name><iid>101143787</iid><address><street>Wuesthoff &amp; Wuesthoff Patent- und Rechtsanwälte Schweigerstrasse 2</street><city>81541 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2011078141-W"><document-id><country>JP</country><doc-number>2011078141</doc-number><kind>W</kind><date>20111206</date><lang>JA</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012114600-A1"><document-id><country>WO</country><doc-number>2012114600</doc-number><kind>A1</kind><date>20120830</date><lang>JA</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548862831" load-source="docdb">AL</country><country mxw-id="DS548918485" load-source="docdb">AT</country><country mxw-id="DS548922138" load-source="docdb">BE</country><country mxw-id="DS548920779" load-source="docdb">BG</country><country mxw-id="DS548907019" load-source="docdb">CH</country><country mxw-id="DS548922139" load-source="docdb">CY</country><country mxw-id="DS548834959" load-source="docdb">CZ</country><country mxw-id="DS548862832" load-source="docdb">DE</country><country mxw-id="DS548922140" load-source="docdb">DK</country><country mxw-id="DS548922141" load-source="docdb">EE</country><country mxw-id="DS548814184" load-source="docdb">ES</country><country mxw-id="DS548920780" load-source="docdb">FI</country><country mxw-id="DS548920781" load-source="docdb">FR</country><country mxw-id="DS548862833" load-source="docdb">GB</country><country mxw-id="DS548922142" load-source="docdb">GR</country><country mxw-id="DS548862834" load-source="docdb">HR</country><country mxw-id="DS548834960" load-source="docdb">HU</country><country mxw-id="DS548907020" load-source="docdb">IE</country><country mxw-id="DS548922143" load-source="docdb">IS</country><country mxw-id="DS548920786" load-source="docdb">IT</country><country mxw-id="DS548922144" load-source="docdb">LI</country><country mxw-id="DS548862835" load-source="docdb">LT</country><country mxw-id="DS548918486" load-source="docdb">LU</country><country mxw-id="DS548920787" load-source="docdb">LV</country><country mxw-id="DS548920788" load-source="docdb">MC</country><country mxw-id="DS548918487" load-source="docdb">MK</country><country mxw-id="DS548918488" load-source="docdb">MT</country><country mxw-id="DS548814185" load-source="docdb">NL</country><country mxw-id="DS548929087" load-source="docdb">NO</country><country mxw-id="DS548814186" load-source="docdb">PL</country><country mxw-id="DS548918489" load-source="docdb">PT</country><country mxw-id="DS548907021" load-source="docdb">RO</country><country mxw-id="DS548918490" load-source="docdb">RS</country><country mxw-id="DS548814187" load-source="docdb">SE</country><country mxw-id="DS548834961" load-source="docdb">SI</country><country mxw-id="DS548929088" load-source="docdb">SK</country><country mxw-id="DS548929089" load-source="docdb">SM</country><country mxw-id="DS548920789" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128671236" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A medical image processing apparatus of the invention includes: a pixel selection portion that selects a pixel of interest from an image; a feature value calculation portion that acquires color tone information of a pixel group which exists in a predetermined range including the pixel of interest and calculates a feature value of the pixel of interest, on the basis of the color tone information; an evaluation value calculation portion that calculates an evaluation value of the pixel of interest on the basis of the calculated feature value; an evaluation value judgment portion that judges whether or not the pixel of interest is a pixel constituting a linear structure on the basis of the calculated evaluation value; and a linear structure detection portion that detects a region where the linear structure exists on the basis of a judgment result by the evaluation value judgment portion, wherein the feature value calculation portion acquires the color tone information for each of the pixel of interest and a plurality of pixels continuous with the pixel of interest, and calculates a feature value of the pixel of interest on the basis of a result of applying a filter designed to suit the linear structure to the acquired color tone information.<img id="iaf01" file="imgaf001.tif" wi="71" he="115" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128500609" lang="EN" source="EPO" load-source="docdb"><p>A medical image processing apparatus of the invention includes: a pixel selection portion that selects a pixel of interest from an image; a feature value calculation portion that acquires color tone information of a pixel group which exists in a predetermined range including the pixel of interest and calculates a feature value of the pixel of interest, on the basis of the color tone information; an evaluation value calculation portion that calculates an evaluation value of the pixel of interest on the basis of the calculated feature value; an evaluation value judgment portion that judges whether or not the pixel of interest is a pixel constituting a linear structure on the basis of the calculated evaluation value; and a linear structure detection portion that detects a region where the linear structure exists on the basis of a judgment result by the evaluation value judgment portion, wherein the feature value calculation portion acquires the color tone information for each of the pixel of interest and a plurality of pixels continuous with the pixel of interest, and calculates a feature value of the pixel of interest on the basis of a result of applying a filter designed to suit the linear structure to the acquired color tone information.</p></abstract><description mxw-id="PDES63956666" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">Technical Field</heading><p id="p0001" num="0001">The present invention relates to a medical image processing apparatus and a medical image processing method and, more particularly, to a medical image processing apparatus and a medical image processing method, for performing processing on a picked-up image of a living tissue inside a body cavity.</p><heading id="h0002">Background Art</heading><p id="p0002" num="0002">Endoscope systems configured to include an endoscope, a medical image processing apparatus, and the like have been widely used. More specifically, an endoscope system is configured to include, for example, an endoscope which is composed of an insertion portion to be inserted into a body cavity of a subject, an objective optical system arranged at a distal end portion of the insertion portion, and an image pickup portion that picks up an image of an object inside the body cavity formed by the objective optical system and outputs the image as image pickup signals and a medical image processing apparatus that performs processing for displaying the image of the object on a monitor or the like as a display portion on the basis of the image pickup signals. The endoscope system with the above-described configuration enables various findings by observing, for example, mucosal color tone, shape of a lesion, a microstructure on a mucosal surface, and the like in a digestive tract mucosa of a stomach or the like.</p><p id="p0003" num="0003">Studies on a technology called CAD (computer aided diagnosis or computer aided detection) as in, for example, <nplcit id="ncit0001" npl-type="s"><text>Kenshi Yao et al., "Sokiigan no bisyokekkankochikuzo niyoru sonzai oyobi kyokaishindan (Diagnosis of Presence and Demarcations of Early Gastric Cancers Using Microvascular Patterns)," Endoscopia Digestiva, Vol. 17, No. 12, pp. 2093-2100, 2005</text></nplcit>, have been in progress in recent years. The technology enables finding and diagnosing a lesion by<!-- EPO <DP n="2"> --> extracting, at a mucosal epithelium inside a body cavity, a region where a microvascular structure or a pit (gland opening) structure exists on the basis of image data obtained through pickup of an image of an object by an endoscope or the like and presenting a result of extracting the region.</p><p id="p0004" num="0004">Additionally, a technique for extracting a blood vessel candidate region as a region where a blood vessel may exist on the basis of image data obtained through pickup of an image of an object by an endoscope or the like and obtaining a result of detecting a blood vessel region as a region where a blood vessel can be regarded as actually existing by performing correction processing such as region expansion or reduction on a result of extracting the blood vessel candidate region is disclosed in, for example, <nplcit id="ncit0002" npl-type="s"><text>Toshiaki Nakagawa et al., "Recognition of Optic Nerve Head Using Blood-Vessel-Erased Image and Its Application to Simulated Stereogram in Computer-Aided Diagnosis System for Retinal Images," IEICE Trans. D, Vol. J89-D, No. 11, pp. 2491-2501, 2006</text></nplcit>.</p><p id="p0005" num="0005">Hemoglobin in erythrocyte has strong absorption characteristics in a band of G (green) light among bands of wavelengths constituting RGB light. For the reason, a density value of G (green) in a region where a blood vessel exists tends to be lower than a density value of G (green) in a region where no blood vessel exists in, for example, image data obtained when an object including the blood vessel is irradiated with RGB light. For example, as a technique which takes the tendency into account, a technique is known for extracting a blood vessel candidate region by applying a band-pass filter to image data obtained through pickup of an image of an object by an endoscope or the like.</p><p id="p0006" num="0006">However, for example, if uniform processing is performed on an entire range of the image data in the correction processing on the result of extracting the blood vessel candidate region, it is impossible to deal with a region where change in color tone occurs locally, which causes a problem that undetected parts and (or) falsely-detected parts of the blood vessel region are likely to be generated.</p><p id="p0007" num="0007">In addition, when the band-pass filter is applied to the image data obtained through pickup of the image of the object including blood vessels, only the region of<!-- EPO <DP n="3"> --> frequency bands which pass through the band-pass filter is extracted as the blood vessel candidate region, which causes a problem that undetected parts and (or) falsely-detected parts of the blood vessel region are likely to be generated.</p><p id="p0008" num="0008">The present invention has been achieved in view of the above-described circumstances, and an object of the present invention is to provide a medical image processing apparatus and a medical image processing method, for enabling blood vessels included in an image to be detected with high accuracy.</p><heading id="h0003">Disclosure of Invention</heading><heading id="h0004">Means for Solving the Problem</heading><p id="p0009" num="0009">A medical image processing apparatus according to one aspect of the present invention includes: a pixel selection portion that selects a pixel of interest from an image obtained by picking up an image of a living tissue; a feature value calculation portion that acquires color tone information of a pixel group which exists in a predetermined range including the pixel of interest and calculates one or more feature values of the pixel of interest, on the basis of the color tone information; an evaluation value calculation portion that calculates an evaluation value of the pixel of interest on the basis of each feature value calculated by the feature value calculation portion; an evaluation value judgment portion that judges whether or not the pixel of interest is a pixel constituting a linear structure, on the basis of the evaluation value calculated by the evaluation value calculation portion; and a linear structure detection portion that detects a region where the linear structure exists in the image, on the basis of a judgment result by the evaluation value judgment portion, wherein the feature value calculation portion acquires the color tone information for each of the pixel of interest and a plurality of pixels continuous with the pixel of interest, and calculates a feature value of the pixel of interest according to a variation of color tone in the linear structure, on the basis of a result of applying a filter which is designed to suit the linear structure to the color tone information acquired at the pixel of interest and the plurality of pixels.</p><p id="p0010" num="0010">A medical image processing method according to one aspect of the present<!-- EPO <DP n="4"> --> invention includes: a pixel selection step of selecting a pixel of interest from an image obtained by picking up an image of a living tissue; a feature value calculation step of acquiring color tone information of a pixel group which exists in a predetermined range including the pixel of interest and calculating one or more feature values of the pixel of interest, on the basis of the color tone information; an evaluation value calculation step of calculating an evaluation value of the pixel of interest on the basis of each feature value calculated in the feature value calculation step; an evaluation value judgment step of judging whether or not the pixel of interest is a pixel constituting a linear structure, on the basis of the evaluation value calculated in the evaluation value calculation step; and a linear structure detection step of detecting a region where the linear structure exists in the image, on the basis of a judgment result in the evaluation value judgment step, wherein the feature value calculation step includes acquiring the color tone information for each of the pixel of interest and a plurality of pixels continuous with the pixel of interest, and calculating a feature value of the pixel of interest according to a variation of color tone in the linear structure on the basis of a result of applying a filter which is designed to suit the linear structure to the color tone information acquired at the pixel of interest and the plurality of pixels.</p><heading id="h0005">Brief Description of the Drawings</heading><p id="p0011" num="0011"><ul><li><figref idrefs="f0001">Fig. 1</figref> is a diagram showing a configuration of a main portion of a medical system including a medical image processing apparatus according to an example of the present invention;</li><li><figref idrefs="f0002">Fig. 2</figref> is a diagram showing an example of a configuration of a calculation processing portion of the medical image processing apparatus according to the present example;</li><li><figref idrefs="f0002">Fig. 3</figref> is a diagram showing an example of a configuration of an evaluation value calculation portion of the calculation processing portion according to the present example;<!-- EPO <DP n="5"> --></li><li><figref idrefs="f0003">Fig. 4</figref> is a flow chart showing an example of processing to be performed by the medical image processing apparatus according to the present example;</li><li><figref idrefs="f0004">Fig. 5</figref> is a graph for explaining variation in a density value of a green component along a cross-sectional direction of a blood vessel; and</li><li><figref idrefs="f0004">Fig. 6</figref> is a view for explaining processing at the time of calculating a second feature value.</li></ul></p><heading id="h0006">Best Mode for Carrying Out the Invention</heading><p id="p0012" num="0012">An embodiment of the present invention will be described below with reference to the drawings. <figref idrefs="f0001 f0002 f0003 f0004">Figs. 1 to 6</figref> relate to an example of the present invention.</p><p id="p0013" num="0013"><figref idrefs="f0001">Fig. 1</figref> is a diagram showing a configuration of a main portion of a medical system including a medical image processing apparatus according to the example of the present invention.</p><p id="p0014" num="0014">As shown in <figref idrefs="f0001">Fig. 1</figref>, a medical system 1 is configured to include a medical observation apparatus 2 which picks up an image of a living tissue as an object inside a body cavity and outputs a video signal, a medical image processing apparatus 3 which is composed of a personal computer or the like and performs image processing on a video signal outputted from the medical observation apparatus 2 and outputs the video signal after the image processing as an image signal, and a monitor 4 which displays an image based on the image signal outputted from the medical image processing apparatus 3.</p><p id="p0015" num="0015">The medical observation apparatus 2 is configured to include an endoscope 6 which is inserted into a body cavity, picks up an image of an object inside the body cavity, and outputs the image as an image pickup signal, a light source apparatus 7 which supplies illuminating light (e.g., RGB light) for illuminating the object, the image of which is to be picked up by the endoscope 6, a camera control unit (hereinafter abbreviated as CCU) 8 which performs various types of control on the endoscope 6 and generates and outputs a video signal by subjecting the image pickup signal outputted from the endoscope 6 to signal processing, and a monitor 9 which<!-- EPO <DP n="6"> --> displays the image of the object picked up by the endoscope 6 on the basis of the video signal outputted from the CCU 8.</p><p id="p0016" num="0016">The endoscope 6 as a medical image pickup apparatus is configured to include an insertion portion 11 which is to be inserted into a body cavity and an operation portion 12 which is provided on a proximal end side of the insertion portion 11. A light guide 13 for transmitting illuminating light supplied from the light source apparatus 7 is inserted through the insertion portion 11 from the proximal end side of the insertion portion 11 to a distal end portion 14 on a distal end side.</p><p id="p0017" num="0017">In the light guide 13, a distal end side is arranged at the distal end portion 14 of the endoscope 6, and a rear end side is configured to be connectable to the light source apparatus 7. With the configuration, illuminating light supplied from the light source apparatus 7 is transmitted by the light guide 13 and then exits through an illuminating window (not shown) which is provided in a distal end face of the distal end portion 14 of the insertion portion 11. A living tissue or the like as an object is illuminated with illuminating light exiting through the illuminating window.</p><p id="p0018" num="0018">An image pickup portion 17 including an objective optical system 16 which is attached to an observation window (not shown) arranged at a position adjacent to the illuminating window and an image pickup device 15 which is arranged at an image formation position of the objective optical system 16 and is composed of a CCD or the like is provided at the distal end portion 14 of the endoscope 6.</p><p id="p0019" num="0019">The image pickup device 15 is connected to the CCU 8 via a signal line. The image pickup device 15 is driven on the basis of a drive signal outputted from the CCU 8 and outputs an image pickup signal obtained by picking up an image of an object formed by the objective optical system 16 to the CCU 8.</p><p id="p0020" num="0020">An image pickup signal inputted to the CCU 8 is subjected to signal processing in a signal processing circuit (not shown) which is provided inside the CCU 8, is converted to a video signal, and is outputted. The video signal outputted from the CCU 8 is inputted to the monitor 9 and the medical image processing<!-- EPO <DP n="7"> --> apparatus 3. With the operations, an image of an object based on the video signal outputted from the CCU 8 is displayed on the monitor 9.</p><p id="p0021" num="0021">The medical image processing apparatus 3 includes an image input portion 21 which subjects a video signal outputted from the medical observation apparatus 2 to processing such as A/D conversion and generates image data, a calculation processing portion 22 which is configured to include a CPU or the like and performs various types of processing on image data and the like outputted from the image input portion 21, a program storage portion 23 which stores, e.g., a program (and software) related to processing to be performed in the calculation processing portion 22, an image storage portion 24 which can store image data and the like outputted from the image input portion 21, and an information storage portion 25 which can temporarily store a processing result from the calculation processing portion 22.</p><p id="p0022" num="0022">The medical image processing apparatus 3 also includes a storage device interface 26 which is connected to a data bus 30 (to be described later), a hard disk 27 which can retain a processing result from the calculation processing portion 22 that is outputted via the storage device interface 26, a display processing portion 28 which generates image signals for displaying as an image a processing result from the calculation processing portion 22 and the like on the monitor 4 and outputs the image signals, and an input operation portion 29 which is configured to include an input device such as a keyboard and can input a parameter in processing by the calculation processing portion 22, operation instructions to the medical image processing apparatus 3, and the like.</p><p id="p0023" num="0023">Note that the image input portion 21, the calculation processing portion 22, the program storage portion 23, the image storage portion 24, the information storage portion 25, the storage device interface 26, the display processing portion 28, and the input operation portion 29 of the medical image processing apparatus 3 are connected to one another via the data bus 30.</p><p id="p0024" num="0024"><figref idrefs="f0002">Fig. 2</figref> is a diagram showing an example of a configuration of the calculation processing portion of the medical image processing apparatus according to the present example.<!-- EPO <DP n="8"> --></p><p id="p0025" num="0025">As shown in <figref idrefs="f0002">Fig. 2</figref>, the calculation processing portion 22 is configured to include a preprocessing portion 221, a blood vessel flag setting portion 222, a pixel selection portion 223, an evaluation value calculation portion 224, an evaluation value judgment portion 225, and a process end condition judgment portion 226 corresponding to functions which are implemented by execution of a program, software, or the like stored in the program storage portion 23.</p><p id="p0026" num="0026"><figref idrefs="f0002">Fig. 3</figref> is a diagram showing an example of a configuration of the evaluation value calculation portion of the calculation processing portion according to the present example.</p><p id="p0027" num="0027">As shown in <figref idrefs="f0002">Fig. 3</figref>, the evaluation value calculation portion 224 of the calculation processing portion 22 is configured to include a first feature value calculation portion 224a, a second feature value calculation portion 224b, a third feature value calculation portion 224c, a fourth feature value calculation portion 224d, and a noise removal portion 224e corresponding to functions which are implemented by execution of a program, software, or the like. Note that the respective functions of the portions of the calculation processing portion 22 will be described later.</p><p id="p0028" num="0028">Action of the medical system 1 with the above-described configuration will be described.</p><p id="p0029" num="0029">First, a user powers on the portions of the medical system 1 and then inserts the insertion portion 11 into, for example, a stomach of a subject until the distal end portion 14 reaches an interior of the stomach. Upon the insertion, an image of an object at the interior of the stomach which is illuminated with illuminating light (RGB light) exiting from the distal end portion 14 is picked up by the image pickup portion 17, and an image pickup signal corresponding to the object having undergone the image pickup is outputted to the CCU 8.</p><p id="p0030" num="0030">The CCU 8 converts the image pickup signal outputted from the image pickup device 15 of the image pickup portion 17 to a video signal by subjecting the image pickup signal to signal processing in the signal processing circuit (not shown) and outputs the video signal to the medical image processing apparatus 3 and the monitor<!-- EPO <DP n="9"> --> 9. The monitor 9 displays the object having undergone the image pickup by the image pickup portion 17 as an image on the basis of the video signal outputted from the CCU 8.</p><p id="p0031" num="0031"><figref idrefs="f0003">Fig. 4</figref> is a flow chart showing an example of processing to be performed by the medical image processing apparatus according to the present example.</p><p id="p0032" num="0032">The image input portion 21 of the medical image processing apparatus 3 generates a piece of image data by subjecting an inputted video signal to processing such as A/D conversion and outputs the generated piece of image data to the calculation processing portion 22 (step S1 in <figref idrefs="f0003">Fig. 4</figref>). Note that a piece of image data generated in the image input portion 21 according to the present example is assumed to have a size of ISX in length × ISY in width (= 640 × 480) and that an R (red) component, a G (green) component, and a B (blue) component of each pixel are assumed to each have levels of eight bits (256 levels).</p><p id="p0033" num="0033">The preprocessing portion 221 of the calculation processing portion 22 subjects the piece of image data inputted from the image input portion 21 to preprocessing including degamma processing and noise removal processing using a median filter (step S2 in <figref idrefs="f0003">Fig. 4</figref>).</p><p id="p0034" num="0034">The blood vessel flag setting portion 222 of the calculation processing portion 22 performs initialization for a blood vessel candidate region as a region where a blood vessel may exist in the piece of image data subjected to the preprocessing in the preprocessing portion 221 (step S3 in <figref idrefs="f0003">Fig. 4</figref>). More specifically, the blood vessel flag setting portion 222 sets or clears a blood vessel candidate region flag in an initial state for each of pixels included in the piece of image data subjected to the preprocessing by the preprocessing portion 221. In the above-described initialization, for example, the blood vessel flag setting portion 222 according to the present example may uniformly set or clear the respective flags of all of the pixels in the piece of image data, may randomly determine whether to set or clear the flag of each pixel in the piece of image data, or may determine whether to set or clear the flag according to a result of thresholding on a feature value related to color tone or the like of each pixel in the piece of image data.<!-- EPO <DP n="10"> --></p><p id="p0035" num="0035">The pixel selection portion 223 of the calculation processing portion 22 selects a pixel P(i,j) of interest at a pixel position (i,j) among the pixels in the piece of image data (step S4 in <figref idrefs="f0003">Fig. 4</figref>). Note that if the size illustrated above (ISX × ISY = 640 × 480) of the piece of image data is taken into account, 0 ≤ i ≤ 639 and 0 ≤ j ≤ 479 hold. The pixel selection portion 223, for example, may select the pixel P(i,j) of interest while scanning the pixels one by one from a pixel at an upper left to a pixel at a lower right of the piece of image data or may randomly select the pixel P(i,j) of interest among the pixels in the piece of image data.</p><p id="p0036" num="0036">The evaluation value calculation portion 224 of the calculation processing portion 22 calculates, using Equation (1) below, an evaluation value V(i,j) of the pixel P(i,j) of interest selected in step S4 of <figref idrefs="f0003">Fig. 4</figref> (step S5 in <figref idrefs="f0003">Fig. 4</figref>). <maths id="math0001" num="(1)"><math display="block"><mi>V</mi><mfenced><mi>i</mi><mi>j</mi></mfenced><mo>=</mo><mfrac><mrow><mi>w</mi><mo>⁢</mo><mn>1</mn><mo>×</mo><msub><mi>f</mi><mi mathvariant="italic">sv</mi></msub><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>2</mn><mo>×</mo><msub><mi>f</mi><mi>d</mi></msub><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>3</mn><mo>×</mo><msub><mi>f</mi><mi>w</mi></msub><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>4</mn><mo>×</mo><msub><mi>f</mi><mi mathvariant="italic">GR</mi></msub><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>5</mn><mo>×</mo><msub><mi>f</mi><mi>n</mi></msub></mrow><mrow><mi>w</mi><mo>⁢</mo><mn>1</mn><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>2</mn><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>3</mn><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>4</mn><mo>+</mo><mi>w</mi><mo>⁢</mo><mn>5</mn></mrow></mfrac></math><img id="ib0001" file="imgb0001.tif" wi="143" he="16" img-content="math" img-format="tif"/></maths></p><p id="p0037" num="0037">Note that values of w1, w2, w3, w4, and w5 in a right-hand side of Equation (1) above are assumed to be weighting factors which are set for the terms f<sub>sv</sub>, f<sub>d</sub>, f<sub>w</sub>, f<sub>GR</sub>, and f<sub>n</sub>, respectively. More specifically, the values of w1, w2, w3, w4, and w5 in the right-hand side of Equation (1) above are set to respective values such as 3, 5, 1, 1, and 1.</p><p id="p0038" num="0038">A specific method for calculating values of f<sub>sv</sub>, f<sub>d</sub>, f<sub>w</sub>, f<sub>GR</sub>, and f<sub>n</sub> in Equation (1) above and the like will be described.</p><p id="p0039" num="0039">The first feature value calculation portion 224a of the evaluation value calculation portion 224 calculates the feature value f<sub>sv</sub> of the pixel P(i,j) of interest selected in step S4 of <figref idrefs="f0003">Fig. 4</figref>.</p><p id="p0040" num="0040">More specifically, the first feature value calculation portion 224a first calculates a value (hereinafter referred to as a G/R value) obtained by dividing a pixel value of a G component by a pixel value of an R component for each pixel in the piece of image data.</p><p id="p0041" num="0041">After that, the first feature value calculation portion 224a applies each of one-dimensional filters F1, F2, and F3 having the filter factors illustrated below to the G/R value (a piece of color tone information) of the pixel P(i,j) of interest and G/R<!-- EPO <DP n="11"> --> values (pieces of color tone information) of two sets of a predetermined number of pixels (linearly) continuous in each of a set of left and right directions, a set of upward and downward directions, a set of first diagonal directions (a 45° direction and a 225° direction), and a set of second diagonal directions (a 135° direction and a 315° direction) from the pixel P(i,j) of interest as a center among a result of calculating the G/R values corresponding to pieces of color tone information of each of the pixels in the piece of image data.<br/>
F1 = {0.182375, 0.32356, 0.1682, -0.3481, -0.652, -0.3481, 0.1682, 0.32356, 0.18238}<br/>
F2 = {0.19347, 0.28177, 0.24509, -0.0356, -0.4009, -0.5676, -0.4009, -0.0356, 0.24509, 0.28177, 0.19347}<br/>
F3 = {0.16261, 0.18215, 0.2109, 0.20337, 0.08723, -0.1554, -0.4214, -0.5389, -0.4214, -0.1554, 0.08723, 0.20337, 0.2109, 0.18215, 0.16261}</p><p id="p0042" num="0042">The above-described one-dimensional filter F1 is a matched filter which is designed so as to be capable of suitably detecting a blood vessel having a width corresponding to five pixels when the one-dimensional filter F1 is applied to a result of calculating G/R values and is configured to have filter factors for nine pixels. That is, the first feature value calculation portion 224a obtains four output values, from which presence or absence of a blood vessel having a width corresponding to five pixels can be judged, by performing a product-sum operation using G/R values of nine pixels, which are composed of the pixel P(i,j) of interest and four pixels continuous in either direction (on either side) from the pixel P(i,j) of interest as the center, and the filter factors of the one-dimensional filter F1 for each of the above-described sets of directions.</p><p id="p0043" num="0043">The above-described one-dimensional filter F2 is a matched filter which is designed so as to be capable of suitably detecting a blood vessel having a width corresponding to seven pixels when the one-dimensional filter F2 is applied to a result of calculating G/R values and is configured to have filter factors for 11 pixels. That is, the first feature value calculation portion 224a obtains four output values, from which presence or absence of a blood vessel having a width corresponding to<!-- EPO <DP n="12"> --> seven pixels can be judged, by performing a product-sum operation using G/R values of 11 pixels, which are composed of the pixel P(i,j) of interest and five pixels continuous in either direction (on either side) from the pixel P(i,j) of interest as the center, and the filter factors of the one-dimensional filter F2 for each of the above-described sets of directions.</p><p id="p0044" num="0044">The above-described one-dimensional filter F3 is a matched filter which is designed so as to be capable of suitably detecting a blood vessel having a width corresponding to nine pixels when the one-dimensional filter F3 is applied to a result of calculating G/R values and is configured to have filter factors for 15 pixels. That is, the first feature value calculation portion 224a obtains four output values, from which presence or absence of a blood vessel having a width corresponding to nine pixels can be judged, by performing a product-sum operation using G/R values of 15 pixels, which are composed of the pixel P(i,j) of interest and seven pixels continuous in either direction (on either side) from the pixel P(i,j) of interest as the center, and the filter factors of the one-dimensional filter F3 for each of the above-described sets of directions.</p><p id="p0045" num="0045">Hemoglobin in erythrocyte has strong absorption characteristics in a band of G (green) light among bands of wavelengths constituting RGB light. For the reason, a density value of a G component in a region where a blood vessel exists tends to be lower than a density value of a G component in a region where no blood vessel exists in, for example, image data obtained when an object including the blood vessel is irradiated with RGB light. If variation in the density value of the G component based on the tendency is plotted along a cross-sectional direction of the blood vessel, the plot has a convex downward shape as in <figref idrefs="f0004">Fig. 5</figref>.</p><p id="p0046" num="0046">That is, each of the one-dimensional filters F1 to F3 is designed to have filter factors that take into account variation in a density value of a G component as illustrated in <figref idrefs="f0004">Fig. 5</figref> and is designed to be capable of detecting a blood vessel having a width corresponding to a predetermined number of pixels substantially without depending on an image pickup condition (e.g., the quantity of illuminating light) when the one-dimensional filter is applied to a result of calculating G/R values.<!-- EPO <DP n="13"> --> Note that, according to the present example, a piece of color tone information to be used is not limited to a G/R value and that any other value such as a G value (a pixel value of a G component), a G/(R+G+B) value (a value obtained by dividing a pixel value of a G component by the sum of a pixel value of an R component, the pixel value of the G component, and a pixel value of a B component), or a luminance value may be used as a piece of color tone information.</p><p id="p0047" num="0047">The first feature value calculation portion 224a sets, as the feature value f<sub>sv</sub> of the pixel P(i,j) of interest, a maximum one among a total of 12 output values obtained by operations using the above-described one-dimensional filters F1, F2, and F3. The first feature value calculation portion 224a also holds a direction orthogonal to a filter application direction when the feature value f<sub>sv</sub> of the pixel P(i,j) of interest is obtained, as a piece of blood vessel running direction-related direction information of the pixel P(i,j) of interest. The first feature value calculation portion 224a further holds a piece of information on the number of pixels corresponding to a blood vessel width which serves as a filter detection target when the feature value f<sub>sv</sub> of the pixel P(i,j) of interest is obtained, as a piece of blood vessel width-related width information of the pixel P(i,j) of interest.</p><p id="p0048" num="0048">Note that the first feature value calculation portion 224a according to the present example is not limited to the above-described configuration which obtains the feature value f<sub>sv</sub> of the pixel P(i,j) of interest using output values of the one-dimensional filters F1 to F3 and may have, for example, a configuration which obtains the feature value f<sub>sv</sub> of the pixel P(i,j) of interest using an output value of a Gabor filter or the like which is designed to suit a blood vessel.</p><p id="p0049" num="0049">The second feature value calculation portion 224b of the evaluation value calculation portion 224 calculates the feature value f<sub>d</sub> pertaining to a blood vessel running direction constraint condition on the basis of the piece of blood vessel running direction-related direction information of the pixel P(i,j) of interest selected in step S4 of <figref idrefs="f0003">Fig. 4</figref> and pieces of blood vessel running direction-related direction information of neighboring pixels P(x,y) of the pixel P(i,j) of interest. Note that, for simplicity, a following description will be given in the context of a case where the<!-- EPO <DP n="14"> --> number of neighboring pixels P(x,y) is eight, i.e., a case where i-1 ≤ x ≤ i+1 and j-1 ≤ y ≤ j+1 hold. If x = y = 0, values of value_d(x,y) and value_w(x,y) (to be described later) are not calculated.</p><p id="p0050" num="0050">More specifically, the second feature value calculation portion 224b first calculates a feature value f<sub>sv1</sub> at the neighboring pixel P(x,y) by applying, for example, any one of the one-dimensional filters F1 to F3 to a result of calculating a G/R value (a piece of color tone information) at the neighboring pixel P(x,y) in each of the set of left and right directions, the set of upward and downward directions, the set of first diagonal directions (the 45° direction and the 225° direction), and the set of second diagonal directions (the 135° direction and the 315° direction) from the neighboring pixel P(x,y) as a center and performing a similar operation to the operation by the first feature value calculation portion 224a. The second feature value calculation portion 224b also holds a direction orthogonal to a filter application direction when the feature value f<sub>sv1</sub> is obtained, as a piece of blood vessel running direction-related direction information of the neighboring pixel P(x,y).</p><p id="p0051" num="0051">Note that the filter application directions at the time of calculating the feature value f<sub>sv1</sub> of the neighboring pixel P(x,y) including the set of left and right directions, the set of upward and downward directions, the set of first diagonal directions (the 45° direction and the 225° direction), and the set of second diagonal directions (the 135° direction and the 315° direction) may be increased or decreased in the process of calculating the feature value f<sub>d</sub> by the second feature value calculation portion 224b. The second feature value calculation portion 224b is not limited to the configuration which uses any one of the one-dimensional filters F1 to F3 at the time of calculating the feature value f<sub>sv1</sub> of the neighboring pixel P(x,y). For example, a band-pass filter which is designed to suit a blood vessel may be used.</p><p id="p0052" num="0052">After that, the second feature value calculation portion 224b calculates a direction-related constraint value_d(x,y) between the pixel P(i,j) of interest and the neighboring pixel P(x,y) by applying the feature value f<sub>sv1</sub> at the neighboring pixel P(x,y) to Equation (2) below. <maths id="math0002" num="(2)"><math display="block"><mi mathvariant="italic">value_d</mi><mfenced><mi>x</mi><mi>y</mi></mfenced><mo>=</mo><mi mathvariant="italic">weight</mi><mo>⁢</mo><mn>1</mn><mo>×</mo><msub><mi>f</mi><mrow><mi mathvariant="italic">sv</mi><mo>⁢</mo><mn>1</mn></mrow></msub></math><img id="ib0002" file="imgb0002.tif" wi="101" he="11" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="15"> --></p><p id="p0053" num="0053">For example, if a blood vessel candidate region flag at the neighboring pixel P(x,y) is on, if the pixel P(i,j) of interest is located in a direction indicated by the piece of direction information of the neighboring pixel P(x,y) from the neighboring pixel P(x,y), and if a direction indicated by the piece of direction information of the pixel P(i,j) of interest and the direction indicated by the piece of direction information of the neighboring pixel P(x,y) are identical to each other, on the basis of the pieces of blood vessel running direction-related direction information of the pixel P(i,j) of interest and the neighboring pixel P(x,y), the second feature value calculation portion 224b sets a value of weight1 in Equation (2) above to 0.2. More specifically, for example, if the blood vessel candidate region flag of the neighboring pixel P(x,y) at a lower right of the pixel P(i,j) of interest in <figref idrefs="f0004">Fig. 6</figref> is on, the above-described conditions are met, and the value of weight1 is set to 0.2. Therefore, if the feature value f<sub>sv1</sub> of the neighboring pixel P(x,y) at the lower right of the pixel P(i,j) of interest in <figref idrefs="f0004">Fig. 6</figref> is 3.1, the constraint value value_d(x,y) is 0.62.</p><p id="p0054" num="0054">Additionally, if the blood vessel candidate region flag at the neighboring pixel P(x,y) is on, the pixel P(i,j) of interest is located in the direction indicated by the piece of direction information of the neighboring pixel P(x,y) from the neighboring pixel P(x,y), and the direction indicated by the piece of direction information of the pixel P(i,j) of interest and the direction indicated by the piece of direction information of the neighboring pixel P(x,y) are orthogonal to each other, on the basis of the pieces of blood vessel running direction-related direction information of the pixel P(i,j) of interest and the neighboring pixel P(x,y), the second feature value calculation portion 224b sets the value of weight1 in Equation (2) above to -0.2. More specifically, for example, if the blood vessel candidate region flag of the neighboring pixel P(x,y) at an upper right of the pixel P(i,j) of interest in <figref idrefs="f0004">Fig. 6</figref> is on, the above-described conditions are met, and the value of weight1 is set to -0.2. Therefore, if the feature value f<sub>sv1</sub> of the neighboring pixel P(x,y) at a lower left of the pixel P(i,j) of interest in <figref idrefs="f0004">Fig. 6</figref> is 3.2, the constraint value value_d(x,y) is -0.64.</p><p id="p0055" num="0055">Moreover, if neither of the two sets of conditions described above is met on the basis of the pieces of blood vessel running direction-related direction information<!-- EPO <DP n="16"> --> of the pixel P(i,j) of interest and the neighboring pixel P(x,y), the second feature value calculation portion 224b obtains the constraint value value_d(x,y) of 0 as a calculation result by setting the value of weight1 in Equation (2) above to 0.</p><p id="p0056" num="0056">Note that the value of weight1 in Equation (2) above is not limited to the above-described values and may be set to other values.</p><p id="p0057" num="0057">The second feature value calculation portion 224b calculates the feature value f<sub>d</sub> of the pixel P(i,j) of interest by performing the operation in Equation (3) below on the basis of a result of calculating the constraint value value_d(x,y). <maths id="math0003" num="(3)"><math display="block"><msub><mi>f</mi><mi>d</mi></msub><mo>=</mo><mfrac><mrow><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>y</mi><mo>=</mo><mo>-</mo><mi>N</mi></mrow><mi>N</mi></munderover></mstyle><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>x</mi><mo>=</mo><mo>-</mo><mi>N</mi></mrow><mi>N</mi></munderover></mstyle><mi mathvariant="italic">value_d</mi><mfenced><mi>x</mi><mi>y</mi></mfenced></mrow><mi mathvariant="italic">TB</mi></mfrac></math><img id="ib0003" file="imgb0003.tif" wi="103" he="26" img-content="math" img-format="tif"/></maths></p><p id="p0058" num="0058">Note that since the constraint value value_d(x,y) is calculated for each of the eight neighboring pixels P(x,y) of the pixel P(i,j) of interest in the present example, a value of N in a right-hand side of Equation (3) above is set to 1.</p><p id="p0059" num="0059">Assume that TB in a denominator of the right-hand side of Equation (3) above is a numeric value larger than 0 and is set to a numeric value equal to the number of pixels, for which a result of calculating the constraint value value_d(x,y) that is other than 0 is obtained, among the eight neighboring pixels P(x,y).</p><p id="p0060" num="0060">For example, if the constraint values value_d(x,y) of each neighboring pixels P(x,y) are all 0 (the value of TB in Equation (3) above is 0) due to, e.g., off state of the blood vessel candidate region flag of each neighboring pixel P(x,y), the second feature value calculation portion 224b sets the value of the feature value f<sub>d</sub> of the pixel P(i,j) of interest to 0 without performing the operation in Equation (3) above.</p><p id="p0061" num="0061">According to the feature value f<sub>d</sub> described above, a feature value f<sub>d</sub> of a pixel where a blood vessel break due to, e.g., pale color tone is estimated to be occurring is larger than a feature value f<sub>d</sub> of another pixel. Therefore, according to the feature value f<sub>d</sub> described above, a region where a blood vessel break is estimated to be occurring in a piece of image data can be extracted as a blood vessel candidate region.<!-- EPO <DP n="17"> --></p><p id="p0062" num="0062">The third feature value calculation portion 224c of the evaluation value calculation portion 224 calculates the feature value f<sub>w</sub> pertaining to a blood vessel width constraint condition on the basis of the piece of blood vessel width-related width information of the pixel P(i,j) of interest selected in step S4 of <figref idrefs="f0003">Fig. 4</figref> and pieces of blood vessel width-related width information of the neighboring pixels P(x,y) of the pixel P(i,j) of interest.</p><p id="p0063" num="0063">More specifically, the third feature value calculation portion 224c first calculates a feature value f<sub>sv2</sub> at the neighboring pixel P(x,y) by applying, for example, the one-dimensional filters F1 to F3 to the result of calculating the G/R value (the piece of color tone information) at the neighboring pixel P(x,y) in each of the set of left and right directions, the set of upward and downward directions, the set of first diagonal directions (the 45° direction and the 225° direction), and the set of second diagonal directions (the 135° direction and the 315° direction) from the neighboring pixel P(x,y) as the center and performing a similar operation to the operation by the first feature value calculation portion 224a. The third feature value calculation portion 224c also holds a piece of information on the number of pixels corresponding to a blood vessel width which serves as a filter detection target when the feature value f<sub>sv2</sub> is obtained, as the piece of blood vessel width-related width information of the neighboring pixel P(x,y).</p><p id="p0064" num="0064">Note that the third feature value calculation portion 224c is not limited to the configuration which uses the one-dimensional filters F1 to F3 at the time of calculating the feature value f<sub>sv2</sub> at the neighboring pixel P(x,y). A plurality of band-pass filters arranged for the respective numbers of pixels corresponding to blood vessel widths that serve as detection targets may be used.</p><p id="p0065" num="0065">After that, the third feature value calculation portion 224c calculates a width-related constraint value_w(x,y) between the pixel P(i,j) of interest and the neighboring pixel P(x,y) by applying the feature value f<sub>sv2</sub> at the neighboring pixel P(x,y) to Equation (4) below. <maths id="math0004" num="(4)"><math display="block"><mi mathvariant="italic">value_w</mi><mfenced><mi>x</mi><mi>y</mi></mfenced><mo>=</mo><mi mathvariant="italic">weight</mi><mo>⁢</mo><mn>2</mn><mo>×</mo><msub><mi>f</mi><mrow><mi mathvariant="italic">sv</mi><mo>⁢</mo><mn>2</mn></mrow></msub></math><img id="ib0004" file="imgb0004.tif" wi="107" he="15" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="18"> --></p><p id="p0066" num="0066">For example, if the blood vessel candidate region flag at the neighboring pixel P(x,y) is on, and if an absolute value of a subtraction result obtained by subtracting the number of pixels corresponding to a blood vessel width included in the piece of width information of the neighboring pixel P(x,y) from the number of pixels corresponding to a blood vessel width included in the piece of width information of the pixel P(i,j) of interest is larger than two, on the basis of the pieces of blood vessel width-related width information of the pixel P(i,j) of interest and the neighboring pixel P(x,y), the third feature value calculation portion 224c sets a value of weight2 in Equation (4) above to -0.2.</p><p id="p0067" num="0067">If the above-described conditions are not met on the basis of the pieces of blood vessel width-related width information of the pixel P(i,j) of interest and the neighboring pixel P(x,y), the third feature value calculation portion 224c obtains the constraint value value_w(x,y) of 0 as a calculation result by setting the value of weight2 to 0.</p><p id="p0068" num="0068">Note that the value of weight2 in Equation (4) above is not limited to the above-described values and may be set to other values.</p><p id="p0069" num="0069">The third feature value calculation portion 224c calculates the feature value f<sub>w</sub> of the pixel P(i,j) of interest by performing the operation in Equation (5) below on the basis of a result of calculating the constraint value value_w(x,y). <maths id="math0005" num="(5)"><math display="block"><msub><mi>f</mi><mi>w</mi></msub><mo>=</mo><mfrac><mrow><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>y</mi><mo>=</mo><mo>-</mo><mi>N</mi></mrow><mi>N</mi></munderover></mstyle><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>x</mi><mo>=</mo><mo>-</mo><mi>N</mi></mrow><mi>N</mi></munderover></mstyle><mi mathvariant="italic">value_w</mi><mfenced><mi>x</mi><mi>y</mi></mfenced></mrow><mi mathvariant="italic">TC</mi></mfrac></math><img id="ib0005" file="imgb0005.tif" wi="111" he="24" img-content="math" img-format="tif"/></maths></p><p id="p0070" num="0070">Note that since the constraint value value_w(x,y) is calculated for each of the eight neighboring pixels P(x,y) of the pixel P(i,j) of interest in the present example, a value of N in a right-hand side of Equation (5) above is set to 1.</p><p id="p0071" num="0071">Assume that TC in a denominator of the right-hand side of Equation (5) above is a numeric value larger than 0 and is set to a numeric value equal to the number of pixels, for which a result of calculating the constraint value value_w(x,y) that is other than 0 is obtained, among the eight neighboring pixels P(x,y).<!-- EPO <DP n="19"> --></p><p id="p0072" num="0072">For example, if the constraint values value_w(x,y) of each neighboring pixels P(x,y) are all 0 (the value of TC in Equation (5) above is 0) due to, e.g., off state of the blood vessel candidate region flag of each neighboring pixel P(x,y), the third feature value calculation portion 224c sets the value of feature value f<sub>w</sub> of the pixel P(i,j) of interest to 0 without performing the operation in Equation (5) above.</p><p id="p0073" num="0073">According to the feature value f<sub>w</sub> described above, a feature value f<sub>w</sub> of a pixel where unnatural variation in blood vessel width is estimated to be occurring is smaller than a feature value f<sub>d</sub> of another pixel. For the reason, according to the feature value f<sub>w</sub> described above, a region where unnatural variation in blood vessel width is estimated to be occurring in a piece of image data can be eliminated from blood vessel candidate regions.</p><p id="p0074" num="0074">The fourth feature value calculation portion 224d of the evaluation value calculation portion 224 calculates the feature value f<sub>GR</sub> pertaining to a color tone constraint condition on the basis of a piece of color tone information indicating correlation among color tone of the pixel P(i,j) of interest selected in step S4 of <figref idrefs="f0003">Fig. 4</figref> and color tones of surrounding pixels of the pixel P(i,j) of interest.</p><p id="p0075" num="0075">More specifically, the fourth feature value calculation portion 224d calculates G/R values (pieces of color tone information) of all pixels included in a rectangular region of a size of 51 × 51 with the pixel P(i,j) of interest at a center and further calculates an average value GRAvg(i,j) of the G/R values.</p><p id="p0076" num="0076">Note that the region used to calculate the average value GRAvg(i,j) is not limited to a rectangular region of a size of 51 × 51 and may be a region of any other size and/or any other shape.</p><p id="p0077" num="0077">The fourth feature value calculation portion 224d may extract only a group of pixels where a blood vessel is highly likely to actually exist from a predetermined region in the piece of image data and calculate the average value GRAvg(i,j). More specifically, the fourth feature value calculation portion 224d may extract a group of pixels where the value of the feature value f<sub>sv</sub> is not less than a predetermined value from a rectangular region of a size of 51 × 51 on the basis of, for example, an operation result from the first feature value calculation portion 224a and calculate the<!-- EPO <DP n="20"> --> average value GRAvg(i,j) on the basis of G/R values of each of pixels belonging to the extracted group of pixels.</p><p id="p0078" num="0078">The fourth feature value calculation portion 224d calculates the feature value f<sub>GR</sub> by applying a result of calculating a G/R value GR(i,j) of the pixel P(i,j) of interest and the average value GRAvg(i,j) to Equation (6) below. <maths id="math0006" num="(6)"><math display="block"><msub><mi>f</mi><mi mathvariant="italic">GR</mi></msub><mo>=</mo><mfenced separators=""><mi mathvariant="italic">GRAvg</mi><mfenced><mi>i</mi><mi>j</mi></mfenced><mo>/</mo><mi mathvariant="italic">GR</mi><mfenced><mi>i</mi><mi>j</mi></mfenced><mo>-</mo><mn>1.0</mn></mfenced><mo>×</mo><mi mathvariant="italic">weight</mi><mo>⁢</mo><mn>3</mn></math><img id="ib0006" file="imgb0006.tif" wi="140" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0079" num="0079">Note that weight3 in Equation (6) above is, for example, a constant which is set to an arbitrary numeric value such as 10.0.</p><p id="p0080" num="0080">The fourth feature value calculation portion 224d may calculate the feature value f<sub>GR</sub> by applying a value obtained by adding or subtracting standard deviation to or from the average value GRAvg(i,j) to Equation (6) above instead of the average value GRAvg(i,j).</p><p id="p0081" num="0081">According to the feature value f<sub>GR</sub> described above, a value of the feature value f<sub>GR</sub> of a pixel where a blood vessel is highly likely to actually exist is positive while a value of the feature value f<sub>GR</sub> of a pixel where a blood vessel is unlikely to actually exist is negative. For the reason, according to the feature value f<sub>GR</sub> described above, a region where a blood vessel is estimated to branch off or blood vessels are estimated to intersect in a piece of image data can be extracted as a blood vessel candidate region.</p><p id="p0082" num="0082">The noise removal portion 224e of the evaluation value calculation portion 224 judges whether a structure of a local region including the pixel P(i,j) of interest selected in step S4 of <figref idrefs="f0003">Fig. 4</figref> results from noise (whether the structure is an isolated point) and calculates the correction value f<sub>n</sub> for correcting the evaluation value V(i,j) on the basis of a result of the judgment.</p><p id="p0083" num="0083">More specifically, if size of the structure resulting from noise (the isolated point) is less than M × M pixels, the noise removal portion 224e counts the number Cs of pixels having respective set blood vessel candidate flags in a (M+2) × (M+2) rectangular region including the pixel P(i,j) of interest and the number Ct of pixels<!-- EPO <DP n="21"> --> having respective set blood vessel candidate flags in a (M+4) × (M+4) rectangular region including the pixel P(i,j) of interest.</p><p id="p0084" num="0084">If Cs = Ct, the noise removal portion 224e judges that the structure of a local region including the pixel P(i,j) of interest results from noise and calculates the correction value f<sub>n</sub> of the pixel P(i,j) of interest by multiplying the feature value f<sub>sv</sub> obtained as an operation result from the first feature value calculation portion 224a by the constant weight4 set to an arbitrary numeric value such as -10.0. On the other hand, if Cs ≠ Ct, the noise removal portion 224e judges that the structure of the local region including the pixel P(i,j) of interest is not a structure resulting from noise and sets the correction value f<sub>n</sub> of the pixel P(i,j) of interest to 0.</p><p id="p0085" num="0085">In a case where a current processing status is far apart from a process end condition in step S9 of <figref idrefs="f0003">Fig. 4</figref> (to be described later), reliability of on/off status of each blood vessel candidate region flag is considered to be low. In view of the circumstances, the noise removal portion 224e may change weight of the correction value f<sub>n</sub> on the basis of correlation between the current processing status and the process end condition in step S9 of <figref idrefs="f0003">Fig. 4</figref>.</p><p id="p0086" num="0086">More specifically, for example, if the process end condition in step S9 of <figref idrefs="f0003">Fig. 4</figref> is defmed by the number of times of processing, and Cs = Ct, the noise removal portion 224e may calculate the correction value f<sub>n</sub> by acquiring a value of weight_num by dividing the number of times processing having been performed thus far by the number of times required to end processing and applying the obtained value of weightl_num to Equation (7) below. <maths id="math0007" num="(7)"><math display="block"><msub><mi>f</mi><mi>n</mi></msub><mo>=</mo><mo>-</mo><mi mathvariant="italic">weight</mi><mo>⁢</mo><mn>4</mn><mo>×</mo><msub><mi>f</mi><mi mathvariant="italic">sv</mi></msub><mo>×</mo><mi mathvariant="italic">weight_num</mi></math><img id="ib0007" file="imgb0007.tif" wi="118" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0087" num="0087">The evaluation value calculation portion 224 of the calculation processing portion 22 calculates the evaluation value V(i,j) of the pixel P(i,j) of interest selected in step S4 of <figref idrefs="f0003">Fig. 4</figref> by applying values of f<sub>sv</sub>, f<sub>d</sub>, f<sub>w</sub>, f<sub>GR</sub>, and f<sub>n</sub> obtained by the above-described processing to Equation (1) above.</p><p id="p0088" num="0088">Note that the evaluation value calculation portion 224 of the calculation processing portion 22 is not limited to the configuration which applies the values of<!-- EPO <DP n="22"> --> f<sub>sv</sub>, f<sub>d</sub>, f<sub>w</sub>, f<sub>GR</sub>, and f<sub>n</sub> to a numerator in Equation (1) above at the time of calculating the evaluation value V(i,j) of the pixel P(i,j) of interest using Equation (1) above. For example, an operation may be performed by selecting, as a value (values) to be applied to the numerator in Equation (1) above, one or more from among the above-described values. Alternatively, the operation may be performed by adding a term other than the above-described values to the numerator in Equation (1) above (note that since the evaluation value V(i,j) cannot be calculated using the correction value f<sub>n</sub> alone due to nature of the correction value f<sub>n</sub>, the correction value f<sub>n</sub> needs to be applied to Equation (1) above together with other values).</p><p id="p0089" num="0089">The evaluation value judgment portion 225 of the calculation processing portion 22 judges whether the evaluation value V(i,j) calculated in step S5 of <figref idrefs="f0003">Fig. 4</figref> is not less than a threshold value Thre (step S6 in <figref idrefs="f0003">Fig. 4</figref>).</p><p id="p0090" num="0090">If a judgment result showing that the evaluation value V(i,j) is not less than the threshold value Thre, i.e., a judgment result showing that the pixel P(i,j) of interest is a pixel constituting a blood vessel is obtained from the evaluation value judgment portion 225, the blood vessel flag setting portion 222 sets the blood vessel candidate region flag of the pixel P(i,j) of interest (updates the blood vessel candidate region flag to be set) (step S7 in <figref idrefs="f0003">Fig. 4</figref>). On the other hand, if a judgment result showing that the evaluation value V(i,j) is less than the threshold value Thre, i.e., a judgment result showing that the pixel P(i,j) of interest is not a pixel constituting a blood vessel is obtained from the evaluation value judgment portion 225, the blood vessel flag setting portion 222 clears the blood vessel candidate region flag of the pixel P(i,j) of interest (updates the blood vessel candidate region flag to be cleared) (step S8 in <figref idrefs="f0003">Fig. 4</figref>).</p><p id="p0091" num="0091">The process end condition judgment portion 226 judges whether the current processing status satisfies the preset process end condition (step S9 in <figref idrefs="f0003">Fig. 4</figref>). More specifically, the process end condition judgment portion 226 judges, for example, whether the processes in step S4 to step S8 of <figref idrefs="f0003">Fig. 4</figref> are performed 10 times for each pixel in the piece of image data or whether the number of times the on/off status of<!-- EPO <DP n="23"> --> the blood vessel candidate region flag at each pixel in the piece of image data is changed (frequency of updates) is less than a predetermined threshold value.</p><p id="p0092" num="0092">If a judgment result showing that the current processing status does not satisfy the preset process end condition is obtained from the process end condition judgment portion 226, the calculation processing portion 22 performs the processes in step S4 to step S9 of <figref idrefs="f0003">Fig. 4</figref> again in the pixel selection portion 223, the evaluation value calculation portion 224, the evaluation value judgment portion 225, and the process end condition judgment portion 226. On the other hand, if a judgment result showing that the current processing status satisfies the preset process end condition is obtained from the process end condition judgment portion 226, the calculation processing portion 22 detects, as a blood vessel region where a blood vessel can be regarded to actually exist, a region composed of pixels having set blood vessel candidate region flags at a point in time when the judgment result is obtained (step S 10 in <figref idrefs="f0003">Fig. 4</figref>).</p><p id="p0093" num="0093">The display processing portion 28 performs coloring or the like on a group of pixels corresponding to a blood vessel region detected by the series of processes in <figref idrefs="f0003">Fig. 4</figref> among the pixels included in the piece of image data inputted from the image input portion 21. With the operation, the display processing portion 28 generates and outputs image signals for displaying an image in which the group of pixels corresponding to the blood vessel region are visualized on the monitor 4.</p><p id="p0094" num="0094">According to the present embodiment described above, among pixels included in a piece of image data obtained through pickup of an image of a living tissue inside a body cavity, ones with high evaluation values V(i,j) can be detected as a blood vessel region. For the reason, according to the present example, a blood vessel included in an image can be detected with high accuracy.</p><p id="p0095" num="0095">Note that the example described above is not limited to detection of a blood vessel and may be widely applied to, for example, detection of a tissue having a linear structure, such as a large intestine pit or an epithelial structure. Note that, for example, if the processing according to the present example is applied to a piece of image data obtained by picking up an image of a large intestine pit stained with<!-- EPO <DP n="24"> --> gentian violet, it is necessary to appropriately change a value to be used as a piece of color tone information, a judgment condition, and the like while taking into account that variation in a density value of a G component along a cross-sectional direction of a blood vessel has not a convex downward shape as illustrated in <figref idrefs="f0004">Fig. 5</figref> but a convex upward shape.</p><p id="p0096" num="0096">Additionally, the above-described example is not limited to application to a piece of image data obtained through image pickup by an endoscope and can also be used to, for example, detect a line segment such as a blood vessel included in a piece of image data obtained by picking up an image of a fundus.</p><p id="p0097" num="0097">The present invention is not limited to the above example. Of course, various changes and applications may be made without departing from scope and spirit of the invention.</p><p id="p0098" num="0098">The present application is filed claiming the priority of Japanese Patent Application No. <patcit id="pcit0001" dnum="WO2011036168A"><text>2011-036168</text></patcit> filed in Japan on February 22, 2011, and the above described disclosure is incorporated by reference in the present description, claims and drawings.</p></description><claims mxw-id="PCLM56977605" lang="EN" load-source="patent-office"><!-- EPO <DP n="25"> --><claim id="c-en-0001" num="0001"><claim-text>A medical image processing apparatus comprising:
<claim-text>a pixel selection portion that selects a pixel of interest from an image obtained by picking up an image of a living tissue;</claim-text>
<claim-text>a feature value calculation portion that acquires color tone information of a pixel group which exists in a predetermined range including the pixel of interest and calculates one or more feature values of the pixel of interest, on the basis of the color tone information;</claim-text>
<claim-text>an evaluation value calculation portion that calculates an evaluation value of the pixel of interest on the basis of each feature value calculated by the feature value calculation portion;</claim-text>
<claim-text>an evaluation value judgment portion that judges whether or not the pixel of interest is a pixel constituting a linear structure, on the basis of the evaluation value calculated by the evaluation value calculation portion; and</claim-text>
<claim-text>a linear structure detection portion that detects a region where the linear structure exists in the image, on the basis of a judgment result by the evaluation value judgment portion,</claim-text>
<claim-text>wherein the feature value calculation portion acquires the color tone information for each of the pixel of interest and a plurality of pixels continuous with the pixel of interest, and calculates a feature value of the pixel of interest according to a variation of color tone in the linear structure, on the basis of a result of applying a filter which is designed to suit the linear structure to the color tone information acquired at the pixel of interest and the plurality of pixels.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The medical image processing apparatus according to claim 1, wherein the feature value calculation portion acquires the color tone information of each of pixels in a neighboring region of the pixel of interest, and further calculates a feature value of the pixel of interest pertaining to a constraint condition for a running direction of the linear structure, on the basis of a result of applying the filter which is designed to suit<!-- EPO <DP n="26"> --> the linear structure to the color tone information acquired at each of the pixels in the neighboring region</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The medical image processing apparatus according to claim 1, wherein the feature value calculation portion acquires the color tone information of each of pixels in a neighboring region of the pixel of interest, and further calculates a feature value of the pixel of interest pertaining to a constraint condition for a width of the linear structure, on the basis of a result of applying the filter which is designed to suit the linear structure to the color tone information acquired at each of the pixels in the neighboring region.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The medical image processing apparatus according to claim 1, wherein the feature value calculation portion acquires the color tone information for each of pixels in a local region including the pixel of interest, and further calculates a feature value of the pixel of interest pertaining to a constraint condition for the color tone of the linear structure, on the basis of the color tone information acquired at each of the pixels in the local region.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The medical image processing apparatus according to claim 1, further comprising a noise removal portion that judges whether or not a structure of a local region including the pixel of interest results from noise, and calculates a correction value for correcting the evaluation value of the pixel of interest on the basis of a result of the judgment.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The medical image processing apparatus according to claim 1, wherein the linear structure detection portion causes the pixel selection portion, the feature value calculation portion, the evaluation value calculation portion, and the evaluation value judgment portion to repeatedly perform processing until a predetermined condition is satisfied, and detects a region where the linear structure exists in the image, on the basis of a judgment result obtained by the evaluation value judgment portion at the<!-- EPO <DP n="27"> --> time that the predetermined condition is satisfied.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>A medical image processing method comprising:
<claim-text>a pixel selection step of selecting a pixel of interest from an image obtained by picking up an image of a living tissue;</claim-text>
<claim-text>a feature value calculation step of acquiring color tone information of a pixel group which exists in a predetermined range including the pixel of interest and calculating one or more feature values of the pixel of interest, on the basis of the color tone information;</claim-text>
<claim-text>an evaluation value calculation step of calculating an evaluation value of the pixel of interest on the basis of each feature value calculated in the feature value calculation step;</claim-text>
<claim-text>an evaluation value judgment step of judging whether or not the pixel of interest is a pixel constituting a linear structure, on the basis of the evaluation value calculated in the evaluation value calculation step; and</claim-text>
<claim-text>a linear structure detection step of detecting a region where the linear structure exists in the image, on the basis of a judgment result in the evaluation value judgment step,</claim-text>
<claim-text>wherein the feature value calculation step includes acquiring the color tone information for each of the pixel of interest and a plurality of pixels continuous with the pixel of interest, and calculating a feature value of the pixel of interest according to a variation of color tone in the linear structure on the basis of a result of applying a filter which is designed to suit the linear structure to the color tone information acquired at the pixel of interest and the plurality of pixels.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The medical image processing method according to claim 7, wherein the feature value calculation step includes acquiring the color tone information of each of pixels in a neighboring region of the pixel of interest, and further calculating a feature value of the pixel of interest pertaining to a constraint condition for a running direction of the linear structure, on the basis of a result of applying the filter which is designed to<!-- EPO <DP n="28"> --> suit the linear structure to the color tone information acquired at each of the pixels in the neighboring region.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The medical image processing method according to claim 7, wherein the feature value calculation step includes acquiring the color tone information of each of pixels in a neighboring region of the pixel of interest, and further calculating a feature value of the pixel of interest pertaining to a constraint condition for a width of the linear structure, on the basis of a result of applying the filter which is designed to suit the linear structure to the color tone information acquired at each of the pixels in the neighboring region.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The medical image processing method according to claim 7, wherein the feature value calculation step includes acquiring the color tone information for each of pixels in a local region including the pixel of interest, and further calculating a feature value of the pixel of interest pertaining to a constraint condition for the color tone of the linear structure, on the basis of the color tone information acquired at each of the pixels in the local region.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The medical image processing method according to claim 7, further comprising a noise removal step of judging whether or not a structure of a local region including the pixel of interest results from noise, and calculating a correction value for correcting the evaluation value of the pixel of interest on the basis of a result of the judgment.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The medical image processing method according to claim 7, wherein the linear structure detection step includes causing the pixel selection portion, the feature value calculation portion, the evaluation value calculation portion, and the evaluation value judgment portion to repeatedly perform processing until a predetermined condition is satisfied, and detecting a region where the linear structure exists in the image on the basis of a judgment result obtained by the evaluation value judgment portion at the<!-- EPO <DP n="29"> --> time that the predetermined condition is satisfied.</claim-text></claim></claims><drawings mxw-id="PDW16668292" load-source="patent-office"><!-- EPO <DP n="30"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0002" num="2,3"><img id="if0002" file="imgf0002.tif" wi="165" he="230" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0003" num="4"><img id="if0003" file="imgf0003.tif" wi="143" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0004" num="5,6"><img id="if0004" file="imgf0004.tif" wi="160" he="230" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="231" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="165" he="231" type="tif"/><doc-page id="srep0003" file="srep0003.tif" wi="165" he="231" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
