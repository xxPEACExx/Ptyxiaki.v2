<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680568-A1" country="EP" doc-number="2680568" kind="A1" date="20140101" family-id="46466387" file-reference-id="318307" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549120" ucid="EP-2680568-A1"><document-id><country>EP</country><doc-number>2680568</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12305736-A" is-representative="YES"><document-id mxw-id="PAPP154823043" load-source="docdb" format="epo"><country>EP</country><doc-number>12305736</doc-number><kind>A</kind><date>20120625</date><lang>EN</lang></document-id><document-id mxw-id="PAPP175260658" load-source="docdb" format="original"><country>EP</country><doc-number>12305736.6</doc-number><date>20120625</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140449591" ucid="EP-12305736-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12305736</doc-number><kind>A</kind><date>20120625</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988114099" load-source="docdb">H04N   5/232       20060101AFI20121207BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1937870508" load-source="docdb" scheme="CPC">G06T2207/20201     20130101 LA20160520BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1937872598" load-source="docdb" scheme="CPC">G06T   5/003       20130101 LI20160520BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2050375752" load-source="docdb" scheme="CPC">H04N   5/23254     20130101 LI20150523BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2050383495" load-source="docdb" scheme="CPC">H04N   5/23267     20130101 FI20150523BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132179844" lang="DE" load-source="patent-office">Videostabilisierung mit Scharfstellung</invention-title><invention-title mxw-id="PT132179845" lang="EN" load-source="patent-office">Video stabilisation with deblurring</invention-title><invention-title mxw-id="PT132179846" lang="FR" load-source="patent-office">Stabilisation vidéo avec décryptage</invention-title><citations><patent-citations><patcit mxw-id="PCIT242651883" load-source="docdb" ucid="US-20060257042-A1"><document-id format="epo"><country>US</country><doc-number>20060257042</doc-number><kind>A1</kind><date>20061116</date></document-id><sources><source name="SEA" category="Y" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242651882" load-source="docdb" ucid="US-6628711-B1"><document-id format="epo"><country>US</country><doc-number>6628711</doc-number><kind>B1</kind><date>20030930</date></document-id><sources><source name="SEA" category="Y" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242651884" load-source="docdb" ucid="WO-2007020569-A2"><document-id format="epo"><country>WO</country><doc-number>2007020569</doc-number><kind>A2</kind><date>20070222</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>R.L. LAGENDIJK; J. BIEMOND: "Handbook of Image and Video Processing", 2005, ELSEVIER ACADEMIC PRESS, article "Basic methods for Image Restoration and Identification", XP055016107</text><sources><source mxw-id="PNPL57485588" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918170434" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ST ERICSSON SA</last-name><address><country>CH</country></address></addressbook></applicant><applicant mxw-id="PPAR918150309" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ST-ERICSSON SA</last-name></addressbook></applicant><applicant mxw-id="PPAR918982447" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ST-Ericsson SA</last-name><iid>101296718</iid><address><street>39 Chemin du Champ-des-Filles</street><city>1228 Plan-les-Ouates</city><country>CH</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918147573" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>AUBERGER STEPHANE</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918165612" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>AUBERGER, STEPHANE</last-name></addressbook></inventor><inventor mxw-id="PPAR918993544" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Auberger, Stéphane</last-name><address><street>7 allée Maurice Ravel</street><city>93160 Noisy le Grand</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918158937" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>CHOULY ANTOINE</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918168141" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>CHOULY, ANTOINE</last-name></addressbook></inventor><inventor mxw-id="PPAR918980246" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>CHOULY, ANTOINE</last-name><address><street>4 rue des Mariniers</street><city>75014 Paris</city><country>FR</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918994112" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Cabinet Plasseraud</last-name><iid>100784233</iid><address><street>52, rue de la Victoire</street><city>75440 Paris Cedex 09</city><country>FR</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548847769" load-source="docdb">AL</country><country mxw-id="DS548843792" load-source="docdb">AT</country><country mxw-id="DS548847775" load-source="docdb">BE</country><country mxw-id="DS548844082" load-source="docdb">BG</country><country mxw-id="DS548842790" load-source="docdb">CH</country><country mxw-id="DS548801433" load-source="docdb">CY</country><country mxw-id="DS548843793" load-source="docdb">CZ</country><country mxw-id="DS548845788" load-source="docdb">DE</country><country mxw-id="DS548847776" load-source="docdb">DK</country><country mxw-id="DS548801434" load-source="docdb">EE</country><country mxw-id="DS548802247" load-source="docdb">ES</country><country mxw-id="DS548844083" load-source="docdb">FI</country><country mxw-id="DS548844084" load-source="docdb">FR</country><country mxw-id="DS548847777" load-source="docdb">GB</country><country mxw-id="DS548847778" load-source="docdb">GR</country><country mxw-id="DS548847779" load-source="docdb">HR</country><country mxw-id="DS548801435" load-source="docdb">HU</country><country mxw-id="DS548842791" load-source="docdb">IE</country><country mxw-id="DS548847780" load-source="docdb">IS</country><country mxw-id="DS548844085" load-source="docdb">IT</country><country mxw-id="DS548801436" load-source="docdb">LI</country><country mxw-id="DS548845789" load-source="docdb">LT</country><country mxw-id="DS548843794" load-source="docdb">LU</country><country mxw-id="DS548846118" load-source="docdb">LV</country><country mxw-id="DS548846119" load-source="docdb">MC</country><country mxw-id="DS548835790" load-source="docdb">MK</country><country mxw-id="DS548835791" load-source="docdb">MT</country><country mxw-id="DS548802248" load-source="docdb">NL</country><country mxw-id="DS548843795" load-source="docdb">NO</country><country mxw-id="DS548802249" load-source="docdb">PL</country><country mxw-id="DS548843796" load-source="docdb">PT</country><country mxw-id="DS548802250" load-source="docdb">RO</country><country mxw-id="DS548801437" load-source="docdb">RS</country><country mxw-id="DS548802251" load-source="docdb">SE</country><country mxw-id="DS548801438" load-source="docdb">SI</country><country mxw-id="DS548835792" load-source="docdb">SK</country><country mxw-id="DS548835793" load-source="docdb">SM</country><country mxw-id="DS548842792" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669790" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Methods of processing a frame in a video sequence of digital images are described, the methods comprising: determining a global motion vector for the frame relative to a previous frame in the sequence; deriving a jitter function from the global motion vector, the jitter function comprising an estimate of undesired motion of the frame relative to the previous frame; determining whether the frame is blurred above a first predetermined threshold; and if so, stabilising the frame using the jitter function and applying a deblur function to the frame.
<img id="iaf01" file="imgaf001.tif" wi="152" he="114" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499163" lang="EN" source="EPO" load-source="docdb"><p>Methods of processing a frame in a video sequence of digital images are described, the methods comprising: determining a global motion vector for the frame relative to a previous frame in the sequence; deriving a jitter function from the global motion vector, the jitter function comprising an estimate of undesired motion of the frame relative to the previous frame; determining whether the frame is blurred above a first predetermined threshold; and if so, stabilising the frame using the jitter function and applying a deblur function to the frame.</p></abstract><description mxw-id="PDES63955220" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>BACKGROUND</b></heading><heading id="h0002"><b>Technical Field</b></heading><p id="p0001" num="0001">The embodiments described herein generally relate to methods for stabilising video images, and more particularly to stabilising video images in the presence of motion blur. The described embodiments also relate to an apparatus adapted for providing stabilised video images, and to a computer program product for performing the described methods.</p><heading id="h0003"><b>Related Art</b></heading><p id="p0002" num="0002">The approaches described in this section could be pursued, but are not necessarily approaches that have been previously conceived or pursued. Therefore, unless otherwise indicated herein, the approaches described in this section are not prior art to the claims in this application and are not admitted to be prior art by inclusion in this section.</p><p id="p0003" num="0003">Techniques for the digital stabilisation of video sequences to remove the effect of unwanted camera motion are known in the art. For example, <patcit id="pcit0001" dnum="WO2007020569A"><text>WO/2007/020569</text></patcit> discloses a method for removing unwanted camcorder movement, or jitter. In the method, a motion estimate between a previous frame and a current frame is made and subsequently the current frame is realigned to counteract this motion.</p><p id="p0004" num="0004">However, the use of such techniques can result in undesired artefacts being observed in the output sequence. For example, if a video sequence contains some frames which are blurred as a result of motion, then a "pumping" effect can be observed wherein isolated unfocussed frames are present in the sequence of otherwise focussed frames. This effect tends to be more obvious to the observer after stabilisation of the sequence has been implemented.</p><p id="p0005" num="0005">Deblurring of single still images is disclosed in, for example, <nplcit id="ncit0001" npl-type="b"><text>R.L. Lagendijk and J. Biemond "Basic methods for Image Restoration and Identification", Handbook of<!-- EPO <DP n="2"> --> Image and Video Processing, Elsevier Academic Press, editor Al Bovik, SD Edition 2005</text></nplcit>. However, such deblur algorithms suffer from the problem that it is difficult to estimate from a single image the motion that caused the blurring in the image. Additionally, motion deblur algorithms are generally sensitive to problems caused by the presence of moving objects within the scene. As a result, artefacts are often observed in a deblurred image.</p><p id="p0006" num="0006">It is an object of the embodiments herein described to obviate at least some of the disadvantages described above.</p><heading id="h0004"><b>SUMMARY</b></heading><p id="p0007" num="0007">In a first aspect, the embodiments provide a method of processing a frame in a video sequence of digital images, the method comprising: determining a global motion vector for the frame relative to a previous frame in the sequence; deriving a jitter function from the global motion vector, the jitter function comprising an estimate of undesired motion of the frame relative to the previous frame; determining whether the frame is blurred above a first predetermined threshold; and if so, stabilising the frame using the jitter function and applying a deblur function to the frame.</p><p id="p0008" num="0008">By applying a deblur function to the stabilised frame, the effect of 'pumping' that is often observed as a result of stabilisation, can be avoided.</p><p id="p0009" num="0009">In embodiments, the method can further comprise determining whether a moving object is present in the frame, and if so, and the frame is determined to be blurred above the first predetermined threshold, stabilising the frame without applying the deblur function. Thus, advantageously, the method can avoid deblurring frames containing local motion blur.</p><p id="p0010" num="0010">In embodiments, the method further comprises determining whether a moving object is present in the frame and, if not, and the frame is determined to be blurred above the first predetermined threshold, stabilising the frame and applying the deblur function. Thus, advantageously, the method can ensure that blurred frames without local motion blur are deblurred.<!-- EPO <DP n="3"> --></p><p id="p0011" num="0011">In embodiments, the method comprises determining whether the frame is blurred above a first predetermined threshold and, if not, stabilising the frame without applying the deblur function. Thus, advantageously, the method can avoid unnecessarily deblurring frames that are not blurred.</p><p id="p0012" num="0012">In embodiments, the kernel size for the deblur function is proportional to the global motion vector determined for the frame. Thus, advantageously the deblur function is matched to the magnitude of the blur for which it is to compensate.</p><p id="p0013" num="0013">In embodiments, the detection of the presence of blur in the frame can be achieved by applying a high-pass filter to the frame. In embodiments, the high-pass filter can be a Laplacian filter. The high-pass filter can be applied over a small window size. The window size can be of the order two pixels. The high-pass filter can be applied in either a horizontal direction or a vertical direction, or alternatively in both horizontal and vertical directions.</p><p id="p0014" num="0014">In embodiments, an overall sharpness measure of the frame is obtained by generating an average of the absolute values of the high-pass filter over part or all of the frame.</p><p id="p0015" num="0015">In embodiments, if the frame is determined to be blurred above a second predetermined threshold, the second threshold indicating that the frame is more blurred than the first threshold, then the frame is repaired.</p><p id="p0016" num="0016">In embodiments, the frame is repaired by determining whether the previous frame in the sequence is blurred above the second threshold, and if not, replacing the frame with the previous frame. Alternatively, in embodiments the frame is repaired by determining whether the subsequent frame in the sequence is blurred above the second threshold, and if not, replacing the frame with the subsequent frame. Alternatively, in embodiments the frame is repaired by determining whether the subsequent frame in the sequence is blurred above the second threshold, and if not, replacing the frame with a temporal upconversion of the previous and the subsequent frames.<!-- EPO <DP n="4"> --></p><p id="p0017" num="0017">Thus, advantageously if a frame is deemed to be too blurred, it can be replaced with a less blurred frame.</p><p id="p0018" num="0018">In embodiments, a blurred frame can be replaced with a frame that is not adjacent to the frame in question, but merely close to the frame in the sequence.</p><p id="p0019" num="0019">In embodiments, the method is repeated for substantially all of the frames in the sequence. Thus, a stabilised video sequence can be generated.</p><p id="p0020" num="0020">In a second aspect, the described embodiments provide a computer program product comprising computer readable code which, when implemented on a processor causes the processor to perform any of the methods described herein.</p><p id="p0021" num="0021">In embodiments, the computer program product is embodied on a computer readable medium. The computer readable medium can, for example comprise a storage medium.</p><p id="p0022" num="0022">In a third aspect, the embodiments provide a device for processing a frame in a video sequence of digital images, the device comprising a processor configured to: determine a global motion vector for the frame relative to a previous frame in the sequence; derive a jitter function from the global motion vector, the jitter function comprising an estimate of undesired motion of the frame relative to the previous frame; determine whether the frame is blurred above a first predetermined threshold; and if so, stabilising the frame using the jitter function and applying a deblur function to the frame.</p><p id="p0023" num="0023">In embodiments, the device comprises one of a digital still camera, a digital camcorder or a mobile telephone including a digital camera.</p><heading id="h0005"><b>BRIEF DESCRIPTION OF THE DRAWINGS</b></heading><p id="p0024" num="0024">Embodiments are illustrated by way of example, and not by way of limitation, in the figures of the accompanying drawings, in which like reference numerals refer to similar elements and in which:
<ul><li><figref idrefs="f0001">Figure 1</figref> is a schematic illustration of an algorithm according to a first embodiment as embodied in a device;<!-- EPO <DP n="5"> --></li><li><figref idrefs="f0001">Figure 2</figref> illustrates details of the video stabilisation module of <figref idrefs="f0001">Figure 1</figref>;</li><li><figref idrefs="f0002">Figure 3</figref> illustrates detail of the sharpness measure module of <figref idrefs="f0001">Figure 1</figref>;</li><li><figref idrefs="f0002">Figure 4</figref> illustrates detail of the deblur decision module of <figref idrefs="f0001">Figure 1</figref>;</li><li><figref idrefs="f0003">Figure 5</figref> illustrates detail of the motion compensation and deblur processing modules of <figref idrefs="f0001">Figure 1</figref>; and</li><li><figref idrefs="f0003">Figure 6</figref> illustrates detail of the frame repair process implemented by the deblur processing module of <figref idrefs="f0001">Figure 1</figref>.</li></ul></p><heading id="h0006"><b>DETAILED DESCRIPTION</b></heading><p id="p0025" num="0025"><figref idrefs="f0001">Figure 1</figref> illustrates a simplified view of the algorithm according to the presently described embodiment as embodied in a device 100. The device 100 can be any electronic device configured to receive or generate a video sequence.</p><p id="p0026" num="0026">The algorithm begins with the receipt of a current frame 101 of a video sequence. The current frame 101 is processed by three processing modules; a video stabilisation module 105, a motion compensation module 103 and a sharpness measuring module 107.</p><p id="p0027" num="0027">The video stabilisation module 105 has two outputs, a jitter vector 115 and a Global Motion Vector (GMV) 118. The jitter vector 115 contains a measure of the undesired motion, or jitter, present in the processed current frame 101, while the GMV 118 contains a measure of the motion within the frame including the jitter. The jitter vector 115 and the GMV 118 will be explained in more detail below.</p><p id="p0028" num="0028">The jitter vector 115 output from the video stabilisation module 105 is applied as a further input to the motion compensation module 103 to generate a version of the current frame 101 in which the motion due to jitter has been compensated. This jitter-compensated frame 121 is output from the motion compensation module 103. The process of jitter compensation will be explained in more detail below.</p><p id="p0029" num="0029">In conjunction with the GMV 118, the output from the sharpness measuring module 107 is applied to a deblur decision module 109 to determine whether<!-- EPO <DP n="6"> --> deblurring needs to be applied to the current frame 101. Again, further details of the deblur decision module 109 are provided below.</p><p id="p0030" num="0030">This decision 119 made by the deblur decision module 109 is applied to a deblur processing module 111. The deblur processing module 111 also receives the jitter-compensated frame 121 from the motion compensation module 103 as a further input. On the basis of the decision 119, the deblur processing module 111 determines a processing to be applied to the jitter-compensated frame. Further details of this processing are given below.</p><p id="p0031" num="0031">The stabilised and deblurred frame 123 is then output from the deblur processing module 111, and forms the output 113 from the algorithm.</p><p id="p0032" num="0032">The above process is repeated for each frame within a video sequence to be processed, with the exception of the first frame. The first frame is used only for comparison with the second frame to derive the various parameters related to the motion of the frame.</p><p id="p0033" num="0033"><figref idrefs="f0001">Figure 2</figref> illustrates further detail of the video stabilisation module 105.</p><p id="p0034" num="0034">The current frame 101 is input to both a GMV module 123 and an internal motion module 125.</p><p id="p0035" num="0035">The GMV module 123 extracts the GMV of the current frame in pixel units. The measure of the GMV is made relative to the previous frame, thus, the GMV module 123 receives as a further input 135 the previous frame. The extraction of the GMV is made using techniques known in the art of which the skilled person will be aware. The precise method by which the GMV is obtained is not important to the functioning of the described embodiment.</p><p id="p0036" num="0036">The GMV module outputs 118 the GMV to both a filter 129 and to a storage unit (not illustrated). The storage unit retains the GMV 118 for the current frame 101 for use with the subsequent application of the algorithm with the next frame in the sequence.<!-- EPO <DP n="7"> --></p><p id="p0037" num="0037">The filter 129 filters the GMV 118 in time to retain only intentional motion, such as panning of a scene. The skilled person will be aware of filters in the prior art that can be used for this purpose, and so the exact method of filtering will not be described here. The output 115 of the filter 129 is a jitter vector, which defines the undesirable motion in the current frame 101.</p><p id="p0038" num="0038">The internal motion module 125 performs a measure of the internal motion within the frame 101, to detect the presence of moving objects within the frame 101. This is achieved by computing the global disparity between all macroblock motion vectors of the frame 101 in comparison to the calculated GMV for the frame 101. The internal motion measure 117 resulting from this calculation is output for later use as will be explained below.</p><p id="p0039" num="0039"><figref idrefs="f0002">Figure 3</figref> illustrates details of the sharpness measuring module 107. As described above, the sharpness measuring module 107 receives the current frame 101. A high-pass filter 137 is then applied to the frame. For this purpose, a Laplacian filter is used. However, the skilled person will recognise that the particular type of high-pass filter used is not critical to the function of the described embodiment.</p><p id="p0040" num="0040">The high-pass filter is applied over a small window in the frame, of the order of two to three pixels. The average of the absolute value of the output from the high-pass filter 137 is then calculated over the entire filtered frame. This yields a measure of the sharpness of the current frame 101.</p><p id="p0041" num="0041"><figref idrefs="f0002">Figure 4</figref> illustrates the deblur decision module 109 in detail. A threshold module 145 applies thresholds to the output 143 of the sharpness measuring module 107. Two thresholds, a and b are set for the output value, x. The higher threshold is b, while the lower threshold is a.</p><p id="p0042" num="0042">If the sharpness, x is above the upper threshold (i.e. x&gt;b), then the frame is deemed to be sharp. If the sharpness, x, is between the upper and lower thresholds (i.e. if b&gt;x&gt;a) then the frame is deemed to be moderately blurred. If the sharpness, x, is below the lower threshold (i.e. x&lt;a), then the frame is deemed to be very blurred.<!-- EPO <DP n="8"> --></p><p id="p0043" num="0043">If the frame 101 is deemed to be sharp (x&gt;b), then the deblur decision module 109 will determine that the frame should not be deblurred, but that it will be stabilised. This decision is output as an indicator 147 to the effect that stabilisation only should be applied to the frame 101.</p><p id="p0044" num="0044">If the frame 101 is deemed to be moderately blurred (b&gt;x&gt;a), then an object motion test module 149 tests for the presence of moving objects in the frame 101. For this test, the internal motion measure 117 derived by the video stabilisation module 105 is used. If the internal motion measure 117 is above a predetermined threshold, then the internal motion test module 149 determines that there are moving objects in the frame 101. In this event, the deblur decision module 109 again outputs an indicator 151 that the frame 101 should be stabilised but not deblurred. If the internal motion measure 117 is below the predetermined threshold, then the internal motion test module 149 determines that there are no moving objects in the frame 101. In this event, the deblur decision module 109 outputs an indicator 153 that the frame 101 should be both stabilised and deblurred.</p><p id="p0045" num="0045">If the frame is deemed to be very blurred (x&lt;a), then the deblur decision module 109 outputs an indicator 155 that the frame 101 should be repaired, but neither stabilised nor deblurred. The details of the repair process will be described below in relation to <figref idrefs="f0003">Figure 6</figref>.</p><p id="p0046" num="0046">The particular indicator output 156 by the deblur decision module 109 is then passed to the deblur processing module 111.</p><p id="p0047" num="0047"><figref idrefs="f0003">Figure 5</figref> illustrates details of the deblur processing module 111 and motion compensation module 103. To stabilise the frame 101, the frame 101 is passed to the motion compensation module 103. The motion compensation module 103 also receives the jitter vector 115 calculated by the video stabilisation module 105. The motion compensation module 103 calculates the inverse of the jitter vector 115, and applies this to the current frame 101 to yield a jitter-compensated frame 121 as an output frame 113.</p><p id="p0048" num="0048">If the indicator 156 received from the deblur decision module 109 indicates that stabilisation but not deblur processing should be carried out, then the stabilised<!-- EPO <DP n="9"> --> (jitter-compensated) frame 121 is passed through the deblur processing module 111 and forms the output frame 113. If the indicator 156 indicates that both stabilisation and deblurring should be carried out, then the motion compensated frame 157 is passed to a point spread function (PSF) estimator 159.</p><p id="p0049" num="0049">The PSF estimator 159 estimates the PSF of the jitter-compensated frame 121. Processes for estimating the PSF are known in the art, and so a full description will not be repeated here. Instead, it is sufficient to note that the PSF estimator 159 woks on the assumption that the camera has moved in a linear fashion at a constant speed between a previous frame and the current frame 101. The motion amplitude is considered to be proportional to the GMV 118 calculated by the video stabilisation module 1105. Thus, the PSF estimator 159 receives the GMV 118 as an input, and outputs an estimated PSF 163. The skilled person will recognise how to perform such a calculation, and so the details will not be provided here.</p><p id="p0050" num="0050">After the PSF has been calculated, the jitter-compensated frame 121 undergoes deblur using the estimated PSF 163. Again, the skilled person will recognise how to apply deblur processing using a PSF estimation, and so the details will not be presented here.</p><p id="p0051" num="0051">The resulting stabilised and deblurred frame then forms the output frame 113. Since the frame is both stabilised and deblurred, the problem of "pumping", wherein individual frames, which suffer from motion blur, appear blurred while the remainder of the video is sharp, is reduced.</p><p id="p0052" num="0052">If the received indicator 156 indicates that the frame should be repaired then the deblur processing module 111 implements a repair process. The repair process is illustrated in <figref idrefs="f0003">Figure 6</figref>. Firstly, the deblur processing module determines 164 whether a frame delay is acceptable. For example, if the implementation relates to the processing of live video, then a frame delay is generally not acceptable. However, if the implementation relates to the post-processing of pre-recorded video, then a delay of a single frame may well be acceptable.</p><p id="p0053" num="0053">If a frame delay is not acceptable, then the deblur processing module 111 determines 167 whether the indicator it received in respect of the previous frame indicated that the previous frame should be repaired. If not, then the frame output<!-- EPO <DP n="10"> --> during the previous instance of the algorithm is copied and used 175 as the output frame 113.</p><p id="p0054" num="0054">If the result of the determination 167 is that the previous frame should also be repaired, then the deblur processing module 111 determines 173 that no deblurring improvement can be made to the current frame 101. The current frame 101 is then treated as described above for the situation wherein the indicator 156 received from the deblur decision module 109 indicated that stabilisation but not deblur processing should be carried out. Accordingly, the jitter-compensated frame 121 is passed through the deblur processing module 111 and forms the output frame 113.</p><p id="p0055" num="0055">If a frame delay is determined 164 to be acceptable, then the deblur processing module 111 determines 165 whether the indicator in respect of the subsequent frame indicates that the subsequent frame should be repaired. If the result of this determination 165 is that the subsequent frame should not be repaired, then a temporal upconversion is performed 171 on the previous and subsequent frames, the output from which is used as the output frame 113. The skilled person will recognise how to perform a temporal upconversion on the previous and subsequent frames, and so the details of this process will not be repeated here.</p><p id="p0056" num="0056">If the result of the determination 165 is that the subsequent frame should also be repaired, then the deblur processing module 111 determines 169 that no deblurring improvement can be made to the current frame 101. The current frame 101 is then treated as described above for the situation wherein the indicator 156 received from the deblur decision module 109 indicated that stabilisation but not deblur processing should be carried out. Accordingly, the jitter-compensated frame 121 is passed through the deblur processing module 111 and forms the output frame 113.</p><p id="p0057" num="0057">In an alternative or complimentary embodiment the GMV includes a measure of rotational motion and/or image zoom between frames.</p><p id="p0058" num="0058">In a further or complimentary embodiment, the device 100 in which the algorithm as described above is implemented is an electronic circuit.<!-- EPO <DP n="11"> --></p><p id="p0059" num="0059">In a further or complimentary embodiment the device 100 in which algorithm as described above is implemented is a digital still camera or a digital camcorder.</p><p id="p0060" num="0060">In a further or complimentary embodiment the device 100 in which the algorithm as described above is implemented is a video processing device.</p><p id="p0061" num="0061">In a further or complimentary embodiment the device 100 in which the algorithm as described above is implemented is a general processing device, such as a personal computer, suitably programmed to implement the algorithm as described above.</p><p id="p0062" num="0062">It is to be understood that the algorithms as described above are both applicable to the stabilisation of live image sequences, and also to the stabilisation of pre-recorded image sequences.</p><p id="p0063" num="0063">While there has been illustrated and described what are presently considered to be the preferred embodiments of the present invention, it will be understood by those skilled in the art that various other modifications may be made, and equivalents may be substituted, without departing from the true scope of the present invention. Additionally, many modifications may be made to adapt a particular situation to the teachings of the present invention without departing from the central inventive concept described herein. Furthermore, an embodiment of the present invention may not include all of the features described above. Therefore, it is intended that the present invention not be limited to the particular embodiments disclosed, but that the invention include all embodiments falling within the scope of the invention as broadly defined above. In particular, the embodiments describe above could be combined.</p><p id="p0064" num="0064">Expressions such as "comprise", "include", "incorporate", "contain", "is" and "have" are to be construed in a non-exclusive manner when interpreting the description and its associated claims, namely construed to allow for other items or components which are not explicitly defined also to be present. Reference to the singular is also to be construed in be a reference to the plural and vice versa.<!-- EPO <DP n="12"> --></p><p id="p0065" num="0065">A person skilled in the art will readily appreciate that various parameters disclosed in the description may be modified and that various embodiments disclosed may be combined without departing from the scope of the invention.</p><p id="p0066" num="0066">It is to be understood that the methods of the described embodiments can be implemented in hardware, or in software or in some combination of both hardware and software. A single piece of hardware or software can carry out several of the functions as described. The hardware and/or software items can be implemented in several manners, such as by means of wired electronic circuits or by means of an integrated circuit that is programmed accordingly.</p><p id="p0067" num="0067">It is stipulated that the reference signs in the claims do not limit the scope of the claims, but are merely inserted to enhance the legibility of the claims.</p></description><claims mxw-id="PCLM56976133" lang="EN" load-source="patent-office"><!-- EPO <DP n="13"> --><claim id="c-en-0001" num="0001"><claim-text>A method of processing a frame (101) in a video sequence of digital images, the method comprising:
<claim-text>determining a global motion vector (118) for the frame (101) relative to a previous frame in the sequence;</claim-text>
<claim-text>deriving a jitter function (115) from the global motion vector (118), the jitter function (115) comprising an estimate of undesired motion of the frame (101) relative to the previous frame;</claim-text>
<claim-text>determining whether the frame (101) is blurred above a first predetermined threshold; and</claim-text>
<claim-text>if so, stabilising the frame (101) using the jitter function (115) and applying a deblur function to the frame (101).</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>A method according to claim 1 further comprising determining (117) whether a moving object is present in the frame (101), and if so, and the frame (101) is determined to be blurred above the first predetermined threshold, stabilising the frame (101) without applying the deblur function.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>A method according to claim 2, wherein if a moving object is not determined to be present in the frame (101), and the frame (101) is determined to be blurred above the first predetermined threshold, stabilising the frame (101) and applying the deblur function.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>A method according to any preceding claim, wherein if the frame (101) is not blurred above the first predetermined threshold, stabilising the frame (101) without applying the deblur function.<!-- EPO <DP n="14"> --></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>A method according to any preceding claim wherein determining whether the frame (101) is blurred comprises applying a high-pass filter (137) to the frame (101).</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A method according to claim 5, wherein the high-pass filter (137) comprises a Laplacian filter.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>A method according to any preceding claim, wherein if the frame (101) is determined to be blurred above a second predetermined threshold, the second threshold indicating that the frame is more blurred than the first threshold, repairing the frame (101).</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A method according to claim 7, wherein repairing the frame (101) comprises determining whether the previous frame is blurred above the second threshold, and if not, replacing the frame (101) with the previous frame.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>A method according to claim 7, wherein repairing the frame (101) comprises determining whether the subsequent frame is blurred above the second threshold, and if not, replacing the frame with a temporal upconversion of the previous and the subsequent frames.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A method according to any preceding claim, wherein the method is repeated for substantially all of the frames in the sequence.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>A method according to any preceding claim, wherein the kernel size for the deblur function is proportional to the global motion vector determined for the frame (101).<!-- EPO <DP n="15"> --></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>A computer program product comprising computer readable code which, when implemented on a processor causes the processor to perform the method according to any preceding claim.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>A computer readable medium comprising the computer program product according to claim 12.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A device for processing a frame (101) in a video sequence of digital images, the device comprising a processor configured to:
<claim-text>determinine a global motion vector (118) for the frame (101) relative to a previous frame in the sequence;</claim-text>
<claim-text>derive a jitter function (115) from the global motion vector (118), the jitter function (115) comprising an estimate of undesired motion of the frame (101) relative to the previous frame;</claim-text>
<claim-text>determine whether the frame (101) is blurred above a first predetermined threshold; and</claim-text>
<claim-text>if so, stabilising the frame (101) using the jitter function (115) and applying a deblur function to the frame (101).</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>A device according to claim 14, wherein the device comprises one of a digital still camera, a digital camcorder or a mobile telephone including a digital camera.</claim-text></claim></claims><drawings mxw-id="PDW16666918" load-source="patent-office"><!-- EPO <DP n="16"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="17"> --><figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="18"> --><figure id="f0003" num="5,6"><img id="if0003" file="imgf0003.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="155" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="155" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
