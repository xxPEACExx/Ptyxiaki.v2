<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680657-A1" country="EP" doc-number="2680657" kind="A1" date="20140101" family-id="46545705" file-reference-id="315734" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549056" ucid="EP-2680657-A1"><document-id><country>EP</country><doc-number>2680657</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12305764-A" is-representative="YES"><document-id mxw-id="PAPP154822979" load-source="docdb" format="epo"><country>EP</country><doc-number>12305764</doc-number><kind>A</kind><date>20120628</date><lang>EN</lang></document-id><document-id mxw-id="PAPP173226833" load-source="docdb" format="original"><country>EP</country><doc-number>12305764.8</doc-number><date>20120628</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140447102" ucid="EP-12305764-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12305764</doc-number><kind>A</kind><date>20120628</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988100664" load-source="docdb">H04W  74/06        20090101AFI20121120BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1988106432" load-source="docdb">G06K  19/07        20060101ALI20121120BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1880667971" load-source="docdb" scheme="CPC">G06K  19/0725      20130101 LI20161111BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1880667972" load-source="docdb" scheme="CPC">G06K  19/0723      20130101 LI20161111BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2059334926" load-source="docdb" scheme="CPC">H04B   5/0031      20130101 LI20150507BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2059336856" load-source="docdb" scheme="CPC">H04W  74/06        20130101 LI20150508BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2059340105" load-source="docdb" scheme="CPC">H04B   5/0056      20130101 FI20150508BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132179652" lang="DE" load-source="patent-office">Emulation mehrerer NFC-Vorrichtungen im Inneren einer Kommunikationsvorrichtung</invention-title><invention-title mxw-id="PT132179653" lang="EN" load-source="patent-office">Emulation of multiple NFC devices inside a communication device</invention-title><invention-title mxw-id="PT132179654" lang="FR" load-source="patent-office">Émulation de plusieurs dispositifs NFC à l'intérieur d'un dispositif de communication</invention-title><citations><patent-citations><patcit mxw-id="PCIT242651766" load-source="docdb" ucid="US-20090184826-A1"><document-id format="epo"><country>US</country><doc-number>20090184826</doc-number><kind>A1</kind><date>20090723</date></document-id><sources><source name="SEA" category="X" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242651765" load-source="docdb" ucid="WO-2007077471-A1"><document-id format="epo"><country>WO</country><doc-number>2007077471</doc-number><kind>A1</kind><date>20070712</date></document-id><sources><source name="SEA" category="X" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242651767" load-source="docdb" ucid="WO-2012065643-A1"><document-id format="epo"><country>WO</country><doc-number>2012065643</doc-number><kind>A1</kind><date>20120524</date></document-id><sources><source name="SEA" category="X" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>None</text><sources><source mxw-id="PNPL45130679" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918162413" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ST ERICSSON SA</last-name><address><country>CH</country></address></addressbook></applicant><applicant mxw-id="PPAR918135360" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ST-ERICSSON SA</last-name></addressbook></applicant><applicant mxw-id="PPAR918987794" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ST-Ericsson SA</last-name><iid>101296718</iid><address><street>39 Chemin du Champ-des-Filles</street><city>1228 Plan-les-Ouates</city><country>CH</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918143663" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SOCOL CONSTANTIN</last-name><address><country>SG</country></address></addressbook></inventor><inventor mxw-id="PPAR918162827" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SOCOL, CONSTANTIN</last-name></addressbook></inventor><inventor mxw-id="PPAR918978782" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SOCOL, CONSTANTIN</last-name><address><street>BLK 40, Toh Tuck Road, N°04-08, Good Luck Garden</street><city>596717 Singapore</city><country>SG</country></address></addressbook></inventor><inventor mxw-id="PPAR918151042" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>GOFFIN FREDERIC</last-name><address><country>SG</country></address></addressbook></inventor><inventor mxw-id="PPAR918159994" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>Goffin, Frederic</last-name></addressbook></inventor><inventor mxw-id="PPAR918990700" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>Goffin, Frederic</last-name><address><street>88 Jellicoe Road, N°31-22</street><city>208747 Singapore</city><country>SG</country></address></addressbook></inventor><inventor mxw-id="PPAR918153580" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>JAUNET GUILLAUME</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918172041" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>JAUNET, Guillaume</last-name></addressbook></inventor><inventor mxw-id="PPAR918993028" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>JAUNET, Guillaume</last-name><address><street>Les Genets de St Jean A2-33 avenue Jean XXIII</street><city>06130 Grasse</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918149431" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>JHAWAR AMIT</last-name><address><country>SG</country></address></addressbook></inventor><inventor mxw-id="PPAR918164713" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>JHAWAR, AMIT</last-name></addressbook></inventor><inventor mxw-id="PPAR918989029" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>JHAWAR, AMIT</last-name><address><street>Blk341A, N°08-51, Sembawang Close</street><city>751341 Singapore</city><country>SG</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918989627" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Hirsch &amp; Associés</last-name><iid>100061101</iid><address><street>58, avenue Marceau</street><city>75008 Paris</city><country>FR</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548840038" load-source="docdb">AL</country><country mxw-id="DS548800990" load-source="docdb">AT</country><country mxw-id="DS548840040" load-source="docdb">BE</country><country mxw-id="DS548837277" load-source="docdb">BG</country><country mxw-id="DS548801357" load-source="docdb">CH</country><country mxw-id="DS548839366" load-source="docdb">CY</country><country mxw-id="DS548800991" load-source="docdb">CZ</country><country mxw-id="DS548840041" load-source="docdb">DE</country><country mxw-id="DS548839367" load-source="docdb">DK</country><country mxw-id="DS548839368" load-source="docdb">EE</country><country mxw-id="DS548833289" load-source="docdb">ES</country><country mxw-id="DS548837282" load-source="docdb">FI</country><country mxw-id="DS548837283" load-source="docdb">FR</country><country mxw-id="DS548840042" load-source="docdb">GB</country><country mxw-id="DS548839369" load-source="docdb">GR</country><country mxw-id="DS548840043" load-source="docdb">HR</country><country mxw-id="DS548800992" load-source="docdb">HU</country><country mxw-id="DS548801362" load-source="docdb">IE</country><country mxw-id="DS548839370" load-source="docdb">IS</country><country mxw-id="DS548837284" load-source="docdb">IT</country><country mxw-id="DS548839371" load-source="docdb">LI</country><country mxw-id="DS548834724" load-source="docdb">LT</country><country mxw-id="DS548833251" load-source="docdb">LU</country><country mxw-id="DS548834725" load-source="docdb">LV</country><country mxw-id="DS548834726" load-source="docdb">MC</country><country mxw-id="DS548833252" load-source="docdb">MK</country><country mxw-id="DS548833253" load-source="docdb">MT</country><country mxw-id="DS548837285" load-source="docdb">NL</country><country mxw-id="DS548833290" load-source="docdb">NO</country><country mxw-id="DS548801363" load-source="docdb">PL</country><country mxw-id="DS548834882" load-source="docdb">PT</country><country mxw-id="DS548837290" load-source="docdb">RO</country><country mxw-id="DS548834883" load-source="docdb">RS</country><country mxw-id="DS548801364" load-source="docdb">SE</country><country mxw-id="DS548800993" load-source="docdb">SI</country><country mxw-id="DS548833291" load-source="docdb">SK</country><country mxw-id="DS548801365" load-source="docdb">SM</country><country mxw-id="DS548834728" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669727" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Communication device (T1) comprising<br/>
- An antenna (A1) and physical circuitry (PHY) for receiving a poll command (PC) from a second communication device (T2).<br/>
- A plurality of entities (D 1, D2, D3... Dn) emulating NFC devices,<br/>
- An arrangement for deciding, for each entity of said plurality of entities, if a response should be sent and if so sending a response (LF1, LF2, LF3... LFn) to said second communication device (T2), containing information related to the respective NFC device.
<img id="iaf01" file="imgaf001.tif" wi="140" he="103" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499100" lang="EN" source="EPO" load-source="docdb"><p>Communication device (T1) comprising 
- An antenna (A1) and physical circuitry (PHY) for receiving a poll command (PC) from a second communication device (T2). 
- A plurality of entities (D 1, D2, D3... Dn) emulating NFC devices, 
- An arrangement for deciding, for each entity of said plurality of entities, if a response should be sent and if so sending a response (LF1, LF2, LF3... LFn) to said second communication device (T2), containing information related to the respective NFC device.</p></abstract><description mxw-id="PDES63955157" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><u>FIELD OF THE INVENTION</u></heading><p id="p0001" num="0001">The invention relates to the field of near-field communications and more particularly to devices compliant to ISO 18092, ECMA 340 or NFC Forum NFC-F category of devices.</p><heading id="h0002"><u>BACKGROUND OF THE INVENTION</u></heading><p id="p0002" num="0002">Near-field communication (NFC) is a short-range wireless communication technology for exchanging data between devices over distances of centimeters to tens of centimeters, generally up to 10 cm. One example application for NFC is radio-frequency identification (RFID) where a reader device can detect and retrieve data from a tag equipped with an antenna.</p><p id="p0003" num="0003">Generally, a first device enters a polling mode where it generates an electromagnetic field in order to poll for other available NFC devices in the vicinity. These close NFC devices should answer to let the first device know about them. In some cases, the close devices answer by only modulating the carrier electromagnetic field, the modulation data forming a signal which can be demodulated by the first device.</p><p id="p0004" num="0004">On this principle, the ISO (International Standards Organization) and the NFC-Forum have defined more refined protocols and mechanisms enabling devices of various manufacturers to interoperate. More precisely, the standards define several technologies to cover different manufactures and legacy technologies, namely the NFC-A, NFC-B and NFC-F technologies. Each technology is associated with a group of transmission parameters defining a complete communication protocol, like, for instance: bit rate, modulation scheme, bit level coding, frame format etc. However, all the technologies share a few core parameters enabling a basic interoperating, e.g. the same radio-frequency for the carrier electromagnetic field (13.56 MHz), same protocol, and same command set.</p><p id="p0005" num="0005">The <figref idrefs="f0001">figure 1</figref> shows a basic protocol exchange between two devices according to the NFC-F technology.<!-- EPO <DP n="2"> --></p><p id="p0006" num="0006">A first device D1 is in a so-called "poll mode" which can be considered as the initial mode for a device trying to discover its neighborhood by generating a carrier field. It sends a poll frame PF, which can be received by NFC-complaint devices in the vicinity.</p><p id="p0007" num="0007">A device D2 is in listen mode. This listen mode can be considered as another initial mode for a NFC device, wherein it does not generate any carrier field but is continuously listening for the electromagnetic carrier field generated by another device. When it detects the field generated by the device D1 and receives the poll frame PF, it answers with a Listen Frame LF so as this frame can be perceived by the device D1.</p><p id="p0008" num="0008">This Listen Frame enables the device D2 to let the first device D 1 know about its presence and which mode of communication is possible.</p><p id="p0009" num="0009">There are two modes of Near-Field Communication:
<ul><li>a passive communication mode where the device D2 (i.e. the one which has not already generated a carrier field) will send messages by using the carrier field of D1 only.</li><li>An active communication mode, where the device D2 can generate its own carrier field to send its messages. In such a mode (also called "peer-to-peer mode") both devices alternatively generate a carrier field to communicate.</li></ul></p><p id="p0010" num="0010">The passive communication mode is used when the receiving device D2 is a tag, e.g. a Type 3 Tag (T3T) according to the NFC Forum Digital Protocol specification.</p><p id="p0011" num="0011">The active communication mode can be used when the receiving device D2 is a more complex device, having means to generate its own carrier field, and generally means to embed software applications. Such devices can be mobile phones, like smartphones, tablets, laptop computers, etc.</p><p id="p0012" num="0012">Such device D2 may also emulate a simple tag and therefore interoperate with the first device D1 in a passive communication mode.</p><p id="p0013" num="0013">There is a need for taking into consideration the situation of advanced communication devices which can emulate NFC devices. In particular, there is a need to propose solutions, especially an architecture, for a communication device to<!-- EPO <DP n="3"> --> emulate several NFC devices and to let other parties know about these emulated devices.</p><heading id="h0003"><u>SUMMARY OF THE INVENTION</u></heading><p id="p0014" num="0014">An object of embodiments of the present invention is to propose such a solution.</p><p id="p0015" num="0015">This is achieved with a method for a first communication device in listen mode to answer to a poll command sent by a second communication device; this first communication device emulating a plurality of NFC devices and this method comprising steps of:
<ul><li>Receiving the poll command by the first communication device;</li><li>For each of the plurality of NFC devices, deciding if a response should be sent and if so, sending a response to the second communication device, containing information related to the respective NFC device.</li></ul></p><p id="p0016" num="0016">According to embodiments of the invention, the method can comprise one or several of the following features:
<ul><li>The steps of deciding and sending a response may be performed by each of the plurality of NFC devices;</li><li>The poll command may be forwarded to each of the plurality of NFC devices;</li><li>The steps of deciding and sending a response may be performed by an answering arrangement without forwarding the poll command to the NFC devices;</li><li>The response may be elaborated when triggered by an interrupt received from a timer;</li><li>The information may contain a NFCID2 identifier;</li><li>The information may contain an indication about whether the respective NFC device is a Type 3 tag or a peer-to-peer device based NFC-DEP protocol.</li></ul></p><p id="p0017" num="0017">The invention has for other object a communication device comprising:
<ul><li>An antenna and physical circuitry (PHY) for receiving a poll command (PC) from a second communication device (T2).</li><li>A plurality of entities (D1, D2, D3... Dn) emulating NFC devices,<!-- EPO <DP n="4"> --></li><li>An arrangement for deciding, for each entity of said plurality of entities, if a response should be sent and if so sending a response (LF1, LF2, LF3... LFn) to said second communication device (T2), containing information related to the respective NFC device.</li></ul></p><p id="p0018" num="0018">According to embodiments of the invention, the communication device can comprise one or several of the following features:
<ul><li>Each of the entities comprises answering arrangements adapted to elaborate and send a response related to the respective emulated NFC device;</li><li>The communication device further may comprise an answering arrangement adapted to elaborate and send responses related to at least two emulated devices;</li><li>This answering arrangement may comprise a timer for generating interrupts according to NFC time rules, and a software layer for elaborating the responses when triggered by the interrupts;</li><li>The information may contain a NFCID2 identifier;</li><li>The information may contain an indication about whether the respective NFC device is a Type 3 tag or a peer-to-peer device based NFC-DEP protocol.</li></ul></p><p id="p0019" num="0019">The invention also relates to a computer program product comprising a computer readable medium, having thereon a computer program comprising program instructions, the computer program being loadable into a data-processing unit and adapted to cause execution of the method as described above, when the computer program is run by the data-processing unit.</p><p id="p0020" num="0020">Another object of the invention is a system comprising a communication device according as described above and the second communication device.</p><p id="p0021" num="0021">Further features and advantages of embodiments of the invention will appear from the following description of some embodiments of the invention, given as nonlimiting examples, with reference to the accompanying drawings listed hereunder.<!-- EPO <DP n="5"> --></p><heading id="h0004"><u>BRIEF DESCRIPTION OF THE DRAWINGS</u></heading><p id="p0022" num="0022"><ul><li><figref idrefs="f0001">Fig. 1</figref> shows a basic protocol exchange between two devices according to the NFC-F technology.</li><li><figref idrefs="f0001">Fig. 2</figref> shows a block diagram illustrating an exemplary configuration of the communication devices T1, T2 in accordance with an embodiment of the invention, one in Poll mode, the other in Listen mode;</li><li><figref idrefs="f0002">Fig. 3</figref> illustrates a data frame for a poll command, according to an embodiment of the invention.</li><li><figref idrefs="f0002">Fig. 4</figref> illustrates a data frame for a response, according to an embodiment of the invention.</li><li><figref idrefs="f0002">Fig. 5</figref> is a time diagram depicting a possible scheduling of the responses, according to an embodiment of the invention.</li><li><figref idrefs="f0003">Figs. 6 and 7</figref> show more detailed block diagrams illustrating two embodiments of the communication device of the invention.</li></ul></p><heading id="h0005"><u>DETAILED DESCRIPTION OF EMBODIMENTS OF THE INVENTION</u></heading><p id="p0023" num="0023">The invention relates to the NFC-F technology. This subset of the NFC-Forum specifications is normalized by the ISO/IEC 18092 standard, entitled "Near Field Communication Interface and Protocol (NFCIP-1), as well as by the NFC-Forum Technical Specification named "NFC Digital Protocol" in the section 6.</p><p id="p0024" num="0024">In the example depicted by <figref idrefs="f0001">figure 2</figref>, the device T2 in Poll mode is considered as "initiator": it means that it generates a carried electro-magnetic field and sends a poll command PC in order to know about other NFC-compliant devices in the vicinity. This initiator device T2 is supposed in poll mode.</p><p id="p0025" num="0025">This poll command PC (also named polling request) is transmitted within a data frame as depicted in <figref idrefs="f0002">figure 3</figref>.</p><p id="p0026" num="0026">A frame F starts with a SoF (Start of Frame) field, followed by a data field (labeled "data" in picture 3). The SoF field is typically set at a value "B24D" in hexadecimal.</p><p id="p0027" num="0027">The data field consists in a SoD (Start of Data) field, a payload and an EoD (End of Data) field.<!-- EPO <DP n="6"> --></p><p id="p0028" num="0028">The SoD field contains a length byte indicating the length of the payload+1. The EoD field contains a two-byte checksum calculated on the payload and SoD fields.</p><p id="p0029" num="0029">The payload contains the poll command per se, which is named "SENSF_REQ". In general, this command is use by any NFC Forum Device in Poll Mode to probe the Operating Field for NFC Forum devices in Listen mode.</p><p id="p0030" num="0030">The SC field (System Code) contains information regarding the NFC forum device to be polled for (e.g. the Technology subset). If the initiator device D1 wishes to poll for any NFC device, the SC field should be set to "FFFF" (hexadecimal value).</p><p id="p0031" num="0031">The RC field (Request Code) can be used to retrieve additional information in the expected SENSF_RES response(s).</p><p id="p0032" num="0032">The TSN field (Time Slot Number) is used for collision resolution and to reduce the probability of collisions. The anti-collision scheme is based on the definition of time slots in which NFC devices in Listen mode are invited to respond.</p><p id="p0033" num="0033">The device D1 in Poll mode sends a SENSF_REQ command with a TSN value indicating the number of time slots available.</p><p id="p0034" num="0034">A communication device T1 is in Listen mode. It means that it is waiting for a poll command, which will trigger a reaction from it.</p><p id="p0035" num="0035">It is supposed in this example that the communication devices T1 and T2 are in vicinity, such that their respective antennas A1, A2 are coupled by an electro-magnetic field. They can then communicate data frames as is known in the art and specified by the NFC forum, ISO and other standardization bodies.</p><p id="p0036" num="0036">The communication device T1 comprises an antenna A1 and physical circuitry PHY adapted for receiving commands and notably the poll command sent by the communication device T2 in poll mode.</p><p id="p0037" num="0037">The communication device T2 also comprises a plurality of entities D1, D2, D3... Dn, each emulating a NFC device. As it will be seen later, these entities can be of different nature: they can comprise hardware elements and software elements. The entities can be independent devices that are, somehow, plugged into the communication device T2, or pieces of a hardware platform emulating the devices, or<!-- EPO <DP n="7"> --> software programs emulating the devices in a software way. Other embodiments are possible as well as a combination of these embodiments.</p><p id="p0038" num="0038">The number of emulated devices is limited to 16 per the technology F specifications of the NFC forum. If more than 16 devices are emulated, only 16 at a time can be handled.</p><p id="p0039" num="0039">According to one aspect of the invention, it can be possible to emulate a collision in certain slots. This collision provides information to the communication device in Poll mode that there are more emulated devices to resolve. Then, it can restart a process to discover them. This additional feature enables the communication device to get rid of the limit specified by the NFC Forum and emulate any number of NFC devices.</p><p id="p0040" num="0040">These devices can be of the different possible types, according to the NFC forum specifications. More precisely, the emulated devices can be:
<ul><li>Type 3 Tag (T3T)</li><li>Peer-to-peer devices based on NFC-DEP protocol.</li></ul></p><p id="p0041" num="0041">A T3T device acts like a tag which can only handle a passive communication mode with the communication device T2.</p><p id="p0042" num="0042">A peer-to-peer device based on NFC-DEP protocol acts by establishing a passive communication mode with the communication device T2. It means they both conform to a half-duplex transmission protocol, so as they alternatively switch to receiver and emitter role. Only one device sends data at a time.</p><p id="p0043" num="0043">Several half-duplex transmission protocols exist. The NFC Forum however specifies the NFC-DEP protocol for the devices conforming to Type F Technology. This NFC-DEP protocol is described in the section 14 of the NFC Digital Protocol document (version 1.0, dated November 17, 2010).</p><p id="p0044" num="0044">The communication device T1 also comprises an arrangement for determining, for each of the entity D1, D2, D3... Dn, if an answer should be sent.</p><p id="p0045" num="0045">This decision is based on the SC field of the poll command PC.</p><p id="p0046" num="0046">If the SC field indicates than all the devices are polled, then an answer should be sent for every entity embedded inside the communication device T1.<!-- EPO <DP n="8"> --></p><p id="p0047" num="0047">If the SC field indicates that a specific technology subset is polled, then a decision is taken for each entity, consisting in elaborating a response for a certain entity only if the emulated device is of the subset corresponding to this SC field. Otherwise, the entity associated to the emulated device should not answer.</p><p id="p0048" num="0048">This behavior is conforming to the NFC forum specifications.</p><p id="p0049" num="0049">When a decision has been taken for a device, the response is elaborated and sent. A different response LF1, LF2, LF3... LFn is sent for each entity D1, D2, D3... Dn (respectively) for which it has been decided that a response should be sent.</p><p id="p0050" num="0050">This response is transmitted within a data frame as depicted in <figref idrefs="f0002">figure 4</figref>.</p><p id="p0051" num="0051">A frame F2 stars with a SoF (Start of Frame) field, followed by a data field (labeled "data" in picture 4). The SoF field is typically set at a value "B24D" in hexadecimal.</p><p id="p0052" num="0052">The data field consists in a SoD (Start of Data) field, a payload and an EoD (End of Data) field.</p><p id="p0053" num="0053">The SoD field contains a length byte indicating the length of the payload+1. The EoD field contains a two-byte checksum calculated on the payload and SoD fields.</p><p id="p0054" num="0054">The payload contains the answer per se, which is named SENSF_RES.</p><p id="p0055" num="0055">The NFCID2 field contains an identifier of the answering device compliant with the NFC Forum. The first byte of this field contains an indicator of the type of device:
<ul><li>Byte 1 = "01", if the type is NFC-DEP.</li><li>Byte 1 = "02", if the type is T3T</li></ul></p><p id="p0056" num="0056">The second byte is generally set to value "FE", and the other bytes are randomly generated by the device.</p><p id="p0057" num="0057">The RD field (Request Data) is present only if requested in the RC field of the SENSF_REQ command. The format depends on the NFC-F Technology subset for which the answering device is configured.</p><p id="p0058" num="0058">The other fields are not relevant in the context of the invention, and will not be described here. For further explanations, the section 6.6.2 of the "NFC Digital Protocol technical specification" can be consulted.</p><p id="p0059" num="0059">The reference Mc stands for "MRTI<sub>CHECK</sub>". The reference Mu stands for "MRTI<sub>UPDATE</sub>". The reference P2 stands for "PAD2"<!-- EPO <DP n="9"> --></p><p id="p0060" num="0060">For each device D1, D2, D3...Dn, if needed, a corresponding response LF1, LF2, LF3... LFn is elaborated. More concretely, it means that an identifier NFCID2 is determined, with the first byte set to the value corresponding to the type and technology subset of the emulated device.</p><p id="p0061" num="0061">The <figref idrefs="f0003">figure 6</figref> shows an embodiment where each device is emulated by a separate entity. These entities can comprise hardware circuits as well as embedded software modules, as if they were independent devices. In a particular implementation, each of these devices may be a separated card or chip.</p><p id="p0062" num="0062">They can comprise a ContactLess Front-end (CLF), i.e. a combination of hardware and software elements adapted to make the device interoperate with the communication network. The CLF is the interface between the applicative layers of the device and this communication</p><p id="p0063" num="0063">On <figref idrefs="f0003">figure 6</figref>, only the contactless front-end CLF1, CLF2, CLF3... CLFn have been depicted for each device. The applicative layers and other elements have been omitted since not directly connected with the principle of the invention.</p><p id="p0064" num="0064">Each contactless front-end comprises answering arrangements AA1, AA2, AA3...AAn in charge of receiving poll commands PC, elaborating a response and sending it.</p><p id="p0065" num="0065">The response LF1, LF2, LF3 ... LFn is elaborated according to the data for the respective device as explained above. For instance, each answering arrangement determines its own identifier NFCID2 and inserts it in the outgoing response. Further, the answering arrangements insert data indicating whether the emulated device is a Type 3 tag (T3T) or a peer-to-peer device based on NFC-DEP protocol. The responses are SENSF_RES messages.</p><p id="p0066" num="0066">The communication device T1 comprises also a forwarder FWD. This arrangement is adapted to receive the commands, e.g. the poll command PC, from the physical circuitry PHY and to forward it to the plurality of contactless front-end CLF1, CLF2, CLF3...CLFn.<!-- EPO <DP n="10"> --></p><p id="p0067" num="0067">Then, it receives the responses LF1, LF2, LF3...LFn from the contactless front-end CLF1, CLF2, CLF3...CLFn and forwards them to the physical circuitry PHY so that they are emitted by the antenna A1 towards the other communication device(s).</p><p id="p0068" num="0068">The contactless front-ends are in charge of sending the respective responses according to the timing rules specified by the NFC forum.</p><p id="p0069" num="0069">According to NFC Forum "Digital Protocol" specification, collisions are possible and cannot be handled when occurring. The communication device in Poll mode is then able to "discover" devices that responded in slots where collisions did not occur. Each device determines a slot in which to answer by a random choice.</p><p id="p0070" num="0070">The communication device in Poll mode can send another poll command in order to discover the devices which answer where previously in collision. By iterating this process, all devices can be discovered.</p><p id="p0071" num="0071">According to one aspect of the invention, the forwarder FWD can determine situations of internal collision between the responses of the emulated devices. In such cases, it can reset the randomly chosen slots by devices and trigger a next iteration for generating another random slot number.</p><p id="p0072" num="0072">The <figref idrefs="f0003">figure 7</figref> illustrates another embodiment of the invention, where a single contactless front-end CLF is in charge of all the devices emulated by the entities D1, D2, D3... Dn.</p><p id="p0073" num="0073">This CLF comprises an answering arrangement AA adapted to elaborate and send responses SENSF_RES related to the emulated devices. The answering arrangement AA is therefore knowledgeable about the characteristics of the emulated devices. It notably knows whether each device is a T3T device or a peer-to-peer device based on NFC-DEP protocol. It can also generate for each device an identifier NFCID2.</p><p id="p0074" num="0074">The responses LF1, LF2, LF3... LFn are sent to the physical circuitry PHY and to the antenna A1 according to the time rules specified by the NFC Forum.</p><p id="p0075" num="0075">According to an embodiment of the invention, the answering arrangement AA comprises a software layer S and a timer T. The software layer S can be responsible of the elaboration and of the sending of the responses.<!-- EPO <DP n="11"> --></p><p id="p0076" num="0076">The timer T can be a hardware layer, in charge of generating interrupts INT according to the time rules of the NFC forum.</p><p id="p0077" num="0077">The <figref idrefs="f0002">figure 5</figref> makes these rules clearer. It illustrates a chronogram where the time t is represented by the arrow going from left to right. The arrival of the poll command PC starts the scheduling. After a delay D, the time is divided into time slots TS0, TS1, TS2, TS3... The number of time slots depends on the data contained in the poll command PC, i.e. the maximum number of devices to be polled.</p><p id="p0078" num="0078">The timer T can send an interrupt INT for each time slots, especially at the beginning at each time slots.</p><p id="p0079" num="0079">When receiving such an interrupt INT, the software layer S can elaborate a response, by filling a buffer with data to be transmitted. The actual sending of the data on the RF interface can be triggered and done by the hardware layer. The software layer S can insert an indicator byte to indicate to the hardware layer that the data are ready for transmission.</p><p id="p0080" num="0080">Only one response is sent during each time slot. In the example depicted in <figref idrefs="f0002">figure 5</figref>, the response LF3 is sent during the time slot TS0, the response LFn is sent during the time slot TS1, the response LF1 is sent during the time slot TS2 and the response LF2 is sent during the time slot TS3. The sequence goes on when more than 4 time slots are available.</p><p id="p0081" num="0081">The responses LF1, LF2, LF3... LFn are sent in sequence and can be received by the other communication device without any collision problems.</p><p id="p0082" num="0082">In order to ensure that sending a SENSF_RES occurs in a certain time-slot, it is necessary to have a good software latency control with, preferably, the hardware assistance of the timer T for generating the interrupts on the start of each time slots. However other implementations are possible, including pure software solutions.</p><p id="p0083" num="0083">The other communication device T2 that receives the responses LF1, LF2, LF3... LFn can then behave as if it has received responses from several devices. From its particular point of view, there is no difference (at this step of discovery) between receiving n SENSF_RES responses from a communication device emulating n devices, or receiving n SENSF_RES responses emitted by n independent devices.</p><p id="p0084" num="0084">Therefore, a communication device T1 can emulate multiple NFC devices in a transparent way to other parties and compliantly with the NFC Forum specifications.<!-- EPO <DP n="12"> --></p><p id="p0085" num="0085">The invention has been described with reference to preferred embodiments. However, many variations are possible within the scope of the invention.</p><p id="p0086" num="0086">For instance, it is possible to combine the two embodiments described above, but have both independent contactless front-end comprising their own answering arrangement in charge of elaborating and sending SENSF-RES responses for a first group of devices, and a shared answering arrangement elaborating and sending SENSF_RES responses on behalf of devices of a second group.</p></description><claims mxw-id="PCLM56976068" lang="EN" load-source="patent-office"><!-- EPO <DP n="13"> --><claim id="c-en-0001" num="0001"><claim-text>Method for a first communication device (T1) in listen mode to answer to a poll command (PC) sent by a second communication device (T2), said first communication device emulating a plurality of NFC devices and said method comprising steps of:
<claim-text>- Receiving said poll command (PC) by said first communication device;</claim-text>
<claim-text>- For each of said plurality of NFC devices (D1, D2, D3... Dn), deciding if a response should be sent and if so, sending a response (LF1, LF2, LF3... LFn) to said second communication device, containing information related to the respective NFC device.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>Method according to claim 1, wherein the steps of deciding and sending a response are performed by each of said plurality of NFC devices.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>Method according to claim 2, wherein said poll command (PC) is forwarded to each of said plurality of NFC devices.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>Method according to claim 1, wherein the steps of deciding and sending a response are performed by an answering arrangement without forwarding said poll command (PC) to said NFC devices.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>Method according to claim 4, wherein said response is elaborated when triggered by an interrupt received from a timer (T).</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>Method according to any of the previous claims, wherein said information contains a NFCID2 identifier.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>Method according to any of the previous claims, wherein said information contains an indication about whether said respective NFC device is a Type 3 tag or a peer-to-peer device based NFC-DEP protocol.<!-- EPO <DP n="14"> --></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>Communication device (T1) comprising
<claim-text>- an antenna (A1) and physical circuitry (PHY) for receiving a poll command (PC) from a second communication device (T2).</claim-text>
<claim-text>- a plurality of entities (D1, D2, D3... Dn) emulating NFC devices,</claim-text>
<claim-text>- an arrangement for deciding, for each entity of said plurality of entities, if a response should be sent and if so sending a response (LF1, LF2, LF3... LFn) to said second communication device (T2), containing information related to the respective NFC device.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>Communication device according to previous claim, wherein each of said entities comprises answering arrangements (AA1, AA2, AA3...AAn) adapted to elaborate and send a response related to the respective emulated NFC device.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>Communication device according to claim 8, comprising an answering arrangement (AA) adapted to elaborate and send responses related to at least two emulated devices.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>Communication device according to claim 10, wherein said answering arrangement comprises a timer (T) for generating interrupts according to NFC time rules, and a software layer (S) for preparing said responses when triggered by said interrupts.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>Communication device according to any of claims 8 to 11, wherein said information contains a NFCID2 identifier.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>Communication device according to any of claims 8 to 11, wherein said information contains an indication about whether said respective NFC device is a Type 3 tag or a peer-to-peer device based NFC-DEP protocol.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A computer program product comprising a computer readable medium, having thereon a computer program comprising program instructions, the computer program being loadable into a data-processing unit and adapted to cause execution of<!-- EPO <DP n="15"> --> the method according to any of claims 1 to 7 when the computer program is run by the data-processing unit.</claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>System comprising a communication device (T1) according to any of claims 8 to 13 and said second communication device (T2).</claim-text></claim></claims><drawings mxw-id="PDW16666855" load-source="patent-office"><!-- EPO <DP n="16"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="184" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="17"> --><figure id="f0002" num="3,4,5"><img id="if0002" file="imgf0002.tif" wi="165" he="185" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="18"> --><figure id="f0003" num="6,7"><img id="if0003" file="imgf0003.tif" wi="165" he="221" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="158" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="155" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
