<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680261-A1" country="EP" doc-number="2680261" kind="A1" date="20140101" family-id="48607174" file-reference-id="318319" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549343" ucid="EP-2680261-A1"><document-id><country>EP</country><doc-number>2680261</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13172387-A" is-representative="NO"><document-id mxw-id="PAPP154823266" load-source="docdb" format="epo"><country>EP</country><doc-number>13172387</doc-number><kind>A</kind><date>20130618</date><lang>EN</lang></document-id><document-id mxw-id="PAPP177814740" load-source="docdb" format="original"><country>EP</country><doc-number>13172387.6</doc-number><date>20130618</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140452727" ucid="EP-12305760-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12305760</doc-number><kind>A</kind><date>20120628</date></document-id></priority-claim><priority-claim mxw-id="PPC140447324" ucid="EP-13172387-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>13172387</doc-number><kind>A</kind><date>20130618</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL2102368684" load-source="docdb">G10L  19/035       20130101ALN20140722BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL2102368830" load-source="docdb">G10L  19/018       20130101AFI20140722BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL2102376053" load-source="docdb">G10L  19/02        20130101ALN20140722BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1991043928" load-source="docdb" scheme="CPC">H04N  21/845       20130101 FI20151212BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2042532127" load-source="docdb" scheme="CPC">G10L  19/035       20130101 LA20150630BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2042534196" load-source="docdb" scheme="CPC">G10L  19/018       20130101 LI20150630BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2042536144" load-source="docdb" scheme="CPC">G10L  19/0212      20130101 LA20150630BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180513" lang="DE" load-source="patent-office">Verfahren und Vorrichtung zur Wasserzeichenherstellung eines AC-3-codierten Bitstroms</invention-title><invention-title mxw-id="PT132180514" lang="EN" load-source="patent-office">Method and apparatus for watermarking an AC-3 encoded bit stream</invention-title><invention-title mxw-id="PT132180515" lang="FR" load-source="patent-office">Procédé et appareil pour le filigranage d'un flux binaire codé AC-3</invention-title><citations><patent-citations><patcit mxw-id="PCIT377888984" load-source="docdb" ucid="EP-1104969-A1"><document-id format="epo"><country>EP</country><doc-number>1104969</doc-number><kind>A1</kind><date>20010606</date></document-id><sources><source name="SEA" category="XA" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652293" load-source="docdb" ucid="EP-2175444-A1"><document-id format="epo"><country>EP</country><doc-number>2175444</doc-number><kind>A1</kind><date>20100414</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652295" load-source="docdb" ucid="US-8078301-B2"><document-id format="epo"><country>US</country><doc-number>8078301</doc-number><kind>B2</kind><date>20111213</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT377888985" load-source="docdb" ucid="WO-2005008582-A2"><document-id format="epo"><country>WO</country><doc-number>2005008582</doc-number><kind>A2</kind><date>20050127</date></document-id><sources><source name="APP" created-by-npl="N"/><source name="SEA" category="XDA" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652292" load-source="docdb" ucid="WO-2007031423-A1"><document-id format="epo"><country>WO</country><doc-number>2007031423</doc-number><kind>A1</kind><date>20070322</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652294" load-source="docdb" ucid="WO-2011141292-A1"><document-id format="epo"><country>WO</country><doc-number>2011141292</doc-number><kind>A1</kind><date>20111117</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>M. ARNOLD; P.G. BAUM; W. VOESSING: "A phase modulation audio watermarking technique", 11TH INFORMATION HIDING WORKSHOP, 2009, pages 102 - 116</text><sources><source mxw-id="PNPL69958922" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918156587" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>THOMSON LICENSING</last-name><address><country>FR</country></address></addressbook></applicant><applicant mxw-id="PPAR918150744" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>THOMSON LICENSING</last-name></addressbook></applicant><applicant mxw-id="PPAR918981818" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Thomson Licensing</last-name><iid>101157220</iid><address><street>1-5, rue Jeanne d'Arc</street><city>92130 Issy-Les-Moulineaux</city><country>FR</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918171017" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>CHEN XIAO-MING</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918149204" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>CHEN, Xiao-ming</last-name></addressbook></inventor><inventor mxw-id="PPAR918981473" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>CHEN, Xiao-ming</last-name><address><street>Vahrenwalderstr. 101</street><city>30165 Hannover</city><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918146420" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>BAUM PETER GEORG</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918152067" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>BAUM, PETER GEORG</last-name></addressbook></inventor><inventor mxw-id="PPAR918991934" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>BAUM, PETER GEORG</last-name><address><street>Aschendorfer Str. 25</street><city>30539 Hannover</city><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918159225" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>ARNOLD MICHAEL</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918141851" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>ARNOLD, MICHAEL</last-name></addressbook></inventor><inventor mxw-id="PPAR918982227" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>ARNOLD, MICHAEL</last-name><address><street>Eichendorffstr. 1b</street><city>30916 Isernhagen</city><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918133780" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>GRIES ULRICH</last-name><address><country>DE</country></address></addressbook></inventor><inventor mxw-id="PPAR918139792" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>GRIES, ULRICH</last-name></addressbook></inventor><inventor mxw-id="PPAR918982135" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>GRIES, ULRICH</last-name><address><street>Friedenauer Str. 20b</street><city>30419 Hannover</city><country>DE</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918993955" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Hartnack, Wolfgang</last-name><iid>100037536</iid><address><street>Deutsche Thomson OHG European Patent Operations Karl-Wiechert-Allee 74</street><city>30625 Hannover</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548856152" load-source="docdb">AL</country><country mxw-id="DS548876555" load-source="docdb">AT</country><country mxw-id="DS548803154" load-source="docdb">BE</country><country mxw-id="DS548840511" load-source="docdb">BG</country><country mxw-id="DS548804423" load-source="docdb">CH</country><country mxw-id="DS548803155" load-source="docdb">CY</country><country mxw-id="DS548876556" load-source="docdb">CZ</country><country mxw-id="DS548856154" load-source="docdb">DE</country><country mxw-id="DS548803156" load-source="docdb">DK</country><country mxw-id="DS548803157" load-source="docdb">EE</country><country mxw-id="DS548859206" load-source="docdb">ES</country><country mxw-id="DS548840512" load-source="docdb">FI</country><country mxw-id="DS548804424" load-source="docdb">FR</country><country mxw-id="DS548856155" load-source="docdb">GB</country><country mxw-id="DS548803158" load-source="docdb">GR</country><country mxw-id="DS548856156" load-source="docdb">HR</country><country mxw-id="DS548876557" load-source="docdb">HU</country><country mxw-id="DS548804425" load-source="docdb">IE</country><country mxw-id="DS548803159" load-source="docdb">IS</country><country mxw-id="DS548840513" load-source="docdb">IT</country><country mxw-id="DS548803160" load-source="docdb">LI</country><country mxw-id="DS548840514" load-source="docdb">LT</country><country mxw-id="DS548887049" load-source="docdb">LU</country><country mxw-id="DS548840515" load-source="docdb">LV</country><country mxw-id="DS548840516" load-source="docdb">MC</country><country mxw-id="DS548887050" load-source="docdb">MK</country><country mxw-id="DS548887051" load-source="docdb">MT</country><country mxw-id="DS548887380" load-source="docdb">NL</country><country mxw-id="DS548804426" load-source="docdb">NO</country><country mxw-id="DS548887381" load-source="docdb">PL</country><country mxw-id="DS548859207" load-source="docdb">PT</country><country mxw-id="DS548859058" load-source="docdb">RO</country><country mxw-id="DS548859208" load-source="docdb">RS</country><country mxw-id="DS548887382" load-source="docdb">SE</country><country mxw-id="DS548856158" load-source="docdb">SI</country><country mxw-id="DS548804427" load-source="docdb">SK</country><country mxw-id="DS548804428" load-source="docdb">SM</country><country mxw-id="DS548803161" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128670013" lang="EN" load-source="patent-office"><p id="pa01" num="0001">For watermark embedding, without full Dolby AC-3 decoding, mantissa bits in the AC-3 bit stream are changed by exploiting the fact that during AC-3 encoding more bits than required by the perceptual masking curve are used for the quantisation of the MDCT coefficient mantissa values. In addition to the bap values, truly required bap values are determined and the mantissa values are changed accordingly, controlled by the watermark information. The advantages are efficient watermark embedding, other bit stream parameters and values remain unchanged except for CRC checks, and the audio quality of the watermarked signal remains perceptually unchanged.
<img id="iaf01" file="imgaf001.tif" wi="144" he="91" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499386" lang="EN" source="EPO" load-source="docdb"><p>For watermark embedding, without full Dolby AC-3 decoding, mantissa bits in the AC-3 bit stream are changed by exploiting the fact that during AC-3 encoding more bits than required by the perceptual masking curve are used for the quantisation of the MDCT coefficient mantissa values. In addition to the bap values, truly required bap values are determined and the mantissa values are changed accordingly, controlled by the watermark information. The advantages are efficient watermark embedding, other bit stream parameters and values remain unchanged except for CRC checks, and the audio quality of the watermarked signal remains perceptually unchanged.</p></abstract><description mxw-id="PDES63955443" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">The invention relates to a method and to an apparatus for watermarking an AC-3 encoded bit stream by modifying mantissa values.</p><heading id="h0001"><u>Background</u></heading><p id="p0002" num="0002">Dolby AC-3 (adaptive transform coder 3) is a well-known audio compression format, which is used e.g. in cinema, DVD, BD and digital television applications.</p><p id="p0003" num="0003">In <patcit id="pcit0001" dnum="WO2005008582A2"><text>WO 2005/008582 A2</text></patcit> a watermark embedding for an AC-3 bit stream is disclosed that is performed by directly changing mantissa bits in the bit stream. For deriving the reference mantissas the bit stream is decompressed to a PCM signal, followed by PCM watermarking and an MDCT transform required for deriving watermarked MDCT coefficients, which finally deliver the required reference mantissas for modifying the mantissa bits in the bit stream.</p><heading id="h0002"><u>Invention</u></heading><p id="p0004" num="0004">However, this kind of reference mantissa generation is relatively complicated, limiting its deployment for real-time applications like in digital home networks or for video-on-demand. Moreover, no psycho-acoustic constraint is taken into account during the mantissa modification, possibly resulting in perceptual distortions.</p><p id="p0005" num="0005">A problem to be solved by the invention is to provide an efficient way for watermark embedding in an AC-3 bit stream,<!-- EPO <DP n="2"> --> thereby maintaining the audio perceptual transparency. This problem is solved by the method disclosed in claim 1. An apparatus that utilises this method is disclosed in claim 2.</p><p id="p0006" num="0006">According to the invention, for watermark embedding, without full AC-3 decoding, MDCT coefficient mantissa bits in the AC-3 bit stream are changed by exploiting the fact that during AC-3 encoding more bits than required by the perceptual masking curve are used for the quantisation of the mantissa values.</p><p id="p0007" num="0007">For low bit rate AC-3 streams such watermark information embedding may not be possible due to small or even negative SNR-offset values. On the other hand it is questionable whether it makes sense to watermark such low bit rates and, if true, further degradation of the audio quality is probably not a problem.</p><p id="p0008" num="0008">The advantages of the inventive processing are:
<ul><li>efficient watermark embedding;</li><li>other parameters and values (except for CRC checks) in the bit stream remain unchanged and reference mantissas are generated directly independent of the embedding process;</li><li>the audio quality of the watermarked signal remains perceptually unchanged and the perceptual transparency is kept;</li><li>low complexity because the AC-3 stream does not need to be fully decoded, watermarked with a PCM watermarking procedure and encoded again to get a watermarked AC-3 stream, which may result in a further degradation of the quality.</li></ul></p><p id="p0009" num="0009">In principle, the inventive method is suited for watermarking an AC-3 encoded bit stream, including the steps:
<ul><li>partially decoding said AC-3 encoded bit stream, thereby providing original quantised mantissa values and exponent values derived from MDCT transform coefficients and bap values<!-- EPO <DP n="3"> --> for said mantissa values, and determining the corresponding PSD values from said exponent values and determining from said PSD values the resulting masking curve;</li><li>determining from said masking curve and said PSD values truly required bap values denoted as bap_t values;</li><li>determining from said original mantissa values, said bap values and said bap_t values a maximum allowable mantissa value modification for a current mantissa and, if applicable, limiting a desired value for said current mantissa by said maximum allowable mantissa value modification, wherein said desired mantissa value is received from a watermarking processing;</li><li>changing the original AC-3 mantissa bits for a current mantissa value according to said limited desired mantissa value.</li></ul></p><p id="p0010" num="0010">In principle the inventive apparatus is suited for watermarking an AC-3 encoded bit stream, said apparatus including:
<ul><li>means being adapted for partially decoding said AC-3 encoded bit stream, thereby providing original quantised mantissa values and exponent values derived from MDCT transform coefficients and bap values for said mantissa values, and for determining the corresponding PSD values from said exponent values and for determining from said PSD values the resulting masking curve;</li><li>means being adapted for determining from said masking curve and said PSD values truly required bap values denoted as bap_t values;</li><li>means being adapted for determining from said original mantissa values, said bap values and said bap_t values a maximum allowable mantissa value modification for a current mantissa and, if applicable, for limiting a desired value for said current mantissa by said maximum allowable mantissa<!-- EPO <DP n="4"> --> value modification, wherein said desired mantissa value is received from a watermarking processing;</li><li>means being adapted for changing the original AC-3 mantissa bits for a current mantissa value according to said limited desired mantissa value.</li></ul></p><p id="p0011" num="0011">Advantageous additional embodiments of the invention are disclosed in the respective dependent claims.</p><heading id="h0003"><u>Drawings</u></heading><p id="p0012" num="0012">Exemplary embodiments of the invention are described with reference to the accompanying drawings, which show in:
<dl id="dl0001" compact="compact"><dt>Fig. 1</dt><dd>simplified block diagram for watermark embedding in an AC-3 bit stream;</dd><dt>Fig. 2</dt><dd>example SNR-offset values of an AC-3 bit stream with 384kbps bit rate;</dd><dt>Fig. 3</dt><dd>inventive watermark embedding by changing mantissa bits;</dd><dt>Fig. 4</dt><dd>comparison of bap and bap_t values for an example AC-3 bit stream;</dd><dt>Fig. 5</dt><dd>quantised mantissas resulting from a finer or coarser quantiser, bap &gt; bap_t;</dd><dt>Fig. 6</dt><dd>modification of m<sub>b</sub>;</dd><dt>Fig. 7</dt><dd>generation of reference mantissas according to the invention;</dd><dt>Fig. 8</dt><dd>watermark detection.</dd></dl></p><heading id="h0004"><u>Exemplary embodiments</u></heading><p id="p0013" num="0013"><i>Principle of AC-3 codec for a single full-bandwidth channel</i> For AC-3 encoding an input audio signal is divided into<!-- EPO <DP n="5"> --> overlapping blocks, each of which is weighted by a window function, denoted as windowing-overlapping WOL. Thereafter each weighted block is transformed to the frequency domain by means of a modified discrete cosine transform MDCT. The AC-3 codec quantises the MDCT coefficients and delivers the quantised MDCT coefficients in the bit stream. At AC-3 decoder side, an inverse MDCT transform IMDCT is applied to corresponding blocks of quantised MDCT coefficients extracted from the AC-3 bit stream in order to get time-domain data blocks. After a corresponding windowing-overlap-add WOLA process, the decoded audio signal is recovered.</p><p id="p0014" num="0014">Instead of transmitting quantised MDCT coefficients directly, each AC-3 MDCT coefficient is basically represented by a mantissa-exponent format: <i>X</i>[<i>k</i>]=<i>m</i>[<i>k</i>]<sub>2</sub><sup>-e[<i>k</i>]</sup><i>,</i> where <i>m</i>[<i>k</i>] is the mantissa of <i>X</i>[<i>k</i>] and <i>e</i>[<i>k</i>] is the exponent. The exponent <i>e</i>[<i>k</i>] is a non-negative integer and the mantissa <i>m</i>[<i>k</i>] belongs to {[-1,-0.5)∪0∪(0.5,1]}. Before mantissa quantization, MDCT coefficients are pre-processed:
<ul><li>Exponents greater than 24 are truncated to 24;</li><li>For compression, exponents are shared between 1, 2 or 4 adjacent MDCT coefficients. Accordingly, mantissas sharing the same exponent are selectively scaled. For example, <i>m</i>[<i>k</i>-1]2<sup>-2</sup>, <i>m</i>[<i>k</i>]2<sup>-3</sup> denote two MDCT coefficients before exponent sharing. The second mantissa is scaled to <i>m</i>[<i>k</i>]2<sup>-3</sup> <i>→</i>(<i>m</i>[<i>k</i>]2<sup>-1</sup>)2<sup>-2</sup>, i.e. it is scaled by 2<sup>-1</sup>;</li><li>Differential exponents are evaluated while limiting the difference to {0,±1,±2}.<br/>
For example, <i>m</i>[<i>k</i>-1]2<sup>-2</sup>,<i>m</i>[<i>k</i>]2<sup>-7</sup> denote two MDCT coefficients where the exponent difference is <i>e</i>[<i>k</i>-1]<i>-e</i>[<i>k</i>]=5. In order to get a difference value in the set {0,±1,±2}, the second mantissa is scaled to <i>m</i>[<i>k</i>]2<sup>-7</sup> <i>→</i>(<i>m</i>[<i>k</i>]2<sup>-3</sup>)2<sup>-4</sup>.<br/>
<!-- EPO <DP n="6"> -->Therefore, following this pre-processing, the range of mantissa values is changed to <i>m</i>[<i>k</i>]2∈[-1,1].</li></ul></p><p id="p0015" num="0015">For representing exponents, differential exponents and some reference exponents are used in the bit stream, for details see the AC-3 standard ATSC A/52.</p><p id="p0016" num="0016">From an AC-3 bit stream quantised mantissas can be derived, but instead of transmitting quantised mantissa values directly, a bit allocation pointer 'bap' and mantissa bits are assigned to each mantissa. The bap value indicates the type of quantiser used to quantise the corresponding mantissa value, and how many mantissa bits are used to represent the coded mantissa. Based on the bap value and its associated mantissa bits, the corresponding quantised mantissa value can be derived.</p><p id="p0017" num="0017">Moreover, the bap value also indicates how many mantissa bits are representing the quantiser level. Consequently, based on the bap values, the number of bits representing quantised MDCT coefficients in the bit stream can be determined. A larger bap value corresponds to a quantiser with more quantisation levels, i.e. a quantiser with a higher signal-to-noise ratio of quantisation SNRq.</p><heading id="h0005"><i>Determination of bap values</i></heading><p id="p0018" num="0018">The determination of bap values is carried out based on <i>e</i>[<i>k</i>] by the following steps:
<ul><li>Determining the power spectral density PSD from <i>e</i>[<i>k</i>];</li><li>Calculating the masking curve;</li><li>Determining the bap values such that no audible distortion is introduced due to quantisation.</li></ul></p><p id="p0019" num="0019">More specifically, according to the PSD value and the masking threshold, the corresponding signal-to-mask ratio SMR can be evaluated. Consequently, a quantiser with SNRq ≥ SMR can be used for quantising the mantissa without causing perceptual<!-- EPO <DP n="7"> --> distortions. Let bap<sub>0</sub> be the least bap value resulting from SNRq ≥ SMR, then selecting a bap value larger than bap<sub>0</sub> will not cause any perceptual distortion.</p><p id="p0020" num="0020">On the other hand, given a bit rate, the number of bits in a bit stream associated to an audio signal is fixed. Therefore the final bap values should fulfil this bit budget constraint. In the AC-3 standard, an SNR-offset parameter is used to shift the original masking curve such that the bit rate constraint is satisfied, and instead of SMR alone, the sum of SMR and SNR-offset is employed to determine the actual bap values. For SNR-offset &gt; 0, an increased bap value is obtained. Conversely, SNR-offset &lt; 0 will result in a decreased bap value, which however will cause audible distortions. During the AC-3 encoding, the SNR-offset value is determined through an iterative process so that the finally determined bap values are consistent with the bit rate constraint. These final bap values and the corresponding SNR-offset values are included in the AC-3 bit stream.</p><p id="p0021" num="0021">An AC-3 bit stream is composed of sync frames, where each sync frame corresponds to the code for 1536 PCM samples. It includes synchronisation information, bit stream information and audio blocks containing exponent and mantissa information. For error detection, two 16-bit cyclic redundancy check (CRC) words are used for each sync frame. The first CRC is employed to check the first 5/8 of the sync frame, and the second one to check the whole sync frame.</p><heading id="h0006"><i>Basic decoding steps for a full-bandwidth channel</i></heading><p id="p0022" num="0022">In a received AC-3 bit stream the exponents can be calculated easily from the reference exponents and the differential exponents. After calculating the PSD values and the masking curve, the bap values are determined by taking the received SNR-offset values into account. Each bap value and<!-- EPO <DP n="8"> --> its associated mantissa bits deliver a quantised mantissa and, together with the corresponding exponent values, quantised MDCT coefficients are reconstructed. Following the WOLA processing, a PCM signal is recovered.</p><heading id="h0007"><i>Improved watermark embedder according to the invention</i></heading><p id="p0023" num="0023">A systematic overview of watermark embedding in an AC-3 bit stream is shown in <figref idrefs="f0001">Fig. 1</figref>. The AC-3 bit stream is input to a watermark embedder 11 which generates another AC-3 bit stream compatible to the AC-3 standard. A secret key and a watermark information payload are input to a watermark reference pattern generation 12 controlling embedder 11. In embedder 11, the AC-3 bit stream is modified according to the reference patterns.</p><p id="p0024" num="0024">As described above, bap values in the AC-3 bit stream are larger than required by the perceptual constraint if SNR-offset &gt; 0. Therefore corresponding mantissa values can be modified without causing perceptual distortions, which enables watermark information embedding. <figref idrefs="f0001">Fig. 2</figref> shows example SNR-offset dB values of an AC-3 bit stream with 384kbps bit rate as a function of the block index, where each block has its own SNR-offset.</p><p id="p0025" num="0025">The inventive watermark embedding by means of changing mantissa bits of an AC-3 bit stream is depicted in <figref idrefs="f0002">Fig. 3</figref>. In a partial AC-3 bit stream decoding step or stage 31, the mantissa and bap values and the exponents are derived from the bit stream, the corresponding PSD values are calculated from the exponents and the resulting masking curve is determined. Such partial decoding steps are described in detail in sections 6 and 7 of the AC-3 standard.</p><p id="p0026" num="0026">Based on the calculated masking curve and the PSD values, the truly required (i.e. without the 'reserve masking range' normally present in AC-3) bap values denoted as bap_t values,<!-- EPO <DP n="9"> --> are determined similarly in a bap_t calculation step or stage 32 by setting SNR-offset values to zero.</p><p id="p0027" num="0027">Remark: if SNR-offset &lt; 0, SNR-offset can be decreased further to get bap_t &lt; bap, in case further quality degradation is allowed.</p><p id="p0028" num="0028">As an example, <figref idrefs="f0002">Fig. 4</figref> shows vs. the frequency bin index for a specific block bap values from the bit stream and the calculated bap_t values, demonstrating the possibility of watermark embedding without sacrificing the perceptual quality.</p><p id="p0029" num="0029">From the bap_t values, from the mantissa and bap values from step/stage 31, and from reference mantissa values (explained below) received from the processing or circuitry described in connection with <figref idrefs="f0004">Fig. 7</figref>, a mantissa value modification is carried out in step or stage 33, as explained in connection with <figref idrefs="f0003">Fig. 5 and Fig. 6</figref>. Finally, the original AC-3 mantissa bits are correspondingly changed in mantissa bit changing step or stage 34, based on the output of step/stage 33.</p><p id="p0030" num="0030">Not all allowable mantissa modifications found in step/stage 33 may be used, or completely used, in step/stage 34, (as explained below) because the totally available watermarking capacity may not be completely required in a current application.</p><p id="p0031" num="0031">Regarding allowed mantissa changes based on bit stream bap values and the corresponding calculated bap_t values, if a bap_t value is smaller than its corresponding bap value, watermark embedding is possible. The amount of allowed change is determined as depicted in <figref idrefs="f0003">Fig. 5</figref>, which shows quantised mantissas <i>m<sub>b</sub></i> and <i>m<sub>t</sub></i> for bap &gt; bap_t. As mentioned above, a larger bap value means a finer quantiser, i.e. more quantisation levels. In <figref idrefs="f0003">Fig. 5</figref>, the horizontal axis represents MDCT coefficient mantissa amplitude values, the short vertical lines are quantisation levels 'Δ' indicated by, or based<!-- EPO <DP n="10"> --> on, bap values and circles are quantisation levels 'Δ<i><sub>t</sub></i>' indicated by, or based on, bap_t values. According to the bap value in the bit stream, the original mantissa m of an MDCT coefficient is lying in the interval <i>m<sub>b</sub> -</i> Δ/2 ≤ <i>m &lt; m<sub>b</sub></i> +Δ/<i>2</i> and is quantised to value <i>m<sub>b</sub>.</i> On the other hand, as explained above a coarser quantiser based on bap_t and not causing any perceptual distortion can be used, which quantises the original mantissa value <i>m</i> to value <i>m<sub>t</sub></i> if mantissa <i>m</i> is lying in the interval <i>m<sub>t</sub>-</i>Δ<i><sub>t</sub></i>/2 ≤ <i>m</i> &lt; <i>m<sub>t</sub></i>+Δ<i><sub>t</sub></i>/2.</p><p id="p0032" num="0032">Because the maximal quantisation error when using bap is Δ/2 and the maximal allowed quantisation error when using bap_t is Δ<sub>t</sub>/2, the maximal allowed invention-related change for embedding becomes Δ<i><sub>t</sub></i>/2-Δ/2 for the quantised mantissa value <i>m<sub>b</sub>.</i></p><p id="p0033" num="0033">Thereafter, as explained below, the quantised mantissas are enlarged or decreased with respect to reference mantissas and the determined amount of allowed changes, such that the modified mantissa value is still on the grid of the finer quantiser. The term 'reference mantissa' means a desired mantissa value in view of the watermarking to be carried out. The set of such quantisation levels according to current bap values is determined where the maximum difference between quantisation levels in the set and <i>m<sub>b</sub></i> is Δ<i><sub>t</sub></i>/2-Δ/2. Then the quantisation level is selected within the set, which quantisation level is the nearest one to the reference mantissa <i>m<sub>r</sub></i>.</p><p id="p0034" num="0034"><figref idrefs="f0003">Fig. 6</figref> shows two corresponding examples for such mantissa modification. Like in <figref idrefs="f0003">Fig. 5</figref>, Δ is the quantisation step according to the bap value. Then the maximal allowed change is determined as <i>nΔ</i>, where <maths id="math0001" num=""><math display="inline"><mi>n</mi><mo>=</mo><mo>⌊</mo><mfrac><mrow><msub><mi mathvariant="normal">Δ</mi><mi>t</mi></msub><mo>/</mo><mn>2</mn></mrow><mi mathvariant="normal">Δ</mi></mfrac><mo>-</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>⌋</mo></math><img id="ib0001" file="imgb0001.tif" wi="30" he="14" img-content="math" img-format="tif" inline="yes"/></maths>and └'...'┘denotes an integer<!-- EPO <DP n="11"> --> value not larger than the '...' value. Therefore, the set of allowed quantisation levels will be <i>S</i>={<i>m<sub>b</sub>,m<sub>b</sub></i>±Δ,<i>...,m<sub>b</sub></i>±<i>n</i>Δ}<i>.</i> The mantissa modification is then reduced to find the quantisation level in <i>S</i> that has the minimum distance to a given reference mantissa value <i>m<sub>r</sub></i>. Accordingly, in <figref idrefs="f0003">Fig. 6a</figref> the modified mantissa value, denoted as <i>m<sub>m</sub>,</i> will be limited and have a value <i>m<sub>m</sub></i> = <i>m<sub>b</sub>+3</i>Δ<i>,</i> and in <figref idrefs="f0003">Fig. 6b</figref> the modified mantissa value becomes <i>m<sub>m</sub></i> = <i>m<sub>b</sub>-2</i>Δ. According to the modified mantissa values <i>m<sub>m'</sub></i> the original mantissa bits in the AC-3 standard bit stream are changed. Because the corresponding bap value is the same, the other parameters in the bit stream remain unchanged. Any subset of <i>S</i> can be employed for the mantissa modification, while fully using <i>S</i> enables the maximal embedding strength.</p><heading id="h0008"><i>Generation of reference patterns</i></heading><p id="p0035" num="0035">Dependent on a secret key (cf. <figref idrefs="f0001">Fig. 1</figref>), N<sub>W</sub> different time domain reference patterns are generated in random generator 71 in <figref idrefs="f0004">Fig. 7</figref>, where N<sub>W</sub> denotes the alphabet size of the watermark symbols to be used. For each watermark symbol, a time domain reference pattern of length <i>L</i> (for example <i>L</i> =16384) is randomly generated, where cross-correlation between different time domain reference patterns should be low and auto-correlation of each reference pattern has a large peak.</p><p id="p0036" num="0036">For each time domain reference pattern, the frequency domain reference pattern is then calculated in step/stage 72 by means of AC-3 WOL processing and MDCT transform similar as in the AC-3 encoder: one time domain reference pattern is divided into overlapped blocks, and each block is weighted by a window function. Each weighted block is then transformed to the frequency domain by means of MDCT. For 50% overlapping, a block length of 512 and a reference pattern<!-- EPO <DP n="12"> --> length of 16384, this results in 16128 MDCT coefficients.</p><p id="p0037" num="0037">In step or stage 73 a current group of mantissa values obtained from the calculated MDCT coefficients is extracted. According to a current watermark information symbol, a frequency domain reference pattern is applied to the corresponding mantissa values (in this example, each symbol corresponds to 16128 mantissa values), and the resulting current reference (i.e. desired) mantissa values are used in step/stage 33 in <figref idrefs="f0002">Fig. 3</figref> for embedding the watermark information.</p><heading id="h0009"><i>Watermark detection</i></heading><p id="p0038" num="0038">Watermark detection in a received watermarked signal can be carried out by means of cross-correlation as described in <patcit id="pcit0002" dnum="WO2007031423A1"><text>WO 2007/031423 A1</text></patcit>, or by means of a statistical detector as described in <patcit id="pcit0003" dnum="EP2175444A1"><text>EP 2175444 A1</text></patcit> or <patcit id="pcit0004" dnum="WO2011141292A1"><text>WO 2011/141292 A1</text></patcit>. The set of N<sub>W</sub> different time (or frequency) domain reference patterns is stored in the watermark decoder, or is generated in the decoder by using the same key or keys as the encoder has used. In the watermark detection processing, post-processing steps like frequency range limitation or spectrum whitening may be carried out in order to generate a whitened watermarked signal and a whitened time-domain reference signal. As shown in <figref idrefs="f0004">Fig. 8</figref>, the received watermarked AC-3 signal passes through a postprocessing step or stage 82 to a cross-correlator or statistical detector 83. Candidate time domain reference patterns to be checked may also pass through a corresponding postprocessing step or stage 81 and are used in step/stage 83 for correlation with corresponding sections of the received signal, or for statistical detection. In case of a match, step/stage 83 outputs the detected corresponding watermark information.</p><p id="p0039" num="0039">More details can be found in <nplcit id="ncit0001" npl-type="s"><text>M. Arnold, P.G. Baum, W. Voessing, "A phase modulation audio watermarking technique,"<!-- EPO <DP n="13"> --> 11th Information Hiding Workshop, pages 102-116, 2009</text></nplcit>. Consequently, a watermark detector used for PCM watermarked signals may also be used for AC-3 bit stream watermark detection. That is, the detector interoperability is maintained: the watermark can be detected, irrespective of whether it is a watermarked PCM signal or a watermarked signal with embedding occurring in the AC-3 bit stream.</p><p id="p0040" num="0040">The described watermark embedding processing based on changing the mantissa values can be applied to other PCM audio watermarking systems as well. The generation of the reference mantissas is based on a time-domain reference pattern dependent on the watermark symbol, which can be generated for any audio watermarking processing. In turn the embedding procedure according to <figref idrefs="f0004">Fig. 7</figref> can be applied starting from the time-domain reference pattern. The corresponding detection algorithm for PCM watermarking can be used accordingly to the detection domain of the specific audio watermarking system.</p></description><claims mxw-id="PCLM56976360" lang="EN" load-source="patent-office"><!-- EPO <DP n="14"> --><claim id="c-en-0001" num="0001"><claim-text>Method for watermarking an AC-3 encoded bit stream, <b>characterised by</b> the steps:
<claim-text>- partially decoding (31) said AC-3 encoded bit stream, thereby providing original quantised mantissa values (<i>m<sub>b</sub></i>) and exponent values derived from MDCT transform coefficients and bap values for said mantissa values, and determining the corresponding PSD values from said exponent values and determining from said PSD values the resulting masking curve;</claim-text>
<claim-text>- determining (32) from said masking curve and said PSD values truly required bap values denoted as bap_t values;</claim-text>
<claim-text>- determining (33) from said original mantissa values (<i>m<sub>b</sub></i>), said bap values and said bap_t values a maximum allowable mantissa value modification for a current mantissa and, if applicable, limiting (<i>m<sub>m</sub></i>) a desired value for said current mantissa by said maximum allowable mantissa value modification, wherein said desired mantissa value is received from a watermarking processing;</claim-text>
<claim-text>- changing (34) the original AC-3 mantissa bits for a current mantissa value according to said limited desired mantissa value (<i>m<sub>m</sub></i>).</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>Apparatus for watermarking an AC-3 encoded bit stream, said apparatus including:
<claim-text>- means (31) being adapted for partially decoding said AC-3 encoded bit stream, thereby providing original quantised mantissa values (<i>m<sub>b</sub></i>) and exponent values derived from MDCT transform coefficients and bap values for said mantissa values, and for determining the corresponding PSD values from said exponent values and for determining from said PSD values the resulting masking curve;<!-- EPO <DP n="15"> --></claim-text>
<claim-text>- means (32) being adapted for determining from said masking curve and said PSD values truly required bap values denoted as bap_t values;</claim-text>
<claim-text>- means (33) being adapted for determining from said original mantissa values (<i>m<sub>b</sub></i>), said bap values and said bap_t values a maximum allowable mantissa value modification for a current mantissa and, if applicable, for limiting (<i>m<sub>m</sub></i>) a desired value for said current mantissa by said maximum allowable mantissa value modification, wherein said desired mantissa value is received from a watermarking processing;</claim-text>
<claim-text>- means (34) being adapted for changing the original AC-3 mantissa bits for a current mantissa value according to said limited desired mantissa value (<i>m<sub>m</sub></i>).</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>Method according to the method of claim 1, or apparatus according to the apparatus of claim 2, wherein said watermarking processing includes the steps:
<claim-text>- random generating (71) based on a secret key, for each watermark symbol to be available, a set of time domain reference patterns;</claim-text>
<claim-text>- calculating (72) from said time domain reference patterns corresponding frequency domain reference patterns by carrying out an AC-3 WOL processing and MDCT transform on said time domain reference patterns;</claim-text>
<claim-text>- extracting (73) a current group of mantissa values from the MDCT coefficients;</claim-text>
<claim-text>- based on a current watermark symbol, selecting (74) a corresponding frequency domain reference pattern for determining a current group of desired mantissa values.</claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>Method according to the method of claim 1 or 3, or apparatus according to the apparatus of claim 2 or 3, wherein:<!-- EPO <DP n="16"> -->
<claim-text>if value 'Δ' is a current quantisation level distance based on a current bap value and 'Δ<i><sub>t</sub></i>' is a current quantisation level distance based on a current bap_t value,</claim-text>
<claim-text>the current original mantissa value <i>m</i> is lying in the interval <i>m<sub>b</sub>-</i>Δ/2 ≤ <i>m &lt; m<sub>b</sub></i>+Δ/2 and is quantised to value <i>m<sub>b</sub>,</i></claim-text>
<claim-text>and the current original mantissa value <i>m</i> is lying in the interval <i>m<sub>t</sub>-</i>Δt/2 ≤ <i>m &lt; m<sub>t</sub></i>+Δ<i>t</i>/2 and is quantised to value <i>m<sub>t</sub>,</i></claim-text>
<claim-text>the maximal allowed <i>m<sub>b</sub></i> value change for embedding watermark information is Δ<i><sub>t</sub></i>/2 - Δ/2.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>Method according to the method of claim 4, or apparatus according to the apparatus of claim 4, wherein the value (<i>m<sub>m</sub></i>) of a current mantissa is changed according to said desired mantissa value (74) but not by more than Δ<i><sub>t</sub></i>/2 - Δ/2.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>Method according to the method of one of claims 1 and 3 to 5, or apparatus according to the apparatus of one of claims 2 to 5, wherein, following said changing (34) of mantissa values according to said limited desired mantissa value (<i>m<sub>m</sub></i>)<i>,</i> the CRC check data in the current AC-3 sync frame are updated correspondingly.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>AC-3 audio signal that is watermarked according to the method of one of claims 1 and 3 to 6.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>Storage medium that contains or stores, or has recorded on it, an AC-3 audio signal according to claim 7.</claim-text></claim></claims><drawings mxw-id="PDW16667141" load-source="patent-office"><!-- EPO <DP n="17"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="18"> --><figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="165" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="19"> --><figure id="f0003" num="5,6a,6b"><img id="if0003" file="imgf0003.tif" wi="165" he="194" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="20"> --><figure id="f0004" num="7,8"><img id="if0004" file="imgf0004.tif" wi="151" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="160" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="163" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
