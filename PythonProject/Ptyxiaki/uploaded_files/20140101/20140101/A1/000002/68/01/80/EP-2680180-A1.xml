<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680180-A1" country="EP" doc-number="2680180" kind="A1" date="20140101" family-id="46545707" file-reference-id="222807" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549450" ucid="EP-2680180-A1"><document-id><country>EP</country><doc-number>2680180</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12305781-A" is-representative="YES"><document-id mxw-id="PAPP154823373" load-source="docdb" format="epo"><country>EP</country><doc-number>12305781</doc-number><kind>A</kind><date>20120629</date><lang>EN</lang></document-id><document-id mxw-id="PAPP187510443" load-source="docdb" format="original"><country>EP</country><doc-number>12305781.2</doc-number><date>20120629</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140453611" ucid="EP-12305781-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12305781</doc-number><kind>A</kind><date>20120629</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988135696" load-source="docdb">G06F  21/00        20130101AFI20121128BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1988921223" load-source="docdb" scheme="CPC">G06F  21/53        20130101 FI20140103BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180834" lang="DE" load-source="patent-office">System und Verfahren zur sicheren Zuweisung eines virtualisierten Speichers</invention-title><invention-title mxw-id="PT132180835" lang="EN" load-source="patent-office">System and method for securely allocating a virtualised space</invention-title><invention-title mxw-id="PT132180836" lang="FR" load-source="patent-office">Système et procédé permettant d'attribuer de manière sécurisée un espace virtualisé</invention-title><citations><patent-citations><patcit mxw-id="PCIT242652484" load-source="docdb" ucid="EP-1818833-A1"><document-id format="epo"><country>EP</country><doc-number>1818833</doc-number><kind>A1</kind><date>20070815</date></document-id><sources><source name="SEA" category="I" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652485" load-source="docdb" ucid="US-20090204964-A1"><document-id format="epo"><country>US</country><doc-number>20090204964</doc-number><kind>A1</kind><date>20090813</date></document-id><sources><source name="SEA" category="I" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>GARFINKEL T:  "Terra: a virtual machine-based platform for trusted computing", ACM SOSP. PROCEEDINGS OF THE ACM SYMPOSIUM ON OPERATING SYSTEMSPRINCIPLES; 20031019, 22 October 2003 (2003-10-22), pages 193-206, XP002340992,</text><sources><source mxw-id="PNPL45131079" load-source="docdb" name="SEA" category="A"/></sources></nplcit><nplcit><text>None</text><sources><source mxw-id="PNPL45131080" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>SCOTT T A:  "HOW TO PLAY OUTSIDE THE JAVA SANDBOX", JOURNAL OF COMPUTING IN SMALL COLLEGES, XX, US, vol. 15, no. 1, 1 November 1999 (1999-11-01), pages 114-125, XP008002962,</text><sources><source mxw-id="PNPL45131081" load-source="docdb" name="SEA" category="A"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918156637" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ORANGE</last-name><address><country>FR</country></address></addressbook></applicant><applicant mxw-id="PPAR918151734" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ORANGE</last-name></addressbook></applicant><applicant mxw-id="PPAR918982478" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Orange</last-name><iid>101394618</iid><address><street>78, rue Olivier de Serres</street><city>75015 Paris</city><country>FR</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918167032" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>LOUI SOK-YEN</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918170045" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>LOUI, SOK-YEN</last-name></addressbook></inventor><inventor mxw-id="PPAR918985610" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>LOUI, SOK-YEN</last-name><address><street>118, rue du Tilleul</street><city>94370 Sucy en Brie</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918135901" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>AHMAD ZAHEER</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR918163478" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>AHMAD, ZAHEER</last-name></addressbook></inventor><inventor mxw-id="PPAR918986314" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>AHMAD, ZAHEER</last-name><address><street>29, Old Manor Road Southal</street><city>UB2 5JN London</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR918151624" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>DONG SONG</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR918148730" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>DONG, Song</last-name></addressbook></inventor><inventor mxw-id="PPAR918981222" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>DONG, Song</last-name><address><street>15 Mead Close</street><city>TW20 8JA Egham - Surrey</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR918132748" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>WARY JEAN-PHILIPPE</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR918133587" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>WARY, JEAN-PHILIPPE</last-name></addressbook></inventor><inventor mxw-id="PPAR918981207" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>WARY, JEAN-PHILIPPE</last-name><address><street>41, rue de la Fontaine Grelot</street><city>92340 Bourg la Reine</city><country>FR</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918985020" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Cabinet Plasseraud</last-name><iid>100784233</iid><address><street>52, rue de la Victoire</street><city>75440 Paris Cedex 09</city><country>FR</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548804898" load-source="docdb">AL</country><country mxw-id="DS548895153" load-source="docdb">AT</country><country mxw-id="DS548804900" load-source="docdb">BE</country><country mxw-id="DS548842080" load-source="docdb">BG</country><country mxw-id="DS548863153" load-source="docdb">CH</country><country mxw-id="DS548869687" load-source="docdb">CY</country><country mxw-id="DS548895370" load-source="docdb">CZ</country><country mxw-id="DS548881108" load-source="docdb">DE</country><country mxw-id="DS548804901" load-source="docdb">DK</country><country mxw-id="DS548869688" load-source="docdb">EE</country><country mxw-id="DS548866262" load-source="docdb">ES</country><country mxw-id="DS548842081" load-source="docdb">FI</country><country mxw-id="DS548842082" load-source="docdb">FR</country><country mxw-id="DS548804906" load-source="docdb">GB</country><country mxw-id="DS548804907" load-source="docdb">GR</country><country mxw-id="DS548804908" load-source="docdb">HR</country><country mxw-id="DS548895371" load-source="docdb">HU</country><country mxw-id="DS548863154" load-source="docdb">IE</country><country mxw-id="DS548804909" load-source="docdb">IS</country><country mxw-id="DS548842083" load-source="docdb">IT</country><country mxw-id="DS548869689" load-source="docdb">LI</country><country mxw-id="DS548881109" load-source="docdb">LT</country><country mxw-id="DS548895372" load-source="docdb">LU</country><country mxw-id="DS548881110" load-source="docdb">LV</country><country mxw-id="DS548881111" load-source="docdb">MC</country><country mxw-id="DS548805027" load-source="docdb">MK</country><country mxw-id="DS548805028" load-source="docdb">MT</country><country mxw-id="DS548895373" load-source="docdb">NL</country><country mxw-id="DS548804922" load-source="docdb">NO</country><country mxw-id="DS548895642" load-source="docdb">PL</country><country mxw-id="DS548804923" load-source="docdb">PT</country><country mxw-id="DS548895643" load-source="docdb">RO</country><country mxw-id="DS548881117" load-source="docdb">RS</country><country mxw-id="DS548895644" load-source="docdb">SE</country><country mxw-id="DS548881118" load-source="docdb">SI</country><country mxw-id="DS548869962" load-source="docdb">SK</country><country mxw-id="DS548869963" load-source="docdb">SM</country><country mxw-id="DS548805029" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128670119" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A method of securely allocating a virtual space to a third party in a memory of a device is described. The memory has both trusted and un-trusted areas. The method includes the steps of receiving a request for a virtual space allocation from a third party and authenticating the third party. The method also includes the steps of determining the existence of a unique virtual space controller for controlling access to a virtual space in an area of the memory, the unique virtual space controller being uniquely associated with the virtual space and requesting the creation of a unique virtual space controller if one does not exist. The unique virtual space controller is located in a trusted area of memory and arranged to enforce a security policy for communication with the virtual space. Finally, the method comprises the step of providing the third party with the security policy for communication with the virtual space.
<img id="iaf01" file="imgaf001.tif" wi="111" he="91" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499492" lang="EN" source="EPO" load-source="docdb"><p>A method of securely allocating a virtual space to a third party in a memory of a device is described. The memory has both trusted and un-trusted areas. The method includes the steps of receiving a request for a virtual space allocation from a third party and authenticating the third party. The method also includes the steps of determining the existence of a unique virtual space controller for controlling access to a virtual space in an area of the memory, the unique virtual space controller being uniquely associated with the virtual space and requesting the creation of a unique virtual space controller if one does not exist. The unique virtual space controller is located in a trusted area of memory and arranged to enforce a security policy for communication with the virtual space. Finally, the method comprises the step of providing the third party with the security policy for communication with the virtual space.</p></abstract><description mxw-id="PDES63955549" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">The present invention relates to the field of embedded system virtualization. More specifically, the present invention relates to a system and method of securely allocating a virtual space to a third party in a memory of a device.</p><p id="p0002" num="0002">In the legacy fixed computing world, a user is allowed to install various third party applications running on an open operating system. Security issues, such as viruses, spyware exploiting applications and/or "OS" (for "Operating System") vulnerabilities have appeared, because user devices are usually equipped with IP connectivity and can be connected to the Internet. Because of this, on one side, the user is faced with malwares and on the other side, third party service providers that have to deliver a service onto the user's device over the internet are concerned with the assurance to operate a safe service for their customers. The same problems occurred in the domain of Machine-to-Machine ("M2M") and Internet Of Things (IOT), with more constraints, as in this latter case an equipment could operate without any human interaction for a long period of time.</p><p id="p0003" num="0003">Similarly, in the mobile computing world, hand-held devices are no longer simple device for making telephone calls, but are rather powerful communication and entertainment computing platforms for multimedia players, web surfing, social networking, GPS navigation and electronic financial transactions. This usage is boosted by various application stores that allow third party applications to be downloaded and installed easily onto the device. Unfortunately, this rich range of applications also leads to the potential installation of malicious applications that brings security concerns such as unauthorized access to personal data, geo-location information about the user, fraudulent usage of premium services, etc.</p><p id="p0004" num="0004">For both fixed and mobile computing worlds, solutions addressing these security issues exist. A first known solution is proposed on an application level: anti-virus for fixed and mobile devices; firewalls to enforce access and flow policy; sandboxing mechanism in web browsers to run Java applets; specific permission model to enforce access control to critical resources. A second known solution is based on dedicated hardware, such as Security Digital card, Trusted Platform Module (or "TPM") for<!-- EPO <DP n="2"> --> cryptographic operations and key storage. And a third solution uses hypervisors to isolate third party applications in virtual machines running on the same physical hardware.</p><p id="p0005" num="0005">Typically, access control and virtualisation of hardware is performed by what is known as a "hypervisor" (also known as a Monitor or a Virtual Machine Manager, or a "VMM"). By using such an entity, several virtual spaces can be created under the control of a hypervisor inside a device. In accordance with these types of schemes, a user who owns a plurality of devices such as set-top-box, mobile handset, laptop, or "smart appliance" like networked refrigerator, is able to apply such schemes on each of his/her devices</p><p id="p0006" num="0006">Known hypervisors in such devices create virtual spaces mainly for isolation purposes. Applications running in one virtual space cannot directly access the data in memory areas dedicated to other virtual spaces. Any communication between an application in one virtual space and an application in another virtual space is facilitated by the hypervisor. This functionality is obtained by trapping instructions and using specific protocols to communicate between the virtual spaces. Although hypervisors can provide some level of software-based isolation to processes and data, the information in a virtual space and/or the information in other areas of the device hosting the virtual space can still be compromised by rogue programs since this solution is completely software-oriented. Thus, the difficulty is to give the assurance of a safe delivery of services to third parties and to the user who owns the device.</p><p id="p0007" num="0007">In order to try to remedy this deficiency, other types of isolation have been developed, which types include hardware assisted techniques in which a portion of memory is defined as being "trusted". Once memory locations are defined as trusted, only trusted applications can get access to them in order to create a TEE (Trusted Execution Environment). An example of such a system is TrustZone™, in which an extra address bit is used to distinguish between two "worlds", named "normal world" and "secure world".</p><p id="p0008" num="0008">As opposed to the software isolation of virtual spaces created by a hypervisor, trusted memory is hardware protected and is controlled by dedicated monitoring software known as a "monitor". The processes and data that need high levels of security are<!-- EPO <DP n="3"> --> processed and stored in the TrustZone™ secure world. After the completion of the TEE process, the monitor switches back to the normal world.</p><p id="p0009" num="0009">Whilst the security created by the establishment of a TEE is considered higher than the security provided by the hypervisor, the size of the trusted memory space is often limited in embedded devices and only part of a process that needs critical levels of security can therefore be processed in the trusted memory. Moreover, the price of such a solution limits its use in embedded devices. Thus, today, existing software based solutions are prone to attacks and TPM or TEE based solutions have limited space to host third party applications.</p><p id="p0010" num="0010">Accordingly, there is currently no technical solution to the problem of enabling remotely the capability of creation, allocation and management of virtual spaces for third party usages in embedded devices with critical levels of security and isolation by simultaneously giving trust to the user of the device and to the third party regarding the safety execution environment of its delivery service.</p><p id="p0011" num="0011">In order to solve the problems associated with the prior art, the present invention provides a method of securely allocating a virtual space to a third party in a memory of a device, the memory having both trusted and un-trusted areas, the method comprises the steps of: receiving a request for a virtual space allocation from a third party; authenticating the third party; determining the existence of a unique virtual space controller for controlling access to a virtual space in an area of the memory, the unique virtual space controller being uniquely associated with the virtual space; requesting the creation of a unique virtual space controller if one does not exist, wherein the unique virtual space controller is located in a trusted area of memory and arranged to enforce a security policy for communication with the virtual space; and providing the third party with the security policy for communication with the virtual space.</p><p id="p0012" num="0012">The method may further comprise the step of: if the request comprises a constraint on the virtual space, verifying whether the device satisfies the constraint.<!-- EPO <DP n="4"> --></p><p id="p0013" num="0013">Preferably, the constraint on the virtual space is one of needed memory size for the virtual space, the type of the device, the address of the device in the network, the usage profile, and the duration of the use.</p><p id="p0014" num="0014">The method may further comprise the step of: if the request comprises a constraint on the device, verifying whether the device satisfies the constraint.</p><p id="p0015" num="0015">Preferably, the constraint on the device is one of available size in memory, device capability, description of the foreseen usage of the virtual space, and device address.</p><p id="p0016" num="0016">Preferably, the method further comprises the step of: verifying the legitimacy of the request sent by the third party.</p><p id="p0017" num="0017">Preferably, the step of verifying the legitimacy of the requests includes the step of verifying whether the third party is authorized to access a virtual space in a specific device.</p><p id="p0018" num="0018">Preferably, the method further comprises the steps of: requesting, from the third party, an indication of the security policy to be enforced; and receiving, from the third party, an indication of the security policy to be enforced.</p><p id="p0019" num="0019">Preferably, the step of requesting from the third party an indication of the security policy to be enforced, further includes requesting that the third party select a security policy from a number of predefined security policies.</p><p id="p0020" num="0020">Preferably, the unique virtual space controller is located in the trusted area of a first device, and the virtual space is located in a second device, which second device is remote from the first device.</p><p id="p0021" num="0021">Preferably, the method further comprises the steps of: informing the third party of the virtual space allocation; and enabling the third party to communicate directly with the virtual space under the control of the unique virtual space controller.</p><p id="p0022" num="0022">Preferably, upon receipt of the allocation request form the third party, the method further comprises the steps of: retrieving user identity from a universal subscriber identity module comprised in the device; and memorizing the user identity as a trusted record.</p><p id="p0023" num="0023">The present invention also provides a computer program product for a data-processing device, the computer program product comprising a set of instructions which,<!-- EPO <DP n="5"> --> when loaded into the data-processing device, causes the device to perform the steps of the above method.</p><p id="p0024" num="0024">The present invention further provides a master controller for securely allocating a virtual space to a third party in a memory of a device, the memory having both trusted and un-trusted areas, the master controller comprises processing means arranged to: receiving a request for a virtual space allocation from a third party; authenticating the third party; determining the existence of a unique virtual space controller for controlling access to a virtual space in an area of the memory, the unique virtual space controller being uniquely associated with the virtual space; requesting the creation of a unique virtual space controller if one does not exist, wherein the unique virtual space controller is located in a trusted area of memory and arranged to enforce a security policy for communication with the virtual space; and providing the third party with the security policy for communication with the virtual space.</p><p id="p0025" num="0025">As will be appreciated by the skilled reader, the present invention provides several advantages over the prior art. For example, the present invention provides for the dynamic creation and management of virtual spaces over remote equipments. Moreover, the present invention provides increased flexibility and granularity of the management of virtual spaces, in that it allows users to determine how applications are run (or which applications are allowed) and in particular the present invention allows the application of a specific third party's security policy to each virtual space or even hosted applications in those virtual spaces. Moreover, the method allows the third party to modify the security policy during the usage of the allocated virtual space.</p><p id="p0026" num="0026">In accordance with the present invention, all input-output requests to the virtualized area are potentially subject to the control and authorization of a management entity which is outside of the hypervisor. This outsourcing permits the strict allocation of the virtual space security to the control of a specific third party, while simultaneously managing several virtual spaces allocated to many third parties.</p><p id="p0027" num="0027">Furthermore, in current systems, virtualization of a device is merely controlled locally without end-to-end proof of security. In particular, using prior art devices, it is not<!-- EPO <DP n="6"> --> possible to dedicate a virtual space of a device to a specific third party autonomously and with a level of the security tailored to that third party. Dissimilarly, the dual virtual space controller of the virtual space enforces the security policies which are necessary to protect the integrity of the virtual space and its contents, in particular the dedicated dual virtual space controller of the virtual space controls the security of communication of this specific virtual space with the others memory areas of the device. The proposed framework facilitates third party applications to be installed securely in a dedicated virtual space controlled by the master application for instance in a trusted Environment or in TEE with correct level of security.</p><p id="p0028" num="0028">Moreover, in some examples, if a user has several devices capable of creating trusted and un-trusted memory spaces, it is possible to connect virtual spaces of these devices securely with one another to create a Virtual Private Network (VPN). An advantage of the present invention is that several virtual spaces are connected through this VPN , in which the routing function of this VPN is assumed by the master controller service and the controls of exchanged flow inside this VPN are enforced by the local virtual space hypervisor under the strict control of associated dual virtual space controller services. Each virtual space can be allocated to a third party by the user so that a third party program can run in the dedicated virtual space and potentially been in communication with other virtual space owned by other third party.</p><p id="p0029" num="0029">Another advantage of the present invention is that it allows the third party to directly manage a dedicated security policy for every virtual space it has enslaved/controlled, i.e. on every device. This provides flexibility to implement in every location or device, or for every couple (VS, DVSC) its own specific and chosen security policy which is more detailed and precise than the fleet security management provided by known systems.</p><p id="p0030" num="0030">Furthermore, the system of the present invention can help to implement new "M2M" (for "Machine to Machine") services in trusted environment under control of the owner of the M2M devices. The proposed invention facilitates third party identification of a virtual space and its owner quickly, as the notion of trusted virtual space and related "e2e" (for "end-to-end") service link is readily available. So the third party can securely run its services in the desired location of the user network.<!-- EPO <DP n="7"> --></p><p id="p0031" num="0031">Other advantages and benefits of the present invention will become apparent from a consideration of the following description and accompanying drawings, in which:
<ul><li><figref idrefs="f0001">FIGURE 1</figref> is high-level diagram of a network which can be used in accordance with an embodiment of the present invention;</li><li><figref idrefs="f0002">FIGURE 2</figref> is high-level diagram of a scheme to allow third parties to access virtual spaces in a user's network in accordance with an embodiment of the present invention;</li><li><figref idrefs="f0003">FIGURE 3</figref> is flow chart representing a method of allocating a virtual space to a third party;</li><li><figref idrefs="f0004">FIGURE 4</figref> is a schematic illustration of the use of a Universal Subscriber Identity Module by a master controller to provide the identity of the user to a third party; and</li><li><figref idrefs="f0005">FIGURE 5</figref> is a high-level functional diagram of the operation of a dual virtual space controller.</li></ul></p><p id="p0032" num="0032">In the present disclosure, the term virtual space (VS) is defined as an isolated area in an area of a memory of a device. A virtual space can be created by known virtualization techniques such as a hypervisor. In this description, we associate the notion of virtual space with the underlying system in charge of the virtualization technique. For instance, the virtual space corresponds to the set comprising the hypervisor which managed the virtualized space, and the virtualized space itself, it means that the global notion of virtual space comprises the operating system which allows communication outside of the virtual space itself.</p><p id="p0033" num="0033">The term dual virtual space controller (DVSC) is defined herein as a trustable application stored in some area of the device memory. In the present disclosure, the terms dual virtual space controller and virtual space controller signify the same application, the usage of the word dual is used to reinforce the unique link between a virtual space and its corresponding dual (as unique) virtual space controller. The dual virtual space controller is provided to control the virtual space in an area of the memory of the device. In this description, the notion of dual space controller is associated with the means necessary to<!-- EPO <DP n="8"> --> allow the dual virtual space controller to communicate outside of the dual virtual space controller component itself.</p><p id="p0034" num="0034">A trusted area is an area in the memory considered as trusted by the user who owns the device or by an operator of the global service; moreover a third party may recognize the trusted status of this area. Nowadays, several equipments are considered to offer trusted areas, e.g. smartcard, "HSM" (for "Hardware Secure Module"), "TPM" (for "Trusted Platform Module"), "SOC" (for "Security Operating Center"), which forms a set of systems dedicated to security management, System on Chip and the dedicated computer of the user who considers it as trusted.</p><p id="p0035" num="0035">A user's devices network is a network comprising several devices owned or operated by the user, which network is managed by the user itself.</p><p id="p0036" num="0036">The term master controller (MC) is defined herein as a trustable application which acts as a security gateway to facilitate the allocation of dual virtual space controllers and virtual spaces to third parties outside of the user's device network. This master controller is considered as trusted by the user or by the operator of the global service, and a third party may recognize the trusted status of this application.</p><p id="p0037" num="0037">An embedded hypervisor is defined herein as a software layer specifically designed to virtualize part of an embedded device. Such embedded devices can include, but are not limited to, laptops, communication modules, mobile handsets or set-top boxes and connected equipments.</p><p id="p0038" num="0038">A "Trusted Execution Environment" ("TEE") is defined herein as a hardware-assisted security framework standardized within Global Platform. It is a separate execution environment that runs alongside a Rich Operating System and provides security services to that Rich Operating System Environment. The Rich Operating System is defined herein as an operating system environment with a rich capability set. This environment allows a user to download and run applications. The Trusted Operating System is defined herein as an operating system running in the TEE. It provides the TEE Internal API (for "Application Programming Interface") to trusted applications and a proprietary method to enable the TEE client API software interface from other execution environment.<!-- EPO <DP n="9"> --></p><p id="p0039" num="0039">Third party (TP) is a general term used by those skilled in the art of information technology for identifying a person or an entity which does not own the user's or operator's network, system or device, but which can access a primary user's or operator's network, system or device with permission from that primary user or operator and/or from the network, system or device themselves to deliver services or contents. The third party is generally, but is not limited to, represented by the client application installed from an application store in an equipment of the user or operator. More generally, a third party is running its own infrastructure of networks and servers in order to be able to deliver, bill, charge the requested content or service to a consumer over operator's networks and services.</p><p id="p0040" num="0040"><figref idrefs="f0001">Figure 1</figref> shows a high-level diagram of a private network 100 which can be used in accordance with an embodiment of the present invention. As can be seen in <figref idrefs="f0001">Figure 1</figref>, a third party 120 is outside of the private network 100. The private network 100 consist of user's devices that may or may not have trusted memory, such as a laptop 103 with an hypervisor (the hypervisor is not represented on <figref idrefs="f0001">figure 1</figref>), a secure element 104 connected to a USB port of the laptop, a smart appliance with embedded secure element such as a smart fridge 105, a set-top box 102 with a trusted area ("t.a." on <figref idrefs="f0001">figure 1</figref>) and a handset 101 with a trusted area. The invention is not limited to such a private network.</p><p id="p0041" num="0041">Using the framework of the invention described herein, a master controller 110 can be implemented in a trusted device area, such as the trusted area of the set-top box 102. The master controller 110 handles the requests from third party 120 requesting for allocation of virtual spaces in any of the device in the private user's network 100. The master controller 110 receives the requests 121 and 122 for virtual space allocation from the third party 120. Then, the master controller 110 determines for each request which dual virtual space controller can handle the virtual space allocation in the case where the virtual space already exists. In the other case, the master controller 110 determines which dual virtual space controller can handle the virtual space creation and allocation.</p><p id="p0042" num="0042">Virtual spaces can be created in a memory area on any device of the private network 100, and some devices, such as handset 101, set-top-box 102 and laptop 103 can host several different virtual spaces. Virtual spaces and the associated dual virtual space controllers can be located in the same device or in different devices. In some<!-- EPO <DP n="10"> --> implementation, the master controller and the dual virtual space controller are co-localized together in the same device. In this case, a unique application implementing the master controller function and the dual virtual space controller function can execute both functions. In <figref idrefs="f0001">Figure 1</figref>, the virtual space 113 is under the control of the dual virtual space controller 111 and both are located in the same handset 101. The virtual space 114 located in the set-top box 102 is under the control of the dual virtual space controller 112 located in the secure element 104 connected to the laptop 103.</p><p id="p0043" num="0043">With reference to <figref idrefs="f0002 f0003 f0004 f0005">Figures 2 to 5</figref>, the operation of the master controller (MC) will now be described. <figref idrefs="f0002">Figure 2</figref> is a high-level diagram of a scheme that displays an example illustrating several virtual space/dual virtual space controller/third party associations at a given point in time: the master controller MC has previously received allocation requests for association of virtual space VS2 with dual virtual space controller DVSC2 for third party TP3, virtual space VS1 with dual virtual space controller DVSC1 for third party TP2, virtual space VS3 with dual virtual space controller DVSC3 for third party TP1, and we notice that the existing association between virtual space VS4 and dual virtual space controller DVSC4 is no more related to a dedicated third party. It means that the virtual space VS4 could be available for a new incoming allocation request from a third party.</p><p id="p0044" num="0044">In one embodiment of the invention, a function of the master controller is to route information between the dual virtual space controller of one device and the virtual space of other device in a "VPN" (for "Virtual Private Network") of user-connected devices. In another embodiment of the invention, the dual virtual space controller reroutes information from the virtual space to the master controller. Other functions of the master controller are:
<ul><li>to route information between a dual virtual space controller and its associated virtual space;</li><li>to allocate a specific dual virtual space controller to a specific third party;</li><li>to check the identity of a third party, and optionally validate de legitimacy of the request received from the third party;</li><li>to keep updated records of associations between at least the third party, associated dual virtual space controller and corresponding virtual space;<!-- EPO <DP n="11"> --></li><li>in some embodiments, to provide an indication of the identity of the user and/or the devices and/or the involved third parties to the user or the third parties.</li></ul></p><p id="p0045" num="0045">The master controller MC is installed in a trusted area of a device, as shown in <figref idrefs="f0002">Figure 2</figref>. The master controller MC can be downloaded either at the same time as the dual virtual space controller DVSC1 to DVSC4 application, or separately. There can be one master controller MC or multiple master controllers in one network of connected devices. Modules in the master controller MC include at least routing tables, and optionally others information such as security policies of secure elements, database of the existing virtual spaces, operation status of the connected devices in the network. The main function of the master controller MC is to provide the secure routing information to the third party, so that right virtual space can be reached by the third party. After the master controller MC allocates a dual virtual space controller to a third party, the third party can communicate directly with the virtual space under the control of the dual virtual space controller. In particular, the access to the virtual space is controlled by the enforcement of a security policy decided by the third party. The dual virtual space controller is then responsible for the monitoring of activities inside the virtual space and reporting those activities to the related secured operating system.</p><p id="p0046" num="0046"><figref idrefs="f0003">Figure 3</figref> shows exemplary illustration of the steps that may be executed by the master controller MC when an allocation request is received from a third party TP. In an embodiment, at step 401, a third party sends an allocation request to a user to allocate to it a virtual space in one of the devices in the user's network. This request is sent to a user's device which hosts the master controller. The request can specify constraints related to the device which will host the requested virtual space or constraints related to the virtual space to be allocated. For example, a constraint on device can consist of characteristics of the device: available size in memory, device capability such as a device with a screen, device type such as a TV, or mobile phone, or connected equipment, or laptop, or domestic device etc., description of the foreseen usage of the virtual space, device address, etc. For example, constraints on a virtual space can consist of the following characteristics: needed memory size for the virtual space, type of the device, address of the device in the network, usage profile, duration of the usage, etc. At step<!-- EPO <DP n="12"> --> 402, the master controller checks the authentication of the request, i.e. it authenticates the third party. For instance, the third party provides an identity proof by supplying a certificate. Optionally, the master controller validates the legitimacy of the request sent by the third party. For instance, the master controller checks if the authenticated third party is allowed to request a creation of a virtual space on a specific device, or a device of a specific type. It also analyses constraints provided in the request, if any. If a device address is specified, the master controller extracts the address of the target device from the request. If the request is not from an authorized third party or if the target device is not the authorized device for the requested third party, the request is rejected in step 409 and a rejection message could be sent back to the third party.</p><p id="p0047" num="0047">In an embodiment, the master controller can also challenge the identity of the third party. In this case, the master controller can check a database it owns in order to find if a trusted identity record associated to the third party is available.</p><p id="p0048" num="0048">After the master controller grants authorization of the third party allocation request, the master controller checks at step 403 a table it owns, called MC table. MC table memorizes associations between a third party, device information, a dual virtual space controller, a virtual space, and a security policy. Such an association is noted (TP &lt;&gt; device_info &lt;&gt; DVSC &lt;&gt; VS &lt;&gt; SecurityLevelPolicy). The master controller also determines whether any dual virtual space controller are available for allocation. If a dual virtual space controller is already available to be allocated to the third party, the master controller allocates the dual virtual space controller to the third party at step 404. In step 405, the master controller checks its MC table of dual virtual space controller records whether a virtual space is available and already associated to the dual virtual space controller. If a virtual space is available, it is allocated to the third party in step 406. Then the master controller updates its table in step 407. Finally, in step 408, the master controller informs the third party of success of a virtual space allocation and provides the third party with details to reach directly the allocated virtual space and dual virtual space controller.</p><p id="p0049" num="0049">The master controller allows also to keep information that a security policy is associated to a virtual space. This information is stored in the MC table in a "SecurityLevelPolicy" field. A default SecurityLevelPolicy can be set by the master<!-- EPO <DP n="13"> --> controller at the end of the virtual space allocation procedure. This SecurityLevelPolicy is translated into security rules and stored in the dual virtual space controller. During the allocated virtual space usage, the third party can modify the security level policy either by sending a request to the Master Controller which can relay the request to the corresponding dual virtual space controller or by updating the security rules in the corresponding dual virtual space controller provided that the master controller allows the third party to access directly the dual virtual space controller. In the latter case, the dual virtual space controller updates the master controller with the modified security level policy.</p><p id="p0050" num="0050">If no dual virtual space controller is available during step 403, in step 410 whether the master controller rejects the request and sends back a rejection message to the third party, or the master controller requests to an external Trusted Service Manager (not shown) to create a dual virtual space controller in a dedicated trusted area.</p><p id="p0051" num="0051">If no virtual space exists and is available for allocation during step 405, in step 411, whether the master controller rejects the request and sends back a rejection message to the third party, or the master controller requests the allocated dual virtual space controller to create a virtual space in a device taking into account all the constraints, if any provided in the initial request from the third party.</p><p id="p0052" num="0052">In one embodiment the master controller can be installed by default in the TEE component of a device in order to manage and securely route sensitive requests between installed secure elements or components in the device. For example, the master controller can manage the internal network comprising the TEE, an "USIM" (for "Universal Subscriber Identity Module") card and/or other devices, such as a microSD Card (for "micro Secure Digital Card").</p><p id="p0053" num="0053">The master controller can therefore allocate a virtual space to the third party and, through each respective dual virtual space controller, manage several virtual spaces allocated to many third parties. The table below is an example of a master controller relating to a situation of N virtualized zones enslaved to P external third parties.</p><p id="p0054" num="0054">N is the number of virtual spaces (for instance, seven) named VS1 to VS7, P is the number of third parties (for instance, five) named P1 to P5. In order to control N virtual spaces, N dual virtual space controllers (named DVSC1 to DVSC7) are required<!-- EPO <DP n="14"> --> because of the uniqueness of the association between a virtual space and a dual virtual space controller, each of which will be stored in a trusted location. Thus, one example of a master controller mapping table is:
<tables id="tabl0001" num="0001"><table frame="all"><tgroup cols="3"><colspec colnum="1" colname="col1" colwidth="21mm"/><colspec colnum="2" colname="col2" colwidth="29mm"/><colspec colnum="3" colname="col3" colwidth="32mm"/><thead><row><entry align="center" valign="top"><b>VS identity</b></entry><entry align="center" valign="top"><b>DVSC identifier</b></entry><entry align="center" valign="top"><b>Third Party owner</b></entry></row></thead><tbody><row><entry align="center">VS1</entry><entry align="center">DVSC3</entry><entry align="center">P1</entry></row><row><entry align="center">VS2</entry><entry align="center">DVSC2</entry><entry align="center">P1</entry></row><row><entry align="center">VS3</entry><entry align="center">DVSC7</entry><entry align="center">P3</entry></row><row><entry align="center">VS4</entry><entry align="center">DVSC5</entry><entry align="center">P3</entry></row><row><entry align="center">VS5</entry><entry align="center">DVSC1</entry><entry align="center">P2</entry></row><row><entry align="center">VS6</entry><entry align="center">DVSC4</entry><entry align="center">P4</entry></row><row><entry align="center">VS7</entry><entry align="center">DVSC6</entry><entry align="center">P1</entry></row></tbody></tgroup></table></tables></p><p id="p0055" num="0055">In the above example, seven virtual spaces are dispatched over four different third parties. The seven virtual spaces are controlled by seven dual virtual space controllers, which can operate from any number up to seven different trusted areas. An important feature of this above table is that every virtual space is controlled by a single associated dual virtual space controller. The third party P5 is not connected to any of the seven virtual spaces VS1 to VS7.</p><p id="p0056" num="0056"><figref idrefs="f0004">Figure 4</figref> shows a schematic illustration of how the master controller can use a USIM to provide the identity of a user to a third party. Identity information related to the owner of the device in which the third party is interested in getting a virtual space allocation can be stored in the master controller. The master controller knows that a specific USIM exists for this specific virtual space due to the content of its table MC Table which describes the device type of the device hosting the virtual space. In the same way, the master controller is able to provide information on the set of user's identities available for a third party. For instance, the master controller may know all the USIM information used in the user's network of devices of some family house: parents and children mobile phones. Again, the master controller is a trusted application that is stored in TEE, and only authorized entities can modify its identity details, such as network operator's identity.<!-- EPO <DP n="15"> --></p><p id="p0057" num="0057">In the process of <figref idrefs="f0004">Figure 4</figref>, a request is first sent from a third party wanting allocation of a virtual space in a user virtual network to the master controller of a user's device. Then, the master controller checks whether the third party is authorized by way of challenge authentication. Once authentication is completed, the master controller requests the identity of the user from the USIM. The USIM provides its identity record. It can also answer to an authentication challenge. Then, the master controller updates an internal record, if needed, and the identity proof of the user is provided to the third party. In one embodiment of the invention, the dual virtual space controller associated to each virtual space may control the legitimacy of those third party's request.</p><p id="p0058" num="0058"><figref idrefs="f0005">Figure 5</figref> shows the flow of information in some implementation based on the device Device 1, which is for instance a mobile phone, between normal OS and TEE for allocation of virtual space to third party. In step 1, via an application, the third party TP1 requests the creation of a virtual space prior to deliver the service. In step 2, the application uses the Rich Execution Environment API to communicate with the hypervisor and the creation request is sent to the hypervisor.</p><p id="p0059" num="0059">The hypervisor relays the creation request to the master controller MC which performs security controls, e.g, it authenticates the third party and requests authorization from the device owner, as shown in step 3. If authorization is granted, then the master controller MC allocates dual virtual space controller DVSC1 to third party TP1 and sends back an acknowledgement to the hypervisor as depicted in step 5. The dual virtual space controller DVSC1 then sends a request to the hypervisor to create the virtual space VS1 for the third party TP1. In step 6, upon successful creation of the virtual space VS1, the third party TP1 can access the allocated virtual space VS1 to deliver the service.</p><p id="p0060" num="0060">In some embodiment of the invention, the set of multiple dual virtual space controllers hosted in the network of user's devices could be implemented in such a way that a unique binary code of dual virtual space controller is implemented over a set of several dual virtual space controllers' data. In this scheme, every allocated or created virtual space is associated to a unique instance of a dual virtual space controller data over a common dual virtual space controller binary.</p><p id="p0061" num="0061">The proposed dual virtual space controller is an application that can be stored either in a secure element or in an isolated component of the trusted area of a device. The<!-- EPO <DP n="16"> --> major role of dual virtual space controller application is to provide security for in and out access control service to the allocated dedicated virtual space. A secondary role of the dual virtual space controller can be to request the creation or the erasing/destruction of a given virtual space, as well as control, administration and management of the dedicated virtual space.</p><p id="p0062" num="0062">The dual virtual space controller monitors and manages the activities taking place in the dedicated virtual space. Such activities are related to security, control of contents and resources by the virtual space. The dual virtual space controller can delete the virtual space at any time and create other virtual space in any other location.</p><p id="p0063" num="0063">The dual virtual space controller uses pre-defined methods to check the integrity of a virtual space. In one example, a third party requests the use of a virtual space in a user device consisting of a rich operating system and a hypervisor. The OS of the device which receives the request sends the request to the relevant hypervisor through the master controller if the virtual space is to be created in a remote device.</p><p id="p0064" num="0064">In one example, when an application or data in a dedicated virtual space seeks access to other memory locations outside the allocated space for the dedicated virtual space, the request must pass through the security policies controlled and defined by the dual virtual space controller inside the hypervisor. An example of such a scenario can be access to a website by the application inside the protected virtual space. In this case, the dual virtual space controller verifies the rights and security policy to determine if the application is allowed to access the website. This security policy is created at the time of the allocation of the virtual space to third party and this policy is stored securely in the dual virtual space controller, in trusted area. Any modification in the security policies are under control of the dual virtual space controller.</p><p id="p0065" num="0065">If a process in a slave virtual space needs to send a sensitive data flow, like transferring the rights of a video to a location outside the virtual space, the hypervisor forwards the request to the dual virtual space controller, where the authorization for the particular process is granted or denied. If granted, the dual virtual space controller informs the hypervisor about the authorization, and then the sensitive data flow can be sent outside the virtual space. In some embodiment, the control related to a specific file<!-- EPO <DP n="17"> --> can be done through cooperation between the hypervisor of the virtual space and the operating system installed and running in this virtual space.</p><p id="p0066" num="0066">The hypervisor makes sure the contents in the slave virtual space are only visible to authorized entities. In one example, a third party application can run in a dedicated virtual space under the control of the dual virtual space controller. If an application outside the protected virtual space, i.e. virtual space enslaved by dual virtual space controller, sends a request to gain access to the information inside the virtual space, the hypervisor traps the request, where the security policies are enforced by the controlling dual virtual space controller.</p><p id="p0067" num="0067">In an exemplary embodiment in accordance with the present invention, all the information, content and applications installed in a virtual space by a third party, under the control of dual virtual space controller associated, are stored encrypted in the memory of the equipment. The required content is decrypted on the fly based on need, either in full when the virtual space is mounted or initialized. This encryption can be realized under the direct control of the hypervisor or dual virtual space controller.</p></description><claims mxw-id="PCLM56976467" lang="EN" load-source="patent-office"><!-- EPO <DP n="18"> --><claim id="c-en-0001" num="0001"><claim-text>A method of securely allocating a virtual space to a third party in a memory of a device, the memory having both trusted and un-trusted areas, the method comprising the steps of:
<claim-text>receiving a request for a virtual space allocation from a third party;</claim-text>
<claim-text>authenticating the third party;</claim-text>
<claim-text>determining the existence of a unique virtual space controller for controlling access to a virtual space in an area of the memory, the unique virtual space controller being uniquely associated with the virtual space;</claim-text>
<claim-text>requesting the creation of a unique virtual space controller if one does not exist,</claim-text>
<claim-text>wherein the unique virtual space controller is located in a trusted area of memory and arranged to enforce a security policy for communication with the virtual space; and</claim-text>
<claim-text>providing the third party with the security policy for communication with the virtual space.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>A method according to claim 1, further comprising the step of:
<claim-text>if the request comprises a constraint on the virtual space, verifying whether the device satisfies the constraint.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>A method according to claim 2, wherein the constraint on the virtual space is one of needed memory size for the virtual space, the type of the device, the address of the device in the network, the usage profile, and the duration of the use.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>A method according to claim 1, further comprising the step of:
<claim-text>if the request comprises a constraint on the device, verifying whether the device satisfies the constraint.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>A method according to claim 4, wherein the constraint on the device is one of available size in memory, device capability, description of the foreseen usage of the virtual space, and device address.<!-- EPO <DP n="19"> --></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A method according to any of the previous claims, the method further comprising the step of:
<claim-text>verifying the legitimacy of the request sent by the third party.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>A method according to claim 6, wherein the step of verifying the legitimacy of the requests includes the step of verifying whether the third party is authorized to access a virtual space in a specific device.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A method according to any of the preceding claims, the method further comprising the steps of:
<claim-text>requesting, from the third party, an indication of the security policy to be enforced; and</claim-text>
<claim-text>receiving, from the third party, an indication of the security policy to be enforced.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>A method according to claim 8, wherein the step of requesting from the third party an indication of the security policy to be enforced, further includes requesting that the third party select a security policy from a number of predefined security policies.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A method according to any of the preceding claims, wherein the unique virtual space controller is located in the trusted area of a first device, and the virtual space is located in a second device, which second device is remote from the first device.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>A method according to any of the preceding claims, wherein the method further comprises the steps of:
<claim-text>informing the third party of the virtual space allocation; and</claim-text>
<claim-text>enabling the third party to communicate directly with the virtual space under the control of the unique virtual space controller.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>A method according to any of the preceding claims, wherein, upon receipt of the allocation request form the third party, the method further comprises the steps of:<!-- EPO <DP n="20"> -->
<claim-text>retrieving user identity from a universal subscriber identity module comprised in the device; and</claim-text>
<claim-text>memorizing the user identity as a trusted record.</claim-text></claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>A computer program product for a data-processing device, the computer program product comprising a set of instructions which, when loaded into the data-processing device, causes the device to perform the steps of the method as claimed in the claims 1 to 12.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A master controller for securely allocating a virtual space to a third party in a memory of a device, the memory having both trusted and un-trusted areas, the master controller comprising processing means arranged to:
<claim-text>receiving a request for a virtual space allocation from a third party;</claim-text>
<claim-text>authenticating the third party;</claim-text>
<claim-text>determining the existence of a unique virtual space controller for controlling access to a virtual space in an area of the memory, the unique virtual space controller being uniquely associated with the virtual space;</claim-text>
<claim-text>requesting the creation of a unique virtual space controller if one does not exist,</claim-text>
<claim-text>wherein the unique virtual space controller is located in a trusted area of memory and arranged to enforce a security policy for communication with the virtual space; and</claim-text>
<claim-text>providing the third party with the security policy for communication with the virtual space.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16667247" load-source="patent-office"><!-- EPO <DP n="21"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="178" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="22"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="199" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="23"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="165" he="217" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="24"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="25"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="165" he="165" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="157" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="158" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
