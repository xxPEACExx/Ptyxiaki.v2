<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680491-A1" country="EP" doc-number="2680491" kind="A1" date="20140101" family-id="47055766" file-reference-id="318319" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549197" ucid="EP-2680491-A1"><document-id><country>EP</country><doc-number>2680491</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13171632-A" is-representative="YES"><document-id mxw-id="PAPP154823120" load-source="docdb" format="epo"><country>EP</country><doc-number>13171632</doc-number><kind>A</kind><date>20130612</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP214458092" load-source="docdb" format="original"><country>EP</country><doc-number>13171632.6</doc-number><date>20130612</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140451578" ucid="CN-201210218484-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201210218484</doc-number><kind>A</kind><date>20120628</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988123193" load-source="docdb">H04L  29/06        20060101ALI20130722BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1988136422" load-source="docdb">H04L  12/24        20060101AFI20130722BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1900018482" load-source="docdb" scheme="CPC">H04L  61/2592      20130101 LI20160901BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1900018898" load-source="docdb" scheme="CPC">H04L  61/2582      20130101 LI20160901BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1900018960" load-source="docdb" scheme="CPC">H04L  61/2517      20130101 LI20160901BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1900023327" load-source="docdb" scheme="CPC">H04L  41/08        20130101 LI20160901BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1900023713" load-source="docdb" scheme="CPC">H04L  69/167       20130101 LI20160901BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991316898" load-source="docdb" scheme="CPC">H04L  65/1069      20130101 FI20131226BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180075" lang="DE" load-source="patent-office">Verfahren zum Aufbau eines Kanals zur Verwaltung eines IPv4 Terminals</invention-title><invention-title mxw-id="PT132180076" lang="EN" load-source="patent-office">Method for establishing channel for managing an IPv4 terminal</invention-title><invention-title mxw-id="PT132180077" lang="FR" load-source="patent-office">Procédé pour établir un canal pour la gestion d'un terminal IPv4</invention-title><citations><patent-citations><patcit mxw-id="PCIT242652059" load-source="docdb" ucid="EP-2458799-A1"><document-id format="epo"><country>EP</country><doc-number>2458799</doc-number><kind>A1</kind><date>20120530</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652057" load-source="docdb" ucid="US-20070067431-A1"><document-id format="epo"><country>US</country><doc-number>20070067431</doc-number><kind>A1</kind><date>20070322</date></document-id><sources><source name="SEA" category="Y" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652058" load-source="docdb" ucid="WO-2011046730-A1"><document-id format="epo"><country>WO</country><doc-number>2011046730</doc-number><kind>A1</kind><date>20110421</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>None</text><sources><source mxw-id="PNPL45130839" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>WING CISCO D: "Port Control Protocol (PCP); draft-ietf-pcp-base-00.txt", PORT CONTROL PROTOCOL (PCP); DRAFT-IETF-PCP-BASE-00.TXT, INTERNET ENGINEERING TASK FORCE, IETF; STANDARDWORKINGDRAFT, INTERNET SOCIETY (ISOC) 4, RUE DES FALAISES CH- 1205 GENEVA, SWITZERLAND, 3 December 2010 (2010-12-03), pages 1 - 36, XP015072828</text><sources><source mxw-id="PNPL63411859" load-source="docdb" name="SEA" category="Y"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918151771" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI DEVICE CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR918161478" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI DEVICE CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR918991799" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Device Co., Ltd.</last-name><iid>101160487</iid><address><street>Building B2 Huawei Industrial Base Bantian</street><city>Longgang District Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918156327" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HE ZHIQIN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918154152" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HE, ZHIQIN</last-name></addressbook></inventor><inventor mxw-id="PPAR918987031" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>HE, ZHIQIN</last-name><address><street>Huawei Administration Building, Bantian, Longgang District,</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918992723" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Goddar, Heinz J.</last-name><iid>100002032</iid><address><street>Boehmert &amp; Boehmert Pettenkoferstrasse 20-22</street><city>80336 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548837460" load-source="docdb">AL</country><country mxw-id="DS548848926" load-source="docdb">AT</country><country mxw-id="DS548848870" load-source="docdb">BE</country><country mxw-id="DS548854589" load-source="docdb">BG</country><country mxw-id="DS548801843" load-source="docdb">CH</country><country mxw-id="DS548848871" load-source="docdb">CY</country><country mxw-id="DS548848927" load-source="docdb">CZ</country><country mxw-id="DS548837462" load-source="docdb">DE</country><country mxw-id="DS548848872" load-source="docdb">DK</country><country mxw-id="DS548848873" load-source="docdb">EE</country><country mxw-id="DS548854662" load-source="docdb">ES</country><country mxw-id="DS548854590" load-source="docdb">FI</country><country mxw-id="DS548801844" load-source="docdb">FR</country><country mxw-id="DS548837463" load-source="docdb">GB</country><country mxw-id="DS548848874" load-source="docdb">GR</country><country mxw-id="DS548837464" load-source="docdb">HR</country><country mxw-id="DS548848928" load-source="docdb">HU</country><country mxw-id="DS548854663" load-source="docdb">IE</country><country mxw-id="DS548848875" load-source="docdb">IS</country><country mxw-id="DS548854591" load-source="docdb">IT</country><country mxw-id="DS548848876" load-source="docdb">LI</country><country mxw-id="DS548854592" load-source="docdb">LT</country><country mxw-id="DS548803279" load-source="docdb">LU</country><country mxw-id="DS548854593" load-source="docdb">LV</country><country mxw-id="DS548854594" load-source="docdb">MC</country><country mxw-id="DS548803280" load-source="docdb">MK</country><country mxw-id="DS548803281" load-source="docdb">MT</country><country mxw-id="DS548854664" load-source="docdb">NL</country><country mxw-id="DS548871948" load-source="docdb">NO</country><country mxw-id="DS548854665" load-source="docdb">PL</country><country mxw-id="DS548854595" load-source="docdb">PT</country><country mxw-id="DS548848929" load-source="docdb">RO</country><country mxw-id="DS548854596" load-source="docdb">RS</country><country mxw-id="DS548854666" load-source="docdb">SE</country><country mxw-id="DS548801845" load-source="docdb">SI</country><country mxw-id="DS548871949" load-source="docdb">SK</country><country mxw-id="DS548871950" load-source="docdb">SM</country><country mxw-id="DS548803286" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669867" lang="EN" load-source="patent-office"><p id="pa01" num="0001">The present invention discloses a method for establishing a channel for managing an IPv4 terminal and a network gateway, and pertains to the communications field, includes: receiving an identifier of a network port of an IPv4 terminal sent by a home gateway; and allocating a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device. With the present invention, an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal through a home gateway is received, and a listening port is opened for the IPv4 terminal according to the identifier of the network port and used for receiving a management message sent by a management device.
<img id="iaf01" file="imgaf001.tif" wi="137" he="76" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499240" lang="EN" source="EPO" load-source="docdb"><p>The present invention discloses a method for establishing a channel for managing an IPv4 terminal and a network gateway, and pertains to the communications field, includes: receiving an identifier of a network port of an IPv4 terminal sent by a home gateway; and allocating a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device. With the present invention, an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal through a home gateway is received, and a listening port is opened for the IPv4 terminal according to the identifier of the network port and used for receiving a management message sent by a management device.</p></abstract><description mxw-id="PDES63955297" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>FIELD OF THE INVENTION</b></heading><p id="p0001" num="0001">The present invention relates to the communications field, and in particular, to a method for establishing a channel for managing an IPv4 terminal and a network gateway.</p><heading id="h0002"><b>BACKGROUND OF THE INVENTION</b></heading><p id="p0002" num="0002">DS-lite, Double Stack-Lite, Dual Stack Lite, is a transition technology put forward to make an IPv4 terminal compatible in an IPv6 network in the process of transition of the current Internet Protocol from IPv4 to IPv6.</p><p id="p0003" num="0003"><figref idrefs="f0001">FIG. 1</figref> shows an interaction diagram of nodes in a network communication system in a DS-lite environment in the prior art. The network communication system includes the following nodes: an IPv4 terminal, a home gateway, a network gateway, and a STUN, Simple Traversal of UDP over NAT, simple traversal of UDP over NAT, server and a dual-stack management server in the extranet.</p><p id="p0004" num="0004">The communication in the DS-lite environment is mainly implemented through an IPv6 tunnel between the home gateway and the network gateway and the NAT, Network Address Translation, network address translation, technology deployed in the network gateway. The IPv4 terminal may communicate with the extranet through the IPv6 tunnel between the home gateway and the network gateway. When the IPv4 terminal is a device such as a camera or a set top box, the IPv4 terminal further needs to be remotely managed by the dual-stack management server in the extranet, and in this case, a channel between the IPv4 terminal and the dual-stack management server needs to be established for managing the IPv4 terminal. However, in the DS-lite environment, the NAT function is undertaken by the network gateway,<!-- EPO <DP n="2"> --> and the management information triggered by the dual-stack management server in the extranet cannot be directly sent to the IPv4 terminal. Therefore, a problem that must be solved in a DS-lite deployment process is how to establish a channel for managing the IPv4 terminal between the IPv4 terminal and the dual-stack management server.</p><p id="p0005" num="0005">In the prior art, the problem of establishing a channel for managing the IPv4 terminal between the IPv4 terminal and the dual-stack management server is solved mainly through the STUN protocol, Simple Traversal of UDP, User Datagram Protocol, User Datagram Protocol, over NAT, Network Address Translation, network address mapping. In brief, under the protocol, establishing, by the IPv4 terminal, communication with the dual-stack management server through the home gateway and the network gateway may include: firstly, sending, by the IPv4 terminal, a packet to the STUN server, opening a temporary listening port on the network gateway, and maintaining the temporary listening port by establishing communication with the STUN server constantly; secondly, sending, by the IPv4 terminal, a management accept notification to the dual-stack management server; and thirdly, receiving, by the IPv4 terminal through the temporary listening port, a management message sent by the dual-stack management server.</p><p id="p0006" num="0006">During the implementation of the present invention, it is found that the prior art has at least the following problems:</p><p id="p0007" num="0007">When the STUN protocol is used to solve the problem of establishing a channel for managing the IPv4 terminal between the IPv4 terminal and the dual-stack management server, a large number of STUN servers need to be deployed in the huge network. Therefore, too many hardware devices not only increase complexity and difficulty of the DS-lite deployment process, but also increase deployment and maintenance costs.</p><heading id="h0003"><b>SUMMARY OF THE INVENTION</b></heading><p id="p0008" num="0008">To simplify DS-lite deployment, reduce maintenance difficulty, and save deployment and maintenance costs, embodiments of the present invention provide a method for establishing a channel for managing an IPv4 terminal and a network gateway. The technical solutions are as follows:<!-- EPO <DP n="3"> --></p><p id="p0009" num="0009">In one aspect, a method for establishing a channel for managing an IPv4 terminal is provided, where the method includes:
<ul><li>receiving an identifier of a network port of an IPv4 terminal sent by a home gateway; and</li><li>allocating a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device.</li></ul></p><p id="p0010" num="0010">In another aspect, a method for verifying a channel for managing an IPv4 terminal is provided, where the method includes:
<ul><li>receiving a first mapping relationship that is sent by an IPv4 terminal through a channel established by a network gateway for managing the IPv4 terminal, where the first mapping relationship is a binding relationship between an identifier of the IPv4 terminal and an identifier that is received by the IPv4 terminal and sent from a home gateway;</li><li>obtaining a second mapping relationship sent by the home gateway, where the second mapping relationship is a binding relationship between an identifier, which is received by the home gateway and sent from the IPv4 terminal, and an identifier of the home gateway; and</li><li>when determining that the second mapping relationship is the same as the first mapping relationship, determining that the channel for managing the IPv4 terminal is established correctly.</li></ul></p><p id="p0011" num="0011">In still another aspect, a network gateway is provided, where the network gateway specifically includes:
<ul><li>a receiving unit, configured to receive an identifier of a network port of an IPv4 terminal sent by a home gateway; and</li><li>a port controlling unit, configured to allocate a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal received by the receiving unit, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device.</li></ul><!-- EPO <DP n="4"> --></p><p id="p0012" num="0012">In still another aspect, a management device is provided, where the management device includes:
<ul><li>a first receiving unit, configured to receive a first mapping relationship that is sent by an IPv4 terminal through a channel established by a network gateway for managing the IPv4 terminal, where the first mapping relationship is a binding relationship between an identifier of the IPv4 terminal and an identifier that is received by the IPv4 terminal and sent from a home gateway;</li><li>a second receiving unit, configured to receive a second mapping relationship sent by the home gateway, where the second mapping relationship is a binding relationship between an identifier, which is received by the home gateway and sent from the IPv4 terminal, and an identifier of the home gateway; and</li><li>a determining unit, configured to: when determining that the second mapping relationship is the same as the first mapping relationship, determine that the channel for managing the IPv4 terminal is established correctly.</li></ul></p><p id="p0013" num="0013">In still another aspect, a method for forwarding data of a channel for managing an IPv4 terminal is provided, where the method includes:
<ul><li>receiving an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal;</li><li>sending the received identifier of the network port of the IPv4 terminal to a network gateway; and</li><li>receiving a mapping relationship which is sent by the network gateway and between a listening port allocated to the IPv4 terminal based on the identifier of the network port of the IPv4 terminal and the network port of the IPv4 terminal, so that data between the network port and the listening port is forwarded according to the mapping relationship.</li></ul></p><p id="p0014" num="0014">In still another aspect, a home gateway is provided, where the home gateway includes:
<ul><li>a first receiving unit, configured to receive an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal;</li><li>a first sending unit, configured to send the identifier of the network port of the IPv4 terminal received by the first receiving unit to a network gateway; and<!-- EPO <DP n="5"> --></li><li>a second receiving unit, configured to receive a mapping relationship which is sent by the network gateway and between a listening port allocated to the IPv4 terminal based on the identifier of the network port of the IPv4 terminal and the network port of the IPv4 terminal, so that data between the network port and the listening port is forwarded according to the mapping relationship.</li></ul></p><p id="p0015" num="0015">With the technical solutions provided by the present invention, the network gateway receives an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal through the home gateway, and opens, for the IPv4 terminal according to the identifier of the network port, a listening port that may be long-time maintained, where the listening port is used for receiving a management message sent by the management device to the IPv4 terminal, so as to establish a channel for remotely managing the IPv4 terminal by the management device for the IPv4 terminal. This overcomes the problem in the prior art that a third-party device needs to assist in establishing a channel for remotely managing the IPv4 terminal by the management device for the IPv4 terminal and that maintenance duration is short. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance difficulty, and saving deployment and maintenance costs are achieved.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF THE DRAWINGS</b></heading><p id="p0016" num="0016">To describe the technical solutions in the embodiments of the present invention more clearly, the following briefly introduces the accompanying drawings needed for describing the embodiments. Apparently, the accompanying drawings in the following description show merely some embodiments of the present invention, and persons of ordinary skill in the art may still derive other drawings according to these accompanying drawings without creative efforts.
<ul><li><figref idrefs="f0001">FIG. 1</figref> is an interaction diagram of nodes in a network communication system according to the prior art;</li><li><figref idrefs="f0001">FIG. 2</figref> is a flowchart of a method for establishing a channel for managing an IPv4 terminal according to Embodiment 1 of the present invention;<!-- EPO <DP n="6"> --></li><li><figref idrefs="f0002">FIG. 3</figref> is a flowchart of a method for verifying a channel for managing an IPv4 terminal according to Embodiment 2 of the present invention;</li><li><figref idrefs="f0003">FIG. 4</figref> is a flowchart of a method for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 3 of the present invention;</li><li><figref idrefs="f0004">FIG. 5</figref> is a flowchart of a method for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 4 of the present invention;</li><li><figref idrefs="f0005">FIG. 6</figref> is a flowchart of a method for forwarding data of a channel for managing an IPv4 terminal according to Embodiment 5 of the present invention;</li><li><figref idrefs="f0005">FIG. 7</figref> is a schematic structural diagram of a network gateway according to Embodiment 6 of the present invention;</li><li><figref idrefs="f0006">FIG. 8</figref> is a schematic structural diagram of a home gateway according to Embodiment 7 of the present invention;</li><li><figref idrefs="f0006">FIG. 9</figref> is a schematic structural diagram of an IPv4 terminal according to Embodiment 8 of the present invention;</li><li><figref idrefs="f0007">FIG. 10</figref> is a schematic structural diagram of a management device according to Embodiment 9 of the present invention; and</li><li><figref idrefs="f0007">FIG. 11</figref> is a composition diagram of a system for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 10 of the present invention.</li></ul></p><heading id="h0005"><b>DETAILED DESCRIPTION OF THE EMBODIMENTS</b></heading><p id="p0017" num="0017">To make the objectives, technical solutions, and advantages of the present invention more comprehensible, the following further describes the embodiments of the present invention in detail with reference to the accompanying drawings.</p><heading id="h0006"><b>Embodiment 1</b></heading><p id="p0018" num="0018"><figref idrefs="f0001">FIG. 2</figref> shows a flowchart of a method for establishing a channel for managing an IPv4 terminal according to Embodiment 1 of the present invention. The method for establishing a channel for managing an IPv4 terminal may be used for establishing a channel for managing<!-- EPO <DP n="7"> --> an IPv4 terminal in a DS-lite network environment including an IPv4 terminal, a home gateway, a network gateway, and a management device, where the method may include:</p><p id="p0019" num="0019">Step 201: Receive an identifier of a network port of an IPv4 terminal sent by a home gateway.</p><p id="p0020" num="0020">Specifically, the network gateway receives a PCP request which is sent by the home gateway and carries the identifier of the network port of the IPv4 terminal.</p><p id="p0021" num="0021">The IPv4 terminal sends, to the home gateway, a DHCP, Dynamic Host Configuration Protocol, Dynamic Host Configuration Protocol, request carrying the identifier of the network port of the IPv4 terminal, and the home gateway sends a PCP, Port Control Protocol, Port Control Protocol, request to the network gateway according to the DHCP request, where the PCP request also carries the identifier of the network port of the IPv4 terminal.</p><p id="p0022" num="0022">Step 202: Allocate a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device.</p><p id="p0023" num="0023">The allocated listening port is used for listening in to the management message sent by the management device. In this embodiment, the listening port corresponds to the network port of the IPv4 terminal on a one-to-one basis.</p><p id="p0024" num="0024">Specifically, the network gateway allocates an unused port to the IPv4 terminal as a listening port of the IPv4 terminal, and establishes a mapping relationship between the listening port and the network port of the IPv4 terminal. After sending the established port mapping relationship to the home gateway, the network gateway may send, to the home gateway, the management message received by the listening port from the management device, such as a dual-stack management server, and the home gateway forwards the management message to the network port of the IPv4 terminal according to the port mapping relationship. The listening port allocated by the network gateway to the IPv4 terminal may be long-time maintained, and the time may be the current start and run duration of the IPv4 terminal.</p><p id="p0025" num="0025">To conclude, with the method for establishing a channel for managing an IPv4 terminal according to Embodiment 1, the network gateway receives an identifier of a network port of an IPv4 terminal sent through the home gateway, and opens, for the IPv4 terminal according<!-- EPO <DP n="8"> --> to the identifier of the network port, a listening port that may be long-time maintained, where the listening port is used for receiving a management message sent by the management device to the IPv4 terminal, so as to establish a channel for remotely managing the IPv4 terminal by the management device for the IPv4 terminal. This overcomes the problem in the prior art that a third-party device needs to assist in establishing a channel for remotely managing the IPv4 terminal by the management device for the IPv4 terminal and that maintenance duration is short. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance difficulty, and saving deployment and maintenance costs are achieved.</p><heading id="h0007"><b>Embodiment 2</b></heading><p id="p0026" num="0026"><figref idrefs="f0002">FIG. 3</figref> shows a flowchart of a method for verifying a channel for managing an IPv4 terminal according to Embodiment 2 of the present invention. The method for verifying a channel for managing an IPv4 terminal may be used for verifying whether a channel for managing an IPv4 terminal is established correctly in a DS-lite network environment including an IPv4 terminal, a home gateway, a network gateway, and a management device, where the method for verifying a channel for managing an IPv4 terminal may include:</p><p id="p0027" num="0027">Step 301: A management device receives a first mapping relationship that is sent by an IPv4 terminal through an established channel for managing the IPv4 terminal, where the first mapping relationship is a binding relationship between an identifier of the IPv4 terminal and an identifier that is received by the IPv4 terminal and sent from a home gateway.</p><p id="p0028" num="0028">The IPv4 terminal receives the identifier of the home gateway sent by the home gateway, and uses the binding relationship between the identifier of the home gateway and the identifier of the IPv4 terminal as a first mapping relationship. After the channel for managing the IPv4 terminal is established, the IPv4 terminal sends the first mapping relationship to the management device through the established channel for managing the IPv4 terminal.</p><p id="p0029" num="0029">It should be noted that, when sending a message to the management device, the IPv4 terminal only needs to learn information such as public IP address without establishing a channel for managing the IPv4 terminal, but a path for sending the message is consistent with the established channel for managing the IPv4 terminal.<!-- EPO <DP n="9"> --></p><p id="p0030" num="0030">Step 302: The management device obtains a second mapping relationship sent by the home gateway, where the second mapping relationship is a binding relationship between an identifier, which is received by the home gateway and sent from the IPv4 terminal, and an identifier of the home gateway.</p><p id="p0031" num="0031">The home gateway receives the identifier of the IPv4 terminal sent by the IPv4 terminal, and uses the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway as a second mapping relationship. After the channel for managing the IPv4 terminal is established, the home gateway sends the second mapping relationship to the management device.</p><p id="p0032" num="0032">Step 303: When determining that the second mapping relationship is the same as the first mapping relationship, determine that the channel for managing the IPv4 terminal is established correctly.</p><p id="p0033" num="0033">The management device compares the identifier of the IPv4 terminal and the identifier of the home gateway in the second mapping relationship with the identifier of the IPv4 terminal and the identifier of the home gateway in the first mapping relationship, respectively, and if the two mapping relationships are completely the same, the management device determines that the channel for managing the IPv4 terminal is established correctly.</p><p id="p0034" num="0034">To conclude, with the method for verifying a channel for managing an IPv4 terminal according to the second embodiment, the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway is obtained from the IPv4 terminal and the home gateway respectively, and the binding relationship between the home gateway and the IPv4 terminal is verified. Thereby, the objective of improving accuracy of managing the IPv4 terminal by the management device is achieved.</p><heading id="h0008"><b>Embodiment 3</b></heading><p id="p0035" num="0035">To specifically describe the methods provided by Embodiment 1 and Embodiment 2, <figref idrefs="f0003">FIG. 4</figref> shows a flowchart of a method for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 3 of the present invention. The method may be used for establishing and verifying a channel for managing an IPv4 terminal in a DS-lite network<!-- EPO <DP n="10"> --> environment including nodes such as an IPv4 terminal, a home gateway, a network gateway, and a management device, where the management device is a dual-stack management server. The method procedure may specifically include steps:</p><p id="p0036" num="0036">Step 401: A network gateway receives an identifier of a network port of an IPv4 terminal sent by a home gateway.</p><p id="p0037" num="0037">Specifically, the IPv4 terminal sends the identifier of the network port of the IPv4 terminal to the home gateway, and the home gateway sends the received identifier of the network port of the IPv4 terminal to the network gateway, where the identifier of the network port of the IPv4 terminal may be a port number of the network port.</p><p id="p0038" num="0038">Step 402: The network gateway allocates a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal, so as to establish a channel for managing the IPv4 terminal between the network port of the IPv4 terminal and the listening port.</p><p id="p0039" num="0039">After receiving the identifier of the network port of the IPv4 terminal, the network gateway allocates an unused port to the IPv4 terminal as the listening port of the IPv4 terminal, and establishes a mapping relationship between the listening port and the network port of the IPv4 terminal; specifically, the network gateway may establish a mapping relationship between the port number of the listening port and the port number of the network port of the IPv4 terminal.</p><p id="p0040" num="0040">Further, after establishing the mapping relationship between the listening port and the network port of the IPv4 terminal, the network gateway returns the mapping relationship between the listening port and the network port of the IPv4 terminal to the home gateway. At this time, according to the mapping relationship, the home gateway may forward, to the network port of the IPv4 terminal, a management message sent by a management device and received by the listening port, that is, the channel for managing the IPv4 terminal between the network port of the IPv4 terminal and the listening port is established.</p><p id="p0041" num="0041">Step 403: The management device receives a first mapping relationship that is sent by the IPv4 terminal through the established channel for managing the IPv4 terminal, where the first mapping relationship is a binding relationship between an identifier of the IPv4 terminal and an identifier which is received by the IPv4 terminal and sent from the home gateway.<!-- EPO <DP n="11"> --></p><p id="p0042" num="0042">Specifically, the IPv4 terminal may beforehand receive the identifier of the home gateway sent by the home gateway, and use the binding relationship between the identifier of the home gateway and the identifier of the IPv4 terminal as a first mapping relationship, where the identifier of the home gateway is a special identifier used for distinguishing the home gateway in the network, and may be the MAC address of the home gateway, and so on, and likewise, the identifier of the IPv4 terminal may also be the MAC address of the IPv4 terminal.</p><p id="p0043" num="0043">After the channel for managing the IPv4 terminal is established, the management device may receive the first mapping relationship actively sent by the IPv4 terminal; or may also send a request for obtaining the first mapping relationship to the IPv4 terminal, and receive the first mapping relationship that is returned by the IPv4 terminal according to the request.</p><p id="p0044" num="0044">Step 404: The management device obtains a second mapping relationship sent by the home gateway, where the second mapping relationship is a binding relationship between an identifier, which is received by the home gateway and sent from the IPv4 terminal, and an identifier of the home gateway.</p><p id="p0045" num="0045">Correspondingly, the home gateway may also beforehand receive the identifier of the IPv4 terminal sent by the IPv4 terminal, and use the binding relationship between the obtained identifier of the IPv4 terminal and the identifier of the home gateway as a second mapping relationship; the management device may receive the second mapping relationship actively sent by the home gateway; or may also send a request for obtaining the second mapping relationship to the home gateway, and receive the second mapping relationship that is returned by the home gateway according to the request.</p><p id="p0046" num="0046">It should be noted that the management device may obtain the first mapping relationship before or after obtaining the second mapping relationship, or obtain the two mapping relationships simultaneously.</p><p id="p0047" num="0047">Step 405: When determining that the second mapping relationship is the same as the first mapping relationship, the management device determines that the channel for managing the IPv4 terminal is established correctly.</p><p id="p0048" num="0048">The management device determines whether the second mapping relationship is the same as the first mapping relationship, and if they are the same, the channel for managing the<!-- EPO <DP n="12"> --> IPv4 terminal is established correctly. Specifically, the management device may compare the identifier of the IPv4 terminal and the identifier of the home gateway in the second mapping relationship with the identifier of the IPv4 terminal and the identifier of the home gateway in the first mapping relationship, respectively, and if the two mapping relationships are completely the same, it indicates that the channel for managing the IPv4 terminal is established correctly.</p><p id="p0049" num="0049">To conclude, with the method for establishing and verifying a channel for managing an IPv4 terminal according to the third embodiment, the network gateway receives an identifier of a network port of the IPv4 terminal sent through the home gateway, and opens a listening port for the IPv4 terminal according to the identifier of the network port, where the listening port is used for receiving a management message sent by the management device to the IPv4 terminal; a channel for managing the IPv4 terminal may be established without a third-party device. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance difficulty, and saving deployment and maintenance costs are achieved. In addition, with the method for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 3, the management device obtains the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway from the IPv4 terminal and the home gateway respectively to verify the binding relationship between the home gateway and the IPv4 terminal, thus achieving the objective of improving accuracy of managing the IPv4 terminal by the management device.</p><heading id="h0009"><b>Embodiment 4</b></heading><p id="p0050" num="0050"><figref idrefs="f0004">FIG. 5</figref> shows a flowchart of a method for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 4 of the present invention. The method for establishing and verifying a channel for managing an IPv4 terminal may be used in a DS-lite network environment including nodes such as an IPv4 terminal, a home gateway, a network gateway, and a management device to establish a channel for receiving a management message by the IPv4 terminal from the management device, where the management device is a dual-stack management server. For example, a channel for managing<!-- EPO <DP n="13"> --> an IPv4 terminal is established based on the PCP protocol, where the procedure for the method for establishing and verifying a channel for managing an IPv4 terminal may specifically include the following steps:</p><p id="p0051" num="0051">Step 501: The IPv4 terminal sends, to the home gateway, a dynamic host configuration request carrying the identifier of the network port of the IPv4 terminal.</p><p id="p0052" num="0052">Specifically, after being started, the IPv4 terminal automatically sends a DHCP Discover message for searching a local area network for a home gateway which can provide a dynamic host configuration service; after receiving the DHCP Discover sent by the IPv4 terminal, the home gateway returns, to the IPv4 terminal, a response, DHCP Offer, to the DHCP Discover; after receiving the DHCP Offer returned by the home gateway, the IPv4 terminal sends a dynamic host configuration request, DHCP Request, to the home gateway, where the dynamic host configuration request carries the identifier of the network port of the IPv4 terminal and the identifier of the IPv4 terminal, where the identifier of the IPv4 terminal is used for distinguishing the IPv4 terminal in the network and may be a MAC, Media Access Control, media access control, address of the IPv4 terminal and so on; in addition, all messages sent between the IPv4 terminal and the home gateway are messages in an IPv4 packet format.</p><p id="p0053" num="0053">Step 502: The home gateway receives the dynamic host configuration request sent by the IPv4 terminal, and adds the IPv4 terminal to a management device table.</p><p id="p0054" num="0054">The home gateway, HGW, Home Gateway, pre-creates a management device table. After receiving the dynamic host configuration request sent by the IPv4 terminal, the home gateway adds the identifier of the IPv4 terminal to the management device table; in addition, the management device table further includes the identifier of the home gateway, and a binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway is also established in the management device table. Correspondingly, the identifier of the home gateway may also be the MAC address of the home gateway.</p><p id="p0055" num="0055">Step 503: The home gateway sends, to the network gateway, a port control request carrying the network port of the IPv4 terminal.</p><p id="p0056" num="0056">After adding the identifier of the IPv4 terminal to the management device table, the home gateway sends a port control request, PCP Request, to the network gateway through an IPv6 tunnel between the home gateway and the network gateway, requesting the network<!-- EPO <DP n="14"> --> gateway to allocate a listening port to the IPv4 terminal, where the port control request carries the identifier of the network port of the IPv4 terminal.</p><p id="p0057" num="0057">Step 504: The network gateway allocates a listening port to the IPv4 terminal according to the port control request, and returns, to the home gateway, a port control acknowledgment response carrying the mapping relationship between the listening port and the network port of the IPv4 terminal.</p><p id="p0058" num="0058">Specifically, after receiving the port control request, the network gateway allocates an unused port to the IPv4 terminal as a listening port of the IPv4 terminal, and establishes a mapping relationship between the listening port and the network port of the IPv4 terminal carried in the port control request; in addition, the network gateway binds the listening port to the IPv6 tunnel correspondingly when the port control request is received, so that the message received by the listening port is sent to the home gateway through the IPv6 tunnel.</p><p id="p0059" num="0059">After establishing the mapping relationship between the listening port and the network port of the IPv4 terminal, the network gateway returns a port control acknowledgment response, PCP Ack, to the home gateway, where the port control acknowledgment response carries the mapping relationship between the listening port and the network port of the IPv4 terminal.</p><p id="p0060" num="0060">All messages sent between the home gateway and the network gateway are messages in an IPv6 packet format.</p><p id="p0061" num="0061">Step 505: The home gateway receives the port control acknowledgment response returned by the network gateway, and returns a dynamic host configuration acknowledgment response to the IPv4 terminal.</p><p id="p0062" num="0062">After receiving the port control acknowledgment response returned by the network gateway, the home gateway obtains and stores the mapping relationship between the listening port and the network port of the IPv4 terminal. In this case, the IPv4 terminal may be managed by the dual-stack management server through the listening port. Specifically, the network gateway sends the management message received by the listening port to the home gateway through an IPv6 tunnel bound with the listening port, and then the home gateway forwards the management message to the IPv4 terminal according to the mapping relationship<!-- EPO <DP n="15"> --> between the listening port and the network port of the IPv4 terminal. At this time, the channel for managing the IPv4 terminal is established.</p><p id="p0063" num="0063">In this case, the home gateway returns a dynamic host configuration acknowledgment response to the IPv4 terminal to notify the IPv4 terminal that dynamic host configuration is complete. The dynamic host configuration acknowledgment response includes information such as a private address allocated by the home gateway to the IPv4 terminal and the identifier of the home gateway.</p><p id="p0064" num="0064">Step 506: The IPv4 terminal sends a management accept notification to the dual-stack management server, where the notification carries a binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway.</p><p id="p0065" num="0065">To verify whether the channel established in the above step for managing the IPv4 terminal is correct, in this embodiment, the IPv4 terminal may send a management accept notification according to the public IP address of the dual-stack management server, where the notification carries a binding relationship between the identifier of the IPv4 terminal and the identifier which is received by the IPv4 terminal and sent from the home gateway. The binding relationship is the first mapping relationship in Embodiment 2 and Embodiment 3.</p><p id="p0066" num="0066">After receiving the dynamic host configuration acknowledgment response returned by the home gateway, the IPv4 terminal binds the identifier of the home gateway, which is included in the dynamic host configuration acknowledgment response, to the identifier of the IPv4 terminal, and sends a management accept notification to the dual-stack management server, where the management accept notification carries a binding relationship between the identifier of the IPv4 terminal and the identifier which is received by the IPv4 terminal and sent from the home gateway. It should be noted that the IPv4 terminal may also obtain the identifier of the home gateway by other means, for example, the home gateway may add the identifier of the home gateway to the DHCP Offer, namely, a response to the DHCP Discover, and in this case, the IPv4 terminal may obtain the identifier of the home gateway from the DHCP Offer.</p><p id="p0067" num="0067">In the DS-lite network environment, the message in the IPv4 packet format sent by the IPv4 terminal needs to be encapsulated into the IPv6 packet format on the home gateway, and is sent to the extranet through an IPv6 tunnel between the home gateway and the network<!-- EPO <DP n="16"> --> gateway. In actual applications, after the home gateway encapsulates, according to the encapsulation protocol defined by RFC 2473, IPv4-in-IPv6, the management accept notification sent by the IPv4 terminal, the home gateway sends the notification to the network gateway through the IPv6 tunnel between the home gateway and the network gateway; the network gateway forwards the notification to the dual-stack management server, and the dual-stack management server decapsulates the received message to obtain a management accept notification in the IPv4 format. Likewise, the message sent by the dual-stack management server to the IPv4 terminal through the listening port also needs to undergo the step of IPv4-IPv6 encapsulation and decapsulation.</p><p id="p0068" num="0068">It should be noted that the dual-stack management server is a management server with the IPv4 protocol added to the IPv6 protocol stack, that is, the dual-stack management server supports both the IPv6 protocol and the IPv4 protocol.</p><p id="p0069" num="0069">Step 507: The dual-stack management server binds the IPv4 terminal and the home gateway according to the received management accept notification, and returns, to the IPv4 terminal, a response to the management accept notification.</p><p id="p0070" num="0070">Specifically, after receiving the management accept notification sent by the IPv4 terminal, the dual-stack management server establishes a binding relationship between the IPv4 terminal and the home gateway according to the binding relationship which is carried in the management accept notification and between the identifier of the IPv4 terminal and the identifier which is received by the IPv4 terminal and sent from the home gateway.</p><p id="p0071" num="0071">Step 508: The dual-stack management server sends to the home gateway a request for obtaining a management device table carrying the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway.</p><p id="p0072" num="0072">To improve accuracy of sending a management message to the IPv4 terminal, the dual-stack management server needs to initiate a cross check through the IPv6 network to further acknowledge the binding relationship between the IPv4 terminal and the home gateway. Therefore, after establishing the binding relationship between the IPv4 terminal and the home gateway, the dual-stack management server may send, to the home gateway, a request for obtaining a management device table carrying the binding relationship between the identifier of the home gateway and the identifier which is received by the home gateway<!-- EPO <DP n="17"> --> and sent from the IPv4 terminal. The binding relationship that is carried in the management device table and between the identifier of the home gateway and the identifier which is received by the home gateway and sent from the IPv4 terminal is the second binding relationship in the second and third embodiments.</p><p id="p0073" num="0073">Step 509: The home gateway sends a management device table to the dual-stack management server.</p><p id="p0074" num="0074">The home gateway returns a management device table to the dual-stack management server after receiving the request for obtaining a management device table.</p><p id="p0075" num="0075">In addition, the messages sent between the dual-stack management server and the home gateway are all in the IPv6 packet format.</p><p id="p0076" num="0076">Step 510: The dual-stack management server checks the binding relationship between the IPv4 terminal and the home gateway according to the management device table.</p><p id="p0077" num="0077">Specifically, the dual-stack management server may compare the binding relationship, first mapping relationship, which is carried in the management accept notification sent by the IPv4 terminal and between the identifier of the IPv4 terminal and the identifier of the home gateway with the binding relationship, second mapping relationship, which is carried in the management device table sent by the home gateway and between the identifier of the IPv4 terminal and the identifier of the home gateway; if the identifier of the IPv4 terminal and the identifier of the home gateway in the first mapping relationship are completely the same as the identifier of the IPv4 terminal and the identifier of the home gateway in the second mapping relationship, it is finally acknowledged that the binding relationship between the IPv4 terminal and the home gateway is correct, that is, the channel for managing the IPv4 terminal is established correctly.</p><p id="p0078" num="0078">To conclude, with the method for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 4, the network gateway receives an identifier of a network port of the IPv4 terminal sent through the home gateway, and opens a listening port for the IPv4 terminal according to the identifier of the network port, where the listening port is used for receiving a management message sent by the management device to the IPv4 terminal; a channel for managing the IPv4 terminal may be established without a third-party device. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance<!-- EPO <DP n="18"> --> difficulty, and saving deployment and maintenance costs are achieved. In addition, with the method for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 4, the management device obtains the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway from the IPv4 terminal and the home gateway respectively to verify the binding relationship between the home gateway and the IPv4 terminal, thus achieving the objective of improving accuracy of managing the IPv4 terminal by the management device.</p><heading id="h0010"><b>Embodiment 5</b></heading><p id="p0079" num="0079"><figref idrefs="f0005">FIG. 6</figref> shows a flowchart of a method for forwarding data of a channel for managing an IPv4 terminal according to Embodiment 5 of the present invention. The method may be used for forwarding data of a channel for managing an IPv4 terminal in a DS-lite network environment including nodes such as an IPv4 terminal, a home gateway, a network gateway, and a management device. The method for forwarding data of a channel for managing an IPv4 terminal may include the following steps:</p><p id="p0080" num="0080">Step 601: Receive an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal.</p><p id="p0081" num="0081">Step 602: Send the received identifier of the network port of the IPv4 terminal to the network gateway.</p><p id="p0082" num="0082">Step 603: Receive a mapping relationship which is sent by the network gateway and between a listening port allocated to the IPv4 terminal based on the identifier of the network port of the IPv4 terminal and the network port of the IPv4 terminal, so that data between the network port and the listening port is forwarded according to the mapping relationship.</p><p id="p0083" num="0083">To conclude, with the method for forwarding data of a channel for managing an IPv4 terminal according to Embodiment 5, an identifier of a network port of an IPv4 terminal is forwarded to the network gateway, and the mapping relationship which is sent by the network gateway and between a listening port allocated to the IPv4 terminal based on the identifier of the network port of the IPv4 terminal and the network port of the IPv4 terminal is received.<!-- EPO <DP n="19"> --> Thereby, the objective of forwarding data of the channel for managing the IPv4 terminal is achieved.</p><heading id="h0011"><b>Embodiment 6</b></heading><p id="p0084" num="0084"><figref idrefs="f0005">FIG. 7</figref> shows a schematic structural diagram of a network gateway according to Embodiment 6 of the present invention, where the network gateway may be used in a DS-lite network environment. The network gateway may specifically include:
<ul><li>a receiving unit 701, configured to receive an identifier of a network port of an IPv4 terminal sent by a home gateway; and</li><li>a port controlling unit 702, configured to allocate a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal received by the receiving unit 701, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device.</li></ul></p><p id="p0085" num="0085">Specifically, the port controlling unit 702 includes:
<ul><li>a port allocating subunit 702a, configured to allocate a listening port to the IPv4 terminal; and</li><li>a mapping relationship establishing subunit 702b, configured to establish a mapping relationship between the listening port allocated by the port allocating subunit 702a and the network port of the IPv4 terminal.</li></ul></p><p id="p0086" num="0086">In addition, the network gateway further includes:
<ul><li>a sending unit 703, configured to send, to the home gateway, the mapping relationship established by the mapping relationship establishing subunit 702b, so that the home gateway forwards data between the network port and the listening port according to the mapping relationship.</li></ul></p><p id="p0087" num="0087">Specifically, after the home gateway receives the mapping relationship sent by the sending unit 703, the channel for managing the IPv4 terminal is established. When the listening port of the IPv4 terminal receives a management message sent by a dual-stack management server, the network gateway may send the management message to the home<!-- EPO <DP n="20"> --> gateway, and the home gateway forwards the management message to the IPv4 terminal according to the mapping relationship.</p><p id="p0088" num="0088">It should be noted that functional units of the network gateway provided by this embodiment may be mapped to different circuits, for example, a receiving circuit, a sending circuit, a port controlling circuit, and a mapping relationship establishing circuit; in addition, all functions of the network gateway provided by this embodiment may be completed by a same processor, for example, a same processor completes tasks such as sending, receiving, port control, and mapping relationship establishment.</p><p id="p0089" num="0089">The network gateway provided by Embodiment 6 opens a listening port of the IPv4 terminal according to the identifier of the network port of the IPv4 terminal sent by the home gateway, and a channel for managing the IPv4 terminal by the dual-stack management server for the IPv4 terminal is established without a third-party device. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance difficulty, and saving deployment and maintenance costs are achieved.</p><heading id="h0012"><b>Embodiment 7</b></heading><p id="p0090" num="0090"><figref idrefs="f0006">FIG. 8</figref> shows a schematic structural diagram of a home gateway according to Embodiment 7 of the present invention, where the home gateway may be used in a DS-lite network environment. The home gateway may specifically include:
<ul><li>a first receiving unit 801, configured to receive an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal; and</li><li>a first sending unit 802, configured to send the identifier of the network port of the IPv4 terminal received by the first receiving unit 801 to a network gateway.</li></ul></p><p id="p0091" num="0091">The network gateway allocates a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal sent by the first sending unit 802, establishes a mapping relationship between the network port of the IPv4 terminal and the listening port, and returns the established mapping relationship to the home gateway. Therefore, the home gateway further includes:<!-- EPO <DP n="21"> -->
<ul><li>a second receiving unit 803, configured to receive a mapping relationship which is sent by the network gateway and between a listening port allocated to the IPv4 terminal based on the identifier of the network port of the IPv4 terminal and the network port of the IPv4 terminal, so as to forward the data between the network port and the listening port according to the mapping relationship.</li></ul></p><p id="p0092" num="0092">After the home gateway receives the mapping relationship returned by the network gateway, the channel for managing the IPv4 terminal is established, that is, the home gateway may forward, according to the mapping relationship, the management message received by the listening port of the IPv4 terminal on the network gateway to the IPv4 terminal.</p><p id="p0093" num="0093">To acknowledge accuracy of establishment of the channel for managing the IPv4 terminal, the management device needs to obtain the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway from the IPv4 terminal and the home gateway respectively, and compare obtained binding relationships to acknowledge accuracy of establishment of the channel for managing the IPv4 terminal. Therefore,<br/>
the first receiving unit 801 is further configured to receive an identifier of the IPv4 terminal from the IPv4 terminal; and<br/>
the home gateway further includes:
<ul><li>a relationship mapping unit 805, configured to use the identifier of the IPv4 terminal received by the first receiving unit 801 and the identifier of the home gateway as a second mapping relationship; and</li><li>a second sending unit 804, configured to send the second mapping relationship to the management device after the second receiving unit 803 receives the mapping relationship which is sent by the network gateway and between the listening port and the network port of the IPv4 terminal.</li></ul></p><p id="p0094" num="0094">To conclude, the home gateway provided by Embodiment 7 forwards the identifier of the network port of the IPv4 terminal sent by the IPv4 terminal so that the network gateway opens the listening port of the IPv4 terminal, and a channel for managing the IPv4 terminal by the management device is established without a third-party device. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance difficulty, and saving deployment and<!-- EPO <DP n="22"> --> maintenance costs are achieved. In addition, the home gateway provided by Embodiment 7 sends the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway to the management device, so that the management device verifies the binding relationship between the home gateway and the IPv4 terminal, thus achieving the objective of acknowledging accuracy of establishment of the channel for managing the IPv4 terminal.</p><heading id="h0013"><b>Embodiment 8</b></heading><p id="p0095" num="0095"><figref idrefs="f0006">FIG. 9</figref> is a schematic structural diagram of an IPv4 terminal according to Embodiment 8 of the present invention. The IPv4 terminal may specifically include:
<ul><li>a first sending unit 901, configured to send an identifier of a network port of the IPv4 terminal to the home gateway.</li></ul></p><p id="p0096" num="0096">The home gateway forwards the identifier of the network port to the network gateway after receiving the identifier of the network port of the IPv4 terminal sent by the first sending unit 901, so that the network gateway allocates a listening port to the IPv4 terminal and establishes a mapping relationship between the network port of the IPv4 terminal and the listening port. After the home gateway receives the mapping relationship which is established by the network gateway and between the network port of the IPv4 terminal and the listening port, the channel for managing the IPv4 terminal is established.</p><p id="p0097" num="0097">To verify accuracy of the established channel for managing the IPv4 terminal, the IPv4 terminal further includes:
<ul><li>a receiving unit 902, configured to receive an identifier of the home gateway sent by the home gateway;</li><li>a relationship mapping unit 903, configured to use the identifier of the home gateway received by the receiving unit 902 and the identifier of the IPv4 terminal as a first mapping relationship; and</li><li>a second sending unit 904, configured to send the first mapping relationship to the management device.</li></ul><!-- EPO <DP n="23"> --></p><p id="p0098" num="0098">To conclude, the IPv4 terminal provided by Embodiment 8 sends the identifier of the network port of the IPv4 terminal to the network gateway through the home gateway; the network gateway opens, in the extranet, the listening port of the IPv4 terminal; and a channel for managing the IPv4 terminal by the management device is established without a third-party device. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance difficulty, and saving deployment and maintenance costs are achieved. In addition, the IPv4 terminal provided by Embodiment 8 sends the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway to the management device, so that the management device verifies the binding relationship between the home gateway and the IPv4 terminal, thus achieving the objective of acknowledging accuracy of establishment of the channel for managing the IPv4 terminal.</p><heading id="h0014"><b>Embodiment 9</b></heading><p id="p0099" num="0099"><figref idrefs="f0007">FIG. 10</figref> is a schematic structural diagram of a management device according to Embodiment 9 of the present invention, where the management device may be a dual-stack management server used in a DS-lite network environment. The management device may specifically include:
<ul><li>a first receiving unit 1001, configured to receive a first mapping relationship sent by an IPv4 terminal through a channel established by a network gateway for managing the IPv4 terminal, where the first mapping relationship is a binding relationship between an identifier of the IPv4 terminal and an identifier that is received by the IPv4 terminal and sent from a home gateway;</li><li>a second receiving unit 1002, configured to receive a second mapping relationship sent by the home gateway, where the second mapping relationship is a binding relationship between an identifier, which is received by the home gateway and sent from the IPv4 terminal, and an identifier of the home gateway; and</li><li>a determining unit 1003, configured to: when determining that the second mapping relationship is the same as the first mapping relationship, determine that the channel for managing the IPv4 terminal is established correctly.</li></ul><!-- EPO <DP n="24"> --></p><p id="p0100" num="0100">To conclude, the management device provided by Embodiment 9 obtains the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway from the IPv4 terminal and the home gateway respectively, and compares obtained binding relationships to verify the binding relationship between the home gateway and the IPv4 terminal, thus achieving the objective of acknowledging accuracy of establishment of the channel for managing the IPv4 terminal.</p><heading id="h0015"><b>Embodiment 10</b></heading><p id="p0101" num="0101"><figref idrefs="f0007">FIG. 11</figref> is a composition diagram of a system for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 10 of the present invention. The system for establishing and verifying a channel for managing an IPv4 terminal may be used in a DS-lite network environment. The system for establishing and verifying a channel for managing an IPv4 terminal may include: the network gateway 70 in Embodiment 6, the home gateway 80 in Embodiment 7, the IPv4 terminal 90 in Embodiment 8, and the management device 100 in Embodiment 9.</p><p id="p0102" num="0102">To conclude, with the system for establishing and verifying a channel for managing an IPv4 terminal according to Embodiment 10, the network gateway receives an identifier of a network port of the IPv4 terminal sent by the IPv4 terminal through the home gateway, and opens, according to the identifier of the network port, a listening port that may be long-time maintained for the IPv4 terminal, where the listening port is used for receiving a management message sent by the management device to the IPv4 terminal; and a channel for managing the IPv4 terminal may be established without a third-party device. Thereby, the objectives of simplifying DS-lite deployment, reducing maintenance difficulty, and saving deployment and maintenance costs are achieved. In addition, with the system for establishing a channel for managing an IPv4 terminal according to Embodiment 10, the management device obtains the binding relationship between the identifier of the IPv4 terminal and the identifier of the home gateway from the IPv4 terminal and the home gateway respectively to verify the binding relationship between the home gateway and the IPv4 terminal, thus achieving the objective of improving accuracy of managing the IPv4 terminal by the management device.<!-- EPO <DP n="25"> --></p><p id="p0103" num="0103">It should be noted that when the network gateway, home gateway, IPv4 terminal, and management device according to the above embodiment establish a channel for managing the IPv4 terminal, only division of the above functional modules is illustrated. In actual applications, the above functions may be allocated, according to requirements, to different functional modules for completion, that is, the internal structure of the apparatus is divided into different functional modules for completing all or part of the functions described above. In addition, the system for establishing and verifying a channel for managing an IPv4 terminal according to the above embodiment and the embodiment of the method for establishing and verifying a channel for managing an IPv4 terminal belong to the same concept, and the specific implementation process of the system is described in the method embodiment, and is not further described here.</p><p id="p0104" num="0104">Persons of ordinary skill in the art should understand that all or part of the steps of the foregoing embodiments may be implemented through hardware, and may also be implemented by a program instructing relevant hardware. The program may be stored in a computer readable storage medium. The storage medium may be a read-only memory, a magnetic disk, or an optical disk.</p><p id="p0105" num="0105">The foregoing descriptions are merely exemplary embodiments, but are not intended to limit the present invention. Any modification, equivalent replacement, or improvement made within the principle of the present invention shall all fall within the protection scope of the present invention.</p></description><claims mxw-id="PCLM56976213" lang="EN" load-source="patent-office"><!-- EPO <DP n="26"> --><claim id="c-en-0001" num="0001"><claim-text>A method for establishing a channel for managing an IPv4 terminal, wherein the method comprises:
<claim-text>receiving an identifier of a network port of an IPv4 terminal sent by a home gateway; and</claim-text>
<claim-text>allocating a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method for establishing a channel for managing an IPv4 terminal according to claim 1, wherein the allocating a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, specifically comprises:
<claim-text>allocating a listening port to the IPv4 terminal, and establishing a mapping relationship between the listening port and the network port of the IPv4 terminal; and</claim-text>
<claim-text>sending the mapping relationship to the home gateway so that the home gateway forwards data between the network port and the listening port according to the mapping relationship.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>A method for verifying a channel for managing an IPv4 terminal, wherein the method comprises:
<claim-text>receiving a first mapping relationship that is sent by an IPv4 terminal through a channel established by a network gateway for managing the IPv4 terminal, wherein the first mapping relationship is a binding relationship between an identifier of the IPv4 terminal and an identifier that is received by the IPv4 terminal and sent from a home gateway;<!-- EPO <DP n="27"> --></claim-text>
<claim-text>obtaining a second mapping relationship sent by the home gateway, wherein the second mapping relationship is a binding relationship between an identifier, which is received by the home gateway and sent from the IPv4 terminal, and an identifier of the home gateway; and</claim-text>
<claim-text>when determining that the second mapping relationship is the same as the first mapping relationship, determining that the channel for managing the IPv4 terminal is established correctly.</claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>A network gateway, comprising:
<claim-text>a receiving unit, configured to receive an identifier of a network port of an IPv4 terminal sent by a home gateway; and</claim-text>
<claim-text>a port controlling unit, configured to allocate a listening port to the IPv4 terminal according to the identifier of the network port of the IPv4 terminal received by the receiving unit, so as to establish a channel for managing the IPv4 terminal between the network port and the listening port, so that the IPv4 terminal is remotely managed by a management device.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The network gateway according to claim 4, wherein the port controlling unit comprises:
<claim-text>a port allocating subunit, configured to allocate a listening port to the IPv4 terminal; and</claim-text>
<claim-text>a mapping relationship establishing subunit, configured to establish a mapping relationship between the listening port allocated by the port allocating subunit and the network port of the IPv4 terminal; and</claim-text>
<claim-text>the network gateway further comprises:
<claim-text>a sending unit, configured to send the mapping relationship established by the mapping relationship establishing subunit to the home gateway, so that the home gateway forwards data between the network port and the listening port according to the mapping relationship.</claim-text></claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A management device, comprising:
<claim-text>a first receiving unit, configured to receive a first mapping relationship that is sent by an IPv4 terminal through a channel established by a network gateway for managing the IPv4 terminal, wherein the first mapping relationship is a binding relationship between an identifier of the IPv4 terminal and an identifier that is received by the IPv4 terminal and sent from a home gateway;<!-- EPO <DP n="28"> --></claim-text>
<claim-text>a second receiving unit, configured to receive a second mapping relationship sent by the home gateway, wherein the second mapping relationship is a binding relationship between an identifier, which is received by the home gateway and sent from the IPv4 terminal, and an identifier of the home gateway; and</claim-text>
<claim-text>a determining unit, configured to: when determining that the second mapping relationship is the same as the first mapping relationship, determine that the channel for managing the IPv4 terminal is established correctly.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>A method for forwarding data of a channel for managing an IPv4 terminal, wherein the method comprises:
<claim-text>receiving an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal;</claim-text>
<claim-text>sending the received identifier of the network port of the IPv4 terminal to a network gateway; and</claim-text>
<claim-text>receiving a mapping relationship which is sent by the network gateway and between a listening port allocated to the IPv4 terminal based on the identifier of the network port of the IPv4 terminal and the network port of the IPv4 terminal, so that data between the network port and the listening port is forwarded according to the mapping relationship.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A home gateway, comprising:
<claim-text>a first receiving unit, configured to receive an identifier of a network port of an IPv4 terminal sent by the IPv4 terminal;</claim-text>
<claim-text>a first sending unit, configured to send the identifier of the network port of the IPv4 terminal received by the first receiving unit to a network gateway; and</claim-text>
<claim-text>a second receiving unit, configured to receive a mapping relationship which is sent by the network gateway and between a listening port allocated to the IPv4 terminal based on the identifier of the network port of the IPv4 terminal and the network port of the IPv4 terminal, so that data between the network port and the listening port is forwarded according to the mapping relationship.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The home gateway according to claim 8, wherein the first receiving unit is further configured to receive an identifier of the IPv4 terminal sent by the IPv4 terminal; and<br/>
the home gateway further comprises:<!-- EPO <DP n="29"> -->
<claim-text>a relationship mapping unit, configured to use the identifier of the IPv4 terminal received by the first receiving unit and an identifier of the home gateway as a second mapping relationship; and</claim-text>
<claim-text>a second sending unit, configured to send the second mapping relationship to a management device after the second receiving unit receives the mapping relationship which is sent by the network gateway and between the listening port and the network port of the IPv4 terminal.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16666995" load-source="patent-office"><!-- EPO <DP n="30"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="191" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0002" num="3"><img id="if0002" file="imgf0002.tif" wi="165" he="109" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0003" num="4"><img id="if0003" file="imgf0003.tif" wi="164" he="150" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0004" num="5"><img id="if0004" file="imgf0004.tif" wi="165" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0005" num="6,7"><img id="if0005" file="imgf0005.tif" wi="165" he="207" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0006" num="8,9"><img id="if0006" file="imgf0006.tif" wi="165" he="191" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0007" num="10,11"><img id="if0007" file="imgf0007.tif" wi="165" he="183" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="162" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="158" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
