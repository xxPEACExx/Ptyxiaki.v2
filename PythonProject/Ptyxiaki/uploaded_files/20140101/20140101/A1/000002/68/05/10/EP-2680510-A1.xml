<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680510-A1" country="EP" doc-number="2680510" kind="A1" date="20140101" family-id="47602969" file-reference-id="315096" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549178" ucid="EP-2680510-A1"><document-id><country>EP</country><doc-number>2680510</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12197648-A" is-representative="YES"><document-id mxw-id="PAPP154823101" load-source="docdb" format="epo"><country>EP</country><doc-number>12197648</doc-number><kind>A</kind><date>20121218</date><lang>EN</lang></document-id><document-id mxw-id="PAPP168045529" load-source="docdb" format="original"><country>EP</country><doc-number>12197648.4</doc-number><date>20121218</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140448122" ucid="US-201213533961-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201213533961</doc-number><kind>A</kind><date>20120626</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2140413764" load-source="docdb">H04L  12/707       20130101AFI20141028BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL2093535974" load-source="docdb" scheme="CPC">H04L  41/5025      20130101 LI20140704BHEP        </classification-cpc><classification-cpc mxw-id="PCL2093538139" load-source="docdb" scheme="CPC">H04L  45/28        20130101 FI20140630BHEP        </classification-cpc><classification-cpc mxw-id="PCL2093540496" load-source="docdb" scheme="CPC">H04L  45/22        20130101 LI20140630BHEP        </classification-cpc><classification-cpc mxw-id="PCL2093544137" load-source="docdb" scheme="CPC">H04L  41/0659      20130101 LI20140704BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180018" lang="DE" load-source="patent-office">Auf Serviceebene ausgelöster Schnellumleitungsschutz</invention-title><invention-title mxw-id="PT132180019" lang="EN" load-source="patent-office">Service plane triggered fast reroute protection</invention-title><invention-title mxw-id="PT132180020" lang="FR" load-source="patent-office">Protection de réacheminement rapide déclenchée par un plan de service</invention-title><citations><patent-citations><patcit mxw-id="PCIT242652016" load-source="docdb" ucid="US-20080175172-A1"><document-id format="epo"><country>US</country><doc-number>20080175172</doc-number><kind>A1</kind><date>20080724</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652017" load-source="docdb" ucid="US-20090028056-A1"><document-id format="epo"><country>US</country><doc-number>20090028056</doc-number><kind>A1</kind><date>20090129</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652018" load-source="docdb" ucid="US-20090141621-A1"><document-id format="epo"><country>US</country><doc-number>20090141621</doc-number><kind>A1</kind><date>20090604</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242652019" load-source="docdb" ucid="US-8077726-B1"><document-id format="epo"><country>US</country><doc-number>8077726</doc-number><kind>B1</kind><date>20111213</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit></patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR918133204" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>JUNIPER NETWORKS INC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR918148127" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>JUNIPER NETWORKS, INC.</last-name></addressbook></applicant><applicant mxw-id="PPAR918992181" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Juniper Networks, Inc.</last-name><iid>100153534</iid><address><street>1194 North Mathilda Avenue</street><city>Sunnyvale, CA 94089-1206</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918143324" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>GUICHARD JAMES</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918162438" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>GUICHARD, JAMES</last-name></addressbook></inventor><inventor mxw-id="PPAR918987030" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>GUICHARD, JAMES</last-name><address><street>449 Joe English Road</street><city>New Boston, NH New Hampshire 03070</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918146151" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>WARD DAVID</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR918157864" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>WARD, DAVID</last-name></addressbook></inventor><inventor mxw-id="PPAR918985438" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>WARD, DAVID</last-name><address><street>32460 Loma Chiquita Road</street><city>95033, CA California Los Gatos</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918980552" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Moulin, Bénédicte</last-name><iid>101353598</iid><address><street>D Young &amp; Co LLP 120 Holborn</street><city>London EC1N 2DY</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS548853928" load-source="docdb">AL</country><country mxw-id="DS548802954" load-source="docdb">AT</country><country mxw-id="DS548854246" load-source="docdb">BE</country><country mxw-id="DS548853840" load-source="docdb">BG</country><country mxw-id="DS548837233" load-source="docdb">CH</country><country mxw-id="DS548867841" load-source="docdb">CY</country><country mxw-id="DS548802955" load-source="docdb">CZ</country><country mxw-id="DS548854247" load-source="docdb">DE</country><country mxw-id="DS548867842" load-source="docdb">DK</country><country mxw-id="DS548867843" load-source="docdb">EE</country><country mxw-id="DS548848199" load-source="docdb">ES</country><country mxw-id="DS548853841" load-source="docdb">FI</country><country mxw-id="DS548853846" load-source="docdb">FR</country><country mxw-id="DS548854248" load-source="docdb">GB</country><country mxw-id="DS548867844" load-source="docdb">GR</country><country mxw-id="DS548854249" load-source="docdb">HR</country><country mxw-id="DS548802956" load-source="docdb">HU</country><country mxw-id="DS548837234" load-source="docdb">IE</country><country mxw-id="DS548854250" load-source="docdb">IS</country><country mxw-id="DS548853847" load-source="docdb">IT</country><country mxw-id="DS548867845" load-source="docdb">LI</country><country mxw-id="DS548801722" load-source="docdb">LT</country><country mxw-id="DS548802957" load-source="docdb">LU</country><country mxw-id="DS548801723" load-source="docdb">LV</country><country mxw-id="DS548801724" load-source="docdb">MC</country><country mxw-id="DS548847900" load-source="docdb">MK</country><country mxw-id="DS548847901" load-source="docdb">MT</country><country mxw-id="DS548854251" load-source="docdb">NL</country><country mxw-id="DS548853848" load-source="docdb">NO</country><country mxw-id="DS548801726" load-source="docdb">PL</country><country mxw-id="DS548837235" load-source="docdb">PT</country><country mxw-id="DS548854252" load-source="docdb">RO</country><country mxw-id="DS548837236" load-source="docdb">RS</country><country mxw-id="DS548854253" load-source="docdb">SE</country><country mxw-id="DS548837237" load-source="docdb">SI</country><country mxw-id="DS548853849" load-source="docdb">SK</country><country mxw-id="DS548801727" load-source="docdb">SM</country><country mxw-id="DS548867846" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669848" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Techniques are described for detecting failure or degradation of a service enabling technology function independent from an operational state of a service node hosting the service enabling technology function. For example, a service node may provide one or more service enabling technology functions, and service engineered paths may be traffic-engineered through a network to service node network devices that host a service enabling technology function. A monitor component at the service layer of the service node can detect failure or degradation of one or more service enabling technology functions provided by the service node. The monitor component reports detection of failure or degradation to a fault detection network protocol in a forwarding plane of the service node. The fault detection network protocol communicates with an ingress router of a service engineered path to trigger fast reroute by the ingress of traffic flows to bypass the affected service enabling technology function.
<img id="iaf01" file="imgaf001.tif" wi="137" he="95" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499221" lang="EN" source="EPO" load-source="docdb"><p>Techniques are described for detecting failure or degradation of a service enabling technology function independent from an operational state of a service node hosting the service enabling technology function. For example, a service node may provide one or more service enabling technology functions, and service engineered paths may be traffic-engineered through a network to service node network devices that host a service enabling technology function. A monitor component at the service layer of the service node can detect failure or degradation of one or more service enabling technology functions provided by the service node. The monitor component reports detection of failure or degradation to a fault detection network protocol in a forwarding plane of the service node. The fault detection network protocol communicates with an ingress router of a service engineered path to trigger fast reroute by the ingress of traffic flows to bypass the affected service enabling technology function.</p></abstract><description mxw-id="PDES63955278" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>PRIORITY CLAIM</b></heading><p id="p0001" num="0001">This application claims the benefit of <patcit id="pcit0001" dnum="US53396112A"><text>U.S. Patent Application No. 13/533,961, filed June 26, 2012</text></patcit>, the entire content of which is incorporated herein by reference.</p><heading id="h0002"><b>TECHNICAL FIELD</b></heading><p id="p0002" num="0002">The disclosure relates to packet-based computer networks and, more particularly, to forwarding packets within computer networks.</p><heading id="h0003"><b>BACKGROUND</b></heading><p id="p0003" num="0003">A computer network is a collection of interconnected computing devices that exchange data and share resources. In a packet-based network, such as the Internet, the computing devices communicate data by dividing the data into small blocks called packets. The packets are individually routed across the network from a source device to a destination device. The destination device extracts the data from the packets and assembles the data into its original form. Dividing the data into packets enables the source device to resend only those individual packets that may be lost during transmission.</p><p id="p0004" num="0004">Multi-protocol Label Switching (MPLS) is a mechanism used to engineer traffic patterns within Internet Protocol (IP) networks. By using MPLS, a source device can request a path through a network, i.e., a Label Switched Path (LSP). An LSP defines a distinct path through the network to carry MPLS packets from the source device to a destination device. A short label associated with a particular LSP is affixed to packets that travel through the network via the LSP. Routers along the path cooperatively perform MPLS operations to forward the MPLS packets along the established path. LSPs may be used for a variety of traffic engineering purposes including bandwidth management and quality of service (QoS).</p><p id="p0005" num="0005">A variety of protocols exist for establishing LSPs. For example, one such protocol is the label distribution protocol (LDP). Another type of protocol is a resource reservation protocol, such as the Resource Reservation Protocol with Traffic Engineering extensions (RSVP-TE). RSVP-TE uses constraint information, such as bandwidth availability, to compute paths and establish LSPs along the paths within a network. RSVP-TE may use bandwidth availability information accumulated by a link-state interior routing protocol, such as the Intermediate System - Intermediate System (ISIS) protocol or the Open Shortest Path First (OSPF) protocol.</p><p id="p0006" num="0006">In some instances, a node or link along an LSP may no longer be available. For example, a link along the LSP, or a node may experience a failure event, such as when one or more components of a router fail or the router is brought down by a user, such as a network operator. When a link or router in the network fails, routers using traditional link state protocols, such as OSPF and/or IS-IS, may take a long time to adapt their forwarding tables in response to<!-- EPO <DP n="2"> --> the topological change resulting from node and/or link failures in the network. The process of adapting the forwarding tables is known as convergence. This time delay occurs because each node must update its representation of the network topology and execute the shortest path algorithm to calculate the next-hop for each destination within the updated network topology. Until the next-hops are re-computed, traffic being sent toward the failed links may be dropped. Some deployments take as much as 500 milliseconds to several seconds for detection and recovery from failures in the network. These large convergence times may adversely affect the performance of applications such as Voice over Internet Protocol (VoIP) and multimedia applications, which often rely on RSVP-TE, and are extremely sensitive to traffic loss.</p><heading id="h0004"><b>SUMMARY</b></heading><p id="p0007" num="0007">In general, techniques are described detecting failure or degradation of a service enabling technology function independent from an operational state of a service node hosting the service enabling technology function. For example, a service node may provide one or more service enabling technology functions, such as applications, virtual appliance, virtual cache, firewall, security, and others. Service engineered paths may be traffic-engineered through a network to one or more service node network devices that host service enabling technology function.</p><p id="p0008" num="0008">A monitor component at the service layer of the service node can detect failure or degradation of one or more service enabling technology functions provided by the service node. The monitor component can report its detection of such a failure or degradation to a fault detection network protocol in a forwarding plane of the service node. The fault detection network protocol communicates with an router of a service engineered path to trigger Fast Reroute (FRR) of traffic flows to bypass the service node and thus the affected service enabling technology function.</p><p id="p0009" num="0009">A fault detection network protocol, such as Bidirectional Forwarding Detection (BFD), can be extended as described herein to receive, from the service layer monitor component, a notification of a change in a performance status of a service enabling technology function. The fault detection network protocol can in turn output a notification over a BFD session to the ingress router to inform the ingress router of the failure or degradation of the service function. For example, the fault detection network protocol can send a control message to the ingress router to notify the ingress router to reroute network traffic requiring the service enabling technology function to a second instance of the service enabling technology function provided at a second service node reachable by a backup service engineered path.</p><p id="p0010" num="0010">In response to the edge router learning of the change in status of the service enabling technology function, the edge router can trigger fast reroute of network traffic onto a backup service engineered path that bypasses the first service node and directs traffic to a different<!-- EPO <DP n="3"> --> instance of the service enabling technology function that is hosted at a second service node. In this manner, when an instance of a service enabling technology function fails, even though the first service node may remain operable, fast reroute may be triggered to reroute traffic to a different instance of the service enabling technology function.</p><p id="p0011" num="0011">The techniques of this disclosure may provide one or more advantages. For example, the techniques may allow an operator to maintain service integrity and any associated service-level agreement (SLA) requirements for the service in the event of failures not detectable using other link or node protection functions. The techniques provide automatic fast reroute of traffic when a performance degradation of a service is detected, and, beyond initial configuration of thresholds on the service node, do not require any action from the operator to effect fast reroute of traffic by a router to a different service node when a failure or degradation of a service occurs on the service node. This service-based fast reroute capability can be provided in addition to, and may be used in conjunction with, other link, interface, and node fast reroute protection capabilities of the service node and ingress router.</p><p id="p0012" num="0012">In one aspect, a method includes by a service node, applying a service to network traffic received at a service plane of the service node via a primary service engineered path, wherein the service node operates as an egress device of the primary service engineered path, and detecting, at the service plane of the service node, that a performance level of the service differs from an expected performance level of the service by at least a threshold amount, wherein the performance level of the service is independent of an overall operational state of the service node. The method also includes outputting a notification to a fault detection network protocol in a forwarding plane of the service node when the detected difference in the performance level of the service differs from the expected performance level by at least the threshold amount, and, in response to receiving notification from the service layer, outputting, by the fault detection network protocol, a control message to a router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second service node reachable by a backup service engineered path.</p><p id="p0013" num="0013">In another aspect, a network device includes a forwarding plane that includes a packet forwarding component, a fault detection network protocol executing within the forwarding plane, and a service plane comprising one or more service cards. The service plane includes a software process that applies a service to network traffic received at the network device via a primary service engineered path, wherein the network device operates as an egress device of the primary service engineered path, and a monitor component that communicates with the software process to assess a performance level of the software process in applying the service to the network traffic, wherein the performance level of the service is independent of an overall operational state of the network device. The monitor component detects that the performance<!-- EPO <DP n="4"> --> level of the service differs from an expected performance level of the service by at least a threshold amount, wherein the monitor component outputs a notification to the fault detection network protocol when the detected difference in the performance level differs from the expected performance level by at least the threshold amount. In response to receiving the notification from the monitor component, the fault detection network protocol outputs a control message to a router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second network device reachable by a backup service engineered path.</p><p id="p0014" num="0014">In another aspect, a system includes a service node, and a router along a primary service engineered path between the service node and the router. The service node includes a forwarding plane that includes a packet forwarding component, a fault detection network protocol executing within the forwarding plane, and a service plane comprising one or more service cards. The service plane includes a software process that applies a service to network traffic received at the network device via the primary service engineered path, wherein the network device operates as an egress device of the primary service engineered path, and a monitor component that communicates with the software process to assess a performance level of the software process in applying the service to the network traffic, wherein the performance level of the service is independent of an overall operational state of the network device. The monitor component detects that the performance level of the service differs from an expected performance level of the service by at least a threshold amount, and the monitor component outputs a notification to the fault detection network protocol when the detected difference in the performance level differs from the expected performance level by at least the threshold amount. In response to receiving the notification from the monitor component, the fault detection network protocol outputs a control message to the router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second network device reachable by a backup service engineered path. The router receives the control message, and, in response to receiving the control message, reroutes traffic requiring application of the service to the second instance of the service provided at the second network device reachable by the backup service engineered path.</p><p id="p0015" num="0015">In another aspect, a computer-readable storage medium includes instructions for causing a programmable processor to apply a service to network traffic received at a service plane of a service node via a primary service engineered path, wherein the service node operates as an egress device of the primary service engineered path, and detect, at the service plane of the service node, that a performance level of the service differs from an expected performance level of the service by at least a threshold amount, wherein the performance level<!-- EPO <DP n="5"> --> of the service is independent of an overall operational state of the service node. The computer-readable storage medium further includes instructions to output a notification to a fault detection network protocol in a forwarding plane of the service node when the detected difference in the performance level of the service differs from the expected performance level by at least the threshold amount, and further includes instructions to, in response to receiving notification from the service layer, output, by the fault detection network protocol, a control message to a router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second service node reachable by a backup service engineered path.</p><p id="p0016" num="0016">The details of one or more examples are set forth in the accompanying drawings and the description below. Other features, objects, and advantages will be apparent from the description and drawings, and from the claims.</p><heading id="h0005"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0017" num="0017"><figref idrefs="f0001">FIG. 1</figref> is a block diagram illustrating an example system in which routers and service nodes are configured to operate in accordance with the techniques of this disclosure.</p><p id="p0018" num="0018"><figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating an example embodiment of a service node network device in accordance with the techniques of this disclosure.</p><p id="p0019" num="0019"><figref idrefs="f0003">FIG. 3</figref> is a flowchart illustrating example operation of network devices in accordance with the techniques of this disclosure.</p><heading id="h0006"><b>DETAILED DESCRIPTION</b></heading><p id="p0020" num="0020"><figref idrefs="f0001">FIG. 1</figref> is a block diagram illustrating an example system 10 in which routers 12A-12G ("routers 12") and service nodes 20A-20B ("service nodes 20") of network 14 are configured to operate in accordance with the techniques of this disclosure. In the illustrated example of <figref idrefs="f0001">FIG. 1</figref>, router 12A is an edge router of a network 14, which may be administered by a network service provider, and provides connectivity for subscribers 18A-18N ("subscribers 18"). Edge router 12A is coupled to access node (AN) 16 ("AN 16") via access links 19A-19N. Subscribers may be associated with customer networks or access networks (not shown). Edge router 12A communicates with access node 16 to provide subscribers 18 with access to network 14.</p><p id="p0021" num="0021">Each of subscribers 18 may include one or more computing devices (not shown), such as personal computers, laptop computers, handheld computers, workstations, servers, switches, printers, or other devices. Network 14 may be a service provider network coupled to one or more networks administered by other service providers, and may thus form part of a large-scale public network infrastructure, e.g., the Internet. The service provider may provide subscribers 18 with access to the Internet via network 14, which allows computing devices represented by subscribers 18 to communicate with computing devices within the Internet or with another one of subscribers 18. <figref idrefs="f0001">FIG. 1</figref> may be a simplified view of network 14. Network 14<!-- EPO <DP n="6"> --> may include a variety of other network devices (not shown), such as routers, switches, servers, and the like and may be connected to other networks.</p><p id="p0022" num="0022">In this example, routers 12A-12G are connected to one another by physical links. The physical links 15 may be a physical medium, such as a copper wire, a coaxial cable, any of a host of different fiber optic lines, or a wireless connection. In order to maintain an accurate representation of the network 14, routers 12 and service nodes 20 exchange routing information using control-plane signaling in accordance with one or more defined protocols, such as the Border Gateway Protocol (BGP). Another example protocol for exchanging routing information is the Intermediate System to Intermediate System protocol (ISIS), which is an interior gateway routing protocol for IP networks for communicating link-state information within an autonomous system. Other examples of interior routing protocols include the Open Shortest Path First (OSPF), and the Routing Information Protocol (RIP).</p><p id="p0023" num="0023">The example of <figref idrefs="f0001">FIG. 1</figref> illustrates a service enabling technology function ("SET 22A") hosted by service node 20A that is accessed by subscribers 18A-18N across service engineered path 24A that extends between edge router 12A and service node 20A. As used herein, a "service enabling technology (SET)" function is a service enabling technology that is physically deployed and hosted at a service node. Examples of service enabling technology functions may include applications, session border controller (SBC), virtual appliance, virtual cache, network traffic acceleration, network address translation (NAT), firewall, deep packet inspection (DPI), Quality of Service (QoS), access control, and other functions. In some examples, services provided by SETs may be composite services composed of two or more services, and may form a single externally visible service to subscribers 18. As one example, a SET may be a composite SET consisting of NAT services and firewall services.</p><p id="p0024" num="0024">As one example, edge router 12A receives a request for a particular service from a subscriber. For example, edge router 12A may receive a request from subscriber 18A for a parental control application service enabling technology function. Edge router 12A selects service node 20A as being able to provide the requested parental control application service enabling technology function. Service node 20A hosts an instance 22A of the parental control application service enabling technology function. In response to the request, edge router 12A establishes a service engineered path 24A to service node 20A, if service engineered path 24A is not already in place. Service engineered path 24A may be a traffic-engineered network tunnel, such as a label switched path (LSP) established using a resource reservation protocol, such as Resource Reservation Protocol with Traffic-Engineering Extensions (RSVP-TE), or other type of tunnel. In some examples, multiple SETs may be linked together using service engineered paths 24. As one example, router 12A may be establishing the service engineered paths 24 to carry layer two (L2) communications from subscribers 18 to service nodes 20 in the<!-- EPO <DP n="7"> --> form of MPLS packets that enter the respective service engineered path 24 at ingress router 12A and exit the service engineered path 24 at service node 20A or 20B.</p><p id="p0025" num="0025">In addition, edge router 12A may also establish backup service engineered path 24B to a second service node 22B, which is a second service node that edge router 12A selects as also being able to provide the requested parental control application service enabling technology function. Service engineered path 24B is a second service engineered path, i.e., another traffic-engineered network tunnel. SET 22B may be a second instance of the same SET as SET 22A. Edge router 12A may use fast reroute extensions to RSVP-TE, such as described in P. Pan, "Fast Reroute Extensions to RSVP-TE for LSP Tunnels," RFC 4090, May 2005, the entire contents of which are incorporated by reference herein. For example, edge router 12A may serve as a point of local repair for fast reroute. Edge router 12A may install forwarding state that indicates that service engineered path 24A is a primary service engineered path for traffic from subscriber 18A, and service engineered path 24B is a backup service engineered path for traffic from subscriber 18A. Ingress router 12A associates the backup service engineered path 24B with the primary service engineered path 24A. Traffic normally forwarded through the primary service engineered path 24A is redirected onto service engineered path 24B should service engineered path 24A be marked as inoperable due to failure or degradation of SET 22A.</p><p id="p0026" num="0026">After router 12A finishes establishing backup service engineered path 24B, router 12A maintains forwarding information in a data plane of router 12A that allows router 12A to send traffic through service engineered path 24B upon receipt of a BFD control packet from service node 20A indicating failure or degradation of SET 22A. See, for example, techniques described by <patcit id="pcit0002" dnum="US8077726B"><text>U.S. Patent No. 8,077,726</text></patcit>, entitled "Fast Reroute for Multiple Label Switched Paths Sharing a Single Interface," issued December 13, 2011, the entire contents of which are incorporated by reference herein. In this manner, edge router 12A can automatically trigger fast reroute to send traffic from subscriber 18A to service node 20B via service engineered path 24B in the event that edge router 12A is notified of a problem with SET 22A or service node 20A, as described below.</p><p id="p0027" num="0027">Upon receiving network traffic from subscriber 18A, edge router 12A determines that a profile of subscriber 18A requires the traffic to be sent on service engineered path 24A to service node 20A for application of the parental control application 22A. Edge router 12A then forwards the traffic from subscriber 18A on service engineered path 24A, such as by appending an MPLS label to the traffic from subscriber 18A.</p><p id="p0028" num="0028">A monitor component in the service plane at service node 20A monitors performance levels of SET 22A. In the event that the monitor component detects a failure or degeneration of pre-set service levels for SET 22A, the monitor component triggers a failure event to BFD. The<!-- EPO <DP n="8"> --> monitor component in the service plane may trigger an event to BFD in the forwarding plane when a degradation of performance of the service occurs such that the service enabling technology function can no longer provide the services paid for by a service level agreement (SLA). In some aspects, the monitor component may be a high availability (HA) monitor component that interacts with the service function. For example, the HA monitor may interact with services to collect statistics, perform handshaking, or carry out other checks to the functionality of services.</p><p id="p0029" num="0029">A BFD session 26 is enabled between router 12A and service node 20A, such as described in R. Aggarwal, "Bidirectional Forwarding Detection (BFD) for MPLS Label Switched Paths (LSPs)," RFC 5884, June 2010, the entire contents of which are incorporated by reference herein. To use BFD for fault detection on an MPLS LSP such as service engineered path 24A, edge router 12A and service node 20A establish a BFD session 26 for that particular MPLS LSP, e.g., using LSP Ping messages. BFD control packets are sent along the same data path as the service engineered path 24A being verified. BFD for MPLS LSPs typically used to detect a data plane failure in the MPLS LSP path, even when the control plane of devices associated with the MPLS LSP is functional. Here, BFD is being used to communicate, from a service node 20A to an ingress router 12A, that a performance degradation or failure has occurred with a service provided in a service plane of the service node 20A.</p><p id="p0030" num="0030">Service node 20A uses the BFD session 26 to report any change in status of SET 22A to edge router 12A. In some examples, a BFD module on service node 20A may set a diagnostic code of a BFD control packet to indicate the performance degradation in the relevant service. Ingress router 12A builds the backup service engineered path 24B using a diverse path that bypasses service node 20A, and directs traffic to a different instance of the SET that is hosted at another Service Node, e.g., SET 22B at service node 20B.</p><p id="p0031" num="0031">The performance level of the service enabling technology function is independent of an overall operational state of the service node network device. In other words, upon notification of this failure event through BFD session 26, edge router 12A is able to trigger fast reroute and switch traffic from service engineered path 24A to service engineered path 24B, even though the existing service node 20A used for SET 22A remains operable. The failover of network traffic requiring the service enabling technology function occurs without disruption to a subscriber receiving the services of the SET.</p><p id="p0032" num="0032">In some examples, service engineered path 24A may not be marked as wholly inoperable as a result of receiving the BFD control packet on BFD session 26, but may be marked as inoperable only with respect to the particular SET 22A that has failed. Service engineered path 24A may continue to be used by router 12A for forwarding traffic to service node 20A on service engineered path 24A for accessing other SETs hosted by service node<!-- EPO <DP n="9"> --> 20A. In this manner, upon receiving a notification from service node 20A of a performance issue with SET 22A, edge router 12A can do a fast reroute operation to reroute only the traffic needing the failing service on to a backup service engineered path 24B, using fast reroute mechanisms typically used only in case of a link or node failure notification.</p><p id="p0033" num="0033">If the service that had been having performance issues (in this example SET 22A) later resumes its expected performance levels, the HA monitor in the service plane of service node 20A may detect this change, and notify the BFD protocol running on the forwarding plane of service node 20A, which in turn can inform the edge router 12A using BFD session 26. The edge router 12A can then determine whether to continue sending the relevant traffic on the service engineered path 24B or revert to sending the traffic on the service engineered path 24A.</p><p id="p0034" num="0034">Although <figref idrefs="f0001">FIG. 1</figref> is described for purposes for illustration in part with respect to an edge router of network 14, the techniques may be also applied to a non-edge router. Likewise, the techniques of this disclosure may be applied by a router that is not the ingress of one or both of service engineered paths 24, but instead may be applied by a non-ingress router along the service engineered paths 24, such as a point of local repair router.</p><p id="p0035" num="0035">The configuration of the network environment illustrated in <figref idrefs="f0001">FIG. 1</figref> is merely an exemple. For example, network 14 may include any number of edge routers coupled to one or more customer networks. Nonetheless, for ease of description, only edge router 12A and access node 16 are illustrated in <figref idrefs="f0001">FIG. 1</figref>. As another example, network 14 may include a greater number of service nodes 20 than shown, and each of service nodes 20 may provide a plurality of services and SETs.</p><p id="p0036" num="0036"><figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating an example of service node 20A in greater detail. Service node 20A may include a forwarding plane 42, a routing plane 40 and a service plane 46. Service node 20A may provide forwarding plane 42 for forwarding network traffic 51 and routing plane 40 for routing network traffic 51. In some instances, forwarding plane 42 may be distributed over a plurality of interfaces or interface cards (not shown), e.g., in a multi-chassis router. In other instances, forwarding plane 42 may be located in a central location, such as a programmable processor or other control unit of service node 20A. Typically, routing plane 40 resides in this central location, and in instances where forwarding plane 42 resides in the central location, the same programmable processor or other control unit may include or execute both forwarding plane 42 and routing plane 40. Routing plane 40 may, in some embodiments, be distributed over a plurality of processors or components.</p><p id="p0037" num="0037">Routing plane 40 may include a routing engine 44 that resolves routes through network 14 in accordance with one or more of a plurality of routing protocols. Routing engine 44 may include a device management interface 56 ("DMI 56") and a routing daemon 61. Routing engine 44 is primarily responsible for maintaining routing information 60 to reflect a current<!-- EPO <DP n="10"> --> topology of network 14. Routing information 60 describes the topology of a network and, in particular, routes through the network. Routing information 60 may include, for example, route data that describes various routes within the network, and corresponding next hop data indicating appropriate neighboring devices within the network for each of the routes.</p><p id="p0038" num="0038">In addition, routing engine 44 uses routes stored in routing information 60 to compute best paths for particular network destinations and derive forwarding information 62 ("forwarding info 62"), which includes entries that map destination addresses to outbound interfaces on service node 20A. Routing engine 44 may push a subset of forwarding information 62 to forwarding engine 44 for storage as forwarding information 62'. Forwarding information 62 may, therefore, be thought of as a subset of the information contained within routing information 36. Forwarding information 62 may also include labels for use in forwarding MPLS packets along LSPs. Routing daemon 61 may represent a software module that updates routing information 50 to reflect a current topology of network 14. While described as a daemon or software module executed by routing engine 44, routing daemon 61 may be implemented as a hardware module or a combination of both hardware and software. Routing engine 44 also includes a service daemon that interfaces with service plane 46, such as to permit configuration of service card 48 by device management interface 56.</p><p id="p0039" num="0039">Forwarding plane 42 may include a forwarding engine 44. Forwarding engine 44 may represent a software and/or hardware component, such as one or more interface cards (not shown), that forwards network traffic 51. Forwarding engine 44 may divert aspects of network traffic 51 as service traffic 74 to service engine 50. After application of one or more services 52, service plane 46 returns the service traffic 74 to forwarding engine 44 to be merged into outbound network traffic 69. Forwarding engine 44 may forward some aspects of network traffic 51 as outbound network traffic 69 without diverting to the service plane 46, when application of services is not needed for the traffic.</p><p id="p0040" num="0040">Forwarding engine 44 may represent a central or distributed forwarding engine, where a distributed forwarding engine is distributed across a plurality of interface cards and a central forwarding engine resides in the above described central location, e.g., control unit 50, of service node 20A. Forwarding engine 44 may forward network traffic 51 in accordance with forwarding information 62' ("forwarding info 62"'). Forwarding information 62' may comprise an association or table of mappings identifying an interface by which to forward a particular packet or data unit of network traffic 51.</p><p id="p0041" num="0041">Service node 20A may further provide service plane 46 for applying one or more of a plurality of services 52 to network traffic 51. Service plane 46 may implement the functionality of a network security device and/or other service oriented devices using at least one service card 48. As further examples, service plane 46 may implement service enabling technologies<!-- EPO <DP n="11"> --> (SETs), including services and service oriented devices, represented by services 52. Example SETs that may be provided by services 52 include, for example, applications, session border controller (SBC), virtual appliance, virtual cache, network traffic acceleration, network address translation (NAT), firewall, deep packet inspection (DPI), Quality of Service (QoS), access control, or other service functions.</p><p id="p0042" num="0042">Service card 48 may include a service engine 50. Service engine 50 may represent a software and/or hardware component that applies services 52 in accordance with policy rules defined by policy configuration data stored by policies 54. Policies 54 may be a policy module that stores and maintains policy configuration data for service engine 50 and, by extension, service plane 46. In some examples, policies 54 may maintain policy configuration data in an XML-based encoding. However, in some embodiments, policies 54 may maintain policy configuration data in the form of one or more tables, linked lists, databases, flat files, or any other data structure.</p><p id="p0043" num="0043">Device management interface (DMI) 56 may represent a software and/or hardware module that presents an interface with which an administrator or an administrative device, represented by "ADMIN" 68, may interact to specify certain operational characteristics of service node 20A. In response to invocation by admin 68, device management interface 56 interacts with other components of service node 20A, such as to retrieve, configure, copy, and/or delete policy configuration data stored in policies 54, update service data 66 via service daemon 47, and to perform other management-related functions.</p><p id="p0044" num="0044">Service engine 50 applies one or more of services 52 to received packets in accordance with policies 54. As one example, for a service 52 comprising a parental control application, a packet may be received from a subscriber requesting access to web content associated with a given uniform resource locator (URL). The service 52 causes service engine 50 to reference policies 54 to determine whether a profile of a subscriber from which the packet is received allows the request from the subscriber to be allowed through to the specified URL. In another example, service engine 50 may apply a QoS policy that classifies packets meeting the policy condition to a particular forwarding equivalence class (FEC). In these instances, service engine 50 may forward packets differently depending on their classified FEC to meet QoS requirements.</p><p id="p0045" num="0045">Policy configuration data stored by policies 54 may include policies for any of services 52 applied by service plane 46. Although described herein with respect to policies 54 stored within service plane 46, in some embodiments, policies may be stored within or distributed to additional service cards 48, routing plane 40 or forwarding plane 42. For example, in some embodiments, forwarding plane 42 may store one or more policy rules for prompt application by the forwarding elements to network traffic 51.<!-- EPO <DP n="12"> --></p><p id="p0046" num="0046">Service engine 50 also includes a high availability monitor ("HA monitor") 58. HA monitor 58 may represent a software and/or hardware component that monitors performance of one or more of services 52 in service plane 46. Service plane 46 may provide an operating environment for running one or more applications, including one or more of services 52, created by a third-party software development kit (SDK). In some examples, HA monitor 58 may also be a software application that makes use of the SDK. In some aspects, services 52 may each expose an application programming interface (API) by which HA monitor inspects performance data (e.g., loading levels) for the respective service. Alternatively, HA monitor 58 may expose a universal interface, which each of services 52 may invoke to communicate current performance data. As another example, HA monitor 58 may periodically ping each service 52 or may monitor output communications from each of the services or operating-system level resources consumed by each of the services. HA monitor 58 can monitor any of a variety of parameters associated with services 52, which may be defined via a management plane of service node 20A, e.g., via device management interface 56. HA monitor 58 can monitor parameters associated with services 52 such as per-process central processing unit (CPU) usage, memory usage, rate of output, number of available connections, or any other parameters for detecting whether a service 52 is performing according to expected levels. For example, if a service 52 is expected to provide an output at a threshold rate, HA monitor 58 can detect when the actual rate of output falls below the threshold rate. An administrator can configure the performance level thresholds via device management interface 56, such as when an application or other service is initially deployed on service node 20A. The performance level thresholds may be stored as service data 66. The performance level thresholds may be selected relative to SLA requirements, to trigger action when performance levels fall below what required by subscribers 18.</p><p id="p0047" num="0047">As one example, a network address translation (NAT) function provided by one of services 52 may support a number of connections. Admin 68 may configure a threshold number of connections below which the NAT service should not fall for an expected performance level. Device management interface 56 configures service card 48 via service daemon 47 to store the configured threshold to service data 66. HA monitor 58 may continuously or periodically monitor the number of connections being supported by the NAT service, and if the number of connections available by the NAT service falls below the threshold number of connections, the HA monitor 58 can detect this event and send a notification to BFD module 64 in the forwarding plane.</p><p id="p0048" num="0048">When the performance level of a given one of services 52 is substantially different than expected, e.g., outside of one or more preset threshold ranges, HA monitor 58 in service plane 46 notifies a fault detection protocol of service node 20A, such as BFD module 64 of the<!-- EPO <DP n="13"> --> forwarding plane 42 of service node 20A. For example, HA monitor 58 may notify BFD module 64 through an API or other internal software mechanism. HA monitor 58 can detect when one or more of services 52 is operating outside of expected performance level thresholds, and notifies BFD module 64 of the performance level issues of the service 52. In this manner, HA monitor 58 operates in the service plane 46 to monitor services 52, and provides a trigger to the fault detection protocol, e.g., BFD 64, in the forwarding plane 42 (sometimes referred to as the data plane), which, as described below, causes BFD 64 to send a control packet to ingress router 12A to trigger fast reroute by router 12A.</p><p id="p0049" num="0049">BFD module 64 may be extended as described herein to support the notification of failures or degradation of services 52, which may be service enabling technologies (SETs). Consistent with the principles of the disclosure, BFD module 64 provides signaling mechanisms for notifying an ingress edge router of a service engineered path of a failure of a service 52, such as an application or other service 52. In certain embodiments, the operations may be carried out automatically, i.e., without intervention by a system administrator or a software agent.</p><p id="p0050" num="0050">BFD module 64 can be implemented in the forwarding plane 42 and can continue to function through disruptions in the control plane of service node 20A. BFD module 64 uses control packets to indicate information about service node 20A to other devices, such as to edge router 12A over BFD session 26 (<figref idrefs="f0001">FIG. 1</figref>). For example, BFD module 64 can include diagnostic code in a control packet, where the diagnostic code value may be defined to indicate the local system's reason for a change in session state. The Diagnostic field may be used by the remote system (edge router 12A) to determine the reason that a session failed, for example. BFD module 64 sends BFD control packets in an encapsulation appropriate to the environment. For example, a BFD control packet may be encapsulated with an MPLS label and sent by source node 20A via an LSP of service engineered path 24A. Further details on BFD can be found in <nplcit id="ncit0001" npl-type="s"><text>D. Katz, "Bidirectional Forwarding Detection (BFD)," RFC 5880, June 2010</text></nplcit>, the entire contents of which are incorporated by reference herein.</p><p id="p0051" num="0051">The Diagnostic field of the BFD control packet allows remote systems to understand the nature of a change in status of a session on the sender's system. In accordance with one example of the techniques of this disclosure, upon detecting a failure or degradation of one of services 52, BFD module 64 may send a BFD control packet that includes a newly defined diagnostic code in a Diagnostic (DIAG) field of the BFD control packet. As one example, BFD module 64 can be extended to include an additional new diagnostic code used to indicate a failure or degradation of an operational state of one or more of services 52, despite that the data plane (forwarding plane 42) and control plane of service node 20A are still working normally. The new diagnostic code may be referred to as a "Service Down" code, for example. Assuming<!-- EPO <DP n="14"> --> edge router 12A executes a BFD module that can process the new diagnostic code, when the edge router 12A receives the BFD control message having the new diagnostic code set, its BFD module will be informed by the diagnostic code of the BFD control message that a failure or degradation of some service has occurred, and a forwarding plane of edge router 12A can take appropriate action to automatically trigger fast reroute of packets requiring services to a different service node.</p><p id="p0052" num="0052">As a further example, BFD module 64 of service node 20A may be extended to identify the particular service for which the performance degradation has been detected. For example, BFD module 64 can be extended to include both a "service down" diagnostic code as well as other sub-codes that can be used to specify which particular services 52 are experiencing performance problems. In this example, BFD may need further modifications so as to allocate enough bits in the BFD control packet to the sub-codes. Edge router 12A receiving the BFD control message having the new diagnostic code and sub-code set will be informed by the diagnostic code of the BFD control message that a failure or degradation of a particular identified service 52 has occurred, and in response edge router 12A can take appropriate action to trigger fast reroute of affected packets to a different instance of the service on a different service node. The BFD module on edge router 12A would likewise be modified in order to process the new diagnostic code and sub-codes to carry out the required actions and decide which traffic to reroute. In some aspects, edge router 12A can perform fast reroute for traffic needing the identified service, but can leave other traffic to service node 20A intact over service engineered path 24A. That is, edge router 12A may not reroute all traffic from service engineered path 24A, but may just update its forwarding state to forward all traffic requiring the identified service 52 onto service engineered path 24B. This may provide a selective fast reroute function allowing router 12A to reroute traffic for some services and not others.</p><p id="p0053" num="0053">In another alternative example, in response to notification by HA monitor 58 of a performance issue in a service 52, instead of using a new "Service Down" diagnostic code, BFD module 64 of service node 20A may use an existing code of BFD to indicate that service node 20A is down to trigger the fast reroute, e.g., a node failure event, even though the service node 20A is not actually down. In response to receiving the BFD control packet indicating a node failure, edge router 12A may reroute all traffic from service node 20A to one or more alternative service nodes, (e.g., service node 20B).</p><p id="p0054" num="0054">The architecture of service node 20A illustrated in <figref idrefs="f0002">FIG. 2</figref> is shown for illustrative purposes only. The disclosure is not limited to this architecture. In other examples, service node 20A may be configured in a variety of ways. Although described for illustrative purposes in reference to BFD, the principles described herein may be applied to extend other protocols, such as other protocols for Operations, Administration, and Maintenance (OAM) and/or fault<!-- EPO <DP n="15"> --> detection. In some examples, BFD module 64 may execute on one or more interface cards of forwarding plane 42 (not shown).</p><p id="p0055" num="0055">Aspects of service plane 46, routing plane 40, or forwarding plane 42 may be implemented solely in software, or hardware, or may be implemented as a combination of software, hardware, or firmware. For example, service plane 46, routing plane 40, or forwarding plane 42 may include one or more hardware-based processors which execute software instructions. In that case, the various software modules of service plane 46, routing plane 40, or forwarding plane 42, such as BFD module 64, may comprise executable instructions stored on a computer-readable storage medium, such as computer memory or hard disk.</p><p id="p0056" num="0056"><figref idrefs="f0003">FIG. 3</figref> is a flowchart illustrating example operation of network devices in accordance with the techniques of this disclosure. For purposes of example, <figref idrefs="f0003">FIG. 3</figref> will be described with reference to service node 20A of <figref idrefs="f0001">FIGS. 1</figref> and <figref idrefs="f0002">2</figref>, and router 12A of <figref idrefs="f0001">FIG. 1</figref>. Although <figref idrefs="f0003">FIG. 3</figref> is described for purposes for illustration in part with respect to an edge router of network 14, the techniques may be also applied to a non-edge router. Likewise, the techniques of this disclosure may be applied by a router that is not the ingress of one or both of service engineered paths 24, but instead may be applied by another non-ingress router along the service engineered paths 24, such as a point of local repair router.</p><p id="p0057" num="0057">The service plane 46 may receive one or more performance level thresholds, such as by administrator configuration, and may store the thresholds as service data 66 (98). HA monitor 58 in the service plane 46 (also referred to as the "service layer") of service node 20A monitors aspects one or more of services 52 to ascertain whether a performance level of the service 52 is within an expected range of performance level, based on the performance level thresholds of service data 66 (100). When the performance level is not substantially different than expected, e.g., not outside of preset threshold range(s) (YES of block 102), HA monitor 58 continues to monitor the services 52. For example, HA monitor 58 may interact with services 52 to collect statistics, perform handshaking, or carry out other checks to the functionality of services 52.</p><p id="p0058" num="0058">When the performance level of a given one of services 52 is substantially different than expected, e.g., outside of one or more preset threshold ranges (NO of block 102), HA monitor 42 notifies a fault detection protocol of service node 20A, such as BFD module 64 of the forwarding plane 42 of service node 20A (104). The change in performance level may indicate that the service 52 has failed or degraded. The notification from HA monitor 42 to BFD module 64 may identify the service for which the performance degradation or failure has been detected. In response to receiving the notification from HA monitor 58 of the service plane 46, BFD module 64 outputs a control packet on an existing BFD session 26 to ingress router 12A, to notify router 12A of the degradation of performance of the service 52 (106). As described above, the control packet can include various forms of information to trigger router 12A to<!-- EPO <DP n="16"> --> reroute of some or all traffic from service node 20A. For example, the BFD control packet may include a diagnostic code that specifies that network traffic being sent to service node 20A for service 52 should be sent elsewhere.</p><p id="p0059" num="0059">Router 12A executes a corresponding BFD module that receives the BFD control packet (108). In response to receiving the BFD control packet, edge router 12A determines which traffic should be rerouted, selects a new service node such as service node 20B having another instance of the required service 52, and triggers fast reroute of the traffic requiring services to the service node 20B (110). In some examples, edge router 12A may automatically update stored forwarding information to modify next hops for routes formerly destined for service node 20A via service engineered path 24A, to now reflect a next hop to reach service node 20B via service engineered path 24B. If service engineered path 24B is not already in existence, edge router 12A may establish service engineered path 24B at this time, e.g., using RSVP-TE.</p><p id="p0060" num="0060">The techniques described in this disclosure may be implemented, at least in part, in hardware, software, firmware or any combination thereof. For example, various aspects of the described techniques may be implemented within one or more processors, including one or more microprocessors, digital signal processors (DSPs), application specific integrated circuits (ASICs), field programmable gate arrays (FPGAs), or any other equivalent integrated or discrete logic circuitry, as well as any combinations of such components. The term "processor" or "processing circuitry" may generally refer to any of the foregoing logic circuitry, alone or in combination with other logic circuitry, or any other equivalent circuitry. A control unit comprising hardware may also perform one or more of the techniques of this disclosure.</p><p id="p0061" num="0061">Such hardware, software, and firmware may be implemented within the same device or within separate devices to support the various operations and functions described in this disclosure. In addition, any of the described units, modules or components may be implemented together or separately as discrete but interoperable logic devices. Depiction of different features as modules or units is intended to highlight different functional aspects and does not necessarily imply that such modules or units must be realized by separate hardware or software components. Rather, functionality associated with one or more modules or units may be performed by separate hardware or software components, or integrated within common or separate hardware or software components.</p><p id="p0062" num="0062">The techniques described in this disclosure may also be embodied or encoded in a computer-readable medium, such as a computer-readable storage medium, containing instructions. Instructions embedded or encoded in a computer-readable medium may cause a programmable processor, or other processor, to perform the method, e.g., when the instructions are executed. Computer-readable media may include non-transitory computer-readable storage media and transient communication media. Computer readable storage media, which is<!-- EPO <DP n="17"> --> tangible and non-transitory, may include random access memory (RAM), read only memory (ROM), programmable read only memory (PROM), erasable programmable read only memory (EPROM), electronically erasable programmable read only memory (EEPROM), flash memory, a hard disk, a CD-ROM, a floppy disk, a cassette, magnetic media, optical media, or other computer-readable storage media. It should be understood that the term "computer-readable storage media" refers to physical storage media, and not signals, carrier waves, or other transient media.</p><p id="p0063" num="0063">In addition to or as an alternative to the above, the following embodiments are described. The features described in any of the following embodiments may be utilized with any of the embodiments described herein.</p><p id="p0064" num="0064">In one aspect, a method includes by a service node, applying a service to network traffic received at a service plane of the service node via a primary service engineered path, wherein the service node operates as an egress device of the primary service engineered path, and detecting, at the service plane of the service node, that a performance level of the service differs from an expected performance level of the service by at least a threshold amount, wherein the performance level of the service is independent of an overall operational state of the service node. The method also includes outputting a notification to a fault detection network protocol in a forwarding plane of the service node when the detected difference in the performance level of the service differs from the expected performance level by at least the threshold amount, and, in response to receiving notification from the service layer, outputting, by the fault detection network protocol, a control message to a router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second service node reachable by a backup service engineered path.</p><p id="p0065" num="0065">In some embodiments, the method may further comprise monitoring, at the service plane of the service node, performance of the service. In some embodiments, the primary service engineered path comprises a traffic-engineered path established using a resource reservation protocol with traffic engineering extensions (RSVP-TE) LSP. In some embodiments, the overall operational state of the service node is operational when the performance level of the service differs from the expected performance level by the threshold amount.</p><p id="p0066" num="0066">In some embodiments, the router on the primary service engineered path comprises an ingress router of the primary service engineered path, and wherein the primary service engineered path comprises a traffic-engineered path between the ingress router and the service node in which the service node is selected as being capable of providing the service to traffic associated with the primary service engineered path. In some embodiments, the service comprises a composite service comprising two or more service functions.<!-- EPO <DP n="18"> --></p><p id="p0067" num="0067">In another aspect, a network device includes a forwarding plane that includes a packet forwarding component, a fault detection network protocol executing within the forwarding plane, and a service plane comprising one or more service cards. The service plane includes a software process that applies a service to network traffic received at the network device via a primary service engineered path, wherein the network device operates as an egress device of the primary service engineered path, and a monitor component that communicates with the software process to assess a performance level of the software process in applying the service to the network traffic, wherein the performance level of the service is independent of an overall operational state of the network device. The monitor component detects that the performance level of the service differs from an expected performance level of the service by at least a threshold amount, wherein the monitor component outputs a notification to the fault detection network protocol when the detected difference in the performance level differs from the expected performance level by at least the threshold amount. In response to receiving the notification from the monitor component, the fault detection network protocol outputs a control message to a router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second network device reachable by a backup service engineered path.</p><p id="p0068" num="0068">In some embodiments, the service comprises a network service comprising at least one of an application, session border controller (SBC), virtual appliance, virtual cache, network traffic acceleration, network address translation (NAT), firewall, deep packet inspection (DPI), Quality of Service (QoS), and access control.</p><p id="p0069" num="0069">In some embodiments, the monitor component of the service plane monitors performance of the service. In some embodiments, the monitor component comprises a high availability (HA) monitor software component at the service plane, operable on a service card of the service node, wherein the HA monitor software component interacts with software process that applies the service to assess the performance of the software process in applying the service.</p><p id="p0070" num="0070">In some embodiments, the HA monitor software component of the network device exposes an interface that can be invoked by software process that applies the service to communicate performance data to the HA monitor software component.</p><p id="p0071" num="0071">In some embodiments, the fault detection network protocol of the network device comprises a Bidirectional Forwarding Detection (BFD) protocol module executing within the data plane of the service node, wherein the BFD module outputs a BFD control packet on a BFD session established between the service node and the router, wherein the BFD session is associated with the primary service engineered path, wherein the BFD control packet specifies<!-- EPO <DP n="19"> --> a diagnostic code that indicates that the router should reroute network traffic to a different service node.</p><p id="p0072" num="0072">In some embodiments, the diagnostic code of the BFD control packet specifies the particular service for which network traffic should be rerouted to the second service node providing the second instance of the service.</p><p id="p0073" num="0073">In some embodiments, the software process comprises a first software process that applies a first service, wherein the service plane comprises a second software process that applies a second service to network traffic received at the network device via the primary service engineered path, wherein the monitor component monitors a first performance level of the first software process relative to a first threshold performance level, and wherein the monitor component monitors a second performance level of the second service relative to a second threshold performance level.</p><p id="p0074" num="0074">Various aspects of this disclosure have been described. These and other aspects are within the scope of the following claims.</p></description><claims mxw-id="PCLM56976193" lang="EN" load-source="patent-office"><!-- EPO <DP n="20"> --><claim id="c-en-0001" num="0001"><claim-text>A method comprising:
<claim-text>by a service node, applying a service to network traffic received at a service plane of the service node via a primary service engineered path, wherein the service node operates as an egress device of the primary service engineered path;</claim-text>
<claim-text>detecting, at the service plane of the service node, that a performance level of the service differs from an expected performance level of the service by at least a threshold amount, wherein the performance level of the service is independent of an overall operational state of the service node;</claim-text>
<claim-text>outputting a notification to a fault detection network protocol in a forwarding plane of the service node when the detected difference in the performance level of the service differs from the expected performance level by at least the threshold amount; and</claim-text>
<claim-text>in response to receiving notification from the service layer, outputting, by the fault detection network protocol, a control message to a router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second service node reachable by a backup service engineered path.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method of claim 1, wherein the service comprises a network service comprising at least one of an application, session border controller (SBC), virtual appliance, virtual cache, network traffic acceleration, network address translation (NAT), firewall, deep packet inspection (DPI), Quality of Service (QoS), and access control.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method of any preceding claim, wherein monitoring performance of the service comprises executing a high availability (HA) monitor software component at the service plane, wherein the HA monitor software component interacts with the service to assess the performance of the service.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method of any of claims 1-3, wherein the HA monitor software component exposes an interface that can be invoked by the service to communicate performance data to the HA monitor software component.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method of any of claims 1-4, wherein the HA monitor software component is operable on a service card of the service node.<!-- EPO <DP n="21"> --></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method of any of claims 1-5, wherein detecting that the performance level of the service differs from the expected performance level by the threshold amount comprises detecting that the service has failed.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method of any of claims 1-6, wherein the expected performance level is determined based on a service level agreement (SLA).</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method of any of claims 1-7, wherein the fault detection network protocol comprises a Bidirectional Forwarding Detection (BFD) protocol executing within the data plane of the service node,<br/>
wherein outputting a control message comprises outputting a BFD control packet on a BFD session established between the service node and the router, wherein the BFD session is associated with the primary service engineered path, and<br/>
wherein the BFD control packet specifies a diagnostic code that indicates that the router should reroute network traffic to a different service node.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method of any of claims 1-8, wherein the diagnostic code of the BFD control packet specifies the particular service for which network traffic should be rerouted to the second service node providing the second instance of the service.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The method of any of claims 1-9, further comprising:
<claim-text>receiving the control message by the router,; and</claim-text>
<claim-text>in response to receiving the control message, rerouting traffic requiring application of the service to a backup service engineered path to a different instance of the service.</claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The method of any of claims 1-10, wherein the service comprises a first service, further comprising:
<claim-text>by the service node, applying a second service to network traffic received at a service plane of the service node via a primary service engineered path, wherein the service node operates as an egress device of the primary service engineered path;</claim-text>
<claim-text>monitoring, at the service plane of the service node, a first performance level of the first service relative to a first threshold performance level;</claim-text>
<claim-text>monitoring, at the service plane of the service node, a second performance level of the second service relative to a second threshold performance level.</claim-text><!-- EPO <DP n="22"> --></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The method of any of claims 1-11, wherein the overall operational state of the service node is operational when the performance level of the service differs from the expected performance level by the threshold amount.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>A network device comprising:
<claim-text>a forwarding plane comprising:
<claim-text>a packet forwarding component;</claim-text>
<claim-text>a fault detection network protocol executing within the forwarding plane; and</claim-text></claim-text>
<claim-text>a service plane comprising one or more service cards, wherein the service plane comprises:
<claim-text>a software process that applies a service to network traffic received at the network device via a primary service engineered path, wherein the network device operates as an egress device of the primary service engineered path, and</claim-text>
<claim-text>a monitor component that communicates with the software process to assess a performance level of the software process in applying the service to the network traffic, wherein the performance level of the service is independent of an overall operational state of the network device;</claim-text></claim-text>
<claim-text>wherein the monitor component detects that the performance level of the service differs from an expected performance level of the service by at least a threshold amount,</claim-text>
<claim-text>wherein the monitor component outputs a notification to the fault detection network protocol when the detected difference in the performance level differs from the expected performance level by at least the threshold amount, and</claim-text>
<claim-text>wherein, in response to receiving the notification from the monitor component, the fault detection network protocol outputs a control message to a router on the primary service engineered path, wherein the control message notifies the router to reroute network traffic to a second instance of the service provided at a second network device reachable by a backup service engineered path.</claim-text></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The network device of claim 13 comprising means for performing any of the methods of claims 1-12.</claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>A computer-readable storage medium encoded with instructions for causing one or more programmable processors to perform the method recited by any of claims 1-12.</claim-text></claim></claims><drawings mxw-id="PDW16666976" load-source="patent-office"><!-- EPO <DP n="23"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="229" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="24"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="215" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="25"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="165" he="210" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="161" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="155" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
