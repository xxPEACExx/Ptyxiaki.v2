<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680511-A1" country="EP" doc-number="2680511" kind="A1" date="20140101" family-id="46720480" file-reference-id="318301" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549177" ucid="EP-2680511-A1"><document-id><country>EP</country><doc-number>2680511</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12749022-A" is-representative="NO"><document-id mxw-id="PAPP154823100" load-source="docdb" format="epo"><country>EP</country><doc-number>12749022</doc-number><kind>A</kind><date>20120216</date><lang>JA</lang></document-id><document-id mxw-id="PAPP220439663" load-source="docdb" format="original"><country>EP</country><doc-number>12749022.5</doc-number><date>20120216</date><lang>JA</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140452238" ucid="JP-2011038873-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011038873</doc-number><kind>A</kind><date>20110224</date></document-id></priority-claim><priority-claim mxw-id="PPC140448013" ucid="JP-2012001028-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2012001028</doc-number><kind>W</kind><date>20120216</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988127682" load-source="docdb">H04L  12/46        20060101ALI20120911BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1988128261" load-source="docdb">H04L  12/66        20060101AFI20120911BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1765415797" load-source="docdb" scheme="CPC">H04L  61/2092      20130101 LI20170914BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1765415798" load-source="docdb" scheme="CPC">H04L  61/2053      20130101 LI20170914BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2117096835" load-source="docdb" scheme="CPC">H04L  61/6059      20130101 LA20150115BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988095933" load-source="docdb" scheme="CPC">H04L  45/72        20130101 LI20131217BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988096903" load-source="docdb" scheme="CPC">H04L  63/0236      20130101 LI20130702BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988120280" load-source="docdb" scheme="CPC">H04L  12/56        20130101 FI20130926BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180015" lang="DE" load-source="patent-office">ROUTERVORRICHTUNG, PAKETSTEUERUNGSVERFAHREN AUF BASIS EINER PRÄFIXVERWALTUNG UND PROGRAMM DAFÜR</invention-title><invention-title mxw-id="PT132180016" lang="EN" load-source="patent-office">ROUTER DEVICE, PACKET CONTROL METHOD BASED ON PREFIX MANAGEMENT, AND PROGRAM</invention-title><invention-title mxw-id="PT132180017" lang="FR" load-source="patent-office">DISPOSITIF ROUTEUR, PROCÉDÉ DE COMMANDE DE PAQUET FONDÉ SUR UNE GESTION DE PRÉFIXE, ET PROGRAMME</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918166260" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>NEC ACCESS TECHNICA LTD</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR918159134" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>NEC ACCESS TECHNICA, LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR918986213" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>NEC Access Technica, Ltd.</last-name><iid>101165413</iid><address><street>800, Shimomata Kakegawa-shi</street><city>Shizuoka 436-8501</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918135240" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>AOSHIMA TSUTOMU</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918165913" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>Aoshima, Tsutomu</last-name></addressbook></inventor><inventor mxw-id="PPAR918984267" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Aoshima, Tsutomu</last-name><address><street>c/o NEC AccessTechnica Ltd. 800 Shimomata</street><city>Kakegawa-shi Shizuoka 436-8501</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918988734" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Vossius &amp; Partner</last-name><iid>100751388</iid><address><street>Siebertstrasse 4</street><city>81675 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2012001028-W"><document-id><country>JP</country><doc-number>2012001028</doc-number><kind>W</kind><date>20120216</date><lang>JA</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012114684-A1"><document-id><country>WO</country><doc-number>2012114684</doc-number><kind>A1</kind><date>20120830</date><lang>JA</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548853914" load-source="docdb">AL</country><country mxw-id="DS548853833" load-source="docdb">AT</country><country mxw-id="DS548853915" load-source="docdb">BE</country><country mxw-id="DS548802936" load-source="docdb">BG</country><country mxw-id="DS548847896" load-source="docdb">CH</country><country mxw-id="DS548801715" load-source="docdb">CY</country><country mxw-id="DS548853838" load-source="docdb">CZ</country><country mxw-id="DS548853916" load-source="docdb">DE</country><country mxw-id="DS548801716" load-source="docdb">DK</country><country mxw-id="DS548801717" load-source="docdb">EE</country><country mxw-id="DS548848196" load-source="docdb">ES</country><country mxw-id="DS548802937" load-source="docdb">FI</country><country mxw-id="DS548802942" load-source="docdb">FR</country><country mxw-id="DS548853917" load-source="docdb">GB</country><country mxw-id="DS548801718" load-source="docdb">GR</country><country mxw-id="DS548853926" load-source="docdb">HR</country><country mxw-id="DS548853839" load-source="docdb">HU</country><country mxw-id="DS548847897" load-source="docdb">IE</country><country mxw-id="DS548801719" load-source="docdb">IS</country><country mxw-id="DS548802943" load-source="docdb">IT</country><country mxw-id="DS548801720" load-source="docdb">LI</country><country mxw-id="DS548867838" load-source="docdb">LT</country><country mxw-id="DS548837227" load-source="docdb">LU</country><country mxw-id="DS548867839" load-source="docdb">LV</country><country mxw-id="DS548867840" load-source="docdb">MC</country><country mxw-id="DS548837228" load-source="docdb">MK</country><country mxw-id="DS548837229" load-source="docdb">MT</country><country mxw-id="DS548848197" load-source="docdb">NL</country><country mxw-id="DS548802944" load-source="docdb">NO</country><country mxw-id="DS548837230" load-source="docdb">PL</country><country mxw-id="DS548847898" load-source="docdb">PT</country><country mxw-id="DS548848198" load-source="docdb">RO</country><country mxw-id="DS548847899" load-source="docdb">RS</country><country mxw-id="DS548837231" load-source="docdb">SE</country><country mxw-id="DS548853927" load-source="docdb">SI</country><country mxw-id="DS548802945" load-source="docdb">SK</country><country mxw-id="DS548837232" load-source="docdb">SM</country><country mxw-id="DS548801721" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669847" lang="EN" load-source="patent-office"><p id="pa01" num="0001">To prevent a packet including a prefix that should not be used from being forwarded. A router device 1 includes a prefix management unit 5 for creating a filtering rule including an indication of passage or block of a packet from a node 3 based on a prefix distributed from a prefix distributing device 2 and a prefix in a source IP address received from the node 3, and a filter unit 6 for passing or blocking the packet from the node according to the filtering rule created by the prefix management unit 5.<img id="iaf01" file="imgaf001.tif" wi="160" he="106" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499220" lang="EN" source="EPO" load-source="docdb"><p>To prevent a packet including a prefix that should not be used from being forwarded. A router device 1 includes a prefix management unit 5 for creating a filtering rule including an indication of passage or block of a packet from a node 3 based on a prefix distributed from a prefix distributing device 2 and a prefix in a source IP address received from the node 3, and a filter unit 6 for passing or blocking the packet from the node according to the filtering rule created by the prefix management unit 5.</p></abstract><description mxw-id="PDES63955277" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">Technical Field</heading><p id="p0001" num="0001">The present invention relates to a router device to which a prefix of an IP address is distributed by prefix delegation, and a packet control method and program based on prefix management in the router device.</p><heading id="h0002">Background Art</heading><p id="p0002" num="0002">As a method of automatically setting an IP address of a node in a communication network conforming to IPV6 (Internet Protocol Version 6), there is a method of distributing an address using DHCPv6 (Dynamic Host Configuration Protocol version 6).</p><p id="p0003" num="0003">Methods of distributing an address using DHCP6 includes a method in which a DHCP server or an upper router having a DHCP function uses RA (Router Advertisement) to distribute a prefix of an IP address to a router device (for example, see Patent Literature 1,2).</p><p id="p0004" num="0004">The router device to which a prefix is distributed redistributes the prefix to a node using RA, for example. The node communicates with the upper router using an IP address including the distributed prefix. For example, the upper router is connected to the Internet.</p><heading id="h0003">Citation List</heading><!-- EPO <DP n="2"> --><heading id="h0004">Patent Literature</heading><p id="p0005" num="0005"><ul><li>PTL 1: <patcit id="pcit0001" dnum="JP2007166097A"><text>JP 2007-166097 A</text></patcit></li><li>PTL 2: <patcit id="pcit0002" dnum="JP2007251269A"><text>JP 2007-251269 A</text></patcit></li></ul></p><heading id="h0005">Summary of Invention</heading><heading id="h0006">Technical Problem</heading><p id="p0006" num="0006"><figref idrefs="f0011">FIG. 13</figref> is a block diagram showing an example of a communication system including a home gateway (HGW) as a router device. An upper router (hereinafter referred to as "router") 200 is, for example, installed by an Internet service provider (ISP) to be accessible to the Internet 400. HGW 100 is set up on the premises to be communicable with the router 200 through a WAN (Wide Area Network) 21. The WAN 21 is, for example, a subscriber's network. The HGW 100 is communicable with one or more nodes 300 through a LAN 11 to relay communication between each node 300 and the router 200. As an example, the node 300 is a personal computer.</p><p id="p0007" num="0007">The router 200 distributes a prefix to the HGW 100 based on a DHCP-PD (Prefix Delegation) function periodically or in response to a request from the HGW 100. The HGW 100 redistributes the prefix to the node 300. The node 300 combines the prefix with its own link-local address to generate an IP address. The node 300 performs communication using the generated IP address.</p><p id="p0008" num="0008">There is an unfixed method to change prefixes to be distributed to the router 200 with time or the like as well as a fixed method not to change the prefix to be distributed to the router 200.</p><p id="p0009" num="0009">The following will consider the operation of the HGW 100<!-- EPO <DP n="3"> --> and the node 300 when the prefix distributed from the router 200 to the HGW 100 is changed. As shown in <figref idrefs="f0011">FIG. 13</figref>, suppose that a prefix as Prefix 110 is changed to Prefix 111. In this case, the HGW 100 modifies the contents of an RA packet to be sent to the node 300. In other words, the HGW 100 deletes Prefix 110 and sends the node 300 a packet indicative of the distribution of Prefix 111.</p><p id="p0010" num="0010">When the node 300 cannot receive the packet the contents of which were modified, the node 300 holds Prefix 110 as the prefix until the life time has elapsed. Under such a circumstance, the node 300 cannot communicate with the router 200 or perform communication through the Internet 400.</p><p id="p0011" num="0011">Further, there is a possibility that the HGW 100 forwards an IP address including Prefix 110 sent from the node 300, i.e. , that a false prefix is advertised.</p><p id="p0012" num="0012">It is an exemplary object of the present invention to provide a router device, and a packet control method and program based on prefix management, which can prevent forwarding of a packet including a prefix that should not be used.</p><heading id="h0007">Solution to Problem</heading><p id="p0013" num="0013">A router device according to the present invention is a router device for reassigning, to a node, a prefix assigned from a prefix assigning device to route a packet based on an IPv6 address, characterized by including: a prefix management unit for creating a filtering rule including an indication of passage or block of a packet from the node based on the prefix distributed from the prefix distributing device and a prefix in a source IP address received from the node; and a filter unit for passing or blocking the packet from the node according to<!-- EPO <DP n="4"> --> the filtering rule created by the prefix management unit.</p><p id="p0014" num="0014">A packet control method based on prefix management according to the present invention is a packet control method based on prefix management performed by a router device for redistributing, to a node, a prefix distributed from a prefix distributing device to route a packet based on an IPv6 address, characterized by including: creating a filtering rule including an indication of passage or block of a packet from the node based on the prefix distributed from the prefix distributing device and a prefix in a source IP address received from the node; and passing or blocking the packet from the node according to the created filtering rule.</p><p id="p0015" num="0015">A packet control program based on prefix management according to the present invention is a packet control program based on prefix management, which is installed in a router device for redistributing, to a node, a prefix distributed from a prefix distributing device to route a packet based on an IPv6 address, characterized by causing a computer in the router device to perform: a process to create a filtering rule including an indication of passage or block of a packet from the node based on the prefix distributed from the prefix distributing device and a prefix in a source IP address received from the node; and a process to pass or block the packet from the node according to the created filtering rule.</p><heading id="h0008">Advantageous Effects of Invention</heading><p id="p0016" num="0016">According to the present invention, forwarding of a packet including a prefix that should not be used can be prevented.</p><heading id="h0009">Brief Description of Drawings</heading><!-- EPO <DP n="5"> --><p id="p0017" num="0017"><ul><li><figref idrefs="f0001">Fig. 1</figref> It depicts a block diagram showing a first exemplary embodiment of a router device according to the present invention.</li><li><figref idrefs="f0002">Fig.2</figref> It depicts an explanatory diagram showing an example of the relationships between events that have occurred and information stored in a prefix storage unit.</li><li><figref idrefs="f0003">Fig.3</figref> It depicts an explanatory diagram showing an example of a filtering rule.</li><li><figref idrefs="f0004">Fig.4</figref> It depicts an explanatory diagram showing the format of an RA option.</li><li><figref idrefs="f0005">Fig.5</figref>. It depicts a block diagram showing a second exemplary embodiment of the router device according to the present invention.</li><li><figref idrefs="f0006">Fig.6</figref> It depicts an explanatory diagram showing an example of a filtering rule.</li><li><figref idrefs="f0007">Fig.7</figref> It depicts a block diagram showing a third exemplary embodiment of the router device according to the present invention.</li><li><figref idrefs="f0008">Fig.8</figref> It depicts an explanatory diagram showing an example of a filtering rule.</li><li><figref idrefs="f0009">Fig.9</figref> It depicts a block diagram showing a major part of a router device according to the present invention.</li><li><figref idrefs="f0009">Fig.10</figref> It depicts a block diagram showing a major part of another aspect of the router device according to the present invention.</li><li><figref idrefs="f0010">Fig. 11</figref> It depicts a block diagram showing a major part of still another aspect of the router device according to the present invention.</li><li><figref idrefs="f0010">Fig.12</figref> It depicts a flowchart showing the operation of a router device according to the present invention.</li><li><figref idrefs="f0011">Fig.13</figref> It depicts a block diagram showing an example of a communication system including a home gateway as a router device.</li></ul><!-- EPO <DP n="6"> --></p><heading id="h0010">Description of Embodiments</heading><p id="p0018" num="0018">Exemplary embodiments of the present invention will now be described with reference to the accompanying drawings.</p><heading id="h0011">Exemplary Embodiment 1</heading><p id="p0019" num="0019"><figref idrefs="f0001">FIG. 1</figref> is a block diagram showing a first exemplary embodiment of a router device according to the present invention. <figref idrefs="f0001">FIG. 1</figref> shows HGW 101 as an example of the router device. The configuration of a communication system including the HGW 101 may be the same as that in the example shown in <figref idrefs="f0011">FIG. 13</figref>.</p><p id="p0020" num="0020">The HGW 101 includes a LAN interface unit 110 connected to LAN 11, an IPv6 unit (LAN-side IPv6 unit) 111 for sending and receiving IPv6 packets through the LAN 11, an IPv6 unit (WAN-side IPv6 unit) 112 for sending and receiving IPv6 packets through WAN 21, an IPv6 routing unit 120 for performing routing control on IPv6 packets, a filter unit 130 for controlling passage/block of data, a DHCPv6 client unit 140 having a DHCPv6 client function, an IPv6 host unit 150 having an IPv6 function such as DNS (Domain Name System) or the like, a prefix management unit 160 for managing prefixes, a prefix storage unit 170 for storing prefix information, and a WAN interface unit 180 connected to the WAN 21.</p><p id="p0021" num="0021">The HGW 101 may also have an IPv4 function for realizing IPv4 communications in addition to the IPv6 function.</p><p id="p0022" num="0022">The LAN interface unit 110 is connected to a home network (LAN 11) to receive, through the LAN 11, each of packets whose address in the Layer 2 header is an address on the LAN 11 side or a multicast address. Further, the LAN interface unit 110 sends packets output by the IPv6 unit 111 to the LAN 11.<!-- EPO <DP n="7"> --></p><p id="p0023" num="0023">The WAN interface unit 180 is connected to a router 200 (see <figref idrefs="f0011">FIG. 13</figref>) through a subscriber network (WAN 21). The WAN interface unit 180 receives, through the WAN 21, each of packets whose address in the Layer 2 header is an address on the LAN 11 side or a multicast address. Further, the WAN interface unit 180 sends packets output by the IPv6 unit 112 to the WAN 21.</p><p id="p0024" num="0024">The IPv6 unit 111 outputs packets received by the LAN interface unit 110 to the IPv6 routing unit 120. The IPv6 unit 111 outputs, to the LAN interface unit 110, packets output by the IPv6 routing unit 120.</p><p id="p0025" num="0025">The IPv6 unit 112 outputs, to the filter unit 130, IPv6 packets received by the WAN interface unit 180. The IPv6 unit 112 outputs, to the WAN interface unit 180, packets output by the filter unit 130.</p><p id="p0026" num="0026">The IPv6 routing unit 120 inputs packets from the IPv6 unit 111, the filter unit 130, the IPv6 host unit 150, and the DHCPv6 client unit 140. Based on a destination IPv46 address of each packet, a port number, and received interface information, the IPv6 routing unit 120 identifies a block in the HGW 101 in which the input packet should be processed. The IPv6 routing unit 120 outputs the packet into the identified block.</p><p id="p0027" num="0027">The DHCPv6 client unit 140 has a DHCPv6 client function. The DHCPv6 client unit 140 exchanges DHCPv6 messages with the router 200 (see <figref idrefs="f0011">FIG. 13</figref>) through the IPv6 routing unit 120 and the WAN 21. The DHCPv6 client unit 140 extracts prefix information included in a DHCP-PD option in a DHCP Reply message, and outputs the prefix information to the prefix management unit 160.<!-- EPO <DP n="8"> --></p><p id="p0028" num="0028">Based on the prefix information input from the DHCPv6 client unit 140, the prefix management unit 160 decides on prefix information to be informed to the LAN 11 side. The prefix management unit 160 outputs the decided prefix information into the prefix storage unit 170.</p><p id="p0029" num="0029">The prefix storage unit 170 stores the prefix information. Together with the prefix information, the prefix storage unit 170 also stores a delete flag notified from the prefix management unit 160. The delete flag indicates prefix information to be deleted. For example, a delete flag of "1" indicates prefix information to be deleted. A delete flag of "0" indicates available prefix information. In response to a request from the IPv6 host unit 150, the prefix storage unit 170 supplies a stored pair of prefix information and a delete flag to the IPv6 host unit 150.</p><p id="p0030" num="0030">The process for prefix management unit 160 to decide on prefix information to be notified to the LAN 11 side is as follows:</p><p id="p0031" num="0031">First, the HGW 101 multicasts a Solicit message to the router 200 (see <figref idrefs="f0011">FIG. 13</figref>). Upon receipt of the Solicit message, the router 200 sends an Advertise message to the HGW 101. Upon receipt of the Advertise message, the HGW 101 sends a Request message to the router 200. Upon receipt of the Request message, the router 200 sends a Reply message to the HGW 101.</p><p id="p0032" num="0032">In the HGW 101, the DHCPv6 client unit 140 acquires "Prefix," "Preferred Lifetime," and "Valid Lifetime" from information set in "Identity Association for Prefix Delegation" as an option of the DHCP Reply message. The DHCPv6 client unit 140 supplies these pieces of information to the prefix<!-- EPO <DP n="9"> --> management unit 160. Based on these pieces of information, the prefix management unit 160 decides on prefix information to be notified to the LAN 11 side.</p><p id="p0033" num="0033">When the contents of the option in the DHCP Reply message are modified, i.e., when the prefix information is modified, the prefix management unit 160 also decides on prefix information to be notified to the LAN 11 side, and outputs the decided prefix information into the prefix storage unit 170. Further, when the source address of a discarded packet is output from the filter unit 130, the prefix management unit 160 outputs information indicative of a prefix included in the source address into the prefix storage unit 170. In this exemplary embodiment, it is assumed that the prefix length is 64 bits.</p><p id="p0034" num="0034">The prefix management unit 160 includes a prefix control unit 161. The prefix control unit 161 decides on a value of the delete flag (0 or 1) corresponding to the prefix information decided by the prefix management unit 160. When outputting the prefix information into the prefix storage unit 170, the prefix management unit 160 also outputs the delete flag corresponding to the prefix information.</p><p id="p0035" num="0035">Further, the prefix control unit 161 creates a filtering rule based on the prefix informati.on decided by the prefix management unit 160. The prefix management unit 160 outputs, to the filter unit 130, the filtering rule created by the prefix control unit 161.</p><p id="p0036" num="0036">The filter unit 130 memorizes the filtering rule. Then, when the LAN interface unit 110 receives a packet, the filter unit 130 performs a process according to the filtering rule. Specifically, the filter unit 130 outputs, to the IPv6 unit 112, a packet that does not suit the filtering rule. The filter unit<!-- EPO <DP n="10"> --> 130 discards a packet that suits the filtering rule. In this case, the filter unit 130 outputs the source address of the discarded packet to the prefix management unit 160. The filter unit 130 does not perform, on a packet from the WAN 21 side, the process according to the filtering rule.</p><p id="p0037" num="0037">The IPv6 host unit 150 includes an ICMPv6 unit 151 for realizing ICMP (Internet Control Message Protocol) v6 as part of IPv6. The ICMPv6 unit 151 generates ICMPv6 packets, exchanges the ICMPv6 packets, and performs a process relating to the ICMPv6 packets. Note that a portion for realizing IPv6 other than ICMP is omitted in <figref idrefs="f0001">FIG. 1</figref>.</p><p id="p0038" num="0038">Specifically, the ICMPv6 unit 151 inputs an ICMPv6 packet from the IPv6 routing unit 120, performs a process according to an option specified in the ICMPv6 packet, and sends the ICMPv6 packet back to the IPv6 routing unit 120. Further, the ICMPv6 unit 151 periodically acquires prefix information stored in the prefix storage unit 170. The ICMPv6 unit 151 creates option information (option) from the prefix information. The ICMPv6 unit 151 adds the created option to RA for the ICMPv6 packet. The ICMPv6 unit 151 outputs, to the IPv6 routing unit 120, the ICMPv6 packet with an option added thereto. When adding an option, indicative of deletion of a prefix that should not be forwarded, to the RA for the ICMPv6 packet, the ICMPv6 unit 151 notifies the prefix storage unit 170 of the deletion of the prefix.</p><p id="p0039" num="0039">Next, the operation of the first exemplary embodiment of the router device will be described with reference to explanatory diagrams of <figref idrefs="f0002 f0003 f0004">FIG. 2 to FIG. 4</figref>. <figref idrefs="f0002">FIG. 2</figref> is an explanatory diagram showing an example of the relationships between events that have occurred and information stored in the prefix storage unit. <figref idrefs="f0003">FIG. 3</figref> is an explanatory diagram showing<!-- EPO <DP n="11"> --> an example of a filtering rule. <figref idrefs="f0004">FIG. 4</figref> is an explanatory diagram showing the format of an RA option.</p><p id="p0040" num="0040">First, an operation when a prefix is distributed to a node connected to the LAN 11 will be described. Note that the node, not shown in <figref idrefs="f0001">FIG. 1</figref>, is a device corresponding to the node 300 shown in <figref idrefs="f0011">FIG. 13</figref>.</p><p id="p0041" num="0041">The router 200 (see <figref idrefs="f0011">FIG. 13</figref>) on the WAN 21 side sends the HGW 101 prefix information, a next hop address, and a DNS address. The HGW 101 sends the received prefix information to the node connected to the LAN 11.</p><p id="p0042" num="0042">The router 200 uses DHCPv6 to distribute prefix information to the HGW 101. The HGW 101 uses DHCPv6 to send prefix information to a node.</p><p id="p0043" num="0043">In the HGW 101, the DHCPv6 client unit 140 outputs, to the prefix management unit 160, prefix information notified by DHCPv6-PD. It is assumed that the prefix specified in the information notified by DHCPv6-PD is "Prefix 110."</p><p id="p0044" num="0044">The prefix management unit 160 outputs, into the prefix storage unit 170, "Prefix 110" and a delete flag set to "0" based on the received prefix information. As shown in a line saying "Prefix 110 is Notified from Router on WAN Side" in <figref idrefs="f0002">FIG. 2</figref>, the prefix storage unit 170 stores "Prefix 110" and the delete flag the value of which is "0."</p><p id="p0045" num="0045">Further, when prefix information is input, the prefix control unit 161 creates a filtering rule (see <figref idrefs="f0003">FIG. 3</figref>). The prefix management unit 160 outputs the created filtering rule to the filter unit 130. The filter unit 130 memorizes the filtering rule. If two or more pieces of prefix information<!-- EPO <DP n="12"> --> are received, the prefix control unit 161 creates a filtering rule and a delete flag corresponding to each of the prefix information, respectively. The prefix management unit 160 outputs two or more sets of filtering rules and delete flags to the filter unit 130.</p><p id="p0046" num="0046">The ICMPv6 unit 151 periodically acquires prefix information stored in the prefix storage unit 170. In the example shown in <figref idrefs="f0002">FIG. 2</figref>, only "Prefix 110" is stored in the prefix storage unit 170 as prefix information (see the line saying "Prefix 110 is Notified from Router on WAN Side") . The ICMPv6 unit 151 adds "Prefix 110" to an option of a RA packet. The ICMPv6 unit 151 outputs, to the IPv6 routing unit 120, the RA packet with the option added thereto. The IPv6 routing unit 120 outputs the RA packet to the IPv6 unit 111. The RA packet is sent to the node through the LAN interface unit 110 and the LAN 11.</p><p id="p0047" num="0047">After that, the node uses "Prefix 110" added to the option of the received RA packet to perform a process for automatically generating a stateless address in order to generate an IP address. The node uses the generated IP address to communicate with the node 200 (see <figref idrefs="f0011">FIG. 13</figref>) and other devices through the Internet 400.</p><p id="p0048" num="0048">When the filtering rule illustrated in <figref idrefs="f0003">FIG. 3</figref> is used, if the prefix of the source address (SrcIP address) of each IPv6 packet headed from the LAN 11 side toward the WAN 21 side is not the prefix ("Prefix 110" in this example) distributed to the node, the IPv6 packet is discarded. In the example shown in <figref idrefs="f0003">FIG. 3</figref>, information indicating that the source address is notified to the prefix management unit 160 when the packet is discarded is added to the filtering rule. Also indicated in the filtering rule is that the destination address (DstIP<!-- EPO <DP n="13"> --> address) is unquestioned.</p><p id="p0049" num="0049">Next, the operation of the router device when a prefix is changed will be described. Suppose that the router 200 changes the prefix from "Prefix 110" to "Prefix 111."' In this case, the router 200 notifies the HGW 101 of "Prefix 111" as a new prefix by DHCPv6-PD.</p><p id="p0050" num="0050">In the HGW 101, the DHCPv6 client unit 140 outputs, to the prefix management unit 160, prefix information notified by DHCPv6-PD. The prefix specified in the information notified by DHCPv6-PD is "Prefix 111."</p><p id="p0051" num="0051">In the prefix management unit 160, the prefix control unit 161 outputs, into the prefix storage unit 170, an instruction for setting, to "1," the value of the delete flag corresponding to "Prefix 110" as the prefix before being changed to "Prefix 111." The prefix control unit 161 also outputs, into the prefix storage unit 170, "Prefix 111" and a delete flag set to "0" based on the received prefix information. As shown in a line saying "Router on WAN Side Has Changed Prefix" in <figref idrefs="f0002">FIG. 2</figref>, the prefix storage unit 170 sets the value of the delete flag corresponding to "Prefix 110" to "1," and stores "Prefix 111" and a delete flag the value of which is "0."</p><p id="p0052" num="0052">When prefix information as "Prefix 111" is received, the prefix control unit 161 creates a filtering rule. The prefix management unit 160 issues a command to the filter unit 130 to delete the filtering rule. In this example, the target of the delete command is the filtering rule relating to "Prefix 110." The prefix management unit 160 outputs, to the filter unit 130, a new filtering rule created. The filter unit 130 memorizes the new filtering rule. The filtering rule memorized by the filter unit 130 is represented as the filtering rule illustrated<!-- EPO <DP n="14"> --> in <figref idrefs="f0003">FIG. 3</figref>, but at this stage, "IP address Including Prefix that is not Distributed from HGW 101 to Node" is an IP address including a prefix other than "Prefix 111."</p><p id="p0053" num="0053">The ICMPv6 unit 151 periodically acquires prefix information stored in the prefix storage unit 170. When the line saying "Prefix 110 is Notified from Router on WAN Side" is valid (see <figref idrefs="f0002">FIG. 2</figref>), "Prefix 110" and "Prefix 111" are stored in the prefix storage unit 170 as prefix information. In this case, the value of the delete flag corresponding to "Prefix 111" is "0" and the value of the delete flag corresponding to "Prefix 111" is "1." Therefore, the ICMPv6 unit 151 adds, to the option of an RA packet, data indicative of deletion of "Prefix 110" and data indicative of distribution of "Prefix 111." The ICMPv6 unit 151 outputs, to the IPv6 routing unit 120, the RA packet with the option added thereto. The IPv6 routing unit 120 outputs the RA packet to the IPv6 unit 111. The RA packet is sent to the node through the LAN interface unit 110 and the LAN 11.</p><p id="p0054" num="0054">The ICMPv6 unit 151 also notifies the prefix storage unit 170 that the RA packet with the data indicative of deletion of "Prefix 110" and the data indicative of distribution of "Prefix 111" added thereto has been sent.</p><p id="p0055" num="0055">Upon receipt of the notification, the prefix storage unit 170 deletes information on "Prefix 110." As a result, as shown in a line saying "After RA Transmission" in <figref idrefs="f0002">FIG. 2</figref>, only "Prefix 111" is stored as prefix information.</p><p id="p0056" num="0056">If the arrival of packets is not guaranteed such as when the LAN 11 is the Ethernet (registered trademark), the node may not be able to receive such a packet to include the option indicative of deletion of "Prefix 110." When the node cannot<!-- EPO <DP n="15"> --> receive the packet including the option indicative of deletion of "Prefix 110," "Prefix 110" remains held as the prefix. Therefore, the node uses "Prefix 110" the use of which should be prohibited to communicate with the HGW 101, the router 200, and the Internet 400.</p><p id="p0057" num="0057">When the HGW 101 is rebooted, the node may also perform communication using the prefix the use of which should be prohibited. At the time when the HGW 101 is rebooted after the HGW 101 distributes "Prefix 110" to the node and "Prefix 111" is sent as the prefix from the router 200 after reboot, the router 200 and the HGW 101 recognize that the prefix is "Prefix 111." However, "Prefix 110" is held at the node. In such a situation, the node sends, as the prefix, "Prefix 110" that should not be sent.</p><p id="p0058" num="0058">Next, the operation of the HGW 101 when the node sends a prefix that should not be sent will be described by taking, as an example, a case where the node recognizes that the prefix is "Prefix 110" and the HGW 101 recognizes that the prefix is "Prefix 111." In other words, the prefix storage unit 170 holds "Prefix 111" and a corresponding delete flag of "0."</p><p id="p0059" num="0059">The HGW 101 receives a packet sent from the node through the LAN 11. In the HGW 101, the packet is passed through the LAN interface unit 110, the IPv6 unit 111, and the IPv6 routing unit 120. Then, the filter unit 130 inputs the packet. The prefix of a source address set in the packet is "Prefix 110." The filter unit 130 remembers a filtering rule indicating that "Prefix 111" is a prefix distributed by the HGW 101. Since the prefix of the source address is different from "Prefix 111," this filtering rule is suited.</p><p id="p0060" num="0060">Therefore, the filter unit 130 discards the input packet.<!-- EPO <DP n="16"> --> The filter unit 130 also notifies the prefix management unit 160 of the source address set in the packet.</p><p id="p0061" num="0061">The prefix management unit 160 can acquire the prefix from the source address. In this exemplary embodiment, since the prefix length is 64 bits, the prefix management unit 160 extracts data on the first 64 bits of the source address, and recognizes the extracted data as a prefix.</p><p id="p0062" num="0062">In this example, the source address set in the packet is "Prefix 110." Since "Prefix 110" is a prefix that should not be used, the prefix control unit 161 creates a delete flag the value of which is "1." The prefix management unit 160 outputs, into the prefix storage unit 170, "Prefix 110" and the delete flag created by the prefix control unit 161. The prefix storage unit 170 stores "Prefix 110" and the delete flag the value of which is "1."</p><p id="p0063" num="0063">According to the above-mentioned procedure, the value of the delete flag corresponding to "Prefix 110" is set to "1" as shown in the line saying ""route on WAN Side Has Changed Prefix" in <figref idrefs="f0002">FIG. 2</figref>, and "prefix 111" and the delete flag the value of which is "0" are stored as prefix information.</p><p id="p0064" num="0064">The ICMPv6 unit 151 periodically acquires prefix information stored in the prefix storage unit 170. The ICMPv6 unit 151 creates an option from the prefix information. The ICMPv6 unit 151 adds the created option to RA for the ICMPv6 packet.</p><p id="p0065" num="0065"><figref idrefs="f0004">FIG. 4</figref> is an explanatory diagram showing the format of an RA option. In the option, the ICMPv6 unit 151 sets "3" in "Type," "4" in "Data Length," and "64 bits" in "Prefix Length." Note that "L" indicates the same link flag, and "A" indicates<!-- EPO <DP n="17"> --> an address setting flag.</p><p id="p0066" num="0066">The ICMPv6 unit 151 also sets "0" in "Valid Lifetime" and "0" in "Preferred Lifetime." Further, the ICMPv6 unit 151 sets a prefix to be deleted ("Prefix 110" in this example) in "Prefix."</p><p id="p0067" num="0067">In general, the router device periodically sends nodes an RA packet with valid terms set for the "Valid Lifetime" and "referred Lifetime" of the distributed prefix to update the valid lifetime of the prefix.</p><p id="p0068" num="0068">In this exemplary embodiment, since the delete flag is also stored in the prefix storage unit 170, the ICMPv6 unit 151 can easily determine whether the prefix stored in the prefix storage unit 170 is usable.</p><p id="p0069" num="0069">As mentioned above, the ICMPv6 unit 151 periodically acquires prefix information stored in the prefix storage unit 170. Based on the acquired prefix information, the ICMPv6 unit 151 creates and sends an RA packet to the node. Through a checking operation using an RA packet periodically sent, the HGW 101 distributes or updates (specifically, deletes) a prefix. Specifically, in this exemplary embodiment, the ICMPv6 unit 151 creates an option to delete "Prefix 110" to be deleted, and an option to distribute "Prefix 111." Then, the IPv6 host unit 150 outputs, to the IPv6 routing unit 120, an RA packet with the option created by the ICMPv6 unit 151 added thereto.</p><p id="p0070" num="0070">The RA packet is routed by the IPv6 routing unit 120, and sent to the node through the IPv6 unit 111, the LAN interface unit 110, and the LAN 11. Based on the RA packet received, the node recognizes that "Prefix 110" is not usable and "Prefix 111" should be used.<!-- EPO <DP n="18"> --></p><p id="p0071" num="0071">After that, the node uses "Prefix 111" added to the option of the received RA packet to perform a process for automatically generating a stateless address in order to generate an IP address. The node uses the generated IP address to perform communication through the node 200 (see <figref idrefs="f0011">FIG. 13</figref>) and the Internet 400.</p><p id="p0072" num="0072">Through the above-mentioned procedure, the node can invalidate "Prefix 110" held. In other words, the node receiving an RA packet including option information capable of identifying a prefix to be deleted (unusable prefix) deletes the prefix identified.</p><p id="p0073" num="0073">As described above, in this exemplary embodiment, the HGW 101 can use the option of the RA packet to invalidate the prefix that should not be sent to the node. Specifically, the HGW 101 sends an RA packet for "Prefix 110" not to be sent, in which "Valid Lifetime" and "Preferred Lifetime" in the option are set to "0."</p><p id="p0074" num="0074">Further, since the HGW 101 discards packets from nodes including any prefix that is not notified from the router 200 (see <figref idrefs="f0011">FIG. 13</figref>), such a situation in which packets including a common source address are sent from multiple nodes to the router 200 can be avoided.</p><p id="p0075" num="0075">In general, after a new prefix (e.g., "Prefix 111") is distributed to the HGW 101 based on the DHCP-PD function, the router 200 can distribute the old prefix (e.g. "Prefix 110") to any other router device. If the old prefix is used by a node connected to the HGW 101 through the LAN 11 after the old prefix is distributed to any other router device, packets including a common source address will be sent from multiple nodes to the<!-- EPO <DP n="19"> --> router 200.</p><p id="p0076" num="0076">However, in the case of the use of the HGW 101 in this exemplary embodiment, such a situation that the packets including the common source address are sent to the router 200 from the multiple nodes to the router 200 can be avoided.</p><p id="p0077" num="0077">In this exemplary embodiment, the HGW 101 compares a source IP address included in each packet received from each node with a prefix sent from the upper router 200 to determine whether the packet received from the node is a packet to be forwarded. When determining that the packet received from the node should not be forwarded, the HGW 101 discards the packet. This prevents any packet including a source IP address based on an unusable prefix from being sent to the Internet.</p><p id="p0078" num="0078">Further, the HGW 101 sends the node an RA packet including an instruction for deletion of an unusable prefix and option information indicative of the new prefix notified from the node 200. The node receiving such an RA packet can delete the unusable prefix and use the new prefix to make a quick transition to a state of being communicable with the router 200 and other devices through the Internet.</p><heading id="h0012">Exemplary Embodiment 2</heading><p id="p0079" num="0079"><figref idrefs="f0005">FIG. 5</figref> is a block diagram showing a second exemplary embodiment of the router device according to the present invention. <figref idrefs="f0005">FIG. 5</figref> shows HGW 102 as an example of the router device. The configuration of a communication system including the HGW 102 may be the same as that in the example shown in <figref idrefs="f0011">FIG. 13</figref>.</p><p id="p0080" num="0080">In the HGW 101 according to the first exemplary embodiment shown in <figref idrefs="f0001">FIG. 1</figref>, the filter unit 130 is arranged<!-- EPO <DP n="20"> --> between the IPv6 routing unit 120 and the IPv6 unit 112. On the other hand, in this exemplary embodiment, the filter unit 130 is arranged between the IPv6 unit 111 and the IPv6 routing unit 120 as shown in <figref idrefs="f0005">FIG. 5</figref>.</p><p id="p0081" num="0081">Processing performed by each block in the HGW 102 is the same as that performed by each block in the HGW 101.</p><p id="p0082" num="0082"><figref idrefs="f0006">FIG. 6</figref> is an explanatory diagram showing an example of a filtering rule. In this exemplary embodiment, it is assumed that, after the node 200 (see <figref idrefs="f0011">FIG. 13</figref>) distributes "Prefix 110" to the HGW 102 based on the DHCP-PD function, the node 200 changes the prefix to"Prefix 111." Therefore, the ICMPv6 unit 151 notifies the prefix storage unit 170 that an RA packet, to which data indicative of deletion of "Prefix 110" and data indicative of distribution of "Prefix 111" are added, has been sent. As shown in the line saying "After RA Transmission" in <figref idrefs="f0002">FIG. 2</figref>, the prefix storage unit 170 stores prefix information in which "Prefix 110" is deleted and only "Prefix 111" is set.</p><p id="p0083" num="0083">As an example, the following will take a case where the HGW 102 recognizes that the prefix is "Prefix 111" but the node recognizes that the prefix is "Prefix 110" because it was not be able to receive a packet including an option indicative of deletion of "Prefix 110."</p><p id="p0084" num="0084">Further, in the first exemplary embodiment, a prefix headed from the IPv6 routing unit 120 toward the IPv6 unit 112 is controlled as shown in <figref idrefs="f0003">FIG. 3</figref>, while in this exemplary embodiment, a prefix headed from the IPv6 unit 111 toward the IPv6 routing unit 120 is controlled as shown in <figref idrefs="f0006">FIG. 6</figref>.</p><p id="p0085" num="0085">Next, the operation of the HGW 102 will be described.</p><p id="p0086" num="0086"><!-- EPO <DP n="21"> --> In the HGW 102, a packet sent from a node through the LAN 11 is input into the filter unit 130 via the LAN interface unit 110 and the IPv6 unit 111. In the first exemplary embodiment, the packet is input from the IPv6 unit 111 to the IPv6 routing unit 120. On the other hand, in this exemplary embodiment, since the filter unit 130 is located upstream of (on the LAN side of) the IPv6 routing unit 120, the filtering process is performed before the routing process.</p><p id="p0087" num="0087">In this example, the prefix in the IP address from the node is "Prefix 110." As a result, the filtering rule is suited. Therefore, the filter unit 130 discards the packet. Further, the filter unit 130 notifies the prefix management unit 160 of a source address set in the packet.</p><p id="p0088" num="0088">The prefix management unit 160 analyzes the source address. The prefix management unit 160 recognizes "Prefix 110" from the source address. Since "Prefix 110" is a prefix that should not be used, the prefix control unit 161 creates a delete flag the value of which is "1" in the same manner as in the first exemplary embodiment. The prefix management unit 160 output, into the prefix storage unit 170, "Prefix" 110" and the delete flag created by the prefix control unit 161. The prefix storage unit 170 stores "Prefix 110" and the delete flag the value of which is "1."</p><p id="p0089" num="0089">The ICMPv6 unit 151 periodically acquires prefix information stored in the prefix storage unit 170. The ICMPv6 unit 151 creates option information (option) from the prefix information. The ICMPv6 unit 151 adds the created option to RA the ICMPv6 packet.</p><p id="p0090" num="0090">The RA packet is routed by the IPv6 routing unit 120, and sent to the node through the filter unit 130, the IPv6 unit<!-- EPO <DP n="22"> --> 111, the LAN interface unit 110, and the LAN 11. Based on the received RA packet, the node recognizes that "Prefix 110" is unusable and "Prefix 111" should be used.</p><p id="p0091" num="0091">In the first exemplary embodiment, since the filter unit 130 is located downstream of (on the WAN side of) the IPv6 routing unit 120, packets input from the node are routed once. Then, the filter unit 130 performs filtering on only packets headed toward the WAN side. On the other hand, in this exemplary embodiment, since the filter unit 130 is located upstream of the IPv6 routing unit 120, the filtering process is performed before the routing process. Thus, the filter unit 130 can perform filtering on even packets routed within the LAN. In addition to the effects of the first exemplary embodiment, this exemplary embodiment can achieve not only such an effect that forwarding of packets can be prohibited based on the packets routed within the LAN, but also such an effect that an RA packet for updating the prefix can be sent.</p><heading id="h0013">Exemplary Embodiment 3</heading><p id="p0092" num="0092"><figref idrefs="f0007">FIG. 7</figref> is a block diagram showing a third exemplary embodiment of the router device according to the present invention. <figref idrefs="f0007">FIG. 7</figref> shows HGW 103 as an example of the router device. The configuration of a communication system including the HGW 103 may be the same as that in the example shown in <figref idrefs="f0011">FIG. 13</figref>.</p><p id="p0093" num="0093">Processing performed by each block in the HGW 103 is the same as that performed by each block in the HGW 101, 102.</p><p id="p0094" num="0094">In the first exemplary embodiment and the second exemplary embodiment, the HGW 101, 102 is such that the ICMPv6 unit 151 in the IPv6 host unit 150 periodically acquires prefix information stored in the prefix storage unit 170. Then, based<!-- EPO <DP n="23"> --> on the acquired prefix information, the ICMPv6 unit 151 creates and sends an RA packet to the node. In other words, the HGW 101, 102 makes confirmations using the RA packet sent periodically to distribute a prefix and update (specifically, delete) the prefix.</p><p id="p0095" num="0095">In this exemplary embodiment, upon receipt of a prefix deletion notification from the node 200 (see <figref idrefs="f0011">FIG. 13</figref>), the IPv6 host unit 150 immediately performs processing for causing the node to delete the prefix.</p><p id="p0096" num="0096">The following will describe the operation of the HGW 103.</p><p id="p0097" num="0097">In this exemplary embodiment, it is assumed that, after the node 200 (see <figref idrefs="f0011">FIG. 13</figref>) distributes "Prefix 110" to the HGW 103 based on the DHCP-PD function, the node 200 changes the prefix to "Prefix 111." Therefore, the ICMPv6 unit 151 notifies the prefix storage unit 170 that an RA packet, to which data indicative of deletion of "Prefix 110" and data indicative of distribution of "Prefix 111" are added, has been sent. As shown in the line saying "After RA Transmission" in <figref idrefs="f0002">FIG. 2</figref>, the prefix storage unit 170 stores prefix information in which "Prefix 110" is deleted and only "Prefix 111" is set.</p><p id="p0098" num="0098">As an example, the following will take a case where the HGW 103 recognizes that the prefix is "Prefix 111" but the node recognizes that the prefix is "Prefix 110" because it was not be able to receive a packet including an option indicative of deletion of "Prefix 110."</p><p id="p0099" num="0099">The prefix in the IP address from the node is "Prefix 110." As a result, the filtering rule is suited. Therefore, the filter unit 130 discards the packet. Further, the filter unit 130 notifies the prefix management unit 160 of a source<!-- EPO <DP n="24"> --> address set in the packet.</p><p id="p0100" num="0100">The prefix management unit 160 analyzes the source address. The prefix management unit 160 recognizes "Prefix 110" from the source address. When "Prefix 110" is recognized from the source address, the prefix control unit 161 creates a filtering rule. The prefix management unit 160 outputs the created filtering rule to the filter unit 130. The filter unit 130 memorizes the filtering rule.</p><p id="p0101" num="0101"><figref idrefs="f0008">FIG. 8</figref> is an explanatory diagram showing an example of a filtering rule in this exemplary embodiment. In this exemplary embodiment, as shown in <figref idrefs="f0008">FIG. 8</figref>, the prefix management unit 160 creates a filtering rule with a rule for the prefix ("Prefix 110" in this example) included in the packet discarded by the filter unit 130 added thereto (see the second line in <figref idrefs="f0008">FIG. 8</figref>).</p><p id="p0102" num="0102">After that, the filter unit 130 performs filtering according to the filtering rule. When a packet that meets the rule set in the second line of <figref idrefs="f0008">FIG. 8</figref> is received, the filter unit 130 discards the packet. The filter unit 130 notifies the prefix management unit 160 that the packet has been discarded.</p><p id="p0103" num="0103">In the prefix management unit 160, the prefix control unit 161 creates a delete flag the value of which is "1." The prefix management unit 160 outputs, into the prefix storage unit 170, "Prefix 110" and the delete flag created by the prefix control unit 161. The prefix storage unit 170 stores "Prefix 110" and the delete flag the value of which is "1." In other words, as shown in the line saying "Router on WAN Side Has Changed Prefix" in <figref idrefs="f0002">FIG. 2</figref>, the prefix storage unit 170 sets the value of the delete flag corresponding to "Prefix 110" to "1," and stores "Prefix 111" and the delete flag the value of which is<!-- EPO <DP n="25"> --> "0."</p><p id="p0104" num="0104">Further, when notified that the packet has been discarded, the prefix management unit 160 outputs a delete command to the ICMPv6 unit 151.</p><p id="p0105" num="0105">When the delete command is input, the ICMPv6 unit 151 immediately acquires prefix information stored in the prefix storage unit 170. The ICMPv6 unit 151 creates option information (option) from the prefix information. Specifically, the ICMPv6 unit 151 sets, in the option of RA, the prefix ("Prefix 110" in this example) corresponding to the delete flag the value of which is "1" in the prefix information. The ICMPv6 unit 151 adds the created option to RA for the ICMPv6 packet.</p><p id="p0106" num="0106">The RA packet is routed by the IPv6 routing unit 120, and sent to the node through the IPv6 unit 111, the LAN interface unit 110, and the LAN 11. Based on the received RA packet, the node recognizes that "Prefix 110" is unusable.</p><p id="p0107" num="0107">In this exemplary embodiment, when the prefix management unit 160 outputs the delete command, the ICMPv6 unit 151 immediately checks on prefix information stored in the prefix storage unit 170. Thus, an unusable prefix is transmitted faster than the case where the ICMPv6 unit 151 periodically checks on prefix information stored in the prefix storage unit 170. In addition to the effects of the first exemplary embodiment, this exemplary embodiment can achieve such an effect that the node can set itself promptly not to use an unusable prefix.</p><p id="p0108" num="0108">Note that the HGW 103 shown in <figref idrefs="f0007">FIG. 7</figref> is based on the HGW 101 shown in <figref idrefs="f0001">FIG. 1</figref>, but the HGW 103 may also be based on the<!-- EPO <DP n="26"> --> HGW 102 in which the filter unit 130 is arranged between the IPv6 unit 111 and IPv6 routing unit 120 as shown in <figref idrefs="f0005">FIG. 5</figref>.</p><p id="p0109" num="0109">Further, in the HGW 101, 102, 103, the functions of blocks other than the LAN interface unit 110 and the WAN interface unit 180 can be implemented by a CPU and a memory to perform control according to a program.</p><p id="p0110" num="0110">In each of the aforementioned exemplary embodiments, HGW is taken as an example of the router device, but the router device to which the present invention is applicable is not limited to</p><heading id="h0014">HGW.</heading><p id="p0111" num="0111"><figref idrefs="f0009">FIG. 9</figref> is a block diagram showing a major part of a router device according to the present invention. As shown in <figref idrefs="f0009">FIG. 9</figref>, a router device 1 includes a prefix management unit 5 (as an example, the prefix management unit 160 shown in <figref idrefs="f0001">FIG. 1</figref>, <figref idrefs="f0005">FIG. 5</figref>, and <figref idrefs="f0007">FIG. 7</figref>, respectively) for creating a filtering rule including an indication of the passage or block of a packet from a node 3 based on a prefix distributed from a prefix distributing device 2 (as an example, the router 200 shown in <figref idrefs="f0011">FIG. 13</figref>) and a prefix in a source IP address received from the node 3 (as an example, the node 300 shown in <figref idrefs="f0011">FIG. 13</figref>), and a filter unit 6 (as an example, the filter unit 130 shown in <figref idrefs="f0001">FIG. 1</figref>, <figref idrefs="f0005">FIG. 5</figref>, and <figref idrefs="f0007">FIG. 7</figref>, respectively) for passing or blocking the packet from the node according to the filtering rule created by the prefix management unit 5.</p><p id="p0112" num="0112">In each of the aforementioned exemplary embodiments, the following router devices are also disclosed:</p><p id="p0113" num="0113"><ul><li>(1) The router device in which, when a received packet meets the indication of blocking the packet in the filtering rule, the filter unit 6 discards the packet and notifies the<!-- EPO <DP n="27"> --> prefix management unit 5 of the source IP address of the discarded packet, and the prefix management unit 5 determines that a prefix included in the notified source IP address is a prefix unusable and to be deleted.</li></ul></p><p id="p0114" num="0114"><ul><li>(2) The router device as shown in <figref idrefs="f0009">FIG. 10</figref>, which further includes a prefix storage unit 7 (as an example, the prefix storage unit 170 shown in <figref idrefs="f0001">FIG. 1</figref>, <figref idrefs="f0005">FIG. 5</figref>, and <figref idrefs="f0007">FIG. 7</figref>, respectively) for storing a prefix together with discriminative data (as an example, delete indicative data) used to determine whether the prefix is usable.</li></ul></p><p id="p0115" num="0115"><ul><li>(3) The router device as shown in <figref idrefs="f0010">FIG. 11</figref>, which further includes an RA sending unit 8 for periodically checking on the contents stored in the prefix storage unit 7, creating option information on an RA packet capable of identifying whether a prefix is usable or unusable based on the prefix and the discriminative data stored in the prefix storage unit 7, and sending a node an RA packet including the created option information.</li></ul></p><p id="p0116" num="0116"><ul><li>(4) The router device in which when the filter unit 6 discards the packet, the RA sending unit 8 immediately sends the node 3 an RA packet including option information capable of identifying that the prefix included in the source IP address of the packet is unusable.</li></ul></p><p id="p0117" num="0117"><ul><li>(5) The router device in which when a prefix is distributed from the prefix distributing device 2, the prefix management unit 5 sets discriminative data corresponding to the prefix to a value indicating that the prefix is usable, and when a new prefix is distributed from the prefix distributing device 2, the prefix management unit 5 changes the discriminative data corresponding to the already distributed prefix to a value<!-- EPO <DP n="28"> --> indicating that the prefix is unusable.</li></ul></p><p id="p0118" num="0118"><figref idrefs="f0010">FIG. 12</figref> is a flowchart showing the operation of a router device according to the present invention, i.e., a flowchart showing processing in a packet control method according to the present invention. As shown in <figref idrefs="f0010">FIG. 12</figref>, the router device is characterized by including a process (step S1) for creating a filtering rule including an indication of the passage or block of a packet from a node based on a prefix distributed from a prefix distributing device and a prefix in a source IP address received from a node, and a process (step S2) for passing or blocking a packet from the node according to the created filtering rule.</p><p id="p0119" num="0119">In each of the aforementioned exemplary embodiments, the following packet control methods are also disclosed:</p><p id="p0120" num="0120"><ul><li>(6) The packet control method in which the process to pass or block a packet includes a process to discard a packet when the received packet meets the indication of blocking the packet in the filtering rule and determine that a prefix included in the source IP address of the discarded packet is unusable and to be deleted.</li></ul></p><p id="p0121" num="0121"><ul><li>(7) The packet control method further including a process to store, in a prefix storage unit, a prefix together with discriminative data used to determine whether the prefix is usable.</li></ul></p><p id="p0122" num="0122"><ul><li>(8) The packet control method further including a process to periodically check on the contents stored in the prefix storage unit, create option information on an RA packet capable of identifying whether a prefix is usable or unusable based on the prefix and the discriminative data stored in the<!-- EPO <DP n="29"> --> prefix storage unit, and send a node an RA packet including the created option information.</li></ul></p><p id="p0123" num="0123"><ul><li>(9) The packet control method further including a process in which when a packet received from the node is discarded, an RA packet including option information capable of identifying that the prefix included in the source IP address of the packet is unusable is immediately sent to the node.</li></ul></p><p id="p0124" num="0124"><ul><li>(10) The packet control method further including a process in which when a prefix is distributed from the prefix distributing device, discriminative data corresponding to the prefix is set to a value indicating that the prefix is usable, and when a new prefix is distributed from the prefix distributing device, the discriminative data corresponding to the already distributed prefix is changed to a value indicating that the prefix is unusable.</li></ul></p><p id="p0125" num="0125">As described above, although the present invention is described with reference to the exemplary embodiments and examples, the present invention is not limited to the aforementioned exemplary embodiments and examples. Various changes that can be understood by those skilled in the art within the scope of the present invention can be made to the configurations and details of the present invention.</p><p id="p0126" num="0126">This application claims priority based on Japanese Patent Application No. <patcit id="pcit0003" dnum="JP2011038873A"><text>2011-38873, filed on February 24, 2011</text></patcit>, the entire disclosure of which is incorporated herein by reference.</p><heading id="h0015">Industrial Applicability</heading><p id="p0127" num="0127">The present invention can be suitably employed in a<!-- EPO <DP n="30"> --> normal IPv6 Internet access service environment in which a prefix is distributed from an upper router to a router device and the router device redistributes the prefix to a lower node device.</p><heading id="h0016">Reference Signs List</heading><p id="p0128" num="0128"><dl id="dl0001"><dt>1</dt><dd>ROUTER DEVICE</dd><dt>2</dt><dd>PREFIX DISTRIBUTING DEVICE</dd><dt>3</dt><dd>NODE</dd><dt>5</dt><dd>PREFIX MANAGEMENT UNIT</dd><dt>6</dt><dd>FILTER UNIT</dd><dt>7</dt><dd>PREFIX STORAGE DEVICE</dd><dt>8</dt><dd>RA SENDING UNIT</dd><dt>11</dt><dd>LAN</dd><dt>21</dt><dd>WAN</dd><dt>101, 102, 103</dt><dd>HGW</dd><dt>110</dt><dd>LAN INTERFACE UNIT</dd><dt>111,112</dt><dd>IPv6 UNIT</dd><dt>120</dt><dd>IPv6 ROUTING UNIT</dd><dt>130</dt><dd>FILTER UNIT</dd><dt>140</dt><dd>DHCP6 CLIENT UNIT</dd><dt>150</dt><dd>IPv6 HOST UNIT</dd><dt>151</dt><dd>ICMPv6 UNIT</dd><dt>160</dt><dd>PREFIX MANAGEMENT UNIT</dd><dt>161</dt><dd>PREFIX CONTROL UNIT</dd><dt>170</dt><dd>PREFIX STORAGE UNIT</dd><dt>180</dt><dd>WAN INTERFACE UNIT</dd></dl></p></description><claims mxw-id="PCLM56976192" lang="EN" load-source="patent-office"><!-- EPO <DP n="31"> --><claim id="c-en-0001" num="0001"><claim-text>A router device for redistributing, to a node, a prefix distributed from a prefix distributing device to route a packet based on an IPv6 address, the router device comprising:
<claim-text>a prefix management unit for creating a filtering rule including an indication of passage or block of a packet from the node based on the prefix distributed from the prefix distributing device and a prefix in a source IP address received from the node; and</claim-text>
<claim-text>a filter unit for passing or blocking the packet from the node according to the filtering rule created by the prefix management unit.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The router device according to claim 1, wherein<br/>
when a received packet meets the indication of blocking the packet in the filtering rule, the filter unit discards the packet and notifies the prefix management unit of the source IP address of the discarded packet, and<br/>
the prefix management unit determines that a prefix included in the notified source IP address is a prefix unusable and to be deleted.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The router device according to claim 1 or 2, further comprising a prefix storage unit for storing a prefix together with discriminative data used to determine whether the prefix is usable.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The router device according to claim 3, further comprising an RA sending unit for periodically checking on contents stored in the prefix storage unit, creating option<!-- EPO <DP n="32"> --> information on an RA packet capable of identifying whether a prefix is usable or unusable based on the prefix and the discriminative data stored in the prefix storage unit, and sending a node an RA packet including the created option information.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The router device according to claim 4, wherein when the filter unit discards the packet, the RA sending unit immediately sends the node an RA packet including option information capable of identifying that the prefix included in the source IP address of the packet is unusable.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The router device according to any one of claims 3 to 5, wherein when a prefix is distributed from the prefix distributing device, the prefix management unit sets discriminative data corresponding to the prefix to a value indicating that the prefix is usable, and when a new prefix is distributed from the prefix distributing device, the prefix management unit changes the discriminative data corresponding to the already distributed prefix to a value indicating that the prefix is unusable.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>A packet control method based on prefix management performed by a router device for redistributing, to a node, a prefix distributed from a prefix distributing device to route a packet based on an IPv46 address, the packet control method based on prefix management comprising:
<claim-text>creating a filtering rule including an indication of passage or block of a packet from the node based on the prefix distributed from the prefix distributing device and a prefix in a source IP address received from the node; and<!-- EPO <DP n="33"> --></claim-text>
<claim-text>passing or blocking the packet from the node according to the created filtering rule.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The packet control method based on prefix management according to claim 7, wherein when a received packet meets the indication of blocking the packet in the filtering rule, the packet is discarded and a prefix included in the source IP address of the discarded packet is determined to be a prefix unusable and to be deleted.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>A packet control program based on prefix management, which is installed in a router device for redistributing, to a node, a prefix distributed from a prefix distributing device to route a packet based on an IPv6 address, the packet control program based on prefix management causing a computer in the router device to perform:
<claim-text>a process to create a filtering rule including an indication of passage or block of a packet from the node based on the prefix distributed from the prefix distributing device and a prefix in a source IP address received from the node; and</claim-text>
<claim-text>a process to pass or block the packet from the node according to the created filtering rule.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The packet control program based on prefix management according to claim 9, further causing the computer to perform<br/>
a process to discard the packet when a received packet meets the indication of blocking the packet in the filtering rule, and determine that a prefix included in the source IP address of the discarded packet is a prefix unusable and to be deleted.</claim-text></claim></claims><drawings mxw-id="PDW16666975" load-source="patent-office"><!-- EPO <DP n="34"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="164" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="120" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="79" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="37"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="163" he="229" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="38"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="165" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="39"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="75" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="40"> --><figure id="f0007" num="7"><img id="if0007" file="imgf0007.tif" wi="161" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="41"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="88" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="42"> --><figure id="f0009" num="9,10"><img id="if0009" file="imgf0009.tif" wi="165" he="227" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="43"> --><figure id="f0010" num="11,12"><img id="if0010" file="imgf0010.tif" wi="155" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="44"> --><figure id="f0011" num="13"><img id="if0011" file="imgf0011.tif" wi="165" he="126" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
