<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680485-A1" country="EP" doc-number="2680485" kind="A1" date="20140101" family-id="47258606" file-reference-id="318293" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549203" ucid="EP-2680485-A1"><document-id><country>EP</country><doc-number>2680485</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-11866529-A" is-representative="YES"><document-id mxw-id="PAPP154823126" load-source="docdb" format="epo"><country>EP</country><doc-number>11866529</doc-number><kind>A</kind><date>20110602</date><lang>JA</lang></document-id><document-id mxw-id="PAPP168045531" load-source="docdb" format="original"><country>EP</country><doc-number>11866529.8</doc-number><date>20110602</date><lang>JA</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140451910" ucid="JP-2011062702-W" linkage-type="A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011062702</doc-number><kind>W</kind><date>20110602</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2025722484" load-source="docdb">H04L   9/10        20060101ALI20150902BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2025730909" load-source="docdb">H04L   9/32        20060101ALI20150902BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2025731770" load-source="docdb">H04L   9/08        20060101AFI20150902BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1962104671" load-source="docdb" scheme="CPC">G06F  12/14        20130101 LA20160304BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1962108098" load-source="docdb" scheme="CPC">G06F  21/70        20130101 LA20160304BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1962111203" load-source="docdb" scheme="CPC">G06F2221/21        20130101 LA20160304BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1962112121" load-source="docdb" scheme="CPC">H04L   9/3278      20130101 LI20160305BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1962114151" load-source="docdb" scheme="CPC">G06F  21/50        20130101 LA20160304BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1962114896" load-source="docdb" scheme="CPC">G11B  20/00086     20130101 LA20160304BHEP        </classification-cpc><classification-cpc mxw-id="PCL2065216682" load-source="docdb" scheme="CPC">H04L   9/0866      20130101 FI20140328BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180093" lang="DE" load-source="patent-office">VORRICHTUNG ZUR ERZEUGUNG VON SCHLÜSSELINFORMATIONEN UND VERFAHREN ZUR ERZEUGUNG VON SCHLÜSSELINFORMATIONEN</invention-title><invention-title mxw-id="PT132180094" lang="EN" load-source="patent-office">KEY INFORMATION GENERATION DEVICE AND KEY INFORMATION GENERATION METHOD</invention-title><invention-title mxw-id="PT132180095" lang="FR" load-source="patent-office">DISPOSITIF DE GÉNÉRATION D'INFORMATIONS DE CLÉ ET PROCÉDÉ DE GÉNÉRATION D'INFORMATIONS DE CLÉ</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918152059" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>MITSUBISHI ELECTRIC CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR918136786" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>MITSUBISHI ELECTRIC CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR918983659" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Mitsubishi Electric Corporation</last-name><iid>101323123</iid><address><street>7-3 Marunouchi 2-chome Chiyoda-ku</street><city>Tokyo 100-8310</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918136620" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SUZUKI DAISUKE</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918141395" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SUZUKI, DAISUKE</last-name></addressbook></inventor><inventor mxw-id="PPAR918991669" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SUZUKI, DAISUKE</last-name><address><street>c/o Mitsubishi Electric Corporation 7-3 Marunouchi 2-chome Chiyoda-ku</street><city>Tokyo 100-8310</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918989943" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Pfenning, Meinig &amp; Partner GbR</last-name><iid>100060642</iid><address><street>Patent- und Rechtsanwälte Theresienhöhe 13</street><city>80339 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2011062702-W"><document-id><country>JP</country><doc-number>2011062702</doc-number><kind>W</kind><date>20110602</date><lang>JA</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012164721-A1"><document-id><country>WO</country><doc-number>2012164721</doc-number><kind>A1</kind><date>20121206</date><lang>JA</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548854618" load-source="docdb">AL</country><country mxw-id="DS548855006" load-source="docdb">AT</country><country mxw-id="DS548854619" load-source="docdb">BE</country><country mxw-id="DS548848900" load-source="docdb">BG</country><country mxw-id="DS548837492" load-source="docdb">CH</country><country mxw-id="DS548871984" load-source="docdb">CY</country><country mxw-id="DS548855007" load-source="docdb">CZ</country><country mxw-id="DS548854620" load-source="docdb">DE</country><country mxw-id="DS548871985" load-source="docdb">DK</country><country mxw-id="DS548872302" load-source="docdb">EE</country><country mxw-id="DS548803334" load-source="docdb">ES</country><country mxw-id="DS548848901" load-source="docdb">FI</country><country mxw-id="DS548848902" load-source="docdb">FR</country><country mxw-id="DS548854621" load-source="docdb">GB</country><country mxw-id="DS548872303" load-source="docdb">GR</country><country mxw-id="DS548854622" load-source="docdb">HR</country><country mxw-id="DS548855008" load-source="docdb">HU</country><country mxw-id="DS548837493" load-source="docdb">IE</country><country mxw-id="DS548854623" load-source="docdb">IS</country><country mxw-id="DS548848903" load-source="docdb">IT</country><country mxw-id="DS548872304" load-source="docdb">LI</country><country mxw-id="DS548801882" load-source="docdb">LT</country><country mxw-id="DS548855009" load-source="docdb">LU</country><country mxw-id="DS548801883" load-source="docdb">LV</country><country mxw-id="DS548801884" load-source="docdb">MC</country><country mxw-id="DS548848969" load-source="docdb">MK</country><country mxw-id="DS548848970" load-source="docdb">MT</country><country mxw-id="DS548803335" load-source="docdb">NL</country><country mxw-id="DS548848904" load-source="docdb">NO</country><country mxw-id="DS548848971" load-source="docdb">PL</country><country mxw-id="DS548837494" load-source="docdb">PT</country><country mxw-id="DS548803336" load-source="docdb">RO</country><country mxw-id="DS548837495" load-source="docdb">RS</country><country mxw-id="DS548803337" load-source="docdb">SE</country><country mxw-id="DS548837496" load-source="docdb">SI</country><country mxw-id="DS548848905" load-source="docdb">SK</country><country mxw-id="DS548848972" load-source="docdb">SM</country><country mxw-id="DS548872305" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669873" lang="EN" load-source="patent-office"><p id="pa01" num="0001">In initial generation (for example, shipping from the factory), a security device generates an identifier w specific to the security device, with the PUF technology, generates key information k (k = HF(k)) from the identifier w, generates encrypted confidential information x by encrypting (x = Enc(mk, k)) confidential information mk with the key information k, and stores the encrypted confidential information x and an authentication code h (h = HF'(k)) of the key information k, in a nonvolatile memory. In operation, the security device generates the identifier w with the PUF technology, generates the key information k from the identifier w, and decrypts the encrypted confidential information x with the key information k. At a timing where the identifier w is generated in the operation, the security device checks whether the current operating environment has largely changed from the initial generation (S311). If a change in operating environment is detected (S311 → S312), the security device conducts a reset-up process (S312 to S315) of an authentication code h which is confidential information, and the encrypted confidential information x.<img id="iaf01" file="imgaf001.tif" wi="131" he="95" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499246" lang="EN" source="EPO" load-source="docdb"><p>In initial generation (for example, shipping from the factory), a security device generates an identifier w specific to the security device, with the PUF technology, generates key information k (k = HF(k)) from the identifier w, generates encrypted confidential information x by encrypting (x = Enc(mk, k)) confidential information mk with the key information k, and stores the encrypted confidential information x and an authentication code h (h = HF'(k)) of the key information k, in a nonvolatile memory. In operation, the security device generates the identifier w with the PUF technology, generates the key information k from the identifier w, and decrypts the encrypted confidential information x with the key information k. At a timing where the identifier w is generated in the operation, the security device checks whether the current operating environment has largely changed from the initial generation (S311). If a change in operating environment is detected (S311 †’ S312), the security device conducts a reset-up process (S312 to S315) of an authentication code h which is confidential information, and the encrypted confidential information x.</p></abstract><description mxw-id="PDES63955303" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>Technical Field</b></heading><p id="p0001" num="0001">The present invention relates to a security device (key information generation device) that executes an authentication process, encryption process, and the like. The present invention relates to a device and method for managing confidential information used in the encryption process, and an identifier specific to the device and needed to authenticate the device, stably and securely for a long period of time.</p><heading id="h0002"><b>Background Art</b></heading><p id="p0002" num="0002">In recent years, along with the trend for networking built-in devices typically including mobile telephones, the necessity increases for the built-in devices to conduct a process concerning the information security in order to maintain the confidentiality and the integrity of data dealt with by the built-in devices and to authenticate the built-in devices themselves. The process concerning the information security is implemented by a cryptographic algorithm and authentication algorithm. Execution of such algorithms basically requires that each built-in device hold its unique confidential information and an identifier specific to the device "securely". "Securely" signifies that a person other than the authorized user of the built-in device cannot read or tamper the identifier easily.</p><p id="p0003" num="0003">A means for holding the identifier securely includes a protection method that uses a housing on which various types of sensors (a photosensor, a voltage sensor, and a frequency detector) are mounted to prevent an external unauthorized access using a physical protection film (a metal case or resin molding), and a protection method that<!-- EPO <DP n="2"> --> uses an anti-tamper mechanism such as a security chip. These protection methods presume that they protect an identifier that exists in the device in a nonvolatile manner as digital data.</p><p id="p0004" num="0004">As a method that securely holds an identifier with an approach different from the above-mentioned means, a technology called PUF (Physical Unclonable Function) is available. The significant feature of the PUF resides in that the identifier is not held in the device as nonvolatile digital data. The PUF is practiced in several manners which are typically represented by "A signal generator based device security" disclosed in Patent Literature 1 and "A semiconductor device identifier generation method and semiconductor device" disclosed in Patent Literature 2.</p><p id="p0005" num="0005">The feature of an identifier generated by the PUF as in Patent Literature 1 or 2 resides in that a unique bit string is not always generated each time an identifier is generated. That is, the identifier is generated as data including noise. A technology described in Patent Literature 1, of converting an identifier including noise into unique data will be described hereinafter.</p><p id="p0006" num="0006">In Patent Literature 1, first, identifier generation is divided into two steps ("initial generation" and "re-generation"). A bit string generated in initial generation serves as the identifier of a device. In re-generation, a process of generating the same bit string as the bit string generated in initial generation is conducted.</p><heading id="h0003">&lt;Initial Generation Step&gt;</heading><p id="p0007" num="0007">First, a bit string is generated by the PUF. As a simple example, 5-bit data is generated. The bit string will be defined as: <maths id="math0001" num=""><math display="block"><mi mathvariant="normal">w</mi><mo>=</mo><mfenced separators=""><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">4</mn><mo>,</mo><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">5</mn></mfenced><mo>=</mo><mn mathvariant="normal">10110</mn></math><img id="ib0001" file="imgb0001.tif" wi="74" he="11" img-content="math" img-format="tif"/></maths><br/>
Then, auxiliary data s of this bit string is calculated. Note that the calculation is conducted using a (5, 1, 5) repetition code.<br/>
<!-- EPO <DP n="3"> -->In this case, the following 4-bit bit string is obtained: <maths id="math0002" num=""><math display="block"><mi mathvariant="normal">s</mi><mo>=</mo><mfenced separators=""><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mspace width="1em"/><mi>xor w</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mspace width="1em"/><mi>xor w</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mspace width="1em"/><mi>xor w</mi><mo>⁢</mo><mn mathvariant="normal">4</mn><mo>,</mo><mi mathvariant="normal">w</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mspace width="1em"/><mi>xor w</mi><mo>⁢</mo><mn mathvariant="normal">5</mn></mfenced><mo>=</mo><mn mathvariant="normal">1001</mn></math><img id="ib0002" file="imgb0002.tif" wi="114" he="10" img-content="math" img-format="tif"/></maths><br/>
The auxiliary data calculation method depends on the structure of an error correction code employed. The auxiliary data is data that may be disclosed and is stored in a nonvolatile area. That is, the nonvolatile area to store the auxiliary data need not be a secure environment.</p><heading id="h0004">&lt;Re-generation Step&gt;</heading><p id="p0008" num="0008">In the re-generation step, a bit string and auxiliary data are generated by the PUF in the same manner as in initial generation. This bit string will be defined as: <maths id="math0003" num=""><math display="block"><mi mathvariant="normal">wʹ</mi><mo>=</mo><mfenced separators=""><mi mathvariant="normal">wʹ</mi><mo>⁢</mo><mn>1</mn><mo>,</mo><mi mathvariant="normal">wʹ</mi><mo>⁢</mo><mn>2</mn><mo>,</mo><mi mathvariant="normal">wʹ</mi><mo>⁢</mo><mn>3</mn><mo>,</mo><mi mathvariant="normal">wʹ</mi><mo>⁢</mo><mn>4</mn><mo>,</mo><mi mathvariant="normal">wʹ</mi><mo>⁢</mo><mn>5</mn></mfenced><mo>=</mo><mn>10000</mn></math><img id="ib0003" file="imgb0003.tif" wi="80" he="8" img-content="math" img-format="tif"/></maths><br/>
In this example, data which is different by 2 bits from w generated in the initial generation step is outputted. This error in the bit string corresponds to the noise described above. Auxiliary data s' of w' is: <maths id="math0004" num=""><math display="block"><mi mathvariant="normal">sʹ</mi><mo>=</mo><mn>1111</mn></math><img id="ib0004" file="imgb0004.tif" wi="25" he="11" img-content="math" img-format="tif"/></maths><br/>
Then, s calculated and stored in the initial generation step is read out, and <maths id="math0005" num=""><math display="block"><mi mathvariant="normal">e</mi><mo>=</mo><mi>s xor</mi><mspace width="1em"/><mi mathvariant="normal">sʹ</mi></math><img id="ib0005" file="imgb0005.tif" wi="32" he="9" img-content="math" img-format="tif"/></maths><br/>
is calculated.<br/>
Namely, <maths id="math0006" num=""><math display="block"><mtable columnalign="left"><mtr><mtd><mi mathvariant="normal">e</mi><mo>=</mo><mi>s xor</mi><mspace width="1em"/><mi mathvariant="normal">sʹ</mi><mo>=</mo><mn mathvariant="normal">1001</mn><mspace width="1em"/><mi>xor</mi><mspace width="1em"/><mn mathvariant="normal">1111</mn><mo>=</mo><mn mathvariant="normal">0110</mn></mtd></mtr><mtr><mtd><mo>=</mo><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced></mtd></mtr></mtable></math><img id="ib0006" file="imgb0006.tif" wi="74" he="18" img-content="math" img-format="tif"/></maths><br/>
Then, the error bit position of w' is specified by the following procedure.<br/>
Note that <maths id="math0007" num=""><math display="block"><mi>SUM</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>+</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>+</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>+</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn><mo>,</mo></math><img id="ib0007" file="imgb0007.tif" wi="79" he="10" img-content="math" img-format="tif"/></maths> <maths id="math0008" num=""><math display="block"><mi>SL</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mspace width="1em"/><mi>xor e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mspace width="1em"/><mi>xor e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mspace width="1em"/><mi>xor e</mi><mo>⁢</mo><mn>4</mn><mo>,</mo><mspace width="1em"/><mi>e</mi><mo>⁢</mo><mn>1</mn></mfenced></math><img id="ib0008" file="imgb0008.tif" wi="101" he="10" img-content="math" img-format="tif"/></maths></p><heading id="h0005">&lt;Step 1&gt;</heading><!-- EPO <DP n="4"> --><p id="p0009" num="0009"><maths id="math0009" num=""><math display="block"><mi>SUM</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn mathvariant="normal">2</mn></math><img id="ib0009" file="imgb0009.tif" wi="49" he="9" img-content="math" img-format="tif"/></maths><br/>
This indicates that the condition of being less than 3 is satisfied. Hence, w'1 is not wrong.</p><heading id="h0006">&lt;Step 2&gt;</heading><p id="p0010" num="0010"><maths id="math0010" num=""><math display="block"><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>&lt;</mo><mo>=</mo><mi>SL</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn>1100</mn></math><img id="ib0010" file="imgb0010.tif" wi="79" he="10" img-content="math" img-format="tif"/></maths><maths id="math0011" num=""><math display="block"><mi>SUM</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn mathvariant="normal">2</mn></math><img id="ib0011" file="imgb0011.tif" wi="46" he="9" img-content="math" img-format="tif"/></maths><br/>
This indicates that the condition of being less than 3 is satisfied. Hence, w'2 is not wrong.</p><heading id="h0007">&lt;Step 3&gt;</heading><p id="p0011" num="0011"><maths id="math0012" num=""><math display="block"><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>&lt;</mo><mo>=</mo><mi>SL</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn>0111</mn></math><img id="ib0012" file="imgb0012.tif" wi="85" he="8" img-content="math" img-format="tif"/></maths><maths id="math0013" num=""><math display="block"><mi>SUM</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn>3</mn></math><img id="ib0013" file="imgb0013.tif" wi="50" he="10" img-content="math" img-format="tif"/></maths><br/>
This indicates that the condition of being less than 3 is not satisfied. Hence, w'3 is wrong.</p><heading id="h0008">&lt;Step 4&gt;</heading><p id="p0012" num="0012"><maths id="math0014" num=""><math display="block"><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>&lt;</mo><mo>=</mo><mi>SL</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn>1110</mn></math><img id="ib0014" file="imgb0014.tif" wi="84" he="9" img-content="math" img-format="tif"/></maths><maths id="math0015" num=""><math display="block"><mi>SUM</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn>3</mn></math><img id="ib0015" file="imgb0015.tif" wi="52" he="10" img-content="math" img-format="tif"/></maths><br/>
This indicates that the condition of being less than 3 is not satisfied. Hence, w'4 is wrong.</p><heading id="h0009">&lt;Step 5&gt;</heading><p id="p0013" num="0013"><maths id="math0016" num=""><math display="block"><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>&lt;</mo><mo>=</mo><mi>SL</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn>0011</mn></math><img id="ib0016" file="imgb0016.tif" wi="84" he="9" img-content="math" img-format="tif"/></maths><maths id="math0017" num=""><math display="block"><mi>SUM</mi><mfenced separators=""><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">2</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">3</mn><mo>,</mo><mi mathvariant="normal">e</mi><mo>⁢</mo><mn mathvariant="normal">4</mn></mfenced><mo>=</mo><mn mathvariant="normal">2</mn></math><img id="ib0017" file="imgb0017.tif" wi="51" he="10" img-content="math" img-format="tif"/></maths><br/>
This indicates that the condition of being less than 3 is satisfied. Hence, w'5 is not wrong.</p><p id="p0014" num="0014">In accordance with the above checking result, w' is corrected. In this case, w' is corrected to 10110. This bit string is equal to w generated in initial generation.<!-- EPO <DP n="5"> --></p><p id="p0015" num="0015">In this manner, by conducting a process utilizing an error correction code, an identifier including noise can be converted into unique data.</p><p id="p0016" num="0016">If, in the above example, 3 bits are regenerated incorrectly, w cannot be correctly restored from w'. Namely, if noise exceeding the correction capability of a code that forms auxiliary data occurs in the regeneration step, an identifier cannot be generated correctly. For this reason, the error correction code used in the above process must have a correction capability determined by taking into account the error probability of the PUF.</p><p id="p0017" num="0017">The error probability of the PUF will be described. One major factor that increases the error probability of the PUF is a change in operating environment of the PUF with respect to the initial generation step as a criterion. A change in operating environment includes a temperature change, a voltage change, a deterioration over time of the semiconductor device, and the like.</p><p id="p0018" num="0018">In addition to a random factor that occurs momentarily, the change in operating environment includes chronological variations such as diurnal variations, seasonal variations, and deterioration over time.</p><heading id="h0010"><b>Citation List</b></heading><heading id="h0011"><b>Patent Literature</b></heading><p id="p0019" num="0019"><ul><li>Patent Literature 1: <patcit id="pcit0001" dnum="JP2009524998A"><text>JP 2009-524998</text></patcit></li><li>Patent Literature 2: <patcit id="pcit0002" dnum="JP2009533741A"><text>JP 2009-533741</text></patcit></li></ul></p><heading id="h0012"><b>Summary of Invention</b></heading><heading id="h0013"><b>Technical Problem</b></heading><p id="p0020" num="0020">If a code having a correction capability with a sufficiently large margin is to be employed taking into account the variations over time of the error probability of the PUF, then a complicated, large-scale circuit need be used. In particular, when<!-- EPO <DP n="6"> --> equipment having a long service life such as an on-vehicle device, industrial equipment, or instrumentation equipment is involved, it is difficult to accurately estimate a correction capability margin.</p><p id="p0021" num="0021">It is an object of the present invention to provide a device that can manage confidential information stably and securely within a semiconductor device even if the code correction capability is low. It is also an object of the present invention to provide a device that can securely manage various types of confidential information assigned to the respective usages.</p><heading id="h0014"><b>Solution to Problem</b></heading><p id="p0022" num="0022">A key information generation device according to the present invention which generates key information includes:
<ul><li>an identifier generating part which, based on physical properties of the key information generation device, generates an identifier specific to the key information generation device;</li><li>a key information generating part which, based on the identifier generated by the identifier generating part, generates the key information to be used for encrypting and decrypting confidential information;</li><li>a cryptographic part which encrypts and decrypts the confidential information using the key information generated by the key information generating part;</li><li>a hash part which generates a hash value in accordance with a predetermined hash value generating scheme that uses at least the key information generated by the key information generating part;</li><li>a storing part which stores encrypted confidential information and the hash value in a nonvolatile manner, the encrypted confidential information being formed by encrypting, with the cryptographic part, the confidential information using the key<!-- EPO <DP n="7"> --> information generated by the key information generating part, the hash value being generated by the hash part in accordance with the hash value generating scheme that uses at least the key information used for encrypting the confidential information; and</li><li>a comparing part,</li><li>wherein the identifier generating part</li><li>regenerates the identifier when the cryptographic part decrypts the encrypted confidential information,</li><li>wherein the key information generating part</li><li>regenerates the key information used by the cryptographic part, based on the identifier regenerated by the identifier generating part, for decrypting the encrypted confidential information,</li><li>wherein the hash part</li><li>regenerates the hash value in accordance with the hash value generating scheme that uses at least the key information regenerated by the key information generating part,</li><li>wherein the comparing part</li><li>compares the hash value regenerated by the hash part and the hash value stored in the storing part, and</li><li>wherein the cryptographic part</li><li>decrypts the encrypted confidential information, when the hash value regenerated by the hash part and the hash value stored in the storing part are equal according to comparison by the comparing part, using the key information regenerated by the key information generating part.</li></ul></p><heading id="h0015"><b>Advantageous Effects of Invention</b></heading><p id="p0023" num="0023">According to the present invention, a device can be provided that can securely<!-- EPO <DP n="8"> --> manage various types of confidential information assigned to the respective usages.</p><heading id="h0016"><b>Brief Description of Drawings</b></heading><p id="p0024" num="0024"><ul><li>[<figref idrefs="f0001">Fig. 1</figref>] is a configuration diagram of a security device 101 according to Embodiment 1.</li><li>[<figref idrefs="f0002">Fig. 2</figref>] is a flowchart of initial setting of the security device 101 according to Embodiment 1.</li><li>[<figref idrefs="f0003">Fig. 3</figref>] is a flowchart of an operation of the security device 101 according to Embodiment 1.</li><li>[<figref idrefs="f0004">Fig. 4</figref>] is a configuration diagram of a security device 102 according to Embodiment 2.</li><li>[<figref idrefs="f0005">Fig. 5</figref>] is a flowchart of an operation of the security device 102 according to Embodiment 2.</li></ul></p><heading id="h0017"><b>Description of Embodiments</b></heading><heading id="h0018">Embodiment 1.</heading><p id="p0025" num="0025">The meanings of symbols used in the following Embodiment 1 will be defined.</p><heading id="h0019">(1) Confidential Information mk;</heading><p id="p0026" num="0026">The confidential information mk is a bit string that differs according to the device, or according to the shipping destination. The ultimate object of the security devices according to following Embodiments 1 and 2 is to manage the bit string stably and securely.</p><heading id="h0020">(2) Encrypting Function Enc, Decrypting Function Dec;</heading><p id="p0027" num="0027">An encrypting function c = Enc(m, k) encrypts an input m using confidential information k. The encrypting function which outputs c is expressed as Enc.<br/>
A decrypting function m = Dec(c, k) decrypts an input c using the confidential information k.<!-- EPO <DP n="9"> --></p><heading id="h0021">(3) PUF-Generated Information w, s (s = syn(w));</heading><p id="p0028" num="0028">Output information of the PUF will be expressed as w. Namely, "w" is an identifier which is specific to a security device 101 and generated by the PUF technology based on the physical properties of the security device 101. Auxiliary data corresponding to the identifier w will be expressed as s. An auxiliary data generating function will be expressed as syn. More specifically, generation of the auxiliary data s using the identifier w will be expressed as: <maths id="math0018" num=""><math display="block"><mi mathvariant="normal">s</mi><mo>=</mo><mi>syn</mi><mfenced><mi mathvariant="normal">w</mi></mfenced></math><img id="ib0018" file="imgb0018.tif" wi="33" he="10" img-content="math" img-format="tif"/></maths></p><heading id="h0022">(4) Error Correcting Process w = FEC(w', s);</heading><p id="p0029" num="0029">Using output information w' of the PUF in the regeneration step and the auxiliary data s in the initial generation step, a process (error correcting process) of decoding w of the initial generation step will be expressed as: <maths id="math0019" num=""><math display="block"><mi mathvariant="normal">w</mi><mo>=</mo><mi>FEC</mi><mfenced><mi mathvariant="normal">wʹ</mi><mi mathvariant="normal">s</mi></mfenced></math><img id="ib0019" file="imgb0019.tif" wi="35" he="10" img-content="math" img-format="tif"/></maths></p><heading id="h0023">(5) Hash Function y = HF(x);</heading><p id="p0030" num="0030">A process of obtaining a hash value y of "x" will be expressed as: <maths id="math0020" num=""><math display="block"><mi mathvariant="normal">y</mi><mo>=</mo><mi>HF</mi><mfenced><mi mathvariant="normal">x</mi></mfenced></math><img id="ib0020" file="imgb0020.tif" wi="24" he="10" img-content="math" img-format="tif"/></maths></p><p id="p0031" num="0031">(6) A process of obtaining the hash value y of "x" by a unidirectional hash function or a hash function different from (5) will be expressed as: <maths id="math0021" num=""><math display="block"><mi mathvariant="normal">y</mi><mo>=</mo><mi mathvariant="normal">HFʹ</mi><mfenced><mi mathvariant="normal">x</mi></mfenced></math><img id="ib0021" file="imgb0021.tif" wi="28" he="10" img-content="math" img-format="tif"/></maths></p><p id="p0032" num="0032">Embodiment 1 will be explained with reference to <figref idrefs="f0001 f0002 f0003">Figs. 1 to 3</figref>.</p><p id="p0033" num="0033"><figref idrefs="f0001">Fig. 1</figref> is a block diagram of the security device 101 according to Embodiment 1. The security device 101 is aimed at managing the confidential information (confidential information mk to be described later) securely and stably.</p><heading id="h0024">(Configuration of Security Device 101)</heading><p id="p0034" num="0034">The security device 101 (key information generating device) is provided with a<!-- EPO <DP n="10"> --> CPU 110 which is a basic constituent element of a semiconductor device, a nonvolatile memory 120 (storing part) typically represented by an EEPROM or the like, a volatile memory 130 such as an SRAM, an I/O (140) which is an information input/output part, a key managing circuit 150-1, and a cryptographic coprocessor 160 (cryptographic part). The key managing circuit 150-1 has the main function of the security device 101. The cryptographic coprocessor 160 is a cryptographic coprocessor mounted in a typical security-purpose semiconductor device. As shown in <figref idrefs="f0001">Fig. 1</figref>, the above-enumerated devices ranging from the CPU 110 to the cryptographic coprocessor 160 are connected to a local bus 170. As the I/O (140), for example, a UART (Universal Asynchronous Receiver Transmitter) may be employed. The I/O (140) communicates externally via an external port 180.</p><heading id="h0025">(Configuration of Key Managing Circuit 150-1)</heading><p id="p0035" num="0035">The key managing circuit 150-1 includes, as constituent elements, a PUF 151 (identifier generating part) which generates an identifier including noise, an FEC 152 (error correcting part) which corrects the noise by conducting a predetermined error correction process, a hash function HF 153 (key information generating part) which randomizes a corrected identifier, a unidirectional hash function HF' 154 (hash part) which generates an authentication code for the identifier, a comparator 155 (comparing part) which performs checking using the authentication code, and an error count monitor 156-1 (monitoring part) which receives the result of the comparator 155 and manages the count of cases where the comparison result indicates "not equal". The unidirectional hash function HF' 154 is an authentication code generating part. The authentication code originates from the identifier.</p><heading id="h0026">The operation of the security device 101 in Fig. 1 will be described.</heading><p id="p0036" num="0036"><figref idrefs="f0002">Fig. 2</figref> is a flowchart that explains the operation of the security device 101 in<!-- EPO <DP n="11"> --> the initial setting. The initial setting will be explained with reference to <figref idrefs="f0002">Fig. 2</figref>. Referring to <figref idrefs="f0002">Fig. 2</figref>, a graphic form denoted by reference numeral 10 represents a volatile memory such as a register, and a graphic form denoted by reference numeral 20 represents a nonvolatile memory. The same applies to <figref idrefs="f0003">Figs. 3</figref> and <figref idrefs="f0005">5</figref> as well.
<ol><li>(1) First, the I/O (140) takes as input confidential information mk assigned to the devices, via the external port 180 (S201). This input activates the key managing circuit 150-1. First, the PUF 151 generates an identifier w based on the physical properties of the security device 101 (S202).</li><li>(2) Then, the FEC 152 generates auxiliary data s = syn(w) corresponding to the identifier w (S203). The auxiliary data s is outputted to the outside of the key managing circuit 150-1 and stored in the nonvolatile memory 120.</li><li>(3) Then, the hash function HF 153 randomizes the identifier w and outputs confidential information k (to be referred to as key information k as well) (S204). An authentication code h (hash value) of the confidential information k is calculated by the HF' 154 (S205). As with the auxiliary data s, the authentication code h is outputted to the outside of the key managing circuit 150-1 and stored in the nonvolatile memory 120.</li><li>(4) The cryptographic coprocessor 160 encrypts the confidential information mk inputted in S201, using the confidential information k as the key information, thus calculating x = Enc(mk, k) (S206). As with the auxiliary data s and the authentication code h, encrypted confidential information x is stored in the nonvolatile memory 120.</li><li>(5) After the above processes are completed, the confidential information mk and k existing in the key managing circuit 150-1, the register (volatile memory) of the cryptographic coprocessor 160, and the like are cleared (S207). Initial generation is thus completed.</li></ol></p><p id="p0037" num="0037"><figref idrefs="f0003">Fig. 3</figref> is a flowchart that explains how the security device 101 works in the<!-- EPO <DP n="12"> --> operation (regeneration).
<ol><li>(1) When the security device 101 in operation receives an encryption process request or decryption process request that uses the confidential information mk, the key managing circuit 150-1 is activated first. The error count monitor 156-1 resets an internal counter cnt incorporated in it (S301).</li><li>(2) Upon this activation, the PUF 151 generates (regenerates) an identifier w' (S302). At this time, note that the identifier w' does not always coincide with the identifier w generated in the initial setting and that the identifier w' is a bit string including noise, as compared to the identifier w.</li><li>(3) Then, using the identifier w' and the auxiliary data s which is stored in the nonvolatile memory 120, the FEC 152 calculates <maths id="math0022" num=""><math display="block"><mi mathvariant="normal">wʹʹ</mi><mo>=</mo><mi>FEC</mi><mfenced><mi mathvariant="normal">wʹ</mi><mi mathvariant="normal">s</mi></mfenced></math><img id="ib0022" file="imgb0022.tif" wi="37" he="9" img-content="math" img-format="tif"/></maths><br/>
which is an error correcting process for the identifier w' (S303). At this time, note that <maths id="math0023" num=""><math display="block"><mi mathvariant="normal">wʹʹ</mi><mo>=</mo><mi mathvariant="normal">w</mi></math><img id="ib0023" file="imgb0023.tif" wi="22" he="9" img-content="math" img-format="tif"/></maths><br/>
if the identifier w' falls within the range of the correction capability of the error FEC 152.</li><li>(4) The hash function HF 153 converts the identifier w" that has been error-correction-processed, into key information k" by randomization (regeneration of the key information) (S304).</li><li>(5) The HF' 154 calculates a hash value h" of the key information k" (regeneration of the hash value), and sends the hash value h" to the comparator 155 (S305).</li><li>(6) The comparator 155 compares the hash value h" with the authentication code h of the confidential information k (key information k) stored in the nonvolatile memory 120 to check whether they coincide or not (S306). If they coincide, the<!-- EPO <DP n="13"> --> comparator 155 sends the key information k" to the cryptographic coprocessor 160.<br/>
If w" = w, then h = h" and k = k".<br/>
If h = h" in spite of w"! = w (w" and w' do not coincide), this signifies collision in the unidirectional hash function. Usually, this occurs with a probability of as very low as 2<sup>-128</sup>.</li><li>(7) Then, the cryptographic coprocessor 160 performs a decryption process using the encrypted confidential information x stored in the nonvolatile memory 120 and the key information k" regenerated by the hash function HF 153, thus obtaining mk = Dec(x, k") (S310).</li></ol></p><p id="p0038" num="0038"><ul><li>(8) In the case of noncoincidence in S306, the error count monitor 156-1 receives a noncoincidence notice from the comparator 155 and increments the internal counter cnt (S307).</li><li>(9) After that, the error count monitor 156-1 checks whether the internal counter cnt exceeds a reencapsulation threshold U (S308). Until the internal counter cnt exceeds the threshold U, the process restarts with S302, and a series of processes until S308 are executed. If the internal counter cnt exceeds the threshold U, the error count monitor 156-1 notifies a key management failure to the CPU 110. The process is stopped (S309).</li></ul></p><p id="p0039" num="0039"><ul><li>(10) When the normal process is successful, S310 is executed, and after that the error count monitor 156-1 checks the internal counter cnt to see whether the internal counter cnt exceeds a reencapsulation threshold V (second threshold) (a predetermined stability checking rule) (S311). The threshold V is a value equal to or less than the threshold U of S308. If the internal counter cnt exceeds the reencapsulation threshold V, the process proceeds to S312, and the reencapsulation process to be described hereinafter is conducted. In the reencapsulation process, the error count monitor 156-1<!-- EPO <DP n="14"> --> causes the FEC 152, the HF 153, the HF' 154, and the cryptographic coprocessor 160 to perform the following process.</li></ul></p><p id="p0040" num="0040">In the reencapsulation process, in S312, the FEC 152 generates updating auxiliary data corresponding to the identifier w' regenerated in S302, from <maths id="math0024" num=""><math display="block"><mi mathvariant="normal">sʹ</mi><mo>=</mo><mi>syn</mi><mfenced><mi mathvariant="normal">wʹ</mi></mfenced><mn>.</mn></math><img id="ib0024" file="imgb0024.tif" wi="30" he="10" img-content="math" img-format="tif"/></maths><br/>
In S313, the HF 153 generates confidential information k' corresponding to the identifier w' as input, from <maths id="math0025" num=""><math display="block"><mi mathvariant="normal">kʹ</mi><mo>=</mo><mi>HF</mi><mfenced><mi mathvariant="normal">wʹ</mi></mfenced></math><img id="ib0025" file="imgb0025.tif" wi="27" he="11" img-content="math" img-format="tif"/></maths><br/>
In S314, the HF' 154 generates an authentication code h' (hash value) for the key information k', from <maths id="math0026" num=""><math display="block"><mi mathvariant="normal">hʹ</mi><mo>=</mo><mi mathvariant="normal">HFʹ</mi><mfenced><mi mathvariant="normal">kʹ</mi></mfenced></math><img id="ib0026" file="imgb0026.tif" wi="29" he="11" img-content="math" img-format="tif"/></maths><br/>
In S315, the cryptographic coprocessor 160 encrypts the confidential information mk decrypted in S310, by <maths id="math0027" num=""><math display="block"><mi mathvariant="normal">xʹ</mi><mo>=</mo><mi>Enc</mi><mfenced><mi>mk</mi><mi mathvariant="normal">kʹ</mi></mfenced></math><img id="ib0027" file="imgb0027.tif" wi="37" he="10" img-content="math" img-format="tif"/></maths><br/>
as updating information using the key information k' generated in S313. The error count monitor 156-lupdates (s, h, x) stored in the nonvolatile memory 120 to (s', h', x').</p><p id="p0041" num="0041">At this time, during updating, write into the nonvolatile memory 120 may fail for some reason. Considering this, it is desirable to manage at least two-generation sets (s, h, x) by the nonvolatile memory 120 and operate them, instead of overwriting (s, h, x) with (s', h', x').</p><p id="p0042" num="0042">If the internal counter cnt of the error count monitor 156-1 does not exceed the threshold V, the process proceeds to S316, and the cryptographic coprocessor 160 executes "the encryption process or the decryption process" using the confidential information mk. In terms of the security, it is desirable to clear the confidential information mk from the register after execution of S309. If the processing capability<!-- EPO <DP n="15"> --> is limited, however, the confidential information mk may be held in the register. The confidential information mk may be deleted from the register in response to an external clear request to the cryptographic coprocessor 160. Until the confidential information mk is cleared, encryption and decryption process using the confidential information mk may be executed. In either case, the confidential information mk is deleted when the power supply of the security device is cut off.</p><p id="p0043" num="0043">In the above process, the confidential information mk is encrypted by the volatile confidential information k generated by the processes of the PUF 151, FEC 152, and HF 153. The encrypted confidential information mk is stored in the nonvolatile memory 120, so that the confidential information mk is securely managed by the security device 101. The failure frequency of the generation of the confidential information k due to temporal changes is detected. When the failure frequency increases, the confidential information mk is reencapsulated by key information k' newly generated in the current operating environment, and stored in the nonvolatile memory. Since this reduces the temporal changes of the new key information k' with respect to the original key information k, the failure frequency of the generation of the key information k can be further decreased. In this manner, as the volatile confidential information k is updated as required considering the temporal changes, decryption of mk can be guaranteed over a long period of time without including a margin in the correction capability of the FEC.</p><p id="p0044" num="0044">According to the above scheme, the confidential information mk exists in the register only during the operation. Where the power supply is cut off, only the encrypted confidential information x which is encrypted by the key information k exists in the nonvolatile area. Hence, the key information k and the confidential information mk cannot be restored by static analysis through chip destruction. Hence, the<!-- EPO <DP n="16"> --> confidential information mk can be managed more securely than in a case of storing it in the nonvolatile area directly.</p><p id="p0045" num="0045">Furthermore, the assignment of the confidential information mk can be controlled according to the use. For example, for a certain product line, the assignment of mk may be changed according to the product type or shipping destination, while for another certain product line, the assignment of mk may be changed according to the security device. In addition, the confidential information mk may be key information in common key cryptography, or a secret key in public key cryptography.</p><heading id="h0027">Embodiment 2.</heading><p id="p0046" num="0046">A security device 102 according to Embodiment 2 will be described with reference to <figref idrefs="f0004">Figs. 4</figref> and <figref idrefs="f0005">5</figref>.<br/>
<figref idrefs="f0004">Fig. 4</figref> is a block diagram of the security device 102. In the security device 102, a key managing circuit 150-2 replaces the key managing circuit 150-1. The difference between the key managing circuit 150-1 and the key managing circuit 150-2 resides in that in the key managing circuit 150-2, an error bit count monitor 156-2 (monitoring part) replaces the error count monitor 156-1.</p><p id="p0047" num="0047">Unlike the error count monitor 156-1, the error bit count monitor 156-2 checks whether or not execution of the reencapsulation process is needed based on the error bit count of the identifier w', instead of checking based on the count of noncoincidences with the authentication code h (S311).</p><p id="p0048" num="0048"><figref idrefs="f0005">Fig. 5</figref> is a flowchart that explains how the security device 102 works in the operation (regeneration). The basic process flow is the same as that in <figref idrefs="f0003">Fig. 3</figref>, but the process of S501 and S502 is different from that of <figref idrefs="f0003">Fig. 3</figref>.</p><p id="p0049" num="0049"><ol><li>(1) In S501, the error bit count monitor 156-2 counts error bits based on an error locater calculated in the process of the error correction process FEC 152. The<!-- EPO <DP n="17"> --> obtained count value will be expressed as cnt_b.</li><li>(2) In S502, the error bit count monitor 156-2 compares "cnt_b" with a reencapsulation threshold B to check whether or not the count value "cnt_b" exceeds the threshold B (predetermined stability checking rule). If the count value "cnt_b" exceeds the threshold B, the error bit count monitor 156-2 causes the FEC 152, the HF 153, the HF' 154, and the cryptographic coprocessor 160 to perform a reencapsulation process, in the same manner as in Embodiment 1.</li></ol></p><p id="p0050" num="0050">Embodiment 1 and Embodiment 2 will be compared hereinafter. Note that the comparison will be made referring to a case that uses an error correction code having a minimum distance of 21. In this case, the correctable bit count is 10 at a maximum. In Embodiment 1, if the identifier w' includes more than 10 error bits and the key generation failure frequency increases, the reencapsulation process is executed. In Embodiment 2, key generation will not fail if B = 7, but the failure possibility increases. More specifically, the reencapsulation process is executed even when the identifier w' includes 7 to 10 error bits.</p><p id="p0051" num="0051">Embodiments 1 and 2 describe that the authentication code is generated for the confidential information k obtained by converting the device identifier w. A similar function can be achieved with the pre-conversion device identifier w.<br/>
In the above description, the authentication code (hash value) for the key information is generated. More specifically, the key information is the target for which the authentication code (unidirectional hash value) is to be generated (predetermined hash value generation rule). However, the present invention is not limited to this, but the hash value generation rule may determine an identifier as a target for which an authentication code is to be generated. Alternatively, "data obtained by connecting the key information k and the encrypted confidential information x", or<!-- EPO <DP n="18"> --> "data obtained by connecting the identifier w and the encrypted confidential information x" may be determined as a target for which an authentication code is to be generated. This enables detecting tampering of the encrypted confidential information x.</p><p id="p0052" num="0052">Embodiment 1 or 2 may be chosen properly depending on the trade-off with the processing time, the restriction on the nonvolatile memory rewriting count, and the like.</p><p id="p0053" num="0053">Lastly, the methods described in Embodiments 1 and 2 are not limited to Embodiments 1 and 2 precisely. That is, in the implementation phase, Embodiments 1 and 2 can be practiced by modifying the constituent elements within a range not departing from the gist of the invention. Also, various types of inventions may be made by appropriately combining a plurality of constituent elements disclosed in the above embodiments. In addition, some of the constituent elements may be eliminated from the entire constituent elements described in the embodiments. Furthermore, constituent elements that cover different embodiments may be combined appropriately.</p><p id="p0054" num="0054">In the above embodiments, a security device has been described. It is also possible to comprehend the operation of the security device as a key information generating method.</p><p id="p0055" num="0055">In the above embodiments, a security device has been described which is provided with a method for encrypting the externally supplied confidential information mk assigned to the device, utilizing the device key k obtained by converting the device identifier generated according to the physical properties.</p><p id="p0056" num="0056">In the above embodiments, a security device has been described which is provided with a method for checking whether a device identifier according to the physical properties is generated correctly, by referring to a hash value.</p><p id="p0057" num="0057">In the above embodiments, a security device has been described which is<!-- EPO <DP n="19"> --> provided with a function of checking whether or not a device identifier to be generated according to the physical properties is generated correctly, by referring to a hash value, and counting the failures, and a function of notifying that generation of the device identifier fails when the failure count exceeds a threshold.</p><p id="p0058" num="0058">In the above embodiments, a security device has been described which is provided with a function of checking whether or not a device identifier to be generated according to the physical properties is generated correctly, by referring to a hash value, and counting the failures, and a function of executing generation of a new device identifier, in the case of successful device identifier generation, when the failure count till the success exceeds a threshold.</p><p id="p0059" num="0059">In the above embodiments, a security device has been described which is provided with a method for calculating a hash value in case of generating a new device identifier, thereby updating the last hash value.</p><p id="p0060" num="0060">In the above embodiments, a security device has been described which is provided with a method for checking, from an error bit count, the possibility of incorrectly generating a device identifier which is to be generated according to the physical properties, and if the error bit count exceeds a threshold, executing generation of a new device identifier.</p><p id="p0061" num="0061">In the above embodiments, a security device has been described which is provided with a method for storing an encryption result of the confidential information mk, in the nonvolatile memory.</p><p id="p0062" num="0062">In the above embodiments, a security device has been described which is provided with a method for encrypting the confidential information mk assigned to the device, and detecting tampering of data stored in the nonvolatile memory.</p><heading id="h0028"><b>Reference Signs List</b></heading><!-- EPO <DP n="20"> --><p id="p0063" num="0063">101, 102: security device; 110: CPU; 120: nonvolatile memory; 130: volatile memory; 140: I/O; 150-1, 150-2: key managing circuit; 151: PUF; 152: FEC; 153: HF; 154: HF'; 155: comparator; 156-1; error count monitor; 156-2: error bit count monitor; 160: cryptographic coprocessor; 170: local bus; 180: external port</p></description><claims mxw-id="PCLM56976219" lang="EN" load-source="patent-office"><!-- EPO <DP n="21"> --><claim id="c-en-0001" num="0001"><claim-text>A key information generation device which generates key information, comprising:
<claim-text>an identifier generating part which, based on physical properties of the key information generation device, generates an identifier specific to the key information generation device;</claim-text>
<claim-text>a key information generating part which, based on the identifier generated by the identifier generating part, generates the key information to be used for encrypting and decrypting confidential information;</claim-text>
<claim-text>a cryptographic part which encrypts and decrypts the confidential information using the key information generated by the key information generating part;</claim-text>
<claim-text>a hash part which generates a hash value in accordance with a predetermined hash value generating scheme that uses at least the key information generated by the key information generating part;</claim-text>
<claim-text>a storing part which stores encrypted confidential information and the hash value in a nonvolatile manner, the encrypted confidential information being formed by encrypting, with the cryptographic part, the confidential information using the key information generated by the key information generating part, the hash value being generated by the hash part in accordance with the hash value generating scheme that uses at least the key information used for encrypting the confidential information; and</claim-text>
<claim-text>a comparing part,</claim-text>
<claim-text>wherein the identifier generating part</claim-text>
<claim-text>regenerates the identifier when the cryptographic part decrypts the encrypted confidential information,</claim-text>
<claim-text>wherein the key information generating part<!-- EPO <DP n="22"> --></claim-text>
<claim-text>regenerates the key information used by the cryptographic part, based on the identifier regenerated by the identifier generating part, for decrypting the encrypted confidential information,</claim-text>
<claim-text>wherein the hash part</claim-text>
<claim-text>regenerates the hash value in accordance with the hash value generating scheme that uses at least the key information regenerated by the key information generating part,</claim-text>
<claim-text>wherein the comparing part</claim-text>
<claim-text>compares the hash value regenerated by the hash part and the hash value stored in the storing part, and</claim-text>
<claim-text>wherein the cryptographic part</claim-text>
<claim-text>decrypts the encrypted confidential information, when the hash value regenerated by the hash part and the hash value stored in the storing part are equal according to comparison by the comparing part, using the key information regenerated by the key information generating part.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The key information generation device according to claim 1, further comprising:
<claim-text>a monitoring part which causes the identifier generating part, the key information generating part, the hash part, and the comparing part, to execute a series of processes including: respective regenerating processes of the identifier generating part, the key information generating part, and the hash part; and a comparing process of the comparing part, repeatedly within a range where a repetition count does not exceed a threshold U which is a preset count, until a hash value being the same as the hash value stored in the storing part is regenerated by the hash part.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The key information generation device according to claim 2,<br/>
<!-- EPO <DP n="23"> -->wherein the cryptographic part<br/>
when the hash value being the same as the hash value stored in the storing part is regenerated by the hash part within the range where the repetition count of the series of processes does not exceed the threshold U, decrypts the encrypted confidential information in the storage part, using the key information regenerated which serves as a basis of regeneration of the same hash value regenerated, and<br/>
wherein the monitoring part<br/>
when the hash value being the same as the hash value stored in the storing part is regenerated by the hash value within the range where the repetition count of the series of processes does not exceed the threshold U, checks whether or not the identifier regenerated which serves as a basis of regeneration of the key information serving as the basis of regeneration of the hash value being the same as the hash value stored in the storing part is stably regenerated, based on a predetermined stability checking rule, and<br/>
if it is determined that the identifier is not regenerated stably,<br/>
causes the key information generating part to generate the key information from the identifier regenerated which serves as the basis of regeneration of the key information serving as the basis of regeneration of the hash value being the same as the hash value stored in the storing part,<br/>
causes the hash part to generate an updating hash value in accordance with the hash value generating scheme that uses at least the key information which the key information generating part has been caused to generate,<br/>
causes the cryptographic part to encrypt the confidential information decrypted, as the encrypted confidential information for updating, using the key information which the key information generating part has been caused to generate, and<br/>
updates the hash value and the encrypted confidential information which are<!-- EPO <DP n="24"> --> stored in the storing part, respectively by the hash value for updating which is generated by the hash part and the encrypted confidential information for updating which is encrypted by the cryptographic part.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The key information generation device according to claim 3, wherein the monitoring part checks, as the predetermined stability checking rule,<br/>
whether or not the repetition count of the series of processes exceeds a second threshold V which is a count equal to or smaller than the threshold U, and if the repetition count of the series of processes exceeds the second threshold V, determines that the identifier is not regenerated stably.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The key information generation device according to claim 3, further comprising:
<claim-text>an error correcting part which in the series of processes, executes a predetermined error correction process on the identifier regenerated by the identifier generating part,</claim-text>
<claim-text>wherein the key information generating part</claim-text>
<claim-text>in the series of processes, regenerates the key information from the identifier which is error-corrected by the error correcting part,</claim-text>
<claim-text>wherein the cryptographic part</claim-text>
<claim-text>when the hash value being the same as the hash value stored in the storing part is regenerated by the hash part within the range where the repetition count of the series of processes does not exceed the threshold U, decrypts the encrypted confidential information, using the key information which serves as the basis of regeneration of the same hash value regenerated and which is regenerated from the identifier that is error-corrected, and</claim-text>
<claim-text>wherein the monitoring part<!-- EPO <DP n="25"> --></claim-text>
<claim-text>in the series of processes, obtains an error bit count resulted from the error correction process of the error correcting part, and when the hash value being the same as the hash value stored in the storing part is regenerated by the hash part within the range where the repetition count of the series of processes does not exceed the threshold U,</claim-text>
<claim-text>checks, as the predetermined stability checking rule,</claim-text>
<claim-text>whether or not the error bit count exceeds a predetermined threshold B, and if the error bit count exceeds the threshold B, determines that the identifier is not regenerated stably.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The key information generation device according to claim 2, wherein the monitoring part<br/>
determines that regeneration of the key information fails when the repetition count of the series of processes exceeds the threshold U.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The key information generation device according to claim 1,<br/>
wherein the hash part employs, as the hash value generating scheme, either one of<br/>
a hash value of the key information generated by the key information generating part, and<br/>
a hash value of data formed by connecting the key information generated by the key information generating part and the encrypted confidential information encrypted by the cryptographic part.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A key information generation device which generates key information, comprising:
<claim-text>an identifier generating part which, based on physical properties of the key information generation device, generates an identifier specific to the key information<!-- EPO <DP n="26"> --> generation device;</claim-text>
<claim-text>a key information generating part which, based on the identifier generated by the identifier generating part, generates the key information to be used for encrypting and decrypting confidential information;</claim-text>
<claim-text>a cryptographic part which encrypts and decrypts the confidential information using the key information generated by the key information generating part;</claim-text>
<claim-text>a hash part which generates a hash value in accordance with a predetermined hash value generating scheme that uses at least the identifier generated by the identifier generating part;</claim-text>
<claim-text>a storing part which stores encrypted confidential information and the hash value in a nonvolatile manner, the encrypted confidential information being formed by encrypting, with the cryptographic part, the confidential information using the key information generated by the key information generating part, the hash value being generated by the hash part in accordance with the hash value generating scheme that uses at least the identifier serving as a basis of generation of the key information used for encrypting the confidential information; and</claim-text>
<claim-text>a comparing part,</claim-text>
<claim-text>wherein the identifier generating part</claim-text>
<claim-text>regenerates the identifier when the cryptographic part decrypts the encrypted confidential information,</claim-text>
<claim-text>wherein the key information generating part</claim-text>
<claim-text>regenerates the key information used by the cryptographic part, based on the identifier regenerated by the identifier generating part, for decrypting the encrypted confidential information,</claim-text>
<claim-text>wherein the hash part<!-- EPO <DP n="27"> --></claim-text>
<claim-text>regenerates the hash value in accordance with the hash value generating scheme that uses at least the identifier regenerated by the identifier generating part,</claim-text>
<claim-text>wherein the comparing part</claim-text>
<claim-text>compares the hash value regenerated by the hash part and the hash value stored in the storing part, and</claim-text>
<claim-text>wherein the cryptographic part</claim-text>
<claim-text>decrypts the encrypted confidential information, when the hash value regenerated by the hash part and the hash value stored in the storing part are equal according to comparison by the comparing part, using the key information regenerated by the key information generating part.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The key information generation device according to claim 8,<br/>
wherein the hash part employs, as the hash value generating scheme, either one of<br/>
a hash value of the identifier generated by the identifier generating part, and<br/>
a hash value of data formed by connecting the identifier generated by the identifier generating part and the encrypted confidential information encrypted by the cryptographic part.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A key information generation method conducted by a key information generation device comprising an identifier generating part, a key information generating part, a cryptographic part, a hash part, a storing part, and a comparing part, the key information generation method comprising:
<claim-text>generating, with the identifier generating part,</claim-text>
<claim-text>based on physical properties of the key information generation device, an identifier specific to the key information generation device,</claim-text>
<claim-text>generating, with the key information generating part,<!-- EPO <DP n="28"> --></claim-text>
<claim-text>based on the identifier generated by the identifier generating part, the key information to be used for encrypting and decrypting confidential information,</claim-text>
<claim-text>encrypting and decrypting, with the cryptographic part,</claim-text>
<claim-text>the confidential information using the key information generated by the key information generating part;</claim-text>
<claim-text>generating, with the hash part,</claim-text>
<claim-text>a hash value in accordance with a predetermined hash value generating scheme that uses at least the key information generated by the key information generating part;</claim-text>
<claim-text>storing, with the storing part,</claim-text>
<claim-text>encrypted confidential information and the hash value in a nonvolatile manner, the encrypted confidential information being formed by encrypting, with the cryptographic part, the confidential information using the key information generated by the key information generating part, the hash value being generated by the hash part in accordance with the hash value generating scheme that uses at least the key information used for encrypting the confidential information;</claim-text>
<claim-text>regenerating, with the identifier generating part,</claim-text>
<claim-text>the identifier when the cryptographic part decrypts the encrypted confidential information;</claim-text>
<claim-text>regenerating, with the key information generating part,</claim-text>
<claim-text>the key information used by the cryptographic part, based on the identifier regenerated by the identifier generating part, for decrypting the encrypted confidential information;</claim-text>
<claim-text>regenerating, with the hash part,</claim-text>
<claim-text>the hash value in accordance with the hash value generating scheme that uses at least the key information regenerated by the key information generating part;<!-- EPO <DP n="29"> --></claim-text>
<claim-text>comparing, with the comparing part,</claim-text>
<claim-text>the hash value regenerated by the hash part and the hash value stored in the storing part; and</claim-text>
<claim-text>decrypting, with the cryptographic part,</claim-text>
<claim-text>the encrypted confidential information, when the hash value regenerated by the hash part and the hash value stored in the storing part are equal according to comparison by the comparing part, using the key information regenerated by the key information generating part.</claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The key information generation method according to claim 10,<br/>
wherein the key information generation device further comprises a monitoring part, and<br/>
wherein the key information generation method comprises:
<claim-text>causing, with the monitoring part,</claim-text>
<claim-text>the identifier generating part, the key information generating part, the hash part, and the comparing part, to execute a series of processes including: respective regenerating processes of the identifier generating part, the key information generating part, and the hash part; and a comparing process of the comparing part, repeatedly within a range where a repetition count does not exceed a threshold U which is a preset count, until a hash value being the same as the hash value stored in the storing part is regenerated by the hash part.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The key information generation method according to claim 11, comprising:
<claim-text>decrypting, with the cryptographic part,</claim-text>
<claim-text>when a hash value being the same as the hash value stored in the storing part is regenerated by the hash part within the range where the repetition count of the series of<!-- EPO <DP n="30"> --> processes does not exceed the threshold U, the encrypted confidential information in the storage part, using the key information regenerated which serves as a basis of regeneration of the same hash value regenerated; and</claim-text>
<claim-text>checking, with the monitoring part,</claim-text>
<claim-text>when the hash value being the same as the hash value stored in the storing part is regenerated by the hash value within the range where the repetition count of the series of processes does not exceed the threshold U, whether or not the identifier regenerated which serves as a basis of regeneration of the key information serving as the basis of regeneration of the hash value being the same as the hash value stored in the storing part is stably regenerated, based on a predetermined stability checking rule, and</claim-text>
<claim-text>if it is determined that the identifier is not regenerated stably,</claim-text>
<claim-text>causing the key information generating part to generate the key information from the identifier regenerated which serves as the basis of regeneration of the key information serving as the basis of regeneration of the hash value being the same as the hash value stored in the storing part,</claim-text>
<claim-text>causing the hash part to generate an updating hash value from the key information which the key information generating part has been caused to generate,</claim-text>
<claim-text>causing the cryptographic part to encrypt the confidential information decrypted, as the encrypted confidential information for updating, using the key information which the key information generating part has been caused to generate, and</claim-text>
<claim-text>updating the hash value stored in the storing part and the encrypted confidential information, respectively by the hash value for updating which is generated by the hash part and the encrypted confidential information for updating which is encrypted by the cryptographic part.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16667001" load-source="patent-office"><!-- EPO <DP n="31"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="150" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="164" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="162" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="165" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
