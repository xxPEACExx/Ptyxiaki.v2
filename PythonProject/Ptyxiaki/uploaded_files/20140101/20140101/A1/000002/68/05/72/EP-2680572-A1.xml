<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680572-A1" country="EP" doc-number="2680572" kind="A1" date="20140101" family-id="46720213" file-reference-id="252638" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549117" ucid="EP-2680572-A1"><document-id><country>EP</country><doc-number>2680572</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-11859050-A" is-representative="NO"><document-id mxw-id="PAPP154823040" load-source="docdb" format="epo"><country>EP</country><doc-number>11859050</doc-number><kind>A</kind><date>20110622</date><lang>JA</lang></document-id><document-id mxw-id="PAPP220439655" load-source="docdb" format="original"><country>EP</country><doc-number>11859050.4</doc-number><date>20110622</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140454114" ucid="JP-2011003550-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011003550</doc-number><kind>W</kind><date>20110622</date></document-id></priority-claim><priority-claim mxw-id="PPC140453249" ucid="JP-2011034491-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011034491</doc-number><kind>A</kind><date>20110221</date></document-id></priority-claim></priority-claims><dates-of-public-availability><search-report-dispatch-date><date>20131010</date></search-report-dispatch-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1988118296" load-source="docdb">H04N   5/378       20110101ALI20131004BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1988129293" load-source="docdb">H04N   5/365       20110101AFI20131004BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2083196060" load-source="docdb" scheme="CPC">H04N   5/361       20130101 LI20150318BHEP        </classification-cpc><classification-cpc mxw-id="PCL1988122133" load-source="docdb" scheme="CPC">H04N   5/357       20130101 FI20131017BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132179835" lang="DE" load-source="patent-office">BILDERZEUGUNGSVORRICHTUNG, BILDERZEUGUNGSVERFAHREN UND ENTSPRECHENDES PROGRAMM</invention-title><invention-title mxw-id="PT132179836" lang="EN" load-source="patent-office">IMAGING DEVICE, IMAGING METHOD AND PROGRAM</invention-title><invention-title mxw-id="PT132179837" lang="FR" load-source="patent-office">DISPOSITIF D'IMAGERIE, PROCÉDÉ D'IMAGERIE ET PROGRAMME</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918134498" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>PANASONIC CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR918141783" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>PANASONIC CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR918987083" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Panasonic Corporation</last-name><iid>101295897</iid><address><street>1006, Oaza Kadoma Kadoma-shi</street><city>Osaka 571-8501</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918150780" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>TSURUBE TOMOYUKI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918144862" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>TSURUBE, TOMOYUKI</last-name></addressbook></inventor><inventor mxw-id="PPAR918993187" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>TSURUBE, TOMOYUKI</last-name><address><street>c/o Panasonic Corporation Intellectual Property Center IP Development Group 7F OBP Panasonic Tower 2-1-61 Shiromi, Chuo-ku</street><city>Osaka 540-6207</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918149515" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>TOYODA KEIJI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918171024" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>TOYODA, KEIJI</last-name></addressbook></inventor><inventor mxw-id="PPAR918991066" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>TOYODA, KEIJI</last-name><address><street>c/o Panasonic Corporation Intellectual Property Center IP Development Group 7F OBP Panasonic Tower 2-1-61 Shiromi, Chuo-ku</street><city>Osaka 540-6207</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918155408" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>HIROSE NOBUYUKI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR918150251" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>HIROSE, NOBUYUKI</last-name></addressbook></inventor><inventor mxw-id="PPAR918991050" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>HIROSE, NOBUYUKI</last-name><address><street>c/o Panasonic Corporation Intellectual Property Center IP Development Group 7F OBP Panasonic Tower 2-1-61 Shiromi, Chuo-ku</street><city>Osaka 540-6207</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918980722" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Vigand, Philippe</last-name><suffix>et al</suffix><iid>101349517</iid><address><street>Novagraaf International SA 3 chemin de l'Echo</street><city>1213 Onex Geneva</city><country>CH</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2011003550-W"><document-id><country>JP</country><doc-number>2011003550</doc-number><kind>W</kind><date>20110622</date><lang>JA</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012114390-A1"><document-id><country>WO</country><doc-number>2012114390</doc-number><kind>A1</kind><date>20120830</date><lang>JA</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548802234" load-source="docdb">AL</country><country mxw-id="DS548801413" load-source="docdb">AT</country><country mxw-id="DS548845769" load-source="docdb">BE</country><country mxw-id="DS548842777" load-source="docdb">BG</country><country mxw-id="DS548843780" load-source="docdb">CH</country><country mxw-id="DS548845770" load-source="docdb">CY</country><country mxw-id="DS548843328" load-source="docdb">CZ</country><country mxw-id="DS548802235" load-source="docdb">DE</country><country mxw-id="DS548845771" load-source="docdb">DK</country><country mxw-id="DS548845772" load-source="docdb">EE</country><country mxw-id="DS548835775" load-source="docdb">ES</country><country mxw-id="DS548842778" load-source="docdb">FI</country><country mxw-id="DS548842779" load-source="docdb">FR</country><country mxw-id="DS548802236" load-source="docdb">GB</country><country mxw-id="DS548845773" load-source="docdb">GR</country><country mxw-id="DS548802237" load-source="docdb">HR</country><country mxw-id="DS548843329" load-source="docdb">HU</country><country mxw-id="DS548843781" load-source="docdb">IE</country><country mxw-id="DS548845774" load-source="docdb">IS</country><country mxw-id="DS548842780" load-source="docdb">IT</country><country mxw-id="DS548845775" load-source="docdb">LI</country><country mxw-id="DS548842781" load-source="docdb">LT</country><country mxw-id="DS548801414" load-source="docdb">LU</country><country mxw-id="DS548842782" load-source="docdb">LV</country><country mxw-id="DS548842783" load-source="docdb">MC</country><country mxw-id="DS548801415" load-source="docdb">MK</country><country mxw-id="DS548801416" load-source="docdb">MT</country><country mxw-id="DS548801417" load-source="docdb">NL</country><country mxw-id="DS548843782" load-source="docdb">NO</country><country mxw-id="DS548801418" load-source="docdb">PL</country><country mxw-id="DS548835776" load-source="docdb">PT</country><country mxw-id="DS548847757" load-source="docdb">RO</country><country mxw-id="DS548835777" load-source="docdb">RS</country><country mxw-id="DS548801419" load-source="docdb">SE</country><country mxw-id="DS548802238" load-source="docdb">SI</country><country mxw-id="DS548843783" load-source="docdb">SK</country><country mxw-id="DS548843784" load-source="docdb">SM</country><country mxw-id="DS548845776" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128669787" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Of the output signals of a solid state image sensor 101, only the signals in a vertical OB line period are selected by an OB line selector 105. A level adjuster 107 adjusts the level of a past vertical OB line signal read out from the line memory 106 during a first vertical OB line period of a frame where the amplification factor of an amplifier 102 has changed, and outputs the same. A subtractor 109 subtracts the signal whose level has been adjusted from a current vertical OB line signal. A multiplier 111 multiplies, via a selector B 111, the signal after subtraction by a cyclic coefficient K<sub>1H</sub> for the first vertical OB line period of the frame where the amplification factor has changed. A subtractor 112 subtracts the multiplication result from the current vertical OB line signal, and rewrites the subtraction result to the line memory 106.<img id="iaf01" file="imgaf001.tif" wi="105" he="83" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499160" lang="EN" source="EPO" load-source="docdb"><p>Of the output signals of a solid state image sensor 101, only the signals in a vertical OB line period are selected by an OB line selector 105. A level adjuster 107 adjusts the level of a past vertical OB line signal read out from the line memory 106 during a first vertical OB line period of a frame where the amplification factor of an amplifier 102 has changed, and outputs the same. A subtractor 109 subtracts the signal whose level has been adjusted from a current vertical OB line signal. A multiplier 111 multiplies, via a selector B 111, the signal after subtraction by a cyclic coefficient K 1H  for the first vertical OB line period of the frame where the amplification factor has changed. A subtractor 112 subtracts the multiplication result from the current vertical OB line signal, and rewrites the subtraction result to the line memory 106.</p></abstract><description mxw-id="PDES63955217" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">Technical Field</heading><p id="p0001" num="0001">The present invention relates to an imaging device that uses a solid state image sensor, an imaging method and a program.</p><heading id="h0002">Background Art</heading><p id="p0002" num="0002">Conventionally, an imaging device that uses a solid state image sensor has a problem concerning image quality deterioration due to cyclic clock noise due to system or noise due to a defect in a vertical transfer register. Although the level itself of the noise is extremely low, the noise shows on a screen as fixed vertical line noise and is highly visible, resulting in significant deterioration in the image quality. Furthermore, a smear phenomenon of linear blown-out highlights occurring on the overall image at the time of imaging an object with much higher brightness than its surroundings is also one of the main causes of image quality deterioration.</p><p id="p0003" num="0003">A method of removing such vertical line noise is being studied, and Patent Literature 1 (Japanese Patent Laid-Open No. <patcit id="pcit0001" dnum="JP7067038A"><text>7-67038</text></patcit>) discloses a method of reducing white lines or the like and the smear by integrating (averaging) output signals of an optical black pixel part in the vertical direction (vertical OB region) of a solid sate image sensor on a per pixel basis and averaging random noise components to zero to thereby detect a<!-- EPO <DP n="2"> --> fixed pattern noise signal, and subtracting the fixed pattern noise signal from output signals of an effective pixel part of the solid sate image sensor.</p><p id="p0004" num="0004"><figref idrefs="f0004">Figure 4</figref> is a block diagram showing an overview of an example configuration of a conventional imaging device at the time of performing correction of vertical line noise (hereinafter, referred to simply as "vertical line") using a vertical OB region as described above which is an optically black region.</p><p id="p0005" num="0005">As shown in <figref idrefs="f0004">Figure 4</figref>, an output signal from a solid state image sensor 1001 is amplified by an amplifier 1002, quantized by an AD converter 1003, and then input to a vertical line correction unit 1004.</p><p id="p0006" num="0006">The vertical line correction unit 1004 includes an OB line selector 1005, a line memory 1006, a line integrator 1007, and a subtractor 1008.</p><p id="p0007" num="0007">Of the signals of an effective pixel region and the signals of a vertical OB region, the OB line selector 1005 outputs only the signals of the vertical OB region. The line integrator 1007 line-integrates (averages) the signals of the vertical OB region on a per pixel basis using the line memory 1006. Random noise is thereby removed, and a correction value for one line is obtained. This correction value is stored in the line memory 1006. The line integrator 1007 reads out the correction value stored in the line memory 1006, and outputs the same to the subtractor 1008. The subtractor 1008 subtracts the correction value described above from each line signal input from the solid state image sensor 1001 on a per pixel basis. A signal from which the<!-- EPO <DP n="3"> --> vertical line noise is removed (which has been corrected in terms of vertical lines) is obtained in this manner.</p><heading id="h0003">Citation List</heading><heading id="h0004">Patent Literature</heading><p id="p0008" num="0008"><ul><li>Patent Literature 1: Japanese Patent Laid-Open No. <patcit id="pcit0002" dnum="JP7067038A"><text>7-67038</text></patcit></li></ul></p><heading id="h0005">Summary of Invention</heading><heading id="h0006">Technical Problem</heading><p id="p0009" num="0009">However, with a conventional method as described above, if the number of lines in the vertical OB region provided in the solid state image sensor is small, the number of times of averaging per one pixel in the vertical direction at the time of performing line integration (averaging) in a frame is reduced, and the noise is sometimes not sufficiently reduced, and the noise may remain in the signal after correction. Also, in the case of performing averaging between frames, the noise and vertical lines may remain especially if the gain of the amplifier 1002 of the imaging device is changed between the frames.</p><p id="p0010" num="0010">The present invention is made in view of the issues of a conventional imaging device as described above, and its object is to provide a technique for obtaining high image quality by appropriately performing vertical line correction even if the number of lines in a vertical OB region is small or the gain of an amplifier is changed between frames.<!-- EPO <DP n="4"> --></p><heading id="h0007">Solution to Problem</heading><p id="p0011" num="0011">To solve the issue described above, an imaging device of the present invention includes a solid state image sensor including an optical black region, and a vertical line correction unit for performing vertical line correction on an output signal of the solid state image sensor, wherein the vertical line correction unit includes an OB line selector for selecting an optical black line signal included in output signals of the solid state image sensor, a memory for storing the optical black line signal, a level adjuster for adjusting a level of an optical black line signal of a past frame read out from the memory, according to a video gain of the output signal of the solid state image sensor, a first subtractor for calculating a difference signal between a first optical black line signal of a current frame and the optical black line signal of the past frame whose level has been adjusted, a multiplier for calculating a product by multiplying the difference signal by a cyclic coefficient, a second subtractor for obtaining a signal which is the optical black line signal of the current frame from which the product of the difference signal and the cyclic coefficient has been subtracted, and rewriting the signal after subtraction to the memory as an optical black line signal, and a third subtractor for subtracting a signal read out from the memory from an output signal from an effective pixel region of the solid state image sensor.</p><p id="p0012" num="0012">Also, an imaging method of the present method is an imaging method of performing vertical line correction on an output signal of a solid state image sensor including an optical black region, the method including a step of selecting an optical black line signal included in output signals of the solid state image sensor, a step of storing the optical black line signal in a memory,<!-- EPO <DP n="5"> --> a step of reading an optical black line signal of a past frame from the memory and adjusting a level according to a video gain of the output signal of the solid state image sensor, a first subtracting step of calculating a difference signal between a first optical black line signal of a current frame and the optical black line signal of the past frame whose level has been adjusted, a step of calculating a product by multiplying the difference signal by a cyclic coefficient, a second subtracting step of obtaining a signal which is the optical black line signal of the current frame from which the product of the difference signal and the cyclic coefficient has been subtracted, and rewriting the signal after subtraction to the memory as an optical black line signal, and a third subtracting step of subtracting a signal read out from the memory from an output signal from an effective pixel region of the solid state image sensor.</p><p id="p0013" num="0013">Furthermore, a program of the present invention is a program for performing vertical line correction on an output signal of a solid state image sensor including an optical black region, the program being for causing a computer to execute the following steps: a step of selecting an optical black line signal included in output signals of the solid state image sensor, a step of storing the optical black line signal in a memory, a step of reading an optical black line signal of a past frame from the memory and adjusting a level according to a video gain of the output signal of the solid state image sensor, a first subtracting step of calculating a difference signal between a first optical black line signal of a current frame and the optical black line signal of the past frame whose level has been adjusted, a step of calculating a product by multiplying the difference signal by a cyclic coefficient, a second subtracting step of obtaining a signal which is the optical black line signal of the current frame from which the product of the difference signal and the cyclic<!-- EPO <DP n="6"> --> coefficient has been subtracted, and rewriting the signal after subtraction to the memory as an optical black line signal, and a third subtracting step of subtracting a signal read out from the memory from an output signal from an effective pixel region of the solid state image sensor.</p><heading id="h0008">Advantageous Effects of Invention</heading><p id="p0014" num="0014">According to the present invention, even when the number of lines in a vertical OB region is small, noise is effectively reduced by a cyclic operation between frames, and appropriate vertical line correction may be performed. Also, even when the gain of an amplifier of the imaging device is changed between frames, the level of a vertical OB line signal cycled to the previous frame may be adjusted to the extent of a change in a video level and be cycled. As a result, vertical line correction may be performed while reducing the correction residue by causing the level of a vertical line correction signal to follow the video level change such as a change in an amplification factor.</p><heading id="h0009">Brief Description of Drawings</heading><p id="p0015" num="0015"><ul><li>[<figref idrefs="f0001">Figure 1] Figure 1</figref> is a block diagram showing a configuration of an imaging device according to an embodiment.</li><li>[<figref idrefs="f0002">Figure 2] Figure 2</figref> is an explanatory diagram of gain adjustment by the imaging device according to the embodiment.</li><li>[<figref idrefs="f0003">Figure 3] Figure 3</figref> is a flow chart of signal processing according to the embodiment.</li><li>[<figref idrefs="f0004">Figure 4] Figure 4</figref> is a block diagram showing an overview of an example configuration of a conventional imaging device at the time of performing<!-- EPO <DP n="7"> --> correction for removal of vertical line noise using a vertical OB region which is an optically black region.</li></ul></p><heading id="h0010">Description of Embodiment</heading><p id="p0016" num="0016">Hereinafter, an embodiment for carrying out the present invention will be described with reference to the drawings.</p><heading id="h0011">Embodiment</heading><p id="p0017" num="0017"><figref idrefs="f0001">Figure 1</figref> is a block diagram showing a configuration of an imaging device according to a present embodiment.</p><p id="p0018" num="0018">An output signal of a solid state image sensor 101 is amplified by an amplifier 102, quantized by an AD converter 103, and then input to a vertical line correction unit 104.</p><p id="p0019" num="0019">The vertical line correction unit 104 includes an OB line selector 105, a line memory 106, a level adjuster 107, a first selector (a selector A) 108, a second selector (a selector B) 110, a multiplier 111, and three subtractors 109, 112 and 113.</p><p id="p0020" num="0020">Signals Q<sub>n</sub> quantized by the AD converter 103 are input to the OB line selector 105, and of the signals Q<sub>n</sub>, only the signals in a vertical OB line period (vertical OB line signals: X<sub>n</sub>) are output.</p><p id="p0021" num="0021"><!-- EPO <DP n="8"> --> A subtraction result Y<sub>n</sub> obtained by performing an operation described later on the vertical OB line signal X<sub>n</sub> is rewritten to the line memory 106 for each frame.</p><p id="p0022" num="0022">With respect to the subtraction result stored in the line memory 106, in the case the vertical OB line signal X<sub>n</sub> is the first vertical OB line signal in a frame, the vertical OB line signal Y<sub>n-1</sub> of a past frame is emitted to the level adjuster 107. This vertical OB line signal Y<sub>n-1</sub> of a past frame is a vertical OB line signal of a past frame read out from the line memory 106 during a period of input of the first vertical OB line signal in a frame to the vertical line correction unit 104.</p><p id="p0023" num="0023">On the other hand, in the case the vertical OB line signal X<sub>n</sub> is a vertical OB line signal of a second or later line, the vertical OB line signal Y<sub>n-1</sub> of a past frame is emitted to the selector A 108 without going through the level adjuster 107.</p><p id="p0024" num="0024">When the vertical OB line signal Y<sub>n-1</sub> of a past frame is emitted to the level adjuster 107 in the case the vertical OB line signal X<sub>n</sub> is the first vertical OB line signal in a frame, the level adjuster 107 adjusts the level of the vertical OB line signal Y<sub>n-1</sub>, according to the amplification factor of the amplifier 102, and outputs the vertical OB line signal Y<sub>n-1</sub> which has been adjusted to the selector A 108. Additionally, level adjustment according to the amplification factor of the amplifier 102 will be described later.</p><p id="p0025" num="0025">In the case the vertical OB line signal X<sub>n</sub> is the first vertical OB line signal in a frame, the selector A 108 emits the vertical OB line signal Y<sub>n-1</sub><!-- EPO <DP n="9"> --> after level adjustment to the subtractor 109, and in the case the vertical OB line signal X<sub>n</sub> is the vertical OB line signal of a second or later line, the selector A 108 emits the vertical OB line signal Y<sub>n-1</sub> of a past frame to the subtractor 109.</p><p id="p0026" num="0026">The subtractor 109 receives input of the vertical OB line signal X<sub>n</sub> from the OB line selector 105 and the vertical OB line signal Y<sub>n-1</sub> from the selector A 108, subtracts the vertical OB line signal Y<sub>n-1</sub> from the vertical OB line signal X<sub>n</sub>, and outputs the result (X<sub>n</sub> - Y<sub>n-1</sub>) to the multiplier 111.</p><p id="p0027" num="0027">In the case the vertical OB line signal X<sub>n</sub> is the first vertical OB line signal in a frame, the selector B 110 outputs a cyclic coefficient K<sub>1H</sub> to the multiplier 111, and in the case the vertical OB line signal X<sub>n</sub> is the vertical OB line signal of a second or later line, the selector B 110 outputs a cyclic coefficient K to the multiplier 111.</p><p id="p0028" num="0028">The multiplier 111 receives input of the subtraction result (X<sub>n</sub> - Y<sub>n-1</sub>) and the cyclic coefficient K<sub>1H</sub> or K, and multiplies the two. That is, in the case the vertical OB line signal X<sub>n</sub> is the first vertical OB line signal in a frame, (X<sub>n</sub> - Y<sub>n-1</sub>) is multiplied by the cyclic coefficient K<sub>1H</sub> and K<sub>1H</sub>(X<sub>n</sub> - Y<sub>n-1</sub>) is obtained, and in the case the vertical OB line signal X<sub>n</sub> is the vertical OB line signal of a second or later line, (X<sub>n</sub> - Y<sub>n-1</sub>) is multiplied by the cyclic coefficient K and K(X<sub>n</sub> - Y<sub>n-1</sub>) is obtained. Then, the multiplication result is output to the subtractor 112.</p><p id="p0029" num="0029">The subtractor 112 receives input of the vertical OB line signal X<sub>n</sub> from the OB line selector 105, and K<sub>1H</sub>(X<sub>n</sub> - Y<sub>n-1</sub>) or K(X<sub>n</sub> - Y<sub>n-1</sub>) from the multiplier<!-- EPO <DP n="10"> --> 111, subtracts K<sub>1H</sub>(X<sub>n</sub> - Y<sub>n-1</sub>) or K(X<sub>n</sub> - Y<sub>n-1</sub>) from the vertical OB line signal X<sub>n</sub>, and outputs the result to the subtractor 113 and the line memory 106 as a vertical OB line signal Y<sub>n</sub> to be rewritten to the line memory.</p><p id="p0030" num="0030">The cyclic operation is repeated thereafter.</p><p id="p0031" num="0031">That is, with the cyclic operation described above, in the case the vertical OB line signal X<sub>n</sub> is the first vertical OB line signal in a frame, the following Equation (1) is obtained as the vertical OB line signal Y<sub>n</sub> to be rewritten to the line memory, and in the case the vertical OB line signal X<sub>n</sub> is the vertical OB line signal of a second or later line, the following Equation (2) is obtained as the vertical OB line signal Y<sub>n</sub>.</p><p id="p0032" num="0032">[Expression 1] <maths id="math0001" num="Equation (1)"><math display="block"><msub><mi mathvariant="normal">Y</mi><mi mathvariant="normal">n</mi></msub><mo>=</mo><msub><mi mathvariant="normal">X</mi><mi mathvariant="normal">n</mi></msub><mo>-</mo><msub><mi mathvariant="normal">K</mi><mrow><mn mathvariant="normal">1</mn><mo>⁢</mo><mi mathvariant="normal">H</mi></mrow></msub><mo>⋅</mo><mfenced separators=""><msub><mi mathvariant="normal">X</mi><mi mathvariant="normal">n</mi></msub><mo>-</mo><msub><mi mathvariant="normal">Y</mi><mrow><mi mathvariant="normal">n</mi><mo>-</mo><mn mathvariant="normal">1</mn></mrow></msub></mfenced><mo>=</mo><mfenced separators=""><mn mathvariant="normal">1</mn><mo>-</mo><msub><mi mathvariant="normal">K</mi><mrow><mn mathvariant="normal">1</mn><mo>⁢</mo><mi mathvariant="normal">H</mi></mrow></msub></mfenced><mo>⋅</mo><msub><mi mathvariant="normal">X</mi><mi mathvariant="normal">n</mi></msub><mo>+</mo><msub><mi mathvariant="normal">K</mi><mrow><mn mathvariant="normal">1</mn><mo>⁢</mo><mi mathvariant="normal">H</mi></mrow></msub><mo>⋅</mo><msub><mi mathvariant="normal">Y</mi><mrow><mi mathvariant="normal">n</mi><mo>-</mo><mn mathvariant="normal">1</mn></mrow></msub></math><img id="ib0001" file="imgb0001.tif" wi="136" he="17" img-content="math" img-format="tif"/></maths></p><p id="p0033" num="0033">[Expression 2] <maths id="math0002" num="Equation (2)"><math display="block"><msub><mi mathvariant="normal">Y</mi><mi mathvariant="normal">n</mi></msub><mo>=</mo><msub><mi mathvariant="normal">X</mi><mi mathvariant="normal">n</mi></msub><mo>-</mo><mi mathvariant="normal">K</mi><mo>⋅</mo><mfenced separators=""><msub><mi mathvariant="normal">X</mi><mi mathvariant="normal">n</mi></msub><mo>-</mo><msub><mi mathvariant="normal">Y</mi><mrow><mi mathvariant="normal">n</mi><mo>-</mo><mn mathvariant="normal">1</mn></mrow></msub></mfenced><mo>=</mo><mfenced separators=""><mn mathvariant="normal">1</mn><mo>-</mo><mi mathvariant="normal">K</mi></mfenced><mo>⋅</mo><msub><mi mathvariant="normal">X</mi><mi mathvariant="normal">n</mi></msub><mo>+</mo><mi mathvariant="normal">K</mi><mo>⋅</mo><msub><mi mathvariant="normal">Y</mi><mrow><mi mathvariant="normal">n</mi><mo>-</mo><mn mathvariant="normal">1</mn></mrow></msub></math><img id="ib0002" file="imgb0002.tif" wi="121" he="17" img-content="math" img-format="tif"/></maths></p><p id="p0034" num="0034">A signal Q<sub>n</sub> quantized by the AD converter 103 and the vertical OB line signal Y<sub>n</sub> expressed by Equation (1) or (2) mentioned above from the subtractor 112 are input to the subtractor 113. The subtractor 113 performs a vertical line correction operation by taking the vertical OB line signal Y<sub>n</sub> expressed by Equation (1) or (2) mentioned above as a vertical line correction signal and subtracting the same from the quantized signal Q<sub>n</sub>.<!-- EPO <DP n="11"> --></p><p id="p0035" num="0035"><figref idrefs="f0002">Figure 2</figref> is a diagram for describing gain adjustment performed by the level adjuster 107 according to the present embodiment.</p><p id="p0036" num="0036">It is assumed that the gain of the amplifier 102 changes from Ga to Gb in a blanking period between a frame 1 and a frame 2. In this case, the video signal level of the frame 2 is Gb/Ga times with respect to the video signal level of the frame 1.</p><p id="p0037" num="0037">Then, a vertical OB line signal of a past frame read out from the line memory 106 in the first line of vertical OB lines is multiplied by a gain value for level adjustment Gb/Ga, and the level is adjusted to be near the level of a current vertical OB line signal. Then, the cyclic operation of (Equation 1) is performed on the vertical OB line signal which has been adjusted, and the signal is written again to the line memory 106 as an adjusted signal Y<sub>n</sub>.</p><p id="p0038" num="0038">The gain of the amplifier 102 is not changed for the same frame for the second or later line of the vertical OB lines, and signal adjustment is not necessary. Accordingly, the gain value for level adjustment is returned to one for the second or later line of the vertical OB lines.</p><p id="p0039" num="0039">By the operation described above, the level of the signal Y<sub>n</sub> stored in the line memory 106 and the level of the vertical OB line signal will be approximately similar for the frame 1 and the frame 2 regardless of the gain, and the vertical line correction described above is enabled.</p><p id="p0040" num="0040"><!-- EPO <DP n="12"> --><figref idrefs="f0003">Figure 3</figref> is a flow chart of signal processing according to the present embodiment, and each step described below forms an imaging method of the present invention.</p><p id="p0041" num="0041">First, to generate a vertical line correction signal, a vertical OB line signal Y<sub>n-1</sub> stored in the line memory 106 in a past frame is read out (S301). Next, whether a quantized signal input from the solid state image sensor 101 via the amplifier 102 and the AD converter 103 is of the first line of vertical OB or not is determined (S302).</p><p id="p0042" num="0042">If the signal is of the first line of vertical OB (S302: Yes), level adjustment for the signal Y<sub>n-1</sub> read out in S301 is performed. Specifically, replacement by [Y<sub>n-1</sub> x Gb/Ga] as the new Y<sub>n-1</sub> is performed (S303). Additionally, in the case the quantized signal mentioned above is not of the first line of vertical OB (S302: No), it is of the second or later line of the vertical OB, and the Y<sub>n-1</sub> is left unchanged.</p><p id="p0043" num="0043">Next, the Y<sub>n-1</sub> is subtracted from a signal X<sub>n</sub> of the current vertical OB line (S304).</p><p id="p0044" num="0044">Furthermore, whether the current signal is of the first line of the vertical OB or not is determined (S305), and if the signal is of the first line of the vertical OB (S305: Yes), multiplication by the cyclic coefficient K<sub>1H</sub> is performed, and K<sub>1H</sub> . (X<sub>n</sub> - Y<sub>n-1</sub>) is calculated (S306).</p><p id="p0045" num="0045"><!-- EPO <DP n="13"> --> On the other hand, if the signal is of the second or later line of the vertical OB (S305: No), multiplication by the cyclic coefficient K is performed, and K . (X<sub>n</sub> - Y<sub>n-1</sub>) is calculated (S307).</p><p id="p0046" num="0046">Then, the Y<sub>n</sub> given by Equation 1 or 2 mentioned above is calculated using the value obtained in S306 or S307 (S308), and this is stored in the line memory 106 again (S309).</p><p id="p0047" num="0047">Whether or not the vertical OB lines are over is determined (S31 0), and if they are not over (S31 0: No), the steps are repeated from S301. On the other hand, in the case the vertical OB lines are over (S31 0: Yes), the signal stored in the line memory 106 is read out as the vertical line correction signal and is subtracted from an effective pixel to thereby perform vertical line correction (S311).</p><p id="p0048" num="0048">In this manner, by causing the level of a vertical line correction signal to follow the video level change, vertical line correction with small correction residue is performed.</p><p id="p0049" num="0049">In the process described above, grasping of whether a current signal is of the first line or the second or later line in the vertical OB region or whether it is of an effective pixel region may be performed using an interrupt process, for example.</p><p id="p0050" num="0050">Additionally, in the embodiment described above, the change in the gain is described as the change in the amplification factor of the amplifier before AD conversion, but the gain may also be changed by performing<!-- EPO <DP n="14"> --> multiplication on a quantized signal after AD conversion. Such a mode after change is also included within the scope of the present invention. Also, with respect to gain adjustment for the first line of vertical OB, multiplication by Gb/Ga is not restrictive, and adjustment by addition of another factor separately determined is also possible. Also, an operation of adjusting the level by reading out a signal stored in the line memory 106 as the vertical line correction signal, subtracting the same from an effective pixel, and then adding or subtracting a certain value, or an operation of adjusting the level by adding or subtracting a certain value to or from a signal read out from the line memory 106 and then subtracting the same by the subtractor 113 is easily conceivable.</p><p id="p0051" num="0051">Heretofore, the imaging device and the imaging method of the present invention have been described using an embodiment, but it is apparent that each step forming the imaging method described above may be executed according to a program recording the step and by using a computer.</p><heading id="h0012">Industrial Applicability</heading><p id="p0052" num="0052">According to the present invention, by causing the level of a vertical line correction signal to follow the video level change such as a change in the amplification factor, vertical line correction may be performed while reducing the correction residue.</p><heading id="h0013">Reference Signs List</heading><p id="p0053" num="0053"><dl id="dl0001"><dt>101, 1001</dt><dd>Solid state image sensor<!-- EPO <DP n="15"> --></dd><dt>102, 1002</dt><dd>Amplifier</dd><dt>103, 1003</dt><dd>AD converter</dd><dt>104, 1004</dt><dd>Vertical line correction unit</dd><dt>105, 1005</dt><dd>OB line selector</dd><dt>106, 1006</dt><dd>Line memory</dd><dt>107</dt><dd>Level adjuster</dd><dt>108</dt><dd>Selector A</dd><dt>109, 112, 113, 1008</dt><dd>Subtractor</dd><dt>110</dt><dd>Selector B</dd><dt>111</dt><dd>Multiplier</dd><dt>1007</dt><dd>Line integrator</dd></dl></p></description><claims mxw-id="PCLM56976130" lang="EN" load-source="patent-office"><!-- EPO <DP n="16"> --><claim id="c-en-0001" num="0001"><claim-text>An imaging device comprising:
<claim-text>a solid state image sensor including an optical black region; and</claim-text>
<claim-text>a vertical line correction unit for performing vertical line correction on an output signal of the solid state image sensor,</claim-text>
<claim-text>wherein the vertical line correction unit includes</claim-text>
<claim-text>an OB line selector for selecting an optical black line signal included in output signals of the solid state image sensor,</claim-text>
<claim-text>a memory for storing the optical black line signal,</claim-text>
<claim-text>a level adjuster for adjusting a level of an optical black line signal of a past frame read out from the memory, according to a video gain of the output signal of the solid state image sensor,</claim-text>
<claim-text>a first subtractor for calculating a difference signal between a first optical black line signal of a current frame and the optical black line signal of the past frame whose level has been adjusted,</claim-text>
<claim-text>a multiplier for calculating a product by multiplying the difference signal by a cyclic coefficient,</claim-text>
<claim-text>a second subtractor for obtaining a signal which is the optical black line signal of the current frame from which the product of the difference signal and the cyclic coefficient has been subtracted, and rewriting the signal after subtraction to the memory as an optical black line signal, and</claim-text>
<claim-text>a third subtractor for subtracting a signal read out from the memory from an output signal from an effective pixel region of the solid state image sensor.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text><!-- EPO <DP n="17"> --> An imaging method of performing vertical line correction on an output signal of a solid state image sensor including an optical black region, the method comprising:
<claim-text>a step of selecting an optical black line signal included in output signals of the solid state image sensor;</claim-text>
<claim-text>a step of storing the optical black line signal in a memory;</claim-text>
<claim-text>a step of reading an optical black line signal of a past frame from the memory, and adjusting a level according to a video gain of the output signal of the solid state image sensor;</claim-text>
<claim-text>a first subtracting step of calculating a difference signal between a first optical black line signal of a current frame and the optical black line signal of the past frame whose level has been adjusted;</claim-text>
<claim-text>a step of calculating a product by multiplying the difference signal by a cyclic coefficient;</claim-text>
<claim-text>a second subtracting step of obtaining a signal which is the optical black line signal of the current frame from which the product of the difference signal and the cyclic coefficient has been subtracted, and rewriting the signal after subtraction to the memory as an optical black line signal; and</claim-text>
<claim-text>a third subtracting step of subtracting a signal read out from the memory from an output signal from an effective pixel region of the solid state image sensor.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>A program for performing vertical line correction on an output signal of a solid state image sensor including an optical black region, the program being for causing a computer to execute the following steps:
<claim-text>a step of selecting an optical black line signal included in output signals of the solid state image sensor;<!-- EPO <DP n="18"> --></claim-text>
<claim-text>a step of storing the optical black line signal in a memory;</claim-text>
<claim-text>a step of reading an optical black line signal of a past frame from the memory, and adjusting a level according to a video gain of the output signal of the solid state image sensor;</claim-text>
<claim-text>a first subtracting step of calculating a difference signal between a first optical black line signal of a current frame and the optical black line signal of the past frame whose level has been adjusted;</claim-text>
<claim-text>a step of calculating a product by multiplying the difference signal by a cyclic coefficient;</claim-text>
<claim-text>a second subtracting step of obtaining a signal which is the optical black line signal of the current frame from which the product of the difference signal and the cyclic coefficient has been subtracted, and rewriting the signal after subtraction to the memory as an optical black line signal; and</claim-text>
<claim-text>a third subtracting step of subtracting a signal read out from the memory from an output signal from an effective pixel region of the solid state image sensor.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16666915" load-source="patent-office"><!-- EPO <DP n="19"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="219" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="20"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="198" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="21"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="142" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="22"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="139" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
