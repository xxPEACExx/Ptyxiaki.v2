<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2680636-A1" country="EP" doc-number="2680636" kind="A1" date="20140101" family-id="44603702" file-reference-id="318302" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146549434" ucid="EP-2680636-A1"><document-id><country>EP</country><doc-number>2680636</doc-number><kind>A1</kind><date>20140101</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12796004-A" is-representative="YES"><document-id mxw-id="PAPP154823357" load-source="docdb" format="epo"><country>EP</country><doc-number>12796004</doc-number><kind>A</kind><date>20120320</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP168045546" load-source="docdb" format="original"><country>EP</country><doc-number>12796004.5</doc-number><date>20120320</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140451281" ucid="CN-201110150961-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201110150961</doc-number><kind>A</kind><date>20110607</date></document-id></priority-claim><priority-claim mxw-id="PPC140449997" ucid="CN-2012072630-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2012072630</doc-number><kind>W</kind><date>20120320</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2085585874" load-source="docdb">H04W  24/04        20090101AFI20150312BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2036697891" load-source="docdb" scheme="CPC">H04W  24/04        20130101 LA20150723BHEP        </classification-cpc><classification-cpc mxw-id="PCL2003767153" load-source="docdb" scheme="CPC">H04W  24/10        20130101 FI20140124BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132180786" lang="DE" load-source="patent-office">BERICHTSVERFAHREN SOWIE DETEKTIONSVERFAHREN, -VORRICHTUNG UND -SYSTEM FÜR EINEN NETZWERKSTATUS</invention-title><invention-title mxw-id="PT132180787" lang="EN" load-source="patent-office">REPORTING METHOD, DETECTION METHOD, DEVICE AND SYSTEM FOR NETWORK STATE</invention-title><invention-title mxw-id="PT132180788" lang="FR" load-source="patent-office">PROCÉDÉ DE RAPPORT, PROCÉDÉ DE DÉTECTION, DISPOSITIF ET SYSTÈME POUR UN ÉTAT DE RÉSEAU</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR918152562" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ZTE CORP</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR918155705" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ZTE CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR918993105" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ZTE Corporation</last-name><iid>101017851</iid><address><street>ZTE Plaza, Keji Road South Hi-Tech Industrial Park, Nanshan District</street><city>Shenzhen, Guangdong 518057</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR918159070" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>XUE TAO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918172556" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>XUE, TAO</last-name></addressbook></inventor><inventor mxw-id="PPAR918988564" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>XUE, TAO</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918167432" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>DU JUNCHAO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918144138" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>DU, Junchao</last-name></addressbook></inventor><inventor mxw-id="PPAR918984123" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>DU, Junchao</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918166392" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>LIU HUI</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918141540" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>LIU, HUI</last-name></addressbook></inventor><inventor mxw-id="PPAR918990550" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>LIU, HUI</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918161722" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>DENG QINGZHE</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918147693" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>DENG, Qingzhe</last-name></addressbook></inventor><inventor mxw-id="PPAR918987717" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>DENG, Qingzhe</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918171046" load-source="docdb" sequence="5" format="epo"><addressbook><last-name>LIU CHUANYI</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918143210" load-source="docdb" sequence="5" format="intermediate"><addressbook><last-name>LIU, Chuanyi</last-name></addressbook></inventor><inventor mxw-id="PPAR918987364" load-source="patent-office" sequence="5" format="original"><addressbook><last-name>LIU, Chuanyi</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918139817" load-source="docdb" sequence="6" format="epo"><addressbook><last-name>LI XUAN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918143343" load-source="docdb" sequence="6" format="intermediate"><addressbook><last-name>LI, XUAN</last-name></addressbook></inventor><inventor mxw-id="PPAR918990321" load-source="patent-office" sequence="6" format="original"><addressbook><last-name>LI, XUAN</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918153834" load-source="docdb" sequence="7" format="epo"><addressbook><last-name>JI WEIZHEN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918148583" load-source="docdb" sequence="7" format="intermediate"><addressbook><last-name>JI, WEIZHEN</last-name></addressbook></inventor><inventor mxw-id="PPAR918989780" load-source="patent-office" sequence="7" format="original"><addressbook><last-name>JI, WEIZHEN</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918138410" load-source="docdb" sequence="8" format="epo"><addressbook><last-name>LI XIAOJUN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918135182" load-source="docdb" sequence="8" format="intermediate"><addressbook><last-name>LI, XIAOJUN</last-name></addressbook></inventor><inventor mxw-id="PPAR918979782" load-source="patent-office" sequence="8" format="original"><addressbook><last-name>LI, XIAOJUN</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918138619" load-source="docdb" sequence="9" format="epo"><addressbook><last-name>HE WEN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918132234" load-source="docdb" sequence="9" format="intermediate"><addressbook><last-name>HE, WEN</last-name></addressbook></inventor><inventor mxw-id="PPAR918986164" load-source="patent-office" sequence="9" format="original"><addressbook><last-name>HE, WEN</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918143315" load-source="docdb" sequence="10" format="epo"><addressbook><last-name>CHEN WENJING</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918168921" load-source="docdb" sequence="10" format="intermediate"><addressbook><last-name>CHEN, Wenjing</last-name></addressbook></inventor><inventor mxw-id="PPAR918980659" load-source="patent-office" sequence="10" format="original"><addressbook><last-name>CHEN, Wenjing</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918140624" load-source="docdb" sequence="11" format="epo"><addressbook><last-name>GUO JIANGKUN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR918151905" load-source="docdb" sequence="11" format="intermediate"><addressbook><last-name>GUO, Jiangkun</last-name></addressbook></inventor><inventor mxw-id="PPAR918984069" load-source="patent-office" sequence="11" format="original"><addressbook><last-name>GUO, Jiangkun</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen Guangdong 518057</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR918989333" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Bergmeier, Werner</last-name><iid>100037657</iid><address><street>Canzler &amp; Bergmeier Friedrich-Ebert-Straße 84</street><city>85055 Ingolstadt</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2012072630-W"><document-id><country>CN</country><doc-number>2012072630</doc-number><kind>W</kind><date>20120320</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012167644-A1"><document-id><country>WO</country><doc-number>2012167644</doc-number><kind>A1</kind><date>20121213</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS548864417" load-source="docdb">AL</country><country mxw-id="DS548841220" load-source="docdb">AT</country><country mxw-id="DS548864418" load-source="docdb">BE</country><country mxw-id="DS548892984" load-source="docdb">BG</country><country mxw-id="DS548869304" load-source="docdb">CH</country><country mxw-id="DS548862065" load-source="docdb">CY</country><country mxw-id="DS548862066" load-source="docdb">CZ</country><country mxw-id="DS548804913" load-source="docdb">DE</country><country mxw-id="DS548864419" load-source="docdb">DK</country><country mxw-id="DS548864420" load-source="docdb">EE</country><country mxw-id="DS548804316" load-source="docdb">ES</country><country mxw-id="DS548892985" load-source="docdb">FI</country><country mxw-id="DS548893122" load-source="docdb">FR</country><country mxw-id="DS548804914" load-source="docdb">GB</country><country mxw-id="DS548864421" load-source="docdb">GR</country><country mxw-id="DS548804915" load-source="docdb">HR</country><country mxw-id="DS548862067" load-source="docdb">HU</country><country mxw-id="DS548869305" load-source="docdb">IE</country><country mxw-id="DS548864422" load-source="docdb">IS</country><country mxw-id="DS548893123" load-source="docdb">IT</country><country mxw-id="DS548864423" load-source="docdb">LI</country><country mxw-id="DS548804916" load-source="docdb">LT</country><country mxw-id="DS548841221" load-source="docdb">LU</country><country mxw-id="DS548893124" load-source="docdb">LV</country><country mxw-id="DS548804917" load-source="docdb">MC</country><country mxw-id="DS548841226" load-source="docdb">MK</country><country mxw-id="DS548841227" load-source="docdb">MT</country><country mxw-id="DS548841228" load-source="docdb">NL</country><country mxw-id="DS548862068" load-source="docdb">NO</country><country mxw-id="DS548841229" load-source="docdb">PL</country><country mxw-id="DS548864424" load-source="docdb">PT</country><country mxw-id="DS548880381" load-source="docdb">RO</country><country mxw-id="DS548864425" load-source="docdb">RS</country><country mxw-id="DS548841234" load-source="docdb">SE</country><country mxw-id="DS548804918" load-source="docdb">SI</country><country mxw-id="DS548862069" load-source="docdb">SK</country><country mxw-id="DS548862070" load-source="docdb">SM</country><country mxw-id="DS548804317" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128670103" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Disclosed are a reporting method, a detection method, device and system for a network state. The reporting method for a network state includes: an intermediate node receiving a data packet; the intermediate node marking the data packet according to the current network state; and the intermediate node forwarding the marked data packet. The detection method for a network state includes: an aggregation node receiving a data packet; the aggregation node parsing the data packet to obtain the marking information about a network state; and the aggregation node determining the network state according to the marking information. The present invention solves the problem of heavy network burden due to the method of determining the network state by way of active inquiry, thus prolonging the service life of each node, and optimizing the performance of the system.<img id="iaf01" file="imgaf001.tif" wi="57" he="58" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128499476" lang="EN" source="EPO" load-source="docdb"><p>Disclosed are a reporting method, a detection method, device and system for a network state. The reporting method for a network state includes: an intermediate node receiving a data packet; the intermediate node marking the data packet according to the current network state; and the intermediate node forwarding the marked data packet. The detection method for a network state includes: an aggregation node receiving a data packet; the aggregation node parsing the data packet to obtain the marking information about a network state; and the aggregation node determining the network state according to the marking information. The present invention solves the problem of heavy network burden due to the method of determining the network state by way of active inquiry, thus prolonging the service life of each node, and optimizing the performance of the system.</p></abstract><description mxw-id="PDES63955533" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b><u>Technical Field</u></b></heading><p id="p0001" num="0001">The present document relates to the field of communication, and more particularly, to a reporting method, a detecting method, device and system for a network state.</p><heading id="h0002"><b><u>Background of the Related Art</u></b></heading><p id="p0002" num="0002">Wireless sensor network is a totally new information acquiring and processing technology, and has a wide application prospect in industry, military, environment, healthcare and other fields. However, as a distributed computing platform, node resources such as Central Processing Unit (referred to as CPU) speed, storage space, power and bandwidth are very limited, and the working environment of the wireless sensor network is unpredictable, a variety of external interference factors (such as temperature, vibration, electromagnetic field, etc.) are likely to cause failures such as RF conflicts, clock asynchrony, battery depletion, signal loss, software errors, and so on occurred in the network, which greatly reduce the reliability of sensor nodes, weaken or fail intended functions in the wireless sensor network. Various abnormal situations in the network will be diagnosed in a timely manner, searching for reasonable tolerance control solutions that guide the normal operation of the network, which has great significance in improving the reliability and robustness of the wireless sensor network.</p><p id="p0003" num="0003">Currently, the structure of wireless sensor network is more and more complicated, its function becomes perfect, and the degree of automation becomes higher and higher. How to prolong its life as far as possible is a relatively<!-- EPO <DP n="2"> --> popular topic in recent years. The life of the wireless sensor network is mainly decided by the life of the node. However, the wireless sensor network often runs in an unattended, inaccessible by humans, harsh or even dangerous, remote environment, due to many unavoidable factors, the nodes have a variety of failures, which reduces or loses the intended functions of the wireless sensor network, and even causes serious damage and even paralysis of the entire network.</p><p id="p0004" num="0004">Biologists used the wireless sensor network in 2002 to finely observe the habits of petrels on a certain island. 30 sensor nodes were deployed on the island, and after the network ran for 20 days, more than half of the nodes failed completely, obviously, the failure rate of the nodes is very high. Failure rate of sensing components (modules) of the humidity sensor nodes and the nodes within the network is very high. In view of this, the design of the wireless sensor network must take failure diagnosis of the nodes, especially failure diagnosis of the node sensor components, into consideration.</p><p id="p0005" num="0005">The current wireless network diagnostics technology is mainly inserting additional control information data packets into the network, depending on these data packets, the network state is detected in real time, and this method uses the active inquiry mode, generally, particular nodes in the network send the control information data packets to each node, and after the nodes receive the control information packets, they feed back their own state to the particular node, after the particular node determines the current network state according to the received feedback, therefore, this active inquiry mode brings relatively great communication expenses to the network. Especially, in the case that the network state changes frequently, these additional communication overheads increase network traffic load.</p><p id="p0006" num="0006">So far, there is no effective solution for the problem of relatively heavy network burden caused by the method of determining the network state through the active inquiry mode in the related art.<!-- EPO <DP n="3"> --></p><heading id="h0003"><b><u>Summary of the Invention</u></b></heading><p id="p0007" num="0007">The embodiment of the present document provides a reporting method, a detecting method, device and system for a network state, to at least solve the problem of relatively heavy network burden caused by a method of determining the network state through the active inquiry mode in the related art.</p><p id="p0008" num="0008">According to one aspect of the present document, a reporting method for a network state is provided, comprising: an intermediate node receiving a data packet; and the intermediate node marking the data packet according to a current network state; and the intermediate node forwarding the marked data packet.</p><p id="p0009" num="0009">Wherein, the data packet carries a source node identity and a data packet sequence number; the intermediate node marking the data packet according to a current network state comprises: the intermediate node judging whether the data packet is a first data packet sent by the source node or not according to the source node identity, if yes, checking whether the packet carries identity information of other nodes or not; if the packet does not carry identity information of other nodes, the intermediate node writing the intermediate node identity into a specified subfield in the data packet, and recording the source node identity and the data packet sequence number in a local data structure.</p><p id="p0010" num="0010">Wherein, the above-mentioned data packet further carries worst link quality and current link quality; before the intermediate node judges whether the data packet is the first data packet sent by the source node or not according to the source node identity, the method further comprises: after the intermediate node receives the data packet, it updating the current link quality in the data packet according to its own link quality, and checking whether the worst link quality in the data packet is greater than the updated current link quality or<!-- EPO <DP n="4"> --> not; if yes, the intermediate node marking the value of a subfield where the worst link quality is located as the updated current link quality.</p><p id="p0011" num="0011">The above-mentioned data packet carries the number of hops passed by the data packet; the intermediate node marking the data packet according to the current network state comprises: when the intermediate node checks out that the data packet is not the first packet sent by the source node, it searching for a data structure entry corresponding to the source node identity in the local data structure; the intermediate node judging whether a data packet sequence number in the data packet and a data packet sequence number in the data structure entry are continuous or not, if yes, updating the packet sequence number in the data packet structure entry, and modifying the number of hops in the data packet; otherwise, marking the intermediate node identity in the data packet.</p><p id="p0012" num="0012">According to another aspect of the present document, a detecting method for a network state is provided, comprising: a sink node receiving a data packet; and the sink node parsing the data packet to obtain marking information of the network state; and the sink node determining the network state according to the marking information.</p><p id="p0013" num="0013">Wherein, the above-mentioned marking information comprises a source node identity, a data packet sequence number, an intermediate node identity, worst link quality, current link quality and the number of hops; the above-mentioned sink node determining the network state according to the marking information comprises: the above-mentioned sink node checking in a local path database whether there is a path entry corresponding to the source node or not; if there is not a path entry corresponding to the source node, the sink node determining the network state as a state that topology information of the source node is not established, and adding a source node entry into the local path database, the source node entry comprises: an intermediate node identity, the number of hops, a data packet sequence number and the<!-- EPO <DP n="5"> --> worst link quality; if there is a path entry corresponding to the source node, the sink node generating a network state preliminary report according to the marking information, and updating the source node entry according to the marking information; the sink node making a statistic for the network state preliminary reports within a specified period, and determining the network state according to a statistic result.</p><p id="p0014" num="0014">Wherein, the sink node generating the network state preliminary report according to the marking information comprises: the sink node making a comparison to judge whether the sequence number in the data packet and a sequence number corresponding to the source node in the local path database are continuous or not, if not, generating an error report of packet loss, if yes, generating a transmission success report; the sink node determining whether the data packet is routing switched or not according to the source node entry, if yes, generating a routing switch report; the sink node generating the worst link quality report of the source node according to the source node entry.</p><p id="p0015" num="0015">Wherein, the sink node determining the network state according to the statistic result comprises: the sink node determining network information according to the statistic result, wherein, the network information comprises at least one of the following: a data packet transmission success rate, a packet loss rate of the source node, with or without routing switch, and the worst link quality corresponding to the source node, as well as a worst link quality similarity between the source node and an adjacent node; the sink node, according to the network information, using a back-propagation (BP) neural network to determine the network state, wherein, the network state is divided into following categories: normal, physically damaged, software conflict, network congestion and environmental impact.</p><p id="p0016" num="0016">Wherein, the process of determining the BP neural network comprises: the sink node setting a BP neural network of a hidden layer, and setting an activation function corresponding to the hidden layer, and an output layer function;<!-- EPO <DP n="6"> --> the sink node inputting received training samples into the BP neural network, and setting E, a square sum of errors between the BP neural network output and the expected output: <maths id="math0001" num=""><math display="block"><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msup><mfenced open="{" close="}" separators=""><msub><mi>d</mi><mi>k</mi></msub><mspace width="1em"/><mi>f</mi><mfenced open="[" close="]" separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover></mstyle><msub><mi>w</mi><mover><mi mathvariant="italic">jk</mi><mo>‾</mo></mover></msub><mo>⁢</mo><mi>f</mi><mfenced separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover></mstyle><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub><mo>⁢</mo><msub><mi>x</mi><mi>i</mi></msub></mfenced></mfenced></mfenced><mn>2</mn></msup></math><img id="ib0001" file="imgb0001.tif" wi="59" he="12" img-content="math" img-format="tif"/></maths></p><p id="p0017" num="0017">Wherein, / represents that there are totally / nodes at the output of the BP neural network, <i>d<sub>k</sub></i> is the expected output vector, <i>f</i> is the activation function of the hidden layer, <i>m</i> represents the number of nodes in the hidden layer, <i>n</i> indicates the number of nodes in the input layer, <i>w<sub>jk</sub></i> represents weight between the <i>j</i><sup>th</sup> node in the hidden layer and the <i>k</i><sup>th</sup> node in the output layer, <i>net<sub>j</sub></i> represents the output of the <i>j</i><sup>th</sup> node in the input layer, <i>v<sub>ij</sub></i> is the weight between the <i>i</i><sup>th</sup> node in the input layer and the <i>j</i><sup>th</sup> node in the hidden layer, and <i>x<sub>i</sub></i> represents the input value of the <i>i</i><sup>th</sup> node in the input vector of the input layer;<br/>
the sink node narrows E down to the preset target range by adjusting <i>w<sub>jk</sub></i> and <i>v<sub>ij</sub></i>; wherein, <maths id="math0002" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub><mo>=</mo><mi>η</mi><mo>⁢</mo><mfenced separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><msub><mi>o</mi><mi>k</mi></msub></mfenced><mo>⁢</mo><msub><mi>o</mi><mi>k</mi></msub><mo>⁢</mo><mfenced separators=""><mn>1</mn><mo>-</mo><msub><mi>o</mi><mi>k</mi></msub></mfenced><mo>⁢</mo><msub><mi>y</mi><mi>j</mi></msub><mo>;</mo></math><img id="ib0002" file="imgb0002.tif" wi="55" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0003" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub><mo>=</mo><mi>η</mi><mfenced separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msubsup><mi>δ</mi><mi>k</mi><mi>o</mi></msubsup><mo>⁢</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub></mfenced><mo>⁢</mo><msub><mi>y</mi><mi>j</mi></msub><mo>⁢</mo><mfenced separators=""><mn>1</mn><mo>-</mo><msub><mi>y</mi><mi>i</mi></msub></mfenced><mo>⁢</mo><msub><mi>x</mi><mi>i</mi></msub><mo>;</mo></math><img id="ib0003" file="imgb0003.tif" wi="57" he="14" img-content="math" img-format="tif"/></maths><br/>
wherein, η is a gradient descent constant, indicating a scale factor, and <i>η</i> ∈ (0,1) ; <i>y<sub>j</sub></i> is the output value of the <i>j<sup>th</sup></i> node in the output vector of the output layer, <i>o<sub>k</sub></i> is the output vector of the output layer, <i>d<sub>k</sub></i> is the expected output vector, and <maths id="math0004" num=""><math display="inline"><msubsup><mi>δ</mi><mi>k</mi><mi>o</mi></msubsup></math><img id="ib0004" file="imgb0004.tif" wi="5" he="6" img-content="math" img-format="tif" inline="yes"/></maths> is the back propagation error of the output node <i>k</i>.<!-- EPO <DP n="7"> --></p><p id="p0018" num="0018">According to another aspect of the present document, a reporting device for a network state is provided, comprising: a receiving module, configured to receive a data packet; a marking module, configured to mark the data packet according to a current network state; a forwarding module, configured to forward the marked data packet.</p><p id="p0019" num="0019">Wherein, the marking module comprises: a judging unit, configured to judge whether the data packet is the first data packet sent by the source node or not according to a source node identity in the data packet; a checking unit, configured to, when a judging result of the judging unit is YES, check whether the data packet carries marking information of other nodes or not; a marking unit, configured to, when a checking result of the checking unit is NO, write the intermediate node identity into a specified subfield of the data packet, and record the source node identity and a sequence number of the data packet in a local data structure.</p><p id="p0020" num="0020">Wherein, the marking module further comprises: a link quality detecting unit, configured to, after receiving the data packet, update the current link quality in the data packet according to its own link quality, and detect whether the worst link quality of the data packet is greater than the updated current link quality or not; a link quality marking unit, configured to, when a detecting result of the link quality detecting unit is YES, mark the value of a subfield where the worst link quality is located as the updated current link quality.</p><p id="p0021" num="0021">Wherein, the marking module further comprises: a searching unit, configured to, when the judging result of the judging unit is NO, search the local data structure for a data structure entry corresponding to the source node identity; a sequence number judging unit, configured to judge whether a data packet sequence number in the data packet and a data packet sequence number in the data structure entry searched out by the searching unit are continuous or not; a hop number modifying unit, configured to, when the judging result of the sequence number judging unit is YES, update the data packet sequence<!-- EPO <DP n="8"> --> number in the data structure entry, and modify the number of hops in the data packet; a node marking unit, configured to, when the judging result of the sequence number judging unit is NO, mark the intermediate node identity in the data packet.</p><p id="p0022" num="0022">According to a further aspect of the present document, a detecting device for a network state is provided, comprising: a data packet receiving module, configured to receive a data packet; a marking information acquiring module, configured to parse the data packet to obtain the marking information of the network state; a network state determining module, configured to determine the network state according to the marking information.</p><p id="p0023" num="0023">Wherein, the marking information acquisition module comprises: a parsing unit, configured to parse the data packet; a marking information acquiring unit, configured to acquire the mark information parsed out by the parsing unit, wherein the marking information comprises a source node identity, a data packet sequence number, an intermediate node identity, the worst link quality, current link quality and the number of hops; the network state determining module comprises: a checking unit, configured to check whether there is a path entry corresponding to the source node in the data packet in the local path database or not; a first state determining unit, configured to, when a checking result of the checking unit is YES, determine the network state as a state that topology information of the source node is not established; a database modifying unit, configured to, when the first state determining unit determines the network state as a state that the topology information of the source node is not established, add a source node entry into the local path database, wherein the source node entry comprises: an intermediate node identity, the number of hops, a data packet sequence number and the worst link quality; a second state determining unit, configured to, when the checking result of the check unit is NO, generate a network state preliminary report depending on the marking information, and update the source node entry according to the marking information; and make a statistic for network state preliminary<!-- EPO <DP n="9"> --> reports within a specified period, and determine the network state according to the statistic result.</p><p id="p0024" num="0024">The second state determining unit comprises: a comparing sub-unit, configured to make a comparison to judge whether the sequence number in the data packet and the sequence number corresponding to the source node in the local path database are continuous or not; an error report generating sub-unit, configured to, when the comparing result of the comparing sub-unit is discontinuity, generate an error report of packet loss; a transmission success report generating sub-unit, configured to, when the comparing result of the comparing sub-unit is continuity, generate a transmission success report; a routing switch report generating sub-unit, configured to judge whether the data packet is routing switched or not according to the source node entry, and if yes, generate a routing switch report; a link quality report generating sub-unit, configured to generate the worst link quality report of the source node according to the source node entry.</p><p id="p0025" num="0025">Wherein, the second state determining unit comprises: a network information determining sub-unit, configured to determine the network information according to the statistic result, wherein, the network information comprises at least one of the following: a data packet transmission success rate, a packet loss rate of the source node, with or without routing switch, a worst link quality corresponding to the source node, and a worst link quality similarity between the source node and an adjacent node; a network state determining sub-unit, configured to, according to the network information determined by the network information judging sub-unit, use a BP neural network to determine the network state, wherein, the network state is divided into the following categories: normal, physically damaged, software conflict, network congestion and environmental impact.</p><p id="p0026" num="0026">According to a further aspect of the present document, a detecting system for a network state is provided, comprising: intermediate nodes and sink nodes,<!-- EPO <DP n="10"> --> wherein the intermediate node comprises the reporting device for a network state, and the sink node comprises the detecting device for a network state.</p><p id="p0027" num="0027">With the present document, the intermediate node is used to mark the received data packet, so that the sink node can judge the current network state according to the marking information, this method of directly marking the data packet does not need the sink node to initiate an inquiry, and the sink node directly uses the marking information in the data packet to obtain the network state, which reduces message signaling in the network state detecting process and solves the problem of relatively heavy network burden due to the method of using active inquiry to determine the network state, thereby prolonging the life of each node and optimizing the system performance.</p><heading id="h0004"><b><u>Brief Description of Drawings</u></b></heading><p id="p0028" num="0028">The accompanying drawings described herein are used to provide a further understanding of the present document and constitute a part of the present document, and the exemplary embodiments and the description of the present document are used to explain the present document and do not constitute a restriction of the present document. In the accompanying drawings:
<dl id="dl0001"><dt><b>FIG. 1</b></dt><dd>is a flow chart of a reporting method for a network state in accordance with a first embodiment of the present document;</dd><dt><b>FIG. 2</b></dt><dd>is a flow chart of a detecting method for a network state according to the first embodiment of the present document;</dd><dt><b>FIG. 3</b></dt><dd>is an architecture diagram of failure detecting of a wireless sensor network according to a second embodiment of the present document;<!-- EPO <DP n="11"> --></dd><dt><b>FIG 4</b></dt><dd>is a flow chart of a data packet marking algorithm performed by an intermediate node according to a second embodiment of the present document;</dd><dt><b>FIG 5</b></dt><dd>is a flow chart of an algorithm for parsing the marked data packet performed by a sink node according to the second embodiment of the present document;</dd><dt><b>FIG. 6</b></dt><dd>is a schematic diagram of a basic structure of the BP artificial neural network in accordance with the second embodiment of the present document;</dd><dt><b>FIG. 7</b></dt><dd>is a structural diagram of a reporting device for a network state in accordance with a third embodiment of the present document;</dd><dt><b>FIG. 8</b></dt><dd>is a structural diagram of a detecting device for a network state in accordance with the third embodiment of the present document;</dd><dt><b>FIG. 9</b></dt><dd>is a structural diagram of a detecting system for a network state in accordance with the third embodiment of the present document.</dd></dl></p><heading id="h0005"><b><u>Preferred Embodiments of the Invention</u></b></heading><p id="p0029" num="0029">Hereinafter, with reference to the accompanying drawings and the embodiments, the present document will be described in detail. It should be noted that, in case of no conflict, the embodiments of the present application and features of the embodiments could be combined with each other.</p><p id="p0030" num="0030">The embodiments of the present document provide a reporting method, a detecting method, device and system for a network state, which are particularly suitable for wireless sensor network and can also be used for other networks, to reduce excessive energy consumption due to the network state detection.<!-- EPO <DP n="12"> --></p><heading id="h0006"><b><u>The first embodiment</u></b></heading><p id="p0031" num="0031">The present embodiment provides a reporting method for a network state, and the method is described from the intermediate node side to illustrate the processing procedure after the intermediate node receives the data packet, and refer to <figref idrefs="f0001">FIG. 1</figref>, the method comprises the following steps (Step S102-StepS106):
<ul><li>In step S102, the intermediate node receives the data packet.</li></ul></p><p id="p0032" num="0032">The data packet may come from a source node or another intermediate node; if it comes from the source node, the data packet carries the source node identity and the data packet sequence number to indicate which node sends the data packet firstly, and the sequence number of the data packet, so that the subsequent node performs the network state information marking operation; if it comes from another intermediate node, in addition to the source node identity and the data packet sequence number, it also may comprise: link quality and/or the number of hops, for example, the worst link quality and the current link quality, wherein, the worst link quality is used to mark the worst link quality in the path traversed by the packet, the current link quality is used to mark the current link quality in the path passed by the data packet; the number of hops is used to mark the number of hops that the data packet passes through and is used to establish the network topology.</p><p id="p0033" num="0033">In Step S104, the intermediate node marks the data packet according to the current network state.</p><p id="p0034" num="0034">After the intermediate node receives the data packet, it can perform the following operations: the intermediate node judges whether the data packet is the first data packet sent by the source node or not according to the source node identity, if yes, checks whether the data packet carries the marking information of other nodes or not; if it checks out that the data packet does not<!-- EPO <DP n="13"> --> carry the marking information of other nodes, the intermediate node writes the intermediate node identity into a subfield specified by the data packet, and records the source node identity and the data packet sequence number in the local data structure.</p><p id="p0035" num="0035">At the beginning, the data packet only has the source node identity, and the data packet is marked in the data packet transmission process, in this embodiment, the data packet is identified by an intermediate node. Therefore, if the data packet carries the marking information of other nodes, the intermediate node will directly forward the data packet out.</p><p id="p0036" num="0036">Preferably, when the data packet also carries the worst link quality and the current link quality, before the intermediate node judges whether the data packet is the first one sent by the source node or not according to the source node identity, the step may further comprise: after the intermediate node receives the data packet, it updates the current link quality in the data packet according to its own link quality, and checks whether the worst link quality in the data packet is greater than the updated current link quality or not; if yes, the intermediate node marks the value of the subfield where the worst link quality is located as the updated current link quality. This ensures that the worst link quality carried in the data packet is authentic and reliable, and provides reliable data for the sink node to perform the network state detection.</p><p id="p0037" num="0037">If the above-mentioned data packet carries the number of hops passed by the data packet, the intermediate node marking the data packet according to the current network state further comprises: when the intermediate node checks that the data packet is not the first packet sent by the source node, it searches for the data structure entry corresponding to the source node identification in the local data structure; the intermediate node judges whether the data packet sequence number in the data packet and the data packet sequence number in the data structure entry are continuous or not, if continuous (which means no packet loss), it updates the data packet sequence<!-- EPO <DP n="14"> --> number in the data structure entry, and modifying the number of hops in the data packet (such as the original number of hops plus one); if not continuous (which means there is packet loss), it marks the intermediate node identity in the data packet.</p><p id="p0038" num="0038">In Step S106, the intermediate node forwards the marked data packet.</p><p id="p0039" num="0039">With the above-mentioned method, the intermediate node marks the received data packet, in turn, enables the sink node to judge the current network state according to the marking information, and this method of directly marking the data packets does not need the sink node to initiate an inquiry, and the sink node directly uses the marking information in the data packet to obtain the network state, which reduces the message signaling in the network state detecting process and solves the problem of relatively heavy network burden due to the method of using the active inquiry to determine the network state, hence prolonging the life of each node and optimizing the system performance.</p><p id="p0040" num="0040">The present embodiment also provides a detecting method for a network state, and the method is described from the sink node side, and as shown to <figref idrefs="f0001">FIG. 2</figref>, the method comprises the following steps (Step S202-Step S206):
<ul><li>In step S202, the sink node receives a data packet;</li></ul></p><p id="p0041" num="0041">In step S204, the sink node parses the data packet to obtain the marking information of the network state; from the above-mentioned method, it can be seen that the data packet received by the sink node comprises the following marking information: a source node identity, a data packet sequence number, an intermediate node identity, the worst link quality, the current link quality and the number of hops. The meaning of each piece of information is the same as its peer in the above-mentioned method and will not be repeated here.<!-- EPO <DP n="15"> --></p><p id="p0042" num="0042">In Step S206, the sink node determines the network state according to the marking information.</p><p id="p0043" num="0043">For example, the sink node checks whether there is a path entry corresponding to the source node in the local path database or not; if not, the sink node determines the network state as a state that the topology information of the source node state is not established, and adds a source node entry into the local path database, the source node entry comprises: an intermediate node identity, the number of hops, a data packet sequence number and the worst link quality; if yes, the sink node generates a network state preliminary report according to the marking information, and updates the source node entry according to the marking information; the sink node makes a statistic for network state preliminary reports within a specified period, and determines the network state according to the statistic result.</p><p id="p0044" num="0044">Wherein, the sink node generating a network state preliminary report according to the marking information comprises:
<ol><li>1) the sink node makes a comparison to judge whether the sequence number in the data packet and the sequence number corresponding to the source node in the local path database are continuous or not, if not, generates an error report of packet loss, if yes, generates a transmission success report;</li><li>2) the sink node judges whether the packet is routing switched or not according to the source node entry, and if yes, generates a routing switch report;</li><li>3) the sink node generates the worst link quality report of the source node according to the source node entry.</li></ol><!-- EPO <DP n="16"> --></p><p id="p0045" num="0045">According to the above-mentioned report, the sink node determining the network state according to the statistic result comprises: the sink node determines the network information according to the statistic result, wherein, the network information comprises at least one of the following: a data packet transmission success rate, a packet loss rate of the source node, with or without routing switch, the worst link quality corresponding to the source node and a worst link quality similarity between the source node and an adjacent node; the sink node, according to the network information, uses the BP neural network to determine the network state, wherein, the network state is divided into the following categories: normal, physically damaged, software conflict, network congestion and environmental impact.</p><p id="p0046" num="0046">Wherein, the BP neural network can be pre-adjusted and optimized according to experimental data to ensure that the obtained output result is authentic and reliable, and the specific optimization and parameter adjustment mode can refer to the relevant technology.</p><p id="p0047" num="0047">With the above-mentioned method, when a network failure occurs, the failure can be found timely and located accurately to obtain the most likely network failure type and provide a basis for the next network troubleshooting. In particular, when the above-mentioned method is applied to the sensor network, through the failure diagnosis, various abnormal states or failure conditions can be timely and accurately diagnosed, thus to prevent or eliminate the failures, and to provide necessary guidance for the operation of the sensor and improve reliability, safety and efficacy of the node operation, thus reducing the failure loss to the minimum; the maximal design capabilities of the wireless sensor network is guaranteed, so that under any allowable condition, the potential of the wireless sensor network can be fully tapped and its life can be prolonged.<!-- EPO <DP n="17"> --></p><heading id="h0007"><b><u>The second embodiment</u></b></heading><p id="p0048" num="0048">The present embodiment of the present document will be described for the wireless sensor network, and in the process of diagnosing failures in the sensor network in this embodiment, adopting a mode of combining the passively receiving of the sink node with the BP neural network, as the schematic diagram of troubleshooting shown in <figref idrefs="f0002">FIG. 3</figref>, a packet marking function module is added into each node in the network, so that the data packet can be marked timely when any network state abnormity occurs, and the routing information of each source node in the wireless sensor network is passively collected, and the information is aggregated and integrated in the sink nodes as a basis for diagnosis. Then, the information at the sink node is analyzed and integrated as input parameters of the BP neural network. The BP neural network is structured, and the network failure state is diagnosed according to the output feature vector of the BP neural network. The specific steps are as follows:
<ul><li>In step 1, a data packet marking function module is added into each node in the wireless sensor network, whenever the node receives a data packet from another node, it judges whether the data packet should be marked or not according to the packet marking algorithm. For example, if the value of the transmission sequence subfield in the data packet received by the node and that stored in the local node are not continuous, it can be concluded that there is packet loss occurring in the data packet transmitting process. At this time, the node can mark the data packet, and the marking way is to write the local node's identity (referred to as ID) into the marking node identity unit of the data packet.</li><li>In Step 2, a parse function module of data packet marking is added into the sink node in the wireless sensor network. If the data packet is marked by a certain node, it is considered that there is packet loss and network routing switch happening at the node. According to the node ID in the marking subfield<!-- EPO <DP n="18"> --> in the data packet, the specific location at which the node has an exception can easily be recorded.</li><li>In Step 3, the parse function module of data packet marking of the sink node in the wireless sensor network first makes macro and incomplete judgment for the network state, including the transmission success report, the data packet loss report and the network routing switch report, to obtain the network topology. The sink node in the wireless sensor network maintains a set of data structures (corresponding to the path database in the first embodiment), and the data structure contains the routing structure of the entire network, that is, the network topology.</li><li>In Step 4, the information of each source node in the wireless sensor network is collected. The acquisition way is that the source node actively sends the data packet to the sink node, and sets a fixed data packet transmission frequency for the source node, and the source nodes within the network space send messages sequentially to the sink nodes. The sink nodes maintain a data structure, and the table contains the current routing of each source node that sends message to it. Each entry in the table comprises the Hop [count] of the path from the specific source node to the sink node; the worst link quality factor in the path; the sequence number of the packet that expects to be received next, the number of Success Reports [cursor] received within a period of time.</li><li>In Step 5, from the table entries at the sink node, it is to extract and parse the network state information as the next input parameter of the BP neural network. The network state information comprises: (1) the number of data packet transmission success reports received in N cycles, and N is a constant set according to the specific network condition; (2) the packet loss rate of the source node; (3) with or without routing switch; (4) the worst link quality of the routing path of the source node.<!-- EPO <DP n="19"> --></li><li>In Step 6, the above-mentioned network state information parameter is taken as an input vector of the BP artificial neural network.</li><li>In Step 7, the BP neural network is used to diagnose the wireless sensor network, extract the failure eigenvector, and determine the network fault type. The adaptive learning rate algorithm is used to accelerate the BP network training speed, and set an appropriate square sum of error, BP network structure, learning speed enhancement and reduction factors, and activation function and output function of hidden layer in the network. With a large number of training samples, it is to determine the above-mentioned parameters and the BP network structure. Finally, it is to determine the network failure type through the output eigenvector.</li></ul></p><p id="p0049" num="0049">The main operation of the above-mentioned marking algorithm is to allow the sensor nodes to add their own ID information into the transmitted data packet. Due to the restrictions on the size of the data packet transmitted in the sensor network, this marking information only uses 4 extra bytes. The sink nodes in the network analyze the marked data packet to establish a path from the source node to the sink node. By establishing the path information of different source nodes, the network topology is established along the direction of data transmission. If the network state remains stable, this marking operation will automatically stop after the network topology is established. When the network state changes, for example, when there is packet loss or a routing switch occurs, this marking operation automatically starts to work again in the location at which the error occurs.</p><p id="p0050" num="0050">As shown in Table 1, in this embodiment, each data packet contains the following subfields:<!-- EPO <DP n="20"> -->
<tables id="tabl0001" num="0001"><table frame="all"><title><b><u>Table 1</u></b></title><tgroup cols="7" rowsep="0"><colspec colnum="1" colname="col1" colwidth="14mm"/><colspec colnum="2" colname="col2" colwidth="25mm"/><colspec colnum="3" colname="col3" colwidth="24mm"/><colspec colnum="4" colname="col4" colwidth="26mm"/><colspec colnum="5" colname="col5" colwidth="27mm"/><colspec colnum="6" colname="col6" colwidth="27mm"/><colspec colnum="7" colname="col7" colwidth="26mm"/><tbody><row><entry>......</entry><entry>Source node ID</entry><entry>Data packet sequence number</entry><entry>Routing hop count</entry><entry>Marking node ID</entry><entry>Worst link quality</entry><entry>Current link quality</entry></row></tbody></tgroup></table></tables></p><p id="p0051" num="0051">Wherein, the source node ID subfield is used to indicate the source node of the data, that is, the identity of the source node that sends the data.</p><p id="p0052" num="0052">The data packet sequence number subfield is used to identify the data packet and is taken as a judgment basis for whether the data packet is continuous or not.</p><p id="p0053" num="0053">The routing hop count subfield is used to mark the number of hops that the data packet passes and is used to establish the network topology.</p><p id="p0054" num="0054">The marking node ID is used to indicate the ID of the node that marks the data packet, and is an important basis for accurate fault location.</p><p id="p0055" num="0055">The worst link quality is used to mark the worst link quality in the path that the data packet passes through.</p><p id="p0056" num="0056">The current link quality is used to mark the current link quality in the path that the message packet passes through.</p><p id="p0057" num="0057">In this embodiment, each intermediate node maintains a data structure to store the information related to the source node that communicates with it, and each data structure comprises: a source node ID subfield, a sequence number subfield of the latest received data packet. This data structure saves the IDs of all the source nodes that establish communication with the node.<!-- EPO <DP n="21"> --></p><p id="p0058" num="0058">As shown in <figref idrefs="f0003">FIG. 4</figref>, the packet marking algorithm performed by the intermediate node in this embodiment comprises the following steps:
<ul><li>In step S402, when receiving a data packet, the intermediate node first checks whether the worst link quality in the data packet is greater than the current path quality or not, if yes, it is to proceed to step S404; otherwise, it is to proceed to step S406;</li><li>In step S404, the intermediate node updates the value of the worst link quality subfield in the data packet as the value of the current link quality;</li><li>In step S406, the value of the worst link quality subfield in the data packet is kept unchanged;</li><li>In step S408, the intermediate node checks whether the node is marked by other nodes or not, if yes, it is to proceed to step S41 0; otherwise, it is to proceed to step S412;</li><li>In step S41 0, no operation is performed on the data packet, and the process ends;</li><li>In step S412, it is to check the local data structure;</li><li>In step S414, it is to judge whether there is an entry corresponding to the source node in the local data structure or not, if yes, it is to proceed to step S416; otherwise, it is to proceed to step S422;</li><li>In step S416, it is to judge whether the data packet sequence number is continuous or not according to the sequence number subfield corresponding to the source node, if yes, it indicates that the data transmission is normal, it is to proceed to step S418; otherwise, it indicates that there is packet loss occurring during the data transmission, and it is to proceed to step S420;<!-- EPO <DP n="22"> --></li><li>In step S418, it is to update the sequence number subfield and add one to the hop count subfield of the data packet, and forward the data packet out, and then the process ends;</li><li>In step S420, it is to mark the data packet, update information in the data structure field and forward the data packet out, and then the process ends;</li><li>In step S422, it is to mark the data packet, create a data structure entry corresponding to the source node, and then the process ends.</li></ul></p><p id="p0059" num="0059">With such operation, data packets that have problems can be timely detected and marked, while there is no operation on the data packets in normal communication. This greatly reduces the communication costs and computational expense of the entire system.</p><p id="p0060" num="0060">The sink nodes also participate in this marking process, and create a table entry according to the source node and the data sequence number information. According to the above-mentioned marking algorithm, the marked data packet received by the sink node carries a node ID on the routing path and the number of hops between the node and the sink node. With this information, it can determine a path from the source node to the sink node. It is a process from the beginning of establishing the path to the completion of the establishment, and it requires obtaining adequate path information. It takes at least a few data transmitting and receiving cycles, and the exact number of the cycles has to be determined according to specific network circumstances.</p><p id="p0061" num="0061">According to the information provided by the received data packet, the sink node makes a preliminary judgment on the network state information and obtains a preliminary report. At the sink node, a marking and parsing module parses the marking information of the received data packet. The sink node maintains a path related data structure, and the data structure is divided into many small segments. Each segment stores a node ID in the path and the<!-- EPO <DP n="23"> --> number of hops corresponding to it, denoted as Hop [count]. As shown in <figref idrefs="f0004">FIG. 5</figref>, the data packet parsing algorithm comprises:
<ul><li>In step S502, when the sink node receives a new data packet, the parsing module first checks whether there is a path entry corresponding to the source node or not, and if not, it indicates that it is the first time of receiving a data packet from the source node, it is to proceed to step S504; if yes, it is to proceed to step S506.</li><li>In step S504, it is to create a path entry corresponding to the source node, and store the ID information of the source node in the first segment of the path structure entry, while record the worst link quality in the path. And then it is to check whether the data packet is marked or not, if yes, it is to store the marking node ID into the field corresponding to the number of hops in the path structure according to the content of the hop count subfield presented in the data packet, and the process ends.</li><li>In Step S506, it is to calculate the difference between the sequence number in the data packet and the locally stored sequence number.</li><li>In Step S508, it is to judge whether the sequence number difference is greater than 1 or not, if yes, it is to proceed to step S510; otherwise, it is to proceed to step S512.</li><li>In Step S51 0, it is to create an error report of packet loss.</li></ul></p><p id="p0062" num="0062">The latest received data sequence number is also maintained in the path structure corresponding to the source node, after receiving a new data packet, the sink node compares the original sequence number with the sequence number in the data packet, if the difference therebetween is greater than 1, it indicates that there is packet loss occurring in the path, and at this time, an error report of packet loss is generated.<!-- EPO <DP n="24"> --></p><p id="p0063" num="0063">In Step S512, it is to judge whether the node ID in the data packet is consistent with the node identity in the local data structure or not, if they are consistent, it is to proceed to step S514; otherwise, it is to proceed to step S516.</p><p id="p0064" num="0064">In step S514, no treatment is performed, and the process ends.</p><p id="p0065" num="0065">In Step S516, a routing switch report is created, and the process ends.</p><p id="p0066" num="0066">If the node ID in the hop [Count] corresponding to the value of the hop count subfield in the data packet is not consistent with the node ID marked in the data packet, it indicates that there is route switching occurring in the path. A routing switch report is generated at this time, meanwhile, it is to update the value in the corresponding hop [Count], at the same time, it is to indicate that the path information after the segment of hop [Count] begins is no longer reliable and is deleted, and the packet marking operation is started to reconstruct the path.</p><p id="p0067" num="0067">The data packet marking and parsing module establishes and updates the network topology through this recorded path information. For each connection in the network, the number of data packets sent over the connection indicates the utilization of this connection. This kind of data represents the intensity of the connection between the parent nodes and their child nodes in the network.</p><p id="p0068" num="0068">The data packet parsing module makes a rough and incomplete report, including a transmission success report, a packet loss report, a network routing switch report, and the value of the worst link quality corresponding to the source node.</p><p id="p0069" num="0069">The report obtained at the sink node is analyzed to obtain the network information, including: (1) the number of data packet transmission success reports received in N cycles, wherein N is a constant set according to the specific<!-- EPO <DP n="25"> --> network condition; (2) the packet loss rate of the source node; (3) with or without routing switch; (4) the parameter of the worst link quality of the routing path of the source node.</p><p id="p0070" num="0070">P1- a success rate of the transmitted message packets received in N cycles, wherein N is a constant set according to the specific network condition. A SuccessReport [N] is stored in the form of a table entry, and the value of it is initialized to 0. The variable of Cursor is used to identify the current position, if a message transmission success report corresponding to the source node is received before the next cycle, the value of the current position is set to 1, otherwise, it is set to 0. The cursor returns back to the first position in the SuccessReport queue after the SuccessReport leaves the N<sup>th</sup> position, which is equivalent to a circular list. The sum of all the values in SuccessReport equals to the number of message packet transmission success reports obtained in the N cycles, and the ratio of this number to N is the data packet transmission success rate.</p><p id="p0071" num="0071">P2- the data packet loss rate of the source node. After the sink node receives the marked data packet, if the difference between the values in the data packet sequence subfield is greater than 1, it can be identified that a packet loss occurs at the marking node. The number of data packets lost in the network is recorded in N cycles. The ratio of this number to N is the packet loss rate of the corresponding source node.</p><p id="p0072" num="0072">P3- with or without routing switch. It is to learn whether there is a routing switch in the network or not according to reports at the sink node in the previous step. If there is routing switch, it is denoted as P3 = I, otherwise it is denoted as P3 = 0.</p><p id="p0073" num="0073">P4- a parameter of the worst link quality of the routing path of the source node, namely, the worst link quality on the source node routing path in the<!-- EPO <DP n="26"> --> routing entry at the sink node. The link quality value range is [0,255], and the link quality is preferred to be 255.</p><p id="p0074" num="0074">P5- a worst link quality similarity with an adjacent node. The source node compares its link quality with that of other source nodes within the same physical area, and the value range of the similarity is (0,1) from small to large.</p><p id="p0075" num="0075">The present embodiment uses the BP neural network to diagnose the wireless sensor networks, extract the failure eigenvector, and determine the network failure type. The learning of the BP network uses the error back propagation algorithm, namely the BP algorithm. As shown in <figref idrefs="f0005">FIG. 6</figref>, its main idea is to divide the learning process into two stages: in the first stage (forward propagation of signal), an input sample (as X<sub>1</sub>, X<sub>2</sub>, X<sub>3</sub>...X<sub>R</sub> shown in <figref idrefs="f0005">FIG. 6</figref>) is given to pass through the input layer, and the hidden layer processes layer by layer and calculates the actual output value of each unit; in the second stage (back propagation of error), if the expected output value is not obtained in the output layer, the difference between the actual output and the expected output is calculated layer by layer iteratively, and this difference is back propagated layer by layer in some form through the hidden layer to the input layer, and this error is divided to all units in each layer, so that each layer unit obtains an error signal (such as Y<sub>1</sub>, Y<sub>2</sub>, Y<sub>3</sub>, Y<sub>4</sub>...X<sub>q</sub> shown in <figref idrefs="f0005">FIG. 6</figref>), and this error signal is the basis for correcting the weight of each unit. This process of adjusting each layer weight of signal forward propagation and error back propagation is circular, and the weight adjustment process is also the network learning process. This process continues until the network output error is reduced to a predetermined value.</p><p id="p0076" num="0076">The input layer of the BP network is the five parameters obtained in the third step. The output layer of the BP network uses four neurons to represent five types of network state: (1) normal; (2) physically damaged; (3) software conflict;<!-- EPO <DP n="27"> --> (4) network congestion; (5) environmental impact, which are represented with F1 to F4 respectively.</p><p id="p0077" num="0077">This embodiment uses an improved method of the BP algorithm: the adaptive learning rate method. The square sum of Error is set to 0.5. The training samples are input to the BP neural network, trial and adjustment are performed, and the number of layers in the BP neural network structure and the number of nodes in each layer, a learning speed, a learning enhancement factor, and a learning reduction factor are determined. According to the experimental data and experience, it is to select a BP neural network for two hidden layers, and to set the activation function corresponding to each hidden layer, for example, choose the activation function of the first hidden layer as tansig, and choose the activation function of the hidden layer 2 as logsig, choose the output layer function as purelin; these three are functions in Matlab language, and of course, depending on the difference between the programming languages used, other functions can be used.</p><p id="p0078" num="0078">When the network output is inconsistent with the expected output, the output square sum of error, E, is defined as follows: <maths id="math0005" num=""><math display="block"><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>⁢</mo><msup><mfenced separators=""><mi>d</mi><mo>-</mo><mi>o</mi></mfenced><mn>2</mn></msup><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msup><mfenced separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><msub><mi>o</mi><mi>k</mi></msub></mfenced><mn>2</mn></msup></math><img id="ib0005" file="imgb0005.tif" wi="57" he="12" img-content="math" img-format="tif"/></maths></p><p id="p0079" num="0079">Wherein <i>o<sub>k</sub></i> is the output vector of the output layer, <i>d<sub>k</sub></i> is the desired output vector. <i>l</i> indicates that there are totally / nodes at the output of the network.</p><p id="p0080" num="0080">It is expanded to the hidden layer: <maths id="math0006" num=""><math display="block"><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msup><mfenced open="[" close="]" separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><mi>f</mi><mfenced><msub><mi mathvariant="italic">net</mi><mi>k</mi></msub></mfenced></mfenced><mn>2</mn></msup><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msup><mfenced open="[" close="]" separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><mi>f</mi><mfenced separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover></mstyle><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub><mo>⁢</mo><msub><mi mathvariant="italic">y</mi><mi>j</mi></msub></mfenced></mfenced><mn>2</mn></msup></math><img id="ib0006" file="imgb0006.tif" wi="91" he="14" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="28"> --> <i>l</i> indicates that there are totally <i>l</i> nodes at the output of the network, <i>d<sub>k</sub></i> is the expected output vector, <i>net<sub>k</sub></i> is the output of the <i>k</i><sup>th</sup> node in the hidden layer, <i>f</i> is the activation function of the hidden layer, m represents the number of nodes in the hidden layer, <i>w<sub>jk</sub></i> represents the weight between the <i>j</i><sup>th</sup> nodes in the hidden layer and the <i>k</i><sup>th</sup> node in the output layer, <i>y<sub>j</sub></i> means the output of the <i>j</i><sup>th</sup> node in the hidden layer. Herein, the two hidden layers are unified as "hidden layer", this formula mainly reveals the three-iteration structure "input layer - hidden layer - output layer" of the BP neural network, and does not emphasize the specific stratification and the specific implementation of each layer. It is further expanded to the input layer, there is: <maths id="math0007" num=""><math display="block"><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msup><mfenced open="{" close="}" separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><mi>f</mi><mfenced open="[" close="]" separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover></mstyle><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub><mo>⁢</mo><mi>f</mi><mfenced><msub><mi mathvariant="italic">net</mi><mi>j</mi></msub></mfenced></mfenced></mfenced><mn>2</mn></msup><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msup><mfenced open="{" close="}" separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><mi>f</mi><mfenced open="[" close="]" separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover></mstyle><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub><mo>⁢</mo><mi>f</mi><mfenced separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover></mstyle><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub><mo>⁢</mo><msub><mi>x</mi><mi>i</mi></msub></mfenced></mfenced></mfenced><mn>2</mn></msup></math><img id="ib0007" file="imgb0007.tif" wi="122" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0081" num="0081"><i>l</i> indicates that there are totally <i>l</i> nodes at the output of the network, <i>d<sub>k</sub></i> is the desired output vector, <i>f</i> is the activation function of the hidden layer, m represents the number of nodes in the hidden layer, <i>w<sub>jk</sub></i> represents the weight between the <i>j</i><sup>th</sup> node in the hidden layer and the <i>k</i><sup>th</sup> node in the output layer, <i>net<sub>j</sub></i> is the output of the <i>j</i><sup>th</sup> node in the hidden layer, <i>v<sub>ij</sub></i> means the weight between the <i>i</i><sup>th</sup> node of the output layer and the <i>j</i><sup>th</sup> node in the hidden layer, and <i>x<sub>i</sub></i> represents the input of the <i>i</i><sup>th</sup> node of the input layer.</p><p id="p0082" num="0082">It can be seen that, the network error is a function of the weights <i>w<sub>jk</sub></i> of the layers, so that the weights are adjusted to change and narrow the error E into the defined target range. <maths id="math0008" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub><mo>=</mo><mo>-</mo><mi>η</mi><mo>⁢</mo><mfrac><mrow><mo>∂</mo><mi>E</mi></mrow><mrow><mo>∂</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub></mrow></mfrac><mspace width="3em"/><mi>j</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>⋯</mo><mo>,</mo><mi>m</mi><mo>;</mo><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>⋯</mo><mo>,</mo><mi>l</mi></math><img id="ib0008" file="imgb0008.tif" wi="79" he="13" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="29"> --> <maths id="math0009" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub><mo>=</mo><mo>-</mo><mi>η</mi><mo>⁢</mo><mfrac><mrow><mo>∂</mo><mi>E</mi></mrow><mrow><mo>∂</mo><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub></mrow></mfrac><mspace width="3em"/><mi>i</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>⋯</mo><mo>,</mo><mi>n</mi><mo>;</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>⋯</mo><mo>,</mo><mi>m</mi></math><img id="ib0009" file="imgb0009.tif" wi="77" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0083" num="0083">Wherein, the gradient descent constant η ∈ (0,1) represents the scale factor and reflects the learning rate in the training. After derivation, the weight value adjustment formula of the BP learning algorithm can be obtained as: <maths id="math0010" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub><mo>=</mo><mi>η</mi><mo>⁢</mo><mfenced separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><msub><mi>o</mi><mi>k</mi></msub></mfenced><mo>⁢</mo><msub><mi>o</mi><mi>k</mi></msub><mo>⁢</mo><mfenced separators=""><mn>1</mn><mo>-</mo><msub><mi>o</mi><mi>k</mi></msub></mfenced><mo>⁢</mo><msub><mi>y</mi><mi>j</mi></msub></math><img id="ib0010" file="imgb0010.tif" wi="53" he="7" img-content="math" img-format="tif"/></maths> <maths id="math0011" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub><mo>=</mo><mi>η</mi><mfenced separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msubsup><mi>δ</mi><mi>k</mi><mi>o</mi></msubsup><mo>⁢</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub></mfenced><mo>⁢</mo><msub><mi>y</mi><mi>j</mi></msub><mo>⁢</mo><mfenced separators=""><mn>1</mn><mo>-</mo><msub><mi>y</mi><mi>i</mi></msub></mfenced><mo>⁢</mo><msub><mi>x</mi><mi>i</mi></msub></math><img id="ib0011" file="imgb0011.tif" wi="54" he="12" img-content="math" img-format="tif"/></maths></p><p id="p0084" num="0084">Wherein, the above-mentioned <i>x<sub>i</sub></i> is the input vector, <i>y<sub>j</sub></i> the output vector, <i>o<sub>k</sub></i> the output vector of the output layer, <i>d<sub>k</sub></i> the expected output vector, and <maths id="math0012" num=""><math display="inline"><msubsup><mi>δ</mi><mi>k</mi><mi>o</mi></msubsup></math><img id="ib0012" file="imgb0012.tif" wi="5" he="6" img-content="math" img-format="tif" inline="yes"/></maths> the back propagation error of the output node <i>k</i>. Training through a large number of training samples, the square sum of error can meet the required accuracy, and the training ends. Depending on the characteristics of the selected samples, when the unit of each input or output component is different, corresponding to different components, transformation is performed respectively within their value ranges. The parameter of the worst link quality P4 is normalized. Meanwhile, according to the characteristics of the wireless sensor, the threshold is selected as 0.80, if the factor in the output vector is greater than the threshold value, it indicates that the output is a failure output, and otherwise, it is a normal output. With the above-mentioned method, the following table lists some sample training results of the BP network, as shown in Table 2.<!-- EPO <DP n="30"> -->
<tables id="tabl0002" num="0002"><table frame="all"><title><b><u>Table 2</u></b></title><tgroup cols="11"><colspec colnum="1" colname="col1" colwidth="27mm"/><colspec colnum="2" colname="col2" colwidth="13mm"/><colspec colnum="3" colname="col3" colwidth="13mm"/><colspec colnum="4" colname="col4" colwidth="11mm"/><colspec colnum="5" colname="col5" colwidth="13mm"/><colspec colnum="6" colname="col6" colwidth="13mm"/><colspec colnum="7" colname="col7" colwidth="16mm"/><colspec colnum="8" colname="col8" colwidth="16mm"/><colspec colnum="9" colname="col9" colwidth="16mm"/><colspec colnum="10" colname="col10" colwidth="16mm"/><colspec colnum="11" colname="col11" colwidth="16mm"/><thead><row><entry morerows="1" valign="top">Failure mode</entry><entry namest="col2" nameend="col6" align="left" valign="top">Input vector</entry><entry namest="col7" nameend="col10" align="left" valign="top">Output vector</entry><entry morerows="1" valign="top">Failure type</entry></row><row><entry valign="top">P1</entry><entry valign="top">P2</entry><entry valign="top">P3</entry><entry valign="top">P4</entry><entry valign="top">P5</entry><entry valign="top">Y1</entry><entry valign="top">Y2</entry><entry valign="top">Y3</entry><entry valign="top">Y4</entry></row></thead><tbody><row><entry>Normal</entry><entry align="char" char=".">0.95</entry><entry align="char" char="." charoff="15">0.08</entry><entry>0</entry><entry>1</entry><entry align="char" char="." charoff="15">0.56</entry><entry>-0.4655</entry><entry>0.4157</entry><entry>0.7304</entry><entry>0.1443</entry><entry>F0</entry></row><row><entry>Physically damaged</entry><entry align="char" char=".">0.00</entry><entry align="char" char="." charoff="15">1.00</entry><entry>0</entry><entry>0.00</entry><entry align="char" char="." charoff="15">0.44</entry><entry>0.9582</entry><entry>-0.0563</entry><entry>-0.0048</entry><entry>0.0175</entry><entry>F1</entry></row><row><entry>Software conflict</entry><entry align="char" char=".">0.12</entry><entry align="char" char="." charoff="15">0.89</entry><entry>1</entry><entry>0.45</entry><entry align="char" char="." charoff="15">0.65</entry><entry>0.7476</entry><entry>-0.8137</entry><entry>0.3493</entry><entry>-0.3920</entry><entry>F2</entry></row><row><entry>Network congestion</entry><entry align="char" char=".">0.38</entry><entry align="char" char="." charoff="15">0.52</entry><entry>0</entry><entry>0.61</entry><entry align="char" char="." charoff="15">0.70</entry><entry>-0.1865</entry><entry>-0.6269</entry><entry>0.9131</entry><entry>0.4563</entry><entry>F3</entry></row><row><entry>Environmental impact</entry><entry align="char" char=".">0.32</entry><entry align="char" char="." charoff="15">0.63</entry><entry>0</entry><entry>0.35</entry><entry align="char" char="." charoff="15">0.89</entry><entry>-0.6445</entry><entry>-0.2024</entry><entry>-0.4057</entry><entry>-0.8022</entry><entry>F4</entry></row></tbody></tgroup></table></tables></p><p id="p0085" num="0085">The present embodiment combines the passive network information acquisition technology, that is, the data packet marking technology in the wireless sensor network, with the BP neural network technology, to establish a wireless sensor network diagnostic technique. The passive network information acquisition technology adds extra 4-byte data packet payload in the message packet to provide the original information for network diagnostics. Compared with the sink node active inquiry mode, the passive information acquisition method greatly reduces the network communication expenses. Using the adaptive learning rate method in the BP neural network can effectively avoid the problems of the unstable network weight variable due to the large learning rate, and of the too slow learning rate due to the too small learning rate. With this method, the error can be limited to a very small range, thus ensuring the accuracy of failure classification and obtaining a more satisfactory result. The method has broad application prospects in the wireless sensor network application system.<!-- EPO <DP n="31"> --></p><heading id="h0008"><b><u>The third embodiment</u></b></heading><p id="p0086" num="0086">The present embodiment provides a reporting device for a network state, and the device can be provided in an intermediate node the above-mentioned embodiment, as shown in <figref idrefs="f0005">FIG. 7</figref>, the device comprises the following modules:
<ul><li>the receiving module 72, configured to receive a data packet;</li><li>the marking module 74, connected with the receiving module 72, and configured to mark the data packet according to the current network state;</li><li>the forwarding module 76, connected with the marking module 74, and configured to forward the marked data packet.</li></ul></p><p id="p0087" num="0087">Wherein, the marking module 74 comprises: a judging unit, configured to judge whether the data packet is the first data packet sent by the source node or not according to the source node identity in the data packet; a checking unit, connected with the judging unit, and configured to, when the judging result of the judging unit is YES, check whether the data packet carries the marking information of other nodes or not; a marking unit, connected with the checking unit, and configured to, when the checking result of the checking unit is NO, write the intermediate node identity into a subfield specified by the data packet, and record the source node identity and the data packet sequence number in the local data structure.</p><p id="p0088" num="0088">Preferably, the marking module 74 further comprises: a link quality detecting unit, configured to detect whether the worst link quality in the data packet is greater than the current link quality in the data packet or not; a link quality marking unit, connected with the link quality detecting unit, and configured to, when the detecting result of the link quality detecting unit is YES, mark the<!-- EPO <DP n="32"> --> value of the subfield where the worst link quality is located as the current link quality.</p><p id="p0089" num="0089">The above-mentioned marking module 74 further comprises: a searching unit, configured to, when the judging result of the judging unit is NO, search the local data structure for a data structure entry corresponding to the source node ID; a sequence number judging unit, connected with the searching unit and configured to judge whether the data packet sequence number in the data packet and the data packet sequence number in the data structure entry searched out by the searching unit are continuous or not; a hop number modifying unit, connected with the sequence number judging unit and configured to, when the judging result of the judging unit is YES, update the data packet sequence number in the data structure entry and modify the number of hops in the data packet; a node marking unit, connected with the sequence number judging unit, and configured to, when the judging result of the sequence number judging unit is NO, mark the intermediate node identity in the data packet.</p><p id="p0090" num="0090">The present embodiment provides a detecting device for a network state, wherein, the device may be provided in the sink node of the above-mentioned embodiment, and referring to <figref idrefs="f0006">FIG. 8</figref>, the device comprises the following modules:
<ul><li>the data packet receiving module 82, configured to receive a data packet;</li><li>the marking information acquiring module 84, connected with the data packet receiving module 82, and configured to parse the data packet to acquire the marking information of the network state;</li><li>the network state determining module 86, connected with the marking information acquiring module 84, and configured to determine the network state according to the marking information.</li></ul><!-- EPO <DP n="33"> --></p><p id="p0091" num="0091">Wherein, the marking information acquiring module 14 comprises: a parsing unit, configured to parse the data packet; a marking information extracting unit, connected with the parsing unit, and configured to extract the marking information parsed out by the parsing unit, wherein the marking information comprises a source node identity, a data packet sequence number, an intermediate node identity, worst link quality, current link quality and the number of hops; individual piece of information has the same meaning as its peer in the above-mentioned embodiment and will not be repeated here.</p><p id="p0092" num="0092">Preferably, the network state determining module 86 comprises the following units:
<ul><li>the checking unit, configured to check in the local path database whether there is a path entry corresponding to the source node in the data packet or not;</li><li>the first state determining unit, connected with the checking unit and configured to, when the checking result of the checking unit is YES, determine the network state as a state that the topology information of the source node is not established;</li><li>the database modifying unit, connected with the first state determining unit and configured to, when the first state determining unit determines the network state as a state that the topology information of the source node is not established, add a source node entry into the local path database, wherein the source node entry comprises: the intermediate node identity, the number of hops, the data packet sequence number and the worst link quality;</li><li>the second state determining unit, connected with the checking unit and configured to, when the checking result of the checking unit is NO, generate a network state preliminary report according to the marking information and<!-- EPO <DP n="34"> --> update the source node entry according to the marking information; and make a statistic for the network state preliminary reports within a specified period, and determine the network state according to the statistic result.</li></ul></p><p id="p0093" num="0093">Wherein, the second state determining unit comprises: A comparing sub-unit, configured to make a comparison to judge whether the sequence number in the data packet and the sequence number corresponding to the source node in the local path database are continuous or not; an error report generating sub-unit, connected with the comparing sub-unit and configured to, when the comparing result of the comparing sub-unit is discontinuity, generate an error report of packet loss; a transmission success report generating sub-unit, connected with the comparing sub-unit and configured to, when the comparing result of the comparing sub-unit is continuity, generate a transmission success report; a routing switch report generating sub-unit, connected with the checking unit and configured to judge whether the data packet is routing switched or not according to the source node entry, and if yes, generate a routing switch report; a link quality report generating sub-unit, connected with the checking unit and configured to generate the worst link quality report of the source node according to the source node entry.</p><p id="p0094" num="0094">The second state determining unit comprises: a network information determining sub-unit, configured to determine the network information according to the statistic result, wherein the network information comprises at least one of the following: a packet transmission success rate, a packet loss rate of the source node, with or without routing switch, the worst link quality corresponding to the source node, and the worst link quality similarity between the source node and the adjacent nodes; a network state determining sub-unit, configured to use the BP neural network to determine the network state according to the network information determined by the network information determining sub-unit, wherein, the network state is divided into the following categories: normal, physically damaged, software conflict, network congestion and environmental impact.<!-- EPO <DP n="35"> --></p><p id="p0095" num="0095">The present embodiment also provides a detecting system for a network state, and referring to <figref idrefs="f0006">FIG. 9</figref>, the system comprises: the intermediate node 70 and the sink node 80, and the intermediate node 70 and the sink node 80 are connected together, wherein, the intermediate node 70 comprises the above-mentioned reporting device for a network state, and the sink node 80 comprises the above-mentioned detecting device for a network state.</p><p id="p0096" num="0096">The device and system provided in the present embodiment can also be used in the wireless sensor network.</p><p id="p0097" num="0097">The intermediate node in this embodiment marks the received data packet, in turn, the sink node is enabled to judge the current network state according to the marking information, this mode of directly marking the data packet does not need the sink node to initiate an inquiry, while the sink node directly uses the marking information in the data packet to learn the network state, which reduces the message signaling in the network state detecting process and solves the problem of relatively heavy network burden due to the mode of actively inquiry to determine the network state, thus prolonging the life of each node and optimizing the system performance.</p><p id="p0098" num="0098">From the above description, it can be seen that the above-mentioned embodiment uses the data packet marking technology combined with the BP neural network technology, by marking the network state information in the data packet, the network communication expenses are greatly reduced. The BP neural network protects the accuracy of failure classification and has a relatively satisfactory outcome, thus further optimizing the system performance.</p><p id="p0099" num="0099">Obviously, the person skilled in the art should understand that each module or each step in the present document can be realized with general-purpose computing device, they can be concentrated in a single computing device or distributed on a network composed of a plurality of computing devices, optionally, they may be implemented with executable program codes in the<!-- EPO <DP n="36"> --> computing device, so that they can be stored in the storage device and executed by the computing device, and, in some cases, an execution order of the steps may be different from the execution order shown or described here, alternatively, they may be made into individual integrated circuit modules respectively, or a plurality of modules or steps among them may be made into a single integrated circuit module. Thus, the present document is not limited to any specific combination of hardware and software.</p><p id="p0100" num="0100">The above description is only preferred embodiments of the present document and is not intended to limit the present document, and for those skilled in the art, the present document may have various changes and variations. Without departing from the spirit and principles of the present document, any modification, equivalent replacement, improvement, and so on, should be included within the protection scope of the present document.</p></description><claims mxw-id="PCLM56976451" lang="EN" load-source="patent-office"><!-- EPO <DP n="37"> --><claim id="c-en-0001" num="0001"><claim-text>A reporting method for a network state, comprising:
<claim-text>an intermediate node receiving a data packet;</claim-text>
<claim-text>said intermediate node marking said data packet according to a current network state;</claim-text>
<claim-text>said intermediate node forwarding the marked data packet.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method of claim 1, wherein, said data packet carries a source node identity and a data packet sequence number;<br/>
said intermediate node marking said data packet according to a current network state comprises:
<claim-text>said intermediate node judging whether said data packet is a first data packet sent by said source node or not according to said source node identity, if yes, checking whether said data packet carries identity information of other nodes or not;</claim-text>
<claim-text>if it is checked out that said data packet does not carry identity information of other nodes, said intermediate node writing an intermediate node identity into a specified subfield in said data packet, and recording said source node identity and said data packet sequence number in a local data structure.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method of claim 2, wherein, said data packet further carries worst link quality and current link quality;<br/>
before said intermediate node judges whether said data packet is the first data packet sent by said source node or not according to said source node identity, said method further comprises:
<claim-text>after said intermediate node receives said data packet, said intermediate node updating said current link quality in said data packet according to link quality of the intermediate node itself, and checking whether said worst link quality in said data packet is greater than the<!-- EPO <DP n="38"> --> updated current link quality or not; if yes, said intermediate node marking a value of a subfield where said worst link quality is located as the updated current link quality.</claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method of claim 2 or 3, wherein, said data packet carries a number of hops passed by said data packet during transmission;<br/>
said intermediate node marking said data packet according to a current network state comprises:
<claim-text>when said intermediate node checks out that said data packet is not the first packet sent by said source node, said intermediate node searching said local data structure for a data structure entry corresponding to said source node identity;</claim-text>
<claim-text>said intermediate node judging whether a data packet sequence number in said data packet and a data packet sequence number in said data structure entry are continuous or not, if yes, updating said data packet sequence number in said data packet structure entry, and</claim-text>
<claim-text>modifying the number of hops in said data packet; otherwise, marking said intermediate node identity in said data packet.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>A detecting method for a network state, comprising:
<claim-text>a sink node receiving a data packet;</claim-text>
<claim-text>said sink node parsing said data packet to obtain marking information of the network state;</claim-text>
<claim-text>said sink node determining said network state according to said marking information.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method of claim 5, wherein, said marking information comprises a source node identity, a data packet sequence number, an intermediate node identity, worst link quality, current link quality and a number of hops;<br/>
<!-- EPO <DP n="39"> -->said sink node determining said network state according to the marking information comprises:
<claim-text>said sink node checking in a local path database whether there is a path entry corresponding to said source node or not;</claim-text>
<claim-text>if not, said sink node determining said network state as a state that topology information of said source node is not established, and adding a source node entry into said local path database, wherein said source node entry comprises: the intermediate node identity, the number of hops, the data packet sequence number and the worst link quality;</claim-text>
<claim-text>if yes, said sink node generating a network state preliminary report according to said marking information, and updating said source node entry according to said marking information;</claim-text>
<claim-text>said sink node making a statistic for said network state preliminary reports within a specified period, and determining said network state according to a statistic result.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method of claim 6, wherein, said sink node generating said network state preliminary report according to said marking information comprises:
<claim-text>said sink node making a comparison to judge whether a sequence number in said data packet and a sequence number corresponding to said source node in said local path database are continuous or not, if not, generating an error report of packet loss, if yes, generating a transmission success report;</claim-text>
<claim-text>said sink node determining whether said data packet is routing switched or not according to said source node entry, if yes, generating a routing switch report;</claim-text>
<claim-text>said sink node generating a worst link quality report of said source node according to said source node entry.</claim-text><!-- EPO <DP n="40"> --></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method of claim 7, wherein, said sink node determining said network state according to said statistic result comprises:
<claim-text>said sink node determining network information according to said statistic result, wherein, said network information comprises at least one of the following: a data packet transmission success rate, a data packet loss rate of said source node, with or without routing switch,</claim-text>
<claim-text>and a parameter of worst link quality corresponding to said source node, as well as a worst link quality similarity between said source node and an adjacent node;</claim-text>
<claim-text>said sink node, according to said network information, using a back-propagation (BP) neural network to determine said network state, wherein, said network state is divided into following categories: normal, physically damaged, software conflict, network congestion and environmental impact.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method of claim 8, wherein, a process of determining said back-propagation neural network comprises: said sink node setting a back-propagation (BP) neural network of a hidden layer, and setting an activation function corresponding to said hidden layer, as well as setting an output layer function;<br/>
said sink node inputting received training samples into said back-propagation neural network, and setting E, a square sum of errors between a BP neural network output and an expected output: <maths id="math0013" num=""><math display="block"><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msup><mfenced open="{" close="}" separators=""><msub><mi>d</mi><mi>k</mi></msub><mspace width="1em"/><mi>f</mi><mfenced open="[" close="]" separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover></mstyle><msub><mi>w</mi><mover><mi mathvariant="italic">jk</mi><mo>‾</mo></mover></msub><mo>⁢</mo><mi>f</mi><mfenced separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover></mstyle><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub><mo>⁢</mo><msub><mi>x</mi><mi>i</mi></msub></mfenced></mfenced></mfenced><mn>2</mn></msup></math><img id="ib0013" file="imgb0013.tif" wi="59" he="12" img-content="math" img-format="tif"/></maths><br/>
Wherein, <i>l</i> represents that there are totally <i>l</i> nodes at the output of said back-propagation neural network, <i>d<sub>k</sub></i> is an expected output vector, <i>f</i> is an activation function of the hidden layer, <i>m</i> represents a number of nodes in the hidden layer, <i>n</i> indicates a number of nodes in an input layer, <i>w<sub>jk</sub></i> represents a weight between the <i>j</i><sup>th</sup> node in the hidden layer and the <i>k</i><sup>th</sup> node in the output layer, <i>net<sub>j</sub></i> represents an output of the <i>j</i><sup>th</sup><!-- EPO <DP n="41"> --> node in the input layer, <i>v<sub>ij</sub></i> is a weight between the <i>i</i><sup>th</sup> node in the input layer and the <i>j</i><sup>th</sup> node in the hidden layer, and <i>x<sub>i</sub></i> represents an input value of the <i>i</i><sup>th</sup> node in an input vector of the input layer;<br/>
said sink node narrowing E down to a preset target range by adjusting <i>w<sub>jk</sub></i> and <i>v<sub>ij</sub></i>; wherein, <maths id="math0014" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub><mo>=</mo><mi>η</mi><mo>⁢</mo><mfenced separators=""><msub><mi>d</mi><mi>k</mi></msub><mo>-</mo><msub><mi>o</mi><mi>k</mi></msub></mfenced><mo>⁢</mo><msub><mi>o</mi><mi>k</mi></msub><mo>⁢</mo><mfenced separators=""><mn>1</mn><mo>-</mo><msub><mi>o</mi><mi>k</mi></msub></mfenced><mo>⁢</mo><msub><mi>y</mi><mi>j</mi></msub><mo>;</mo></math><img id="ib0014" file="imgb0014.tif" wi="55" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0015" num=""><math display="block"><mi mathvariant="normal">Δ</mi><mo>⁢</mo><msub><mi>v</mi><mi mathvariant="italic">ij</mi></msub><mo>=</mo><mi>η</mi><mfenced separators=""><mstyle displaystyle="true"><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>l</mi></munderover></mstyle><msubsup><mi>δ</mi><mi>k</mi><mi>o</mi></msubsup><mo>⁢</mo><msub><mi>w</mi><mi mathvariant="italic">jk</mi></msub></mfenced><mo>⁢</mo><msub><mi>y</mi><mi>j</mi></msub><mo>⁢</mo><mfenced separators=""><mn>1</mn><mo>-</mo><msub><mi>y</mi><mi>i</mi></msub></mfenced><mo>⁢</mo><msub><mi>x</mi><mi>i</mi></msub><mo>;</mo></math><img id="ib0015" file="imgb0015.tif" wi="57" he="14" img-content="math" img-format="tif"/></maths><br/>
wherein, η is a gradient descent constant, indicating a scale factor, and <i>η</i> ∈ (0,1) ; <i>y<sub>j</sub></i> is an output value of the <i>j</i><sup>th</sup> node in an output vector of the output layer, <i>o<sub>k</sub></i> is the output vector of the output layer, <i>d<sub>k</sub></i> is the expected output vector, and <maths id="math0016" num=""><math display="inline"><msubsup><mi>δ</mi><mi>k</mi><mi>o</mi></msubsup></math><img id="ib0016" file="imgb0016.tif" wi="5" he="6" img-content="math" img-format="tif" inline="yes"/></maths> is a back-propagation error of an output node <i>k</i>.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A reporting device for a network state, comprising:
<claim-text>a receiving module, configured to receive a data packet;</claim-text>
<claim-text>a marking module, configured to mark said data packet according to a current network state;</claim-text>
<claim-text>a forwarding module, configured to forward the marked data packet.</claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The device of claim 10, wherein, said marking module comprises:
<claim-text>a judging unit, configured to judge whether said data packet is a first data packet sent by a source node or not according to a source node identity in said data packet;</claim-text>
<claim-text>a checking unit, configured to, when a judging result of said judging unit is YES, check whether said data packet carries marking information of other nodes or not;</claim-text>
<claim-text>a marking unit, configured to, when a checking result of said checking unit is NO, write an intermediate node identity into a specified subfield<!-- EPO <DP n="42"> --> of said data packet, and record said source node identity and a data packet sequence number of said data packet in a local data structure.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The device of claim 11, wherein, said marking module further comprises:
<claim-text>a link quality detecting unit, configured to, after receiving said data packet, update current link quality in said data packet according to link quality in the link quality detecting unit itself, and detect whether worst link quality in said data packet is greater than the updated current link quality or not;</claim-text>
<claim-text>a link quality marking unit, configured to, when a detecting result of said link quality detecting unit is YES, mark a value of a subfield where said worst link quality is located as the updated current link quality.</claim-text></claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The device of claim 11, wherein, said marking module further comprises:
<claim-text>a searching unit, configured to, when the judging result of said judging unit is NO, search said local data structure for a data structure entry corresponding to said source node identity;</claim-text>
<claim-text>a sequence number judging unit, configured to judge whether the data packet sequence number in said data packet and a data packet sequence number in said data structure entry searched out by said searching unit are continuous or not;</claim-text>
<claim-text>a hop number modifying unit, configured to, when the judging result of said sequence number judging unit is YES, update said data packet sequence number in said data structure entry, and modify a number of hops in said data packet;</claim-text>
<claim-text>a node marking unit, configured to, when the judging result of said sequence number judging unit is NO, mark said intermediate node identity in said data packet.</claim-text><!-- EPO <DP n="43"> --></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A detecting device for a network state, comprising:
<claim-text>a data packet receiving module, configured to receive a data packet;</claim-text>
<claim-text>a marking information acquiring module, configured to parse said data packet to obtain marking information of a network state;</claim-text>
<claim-text>a network state determining module, configured to determine said network state according to said marking information.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The device of claim 14, wherein,<br/>
said marking information acquisition module comprises: a parsing unit, configured to parse said data packet; a marking information acquiring unit, configured to acquire mark information parsed out by said parsing unit, wherein said marking information comprises a source node identity, a data packet sequence number, an intermediate node identity, worst link quality, current link quality and a number of hops; said network state determining module comprises:
<claim-text>a checking unit, configured to check whether there is a path entry corresponding to the source node in said data packet in a local path database or not;</claim-text>
<claim-text>a first state determining unit, configured to, when a checking result of said checking unit is YES, determine the network state as a state that topology information of said source node is not established;</claim-text>
<claim-text>a database modifying unit, configured to, when said first state determining unit determines the network state as a state that said topology information of said source node is not established, add a source node entry into said local path database, wherein said source node entry comprises: the intermediate node identity, the number of hops, the data packet sequence number and the worst link quality;</claim-text>
<claim-text>a second state determining unit, configured to, when the checking result of said check unit is NO, generate a network state preliminary report according to said marking information, and update said source node entry according to said marking information; and make a statistic<!-- EPO <DP n="44"> --> for network state preliminary reports within a specified period, and determine the network state according to a statistic result.</claim-text></claim-text></claim><claim id="c-en-0016" num="0016"><claim-text>The device of claim 15, wherein, said second state determining unit comprises:
<claim-text>a comparing sub-unit, configured to make a comparison to judge whether said sequence number in said data packet and a sequence number corresponding to said source node in said local path database are continuous or not;</claim-text>
<claim-text>an error report generating sub-unit, configured to, when a comparing result of said comparing sub-unit is discontinuity, generate an error report of packet loss;</claim-text>
<claim-text>a transmission success report generating sub-unit, configured to,</claim-text>
<claim-text>when the comparing result of said comparing sub-unit is continuity,</claim-text>
<claim-text>generate a transmission success report;</claim-text>
<claim-text>a routing switch report generating sub-unit, configured to judge whether said data packet is routing switched or not according to said source node entry, and if yes, generate a routing switch report;</claim-text>
<claim-text>a link quality report generating sub-unit, configured to generate a worst link quality report of said source node according to said source node entry.</claim-text></claim-text></claim><claim id="c-en-0017" num="0017"><claim-text>The device of claim 16, wherein, said second state determining unit comprises:
<claim-text>a network information determining sub-unit, configured to determine said network information according to said statistic result, wherein,</claim-text>
<claim-text>said network information comprises at least one of the following: a data packet transmission success rate, a packet loss rate of said source node, with or without routing switch, a parameter of worst link quality corresponding to said source node, and a worst link quality similarity between said source node and an adjacent node;<!-- EPO <DP n="45"> --></claim-text>
<claim-text>a network state determining sub-unit, configured to, according to said network information determined by said network information judging sub-unit, use a back-propagation neural network to determine said network state, wherein, said network state is divided into the following categories: normal, physically damaged, software conflict, network congestion and environmental impact.</claim-text></claim-text></claim><claim id="c-en-0018" num="0018"><claim-text>A detecting system for a network state, comprising: intermediate nodes and sink nodes, wherein said intermediate node comprises said device of any one of claims 10-13, and said sink node comprises said device of any one of claims 14-17.</claim-text></claim></claims><drawings mxw-id="PDW16667231" load-source="patent-office"><!-- EPO <DP n="46"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="117" he="221" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="47"> --><figure id="f0002" num="3"><img id="if0002" file="imgf0002.tif" wi="165" he="96" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="48"> --><figure id="f0003" num="4"><img id="if0003" file="imgf0003.tif" wi="155" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="49"> --><figure id="f0004" num="5"><img id="if0004" file="imgf0004.tif" wi="159" he="206" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="50"> --><figure id="f0005" num="6,7"><img id="if0005" file="imgf0005.tif" wi="146" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="51"> --><figure id="f0006" num="8,9"><img id="if0006" file="imgf0006.tif" wi="128" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="165" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
