<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2683174-A2" country="EP" doc-number="2683174" kind="A2" date="20140108" family-id="48747923" file-reference-id="305898" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146585075" ucid="EP-2683174-A2"><document-id><country>EP</country><doc-number>2683174</doc-number><kind>A2</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13173545-A" is-representative="YES"><document-id mxw-id="PAPP154847267" load-source="docdb" format="epo"><country>EP</country><doc-number>13173545</doc-number><kind>A</kind><date>20130625</date><lang>EN</lang></document-id><document-id mxw-id="PAPP200056424" load-source="docdb" format="original"><country>EP</country><doc-number>13173545.8</doc-number><date>20130625</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140550193" ucid="JP-2012148849-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2012148849</doc-number><kind>A</kind><date>20120702</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2092280523" load-source="docdb">H04N  19/89        20140101ALI20150212RMEP        </classification-ipcr><classification-ipcr mxw-id="PCL2100275380" load-source="docdb">G11B  27/031       20060101ALI20140704BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL2100280344" load-source="docdb">H04N  19/70        20140101ALI20140704BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL2100280478" load-source="docdb">H04N  21/44        20110101AFI20140704BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1919309810" load-source="docdb" scheme="CPC">H04N  19/68        20141101 LI20160707BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1919309895" load-source="docdb" scheme="CPC">H04N  19/44        20141101 LI20160707BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1919312405" load-source="docdb" scheme="CPC">H04N  19/46        20130101 LI20160707BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1919312542" load-source="docdb" scheme="CPC">G11B  27/031       20130101 LI20160709BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1919312698" load-source="docdb" scheme="CPC">H04N  19/132       20141101 LI20160707BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1919312872" load-source="docdb" scheme="CPC">H04N  19/503       20130101 LI20160707BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1919314623" load-source="docdb" scheme="CPC">H04N  19/50        20130101 FI20160707BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1957302677" load-source="docdb" scheme="CPC">H04N  21/44016     20130101 LI20160324BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1957303838" load-source="docdb" scheme="CPC">H04N  21/23424     20130101 LI20160324BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1957309599" load-source="docdb" scheme="CPC">H04N  19/70        20130101 LI20160325BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132359858" lang="DE" load-source="patent-office">Videokodierungsvorrichtung, Videodekodierungsvorrichtung, Videocodierungsverfahren und Videodecodierungsverfahren</invention-title><invention-title mxw-id="PT132359859" lang="EN" load-source="patent-office">Video encoding apparatus, video decoding apparatus, video encoding method, and video decoding method</invention-title><invention-title mxw-id="PT132359860" lang="FR" load-source="patent-office">Appareil de codage vidéo, appareil de décodage vidéo, procédé de codage vidéo et procédé de décodage vidéo</invention-title><citations><patent-citations><patcit mxw-id="PCIT242942991" load-source="docdb" ucid="JP-2003179938-A"><document-id format="epo"><country>JP</country><doc-number>2003179938</doc-number><kind>A</kind><date>20030627</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>"High- Efficiency Video Coding (HEVC) text specification Working Draft 7", JCTVC-I1003, May 2012 (2012-05-01)</text><sources><source mxw-id="PNPL62635235" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>"High-Efficiency Video Coding (HEVC) text specification Working Draft 7", JCTVC-11003, May 2012 (2012-05-01)</text><sources><source mxw-id="PNPL62635236" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>"High-Efficiency Video Coding (HEVC) text specification Working Draft 7", JCTVC-I1003, May 2012 (2012-05-01)</text><sources><source mxw-id="PNPL62635237" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR919525719" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>FUJITSU LTD</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR919538313" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>FUJITSU LIMITED</last-name></addressbook></applicant><applicant mxw-id="PPAR919015802" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>FUJITSU LIMITED</last-name><iid>100126510</iid><address><street>1-1, Kamikodanaka 4-chome, Nakahara-ku</street><city>Kawasaki-shi, Kanagawa 211-8588</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919531121" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>KAZUI KIMIHIKO</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919533947" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>KAZUI, KIMIHIKO</last-name></addressbook></inventor><inventor mxw-id="PPAR919009568" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>KAZUI, KIMIHIKO</last-name><address><street>c/o FUJITSU LIMITED 1-1, Kamikodanaka 4-chome Nakahara-ku Kawasaki-shi</street><city>Kanagawa, 211-8588</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919506773" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>SHIMADA SATOSHI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919528190" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>SHIMADA, SATOSHI</last-name></addressbook></inventor><inventor mxw-id="PPAR919011901" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>SHIMADA, SATOSHI</last-name><address><street>c/o FUJITSU LIMITED 1-1, Kamikodanaka 4-chome Nakahara-ku Kawasaki-shi</street><city>Kanagawa, 211-8588</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919521874" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>KOYAMA JUNPEI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919508082" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>KOYAMA, JUNPEI</last-name></addressbook></inventor><inventor mxw-id="PPAR919018684" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>KOYAMA, JUNPEI</last-name><address><street>c/o FUJITSU LIMITED 1-1, Kamikodanaka 4-chome Nakahara-ku Kawasaki-shi</street><city>Kanagawa, 211-8588</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919011860" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>HOFFMANN EITLE</last-name><iid>100061036</iid><address><street>Patent- und Rechtsanwälte Arabellastrasse 4</street><city>81925 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549743943" load-source="docdb">AL</country><country mxw-id="DS549815870" load-source="docdb">AT</country><country mxw-id="DS549743953" load-source="docdb">BE</country><country mxw-id="DS549908370" load-source="docdb">BG</country><country mxw-id="DS549744463" load-source="docdb">CH</country><country mxw-id="DS549818096" load-source="docdb">CY</country><country mxw-id="DS549815871" load-source="docdb">CZ</country><country mxw-id="DS549743954" load-source="docdb">DE</country><country mxw-id="DS549818097" load-source="docdb">DK</country><country mxw-id="DS549818114" load-source="docdb">EE</country><country mxw-id="DS549813852" load-source="docdb">ES</country><country mxw-id="DS549908371" load-source="docdb">FI</country><country mxw-id="DS549742166" load-source="docdb">FR</country><country mxw-id="DS549743955" load-source="docdb">GB</country><country mxw-id="DS549818115" load-source="docdb">GR</country><country mxw-id="DS549743956" load-source="docdb">HR</country><country mxw-id="DS549815872" load-source="docdb">HU</country><country mxw-id="DS549744464" load-source="docdb">IE</country><country mxw-id="DS549818116" load-source="docdb">IS</country><country mxw-id="DS549742167" load-source="docdb">IT</country><country mxw-id="DS549818117" load-source="docdb">LI</country><country mxw-id="DS549908372" load-source="docdb">LT</country><country mxw-id="DS549815391" load-source="docdb">LU</country><country mxw-id="DS549908373" load-source="docdb">LV</country><country mxw-id="DS549908374" load-source="docdb">MC</country><country mxw-id="DS549815392" load-source="docdb">MK</country><country mxw-id="DS549815393" load-source="docdb">MT</country><country mxw-id="DS549815402" load-source="docdb">NL</country><country mxw-id="DS549742168" load-source="docdb">NO</country><country mxw-id="DS549815403" load-source="docdb">PL</country><country mxw-id="DS549744469" load-source="docdb">PT</country><country mxw-id="DS549813853" load-source="docdb">RO</country><country mxw-id="DS549744470" load-source="docdb">RS</country><country mxw-id="DS549815404" load-source="docdb">SE</country><country mxw-id="DS549743962" load-source="docdb">SI</country><country mxw-id="DS549742173" load-source="docdb">SK</country><country mxw-id="DS549815405" load-source="docdb">SM</country><country mxw-id="DS549818122" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128673247" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A video encoding apparatus appends decoding delay correction information and display delay correction information to encoded video data in order to ensure that even when one or more pictures that are later in encoding order in the video data than a first picture that may potentially be spliced to a trailing end of other encoded video data have been discarded, the first picture and subsequent pictures in the encoded video data can be continuously decoded and displayed by a video decoding apparatus. The video decoding apparatus corrects the decoding delay and display delay of the first picture and its subsequent pictures by using the decoding delay correction information and display delay correction information.
<img id="iaf01" file="imgaf001.tif" wi="144" he="99" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128737398" lang="EN" source="EPO" load-source="docdb"><p>A video encoding apparatus appends decoding delay correction information and display delay correction information to encoded video data in order to ensure that even when one or more pictures that are later in encoding order in the video data than a first picture that may potentially be spliced to a trailing end of other encoded video data have been discarded, the first picture and subsequent pictures in the encoded video data can be continuously decoded and displayed by a video decoding apparatus. The video decoding apparatus corrects the decoding delay and display delay of the first picture and its subsequent pictures by using the decoding delay correction information and display delay correction information.</p></abstract><description mxw-id="PDES63959235" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">FIELD</heading><p id="p0001" num="0001">The embodiments discussed herein are related to a video encoding apparatus and video encoding method that can edit encoded video data without decoding the video data, and also relates to a video decoding apparatus and video decoding method for decoding video data encoded by such a video encoding apparatus.</p><heading id="h0002">BACKGROUND</heading><p id="p0002" num="0002">Generally, the amount of data used to represent video data is very large. Accordingly, an apparatus handling such video data compresses the video data by encoding before transmitting the video data to another apparatus or before storing the video data in a storage device. Coding standards such as MPEG-2 (Moving Picture Experts Group Phase 2), MPEG-4, and H.264 MPEG-4 Advanced Video Coding (MPEG-4 AVC/H.264), devised by the International Standardization Organization/International Electrotechnical Commission (ISO/IEC), are typical video coding standards widely used today.</p><p id="p0003" num="0003">Such coding standards employ an inter-coding method that encodes a picture by using not only information from itself but also information from pictures before and after it, and an intra-coding method that encodes a picture by using only information contained in the picture to be encoded. The inter-coding method uses three types of pictures, referred to as the intra-coded picture (I picture), the forward predicted picture (P picture) which is usually predicted from a past picture, and the bidirectional predicted picture (B picture) which is usually predicted from both past and future pictures.</p><p id="p0004" num="0004">Generally, the amount of code of a picture or block encoded by inter-coding is smaller than the amount of code of a picture or block encoded by intra-coding. In<!-- EPO <DP n="2"> --> this way, the amount of code varies from picture to picture within the same video sequence, depending on the coding mode selected. Similarly, the amount of code varies from block to block within the same picture, depending on the coding mode selected. Therefore, in order to enable a data stream containing encoded video to be transmitted at a constant transmission rate even if the amount of code temporally varies, a transmit buffer for buffering the data stream is provided at the transmitting end, and a receive buffer for buffering the data stream is provided at the receiving end.</p><p id="p0005" num="0005">MPEG-2 and MPEG-4 AVC/H.264 each define the behavior of a receive buffer in an idealized video decoding apparatus referred to as the video buffering verifier (VBV) or the coded picture buffer (CPB), respectively. For convenience, the idealized video decoding apparatus will hereinafter be referred to simply as the idealized decoder. It is specified that the idealized decoder performs instantaneous decoding that takes zero time to decode. For example, Japanese Laid-open Patent Publication No. <patcit id="pcit0001" dnum="JP2003179938A"><text>2003-179938</text></patcit> discloses a video encoder control method concerning the VBV.</p><p id="p0006" num="0006">In order for the receive buffer in the idealized decoder to not overflow or underflow, the video encoder controls the amount of code to guarantee that all the data needed to decode a given picture are available in the receive buffer when the idealized decoder decodes that given picture.</p><p id="p0007" num="0007">When the video encoder is transmitting an encoded video data stream at a constant transmission rate, the receive buffer may underflow if the transmission of the data needed to decode the picture has not been completed by the time the picture is to be decoded and displayed by the video decoder. In other words, the receive buffer underflow refers to a situation in which the data needed to decode the picture are not available in the receive buffer of the video decoder. If this happens, the video<!-- EPO <DP n="3"> --> decoder is unable to perform decoding, and frame skipping occurs.</p><p id="p0008" num="0008">In view of this, the video decoder displays the picture after delaying the stream by a prescribed time from its receive time so that the decoding can be done without causing the receive buffer to underflow. As described earlier, it is specified that the idealized decoder accomplishes decoding in zero time. As a result, if the input time of the i-th picture to the video encoder is t(i), and the decode time of the i-th picture at the idealized decoder is tr(i), then the earliest time at which the picture becomes ready for display is the same as tr(i). Since the picture display period {t(i+1) - t(i)} is equal to {tr(i+1) - tr(i)} for any picture, the decode time tr(i) is given as tr(i) = t(i) + dly, i.e., the time delayed by a fixed time dly from the input time t(i). This means that the video encoder has to complete the transmission of all the data needed for decoding to the receive buffer by the time tr(i).</p><p id="p0009" num="0009">Referring to <figref idrefs="f0001">Figure 1</figref>, a description will be given of how the receive buffer operates. In <figref idrefs="f0001">Figure 1</figref>, the abscissa represents the time, and the ordinate represents the buffer occupancy of the receive buffer. Solid line graph 100 depicts the buffer occupancy as a function of time.</p><p id="p0010" num="0010">The buffer occupancy of the receive buffer is restored at a rate synchronized to a prescribed transmission rate, and the data used for decoding each picture is retrieved from the buffer at the decode time of the picture. The data of the i-th picture starts to be input to the receive buffer at time at(i), and the final data of the i-th picture is input at time ft(i). The idealized decoder completes the decoding of the i-th picture at time tr(i), and thus the i-th picture becomes ready for display at time tr(i). However, if the data stream contains a B picture, the actual display time of the i-th picture may become later than tr(i) due to the<!-- EPO <DP n="4"> --> occurrence of picture reordering (changing the encoding order).</p><p id="p0011" num="0011">The method of describing the decode time and display time of each picture in MPEG-4 AVC/H.264 will be described in detail below.</p><p id="p0012" num="0012">In MPEG-4 AVC/H.264, supplemental information not directly relevant to the decoding of pixels is described in a supplemental enhancement information (SEI) message. Tens of SEI message types are defined, and each type is identified by a payloadType parameter. The SEI is appended to each picture.</p><p id="p0013" num="0013">BPSEI (Buffering Period SEI) as one type of SEI is appended to a self-contained picture, i.e., a picture (generally, an I picture) that can be decoded without any past pictures. A parameter InitialCpbRemovalDelay is described in the BPSEI. The InitialCpbRemovalDelay parameter indicates the difference between the time of arrival in the receive buffer of the first bit of the BPSEI-appended picture and the decode time of the BPSEI-appended picture. The resolution of the difference is 90 kHz. The decode time tr(0) of the first picture is the time of arrival in the video decoder of the first bit of the encoded video data (the time is designated as 0); i.e., the decode time is delayed from time at(0) by an amount of time equal to InitialCpbRemovalDelay ÷ 90,000 [sec].</p><p id="p0014" num="0014">Generally, PTSEI (Picture Timing SEI) as one type of SEI is appended to each picture. Parameters CpbRemovalDelay and DpbOutputDelay are described in the PTSEI. The CpbRemovalDelay parameter indicates the difference between the decode time of the immediately preceding BPSEI-appended picture and the decode time of the PTSEI-appended picture. The DpbOutputDelay parameter indicates the difference between the decode time of the PTSEI-appended picture and the display time of the picture. The resolution of these differences is one field picture interval. Accordingly, when the picture is<!-- EPO <DP n="5"> --> a frame, the value of each of the parameters CpbRemovalDelay and DpbOutputDelay is a multiple of 2.</p><p id="p0015" num="0015">The decode time tr(i) of each of the second and subsequent pictures is delayed from the decode time tr(0) of the first picture by an amount of time equal to tc*CpbRemovalDelay(i) [sec]. CpbRemovalDelay(i) is the CpbRemovalDelay appended to the i-th picture. On the other hand, tc is the inter-picture time interval [sec]; for example, in the case of 29.97-Hz progressive video, tc is 1001/60000.</p><p id="p0016" num="0016">The display time of each of the pictures, including the BPSEI-appended picture, is delayed from tr(i) by an amount of time equal to tc*DpbOutputDelay(i). DpbOutputDelay(i) is the DpbOutputDelay appended to the i-th picture. In other words, after time tr(0), each picture is decoded and displayed at time equal to an integral multiple of tc.</p><p id="p0017" num="0017">Depending on the purpose of video data, the encoded video may be edited. Editing the encoded video involves dividing the encoded video data into smaller portions and splicing them to generate a new encoded video data stream. For example, insertion of another video stream (for example, an advertisement) into the currently broadcast video stream (i.e., splicing) is one example of editing.</p><p id="p0018" num="0018">When editing inter-frame predictive coded video, particularly in the case of an inter-coded picture, the encoded picture cannot be decoded correctly by itself. Accordingly, when splicing two encoded video data streams at a desired picture position, an encoded video data editing machine first decodes the two encoded video data streams to be spliced and then splice them on a decoded picture-by-picture basis, and thereafter re-encodes the spliced video data.</p><p id="p0019" num="0019">However, since re-encoding can be very laborious, in particular, in the case of real time processing such as splicing, it is common to restrict the splicing point and<!-- EPO <DP n="6"> --> edit the encoded video data directly by eliminating the need for re-encoding. When splicing two encoded video data streams by editing without the need for re-encoding, the first picture of the encoded video data stream to be spliced on the temporally downstream side has to be an I picture. Furthermore, the GOP structure of the encoded video data stream to be spliced on the temporally downstream side is limited to the so-called closed GOP structure in which all the pictures that follow the starting I picture are decodable without referring to any pictures temporally preceding the starting I picture. With this arrangement, it is possible to correctly decode all the pictures that follow the starting I picture of the encoded video data stream spliced on the downstream side by editing at the desired splicing point.</p><p id="p0020" num="0020">However, since the coding efficiency of the closed GOP structure is lower than that of the non-closed GOP structure, the non-closed GOP structure may be employed. In that case, some of the pictures immediately following the starting I picture after the splicing point are not correctly decoded, but since these pictures precede the starting I picture in display order, there will be no problem if they are not displayed. Therefore, as a general practice, after displaying the last picture of the temporally preceding encoded video data stream, the video decoder performs processing such as freezing the display, thereby masking the display of the pictures that failed to be decoded correctly.</p><p id="p0021" num="0021">In the prior art, even when the inter-frame predictive coded video data is edited without re-encoding, the header information is also edited so that a discrepancy does not occur between the two encoded video data stream spliced together. For example, in MPEG-4 AVC/H.264, POC (Picture Order Count) and FrameNum are appended to the slice header in order to maintain the inter-picture temporal relationship and identify the reference picture. POC indicates the relative display<!-- EPO <DP n="7"> --> order of the picture. FrameNum is a value that increments by 1 each time the reference picture appears in the encoded video. Since POC values and FrameNum values need to be continuous between the spliced two encoded video data stream, there arises a need to edit all of the POC values and FrameNum values in the encoded video data stream to be spliced on the downstream side of the temporally preceding encoded video data stream.</p><p id="p0022" num="0022">On the other hand, in the method disclosed in non-patent document <nplcit id="ncit0001" npl-type="s"><text>JCTVC-I1003, "High-Efficiency Video Coding (HEVC) text specification Working Draft 7," Joint Collaborative Team on Video Coding of ITU-T SG16 WP3 and ISO/IEC JTC1/SC29/WG11, May 2012</text></nplcit>, FrameNum is abolished because a new method for identifying reference pictures has been introduced. Furthermore, since the POC value of the first picture of the encoded video data stream spliced on the downstream side need not have continuity with respect to the encoded video data stream spliced on the upstream side, there is no need to edit the slice header. In the method disclosed in the above non-patent document, a CRA (Clean Random Access) picture, a BLA (Broken Link Access) picture, and a TFD (Tagged For Discard) picture have been introduced as new picture types in addition to the IDR (Instantaneous Decoding Refresh) picture defined in MPEG-4 AVC/H.264.</p><p id="p0023" num="0023">Of these pictures, the CRA picture and the BLA picture are both self-contained pictures, i.e., pictures that do not refer to any other pictures, so that pictures that follow the CRA picture or the BLA picture can be decoded correctly. When the video decoder starts decoding starting with a CRA picture, for example, any subsequent pictures other than the TFD picture that immediately follows the CRA picture can be decoded correctly.</p><p id="p0024" num="0024">The TFD picture is a picture that appears immediately following the CRA picture or the BLA picture, and that refers to a picture appearing earlier than the<!-- EPO <DP n="8"> --> CRA picture or the BLA picture in time order and in decoding order. In the case of the non-closed GOP structure that conforms to MPEG-2, the plurality of B pictures immediately following the I picture at the head of the GOP each correspond to the TFD picture.</p><p id="p0025" num="0025">The BLA picture occurs as a result of editing of the encoded video data. Of the spliced two encoded video data streams, the encoded video data stream spliced on the downstream side generally begins with a CRA picture, but if this CRA picture appears partway through the spliced encoded video data, its picture type is changed from the CRA picture to the BLA picture. In the method disclosed in the above non-patent document, when the BLA picture appears, the POC values are permitted to become discontinuous. Further, the TFD picture that immediately follows this BLA picture is unable to be decoded correctly from any point in the spliced encoded video data because the picture to be referred to by it is lost from the spliced encoded video data. Therefore, the video encoder may delete from the encoded video data any TFD picture that follows the BLA picture at the head of the encoded video data stream to be spliced on the downstream side.</p><heading id="h0003">SUMMARY</heading><p id="p0026" num="0026">In the method disclosed in the above non-patent document, as in MPEG-4 AVC/H.264, the decode time and display time of each encoded picture are determined by using the parameters InitialCpbRemovalDelay, CpbRemovalDelay, and DpbOutputDelay. When splicing two encoded video data streams, the parameters CpbRemovalDelay and DpbOutputDelay of the picture after the splicing point need to be corrected to appropriate values in order to ensure continuous video decoding and display across the splicing point.</p><p id="p0027" num="0027">More specifically, the video encoder or the video decoder needs to correct the value of CpbRemovalDelay of<!-- EPO <DP n="9"> --> the CRA picture at the head of the encoded video data stream spliced on the downstream side, based on the number of pictures that follow the last BPSEI-appended picture in the temporally preceding encoded video data stream. Furthermore, the video encoder or the video decoder increments the value of CpbRemovalDelay in order to ensure CPB buffer continuity. Further, when discarding the TFD picture in the encoded video data stream to be spliced on the downstream side, the video encoder or the video decoder needs to correct the value of CpbRemovalDelay of the picture to be decoded after the discarded TFD picture as well as the value of DpbOutputDelay of the first CRA picture after the splicing point.</p><p id="p0028" num="0028">Thus, in the method disclosed in the above non-patent document, there still exists a need to correct the contents of PTSEI when performing editing operations for splicing two encoded video data streams.</p><p id="p0029" num="0029">Accordingly, it is an object of the present invention to provide a motion video encoding apparatus and motion video decoding apparatus that can ensure continuous video decoding process and display process without editing the parameters in the header of the original encoded video data when splicing two inter-frame predictive encoded video data streams.</p><p id="p0030" num="0030">According to one embodiment, a video encoding apparatus for encoding video data by inter-frame predictive coding is provided. The video encoding apparatus includes: an encoding control unit which obtains decoding delay correction information and display delay correction information for ensuring that even when one or more pictures that are later in encoding order in the video data than a first picture that may potentially be spliced to a trailing end of other encoded video data have been discarded, the first picture and subsequent pictures in the encoded video data can be continuously decoded and displayed by a video decoding apparatus; and<!-- EPO <DP n="10"> --> a picture encoding unit which encodes each picture contained in the video data and appends the decoding delay correction information and the display delay correction information to the video data encoded.</p><p id="p0031" num="0031">According to another embodiment, a video decoding apparatus for decoding video data encoded by inter-frame predictive coding is provided. The video decoding apparatus includes: a picture decoding/display time determining unit which, when the encoded video data contains information indicating that the encoded video data has been generated by splicing second encoded video data to a trailing end of first encoded video data, information indicating that one or more encoded pictures that are later in encoding order than a starting encoded picture in the second encoded video data after a splicing point at which the first encoded video data and the second encoded video data are spliced have been discarded, decoding delay correction information for correcting a decoding delay of a picture that follows the starting encoded picture, and display delay correction information for correcting a display delay of the starting encoded picture, then corrects the display delay of the starting encoded picture based on the display delay correction information, while also correcting, based on the decoding delay correction information, the decoding delay of the picture that follows the starting encoded picture.</p><heading id="h0004">BRIEF DESCRIPTION OF DRAWINGS</heading><p id="p0032" num="0032"><ul><li><figref idrefs="f0001">Figure 1</figref> is a diagram illustrating the relationship between the buffer occupancy of a receive buffer and the display time.</li><li><figref idrefs="f0002">Figure 2</figref> is a diagram illustrating the relationship between the display order and decoding order of various pictures contained in video data and the decoding delay and display delay values of the respective pictures.</li><li><figref idrefs="f0003">Figure 3</figref> is a diagram for explaining the decoding<!-- EPO <DP n="11"> --> delay and display delay values of the pictures after the splicing point when two encoded video data streams are spliced.</li><li><figref idrefs="f0004">Figure 4</figref> is a diagram for explaining the data structure of one picture in encoded video according to a first embodiment.</li><li><figref idrefs="f0005">Figure 5</figref> is a simplified block diagram of a video encoding apparatus according to the first embodiment.</li><li><figref idrefs="f0006">Figure 6</figref> is an operation flowchart of a video encoding process according to the first embodiment.</li><li><figref idrefs="f0007">Figure 7</figref> is an operation flowchart of a video editing process according to the first embodiment.</li><li><figref idrefs="f0008">Figure 8</figref> is a simplified block diagram of a video decoding apparatus according to the first embodiment.</li><li><figref idrefs="f0009">Figure 9</figref> is an operation flowchart of a video decoding process according to the first embodiment.</li><li><figref idrefs="f0010">Figure 10</figref> is a diagram for explaining the data structure of one picture in encoded video according to a second embodiment.</li><li><figref idrefs="f0011">Figure 11</figref> is a diagram for explaining the decoding delay and display delay values of the pictures after the splicing point when two encoded video data streams are spliced and when pictures preceding the splicing point in display order have been discarded in the encoded video data stream spliced upstream of the splicing point.</li><li><figref idrefs="f0012">Figure 12</figref> is a diagram for explaining the decoding delay and display delay values of the pictures after the splicing point when the number of pictures to be reordered in the encoded video data stream spliced downstream of the splicing point is smaller than the number of pictures to be reordered in the encoded video data stream spliced upstream of the splicing point.</li><li><figref idrefs="f0013">Figure 13</figref> is a diagram for explaining the decoding delay and display delay values of the pictures after the splicing point when the number of pictures to be reordered in the encoded video data stream spliced upstream of the splicing point is smaller than the number<!-- EPO <DP n="12"> --> of pictures to be reordered in the encoded video data stream spliced downstream of the splicing point.</li><li><figref idrefs="f0014">Figure 14</figref> is a diagram for explaining the data structure of one picture in encoded video according to a fifth embodiment.</li><li><figref idrefs="f0015">Figure 15</figref> is a diagram for explaining the data structure of one picture in encoded video according to a sixth embodiment.</li><li><figref idrefs="f0016">Figure 16</figref> is a diagram for explaining the data structure of one picture in encoded video according to a seventh embodiment.</li><li><figref idrefs="f0017">Figure 17</figref> is a diagram illustrating the configuration of a computer that operates as the video encoding apparatus or video decoding apparatus by executing a computer program for implementing the functions of the various units in the video encoding apparatus or video decoding apparatus according to any one of the embodiments or their modified examples.</li></ul></p><heading id="h0005">DESCRIPTION OF EMBODIMENTS</heading><p id="p0033" num="0033">Video encoding apparatus and video decoding apparatus according to various embodiments will be described below with reference to the drawings. When splicing two encoded video data streams without decoding them, the video encoding apparatus computes the values to be used for correcting the parameters indicating the decode time and display time of each picture appearing after the splicing point, and adds the values in the header information of each picture appearing after the splicing point. In this way, the video encoding apparatus eliminates the need to edit the parameters in the header of the original encoded video data when splicing two encoded video data streams.</p><p id="p0034" num="0034">In the present embodiments, the picture is a frame. However, the picture may not be limited to a frame, but may be a field. A frame refers to one complete still image in the video data, while a field refers to a still<!-- EPO <DP n="13"> --> image obtained by extracting data only in the odd-numbered lines or even-numbered lines from one frame. The encoded video data may be color video data or monochrome video data.</p><p id="p0035" num="0035">First, referring to <figref idrefs="f0002">Figure 2</figref>, the values of picture decoding delay CpbRemovalDelay and display delay DpbOutputDelay according to a first embodiment will be described by taking one picture coding structure as an example.</p><p id="p0036" num="0036">In <figref idrefs="f0002">Figure 2</figref>, the picture coding structure 201 as one example of the picture coding structure contains a plurality of pictures. Each block in the picture coding structure 201 represents one picture. Of the two characters carried in the block corresponding to each picture, the alphabetic character at the left indicates the coding mode applied to the picture. The characters I, P, and B mean I picture, P picture, and B picture, respectively. Of the two characters carried in each block, the number at the right indicates the order of input to the video encoding apparatus. The input order coincides with the order in which the picture is output from the video decoding apparatus. Each arrow depicted above the picture coding structure 201 indicates the reference picture to which a picture to be encoded by forward frame prediction refers. For example, a picture P4 refers to a picture 10 that appears earlier than the picture P4. On the other hand, each arrow depicted below the picture coding structure 201 indicates the reference picture to which a picture to be encoded by backward frame prediction refers. For example, a picture B2 refers to the picture P4 that appears later than the picture B2.</p><p id="p0037" num="0037">The picture sequence presented below the picture coding structure 201 is the decoding order 202 of the pictures contained in the picture coding structure 201. Each block in the decoding order 202 represents one picture and, as in the case of the picture coding<!-- EPO <DP n="14"> --> structure 201, the characters carried in the block indicate the coding mode and the order of input to the video encoding apparatus. The decoding order 202 coincides with the order of encoding performed by the video encoding apparatus.</p><p id="p0038" num="0038">In the decoding order 202, BPSEI is appended to each picture that carries the designation "BPSEI" thereunder. In the illustrated example, BPSEI is appended to every I picture. In other words, for every I picture, the InitialCpbRemovalDelay parameter that indicates the difference between the time of arrival in the receive buffer of the first bit of the I picture and the decode time of the I picture is defined.</p><p id="p0039" num="0039">A block array 203 presented below the decoding order 202 indicates the values of CpbRemovalDelay and DpbOutputDelay carried in PTSEI appended to each picture. Each block in the upper row of the block array 203 carries the value of CpbRemovalDelay for the corresponding picture in the decoding order 202 located directly above that block. Likewise, each block in the lower row of the block array 203 carries the value of DpbOutputDelay for the corresponding picture in the decoding order 202 located directly above that block. CpbRemovalDelay corresponds to the order of encoding as counted from the most recent picture in the encoding order among the pictures to which BPSEI is appended. For example, a picture P8 is the fifth picture in the encoding order as counted from the picture I0. In the present embodiment, since each picture is a frame, and the inter-picture time interval tc is a value expressed in units of fields, the CpbRemovalDelay value of the picture P8 is given as 10 (= 5*2).</p><p id="p0040" num="0040">On the other hand, DpbOutputDelay specifies the display delay that is needed in the video decoding apparatus to sequentially output the pictures in the correct order. For example, the DpbOutputDelay value of the picture P4 is 10. This is the delay needed to<!-- EPO <DP n="15"> --> correctly display the picture B1 whose difference between the input order and the encoding order in the video encoding apparatus is the largest. In other words, since the picture B1 is decoded with a delay of two pictures after the picture P4 is decoded, the display time of the picture P4 has to be further delayed by three picture times from the earliest time at which the picture B1 becomes ready for display, i.e., the time at which the picture B1 is decoded. Since the difference between the decode time and display time of the picture P4 is equal to five picture times, and since tc is expressed in units of fields, the value of DpbOutputDelay is given as 10.</p><p id="p0041" num="0041">Next, referring to <figref idrefs="f0003">Figure 3</figref>, an explanation will be given of the values that, when two encoded video data streams are spliced, the decoding delay CpbRemovalDelay and display delay DpbOutputDelay of each picture in the encoded video data stream spliced downstream of the splicing point may take in order to eliminate any inconsistencies in decoding delay and display delay before and after the splicing point of the two encoded video data streams.</p><p id="p0042" num="0042">Each block in the first encoded video data stream 301 spliced upstream of the splicing point represents one picture, and the characters carried in the block indicate the coding mode and the order of input to the video encoding apparatus, as in the case of <figref idrefs="f0002">Figure 2</figref>. In the illustrated example, the coding structure of the first encoded video data stream 301 is identical to the coding structure 201 depicted in <figref idrefs="f0002">Figure 2</figref>.</p><p id="p0043" num="0043">In the illustrated example, the second video data stream 302 is spliced immediately following the last picture B15 of the first encoded video data stream. In the second video data stream 302 also, each block represents one picture, and the characters carried in the block indicate the coding mode and the order of input to the video encoding apparatus. The coding structure of the second encoded video data stream 302 also is<!-- EPO <DP n="16"> --> identical to the coding structure 201 depicted in <figref idrefs="f0002">Figure 2</figref>. In the illustrated example, the picture I72 and the subsequent pictures in the second encoded video data stream 302 are spliced so as to follow the picture B15 in the first encoded video data stream.</p><p id="p0044" num="0044">A block array 303 presented below the second encoded video data stream 302 indicates the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay carried in PTSEI appended to each picture of the second encoded video data stream 302. Each block in the upper row of the block array 303 carries the value of the decoding delay CpbRemovalDelay for the corresponding picture in the second encoded video data stream 302 located directly above that block. Likewise, each block in the lower row of the block array 303 carries the value of the display delay DpbOutputDelay for the corresponding picture in the second encoded video data stream 302 located directly above that block.</p><p id="p0045" num="0045">Spliced encoded video data 304 generated by splicing the first and second encoded video data streams 301 and 302 is depicted below the block array 303. In the illustrated example, the picture B67 in the second encoded video data stream 302 and the pictures preceding the picture B67 in the encoding order are not contained in the spliced encoded video data 304. Further, the pictures B70, B69, and B71 each refer to the encoded picture I68 that precedes the picture I72 in the encoding order. As a result, when the data is spliced at the picture I72, the pictures B70, B69, and B71 would become unable to be correctly reproduced. Therefore, the pictures B70, B69, and B71 are discarded when splicing the data. However, the pictures B70, B69, and B71 may not be discarded and may be retained in the spliced encoded video data.</p><p id="p0046" num="0046">A block array 305 indicates the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay that the pictures I72, P76, B74, B73, and<!-- EPO <DP n="17"> --> B75 in the spliced encoded video data 304 are supposed to have. Each block in the upper row of the block array 305 carries the value of the decoding delay CpbRemovalDelay for the corresponding picture in the spliced encoded video data 304 located directly above that block. Likewise, each block in the lower row of the block array 305 carries the value of the display delay DpbOutputDelay for the corresponding picture in the spliced encoded video data 304 located directly above that block. The decoding delay CpbRemovalDelay of the picture I72, after splicing, needs to be made to match the encoded picture interval relative to the picture I12 which is the picture having the immediately preceding BPSEI; in the illustrated example, the picture I72 is the eighth picture in the encoding order as counted from the picture I12, and therefore, the decoding delay CpbRemovalDelay is given as 16. The display delay DpbOutputDelay of the picture I72 needs also to be corrected so that the picture B73 to be decoded later than the picture I72 can be correctly displayed. The value of the display delay DpbOutputDelay of the picture I72 is different before and after the discarding of the pictures B70, B69, and B71. The value of the display delay DpbOutputDelay after the discarding of the pictures B70, B69, and B71 corresponds to the number of pictures input to the video encoding apparatus later than the picture B69 but encoded earlier than the picture B69. In the illustrated example, there are two such pictures, the pictures I72 and B70, and therefore, the value of the display delay DpbOutputDelay of the picture I72 is given as 4.</p><p id="p0047" num="0047">The value of the decoding delay CpbRemovalDelay of each of the pictures P76, B74, B73, and B75 is also different before and after the discarding of the pictures B70, B69, and B71. The value of the decoding delay CpbRemovalDelay of each of the pictures P76, B74, B73, and B75 after the discarding of the pictures B70, B69, and B71 is equal to the value obtained by subtracting the<!-- EPO <DP n="18"> --> value corresponding to the number of discarded pictures from the value of the decoding delay CpbRemovalDelay before the discarding of the pictures. In the illustrated example, the values of the decoding delay CpbRemovalDelay of the pictures P76, B74, B73, and B75 are given as 2, 4, 6, and 8, respectively, by subtracting 6 from the original values of the decoding delay CpbRemovalDelay of the respective signals. The value of the display delay DpbOutputDelay of each of the pictures P76, B74, B73, and B75 remains unchanged. Further, for any picture that was input later than the picture that would become the first CRA picture in the spliced encoded video data, neither the decoding delay CpbRemovalDelay nor the display delay DpbOutputDelay need be corrected.</p><p id="p0048" num="0048">As described above, when two encoded video data streams are spliced together, there arises a need at the time of decoding to correct the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay for some of the pictures contained in the encoded video data stream spliced downstream of the splicing point. In the present embodiment, instead of correcting the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay of the affected pictures contained in the original encoded video data before splicing, the video encoding apparatus adds in the header of the encoded video data the parameters that can be used to change the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay to appropriate values when the video decoding apparatus decodes the spliced encoded video data.</p><p id="p0049" num="0049">Next, referring to <figref idrefs="f0004">Figure 4</figref>, the structure of the encoded video data according to the first embodiment will be described that contains the parameters that can be used to change the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay to appropriate values.</p><p id="p0050" num="0050">As depicted in <figref idrefs="f0004">Figure 4</figref>, the data structure 400 of<!-- EPO <DP n="19"> --> one picture contains six kinds of network abstraction layer (NAL) units 410 to 415. These NAL units 410 to 415 each conform to the NAL unit defined in MPEG-4 AVC/H.264 and the method disclosed in the non-patent document <nplcit id="ncit0002" npl-type="s"><text>JCTVC-I1003, "High-Efficiency Video Coding (HEVC) text specification Working Draft 7," Joint Collaborative Team on Video Coding of ITU-T SG16 WP3 and ISO/IEC JTC1/SC29/WG11, May 2012</text></nplcit>. A header NUH 420 is appended to each NAL unit. The header NUH 420 contains a NalUnitType field that indicates the type of the NAL unit. When NalUnitType is 4, the picture to which this header is appended is a self-contained CRA picture immediately after which appears a TFD picture that refers to a picture preceding the CRA picture in time order as well as in decoding order. When NalUnitType is 5, the picture to which this header is appended is a CRA picture immediately after which a TFD picture does not appear. When NalUnitType is 6, the picture to which this header is appended is a self-contained BLA picture that immediately follows the splicing point and that is immediately followed by a TFD picture. When NalUnitType is 7, the picture to which this header is appended is a BLA picture immediately after which a TFD picture does not appear. The NalUnitType value of each picture need not be limited to the above specific value, but may be set to some other suitable value.</p><p id="p0051" num="0051">The NAL units will be explained below.</p><p id="p0052" num="0052">The NAL unit 410 is a delimiter (DELIM) NAL unit and indicates a picture boundary.</p><p id="p0053" num="0053">The NAL unit 411 is a sequence parameter set (SPS) NAL unit which carries a set of parameters common to the entire sequence of the encoded video. The NAL unit 411 is appended to a self-contained picture.</p><p id="p0054" num="0054">The NAL unit 412 is a picture parameter set (PPS) NAL unit which carries a set of parameters common to a plurality of encoded pictures. The PPS NAL unit 412 is appended to a self-contained picture, and may sometimes<!-- EPO <DP n="20"> --> be appended to other types of picture.</p><p id="p0055" num="0055">The NAL unit 413 is a BPSEI NAL unit which is appended only to a self-contained picture. In the present embodiment, the parameters to be used by the video decoding apparatus to correct the decoding delay and display delay of each picture appearing after the splicing point are added in this NAL unit 413.</p><p id="p0056" num="0056">The NAL unit 414 is a PTSEI NAL unit which is appended to every picture.</p><p id="p0057" num="0057">The NAL unit 415 is a slice (SLICE) NAL unit which is the substance of the encoded picture.</p><p id="p0058" num="0058">The BPSEI NAL unit 413 according to the present embodiment contains a number, (N+1), of InitialCpbRemovalDelay/InitialCpbRemovalDelayOffset field pairs (where N is an integer not smaller than 0) and a RapCpbParamsPresentFlag field that follows these pairs. When RapCpbParamsPresentFlag is 1, a decoding delay correction information AltCpbRemovalDelayOffset field 431 to be used for correcting the decoding delay and a display delay correction information AltDpbOutputDelay field 432 to be used for correcting the display delay are also contained in the BPSEI NAL unit 413. On the other hand, when RapCpbParamsPresentFlag is 0, neither the decoding delay correction information AltCpbRemovalDelayOffset field 431 nor the display delay correction information AltDpbOutputDelay field 432 is contained in the BPSEI NAL unit 413. A description of how the decoding delay correction information AltCpbRemovalDelayOffset field 431 and the display delay correction information AltDpbOutputDelay field 432 are determined and used will be given later.</p><p id="p0059" num="0059">The reason that there is more than one InitialCpbRemovalDelay/InitialCpbRemovalDelayOffset field pair is to describe the InitialCpbRemovalDelay and InitialCpbRemovalDelayOffset parameters suitable for the case where the encoded bit stream is transmitted at (N+1) different bit rates. The InitialCpbRemovalDelayOffset<!-- EPO <DP n="21"> --> parameter defines the difference between the encoding completion time of the first picture in the video encoding apparatus and the start time of the transmission of the encoded picture data to the video decoding apparatus.</p><p id="p0060" num="0060">The PTSEI NAL unit 414 contains a decoding delay CpbRemovalDelay field and a DpbOutputDelay field. The definition of these fields may be the same as that given in the method disclosed in the earlier cited non-patent document or in MPEG-4 AVC/H.264.</p><p id="p0061" num="0061"><figref idrefs="f0005">Figure 5</figref> is a simplified block diagram of the video encoding apparatus according to the first embodiment. The video encoding apparatus 1 includes a control unit 11, an encoding control unit 12, a picture encoding unit 13, a splicing point identification information processing unit 14, and a data splicing unit 15. These units constituting the video encoding apparatus 1 are each implemented as a separate circuit on the video encoding apparatus 1. Alternatively, these units constituting the video encoding apparatus 1 may be implemented on the video encoding apparatus 1 in the form of a single integrated circuit on which the circuits implementing the functions of the respective units are integrated. Further, these units constituting the video encoding apparatus 1 may be functional modules implemented by executing a computer program on a processor incorporated in the video encoding apparatus 1.</p><p id="p0062" num="0062">The control unit 11 controls the operation of each designated unit of the video encoding apparatus 1 when encoding the video data or when editing the encoded video data. For example, based on the reproduced image quality, compression ratio, etc., needed of the encoded video data, the control unit 11 determines the GOP structure, etc., that are applied to the video data to be encoded. Then, the control unit 11 signals the GOP structure, etc., to the encoding control unit 12.</p><p id="p0063" num="0063">First, a video encoding process for encoding the<!-- EPO <DP n="22"> --> video data will be described. The video encoding process is carried out using the encoding control unit 12 and the picture encoding unit 13.</p><p id="p0064" num="0064">The encoding control unit 12 determines the encoding order, the coding mode (for example, intra-coding, forward prediction, or bidirectional prediction), etc., for each picture in accordance with the GOP structure signaled from the control unit 11. Then, based on the coding mode, the position within the GOP structure, etc., of each picture, the encoding control unit 12 determines the CRA picture insertion interval, the number of pictures to be reordered at the time of encoding, and the maximum display delay. In the example illustrated in <figref idrefs="f0002">Figure 2</figref>, the CRA picture insertion interval is 12, the number of pictures to be reordered is 2, and the maximum display delay is 5. The encoding control unit 12 generates the header information of each picture based on these values.</p><p id="p0065" num="0065">For example, if the picture type is the I picture (CRA picture) which is encoded without referring to any other picture, and if the picture is not the starting picture of the encoded video data, then when the number of pictures to be reordered is not smaller than 1, the encoding control unit 12 sets NalUnitType in the NUH 420 of each slice of the picture to 4 which indicates that the picture is immediately followed by a TFD picture. On the other hand, when the number of pictures to be reordered is 0, the encoding control unit 12 sets NalUnitType in the NUH 420 of each slice of the picture to 5 which indicates that the picture is not immediately followed by a TFD picture. NalUnitType in the NUH 420 of each slice of the starting picture of the encoded video data is set to 8 (IDR picture). Further, when the number of pictures to be reordered is not smaller than 1, the encoding control unit 12 sets NalUnitType to 2 (TFD picture) for the non-reference picture that immediately follows the CRA picture and that refers to a picture<!-- EPO <DP n="23"> --> which is earlier in both the decoding order and the display order than the CRA picture. For the other pictures, the encoding control unit 12 sets NalUnitType to 1.</p><p id="p0066" num="0066">The encoding control unit 12 notifies the picture encoding unit 13 of the value of NalUnitType that has been set in the header NUH 420 of each slice of the picture to be encoded. Further, the encoding control unit 12 obtains the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay in the PTSEI of each picture from the picture prediction structure, as shown in <figref idrefs="f0002">Figure 2</figref>, and notifies the picture encoding unit 13 accordingly.</p><p id="p0067" num="0067">When NalUnitType in the NUH 420 of each slice of the picture is 8, 4, or 5, the encoding control unit 12 appends BPSEI to the picture. Then, when NalUnitType is 8 or 5, the encoding control unit 12 sets RapCpbParamsPresentFlag to 0. On the other hand, when NalUnitType is 4, the encoding control unit 12 sets RapCpbParamsPresentFlag to 1.</p><p id="p0068" num="0068">Further, the encoding control unit 12 sets the value of the display delay correction information AltDpbOutputDelay parameter, which is used to correct the display delay, equal to twice the number of pictures to be reordered, i.e., twice the number of pictures that follow the CRA picture in the encoding order and that occur between the display time of the picture earliest in the decoding order and the display time of the CRA picture. Then, the encoding control unit 12 sets the value of the decoding delay correction information AltCpbRemovalDelayOffset parameter, which is used to correct the decoding delay, equal to twice the number of TFD pictures that immediately follow the CRA picture.</p><p id="p0069" num="0069">For each picture, the encoding control unit 12 signals the coding mode and the header information of the picture to the picture encoding unit 13, and issues an instruction to encode the picture.<!-- EPO <DP n="24"> --></p><p id="p0070" num="0070">The picture encoding unit 13, in response to the instruction from the encoding control unit 12, encodes the picture with the specified coding mode by employing one of video coding methods capable of inter-frame predictive coding. The video coding method that the picture encoding unit 13 employs may be, for example, MPEG-4 AVC/H.264 or MPEG-2. The picture encoding unit 13 stores the encoded video data, containing each encoded picture, in a storage unit (not depicted).</p><p id="p0071" num="0071">Next, an editing process performed when splicing two encoded video data streams will be described. The editing process is carried out using the splicing point identification information processing unit 14 and the data splicing unit 15.</p><p id="p0072" num="0072">The splicing point identification information processing unit 14 reads out from a storage unit (not depicted) the two encoded video data streams selected, for example, via a user interface unit not depicted. Then, in accordance with an externally applied control signal not depicted, the splicing point identification information processing unit 14 identifies the splicing point starting picture in the second encoded video data stream to be spliced temporally downstream of the other one of the encoded video data streams. The external control signal specifies, for example, the number of encoded pictures from the beginning of the second encoded video data stream, and the splicing point identification information processing unit 14 takes, for example, the latest CRA picture within this number of encoded pictures as the splicing point picture.</p><p id="p0073" num="0073">For the splicing point CRA picture identified, if the NalUnitType of the slice of that picture is 4, the splicing point identification information processing unit 14 changes the value of the NalUnitType to 7 which indicates that the picture is a BLA picture that is not immediately followed by a TFD picture. Further, the splicing point identification information processing unit<!-- EPO <DP n="25"> --> 14 supplies the splicing point CRA picture and its subsequent pictures in the second encoded video data stream to the data splicing unit 15, and at the same time, issues an instruction to discard the TFD picture immediately following the splicing point CRA picture.</p><p id="p0074" num="0074">On the other hand, for the splicing point CRA picture identified, if the NalUnitType of the slice of that picture is 5, the splicing point identification information processing unit 14 changes the value of the NalUnitType to 7 which indicates that the picture is a BLA picture that is not immediately followed by a TFD picture. Further, the splicing point identification information processing unit 14 supplies the splicing point CRA picture and its subsequent pictures in the second encoded video data stream to the data splicing unit 15. However, in this case, the splicing point identification information processing unit 14 does not issue an instruction to discard the TFD picture immediately following the splicing point CRA picture.</p><p id="p0075" num="0075">The data splicing unit 15 receives the second encoded video data stream from the splicing point identification information processing unit 14, and splices it to the trailing end of the first encoded video data stream that is spliced temporally upstream of the splicing point. At this time, the data splicing unit 15 discards from the second encoded video data stream any TFD picture that immediately follows the starting picture thereof and that is unable to be reproduced correctly. Then, the data splicing unit 15 stores in the storage unit (not depicted) the spliced encoded video data created by splicing together the first and second encoded video data streams.</p><p id="p0076" num="0076"><figref idrefs="f0006">Figure 6</figref> is an operation flowchart illustrating the video encoding process performed by the video encoding apparatus according to the first embodiment. The video encoding apparatus 1 encodes the entire video sequence to be encoded in accordance with the operation flowchart of<!-- EPO <DP n="26"> --> <figref idrefs="f0006">Figure 6</figref>.</p><p id="p0077" num="0077">Before starting the encoding process for the entire sequence, the picture prediction structure such as the GOP structure is determined, for example, by the control unit 11 (step S101). The picture prediction structure determined is signaled to the encoding control unit 12.</p><p id="p0078" num="0078">Then, based on the picture prediction structure, the position of the target picture from the beginning of the video data, etc., the encoding control unit 12 determines the coding mode to be applied to encode the target picture, and generates the header information of the target picture to be encoded (step S102).</p><p id="p0079" num="0079">Next, the encoding control unit 12 determines whether NalUnitType in the slice NUH of the target picture is either 4 or 5 or 8, or none of them (step S103). When NalUnitType is 4, the target picture is a CRA picture which is followed by a TFD picture. When the encoded video data stream containing this target picture as the starting picture is spliced on the downstream side of another encoded video data stream, there arises a need to correct the decoding delay and display delay values of this target picture and its subsequent pictures during the video decoding process. Therefore, the encoding control unit 12 sets RapCpbParamsPresentFlag in the BPSEI appended to this target picture to 1 (step S104). Then, the encoding control unit 12 sets the value of the display delay correction information AltDpbOutputDelay, which is used to correct the display delay, equal to twice the number of pictures to be reordered. Further, the encoding control unit 12 sets the value of the decoding delay correction information AltCpbRemovalDelayOffset, which is used to correct the decoding delay, equal to twice the number of TFD pictures that immediately follow the CRA picture (step S105).</p><p id="p0080" num="0080">On the other hand, when NalUnitType is 5 or 8, the target picture is a BPSEI-appended picture, but this target picture is not followed by a TFD picture.<!-- EPO <DP n="27"> --> Therefore, the encoding control unit 12 sets RapCpbParamsPresentFlag in the BPSEI appended to this target picture to 0 (step S106). When NalUnitType is neither 4 nor 5 nor 8, this target picture is not a BPSEI-appended picture. Accordingly, the encoding control unit 12 does not set RapCpbParamsPresentFlag.</p><p id="p0081" num="0081">After step S105 or S106, or if NalUnitType is neither 4 nor 5 in step S103, the encoding control unit 12 supplies the data of the target picture to the picture encoding unit 13 along with the type of the coding mode and the header information of that picture. Then, the picture encoding unit 13 encodes the target picture in accordance with the coding mode and the header information, and appends the header information to the data of the encoded picture (step S107).</p><p id="p0082" num="0082">After that, the control unit 11 determines whether there is any picture remaining to be encoded in the video sequence (step S108). If there is any picture remaining to be encoded (Yes in step S108), the control unit 11 carries out the process from step S102 onward to encode the next target picture. On the other hand, if there is no longer any picture remaining to be encoded (No in step S108), the control unit 11 terminates the encoding process.</p><p id="p0083" num="0083"><figref idrefs="f0007">Figure 7</figref> is an operation flowchart illustrating the video editing process performed by the video encoding apparatus according to the first embodiment.</p><p id="p0084" num="0084">The splicing point identification information processing unit 14 sequentially reads out from the storage unit (not depicted) the encoded pictures up to the splicing point out of the first encoded video data stream to be spliced upstream of the splicing point (step S201). Further, the splicing point identification information processing unit 14 sequentially reads out from the storage unit (not depicted) the encoded pictures after the splicing point out of the second encoded video data stream to be spliced downstream of the splicing<!-- EPO <DP n="28"> --> point (step S202). Next, for the starting CRA picture read out of the second encoded video data stream, the splicing point identification information processing unit 14 changes the value of NalUnitType in each slice NUH to the value that indicates a BLA picture, and supplies the starting CRA picture to the data splicing unit 15 (step S203). Further, the splicing point identification information processing unit 14 determines whether the original value of NalUnitType is 4 or not, i.e., whether there is any TFD picture or not (step S204). If the original value of NalUnitType is 4 (Yes in step S204), there is a TFD picture that follows the starting CRA picture (which is a BLA picture after splicing). Therefore, the splicing point identification information processing unit 14 sets a TFD discard flag to 1 (step S205). On the other hand, if the original value of NalUnitType is not 4 (No in step S204), there is no TFD picture that follows the starting CRA picture. Therefore, the splicing point identification information processing unit 14 sets the TFD discard flag to 0 (step S206).</p><p id="p0085" num="0085">After step S205 or S206, the splicing point identification information processing unit 14 supplies the starting CRA picture and its subsequent pictures of the second encoded video data stream to the data splicing unit 15. Then, the data splicing unit 15 splices the starting CRA picture, i.e., the BLA picture, on the downstream side of the splicing point of the first encoded video data stream (step S207).</p><p id="p0086" num="0086">After that, the data splicing unit 15 proceeds to the next target picture in the second encoded video data stream that follows the picture spliced to the first encoded video data stream or that follows the discarded picture. Then, the data splicing unit 15 determines whether NalUnitType in each slice NUH of this target picture is 2 or not (i.e., whether the picture is a TFD picture or not) and whether the TFD discard flag is 1 or<!-- EPO <DP n="29"> --> not (step S208).</p><p id="p0087" num="0087">If NalUnitType is 2, and if the TFD discard flag is 1 (Yes in step S208), the data splicing unit 15 discards this target picture (step S209). On the other hand, if NalUnitType is not 2, or if the TFD discard flag is 0 (No in step S208), the data splicing unit 15 adds this target picture at the trailing end of the spliced encoded video data, and sets the TFD discard flag to 0 (step S210).</p><p id="p0088" num="0088">After step S209 or S210, the data splicing unit 15 determines whether there is any further picture subsequent to the target picture (step S211). If there is any further subsequent picture (Yes in step S211), the data splicing unit 15 returns to step S208 to repeat the above process. On the other hand, if there is no further subsequent picture (No in step S211), the data splicing unit 15 terminates the video editing process.</p><p id="p0089" num="0089">Next, a description will be given of the video decoding apparatus for decoding the encoded video data encoded or edited by the video encoding apparatus 1 according to the first embodiment.</p><p id="p0090" num="0090"><figref idrefs="f0008">Figure 8</figref> is a simplified block diagram of the video decoding apparatus according to the first embodiment. The video decoding apparatus 2 includes a control unit 21, a header information analyzing unit 22, a picture decoding/display time determining unit 23, a picture decoding unit 24, and a frame memory 25. These units constituting the video decoding apparatus 2 are each implemented as a separate circuit on the video decoding apparatus 2. Alternatively, these units constituting the video decoding apparatus 2 may be implemented on the video decoding apparatus 2 in the form of a single integrated circuit on which the circuits implementing the functions of the respective units are integrated. Further, these units constituting the video decoding apparatus 2 may be functional modules implemented by executing a computer program on a processor incorporated in the video decoding apparatus 2.<!-- EPO <DP n="30"> --></p><p id="p0091" num="0091">The control unit 21 controls the operation of each designated unit of the video decoding apparatus 2 when decoding the encoded video data.</p><p id="p0092" num="0092">The header information analyzing unit 22 analyzes the header information of the encoded video data, and passes the parameters necessary for the determination of the picture decoding and display times, for example, NalUnitType of each picture, AltDpbOutputDelay and AltCpbRemovalDelayOffset carried in BPSEI, and CpbRemovalDelay and DpbOutputDelay carried in PTSEI, to the picture decoding/display time determining unit 23.</p><p id="p0093" num="0093">The picture decoding/display time determining unit 23 that received the parameters from the header information analyzing unit 22 checks the slice NUH of the target picture to be decoded. When the value of NalUnitType carried in the NUH is 6 or 7, the picture decoding/display time determining unit 23 determines that the picture to be decoded is a BLA picture.</p><p id="p0094" num="0094">When the picture to be decoded is a BLA picture, the picture decoding/display time determining unit 23 uses, as the decoding delay CpbRemovalDelay of the BLA picture, the value calculated in the following manner, not the value of the CpbRemovalDelay carried in the PTSEI appended to the BLA picture.</p><p id="p0095" num="0095">The picture decoding/display time determining unit 23 counts the number of pictures, A, from the picture that immediately follows the most recent BPSEI-appended picture before the BLA picture up to the picture that immediately precedes the BLA picture. Next, the picture decoding/display time determining unit 23 checks the value B of CpbRemovalDelay carried in the PTSEI appended to the picture immediately preceding the BLA picture. Then, the picture decoding/display time determining unit 23 calculates the value of the decoding delay CpbRemovalDelay of the BLA picture as A*{B/{A-1)).</p><p id="p0096" num="0096">When the picture to be decoded is a BLA picture whose NalUnitType is 7 which indicates that the BLA<!-- EPO <DP n="31"> --> picture is immediately followed by a TFD picture, the picture decoding/display time determining unit 23 further checks the flag RapCpbParamsPresentFlag in the BPSEI appended to the BLA picture. When the value of RapCpbParamsPresentFlag is 1, the picture decoding/display time determining unit 23 determines that the TFD picture immediately following the BLA picture has been discarded, and corrects the display delay DpbOutputDelay of that BLA picture and the decoding delay CpbRemovalDelay of every subsequent picture from the picture (non-TFD picture) immediately following the BLA picture to the next BPSEI-appended picture in the following manner.</p><p id="p0097" num="0097">The picture decoding/display time determining unit 23 uses, as the display delay DpbOutputDelay of the BLA picture, the AltDpbOutputDelay carried in the BPSEI appended to the BLA picture, not the DpbOutputDelay carried in the PTSEI appended to the BLA picture. Further, the picture decoding/display time determining unit 23 corrects the decoding delay CpbRemovalDelay of every subsequent picture from the picture immediately following the BLA picture to the next BPSEI-appended picture by subtracting the value of AltCpbRemovalDelayOffset carried in the BPSEI appended to the BLA picture from the value of CpbRemovalDelay carried in the PTSEI appended to the subsequent picture.</p><p id="p0098" num="0098">For any other picture than the above pictures, the picture decoding/display time determining unit 23 determines the decoding delay CpbRemovalDelay and display delay DpbOutputDelay of the picture by directly taking the values of CpbRemovalDelay and DpbOutputDelay carried in the PTSEI appended to that picture.</p><p id="p0099" num="0099">The picture decoding/display time determining unit 23 determines the decoding time of each picture based on the above decoding delay CpbRemovalDelay, and issues a decoding instruction to the picture decoding unit 24 at the determined decoding time. Further, the picture<!-- EPO <DP n="32"> --> decoding/display time determining unit 23 determines the display time of each picture based on the above display delay DpbOutputDelay, and issues a display instruction to the frame memory 25 at the determined display time.</p><p id="p0100" num="0100">Upon receiving the decoding instruction for the target picture, the picture decoding unit 24 decodes the target picture by using a reference picture stored in the frame memory 25. Then, the picture decoding unit 24 stores the decoded picture in the frame memory 25. The picture decoding unit 24 performs the decoding by employing the same coding method as that employed by the picture encoding unit in the video encoding apparatus 1.</p><p id="p0101" num="0101">The frame memory 25 stores the decoded picture. Further, the frame memory 25 outputs the decoded picture to the picture decoding unit 24 to present a reference picture to a picture to be decoded subsequently. The frame memory 25 also outputs the decoded picture to a display unit (not depicted) in accordance with the display instruction received from the picture decoding/display time determining unit 23.</p><p id="p0102" num="0102"><figref idrefs="f0009">Figure 9</figref> is an operation flowchart illustrating the video decoding process performed by the video decoding apparatus according to the first embodiment. The video decoding apparatus 2 decodes the entire video sequence to be decoded in accordance with the operation flowchart of <figref idrefs="f0009">Figure 9</figref>.</p><p id="p0103" num="0103">Before starting the decoding process for the entire sequence, the control unit 21 initializes variables "cnt" and "flag" to 0 (step S301). The variable "cnt" represents the number of pictures from the BPSEI-appended picture to the next BPSEI-appended picture. The variable "flag" is a variable that indicates whether the picture is a non-BLA picture whose CpbRemovalDelay needs correcting.</p><p id="p0104" num="0104">Next, the header information analyzing unit 22 analyzes the header information of the target picture to be decoded, and passes the parameters necessary for<!-- EPO <DP n="33"> --> determining the display time to the picture decoding/display time determining unit 23 (step S302). The picture decoding/display time determining unit 23 determines whether the variable "flag" is 0 or not, or whether the value of NalUnitType in the slice header NUH of the picture to be decoded is either 6 or 7, i.e., whether the picture to be decoded is a BLA picture or not (step S303). If the variable flag is 1, and if the value of NalUnitType in the slice header NUH of the picture to be decoded is neither 6 nor 7 (No in step S303), the picture decoding/display time determining unit 23 corrects the decoding delay CpbRemovalDelay of the picture to be decoded, which is, in this case, a non-BLA picture, by using the decoding delay correction information AltCpbRemovalDelayOffset (step S304).</p><p id="p0105" num="0105">After step S304, or if it is determined in step S303 that the variable "flag" is 0 or NalUnitType is either 6 or 7 (Yes in step S303), the picture decoding/display time determining unit 23 determines whether the picture to be decoded is a BPSEI-appended picture or not (step S305).</p><p id="p0106" num="0106">If the picture to be decoded is a BPSEI-appended picture (Yes in step S305), the picture decoding/display time determining unit 23 copies the value of the variable "cnt" to a variable "d", and resets both variables "cnt" and "flag" to 0 (step S306). If the picture to be decoded is not a BPSEI-appended picture (No in step S305), the picture decoding/display time determining unit 23 increments the value of the variable "cnt" by 1 (step S307).</p><p id="p0107" num="0107">After step S306 or S307, the picture decoding/display time determining unit 23 determines whether the value of NalUnitType in the slice header NUH of the picture to be decoded is either 6 or 7 (step S308). If the value of NalUnitType in the slice header NUH of the picture to be decoded is either 6 or 7 (Yes in step S308), the picture to be decoded is a BLA picture.<!-- EPO <DP n="34"> --> Then, the picture decoding/display time determining unit 23 corrects the decoding delay CpbRemovalDelay of the picture in accordance with the value of the variable "d" (step S309).</p><p id="p0108" num="0108">Next, the picture decoding/display time determining unit 23 determines whether the value of NalUnitType in the slice header NUH of the picture to be decoded is 7 and whether the value of RapCpbParamsPresentFlag in the BPSEI appended to the picture to be decoded is 1 (step S310). If the value of NalUnitType in the slice header NUH of the picture to be decoded is 7, and if the value of RapCpbParamsPresentFlag in the BPSEI appended to the picture to be decoded is 1 (Yes in step S310), the picture decoding/display time determining unit 23 sets the variable "flag" to 1, while correcting the display delay DpbOutputDelay of the BLA picture to the display delay correction information AltDpbOutputDelay (step S311).</p><p id="p0109" num="0109">After step S311, or if it is determined in step S308 that the value of NalUnitType in the slice header NUH of the picture to be decoded is neither 6 nor 7 (No in step S308), or if it is determined in step S310 that the value of NalUnitType in the slice header NUH of the picture to be decoded is not 7 and that the value of RapCpbParamsPresentFlag in the BPSEI appended to the picture to be decoded is 0 (No in step S310), the picture decoding/display time determining unit 23 issues the decoding instruction to the picture decoding unit 24 at the determined decoding time. Further, the picture decoding/display time determining unit 23 issues the display instruction to the frame memory 25 at the determined display time. Then, the picture decoding unit 24 decodes the target picture at the decoding time. On the other hand, the frame memory 25 displays the decoded picture on the display unit (not depicted) (step S312).</p><p id="p0110" num="0110">The control unit 21 determines whether there is any picture remaining to be decoded in the encoded video data<!-- EPO <DP n="35"> --> (step S313). If there is any picture remaining to be decoded (Yes in step S313), the control unit 21 returns the process to step S302. Then, the picture to be decoded next in the decoding order is taken as the target picture, and the process starting from step S302 is repeated. On the other hand, if there is no longer any picture remaining to be decoded (No in step S313), the control unit 21 terminates the video decoding process.</p><p id="p0111" num="0111">As has been described above, even when two or more encoded video data streams are spliced together without decoding them, the video encoding apparatus according to the present embodiment need not correct the decoding delay and display delay parameters determined at the time of encoding. Then, since the decoding delay and display delay of each picture can be corrected using the decoding delay correction and display delay correction parameters added at the time of splicing the encoded video data streams, the video decoding apparatus according to the present embodiment can decode and display each picture at correct timing.</p><p id="p0112" num="0112">Next, a second embodiment will be described. The second embodiment differs from the first embodiment in the structure of the encoded video data.</p><p id="p0113" num="0113">Referring to <figref idrefs="f0010">Figure 10</figref>, the structure of the encoded video data according to the second embodiment will be described. In common with the encoded picture structure according to the first embodiment depicted in <figref idrefs="f0004">Figure 4</figref>, the data structure 1000 of one picture contains six kinds of NAL units 1010 to 1015. Of these, the BPSEI 1013 and PTSEI 1014 are different from the BPSEI 413 and PTSEI 414 depicted in <figref idrefs="f0004">Figure 4</figref>. On the other hand, the DELIM 1010, SPS 1011, PPS 1012, SLICE 1015, and NUH 1020 are identical to the DELIM 410, SPS 411, PPS 412, SLICE 415, and NUH 420, respectively, depicted in <figref idrefs="f0004">Figure 4</figref>.</p><p id="p0114" num="0114">The BPSEI 1013, like the BPSEI 413, contains a number, (N+1), of InitialCpbRemovalDelay and InitialCpbRemovalDelayOffset fields, and the<!-- EPO <DP n="36"> --> RapCpbParamsPresentFlag field that follows them. However, the AltCpbRemovalDelay field and the AltDpbOutputDelay field are not contained in the BPSEI 1013. On the other hand, the PTSEI 1014, like the PTSEI 414, contains the CpbRemovalDelay field and the DpbOutputDelay field. When the value of RapCpbParamsPresentFlag in the BPSEI is 1, the PTSEI 1014 further contains the AltCpbRemovalDelay field and the AltDpbOutputDelay field.</p><p id="p0115" num="0115">If CpbRemovalDelay or DpbOutputDelay in the PTSEI of a certain picture does not change even when TFD pictures are discarded, the value of AltCpbRemovalDelay or AltDpbOutputDelay is set to be the same as the value of CpbRemovalDelay or DpbOutputDelay.</p><p id="p0116" num="0116">As described above, the difference from the first embodiment lies in the type of SEI that carries the AltCpbRemovalDelay and AltDpbOutputDelay fields. Therefore, the video encoding apparatus of the second embodiment differs from the video encoding apparatus of the first embodiment in the operation of the encoding control unit 12. The following therefore describes the operation of the encoding control unit 12.</p><p id="p0117" num="0117">The encoding control unit 12 stores the AltCpbRemovalDelay and AltDpbOutputDelay fields in the PTSEI appended to each picture, not in the BPSEI. In this case, the encoding control unit 12 performs control so that the values of the decoding delay and display delay of each picture when two encoded video data streams are spliced are stored in the AltCpbRemovalDelay and AltDpbOutputDelay fields, respectively.</p><p id="p0118" num="0118">Next, the operation of the video decoding apparatus according to the second embodiment will be described. The configuration of the video decoding apparatus according to the second embodiment is essentially the same as that of the video decoding apparatus according to the first embodiment. However, the video decoding apparatus of the second embodiment differs from that of<!-- EPO <DP n="37"> --> the first embodiment in the operation of the picture decoding/display time determining unit 23. The following therefore describes the operation of the picture decoding/display time determining unit 23.</p><p id="p0119" num="0119">When the picture to be decoded is a BLA picture whose NalUnitType is 7, the picture decoding/display time determining unit 23 further checks RapCpbParamsPresentFlag in the BPSEI. When the value of RapCpbParamsPresentFlag is 1, the picture decoding/display time determining unit 23 determines that the TFD picture immediately following the BLA picture has been discarded. Then, the picture decoding/display time determining unit 23 corrects the DpbOutputDelay of the BLA picture and the CpbRemovalDelay of every picture from the picture (non-TFD picture) immediately following the BLA picture to the next BPSEI-appended picture in the following manner.</p><p id="p0120" num="0120">The picture decoding/display time determining unit 23 uses, as the DpbOutputDelay of the BLA picture, the AltDpbOutputDelay carried in the PTSEI appended to the BLA picture, not the DpbOutputDelay carried in the PTSEI appended to the BLA picture.</p><p id="p0121" num="0121">Further, the picture decoding/display time determining unit 23 uses, as the CpbRemovalDelay of every picture from the picture immediately following the BLA picture to the next BPSEI-appended picture, the AltCpbRemovalDelayOffset contained in the PTSEI appended to the picture, not the CpbRemovalDelay carried in the PTSEI appended to the picture.</p><p id="p0122" num="0122">Next, a third embodiment will be described. The third embodiment differs from the first embodiment in the way the picture decoding/display time determining unit 23 in the video decoding apparatus calculates the decoding delay of the BLA picture. The following therefore describes the picture decoding/display time determining unit 23.</p><p id="p0123" num="0123">The picture decoding/display time determining unit<!-- EPO <DP n="38"> --> 23 checks the slice NUH when analyzing the header information of the target picture passed from the header information analyzing unit 22. When the value of NalUnitType carried in the NUH is 6 or 7, the picture decoding/display time determining unit 23 determines that the target picture to be decoded is a BLA picture.</p><p id="p0124" num="0124">When the picture to be decoded is a BLA picture, the picture decoding/display time determining unit 23 uses, as the CpbRemovalDelay of the BLA picture, the value calculated in the following manner, not the value of the CpbRemovalDelay carried in the PTSEI appended to the BLA picture.</p><p id="p0125" num="0125">Let A denote the number of pictures counted from the picture that immediately follows the most recent BPSEI-appended picture (hereinafter referred to as the Pic1) before the BLA picture (hereinafter referred to as the Pic2) up to the picture that immediately precedes the Pic2. From the value B of CpbRemovalDelay of the Pic2, the picture decoding/display time determining unit 23 derives a first correction value Mod1 as A*(B/(A-1)). B/(A-1) corresponds to the time difference between successive pictures (the unit is tc). B/(A-1) will hereinafter be designated as "s".</p><p id="p0126" num="0126">Next, the picture decoding/display time determining unit 23 calculates a second correction value Mod2 for correcting the disparity in the amount of data held in the CPB at the splicing point. Let Pos2 denote the amount of data held in the CPB just before decoding the Pic2, more specifically, the amount of data held in the CPB when the time [sec] calculated by dividing the value of InitialCpbRemovalDelay (denoted as Init2) carried in the BPSEI appended to the Pic2 by 90000 (i.e., 90 kHz) has elapsed from time 0 at which the first bit of the encoded video data stream with the Pic2 as the starting picture arrived at the receive buffer in the video decoding apparatus; then, Pos2 is calculated as (R*Init2/90000). R denotes the bit rate.<!-- EPO <DP n="39"> --></p><p id="p0127" num="0127">On the other hand, let Init1 denote the value of InitialCpbRemovalDelay carried in the BPSEI appended to the Pic1, and TotalB the total amount of code of all the pictures located between the Pic1 and Pic2, including the Pic1 then, the amount of data, Pos2, held in the CPB just before decoding the Pic2 when the video decoding apparatus decodes the encoded video data from the beginning thereof is calculated as (R*(Initl+(A+1)*s)-TotalB).</p><p id="p0128" num="0128">When Pos1 is smaller than Pos2, all the data of the Pic2 have not arrived at the video decoding apparatus by the time the decoding apparatus just begins to decode the Pic2 in the encoded video data stream, and therefore, the Pic1 may not be able to be decoded. This can be avoided by delaying the decoding time of the Pic2 in units of (s*tc) time [sec].</p><p id="p0129" num="0129">When (Pos2-Posl) &lt; Th, the picture decoding/display time determining unit 23 sets the second correction value Mod2 to 0. The threshold Th has a positive value. The picture decoding/display time determining unit 23 otherwise sets the second correction value Mod2 to (Ceil((Pos2-Posl)/R/(s*tc))). Ceil() is the ceiling function. When the picture to be decoded is a BLA picture, the picture decoding/display time determining unit 23 replaces the CpbRemovalDelay of the BLA picture by (Mod1 + Mod2).</p><p id="p0130" num="0130">In this way, the video decoding apparatus according to the third embodiment determines the decoding delay of the BLA picture by considering the amount of data held in the CPB just before decoding the BLA picture. As a result, the video decoding apparatus according to this embodiment can prevent underflow from occurring in the CPB.</p><p id="p0131" num="0131">Next, a fourth embodiment will be described. In the fourth embodiment, the decoding delay and display delay can be appropriately determined even when the number of pictures to be reordered in the first encoded video data<!-- EPO <DP n="40"> --> stream spliced upstream of the splicing point is different from the number of pictures to be reordered in the second encoded video data stream spliced downstream of the splicing point. Further, in the fourth embodiment, the decoding delay and display delay can be appropriately determined even when any picture to be displayed before the splicing point in the first encoded video data stream has been discarded.</p><p id="p0132" num="0132">Referring to <figref idrefs="f0011 f0012 f0013">Figures 11 to 13</figref>, an explanation will be given of the values of the picture decoding delay CpbRemovalDelay and display delay DpbOutputDelay for different picture encoding structures and different editing points.</p><p id="p0133" num="0133">In <figref idrefs="f0011">Figure 11</figref>, the number of pictures to be reordered in the first encoded video data stream and that in the second encoded video data stream are both 2, as in the case of <figref idrefs="f0003">Figure 3</figref>. Further, the first and second encoded video data streams 1101 and 1102 are the same as the first and second encoded video data streams 301 and 302 depicted in <figref idrefs="f0003">Figure 3</figref>. The block array 1103 indicating the decoding delay and display delay values for the second encoded video data stream 1102 is also the same as the block array 303 depicted in <figref idrefs="f0003">Figure 3</figref>. However, unlike <figref idrefs="f0003">Figure 3</figref>, the picture B13 in the first encoded video data stream 1101 is the splicing point picture.</p><p id="p0134" num="0134">As a result, unlike the spliced encoded video data 304, the picture B15 is not contained in the spliced encoded video data 1104.</p><p id="p0135" num="0135">The block array 1105 indicates the values of the decoding delay CpbRemovalDelay and display delay DpbOutputDelay that the pictures I72, P76, B74, B73, and B75 in the spliced encoded video data 1104 are supposed to have. Each block in the upper row of the block array 1105 carries the value of the decoding delay CpbRemovalDelay for the corresponding picture in the spliced encoded video data 1104 located directly above that block. Likewise, each block in the lower row of the<!-- EPO <DP n="41"> --> block array 1105 carries the value of the display delay DpbOutputDelay for the corresponding picture in the spliced encoded video data 1104 located directly above that block. As can be seen from the block array 1105, even when the picture I72 is spliced so as to follow the picture B13, the decoding delay and display delay values for the pictures I72, P76, B74, B73, and B75 are the same as when the picture I72 is spliced so as to follow the picture B15.</p><p id="p0136" num="0136">Compared with <figref idrefs="f0003">Figure 3</figref>, the number of pictures located between the picture I72 and the most recent BPSEI-appended picture I12 before it is 6, which is smaller by 1 than the number of pictures located between the pictures I72 and I12 in <figref idrefs="f0003">Figure 3</figref>. However, the value of CpbRemovalDelay needs to be set to 16, as in the case of <figref idrefs="f0003">Figure 3</figref>, in order to completely display the decoded pictures at the same intervals and in the same order that the pictures were input.</p><p id="p0137" num="0137">The reason will be described by referring to a block array 1106. The block array 1106 indicates the pictures in the spliced encoded video data in decoding time order and in display time order. As depicted in the block array 1106, the spliced encoded video data does not contain the picture B15, but the picture P16 needs to be displayed two picture times after the picture B14. If the picture I72 and the subsequent pictures are to be display successively after displaying the picture P16, the decoding time of the picture I72 has to be delayed by one picture time. In this case, since the picture B14 is displayed for a duration of two picture times, a display freeze occurs.</p><p id="p0138" num="0138">In the example illustrated in <figref idrefs="f0012">Figure 12</figref>, the number of pictures to be reordered in the second encoded video data stream 1202 is smaller than the number of pictures to be reordered in the first encoded video data stream 1201. In the illustrated example, the number of pictures to be reordered in the first encoded video data stream is<!-- EPO <DP n="42"> --> 2, while the number of pictures to be reordered in the second encoded video data stream is 1. A block array 1203 indicates the decoding delay CpbRemovalDelay and display delay DpbOutputDelay for each picture in the second encoded video data stream before splicing.</p><p id="p0139" num="0139">Suppose that the picture I72 in the second encoded video data stream 1202 is spliced so as to follow the picture B15 in the first encoded video data stream 1201, as depicted in the sliced encode video data 1204. In this case, the decoding delay and display delay values of the picture I72 and its subsequent pictures after splicing are as depicted in a block array 1205. A block array 1206 indicates the pictures in the spliced encoded video data in decoding time order and in display time order.</p><p id="p0140" num="0140">In order to completely display the decoded pictures in succession at the same intervals and in the same order that the pictures were input, the decoding delay of the starting picture in the second encoded video data stream 1202 needs to be increased, as depicted in the block array 1206, in proportion to the difference between the number of pictures to be reordered in the first encoded video data stream 1201 and the number of pictures to be reordered in the second encoded video data stream 1202. In the illustrated example, the decoding delay is increased by 2 to 16.</p><p id="p0141" num="0141">If the picture chosen to be the splicing point picture in the first encoded video data stream is not the picture B15, but the picture B13, B14, or P16, the decoding delay of the starting picture in the second encoded video data stream is the same as when the second encoded video data stream is spliced so as to follow the picture B15. In this case, however, a picture display freeze occurs for a duration equal to the number of discarded pictures among the pictures preceding the picture P16.</p><p id="p0142" num="0142">In the example illustrated in <figref idrefs="f0013">Figure 13</figref>, the number<!-- EPO <DP n="43"> --> of pictures to be reordered in the first encoded video data stream 1301 is smaller than the number of pictures to be reordered in the second encoded video data stream 1302. In the illustrated example, the number of pictures to be reordered in the first encoded video data stream 1301 is 1, while the number of pictures to be reordered in the second encoded video data stream 1302 is 2. A block array 1303 indicates the decoding delay CpbRemovalDelay and display delay DpbOutputDelay for each picture in the second encoded video data stream before splicing.</p><p id="p0143" num="0143">Suppose that the picture I72 in the second encoded video data stream 1302 is spliced so as to follow the picture B15 in the first encoded video data stream 1301, as depicted in the sliced encode video data 1304. In this case, the decoding delay and display delay values of the picture I72 and its subsequent pictures after splicing are as depicted in a block array 1305. A block array 1306 indicates the pictures in the spliced encoded video data in decoding time order and in display time order.</p><p id="p0144" num="0144">In order to completely display the decoded pictures at the same intervals and in the same order that the pictures were input, the last display picture in the first encoded video data stream needs to be repeated.</p><p id="p0145" num="0145">As illustrated in <figref idrefs="f0012">Figures 12</figref> and <figref idrefs="f0013">13</figref>, depending on the relationship between the number of pictures to be reordered in the first encoded video data stream and the number of pictures to be reordered in the second encoded video data stream, there may arise a need to delay the decoding time of the starting picture in the second encoded video data stream, or there may occur a display picture freeze across the splicing point. Further, as illustrated in <figref idrefs="f0011">Figure 11</figref>, depending on the position of the splicing point in the first encoded video data stream, a display picture freeze may become unavoidable.</p><p id="p0146" num="0146">Next, a video decoding apparatus according to a<!-- EPO <DP n="44"> --> fourth embodiment that addresses the above problem will be described. The video decoding apparatus of the fourth embodiment differs from the video decoding apparatus of the first embodiment in the operation of the picture decoding/display time determining unit 23. The following therefore describes the picture decoding/display time determining unit 23.</p><p id="p0147" num="0147">The picture decoding/display time determining unit 23 checks the slice NUH when analyzing the header information of the target picture passed from the header information analyzing unit 22. When the value of NalUnitType carried in the NUH is 6 or 7, the picture decoding/display time determining unit 23 determines that the picture to be decoded is a BLA picture.</p><p id="p0148" num="0148">When the picture to be decoded is a BLA picture, the picture decoding/display time determining unit 23 uses, as the CpbRemovalDelay of the BLA picture, the value calculated in the following manner, not the value of the CpbRemovalDelay carried in the PTSEI appended to the BLA picture.</p><p id="p0149" num="0149">The picture decoding/display time determining unit 23 counts the number of pictures, A, from the picture that immediately follows the most recent BPSEI-appended picture (hereinafter referred to as the Pic1) before the BLA picture (hereinafter referred to as the Pic2) up to the picture that immediately precedes the Pic2. The picture decoding/display time determining unit 23 checks the value B of CpbRemovalDelay carried in the PTSEI appended to the picture immediately preceding the Pic2, and calculates a first correction value Mod1 of PTSEI as A*(B/(A-1)).</p><p id="p0150" num="0150">Next, the picture decoding/display time determining unit 23 compares the number of pictures to be reordered, R1, which is defined in the SPS that the picture immediately preceding the Pic2 refers to, with the number of pictures to be reordered, R2, that a non-TFD picture immediately following the Pic2 refers to. The field that<!-- EPO <DP n="45"> --> indicates the number of pictures to be reordered in the SPS is SpsNumReorderPics according to the method disclosed in the non-patent document <nplcit id="ncit0003" npl-type="s"><text>JCTVC-I1003, "High-Efficiency Video Coding (HEVC) text specification Working Draft 7," Joint Collaborative Team on Video Coding of ITU-T SG16 WP3 and ISO/IEC JTC1/SC29/WG11, May 2012</text></nplcit>.</p><p id="p0151" num="0151">When R1 is equal to R2, the picture decoding/display time determining unit 23 uses Mod1 directly as the CpbRemovalDelay of the Pic2. When R2 is larger than R1, the picture decoding/display time determining unit 23 calculates a second correction value Mod2 of PTSEI as (R2-R1)*B/(A-1). When R2 is smaller than R1, the picture decoding/display time determining unit 23 uses Mod1 directly as the CpbRemovalDelay of the Pic2.</p><p id="p0152" num="0152">Further, the picture decoding/display time determining unit 23 determines, based on the relationship between R1 and R2, whether the last picture in the first encoded video data stream is to be freeze-displayed or not, and signals the determined freeze period to the frame memory 25.</p><p id="p0153" num="0153">The picture decoding/display time determining unit 23 determines the freeze period (in units of tc) in the following manner. When R1 is equal to R2, or when R1 is larger than R2, the picture decoding/display time determining unit 23 sets the freeze period to 0. On the other hand, when R1 is smaller than R2, the picture decoding/display time determining unit 23 sets the freeze period to (R2-R1)*B/(A-1).</p><p id="p0154" num="0154">As described above, according to the fourth embodiment, even when the first encoded video data stream spliced upstream of the splicing point contains any picture that is later than the splicing point picture in the encoding (decoding) order and that is to be reproduced earlier than the splicing point picture, the video decoding apparatus can appropriately determine the decoding delay and display delay of each picture located after the splicing point. Furthermore, even when the<!-- EPO <DP n="46"> --> number of pictures to be reordered differs before and after the splicing point, the video decoding apparatus can appropriately determine the decoding delay and display delay of each picture located after the splicing point.</p><p id="p0155" num="0155">Next, a fifth embodiment will be described. In the fifth embodiment, the video encoding apparatus adds a parameter for identifying a picture that does not cause a display picture freeze when two encoded video data streams are spliced together.</p><p id="p0156" num="0156">To prevent a display picture freeze from occurring across the splicing point, the number of pictures to be reordered in the first encoded video data stream has to be made equal to or larger than the number of pictures to be reordered in the second encoded video data stream, and the splicing point of the first encoded video data stream has to be located immediately before a picture that refers only to a temporally preceding picture. In the example of <figref idrefs="f0011">Figure 11</figref>, the splicing point that satisfies this condition is the picture B11 or B15.</p><p id="p0157" num="0157"><figref idrefs="f0014">Figure 14</figref> illustrates the data structure of one picture contained in encoded video according to the fifth embodiment. The data structure 1400 of one picture contained in encoded video illustrated in <figref idrefs="f0014">Figure 14</figref> differs from the data structure 400 illustrated in <figref idrefs="f0004">Figure 4</figref> by the inclusion of an editing point SEI (EPSEI) NAL unit 1416. The other six NAL units 1410 to 1415 are identical to the corresponding NAL units 410 to 415 of the data structure 400 illustrated in <figref idrefs="f0004">Figure 4</figref>.</p><p id="p0158" num="0158">The EPSEI NAL unit 1416 is SEI data that indicates a splicing point picture that does not cause a display picture freeze across the splicing point. In the present embodiment, the EPSEI does not include any specific field.</p><p id="p0159" num="0159">The operation of the video encoding apparatus according to the fifth embodiment will be described below. The video encoding apparatus of the fifth<!-- EPO <DP n="47"> --> embodiment differs from the video encoding apparatus of the first embodiment in that the encoding control unit 12 and the picture encoding unit 13 append the EPSEI to specific pictures at the time of encoding, and in that the data splicing unit 15 determines the splicing point by referring to the EPSEI at the time of editing. The following therefore describes the operation of the encoding control unit 12 and the picture encoding unit 13 for appending the EPSEI and the operation of the data splicing unit 15 during editing.</p><p id="p0160" num="0160">At the time of encoding, the encoding control unit 12 instructs the picture encoding unit 13 to append the EPSEI to the picture to be encoded, if the picture is either a picture immediately preceding an I picture or a picture immediately preceding a B picture or P picture that refers only to a picture earlier in display time order. Alternatively, the encoding control unit 12 may instruct the picture encoding unit 13 to append the EPSEI to the picture to be encoded, if the picture is either an I picture or a B picture or P picture that refers only to a picture earlier in display time order.</p><p id="p0161" num="0161">When an instruction for appending the EPSEI is received from the encoding control unit 12, the picture encoding unit 13 encodes the picture and appends the EPSEI to it.</p><p id="p0162" num="0162">At the time of editing, the data splicing unit 15 identifies the splicing point picture in the first encoded video data stream in accordance with a control signal from the control unit 11. The control signal includes, for example, the number of encoded pictures counted from the beginning of the first encoded video data stream. The data splicing unit 15 determines the splicing point picture in the first encoded video data stream by selecting the EPSEI-appended picture earliest in encoding order among the applicable picture and the pictures following the applicable picture. Alternatively, the data splicing unit 15 determines the<!-- EPO <DP n="48"> --> splicing point picture in the first encoded video data stream by selecting the picture immediately preceding the EPSEI-appended picture earliest in encoding order among the applicable picture and the pictures following the applicable picture. Then, the data splicing unit 15 reads out from the storage unit (not depicted) the splicing point picture and all its preceding pictures in the first encoded video data stream. Next, the data splicing unit 15 reads out from the storage unit (not depicted) a portion of the second encoded video data stream supplied from the splicing point identification information processing unit 14, the portion having a splicing point CRA picture as the starting picture. At this time, if an instruction to discard any TFD picture immediately following the splicing point CRA picture is issued from the splicing point identification information processing unit 14, the data splicing unit 15 discard any such TFD picture. The data splicing unit 15 then outputs the readout first encoded video data stream, and thereafter outputs the second encoded video data stream.</p><p id="p0163" num="0163">As described above, according to the video encoding apparatus of the fifth embodiment, information indicating the picture that does not cause a display freeze when two encoded video data streams are spliced is appended to the encoded video data. As a result, the video encoding apparatus can splice together the two encoded video so as not to cause a display freeze.</p><p id="p0164" num="0164">Next, a sixth embodiment will be described.</p><p id="p0165" num="0165">In the video encoding apparatus of the sixth embodiment, the value to be used to obtain the second correction value Mod2 for correcting the disparity in the amount of data held in the CPB at the splicing point, as described in the third embodiment, is appended in advance to the first encoded video data stream.</p><p id="p0166" num="0166"><figref idrefs="f0015">Figure 15</figref> illustrates the data structure of one picture contained in encoded video according to the sixth embodiment. The data structure 1500 illustrated in<!-- EPO <DP n="49"> --> <figref idrefs="f0015">Figure 15</figref> differs from the data structure 1400 illustrated in <figref idrefs="f0014">Figure 14</figref> in that the EPSEI NAL unit 1516 includes a BufferOccupancy field. The other six NAL units 1510 to 1515 are identical to the corresponding NAL units 1410 to 1415 of the data structure 400 illustrated in <figref idrefs="f0014">Figure 14</figref>. The BufferOccupancy field indicates the amount of data held in the CPB just before the splicing point.</p><p id="p0167" num="0167">The operation of the video encoding apparatus according to the sixth embodiment will be described. The video encoding apparatus of the sixth embodiment differs from the video encoding apparatus of the fifth embodiment in a portion of the operation of the encoding control unit 12. The following therefore describes the portion of the operation of the encoding control unit 12 that differs.</p><p id="p0168" num="0168">The encoding control unit 12 instructs the picture encoding unit 13 to append the EPSEI to the picture to be encoded, if the picture is either a picture immediately preceding an I picture or a picture immediately preceding a B picture or P picture that refers only to a picture earlier in display time order. The value (R*(Init1+(A+1)*s)-TotalB) described in the third embodiment is stored in the BufferOccupancy field in the EPSEI. Alternatively, the value (R*(Init1+(A+1)*s)-TotalB) divided by the bit rate R may be stored in the BufferOccupancy field.</p><p id="p0169" num="0169">The operation of the video decoding apparatus according to the sixth embodiment will be described. The video decoding apparatus of the sixth embodiment differs from the video decoding apparatus of the third embodiment in a portion of the operation of the picture decoding/display time determining unit 23. The following therefore describes the portion of the operation of the picture decoding/display time determining unit 23 that differs.</p><p id="p0170" num="0170">The picture decoding/display time determining unit<!-- EPO <DP n="50"> --> 23 checks the slice NUH when analyzing the header information of the target picture passed from the header information analyzing unit 22. When the value of NalUnitType carried in the NUH is 6 or 7, the picture decoding/display time determining unit 23 determines that the picture to be decoded is a BLA picture.</p><p id="p0171" num="0171">When the picture to be decoded is a BLA picture, the picture decoding/display time determining unit 23 uses, as the decoding delay CpbRemovalDelay of the BLA picture, the value calculated in the following manner, not the value of the CpbRemovalDelay carried in the PTSEI appended to the BLA picture.</p><p id="p0172" num="0172">Let A denote the number of pictures counted from the picture that immediately follows the most recent BPSEI-appended picture (hereinafter referred to as the Pic1) before the BLA picture (hereinafter referred to as the Pic2) up to the picture that immediately precedes the Pic2. From the value B of CpbRemovalDelay of the Pic2, the picture decoding/display time determining unit 23 derives the first correction value Mod1 as A*(B/(A-1)). B/(A-1) corresponds to the time difference between successive pictures (the unit is tc). B/(A-1) will hereinafter be designated as "s".</p><p id="p0173" num="0173">The picture decoding/display time determining unit 23 calculates the second correction value Mod2 in accordance with the method of the third embodiment by using, as the value (R*(Init1+(A+1)*s)-TotalB) described in the third embodiment, the value stored in the BufferOccupancy field in the EPSEI appended to the picture immediately preceding the BLA picture (or the value multiplied by R if the value divided by the bit rate R is stored).</p><p id="p0174" num="0174">Next, the picture decoding/display time determining unit 23 compares the number of pictures to be reordered, R1, which is defined in the SPS that the picture immediately preceding the Pic2 refers to, with the number of pictures to be reordered, R2, that a non-TFD picture<!-- EPO <DP n="51"> --> immediately following the Pic2 refers to. The field that indicates the number of pictures to be reordered in the SPS is SpsNumReorderPics according to the method disclosed in the previously cited non-patent document.</p><p id="p0175" num="0175">When R2 is larger than R1, the picture decoding/display time determining unit 23 calculates a third correction value Mod3 of PTSEI as (R2-R1)*B/(A-1). Otherwise, the picture decoding/display time determining unit 23 sets the third correction value Mod3 of PTSEI to 0. Then, the picture decoding/display time determining unit 23 corrects the CpbRemovalDelay of the Pic2 to (Mod1 + Mod2 + Mod3).</p><p id="p0176" num="0176">Next, a seventh embodiment will be described. In the seventh embodiment, the video encoding apparatus corrects the CpbRemovalDelay of the BLA picture when splicing two encoded video data streams. At this time, the video encoding apparatus adds a parameter that indicates whether the spliced encoded video data can be continuously decoded and displayed across the BLA picture.</p><p id="p0177" num="0177">The method of correcting the CpbRemovalDelay of the BLA picture is essentially the same as the method that the picture decoding/display time determining unit 23 in the sixth embodiment uses to correct the CpbRemovalDelay.</p><p id="p0178" num="0178"><figref idrefs="f0016">Figure 16</figref> illustrates the data structure of one picture contained in encoded video according to the seventh embodiment. The data structure 1600 of one picture contained in encoded video illustrated in <figref idrefs="f0016">Figure 16</figref> differs from the data structure 1400 illustrated in <figref idrefs="f0014">Figure 14</figref> in that the BPSEI NAL unit 1613 includes a ContinuousHrdFlag field. The other six NAL units 1610 to 1612 and 1614 to 1617 are identical to the corresponding NAL units 1410 to 1412 and 1414 to 1417 of the data structure 1400 illustrated in <figref idrefs="f0014">Figure 14</figref>.</p><p id="p0179" num="0179">The ContinuousHrdFlag field indicates whether the video decoding apparatus can continuously decode and display the encoded video data across the BLA picture to<!-- EPO <DP n="52"> --> which the BPSEI has been attached.</p><p id="p0180" num="0180">The ContinuousHrdFlag field may be contained, not in the BPSEI, but in the SPS 1611 or some other NAL unit.</p><p id="p0181" num="0181">The operation of the video encoding apparatus according to the seventh embodiment will be described. The video encoding apparatus of the seventh embodiment differs from the video encoding apparatus of the fifth embodiment in a portion of the operation of the data splicing unit 15. The following therefore describes the portion of the operation of the data splicing unit 15 that differs.</p><p id="p0182" num="0182">The data splicing unit 15 receives the second encoded video data stream from the splicing point identification information processing unit 14, and splices it to the trailing end of the first encoded video data stream that is spliced temporally upstream of the splicing point. At this time, the data splicing unit 15 compares at least one of picture parameters that indicate the characteristics of the pictures contained in the first and second encoded video data streams. For example, if, of the picture parameters of the first and second encoded video data streams, the picture size or the picture rate differs between the two encoded video data streams, the data splicing unit 15 sets the value of the parameter ContFlag, which indicates whether the spliced encoded video data can be continuously decoded and displayed across the splicing point, to 0 which indicates that the video data is unable to be continuously decoded and displayed. On the other hand, if the picture size and the picture rate are the same between the first and second encoded video data streams, the data splicing unit 15 calculates the CpbRemovalDelay of the BLA picture in the same way that the picture decoding/display time determining unit 23 in the sixth embodiment corrects the CpbRemovalDelay. The data splicing unit 15 calculates the value corresponding to the BufferOccupancy field in the EPSEI, i.e., the value<!-- EPO <DP n="53"> --> used to calculate the second correction value Mod2, in accordance with the method of calculation that the encoding control unit 12 in the sixth embodiment uses to calculate the value of the BufferOccupancy field. Further, the data splicing unit 15 sets the ContFlag parameter to 1 which indicates that the spliced encoded video data can be continuously decoded and displayed.</p><p id="p0183" num="0183">Besides the picture size and picture rate, the color difference component format of the picture or the pixel resolution of the picture may be added as a picture parameter for determining whether the spliced encoded video data can be continuously decoded and displayed across the splicing point. In this case, if all of these parameters are the same between the first and second encoded video data streams, it is determined that the spliced encoded video data can be continuously decoded and displayed across the splicing point.</p><p id="p0184" num="0184">When the value of the ContFlag parameter is 0, the data splicing unit 15 sets the value of the ContinuousHrdFlag field in the BPSEI appended to the BLA picture to 0 which indicates that the spliced encoded video data is unable to be continuously decoded and displayed. On the other hand, when the value of the ContFlag parameter is 1, the data splicing unit 15 sets the value of the ContinuousHrdFlag field in the BPSEI appended to the BLA picture to 1 which indicates that the spliced encoded video data can be continuously decoded and displayed. Further, the data splicing unit 15 corrects the value of the decoding delay CpbRemovalDelay of the starting picture, i.e., the BLA picture, of the second encoded video data stream to the value calculated as described above.</p><p id="p0185" num="0185">The operation of the video decoding apparatus according to the seventh embodiment will be described. The video decoding apparatus of the seventh embodiment differs from the video decoding apparatus of the first embodiment in a portion of the operation of the picture<!-- EPO <DP n="54"> --> decoding/display time determining unit 23. The following therefore describes the portion of the operation of the picture decoding/display time determining unit 23 that differs.</p><p id="p0186" num="0186">When the picture to be decoded is a BLA picture, the picture decoding/display time determining unit 23 refers to the value of the ContinuousHrdFlag field in the BPSEI appended to the BLA picture.</p><p id="p0187" num="0187">When the value of the ContinuousHrdFlag field is 1, i.e., when the spliced encoded video data can be continuously decoded and displayed across the splicing point, the picture decoding/display time determining unit 23 uses the CpbRemovalDelay of the PTSEI appended to the BLA picture, directly as the decoding delay CpbRemovalDelay of the BLA picture. On the other hand, when the value of the ContinuousHrdFlag field is 0, i.e., when the spliced encoded video data is unable to be continuously decoded and displayed across the splicing point, the picture decoding/display time determining unit 23 determines the decoding time of the BLA picture, not from the CpbRemovalDelay, but by using the value of the initial decoding delay information InitialCpbRemovalDelay included in the BPSEI. In this case, the picture decoding/display time determining unit 23 calculates the decoding time of the BLA picture from the InitialCpbRemovalDelay by reference to time 0 which is set later than the decoding time of the picture immediately preceding the BLA picture. Alternatively, the picture decoding/display time determining unit 23 may set the time 0 later than the time at which the display of all the encoded pictures preceding the BLA picture is completed.</p><p id="p0188" num="0188"><figref idrefs="f0017">Figure 17</figref> is a diagram illustrating the configuration of a computer that operates as the video encoding apparatus or video decoding apparatus by executing a computer program for implementing the functions of the various units in the video encoding<!-- EPO <DP n="55"> --> apparatus or video decoding apparatus according to any one of the above embodiments or their modified examples.</p><p id="p0189" num="0189">The computer 100 includes a user interface unit 101, a communication interface unit 102, a storage unit 103, a storage media access device 104, and a processor 105. The processor 105 is connected to the user interface unit 101, communication interface unit 102, storage unit 103, and storage media access device 104, for example, via a bus.</p><p id="p0190" num="0190">The user interface unit 101 includes, for example, an input device such as a keyboard and a mouse, and a display device such as a liquid crystal display. Alternatively, the user interface unit 101 may include a device, such as a touch panel display, into which an input device and a display device are integrated. The user interface unit 101 generates, for example, in response to a user operation, an operation signal for selecting video data to be encoded, encoded video data to be edited, or encoded video data to be decoded, and supplies the operation signal to the processor 105. The interface unit 101 may also display the decoded video data received from the processor 105.</p><p id="p0191" num="0191">The communication interface unit 102 may include a communication interface for connecting the computer 100 to a video data generating apparatus, for example, a video camera, and a control circuit for the communication interface. Such a communication interface may be, for example, a Universal Serial Bus (USB) interface.</p><p id="p0192" num="0192">Further, the communication interface unit 102 may include a communication interface for connecting to a communication network conforming to a communication standard such as the Ethernet (registered trademark), and a control circuit for the communication interface.</p><p id="p0193" num="0193">In the latter case, the communication interface 102 receives video data to be encoded, encoded video data to be edited, or encoded video data to be decoded, from another apparatus connected to the communication network,<!-- EPO <DP n="56"> --> and passes the received data to the processor 105. Further, the communication interface 102 may receive encoded video data, spliced encoded video data, or decoded video data from the processor 105 and may transmit the data to another apparatus over the communication network.</p><p id="p0194" num="0194">The storage unit 103 includes, for example, a readable/writable semiconductor memory and a read-only semiconductor memory. The storage unit 103 stores a computer program for video encoding, video editing, or video decoding to be executed on the processor 105, and also stores the data generated as a result of or during the execution of the program.</p><p id="p0195" num="0195">The storage media access device 104 is a device that accesses a storage medium 106 such as a magnetic disk, a semiconductor memory card, or an optical storage medium. The storage media access device 104 accesses the storage medium 106 to read out, for example, the computer program for video encoding, video editing, or video decoding to be executed on the processor 105, and passes the readout computer program to the processor 105.</p><p id="p0196" num="0196">The processor 105 generates encoded video data by executing the video encoding computer program according to any one of the above embodiments or their modified examples. The processor 105 then stores the encoded video data generated in the storage unit 103, or transmits the generated data to another apparatus via the communication interface unit 102. Further, the processor 105 generates spliced encoded video data by splicing together two encoded video data streams by executing the video editing computer program according to any one of the above embodiments or their modified examples. The processor 105 then stores the spliced encoded video data generated in the storage unit 103, or transmits the generated data to another apparatus via the communication interface unit 102. Furthermore, the processor 105 decodes the encoded video data by executing the video<!-- EPO <DP n="57"> --> decoding computer program according to any one of the above embodiments or their modified examples. The processor 105 then stores the decoded video data in the storage unit 103, presents the data to the user interface unit 101 for display, or transmits the data to another apparatus via the communication interface unit 102.</p><p id="p0197" num="0197">A computer program which is executed on a computer to implement the functions of the various units constituting the video encoding apparatus or video decoding apparatus according to each of the above embodiments or their modified examples may be distributed in the form stored in a semiconductor memory or in the form recorded on a recording medium such as an optical recording medium. The term "recording medium" used here does not a carrier wave.</p><p id="p0198" num="0198">Of the various units constituting the video encoding apparatus according to each of the above embodiments or their modified examples, the apparatus incorporating the splicing point identification information processing unit 14 and the data splicing unit 15 that are relevant to the video editing may be provided separately from the apparatus incorporating the encoding control unit 12 and the picture encoding unit 13 that are relevant to the video encoding.</p><p id="p0199" num="0199">The video encoding apparatus and video decoding apparatus according to the above embodiments or their modified examples are used in various applications. For example, the video encoding apparatus and video decoding apparatus are incorporated in a video camera, a video transmitting apparatus, a video receiving apparatus, a video telephone system, a computer, or a mobile telephone.</p></description><claims mxw-id="PCLM56982264" lang="EN" load-source="patent-office"><!-- EPO <DP n="58"> --><claim id="c-en-0001" num="0001"><claim-text>A video encoding apparatus for encoding video data by inter-frame predictive coding, comprising:
<claim-text>an encoding control unit which obtains decoding delay correction information and display delay correction information for ensuring that even when one or more pictures that are later in encoding order in the video data than a first picture that may potentially be spliced to a trailing end of other encoded video data have been discarded, the first picture and subsequent pictures in the encoded video data can be continuously decoded and displayed by a video decoding apparatus; and</claim-text>
<claim-text>a picture encoding unit which encodes each picture contained in the video data and appends the decoding delay correction information and the display delay correction information to the video data encoded.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The video encoding apparatus according to claim 1, wherein the decoding delay correction information carries a value corresponding to the number of pictures that can be discarded.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The video encoding apparatus according to claim 1, wherein the display delay correction information carries a value corresponding to the number of pictures occurring between a display time of a picture that is earliest in display order among the pictures that are later in encoding order than the first picture and a display time of the first picture.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The video encoding apparatus according to claim 1, further comprising:
<claim-text>a splicing point identification information processing unit which, when splicing the encoded video data to the other encoded video data, appends information identifying a starting encoded picture to the starting encoded picture in the encoded video data; and</claim-text>
<claim-text>a data splicing unit which discards from the encoded video data one or more pictures that are later in<!-- EPO <DP n="59"> --> encoding order than the starting encoded picture and that refer to a picture earlier in encoding order than the starting encoded picture.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The video encoding apparatus according to claim 1, further comprising a data splicing unit which, when generating spliced encoded video data by splicing the encoding video data to the other encoded video data, refers to a picture parameter indicating picture characteristics of the encoding video data and the other encoded video data and thereby determines whether the spliced encoded video data can be continuously decoded and displayed across a splicing point at which the encoding video data and the other encoded video data are sliced, and embeds, in the spliced encoded video data, information indicating whether the spliced encoded video data can be continuously decoded and displayed, wherein when the spliced encoded video data can be continuously decoded and displayed, the data splicing unit replaces a decoding delay value for a starting encoded picture in the encoded video data by a value that enables the continuous decoding and display.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The video encoding apparatus according to claim 1, wherein the first picture is a picture that is encoded without referring to any other picture.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The video encoding apparatus according to claim 1, wherein the picture encoding unit appends, to the encoded video data, additional information that indicates a state of an idealized receive buffer in the video decoding apparatus immediately before or after the encoded video data is decoded up to a splicing point picture, and wherein the splicing point picture is a picture such that, even when another encoded video data is appended immediately after the splicing point picture, the splicing point picture and any picture earlier in encoding order than the splicing point picture can be decoded.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A video decoding apparatus for decoding video data<!-- EPO <DP n="60"> --> encoded by inter-frame predictive coding, comprising:
<claim-text>a picture decoding/display time determining unit which, when the encoded video data contains information indicating that the encoded video data has been generated by splicing second encoded video data to a trailing end of first encoded video data, information indicating that one or more encoded pictures that are later in encoding order than a starting encoded picture in the second encoded video data after a splicing point at which the first encoded video data and the second encoded video data are spliced have been discarded, decoding delay correction information for correcting a decoding delay of a picture that follows the starting encoded picture, and display delay correction information for correcting a display delay of the starting encoded picture, then corrects the display delay of the starting encoded picture based on the display delay correction information, while correcting, based on the decoding delay correction information, the decoding delay of the picture that follows the starting encoded picture.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The video decoding apparatus according to claim 8, wherein the decoding delay correction information carries a value corresponding to the number of discarded encoded pictures that are later in encoding order than the starting encoded picture.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The video decoding apparatus according to claim 8, wherein the display delay correction information carries a value corresponding to the number of pictures occurring between a display time of a picture that is earliest in display order among the pictures that are later in encoding order than the starting encoded picture and a display time of the starting encoded picture.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The video decoding apparatus according to claim 8, wherein the picture decoding/display time determining unit determines the decoding delay of the starting encoded picture in such a manner as to offset any disparity between the amount of data held in a receive<!-- EPO <DP n="61"> --> buffer at the time of decoding of the starting encoded picture, as calculated from encoded pictures preceding the splicing point, and the amount of data actually held in the receive buffer.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The video decoding apparatus according to claim 8, wherein when the encoded video data contains information indicating whether the encoded video data can be continuously decoded and displayed across the splicing point, if the information indicates that the encoded video data can be continuously decoded and displayed, the picture decoding/display time determining unit takes as a decoding delay value for the starting encoded picture the value of decoding delay information contained in the encoded video data, while, if the information indicates that the encoded video data is unable to be continuously decoded and displayed, the picture decoding/display time determining unit takes as the decoding delay value for the starting encoded picture the value of initial decoding delay information contained in the encoded video data.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>A video encoding method for encoding video data by inter-frame predictive coding, comprising:
<claim-text>obtaining decoding delay correction information and display delay correction information for ensuring that even when one or more pictures that are later in encoding order in the video data than a first picture that may potentially be spliced to a trailing end of other encoded video data have been discarded by at least one processor, the first picture and subsequent pictures in the encoded video data can be continuously decoded and displayed by a video decoding apparatus; and</claim-text>
<claim-text>encoding each picture contained in the video data and appending the decoding delay correction information and the display delay correction information to the video data encoded by the at least one processor.</claim-text></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A video decoding method for decoding video data encoded by inter-frame predictive coding, comprising:<!-- EPO <DP n="62"> -->
<claim-text>when the encoded video data contains information indicating that the encoded video data has been generated by splicing second encoded video data to a trailing end of first encoded video data, information indicating that one or more encoded pictures that are later in encoding order than a starting encoded picture in the second encoded video data after a splicing point at which the first encoded video data and the second encoded video data are spliced have been discarded, decoding delay correction information for correcting a decoding delay of a picture that follows the starting encoded picture, and display delay correction information for correcting a display delay of the starting encoded picture, then correcting the display delay of the starting encoded picture based on the display delay correction information by at least one processor, while correcting, based on the decoding delay correction information, the decoding delay of the picture that follows the starting encoded picture by the at least one processor.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16670649" load-source="patent-office"><!-- EPO <DP n="63"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="164" he="231" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="64"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="164" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="65"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="164" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="66"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="164" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="67"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="164" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="68"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="165" he="207" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="69"> --><figure id="f0007" num="7"><img id="if0007" file="imgf0007.tif" wi="165" he="215" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="70"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="165" he="215" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="71"> --><figure id="f0009" num="9"><img id="if0009" file="imgf0009.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="72"> --><figure id="f0010" num="10"><img id="if0010" file="imgf0010.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="73"> --><figure id="f0011" num="11"><img id="if0011" file="imgf0011.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="74"> --><figure id="f0012" num="12"><img id="if0012" file="imgf0012.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="75"> --><figure id="f0013" num="13"><img id="if0013" file="imgf0013.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="76"> --><figure id="f0014" num="14"><img id="if0014" file="imgf0014.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="77"> --><figure id="f0015" num="15"><img id="if0015" file="imgf0015.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="78"> --><figure id="f0016" num="16"><img id="if0016" file="imgf0016.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="79"> --><figure id="f0017" num="17"><img id="if0017" file="imgf0017.tif" wi="165" he="220" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
