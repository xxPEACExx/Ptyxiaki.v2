<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2682896-A2" country="EP" doc-number="2682896" kind="A2" date="20140108" family-id="48747362" file-reference-id="318320" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146584856" ucid="EP-2682896-A2"><document-id><country>EP</country><doc-number>2682896</doc-number><kind>A2</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13173920-A" is-representative="YES"><document-id mxw-id="PAPP154847048" load-source="docdb" format="epo"><country>EP</country><doc-number>13173920</doc-number><kind>A</kind><date>20130627</date><lang>EN</lang></document-id><document-id mxw-id="PAPP175868162" load-source="docdb" format="original"><country>EP</country><doc-number>13173920.3</doc-number><date>20130627</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140556897" ucid="JP-2012149862-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2012149862</doc-number><kind>A</kind><date>20120703</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2102487889" load-source="docdb">G06K   9/00        20060101AFI20150119BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1991316279" load-source="docdb" scheme="CPC">H04N   7/18        20130101 FI20140102BHEP        </classification-cpc><classification-cpc mxw-id="PCL2097035799" load-source="docdb" scheme="CPC">G06K   9/48        20130101 LI20140717BHEP        </classification-cpc><classification-cpc mxw-id="PCL2097036729" load-source="docdb" scheme="CPC">G06K   9/00798     20130101 LI20140717BHEP        </classification-cpc><classification-cpc mxw-id="PCL2109738965" load-source="docdb" scheme="CPC">H04N   5/2171      20130101 LI20140905BHEP        </classification-cpc><classification-cpc mxw-id="PCL2109743888" load-source="docdb" scheme="CPC">H04N   5/2254      20130101 LI20140905BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132359201" lang="DE" load-source="patent-office">Fahrzeuginnenraumvorrichtung</invention-title><invention-title mxw-id="PT132359202" lang="EN" load-source="patent-office">In-vehicle apparatus</invention-title><invention-title mxw-id="PT132359203" lang="FR" load-source="patent-office">Appareil embarqué</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919523639" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>CLARION CO LTD</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR919520634" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>CLARION CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR919017384" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Clarion Co., Ltd.</last-name><iid>101216579</iid><address><street>7-2, Shintoshin Chuo-ku Saitama-shi</street><city>Saitama 330-0081</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919535674" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>KIYOHARA MASAHIRO</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919504664" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>KIYOHARA, MASAHIRO</last-name></addressbook></inventor><inventor mxw-id="PPAR919012524" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>KIYOHARA, MASAHIRO</last-name><address><street>c/o Hitachi, Ltd., Intellectual Property Group 6-1, Marunouchi 1-chome, Chiyoda-ku</street><city>Tokyo, 100-8220</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919508754" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>IRIE KOTA</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919509573" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>IRIE, KOTA</last-name></addressbook></inventor><inventor mxw-id="PPAR919013883" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>IRIE, KOTA</last-name><address><street>c/o Clarion Co., Ltd. 7-2, Shintoshin, Chuo-ku, Saitama-shi,</street><city>Saitama, 330-0081</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919535963" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>TAKEMURA MASAYUKI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919531129" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>TAKEMURA, MASAYUKI</last-name></addressbook></inventor><inventor mxw-id="PPAR919010972" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>TAKEMURA, MASAYUKI</last-name><address><street>c/o Hitachi, Ltd., Intellectual Property Group 6-1, Marunouchi 1-chome, Chiyoda-ku</street><city>Tokyo, 100-8220</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919531245" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>NAKAMURA KATSUYUKI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919526256" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>NAKAMURA, KATSUYUKI</last-name></addressbook></inventor><inventor mxw-id="PPAR919012579" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>NAKAMURA, KATSUYUKI</last-name><address><street>c/o Hitachi, Ltd., Intellectual Property Group 6-1, Marunouchi 1-chome, Chiyoda-ku</street><city>Tokyo, 100-8220</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919017538" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>MERH-IP Matias Erny Reichl Hoffmann</last-name><iid>101060911</iid><address><street>Paul-Heyse-Strasse 29</street><city>80336 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549812364" load-source="docdb">AL</country><country mxw-id="DS549812255" load-source="docdb">AT</country><country mxw-id="DS549812370" load-source="docdb">BE</country><country mxw-id="DS549741613" load-source="docdb">BG</country><country mxw-id="DS549739939" load-source="docdb">CH</country><country mxw-id="DS549739580" load-source="docdb">CY</country><country mxw-id="DS549739581" load-source="docdb">CZ</country><country mxw-id="DS549739283" load-source="docdb">DE</country><country mxw-id="DS549812371" load-source="docdb">DK</country><country mxw-id="DS549812372" load-source="docdb">EE</country><country mxw-id="DS549907308" load-source="docdb">ES</country><country mxw-id="DS549741614" load-source="docdb">FI</country><country mxw-id="DS549741615" load-source="docdb">FR</country><country mxw-id="DS549739284" load-source="docdb">GB</country><country mxw-id="DS549812373" load-source="docdb">GR</country><country mxw-id="DS549739285" load-source="docdb">HR</country><country mxw-id="DS549739582" load-source="docdb">HU</country><country mxw-id="DS549739940" load-source="docdb">IE</country><country mxw-id="DS549812378" load-source="docdb">IS</country><country mxw-id="DS549741616" load-source="docdb">IT</country><country mxw-id="DS549812379" load-source="docdb">LI</country><country mxw-id="DS549739286" load-source="docdb">LT</country><country mxw-id="DS549812256" load-source="docdb">LU</country><country mxw-id="DS549739287" load-source="docdb">LV</country><country mxw-id="DS549739288" load-source="docdb">MC</country><country mxw-id="DS549812257" load-source="docdb">MK</country><country mxw-id="DS549812266" load-source="docdb">MT</country><country mxw-id="DS549741621" load-source="docdb">NL</country><country mxw-id="DS549739941" load-source="docdb">NO</country><country mxw-id="DS549741622" load-source="docdb">PL</country><country mxw-id="DS549907309" load-source="docdb">PT</country><country mxw-id="DS549741623" load-source="docdb">RO</country><country mxw-id="DS549907310" load-source="docdb">RS</country><country mxw-id="DS549741624" load-source="docdb">SE</country><country mxw-id="DS549738276" load-source="docdb">SI</country><country mxw-id="DS549739942" load-source="docdb">SK</country><country mxw-id="DS549739943" load-source="docdb">SM</country><country mxw-id="DS549812380" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128673028" lang="EN" load-source="patent-office"><p id="pa01" num="0001">An in-vehicle apparatus includes: a camera 1 with a shielded area formed within a photographing area thereof by a light shielding member 1a, which outputs a photographic image of an area surrounding a vehicle photographed through a photographic lens; and an adhering matter detection unit that detects adhering matter settled on the photographic lens based upon images in the shielded area included in a plurality of photographic images output from the camera 1 at different time points.
<img id="iaf01" file="imgaf001.tif" wi="135" he="99" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128737173" lang="EN" source="EPO" load-source="docdb"><p>An in-vehicle apparatus includes: a camera 1 with a shielded area formed within a photographing area thereof by a light shielding member 1a, which outputs a photographic image of an area surrounding a vehicle photographed through a photographic lens; and an adhering matter detection unit that detects adhering matter settled on the photographic lens based upon images in the shielded area included in a plurality of photographic images output from the camera 1 at different time points.</p></abstract><description mxw-id="PDES63959016" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">The disclosure of the following priority application is herein incorporated by reference: Japanese patent application no. <patcit id="pcit0001" dnum="JP2012149862A"><text>2012-149862 filed July 3, 2012</text></patcit>.</p><p id="p0002" num="0002">The present invention relates to an in-vehicle apparatus.</p><p id="p0003" num="0003">A partition line recognizing device known in the related art, which photographs a white line on the road upon which a vehicle is traveling via a camera installed in the vehicle, determines that a partition line is recognized if a recognition rate of the photographed white line is greater than a preset threshold value and determines that the partition line is not recognized if their recognition rate is smaller than the threshold value. The device includes a stain detection unit that detects any stains adhering to the camera or the windshield of the vehicle so as to be able to adjust the threshold value when the stain detection unit detects stains on the camera or the windshield (see Japanese Laid Open Patent Publication no. <patcit id="pcit0002" dnum="JP2003044863A"><text>2003-44863</text></patcit>).</p><p id="p0004" num="0004">In addition, there is an obstacle detecting device proposed for use in vehicular applications in the related art that excludes foreign matter adhering to the camera lens belonging to a camera installed in a vehicle and part of the subject vehicle photographed by the camera from the detection target range so as to improve the obstacle detection accuracy. It is further able to issue a warning to the driver of the vehicle based upon the ratio of foreign matter and the like excluded from the detection target range, to automatically halt the obstacle detecting operation and to report to the vehicle driver that the obstacle detection operation has been halted (see Japanese Laid Open Patent Publication no. <patcit id="pcit0003" dnum="JP2012038048A"><text>2012-038048</text></patcit>).</p><p id="p0005" num="0005">There is an issue in the related art in that since images of matter adhering to the camera or the windshield are mixed among images of other objects, erroneous detection of adhering matter may occur. There is another issue that must be addressed in the related art in that while an immobile area in an image is extracted, the immobile area cannot be determined to correspond to the subject vehicle body or to foreign matter adhering to the camera lens, which makes it impossible to determine the shielded area to be set for the photographing device.</p><p id="p0006" num="0006">According to the 1st aspect of the present invention, an in-vehicle apparatus comprises: a camera with a shielded area formed within a photographing area thereof by a light shielding member, which outputs a photographic image of an area surrounding a<!-- EPO <DP n="2"> --> vehicle photographed through a photographic lens; and/or an adhering matter detection unit that detects adhering matter settled on the photographic lens based upon images in the shielded area included in a plurality of photographic images output from the camera at different time points.</p><p id="p0007" num="0007">According to the 2nd aspect of the present invention, in the in-vehicle apparatus according to the 1 st aspect, it is preferred that the adhering matter detection unit generates a difference image based upon the images in the shielded area included in the plurality of photographic images output from the camera at the different time points and detects an image taking on a specific shape contained in the different image, as the adhering matter.</p><p id="p0008" num="0008">According to the 3rd aspect of the present invention, in the in-vehicle apparatus according to the 2nd aspect, it is preferred that at the camera, the light shielding member is disposed at a position further toward a subject relative to the photographic lens.</p><p id="p0009" num="0009">According to the 4th aspect of the present invention, in the in-vehicle apparatus according to the 3rd aspect, it is preferred that at the camera, the light shielding member is disposed so that the camera is able to photograph a road surface outside the vehicle while light advancing from an origin other than the road surface toward the photographic lens is blocked.</p><p id="p0010" num="0010">According to the 5th aspect of the present invention, in the in-vehicle apparatus according to the 4th aspect, it is preferred that: the in-vehicle apparatus further comprises a warning output unit that outputs a warning, and a warning control unit that outputs a signal for the warning output unit so as to cause a warning to be output by the warning output unit when the vehicle is determined, based upon a white line on the road surface included in the photographic images, to be about to move out of a current lane; and the signal control unit restricts output of the signal from the warning control unit to the warning output unit when the adhering matter detection unit detects the adhering matter.</p><p id="p0011" num="0011">According to the 6th aspect of the present invention, in the in-vehicle apparatus according to any one of the 1st through 5th aspects, it is preferred that: the in-vehicle apparatus further comprises an adhering matter removing unit engaged in operation for removing adhering matter settled on the photographic lens, and a cleaning control unit that controls the operation of the adhering matter removing unit; and the signal control unit outputs a signal for the cleaning control unit so as to engage the adhering matter removing unit in operation when the adhering matter detection unit detects the adhering matter.</p><p id="p0012" num="0012">According to the 7th aspect of the present invention, in the in-vehicle apparatus according to any one of the 1 st through 6th aspects, it is preferred that the in-vehicle<!-- EPO <DP n="3"> --> apparatus further comprises a geometric computation unit that calculates the shielded area based upon a body model and a tolerance model stored in advance.</p><p id="p0013" num="0013">According to the 8th aspect of the present invention, in the in-vehicle apparatus according to any one of the 1st through 6th aspects, it is preferred that the in-vehicle apparatus further comprises a signal control unit that controls output signals based upon detection results provided by the adhering matter detection unit.</p><p id="p0014" num="0014">According to the present invention, matter adhering to a camera lens can be detected in an optimal manner.</p><heading id="h0001">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p0015" num="0015"><ul><li><figref idrefs="f0001">FIG. 1</figref> is a block diagram of the structure adopted in the in-vehicle apparatus achieved in a first embodiment of the present invention.</li><li><figref idrefs="f0002">FIG. 2</figref> illustrates the photographing area and the shielded area set for the camera.</li><li><figref idrefs="f0003">FIG. 3</figref> presents an example of a camera installation position.</li><li><figref idrefs="f0004">FIG. 4</figref> is a control block diagram pertaining to the control executed in the in-vehicle apparatus achieved in the first embodiment of the present invention.</li><li><figref idrefs="f0005">FIG. 5</figref> presents an example of a photographic image that may be captured with the camera.</li><li><figref idrefs="f0006">FIG. 6</figref> illustrates how a difference image is generated.</li><li><figref idrefs="f0007">FIGS. 7A and 7B</figref> illustrate how a decision is made with regard to the shape of adhering matter.</li><li><figref idrefs="f0008">FIG. 8</figref> presents a control flowchart showing how control may be executed in the in-vehicle apparatus in the first embodiment of the present invention.</li><li><figref idrefs="f0009">FIG. 9</figref> presents a control flowchart showing how control may be executed in the in-vehicle apparatus in the first embodiment of the present invention.</li><li><figref idrefs="f0010">FIGS. 10A and 10B</figref> present an example of a variation pertaining to the shielding plate included in the camera.</li><li><figref idrefs="f0011">FIG. 11</figref> is a control block diagram pertaining to the control executed in the in-vehicle apparatus achieved in s second embodiment of the present invention.</li><li><figref idrefs="f0012">FIGS. 12A and 12B</figref> indicate positional relationships that may be assumed by the camera and the shielding plate.</li><li><figref idrefs="f0013">FIG. 13</figref> is a control block diagram pertaining to the control executed for the shielding area-setting unit.</li><li><figref idrefs="f0014">FIG. 14</figref> presents a flowchart of processing that may be executed to calculate the shielding plate area boundary.</li></ul><!-- EPO <DP n="4"> --></p><heading id="h0002">DESCRIPTION OF PREFERRED EMBODIMENTS</heading><heading id="h0003">(First Embodiment)</heading><p id="p0016" num="0016"><figref idrefs="f0001">FIG. 1</figref> is a block diagram showing the structure adopted in an in-vehicle (in-car or onboard) apparatus 1 achieved in the first embodiment of the present invention. The in-vehicle apparatus 100 in the figure, installed in a vehicle, includes a camera 1 with a shielding plate 1a mounted thereat, a control unit 2, a warning output unit 3, an operating state reporting unit 4, a cleaning control unit 5, an air pump 6, a washer pump 7, an air nozzle 8 and a washer nozzle 9.</p><p id="p0017" num="0017">The camera 1, installed so as to face the space to the rear of the vehicle, photographs (or captures) an image within a photographing area, which includes the surface of the road to the rear of the vehicle, after each time interval set to a specific time length. This camera 1 may be constituted with an image sensor such as a CCD image sensor or a CMOS image sensor. The photographic image obtained via the camera 1 is output from the camera 1 to the control unit 2.</p><p id="p0018" num="0018">The shielding plate 1a is mounted at the camera 1 so as to block part of light advancing toward the photographic lens in the camera 1. <figref idrefs="f0002">FIG. 2</figref> illustrates the photographing area and a shielded area assumed for the camera 1 in a lateral view of the camera. As <figref idrefs="f0002">FIG. 2</figref> indicates, the shielded area is formed by the shielding plate 1a masking part of the photographing area of the camera 1, and more specifically, masking a portion of the photographing area on its upper side. The camera 1 photographs an image, which includes the surface of the road present to the rear of the vehicle, over the photographing area excluding the shielded area. A relatively large photographing area (may be otherwise referred to as the angle of view or the photographic field angle) is set for the camera so as to allow the camera to photograph the surface of the road present to the rear of the vehicle over a sufficiently large range along the left/right direction and, for this reason, unnecessary light other than the light from the road surface, e.g., light from the sky or a background object, would also enter the camera 1. Accordingly, the shielded area is formed with the shielding plate 1a in order to block such unwanted incident light that would otherwise enter the camera 1.</p><p id="p0019" num="0019"><figref idrefs="f0003">FIG. 3</figref>. presents an example of an installation position at which the camera 1 may be mounted. A number plate 21 is mounted at a body 20 over an area at the rear of the subject vehicle. The camera 1 is mounted directly above the number plate 21 so as to face diagonally downward, with the shielding plate 1a disposed over the camera 1. It is to be noted that the installation position shown in the figure is simply an example and that<!-- EPO <DP n="5"> --> the camera 1 may be installed at another position. In other words, the installation position at which the camera 1 is to be installed may the determined freely, as long as it is ensured that the camera 1 is able to photograph the surface of the road present to the rear of the vehicle over an optimal range.</p><p id="p0020" num="0020">The control unit 2, which includes a RAM 10, a ROM 11 and a CPU 12, stores photographic images originating from the camera 1 into the RAM 10, executes specific types of image processing by using the photographic images and then executes various types of control in correspondence to the processing results. Through the control executed by the control unit 2, various functions of the in-vehicle apparatus 100, such as an LDW (lane departure warning) function, a BSW (blind spot warning) function, an MOD (moving object detection) function and an IMD (image diagnosis) function, are realized. The LDW is a function that enables the in-vehicle apparatus 100 to output a warning whenever the subject vehicle is likely to move out of the lane in which it is currently traveling by detecting a white line on the road surface (e.g., a lane boundary, a road shoulder line or a centerline) in the photographic images. The BSW is a function that enables the in-vehicle apparatus 100 to issue a warning for the driver indicating the presence of a vehicle that may collide with the subject vehicle as the subject vehicle changes lanes or the like by detecting other vehicles traveling on the road in the photographic images. The MOD is a function that enables the in-vehicle apparatus 100 to inform the driver of the presence of a moving object in the vicinity of the subject vehicle when it is driven in reverse gear or the like by detecting moving objects in the photographic images. The IMD is a function that enables the in-vehicle apparatus 100 to execute diagnosis to determine whether or not the camera 1 is photographing images correctly.</p><p id="p0021" num="0021">The warning output unit 3 outputs a warning for the vehicle driver via a warning lamp, a warning buzzer or the like. The operation of this warning output unit 3 is controlled by the control unit 2. When the in-vehicle apparatus determines that the subject vehicle is about to move out of the current lane through the LDW function described earlier or when a vehicle that may collide with the subject vehicle is detected through the BSW function described earlier, for instance, a warning is output by the warning output unit 3 under control executed by the control unit 2.</p><p id="p0022" num="0022">The operating state reporting unit 4 reports the operating state of the in-vehicle apparatus 100 to the vehicle driver. For instance, if predetermined operating conditions are not satisfied and the in-vehicle apparatus 100 is in a non-operating state, a lamp<!-- EPO <DP n="6"> --> constituting the operating state reporting unit 4, installed near the driver's seat in the vehicle, is lit under control executed by the control unit 2. As a result, the driver is informed that the in-vehicle apparatus 100 is currently in the non-operating state.</p><p id="p0023" num="0023">The cleaning control unit 5, engaged in operation under control executed by the control unit 2, controls operations of the air pump 6 and the washer pump 7. For instance, when the in-vehicle apparatus determines through the IMD function described earlier that the camera 1 is not photographing images correctly due to matter such as condensation, mud or a snow-melting agent, adhering to the camera 1, the control unit 2 outputs a control signal for the cleaning control unit 5, requesting that the photographic lens be cleaned. In response to this signal, the cleaning control unit 5 controls the operations of the air pump 6 and the washer pump 7.</p><p id="p0024" num="0024">The air pump 6, engaged in operation under control executed by the cleaning control unit 5, outputs compressed air to the air nozzle 8. As this compressed air is forced through the air nozzle 8 toward the camera 1, matter adhering to the photographic lens of the camera 1, such as condensation, is blown off the photographic lens.</p><p id="p0025" num="0025">The washer pump 7, engaged in operation under control executed by the cleaning control unit 5, outputs a washing solution supplied from a washer tank (not shown) to the washer nozzle 9. As this washing solution is sprayed via the washer nozzle 9 toward the camera 1, matter such as mud adhering to the photographic lens of the camera 1, which cannot be removed with compressed air from the air nozzle 8, is washed off the photographic lens.</p><p id="p0026" num="0026"><figref idrefs="f0004">FIG. 4</figref> is a control block diagram, representing an example of control that may be executed in the in-vehicle apparatus achieved in the embodiment of the present invention. The control unit 2 in the in-vehicle apparatus 100 in <figref idrefs="f0004">FIG. 4</figref> functions as a shielded area-setting unit 31, an adhering matter detection unit 31, a signal control unit 33 and a warning control unit 36.</p><p id="p0027" num="0027"><figref idrefs="f0005">FIG. 5</figref> provides an illustration in reference to which the shielded area-setting unit 31 will be described. The shielded area-setting unit 31 sets an image area, such as the hatched image area 41 in <figref idrefs="f0005">FIG. 5</figref>, which corresponds to the shielded area in <figref idrefs="f0002">FIG. 2</figref>, for photographic images output from the camera 1. In the following description, this image area will be referred to as a shielded image area and the image in the shielded image area will be referred to as a shielded image. It is to be noted that <figref idrefs="f0005">FIG. 5</figref> shows a road surface 42 of the lane in which the subject vehicle is currently traveling, and a white line 43 and a white line 44 painted on the road surface to define the traveling lane, which are<!-- EPO <DP n="7"> --> photographed over the image area other than the shielded image area 41 and will be used in conjunction with the LDW function.</p><p id="p0028" num="0028">The adhering matter detection unit 32 detects matter adhering to the photographic lens based upon shielded images. The adhering matter detection unit 32, which includes a change detection unit 34 and a shape decision-making unit 35, detects matter adhering to the photographic lens via these units.</p><p id="p0029" num="0029">The change detection unit 34 detects a change manifesting in shielded images based upon a plurality of photographic images output from the camera 1 at different time points. The change detection unit 34 generates an image, to be referred to as a difference image, based upon the plurality of photographic images as detection results.</p><p id="p0030" num="0030">In reference to <figref idrefs="f0006">FIG. 6</figref>, a method that may be adopted when generating the difference image will be described. The difference image is generated by calculating the difference between the most recently photographed image and a reference image. The reference image is generated based upon past photographic images preceding the most recent photographic image, having been successively output from the camera 1 in time series.</p><p id="p0031" num="0031"><figref idrefs="f0006">FIG. 6</figref> includes an arrow representing the passage of time, with time points t<sub>0</sub> through t<sub>5</sub> above the arrow marking time intervals corresponding to the frame rate of the camera 1. A<sub>0</sub> through A<sub>5</sub> under the arrow representing the passage of time respectively indicate photographic images output from the camera 1 at the time points t<sub>0</sub> through t<sub>5</sub>.</p><p id="p0032" num="0032">The photographic images A<sub>0</sub> through A<sub>5</sub> are each stored into the RAM 10 as it is output from the camera 1 and thus, the photographic images are accumulated in the RAM 10. It is assumed that the accumulation of the photographic images into the RAM 10 starts at the time point to. Namely, the photographic image A<sub>0</sub> is the oldest photographic image among the photographic images stored in the RAM 10 and the photographic image A<sub>5</sub> is the newest photographic image, most recently stored into the RAM 10 in <figref idrefs="f0006">FIG. 6</figref>.</p><p id="p0033" num="0033">When a new photographic image A<sub>i</sub> is output from the camera 1 (e.g., at that time point t<sub>5</sub>), a reference image B<sub>i</sub> is generated as expressed in [1] or [2] below by using an immediately preceding photographic image A<sub>i</sub> - <sub>1</sub> having been most recently starred into the RAM 10 (e.g., the photographic image A<sub>4</sub>) and a current reference image B<sub>i - 1</sub> being used for reference up to the point at which the photographic image A<sub>i</sub> is output. <maths id="math0001" num="[1]"><math display="block"><msub><mi mathvariant="normal">B</mi><mi mathvariant="normal">i</mi></msub><mo>=</mo><msub><mi mathvariant="normal">A</mi><mrow><mi mathvariant="normal">i</mi><mo>-</mo><mn mathvariant="normal">1</mn></mrow></msub><mfenced separators=""><mi>if i</mi><mo>=</mo><mn mathvariant="normal">1</mn></mfenced></math><img id="ib0001" file="imgb0001.tif" wi="41" he="4" img-content="math" img-format="tif"/></maths> <maths id="math0002" num="[2]"><math display="block"><msub><mi mathvariant="normal">B</mi><mi mathvariant="normal">i</mi></msub><mo>=</mo><mi>k x</mi><mspace width="1em"/><msub><mi mathvariant="normal">A</mi><mrow><mi mathvariant="normal">i</mi><mo>-</mo><mn mathvariant="normal">1</mn></mrow></msub><mo>+</mo><mfenced separators=""><mn mathvariant="normal">1</mn><mo>-</mo><mi mathvariant="normal">k</mi></mfenced><mspace width="1em"/><mi mathvariant="normal">x</mi><mspace width="1em"/><msub><mi mathvariant="normal">B</mi><mrow><mi mathvariant="normal">i</mi><mo>-</mo><mn mathvariant="normal">1</mn></mrow></msub><mspace width="1em"/><mfenced separators=""><mi>if i</mi><mo>≥</mo><mn mathvariant="normal">2</mn></mfenced></math><img id="ib0002" file="imgb0002.tif" wi="74" he="4" img-content="math" img-format="tif"/></maths><br/>
k in the expression above is a coefficient taking a value in the range of 0 &lt; k ≤ 1. For<!-- EPO <DP n="8"> --> instance, k = 0.1.</p><p id="p0034" num="0034">The change detection unit 34 generates a difference image representing the difference between the newest photographic image (e.g., the photographic image A<sub>5</sub> output from the camera 1) and a reference image corresponding to the time point at which the newest photographic image is output (e.g., the reference image B<sub>5</sub>).</p><p id="p0035" num="0035">It is to be noted that the change detection unit 34 may further execute subroutines, which may be referred to as a gain decision-making unit, a cloudiness decision-making unit, an ambient light source decision-making unit, a weather decision-making unit and a day/night decision-making unit, in addition to the difference image generation. The change detection unit 34 should be able to control the difference image generation and the shape decision-making unit 35 through these subroutines.</p><p id="p0036" num="0036">The gain decision-making unit monitors the sensitivity at the camera 1 and makes a decision as to whether or not the sensitivity has been altered (whether or not the gain has been adjusted). The sensitivity at the camera 1 is altered as the brightness of the photographic images changes drastically, e.g., as the subject vehicle enters a tunnel. If the sensitivity at the camera 1 is altered, the gain decision-making unit attributes changes in the photographic images to the alteration in the sensitivity at the camera 1 and accordingly, does not execute adhering matter detection based upon the difference image so as to prevent erroneous detection of adhering matter.</p><p id="p0037" num="0037">The cloudiness decision-making unit makes a decision as to whether or not the photographic lens has been rendered into a cloudy state (white turbidness) by adhering matter such as water condensation. The cloudiness decision-making unit may execute edge detection processing of the known art on photographic images output from the camera 1 and decide that the photographic lens is in a cloudy state if the edge intensity of edges detected through the edge detection processing is low. The change detection unit 34 adjusts a threshold value set in conjunction with the shape decision-making unit 35 if the cloudiness decision-making unit decides that the photographic lens is in a cloudy state.</p><p id="p0038" num="0038">The ambient light source decision-making unit makes a decision as to whether or not the camera 1 is illuminated by an ambient light source such as the headlights of a vehicle traveling behind the subject vehicle or a street lamp. If it is decided that the camera 1 is illuminated by an ambient light source, the change detection unit 34 executes control so as to reset the storage of photographic images, to be used for purposes of reference image generation, into the RAM 10, for instance. The decision as to whether or not the camera 1 is illuminated by an ambient light source may be made based upon a<!-- EPO <DP n="9"> --> signal output from a light detection sensor installed, for instance, in the vicinity of the camera 1.</p><p id="p0039" num="0039">The weather decision-making unit makes a decision as to whether the weather around the subject vehicle is fair. The weather decision-making unit may make the decision as to whether or not the weather is fair by, for instance, ascertaining the operating state of the windshield wipers in the vehicle through CAN communication. If the weather decision-making unit decides that the weather around the subject vehicle is fair, it adjusts a threshold value set for the shape decision-making unit 35. It is to be noted that the decision as to whether or not the weather is fair may be made by ascertaining whether or not the sun is recognized in the photographic images.</p><p id="p0040" num="0040">The day/night decision-making unit makes a decision as to whether it is daytime or nighttime. The day/night decision-making unit may decide that it is nighttime if the overall brightness of the photographic images output from the camera 1 is equal to or less than a predetermined value, i.e., if the photographic images output from the camera 1 are dark. Based upon the decision-making results, the day/night decision-making unit adjusts a threshold value set for the shape decision-making unit 35.</p><p id="p0041" num="0041">The shape decision-making unit 35 makes a decision as to whether or not an aggregate of pixels expressing a single color, included in the difference image having been generated by the change detection unit 34, represents adhering matter by ascertaining whether or not the pixel aggregate manifests specific shape-related characteristics. A pixel aggregate taking on a single color may be detected from the difference image through, for instance, edge detection processing, labeling processing or the like of the known art. The shape decision-making unit 35 makes individual decisions in regard to the aspect ratio, the fill ratio (to be described in detail later), the area and the recession rate (to be described in detail later) of the pixel aggregate and concludes that the pixel aggregate expresses an image of adhering matter if the decisions are all affirmative.</p><heading id="h0004">Shape decision-making based upon the aspect ratio -</heading><p id="p0042" num="0042">In reference to <figref idrefs="f0007">FIG. 7A</figref>, the shape decision-making executed based upon the aspect ratio will be described. The shape decision-making unit 35 calculates a ratio H/W of the length H of the photographic image of a pixel aggregate included in the difference image measured along the vertical axis, and the length W of the photographic image of the pixel aggregate measured along the horizontal axis, as an aspect ratio of the pixel aggregate. The shape decision-making unit 35 makes an affirmative decision in the aspect ratio-based shape decision-making if the aspect ratio H/W is equal to or greater<!-- EPO <DP n="10"> --> than a predetermined threshold value Th1 and also equal to or less than a predetermined threshold value Th2. If, on the other hand, the aspect ratio H/W is less than the predetermined threshold value Th1 or greater than the predetermined threshold value Th2, the shape decision-making unit 35 makes a negative decision in the aspect ratio-based shape decision-making. The threshold values Th1 and Th2 are adjusted via the change detection unit 34 and the like.</p><heading id="h0005">- Shape decision-making based upon the fill ratio -</heading><p id="p0043" num="0043">In reference to <figref idrefs="f0007">FIG. 7A</figref>, the shape decision-making executed based upon the fill ratio will be described. The shape decision-making unit 35 executing the fill ratio-based shape decision-making calculates a fill ratio as the ratio S/(HW) of the area S of a pixel aggregate included in the difference image to the product HW of the length H of the photographic image of the pixel aggregate measured along the vertical axis and the length W of the photographic image measured along the horizontal axis. The shape decision-making unit 35 then makes an affirmative decision in the fill ratio-based shape decision-making if the fill ratio S/(HW) is equal to or greater than a predetermined threshold value Th3 and also equal to or less than a predetermined threshold value Th4. If, on the other hand, the fill ratio S/(HW) is less than the predetermined threshold value Th3 or greater than the predetermined threshold value Th4, the shape decision-making unit 35 makes a negative decision in the fill ratio-based shape decision-making. The threshold values Th3 and Th4 are adjusted via the change detection unit 34 and the like.</p><heading id="h0006">- Shape decision-making based upon the area -</heading><p id="p0044" num="0044">The shape decision-making executed based upon the area will be described next. The shape decision-making unit 35 makes an affirmative decision in the area-based decision-making if the area S of a pixel aggregate included in the difference image is equal to or greater than a predetermined threshold value Th5 and also equal to or less than the predetermined threshold value Th6. If, on the other hand, the area S is less than the predetermined threshold value Th5 or greater than the predetermined threshold value Th6, the shape decision-making unit 35 makes a negative decision in the area-based shape decision-making. The threshold values Th5 and Th6 are adjusted via the change detection unit 34 and the like.</p><heading id="h0007">- Shape decision-making executed based upon the recession rate -</heading><p id="p0045" num="0045">In reference to <figref idrefs="f0007">FIG. 7B</figref>, the shape decision-making executed based upon the recession rate at an outline will be described. The shape decision-making unit 35 makes a decision with regard to the shape of a pixel aggregate included in the difference image<!-- EPO <DP n="11"> --> based upon a change occurring in the direction of the tangent vector occurring as the outline of the pixel aggregate (e.g., an outline 50 in <figref idrefs="f0007">FIG. 7B</figref>) is sequentially traced from the uppermost point (e.g., a point 51 in <figref idrefs="f0007">FIG. 7B</figref>) of the pixel aggregate along the counterclockwise direction. As the outline of a pixel aggregate assuming a convex shape, e.g., a circular shape, is traced counterclockwise, the direction of the tangent vector changes along the counterclockwise direction. However, at a recessed area such as a recess 52 in <figref idrefs="f0007">FIG. 7B</figref>, the direction of the tangent vector may change along the clockwise direction.</p><p id="p0046" num="0046">The shape decision-making unit 35 calculates the outline tangent vector direction in correspondence to each pixel making up the outline of each pixel aggregate. <figref idrefs="f0007">FIG. 7B</figref> presents examples of some tangent vectors, the directions of which are calculated in conjunction with the outline 50 of the pixel aggregate. The shape decision-making unit 31 determines the direction of the tangent vector at each of the pixels forming the outline of each pixel aggregate in sequence along the outline of the pixel aggregate by tracing the outline in the counterclockwise direction and makes a decision as to whether the tangent vector rotates counterclockwise or clockwise by comparing the direction of the tangent vector with the direction of the tangent vector at the immediately preceding pixel. Once the outline of a given pixel aggregate is traced fully in the counterclockwise direction, the shape decision-making unit 35 calculates a recession rate N/(M + N) by calculating the number of tangent vectors M that rotate along the counterclockwise direction and the number of tangent vectors N that rotate along the clockwise direction. The shape decision-making unit 35 makes an affirmative decision in the recession rate-based shape decision-making if the recession rate N/(M + N), having been calculated for the particular pixel aggregate included in the difference image, is equal to or greater than a predetermined threshold value Th7 and also equal to or less than a predetermined threshold value Th8. If, on the other hand, the recession rate N/(M + N) is less than the predetermined threshold value Th7 or greater than the predetermined threshold value Th8, the shape decision-making unit 35 makes a negative decision in the recession rate-based shape decision-making. The threshold values Th7 and Th8 are adjusted via the change detection unit 34 and the like.</p><p id="p0047" num="0047">The warning control unit 36 in <figref idrefs="f0004">FIG. 4</figref> detects a white line on the road surface included in the photographic images and makes a decision as to whether or not the subject vehicle is likely to move out of the current lane based upon the position of the white line. If the decision-making results indicate that the subject vehicle is about to move out of the<!-- EPO <DP n="12"> --> current lane, the warning control unit 36 outputs a control signal for the warning output unit 3, prompting the warning output unit 3 to output a warning.</p><p id="p0048" num="0048">The signal control unit 33 outputs a control signal for the cleaning control unit 5 based upon the positions and the quantities of the pixel aggregates having been concluded to be adhering matter by the shape decision-making unit 35. For instance, if the quantity of pixel aggregates, having been concluded to be adhering matter by the shape decision-making unit 35, is equal to or greater than a predetermined value (e.g., one), the signal control unit 33 outputs a control signal for the cleaning control unit 5, requesting that the adhering matter on the photographic lens be removed by engaging the air pump 6 or the washer pump 7 in operation.</p><p id="p0049" num="0049">In addition, provided, for instance, that there is a pixel aggregate, having been concluded to be adhering matter, present over the left half of the shielded image area, the signal control unit 33 controls the warning control unit 36 so that it stops outputting the control signal to the warning output unit 3 if the subject vehicle is determined to be likely to move out of the current lane toward the right side (the left side in the photographic images). In contrast, provided that there is a pixel aggregate, having been concluded to be adhering matter, present over the right half of the shielded image area, the signal control unit 33 controls the warning control unit 36 so that it stops outputting the control signal to the warning output unit 3 if the subject vehicle is determined to be likely to move out of the current lane toward the left side (the right side in the photographic images). Through these measures, the control signal output from the warning control unit 36 is restricted.</p><p id="p0050" num="0050"><figref idrefs="f0008">FIG. 8</figref> presents a control flowchart pertaining to the control executed in a vehicle control device 200. The control processing in <figref idrefs="f0008">FIG. 8</figref> is executed by the CPU 12 in the control unit 2 as directed in a control program stored in the ROM 11. In step S300, the CPU 12 sets the shielded image area for photographic images that are output from the camera 1 by controlling the shielded area-setting unit 31.</p><p id="p0051" num="0051">In step S310, the CPU 12 alters the threshold values set for the shape decision-making unit based upon the traveling conditions at the subject vehicle. For instance, upon obtaining, through CAN communication, information indicating that the subject vehicle is currently traveling off road from a navigation apparatus or the like (not shown), the control unit 2 adjusts the various threshold values Th1 through Th8 at the shape decision-making unit 35 to off-road traveling threshold values.</p><p id="p0052" num="0052">In step S320, the CPU 12 clears the photographic images having been stored in<!-- EPO <DP n="13"> --> the RAM 10 for a reset. The CPU 12 also resets the reference image, the difference image and the like to the initial state.</p><p id="p0053" num="0053">In step S330, the CPU 12 obtains, through CAN communication, information indicating the subject vehicle speed and makes a decision as to whether or not the subject vehicle speed is equal to or higher than a predetermined speed (e.g., 30 km/h). Upon making an affirmative decision in step S330, the CPU 12 proceeds to execute the processing in step S340, whereas upon making a negative decision in step S330, it proceeds to execute the processing in step S320.</p><p id="p0054" num="0054">In step S340, the CPU 12 executes ambient light source decision-making by controlling the change detection unit 34. More specifically, the CPU 12 controls the ambient light source decision-making unit in the change detection unit 34 and makes an affirmative decision in step S340 if it is decided that the camera 1 is being illuminated with an ambient light source such as the headlights of a vehicle traveling behind the subject vehicle or a street lamp. Upon making an affirmative decision in step S340, the CPU 12 proceeds to execute the processing in step S320. In addition, the camera 1 may have a function of automatically adjusting the sensitivity or the like in correspondence to the ambient brightness. In such a case, the CPU 12 will also make an affirmative decision in step S340 after the sensitivity is adjusted in the camera 1, and will proceed to execute the processing in step S320. If, on the other hand, an affirmative decision is not made in step S340, the CPU 12 proceeds to execute the processing in step S350.</p><p id="p0055" num="0055">In step S350, the CPU 12 takes a photographic image having been output from the camera 1 into the RAM 10 for storage. In step S360, the CPU 12 controls the change detection unit 34 so as to have it generate a reference image through calculation.</p><p id="p0056" num="0056">In step S370, the CPU 12 makes a decision as to whether or not the number of photographic images having accumulated into the RAM 10 is now equal to or greater than a predetermined value (e.g., four). Upon making an affirmative decision in step S370, the CPU 12 proceeds to execute the processing in step S400 in <figref idrefs="f0009">FIG. 9</figref>, whereas upon making a negative decision in step S370, it proceeds to execute the processing in step S330 in <figref idrefs="f0008">FIG. 8</figref>.</p><p id="p0057" num="0057">In step S400 in <figref idrefs="f0009">FIG. 9</figref>, the CPU 12 executes gain decision-making by controlling the change detection unit 34. If the sensitivity at the camera 1 has been altered, the CPU 12 makes an affirmative decision in step S400 and proceeds to execute the processing in step S320 in <figref idrefs="f0008">FIG. 8</figref>. If, on the other hand, the sensitivity at the camera 1 has not been altered, the CPU 12 proceeds to execute the processing in step S410 in <figref idrefs="f0009">FIG. 9</figref>.<!-- EPO <DP n="14"> --></p><p id="p0058" num="0058">In step S410, the CPU 12 updates the difference image based upon the photographic image having been stored in step S350 and the reference image having been updated in step S360 by controlling the change detection unit 34.</p><p id="p0059" num="0059">In step S420, the CPU 12 executes shape decision-making for pixel aggregates present within the shielded image area in the difference image by controlling the shape decision-making unit 35. The CPU 12 concludes that any pixel aggregate, with its aspect ratio, fill ratio, area and recession rate each following within the range defined by the corresponding specific threshold values, to be adhering matter.</p><p id="p0060" num="0060">In step S430, the CPU 12 makes a decision as to whether or not a predetermined minimum number of pixel aggregates have been detected as adhering matter through step S420. Upon making an affirmative decision in step S430, the CPU 12 proceeds to execute the processing in step S440, whereas upon making a negative decision in step S430, it proceeds to execute the processing in step S330.</p><p id="p0061" num="0061">In step S440, the CPU 12 outputs a signal for the cleaning control unit 5 requesting that the adhering matter settled on the photographic lens at the camera 1 be removed. In step S450, the CPU 12 restricts the signal output from the warning control unit 36 to the warning output unit 3 based upon the positions at which the adhering matter has been detected in step S420. Once the processing in step S450 is completed, the CPU 12 proceeds to execute the processing in step S330 in <figref idrefs="f0008">FIG. 8</figref>.</p><p id="p0062" num="0062">The following advantages are achieved through the embodiment described above. The in-vehicle apparatus 100 includes the camera 1, which outputs a photographic image of an area surrounding the vehicle, captured via the photographic lens, and a shielded area is formed within the photographing area of the camera 1 by the shielding plate 1a, as shown in <figref idrefs="f0002">FIG. 2</figref>. In addition, the in-vehicle apparatus 100 includes the control unit 2, which functions as an adhering matter detection unit 32. The adhering matter detection unit 32 detects adhering matter on the photographic lens based upon shielded images in a plurality of photographic images output from the camera 1 at different time points. The control unit 2 further functions as a signal control unit 33, which controls output signals based upon the detection results provided via the adhering matter detection unit 32. The in-vehicle control unit 100 configured with these structural components is able to detect adhering matter settled on the lens of the camera 1 in an optimal manner.</p><p id="p0063" num="0063">The adhering matter detection unit 32 includes a change detection unit 34, which generates a difference image based upon a plurality of shielded images and a shape decision-making unit 35, which makes a decision as to whether or not each pixel<!-- EPO <DP n="15"> --> aggregate included in the difference image should be regarded as adhering matter based upon the shape of the pixel aggregate. Such use of the difference image over the shielded area for purposes of adhering matter detection ensures that adhering matter can be accurately detected regardless of how the scene outside the vehicle may change. In particular, the use of the difference image in the shielded area is particularly effective when detecting transparent adhering matter, since it will never be lost within an image of the scene (background) outside the vehicle.</p><p id="p0064" num="0064">As shown in <figref idrefs="f0002">FIG. 2</figref>, the camera 1 includes the shielding plate 1a, which forms a shielded area within the angle of view. The part of the shielding plate 1a that forms the shielded area is located further toward the subject relative to the photographic lens. As a result, adhering matter settled on the photographic lens is bound to appear in the shielded image with clarity, and, at the same time, it is ensured that the image of the scene outside the vehicle is not included in the shielded images.</p><p id="p0065" num="0065">The camera 1 photographs the surface of the road to the rear of the vehicle through the photographic lens. The shielding plate 1a is disposed so as to block light fluxes advancing from origins other than the road surface toward the photographic lens. Through these measures, the LDW function and the adhering matter detection are enabled at the same time.</p><p id="p0066" num="0066">If adhering matter is detected by the adhering matter detection unit 32 (step S430), the signal control unit 33 outputs a control signal for the cleaning control unit 5 requesting that the photographic lens be cleaned (step S440) and also restricts the signal output from the warning control unit 36 to the warning output unit 3 (step S450). Through these measures, the reliability of a warning issued through the LDW function is assured.</p><heading id="h0008">(Second Embodiment)</heading><heading id="h0009">&lt;Setting the shielded area for an image&gt;</heading><p id="p0067" num="0067"><figref idrefs="f0011">FIG. 11</figref> is a control block diagram pertaining to control executed in the in-vehicle apparatus achieved in the second embodiment of the present invention. The second embodiment is distinguishable from the first embodiment in that a body model 37 describing the structural shapes and dimensions of the components of an automobile and the camera and a tolerance model 38 describing the mounting tolerance with which the various structural components can be mounted are input to the shielded area-setting unit 31, as shown in <figref idrefs="f0011">FIG. 11</figref>.</p><p id="p0068" num="0068">The concept of "mounting tolerance" will be first explained. A screw with a diameter R [mm], for instance, cannot be mounted at a screw hole R [mm] in diameter,<!-- EPO <DP n="16"> --> since the screw cannot be turned in such a screw hole. In addition, a certain extent of variance must be allowed in the screw machining accuracy. With these factors taken into consideration, the screw hole will need to be formed so as to achieve a diameter of (R + α) [mm]. Furthermore, the screw hole machining accuracy, too, is bound to manifest some variance, and thus, the diameter of the finished screw hole will fall within the range of (R + α - β) [mm] through (R + α + β) [mm]. The screw/screw hole assembly, achieved by inserting the screw with the R [mm] diameter into this screw hole, is then bound to manifest a specific range of deviation. This range of deviation is commonly referred to as mounting tolerance, which can be calculated based upon the design values. In addition, when a plurality of components are assembled together, the tolerance will be calculated as a cumulative value and is thus bound to take a large value. Such cumulative tolerance can also be calculated based upon the design values.</p><p id="p0069" num="0069">Assuming that the shielding plate 1a is mounted at the camera 1, as shown in <figref idrefs="f0012">FIGS. 12A and 12B</figref>, the shapes of the camera, the shielding plate 1a and the bumper portion, their dimensions and the standard mounting conditions under which they are normally mounted, are described in the body model 32. In addition, the extents to which the positions of the camera 1 and the shielding plate 1a and their relative angles may deviate under the standard mounting conditions are described in the tolerance model 38.</p><p id="p0070" num="0070">Based upon the tolerance model 38, a shielding plate position 1b, at which the shielding plate boundary appears to have risen to a maximum height on an image captured by the camera, and a shielding plate position 1c, at which the shielding plate boundary appears to have descended to a minimum height on the image captured by the camera, can be ascertained. These shielding plate boundaries appearing on the image will be referred to as an upper-limit shielding plate boundary 2b and a lower limit shielding plate boundary 2c. The shielding plate assumes a shielding plate boundary 2a under the standard mounting conditions. Since the shielding plate and the camera are set apart from each other over different distances, as indicated in the figure, the shape of the boundary line, too, changes from one shielding plate position to another.</p><p id="p0071" num="0071"><figref idrefs="f0013">FIG. 13</figref> is a control block diagram representing an example of control that may be executed for the shielded area-setting unit 31. The in-vehicle apparatus 100 in <figref idrefs="f0013">FIG. 13</figref> includes a geometric computation unit 102, capable of calculating the range over which the shielding plate area may appear on an image based upon the body model 37 and the tolerance model 38 input thereto. The geometric computation unit 102 is able to calculate the position at which the shielding plate boundary is projected onto the image<!-- EPO <DP n="17"> --> sensor through a method of perspective projection of the known art based upon, for instance, the focal length of the camera, the image sensor size and a lens distortion model. As explained earlier, the shielding plate area cannot be univocally determined through geometric computation alone, but rather, there is bound to be a degree of uncertainty with regard to the position of the shielding plate area because of the tolerance. Accordingly, an accurate shielding plate boundary is determined through calculation by using a video image provided by the camera while the vehicle is in a traveling state. A specific image processing method adopted for purposes of shielding plate boundary calculation will be described in detail later.</p><p id="p0072" num="0072">The geometric computation unit 102 further determines a body area boundary of the subject vehicle, defined by the bumper, the finisher and the like, by using information provided via a calibration information acquisition unit 101 and the body model 37. It is to be noted that the calibration information used by the geometric computation unit 102 indicates the relation of a camera coordinate system to a body coordinate system, calculated by determining the camera coordinate system relative to a real-world coordinate system based upon the relation of the body coordinate system to the real-world coordinate system that is already known.</p><p id="p0073" num="0073">A processing area output unit 103 calculates an image area to be used for purposes of image recognition based upon the exact shielding plate boundary and the body area boundary having been determined by the geometric computation unit 102 and outputs the image area thus calculated. In the adhering matter detection logic adopted in this embodiment, transparent and semitransparent adhering matter is detected by designating the shielded area as the processing target so as to prevent erroneous detection attributable to ambient light and background objects. It is to be noted that when a given pixel is present astride the shielding plate area and the background area (containing the road surface, the sky, another vehicle and the like), the adverse effect of ambient light and background objects on the detection processing can be minimized by taking the particular pixel out of the processing target area. Accordingly, a raster scan is executed when calculating the image area to be used for image recognition and the processing area is created by taking any pixel present on the shielding plate boundary in the captured image out of the processing target area and including each pixel present strictly in the shielding plate area inside the shielding plate boundary in the processing target area. The processing area output unit 103 may output the image area thus calculated in the form of, for instance, a mask image.<!-- EPO <DP n="18"> --></p><p id="p0074" num="0074">In addition, a normalizing parameter output unit 104 outputs areal size of the processing area, output by the processing area output unit 103, to the adhering matter detection logic. The areal size of the processing area output by the processing area output unit 103 changes from one body to another, and accordingly, any variance in the sensitivity with which adhering matter is detected can be minimized by informing the adhering matter detection logic of the areal size of the processing area.</p><p id="p0075" num="0075">Next, in reference to <figref idrefs="f0014">FIG. 14</figref>, the flow of the processing executed to calculate the shielding plate area boundary will be described. First, in step S500, a decision is made as to whether or not shielding plate area calculation was completed when the vehicle was most recently in a traveling state. This decision may be made by determining whether or not shielding plate area information, which may be recorded in a flash-ROM (not shown), can be read out. If the calculation was completed ("yes" in step S500), the operation proceeds to step S501 to make a decision as to whether or not the shielding plate area information, having been recorded in the flash-ROM, is normal information. However, if it is decided that the calculation was not completed ("no" in step S500), the operation proceeds to execute shielding plate area extraction processing.</p><p id="p0076" num="0076">In step S501, the integrity of the shielding plate area, having been calculated through the previous processing session, is verified to ensure that the shielding plate area was not formed incorrectly. This verification is executed by first reading the shielding plate area recorded in the flash-ROM (not shown) and then determining whether or not the shielded area boundary is contained within the range defined by the maximum tolerance and the minimum tolerance or whether or not the position of the shielding plate shifted due to an impact or the like to which the camera may having been subjected. Any shift in the shielding plate position may be detected by scanning the image for edge positions in the vicinity of the boundary of the shielding plate area and ascertaining the rate at which the edge positions match the shielding plate boundary. If the integrity of the shielding plate area, having been formed through the previous processing session, is deemed acceptable ("yes" in step S501), the shielding plate area that has been read can be used for the subsequent processing and accordingly, the shielding plate area boundary calculation ends.</p><p id="p0077" num="0077">In the shielding plate area boundary calculation processing, an image is read from the camera in step S502 first.</p><p id="p0078" num="0078">Next, in step S503, a decision is made as to whether or not a shielding plate area can be formed under the current conditions. An affirmative decision should be made in<!-- EPO <DP n="19"> --> this step if at least one of the following conditions is satisfied; the day/night decision-making results indicate daytime, the extent of lens cloudiness (uncleanness) is represented by a value equal to or less than a predetermined threshold value, the subject vehicle is currently traveling at a speed equal to or higher than a specific speed, no direct sunlight or headlight from a vehicle traveling behind the subject vehicle is entering the lens, and it is not raining.</p><p id="p0079" num="0079">Then, in step S504, edges in the image are extracted and the edge images are accumulated. The edge images are accumulated by adding the counter value for the corresponding storage array element to the coordinates of each pixel manifesting an edge intensity within a predetermined range. A shielding plate boundary can then be calculated by fitting a polynomial curve representing the shielding plate boundary calculated based upon the body model 37 at array elements indicating counter values exceeding a specific value. A special explanation of such curve approximation will not be provided, since it can be executed by adopting a technology of the known art.</p><p id="p0080" num="0080">In addition, in step S505, a decision is made as to whether or not the system is shutting down. This decision-making may be triggered as the engine is turned off or the power to the ECU is cut off. As a result, the interim report of the shielding plate position calculation, having been underway at the time of system shutdown, can be recorded in step S507 and the length of time required for the shielding plate position calculation executed at a subsequent startup can be reduced. As an alternative, the system may be determined to be shutting down when a predetermined number of sets of data are collected in the storage array created in step S504. In such a case, the shielding plate mask creation can be completed as soon as enough data are accumulated, which will hasten the timing with which the adhering matter detection is executed.</p><p id="p0081" num="0081">In step S506, a decision is made as to whether or not the subject vehicle is traveling in a straight line along one direction by monitoring the vehicle speed and the steering angle. If it is decided that the subject vehicle is traveling in a straight line, the execution of the processing in step S504 is temporarily suspended and until the traveling direction is changed, only the processing in steps S505 and step S506 is executed. In other words, when the subject vehicle is traveling in a straight line, shadows, sunlight and the like may make it difficult to extract the shielding plate area accurately. Accordingly, images and characteristic quantities are accumulated gradually while the subject vehicle travels along various directions so as to ensure that the shielding plate area is created accurately and reliably.<!-- EPO <DP n="20"> --></p><p id="p0082" num="0082">In step S507, the details of the edge storage array and the shielding plate boundary information obtained through the curve approximation are recorded into a recording device such as the flash-ROM (not shown).</p><p id="p0083" num="0083">By adopting the structure characterizing the second embodiment as described above, an advantage is achieved in that the optimal shielded area can be calculated for each vehicle by taking into consideration the tolerance. Furthermore, with the shielding plate set in the optimal area, better detection capability for adhering matter detection is assured. Moreover, even if the shielding plate becomes shifted due to an impact or the like, it can be repositioned to the optimal shielding plate area by verifying whether or not the contents of the image output from the camera are consistent with the recorded information.</p><p id="p0084" num="0084">The embodiments described above allow for the following variations.
<ul><li>(Variation 1) The shielding plate 1a may assume a shape other than that shown in <figref idrefs="f0002">FIG. 2</figref>. For instance, a shielding plate 62 may be disposed as shown in <figref idrefs="f0010">FIG. 10B</figref> at a camera 13 so as to form a shielded image area 61 over the entire periphery of the photographic image. The presence of the shielding plate disposed as shown in the figure is bound to reduce the likelihood of matter, kicked up from the road surface, settling onto the photographic lens.</li><li>(Variation 2) As long as the shielding plate 1a is disposed further toward the subject relative to the photographic lens of the camera 1 so as to form a shielded area within the angle of view of the photographic lens in the camera 1, it may be installed by adopting a method other than that illustrated in <figref idrefs="f0002">FIG. 2</figref>. Furthermore, the shielding plate does not need to be installed at the camera 1, and instead, part of the body 20 may be utilized as a shielding plate or a shielding plate may be mounted at the body 20.</li><li>(Variation 3) While the camera 1 in the embodiments described above sustains a fixed photographic angle, the photographic angle at the camera 1 may be adjustable. It is desirable that the shielded area-setting unit 31 in a camera 1 with an adjustable photographic angle be able to adjust the shielded image area by altering the shape of the shielding plate 1a.</li><li>(Variation 4) While the change detection unit 34 in the embodiments described above calculates the reference image as expressed in [1] and [2], it may calculate a reference image through an alternative method. For instance, a reference image B<sub>i</sub> may be generated by calculating average values of the values indicated in the images A<sub>0</sub> through A<sub>i-1</sub>. In addition, the initial values for the reference image B<sub>i</sub> may be adjusted to<!-- EPO <DP n="21"> --> the products calculated by multiplying the values in the image A<sub>0</sub> by the coefficient k.</li><li>(Variation 5) The shape decision-making unit 35 makes a decision as to whether or not a given pixel aggregate is adhering matter in reference to four different criteria, i.e., the aspect ratio, the fill ratio, the area and the recession rate of the pixel aggregate. However, these four criteria simply represent examples and the shape decision-making unit 35 does not need to make the decision in reference to all four criteria. Furthermore, it may make the decision in reference to other criteria such as the length H measured along the vertical direction, the length W measured along the horizontal direction and the edge intensity.</li></ul></p><p id="p0085" num="0085">The embodiments and variations thereof described above simply represent examples and as long as features characterizing the invention remain intact, the present invention is in no way limited to the particulars of these embodiments and variations. In addition, as long as the features characterizing the present invention are not compromised, the embodiments and variations thereof described above may be adopted in any combination.</p></description><claims mxw-id="PCLM56982037" lang="EN" load-source="patent-office"><!-- EPO <DP n="22"> --><claim id="c-en-0001" num="0001"><claim-text>An in-vehicle apparatus, comprising:
<claim-text>a camera (1) with a shielded area formed within a photographing area thereof by a light shielding member, which outputs a photographic image of an area surrounding a vehicle photographed through a photographic lens; and</claim-text>
<claim-text>an adhering matter detection unit that detects adhering matter settled on the photographic lens based upon images in the shielded area included in a plurality of photographic images output from the camera at different time points.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>An in-vehicle apparatus according to claim 1, wherein:
<claim-text>the adhering matter detection unit generates a difference image based upon the images in the shielded area included in the plurality of photographic images output from the camera at the different time points and detects an image taking on a specific shape contained in the different image, as the adhering matter.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>An in-vehicle apparatus according to claim 1 or 2, wherein:
<claim-text>at the camera (1), the light shielding member is disposed at a position further toward a subject relative to the photographic lens.</claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>An in-vehicle apparatus according to at least one of claims 1 to 3, wherein:
<claim-text>at the camera (1), the light shielding member is disposed so that the camera (1) is able to photograph a road surface outside the vehicle while light advancing from an origin other than the road surface toward the photographic lens is blocked.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>An in-vehicle apparatus according to at least one of claims 1 to 4, further comprising:
<claim-text>a warning output unit (3) that outputs a warning; and</claim-text>
<claim-text>a warning control unit (36) that outputs a signal for the warning output unit (3) so as to cause a warning to be output by the warning output unit (3) when the vehicle is determined, based upon a white line on the road surface included in the photographic images, to be about to move out of a current lane, wherein:
<claim-text>the signal control unit (33) restricts output of the signal from the warning control unit (36) to the warning output unit (3) when the adhering matter detection unit detects the<!-- EPO <DP n="23"> --> adhering matter.</claim-text></claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>An in-vehicle apparatus according to any one of claims 1 through 5, further comprising:
<claim-text>an adhering matter removing unit engaged in operation for removing adhering matter settled on the photographic lens; and</claim-text>
<claim-text>a cleaning control unit (5) that controls the operation of the adhering matter removing unit, wherein:
<claim-text>the signal control unit (33) outputs a signal for the cleaning control unit (5) so as to engage the adhering matter removing unit in operation when the adhering matter detection unit detects the adhering matter.</claim-text></claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>An in-vehicle apparatus according to any one of claims 1 through 6, further comprising:
<claim-text>a geometric computation unit that calculates the shielded area based upon a body model and a tolerance model stored in advance.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>An in-vehicle apparatus according to any one of claims 1 through 6, further comprising:
<claim-text>a signal control unit (33) that controls output signals based upon detection results provided by the adhering matter detection unit.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16670431" load-source="patent-office"><!-- EPO <DP n="24"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="206" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="25"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="125" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="26"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="147" he="162" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="27"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="165" he="215" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="28"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="165" he="215" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="29"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="141" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="30"> --><figure id="f0007" num="7A,7B"><img id="if0007" file="imgf0007.tif" wi="161" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0009" num="9"><img id="if0009" file="imgf0009.tif" wi="165" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0010" num="10A,10B"><img id="if0010" file="imgf0010.tif" wi="158" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0011" num="11"><img id="if0011" file="imgf0011.tif" wi="165" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0012" num="12A,12B"><img id="if0012" file="imgf0012.tif" wi="165" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0013" num="13"><img id="if0013" file="imgf0013.tif" wi="165" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="37"> --><figure id="f0014" num="14"><img id="if0014" file="imgf0014.tif" wi="165" he="232" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
