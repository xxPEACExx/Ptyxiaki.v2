<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-0991019-B1" country="EP" doc-number="0991019" kind="B1" date="20140108" family-id="26858527" file-reference-id="220053" date-produced="20180823" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146589280" ucid="EP-0991019-B1"><document-id><country>EP</country><doc-number>0991019</doc-number><kind>B1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-99203024-A" is-representative="YES"><document-id mxw-id="PAPP154851472" load-source="docdb" format="epo"><country>EP</country><doc-number>99203024</doc-number><kind>A</kind><date>19990916</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140553513" ucid="US-16220598-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>16220598</doc-number><kind>A</kind><date>19980928</date></document-id></priority-claim><priority-claim mxw-id="PPC140550013" ucid="US-16223498-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>16223498</doc-number><kind>A</kind><date>19980928</date></document-id></priority-claim></priority-claims><dates-of-public-availability><intention-to-grant-date><date>20130613</date></intention-to-grant-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989328156" load-source="ipcr">G06T  11/00        20060101AFI20000114BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989620824" load-source="ipcr">H04N   1/41        20060101ALI20051220RMJP        </classification-ipcr><classification-ipcr mxw-id="PCL1989633193" load-source="ipcr">H04N   9/804       20060101AFI20051220RMJP        </classification-ipcr><classification-ipcr mxw-id="PCL1989634756" load-source="ipcr">H04N   1/60        20060101ALI20051220RMJP        </classification-ipcr><classification-ipcr mxw-id="PCL1989639817" load-source="ipcr">H04N   9/808       20060101ALI20051220RMJP        </classification-ipcr><classification-ipcr mxw-id="PCL1989643942" load-source="ipcr">H04N   1/46        20060101ALI20051220RMJP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1989645957" load-source="docdb" scheme="CPC">G06T  11/001       20130101 FI20130101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132372473" lang="DE" load-source="patent-office">Verfahren zum Manipulieren von Farbdigitalbildern</invention-title><invention-title mxw-id="PT132372474" lang="EN" load-source="patent-office">Method of applying manipulations to a color digital image</invention-title><invention-title mxw-id="PT132372475" lang="FR" load-source="patent-office">Procédé pour la manipulation des images numeriques en couleur</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919543357" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>INTELLECTUAL VENTURES FUND 83 LLC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR919516704" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>INTELLECTUAL VENTURES FUND 83 LLC</last-name></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919529669" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SPAULDING KEVIN E</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919511314" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SPAULDING, KEVIN E.</last-name></addressbook></inventor><inventor mxw-id="PPAR919027190" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Spaulding, Kevin E., Eastman Kodak Company</last-name><address><street>Patent Legal Staff, 343 State Street</street><city>Rochester, New York 14650-2201</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919514531" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>MCCARTHY ANN L</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919541339" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>MCCARTHY, ANN L.</last-name></addressbook></inventor><inventor mxw-id="PPAR919027192" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>McCarthy, Ann L., Eastman Kodak Company</last-name><address><street>Patent Legal Staff, 343 State Street</street><city>Rochester, New York 14650-2201</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919524506" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>GIORGIANNI EDWARD J</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919525085" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>GIORGIANNI, EDWARD J.</last-name></addressbook></inventor><inventor mxw-id="PPAR919027191" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>Giorgianni, Edward J., Eastman Kodak Company</last-name><address><street>Patent Legal Staff, 343 State Street</street><city>Rochester, New York 14650-2201</city><country>US</country></address></addressbook></inventor></inventors><assignees><assignee mxw-id="PPAR919027194" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Intellectual Ventures Fund 83 LLC</last-name><iid>101369511</iid><address><street>7251 W Lake Mead Boulevard Suite 300</street><city>Las Vegas, NV 89128</city><country>US</country></address></addressbook></assignee></assignees><agents><agent mxw-id="PPAR919027193" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Carpmaels &amp; Ransford</last-name><iid>101299776</iid><address><street>One Southampton Row</street><city>London WC1B 5HA</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549926760" load-source="docdb">DE</country><country mxw-id="DS549807527" load-source="docdb">FR</country><country mxw-id="DS549794599" load-source="docdb">GB</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><description mxw-id="PDES63961690" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">The present invention relates to the field of digital imaging, and more particularly to manipulating an extended color gamut digital image.</p><p id="p0002" num="0002">In digital imaging systems, there are many ways to represent images in digital form. Not only are there many different formats of digital files, but there are also a large variety of different color spaces and color encodings that can be used to specify the color of digital images.</p><p id="p0003" num="0003">In some cases, the color encoding can be in terms of a so-called device independent color space, such as the well-known CIELAB color space. In recent years this color space has been used extensively to specify the color of digital images in color-managed digital imaging systems. In some cases, the image can actually be stored in the CIELAB color space. More commonly, the color space can be used to connect device profiles, which can be used to describe the color characteristics of various color imaging devices such as scanners, printers, and CRT video displays. The <i>KODAK PhotoYCC</i> Color Interchange Space is another example of a device independent color space that can be used to encode digital images.</p><p id="p0004" num="0004">In other cases, the color-encoding can be in terms of a device dependent color space. Video RGB color spaces and CMYK color spaces are examples of this type. When a color image is encoded in a device dependent color space, it will have the desired color appearance when it is displayed on the particular output device associated with that color space. The advantage of a device dependent color space is that the image is ready to be displayed or printed on the target device. However, the disadvantage is that the image will necessarily be limited to the color gamut of the target device. The color gamut of an imaging device refers to the range of colors and luminance values that can be produced by the device. Therefore, if the target device has a limited dynamic range, or is incapable of reproducing certain saturated colors, then it is not possible to encode color values outside of the range of colors that can be produced on the device.<!-- EPO <DP n="2"> --></p><p id="p0005" num="0005">One type of device dependent color space that has become quite widespread for use as a storage and manipulation color space for digital images is the video RGB color space. In reality, there are many different video RGB color spaces due to the fact that there are many different types of video RGB displays. As a result, a particular set of video RGB color values will correspond to one color on one video display and to another color on another video display. Therefore, video RGB has historically been a somewhat ambiguous color representation due to the fact that the color values can not be properly interpreted unless the characteristics of the target video display were known. Nonetheless, video RGB color spaces have become the defacto standard in many applications because the creation, display and editing of images on video displays are central steps in many digital imaging systems.</p><p id="p0006" num="0006">Recently, there have been efforts to standardize a particular video RGB color space in order to remove the ambiguity in the interpretation of the color values. (See the proposed IEC TC100 sRGB Draft Standard). One such proposed standard color space is known as "sRGB." This color space specifies a particular set of red, green, and blue primaries, a particular whitepoint, and a particular non-linear code value to light intensity relationship. Together, these tightly define the overall relationship between the digital code values and the corresponding device independent color values.</p><p id="p0007" num="0007">Although the use of a standard video RGB color space eliminates much of the ambiguity usually associated with video RGB color spaces, it does nothing to address the fact that this color space has a limited color gamut relative to other output devices. Additionally, any output device will have a limited color gamut relative to that of an original scene. For example, a scene can have a luminance dynamic range of 1000:1 or more, whereas a typical video display or reflection print will have a dynamic range on the order of 100:1. Certain image capture devices, such as photographic negative film, can actually record dynamic ranges as large as 8000:1. Even though this is larger than the luminance dynamic range associated with most scenes, the extra dynamic range is often useful to provide allowance for exposure errors, light source variations, etc.<!-- EPO <DP n="3"> --></p><p id="p0008" num="0008">In order to encode images from various sources in a video RGB representation, it is necessary to discard information that is outside the color gamut of the video RGB color space. In some cases, such as when it is desired to encode the appearance of colors in an original scene or the colors captured by a photographic negative, a great deal of information will typically need to be discarded due to the large disparity in the dynamic ranges. For the case where it is desired to scan a reflection print and store it in a video RGB color space, it is still necessary to discard a substantial amount of information due to the mismatch in the color gamuts, even though the luminance dynamic ranges can be quite similar.</p><p id="p0009" num="0009">For example, <figref idrefs="f0001">FIG. 1</figref> shows a comparison of a typical Video RGB Color Gamut 10 and a typical Reflection Print Color Gamut 12. In this case, a*-b* cross-sections of the color gamuts are shown in the CIELAB space at an L* of 65. The colors that are inside the boundary are within the gamuts of the respective devices, while those that are outside the boundary cannot be reproduced, and are therefore referred to as "out-of-gamut" colors. It can be seen that there is a large set of color values with a b* value larger than 60 that can be produced on the printer, but are outside the color gamut of the video display. As a result, if the reflection print were scanned and stored in a video RGB color space, it would not be possible to encode this color information.</p><p id="p0010" num="0010">The mismatch between the video RGB color gamut and the color gamuts of other output devices and image sources represents a serious limitation on the usefulness of the video RGB color space. However, in many cases, the convenience of storing the image in a color space that is ready for direct display on a computer video CRT has been the over-riding factor in the determination of the preferred color space. This has come at the expense of applications that can utilize the extended color gamut information that can have existed in an input image. One of the most serious limitations of this approach involves cases where it is desired to modify the digital image. In this case, it is frequently beneficial to use the information that must be clipped off when representing the image in a video RGB color gamut to provide a better quality modified image. For example, if an image needs to be darkened due to the fact that the original image was over-exposed,<!-- EPO <DP n="4"> --> the video RGB image will generally not retain the highlight detail information that could be used to darken the image.</p><p id="p0011" num="0011">It is an object of the present invention to overcome the limitations of the prior art by providing for the modification of digital images stored in a color space having a limited color gamut by retaining extended color gamut information.</p><p id="p0012" num="0012">This object is achieved in a method for modifying a digital image having color values with an extended color gamut comprising the steps of:
<ol><li>a) representing the extended color gamut digital image with a limited color gamut digital image and one or more associated residual image(s) representing a difference between the extended color gamut digital image and the limited color gamut digital image;</li><li>b) specifying one or more desired image modification(s) to be applied to the extended color gamut digital image; and</li><li>c) modifying the limited color gamut digital image and the residual image(s) to form a modified limited color gamut digital image and one or more modified residual image(s) in response to the specified desired image modification(s).</li></ol></p><p id="p0013" num="0013">The present invention has the advantage that a digital image can be stored in a color space convenient for a particular application while overcoming the color gamut limitation associated with that color space.</p><p id="p0014" num="0014">It has the additional advantage that the use of the extended color gamut information is optional. As a result, the benefits of the extended color gamut information can be gained by applications that are able to make use of it, without introducing an image quality or computation penalty for applications that do not require the optional information or that are not able to make use of it.</p><p id="p0015" num="0015">It has the additional advantage that the extended color gamut information can be used to modify the image so as to provide a larger amount of adjustibility in the image modification process.</p><p id="p0016" num="0016">The image can be stored, for example, in a video RGB color space that is well-adapted for fast and convenient display on a computer system without compromising the potential quality of the image. This provides a particular<!-- EPO <DP n="5"> --> advantage during the process of applying many types of modifications to the digital image.
<ul><li><figref idrefs="f0001">FIG. 1</figref> is graph comparing the color gamuts of a typical video display, and a typical reflection print;</li><li><figref idrefs="f0002">FIG. 2</figref> is a flowchart showing a process for making a limited gamut digital image in accordance with the present invention; and</li><li><figref idrefs="f0003">FIG. 3</figref> is a flowchart showing a second process for making a limited gamut digital image in accordance with the present invention;</li><li><figref idrefs="f0004">FIG. 4</figref> is a flowchart showing the reconstruction of a extended gamut digital image from the limited digital image of <figref idrefs="f0002">FIG. 2</figref>;</li><li><figref idrefs="f0005">FIG. 5</figref> is a flowchart showing the modification of the limited color gamut digital image and the residual image(s) in accordance with the present invention;</li><li><figref idrefs="f0006">FIG. 6</figref> is a flowchart showing the modification of the extended color gamut digital image in accordance with the present invention;</li><li><figref idrefs="f0007">FIG. 7</figref> is a flowchart showing the storing of information about desirable image modification(s) in accordance with the present invention.</li></ul></p><p id="p0017" num="0017">One method for storing a digital image in accordance with the present invention is shown in <figref idrefs="f0002">FIG.2</figref>. An extended color gamut digital image 20 has color values that are outside the limited color gamut of a storage color space. An adjust color values step 21 is used to limit the color values to those that will fit within the limited color gamut of the storage color space to form a limited color gamut digital image 22. Next, a represent image in storage color space step 23 is used to produce a storage space digital image 24. A compute residual image(s) step 25 is used to determine one or more residual image(s) 26 representing the difference between the extended color gamut digital image and the limited color gamut digital image. The storage space digital image 24 and the residual image(s) 26 are then stored in a digital file 28 using a digital file storage step 27.</p><p id="p0018" num="0018">A key aspect of the present invention is the creation and use of the residual image(s) 26 representing the difference between the extended color gamut digital image and the limited color gamut digital image. Other prior art systems<!-- EPO <DP n="6"> --> include the computation of a residual image, but none involve computing a difference between an extended color gamut digital image and a limited color gamut digital image. <patcit id="pcit0001" dnum="US4903317A"><text>Nishihara et al. (U.S. Patent 4,903,317</text></patcit>) describe the computation of a residual image determined from the difference between an original image, and an image that has been compressed using a lossy data compression technique and subsequently decompressed. The residual image represents the compression artifacts that are introduced during the compression/decompression process. <patcit id="pcit0002" dnum="US5122873A"><text>Golin (U.S. Patent 5,122,873</text></patcit>) also describes a method for encoding images using a residual image. In this case, the residual image relates to the difference between images of different spatial resolution. It is also known that a residual image can be computed between a high-precision digital image, and a low-precision digital image. In each of these cases, the images being differenced have identical color gamuts and color spaces. As a result, none of these prior art configurations would support the storage of extended color gamut information as required in the present invention.</p><p id="p0019" num="0019">Each of the steps in <figref idrefs="f0002">FIG. 2</figref> will now be discussed in more detail. The extended color gamut digital image 20 can take many different forms. For example, the image can be a scanned photographic print, a scanned photographic negative, a scanned photographic transparency, or an image from a digital camera, etc. Depending on the source of the image, as well as any image processing that has been applied to the image, the image can have very different color gamuts and color representations. Images from scanned photographic negatives and digital cameras can contain scene information having a much larger luminance dynamic range than can be encoded in many storage color spaces. In this case, luminance dynamic range is simply one aspect of color gamut related to the range of luminance values that can be represented.</p><p id="p0020" num="0020">The color gamut of an imaging system is the range of colors that can be represented or produced. Since color is fundamentally a three-dimensional phenomenon, color gamuts can be viewed as a three-dimensional volume. Color values that are within the volume are said to be "in-gamut," whereas colors that are outside the volume are said to be "out-of-gamut." One aspect of the color<!-- EPO <DP n="7"> --> gamut is the luminance dynamic range of the system. This is the range of relative luminance values that can be encoded by the system from the whitest white to the blackest black. Another aspect of the color gamut is the range of chroma values that can be represented from a neutral out to a saturated color. The range of chroma values that are in-gamut will generally be a function of hue and lightness. Generally, the highest chroma colors can be produced near the hue and lightness of the primary and secondary colors of a given imaging device or color space (usually red, green, blue, cyan, magenta and yellow).</p><p id="p0021" num="0021">If the image were a scanned photographic print, the color gamut of the image would generally be the color gamut of the original photographic print medium. Likewise if the image were captured by a digital camera, the color gamut of the image would generally be that of an original scene, although it can be limited by the dynamic range of the camera sensor and by lens flare. The color space that the image is represented in is somewhat independent of the color gamut of the original image. For example, the color values for a scanned photograph can be represented as raw scanner code values, or they can be given by device independent color values according to a color space such as the CIELAB color space. Alternatively, the color values can be expressed in some other color space.</p><p id="p0022" num="0022">For many applications, it is convenient to store, display and manipulate the digital image in a particular storage color space that is well-suited for the work flow associated with that application. Frequently, the storage color space that is chosen will be a device dependent color space associated with a common output device or medium used by the system. In many cases, video RGB color spaces are used because they can be displayed or previewed directly on a computer video display without any further processing. Additionally, many software applications that are available to manipulate images on a computer are designed to work with images in a video RGB color space. The color gamut of the storage color space will often be smaller than, or at least different than, the color gamut of the extended color gamut digital image 20. As a result, there generally will be colors in the extended color gamut digital image 20 that can not be represented in the storage color space. For example, consider the case where the<!-- EPO <DP n="8"> --> extended color gamut digital image 20 is a scanned photographic print. There are many colors within the color gamut of the reflection print that are outside the color gamut of the video RGB color space. This can clearly be seen in <figref idrefs="f0001">FIG. 1</figref> which shows cross-sections through a typical Video RGB Color Gamut 10, and a typical Reflection Print Color Gamut 12.</p><p id="p0023" num="0023">Therefore, information must be discarded in order to store the reflection print color values in a video RGB color space, or any other limited color gamut storage space. In prior art methods, the information that is discarded is lost permanently and can not be recovered. In the present invention, the information that is lost will be stored in one or more residual image(s).</p><p id="p0024" num="0024">The adjust color values step 21 is used to adjust the color values of the extended color gamut digital image to fit within the limited color gamut of the storage space, forming a limited color gamut digital image 22. In this step, information must be discarded when color values that are outside the limited color gamut are mapped to color values within the limited color gamut. In some cases, the color values for the out-of-gamut colors are simply "clipped," i.e., they are mapped to color values the surface of the limited color gamut. In other cases, more sophisticated gamut mapping methods can be used to compress the extended color gamut into the limited color gamut without introducing a hard clipping function. For example, the chroma of the input color values can be scaled so that the most saturated colors in the extended color gamut are mapped to the most saturated colors in the limited color gamut. Alternatively, a gamut mapping method can be used that is designed to preserve color appearance as closely as possible. Regardless of what gamut mapping technique is used, there will necessarily be a loss of information and a distortion of the color characteristics of the image.</p><p id="p0025" num="0025">In many cases, the extended color gamut will contain color values that have higher chroma values than can be represented in the limited color gamut. In some cases, the extended color gamut can also have a larger luminance dynamic range than can be represented in the limited color gamut. In the case where it is necessary to reduce the luminance dynamic range of the image, one part in the<!-- EPO <DP n="9"> --> implementation of the adjust color values step 21 is typically the application of a tone scale function. The tone scale function maps the input image intensities to output image intensities and might be applied to a luminance channel of the image, or alternatively to each color channel of an RGB color representation. In some applications, the image being processed can actually be a monochrome image, e.g., a black-and-white image. In this case, the tonescale function can be applied to the monochrome image luminance values.</p><p id="p0026" num="0026">For cases where the extended color gamut digital image is a representation of the colors in an original scene, the adjust color values step 21 will typically involve determining reproduced color values that will produce desired aim colors on a target output device. For example, optimal color reproduction aims can be applied to determine desired video RGB aim colors for the original scene colors. The process of transforming the original scene color values into aim reproduced color values is sometimes referred to as "rendering" the image.</p><p id="p0027" num="0027">Once the limited color gamut digital image 22 has been determined, the next step is to represent it in the storage color space using the represent image in storage color space step 23. The output of this step is a storage space digital image 24. This step typically involves applying a device model, or a color space conversion, to determine the storage space color values that correspond to the adjusted color values of the limited color gamut digital image 22. For example, if the adjusted color values were specified in terms of the CIELAB color space, a video display device model can be used to determine the corresponding video RGB values that would be necessary to produce the specified adjusted color values.</p><p id="p0028" num="0028">A compute residual image(s) step 25 is used to determine one or more residual image(s) 26 representing the difference between the extended color gamut digital image 20 and the limited color gamut digital image 22. In its simplest form, a single residual image 26 can be calculated by simply subtracting the adjusted color values of the limited color gamut digital image 22 from the input color values of the extended color gamut digital image 20. The residual<!-- EPO <DP n="10"> --> image would then be in terms of the color space used to represent those color values. Alternatively, the color values can be transformed into some other space that would be useful for computing the residual image. For example, it might be desirable to compute the residual image in a color space that is well-suited for compressing the residual image or that is convenient for use in reconstructing the extended color gamut digital image.</p><p id="p0029" num="0029">There are several reasons why it may be advantageous to store multiple residual images instead of just a single residual image. For example, it might be desirable to store residual errors associated with luminance errors in one residual image, and residual errors associated with chrominance errors in additional residual images. This would enable an application to make a choice about which types of residual errors it would use during the process of determining a reconstructed extended color gamut digital image.</p><p id="p0030" num="0030">In another case, a set of multiple residual images can correspond to different subsets of extended dynamic range image data. For example, a first residual image can extend the dynamic range of the digital image some fixed amount beyond the dynamic range associated with the limited color gamut digital image. A second residual image can then extend the dynamic range an additional increment beyond the extended dynamic range associated with the first residual image. In this way, an application using the extended color gamut digital image can use only the residual image(s) associated with the amount of extended dynamic range required by the application.</p><p id="p0031" num="0031">Another reason that using multiple residual images is useful is for cases where the residual images are stored in tags in the digital file having a limited size. In this case, the residual image data can be broken into smaller pieces that would fit within the size limitations. For example, residual images can be determined for subsets of pixels in the extended color gamut digital image. In this way, the residual image data can be stored in a tiled fashion.</p><p id="p0032" num="0032">Generally, the extended color gamut digital image and the limited color gamut digital image 22 should be represented in the same color space before<!-- EPO <DP n="11"> --> the residual image(s) are calculated so that the in-gamut colors will be given by zero residual errors. Since most images will only have a small fraction of color values that are out of gamut, the residual image(s) will be dominated by zeros, and therefore will be highly compressible.</p><p id="p0033" num="0033">For the remainder of this disclosure, the case of a single residual image will be described. However, it should be recognized that the method can be easily generalized to use a set of multiple residual images.</p><p id="p0034" num="0034">For cases where the adjust color values step 21 involves the application of a transform that modifies the color values for the colors within the limited color gamut as well as those outside the limited color gamut, the residual image is determined by directly computing the difference between the input color values of the extended color gamut digital image and the adjusted color values of the limited color gamut digital image 22 would have a large number of non-zero values. This can be undesirable for cases where the residual image is to be compressed. The prior example where the extended color gamut digital image is a representation of the original scene, and the adjust color values step 21 includes rendering the color values to determine desirable color values for a target output device, will generally suffer from this problem. In this case, it may be desirable to apply a second rendering function to the extended color gamut digital image to determine a second set of rendered color values that are desirable for another output device having a larger color gamut than the first target output device. If the second rendering function were identical to the first rendering function throughout most of the color gamut, then a residual image computed by taking the difference between the first and second rendered images would again be largely dominated by zero differences. In one preferred embodiment of the present invention, the first rendering function can produce a rendered image that is optimized for a video display, and the second rendering function can produce a rendered image that is optimized for some hypothetical output device having an idealized large color gamut.</p><p id="p0035" num="0035">Once the residual image 26 has been calculated, it should be associated in some fashion with the storage space digital image 24. This can<!-- EPO <DP n="12"> --> involve storing the residual image 26 in a memory buffer that is associated with a second memory buffer used to store the storage space digital image 24. Alternatively, many applications will store the image data in a digital file 28 on some sort of digital storage media such as a magnetic disk, an optical disk, or a PCMCIA card using a digital file storage step 27. In this case, the storage space digital image 24 and the residual image 26 can be stored in two different files, or can be stored in the same digital image file. In many cases, the file format used to store the storage space digital image 24 may support the use of private image tags. For example, the file formats TIFF, EXIF and FlashPIX all support tags of this sort. These tags are sometimes referred to as meta-data. In cases where file formats of this type are used, it will be convenient to store the residual image data in the form of a residual image tag. In this way, applications that do not know how to make use of the residual image tag will simply ignore it, and will therefore have access only to the storage space digital image 24. Whereas applications that know how to use the residual image tag will be able to make use of it to reconstruct the extended color gamut digital image. Some file formats place a limit on the size of tags, so compression of the residual image is important for these applications.</p><p id="p0036" num="0036">A second method of storing a digital image in accordance with the present invention is shown in <figref idrefs="f0003">FIG. 3</figref>. This embodiment is similar to that shown in <figref idrefs="f0002">FIG. 2</figref> but differs in the way that the residual image is determined. In this second embodiment, the residual image is represented relative to the code values of the storage color space. <figref idrefs="f0003">FIG. 3</figref> shows an extended color gamut digital image 30, having color values that are outside the limited color gamut of a storage color space. An adjust color values step 31 is used to limit the color values to those that will fit within the limited color gamut of the storage color space. Next, a represent image in storage color space step 32 is used to produce a limited color gamut digital image 33. A represent image in extended storage color space step 34 is then applied to the original image, and a compute residual image step 35 is used to determine a residual image 36 representing the difference between the extended color gamut digital image and the limited color gamut digital image, both being<!-- EPO <DP n="13"> --> encoded according to the storage color space. The limited color gamut digital image 33 and the residual image 36 are then stored in a digital file 38 using a digital file storage step 37.</p><p id="p0037" num="0037">Since most of the steps in this second method are identical to the corresponding steps in the first method, only the steps that differ will be discussed in more detail. The primary difference between the two methods is that the residual image is computed relative to the storage color space color values in this case. Therefore, the original extended color gamut digital image must be transformed to the storage color space in addition to the limited color gamut digital image. This is accomplished by the represent image in extended storage color space step 34. The complication is that the storage color space will typically only have a limited color gamut. For example, if the storage color space is a video RGB color space, then the color gamut of the storage space can be limited to the color gamut of the video display. Therefore, to represent the original extended color gamut digital image in the storage color space, it is necessary to define an extended version of the storage color space that does not impose the limited color gamut. For example, 24-bit video RGB color spaces usually encode the color values in terms of integer code values in the range of 0 to 255. In order to allow the encoding of colors outside the color gamut of the video display, the original extended color gamut digital image can be represented in an extended storage space where the code values were allowed to go outside the range 0 to 255. This would permit the encoding of colors with higher chroma values, as well as larger luminance dynamic range values, than can be encoded directly in the storage color space. After both the limited color gamut digital image and the extended color gamut digital image had been represented in terms of the storage color space, the residual image 36 is then calculated as before by computing a difference between the two images.</p><p id="p0038" num="0038">The result of applying the method of the present invention is the creation of both a limited color gamut digital image in a storage color space and an associated residual image which correlates the limited color gamut digital image to an extended color gamut digital image. As discussed previously, the limited color<!-- EPO <DP n="14"> --> gamut digital image is generally well suited for display on a target output device such as a video display. One advantage of this approach is that systems that cannot make use of the residual image will be able to display and manipulate this image directly with no image quality or computation disadvantage relative to the prior art where only the limited color gamut digital image is stored. However, the information that normally would have been discarded has now been stored in the residual image and is available for use by systems that can utilize it. In this case, the limited color gamut digital image is extracted and the residual image from the digital file is used to form a reconstructed extended color gamut digital image.</p><p id="p0039" num="0039"><figref idrefs="f0004">FIG. 4</figref> shows an example of reconstructing an extended color gamut digital image from the limited color gamut digital image and the residual image. The input to this process is an extended color gamut digital file 40 containing a limited color gamut digital image and a residual image created as described above. An extract data from digital file step 41 is used to extract the limited color gamut digital image 42 and the residual image 43. A reconstruct extended color gamut digital image step 44 is then used to form a reconstructed extended color gamut digital image 45 by combining the limited color gamut digital image 42 and the residual image 43. Typically the reconstruct extended color gamut digital image step 44 will involve combining the limited color gamut digital image 42 and the residual image 43.</p><p id="p0040" num="0040">The reconstructed extended color gamut digital image can be used for many different purposes. For example, it can be used to form a digital image appropriate for display on an output device having a color gamut different from the limited color gamut of the limited color gamut digital image 42 in the digital file 40. This enables the generation of an optimal print from the original extended color gamut digital image, rather than a print limited by constraints of the storage color space.</p><p id="p0041" num="0041">The information in the extended color gamut is particularly useful during the process of applying a modification to the digital image. Consider <figref idrefs="f0005">FIG. 5</figref> which shows one method for modifying an extended color gamut digital image in accordance with the present invention. The input to this process is an<!-- EPO <DP n="15"> --> extended color gamut digital file 40 containing a limited color gamut digital image and a residual image created as described above. As in <figref idrefs="f0004">FIG. 4</figref>, an extract data from digital file step 41 is used to extract the limited color gamut digital image 42 and the residual image 43. One or more desired image modification(s) 50 are then specified to be used to modify the image. The limited color gamut digital image 42 is then modified using a modify limited color gamut digital image step 51 in response to the desired image modification(s) 50 to form a modified limited color gamut digital image 53. Likewise, the residual image 43 is modified using a modify residual image step 52 in response to the desired image modification(s) 50 to form a modified residual image 54. The modified limited color gamut digital image 53 and the modified residual image 54 taken together represent a modified extended color gamut digital image which can be stored in a modified digital file 55. Alternatively, the modified digital image can be used to produce an image on a digital printer, or some other form of image display device. The modified digital image can also be transmitted to a remote location for storage or printing at that location. Methods for transmitting the modified digital image can include the use of a computer network connection, or a modem connected to a telephone line.</p><p id="p0042" num="0042">There are many different types of desired image modification(s) 50 that can be applied to the digital image. For example, there are many kinds of color and tone reproduction modifications that can be applied to an image. In some cases it will be desirable to adjust the color balance of the image. In other cases it will be desirable to adjust the density of the image so as to produce a darker image or a lighter image. Other types of color and tone reproduction modifications can include changes in the contrast, hue or colorfulness of the image. In some cases, it will also be desirable to modify the color and tone reproduction characteristics to optimize them for a specific output device. The present invention is particularly well-suited to making modifications to the color and tone reproduction characteristics of the image due to the fact that the extended color gamut information stored in the residual image will enable larger changes to be made without any degradation in quality. For example, consider the case where an original image is determined to be over-exposed. In this case, highlight<!-- EPO <DP n="16"> --> information in the limited color gamut digital image would have been clipped off during the process of rendering the image to the limited color gamut. However, this highlight information would be retained in the residual image. If it were desired to darken the image to correct for the over-exposure error, the information in the residual can then be used to determine a modified digital image that recovers the highlight detail.</p><p id="p0043" num="0043">Other types of image modifications that can be applied to a digital image include spatial image modifications. Examples of spatial image modifications include zooming, cropping, noise reduction, and sharpening the image. Zooming an image involves a resizing of the image. Cropping an image involves selecting a subset of an image. A noise reduction process generally involves reducing the appearance of image grain or noise by smoothing the image in flat areas of the image. Sharpening an image typically involves applying a spatial convolution to the image to increase the apparent sharpness of edges in the image. There are many other types of image modifications such as those found in common image editing software programs such as the widely used Adobe PhotoShop.</p><p id="p0044" num="0044">In some cases a single image modification could be desired, whereas in other cases, it may be desirable to apply several modifications to the image. For example, it might be desirable to darken the image, crop out a subset of the image, and then sharpen the image. Depending on the type of modifications that are desired, it is possible to apply the modification(s) simultaneously, or it may be necessary to apply them sequentially.</p><p id="p0045" num="0045">Modifications to the digital image can be interactively user specified, such as in the case of a user adjustable lightness knob. In this case, a preview of the image is generally displayed on a video display, and a user interface is provided to permit the user to specify his/her desired modification(s). Image modifications can also be determined by applying an automatic algorithm to the digital image. For example, a "scene balance algorithm" can be used to estimate the best color balance and density level for an image. Alternatively, an automatic<!-- EPO <DP n="17"> --> sharpening algorithm can be used to estimate the optimal amount of sharpening for an image.</p><p id="p0046" num="0046">In some cases, only the limited color gamut digital image may be available during the step of specifying the desirable image modification(s). For example, consider the case where the limited color gamut digital image is in a video RGB color space that is appropriate for display on a computer's video monitor. Certain software applications are designed to manipulate this video RGB image using an interactive user interface. The user interface can enable the user to control a color balance slidebar to determine the preferred color balance position. In this case, once the preferred color balance position were determined, this information can then be used to modify the extended color gamut digital image as described above. Similarly, the user can interactively determine desired zooming and cropping parameters based on the limited color gamut digital image and these changes can then be applied to the extended color gamut digital image. In some cases, even automatic algorithms that can be used to estimate the optimal image modification(s) can be designed to operate on a limited color gamut digital image. For example, a scene balance algorithm can be applied to a limited color gamut digital image, and the resulting image modification(s) can then be applied to the extended color gamut digital image. Even if the limited color gamut digital image is not stored in the color space used to preview the image, it may be necessary or convenient to provide a user interface where the desired image modification(s) can be determined by manipulating a preview image which is determined from the limited color gamut digital image.</p><p id="p0047" num="0047">Another embodiment of the present invention is shown in <figref idrefs="f0006">FIG. 6</figref>. In this case, a limited color gamut digital image 42 and a residual image 43 are used to form a reconstructed extended gamut digital image 45 as was described above with reference to <figref idrefs="f0004">FIG. 4</figref>. Desired image modification(s) 61 are then used to form a modified extended color gamut digital image 62 using a modify reconstructed extended color gamut digital image step 60. The modified extended color gamut digital image 62 can then be used to determine a modified limited color gamut digital image 63 and a modified residual image 64 using the same<!-- EPO <DP n="18"> --> methods that were described above. The modified limited color gamut digital image 63 and the modified residual image 64 can then be optionally stored in a modified digital file 65. This method differs from that shown in <figref idrefs="f0005">FIG. 5</figref> in that the desired image modification(s) are applied to the reconstructed extended gamut digital image 60 rather than independently to the uncombined limited color gamut digital image 42 and residual image 43. In cases where complex image modification such as sharpening or color/tone adjustments are desired, it will be more convenient in many cases to use this approach. In other cases, such as for zoom and crop operations, it would not be necessary to go through the extra steps involved with forming the reconstructed image.</p><p id="p0048" num="0048">Yet another embodiment of the present invention is shown in <figref idrefs="f0007">FIG. 7</figref>. A limited color gamut digital image 42 and a residual image 43 are extracted from a digital file 40 using an extract data from digital file step 41 as was describe in reference to <figref idrefs="f0004">FIG. 4</figref>. In this case, one or more desired image modification(s) 70 are applied to the limited color gamut digital image 42 using a modify limited color gamut digital image step 71 to form a modified limited color gamut digital image 72. An optional preview modified image step 73 will be useful in many cases so that a user can decide whether the optimal modification(s) were applied to the image. Once the optimal desired image modification(s) 70 have been determined, information about the modification(s) 74 is then added to the input digital file 40 to form a modified digital file 75. For example, the information about the modification(s) 74 might include a list of the operations that were applied to the image, or a set of parameters describing the net effect of the modification(s). One case where this approach will be useful is when it is desired to preserve the original image in an unmodified form as long as possible. In another case of interest the digital file may exist at a remote site, and only a low-resolution version of the limited color gamut digital image can be downloaded to a local workstation that is used to determine the image modification(s). It would only be necessary to send the information about the modification(s) 74 back to the remote site, rather than a modified high resolution image. In this case, it may be<!-- EPO <DP n="19"> --> desirable to transmit a low-resolution version of the residual image to the local site as well for use in previewing the image modification(s).</p><p id="p0049" num="0049">A computer program product having a computer readable storage medium can have a computer program stored thereon for performing all the steps of the present invention.</p><p id="p0050" num="0050">The computer readable storage medium can comprise, for example; magnetic storage media such as magnetic disc (such as a floppy disc) or magnetic tape; optical storage media such as optical disk, optical tape, or machine readable bar code; solid state electronic storage devices such as random access memory (RAM), or read only memory (ROM); or any other physical device or medium employed to store a computer program.<!-- EPO <DP n="20"> --></p><heading id="h0001"><b>PARTS LIST</b></heading><p id="p0051" num="0051"><dl id="dl0001" compact="compact"><dt>10</dt><dd>video RGB color gamut</dd><dt>12</dt><dd>reflection print color gamut</dd><dt>20</dt><dd>extended color gamut digital image</dd><dt>21</dt><dd>adjust color values</dd><dt>22</dt><dd>limited color gamut digital image</dd><dt>23</dt><dd>represent image in storage color space</dd><dt>24</dt><dd>storage space digital image</dd><dt>25</dt><dd>compute residual image</dd><dt>26</dt><dd>residual image</dd><dt>27</dt><dd>digital file storage</dd><dt>28</dt><dd>digital file</dd><dt>30</dt><dd>extended color gamut digital image</dd><dt>31</dt><dd>adjust color values</dd><dt>32</dt><dd>represent image in storage color space</dd><dt>33</dt><dd>limited color gamut digital image</dd><dt>34</dt><dd>represent image in extended storage color space</dd><dt>35</dt><dd>compute residual image</dd><dt>36</dt><dd>residual image</dd><dt>37</dt><dd>digital file storage</dd><dt>38</dt><dd>digital file</dd><dt>40</dt><dd>digital file</dd><dt>41</dt><dd>extract data from digital file</dd><dt>42</dt><dd>limited color gamut digital image</dd><dt>43</dt><dd>residual image</dd><dt>44</dt><dd>reconstruct extended color gamut digital image</dd><dt>45</dt><dd>reconstructed extended color gamut digital image</dd><dt>50</dt><dd>desired image modification(s)</dd><dt>51</dt><dd>modify limited color gamut digital image</dd><dt>52</dt><dd>modify residual image<!-- EPO <DP n="21"> --></dd><dt>53</dt><dd>modified limited color gamut digital image</dd><dt>54</dt><dd>modified residual image</dd><dt>55</dt><dd>modified digital file</dd><dt>60</dt><dd>modify extended color gamut digital image</dd><dt>61</dt><dd>desired image modification(s)</dd><dt>62</dt><dd>modified extended color gamut digital image</dd><dt>63</dt><dd>modified limited color gamut digital image</dd><dt>64</dt><dd>modified residual image</dd><dt>65</dt><dd>modified digital file</dd><dt>70</dt><dd>desired image modification(s)</dd><dt>71</dt><dd>modify limited color gamut digital image</dd><dt>72</dt><dd>modified limited color gamut digital image</dd><dt>73</dt><dd>preview modified image</dd><dt>74</dt><dd>information about modification(s)</dd><dt>75</dt><dd>modified digital file</dd></dl></p></description><claims mxw-id="PCLM56987810" lang="DE" load-source="patent-office"><!-- EPO <DP n="23"> --><claim id="c-de-01-0001" num="0001"><claim-text>Verfahren zur Darstellung eines Digitalbildes mit erweiterter Farbskala in einem Speicherfarbraum mit begrenzter Farbskala, mit den folgenden Schritten:
<claim-text>a) Einstellen der Farbwerte des Digitalbildes mit erweiterter Farbskala, so dass es in die begrenzte Farbskala passt, um ein Digitalbild mit begrenzter Farbskala zu bilden;</claim-text>
<claim-text>b) Darstellen des Digitalbildes mit begrenzter Farbskala im Speicherfarbraum;</claim-text>
<claim-text>c) Bestimmen eines Restbildes oder mehrerer Restbilder, das bzw. die Differenzen zwischen dem Digitalbild mit erweiterter Farbskala und dem Digitalbild mit begrenzter Farbskala darstellt bzw. darstellen; und</claim-text>
<claim-text>d) Verknüpfen des einen Restbildes oder der mehreren Restbilder mit dem Digitalbild mit begrenzter Farbskala im Speicherfarbraum, so dass der verknüpfte Satz von Restbildern und dem Digitalbild mit begrenzter Farbskala dazu ausgebildet ist, verwendet zu werden, um ein rekonstruiertes Digitalbild mit erweiterter Farbskala zu bilden.</claim-text><!-- EPO <DP n="24"> --></claim-text></claim><claim id="c-de-01-0002" num="0002"><claim-text>Verfahren nach Anspruch 1, des Weiteren mit dem Schritt des Verwendens eines Restbildes oder mehrerer Restbilder aus dem Satz von Restbildern zusammen mit dem Digitalbild mit begrenzter Farbskala, um ein rekonstruiertes Digitalbild mit erweiterter Farbskala zu bilden.</claim-text></claim><claim id="c-de-01-0003" num="0003"><claim-text>Computerlesbares Medium mit einem darauf gespeicherten Computerprogramm, das bei Ausführung einen Prozessor veranlasst, ein Verfahren nach Anspruch 1 oder Anspruch 2 auszuführen.</claim-text></claim></claims><claims mxw-id="PCLM56987811" lang="EN" load-source="patent-office"><!-- EPO <DP n="22"> --><claim id="c-en-01-0001" num="0001"><claim-text>A method for representing a digital image with an extended color gamut in a storage color space having a limited color gamut comprising the steps of:
<claim-text>a) adjusting the color values of the extended color gamut digital image to fit within the limited color gamut to form a limited color gamut digital image;</claim-text>
<claim-text>b) representing the limited color gamut digital image in the storage color space;</claim-text>
<claim-text>c) determining one or more residual images representing differences between the extended color gamut digital image and the limited color gamut digital image; and</claim-text>
<claim-text>d) associating the one or more residual image(s) with the limited color gamut digital image in the storage color space such that the associated set of residual images and the limited color gamut digital image is adapted to be used to form a reconstructed extended color gamut digital image.</claim-text></claim-text></claim><claim id="c-en-01-0002" num="0002"><claim-text>The method of claim I further including the step of using one or more residual images from the set of residual images together with the limited color gamut digital image to form a reconstructed extended color gamut digital image.</claim-text></claim><claim id="c-en-01-0003" num="0003"><claim-text>A computer readable medium having a computer program stored thereon which when executed causes a processor to carry out a method according to claim 1 or claim 2.</claim-text></claim></claims><claims mxw-id="PCLM56987812" lang="FR" load-source="patent-office"><!-- EPO <DP n="25"> --><claim id="c-fr-01-0001" num="0001"><claim-text>Procédé de représentation d'une image numérique avec une gamme de couleurs étendue dans un espace de couleurs de stockage ayant une gamme de couleurs limitée, comprenant les étapes consistant à :
<claim-text>a) ajuster les valeurs de couleur de l'image numérique à gamme de couleurs étendue pour qu'elles s'inscrivent dans la gamme de couleurs limitée afin de former une image numérique à gamme de couleurs limitée ;</claim-text>
<claim-text>b) représenter l'image numérique à gamme de couleurs limitée dans l'espace de couleurs de stockage ;</claim-text>
<claim-text>c) déterminer une ou plusieurs images résiduelles représentant des différences entre l'image numérique à gamme de couleurs étendue et l'image numérique à gamme de couleurs limitée ; et</claim-text>
<claim-text>d) associer la ou les images résiduelles à l'image numérique à gamme de couleurs limitée dans l'espace de couleurs de stockage de telle sorte que l'ensemble associé d'images résiduelles et l'image numérique à gamme de couleurs limitée soient adaptés pour être utilisés afin de former une image numérique à gamme de couleurs étendue reconstruite.</claim-text></claim-text></claim><claim id="c-fr-01-0002" num="0002"><claim-text>Procédé selon la revendication 1 comprenant en outre l'étape consistant à utiliser une ou plusieurs images résiduelles de l'ensemble d'images résiduelles avec l'image numérique à gamme de couleurs limitée pour former une image numérique à gamme de couleurs étendue reconstruite.<!-- EPO <DP n="26"> --></claim-text></claim><claim id="c-fr-01-0003" num="0003"><claim-text>Support lisible par ordinateur avec, stocké sur celui-ci, un programme informatique qui, à l'exécution, amène un processeur à mettre en oeuvre un procédé selon la revendication 1 ou la revendication 2.</claim-text></claim></claims><drawings mxw-id="PDW16672858" load-source="patent-office"><!-- EPO <DP n="27"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="127" he="138" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="28"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="163" he="230" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="29"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="164" he="228" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="30"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="157" he="172" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="159" he="201" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="165" he="223" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0007" num="7"><img id="if0007" file="imgf0007.tif" wi="165" he="184" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
