<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-1787494-B1" country="EP" doc-number="1787494" kind="B1" date="20140108" family-id="33104867" file-reference-id="318237" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146589029" ucid="EP-1787494-B1"><document-id><country>EP</country><doc-number>1787494</doc-number><kind>B1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-05775825-A" is-representative="NO"><document-id mxw-id="PAPP154851221" load-source="docdb" format="epo"><country>EP</country><doc-number>05775825</doc-number><kind>A</kind><date>20050901</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140550871" ucid="GB-0419346-A" load-source="docdb"><document-id format="epo"><country>GB</country><doc-number>0419346</doc-number><kind>A</kind><date>20040901</date></document-id></priority-claim><priority-claim mxw-id="PPC140547258" ucid="GB-2005003372-W" load-source="docdb"><document-id format="epo"><country>GB</country><doc-number>2005003372</doc-number><kind>W</kind><date>20050901</date></document-id></priority-claim></priority-claims><dates-of-public-availability><intention-to-grant-date><date>20130726</date></intention-to-grant-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989327397" load-source="ipcr">H04S   3/00        20060101ALI20070320BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989327398" load-source="ipcr">H04S   1/00        20060101AFI20070320BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989639264" load-source="ipcr">H04S   7/00        20060101A I20070721RMEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1989619935" load-source="docdb" scheme="CPC">H04S   3/004       20130101 LA20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989625549" load-source="docdb" scheme="CPC">H04S2400/01        20130101 LA20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989636875" load-source="docdb" scheme="CPC">H04S   7/304       20130101 FI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989647866" load-source="docdb" scheme="CPC">H04S2420/01        20130101 LA20130101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132371720" lang="DE" load-source="patent-office">PERSONALISIERTE KOPFHÃ–RERVIRTUALISIERUNG</invention-title><invention-title mxw-id="PT132371721" lang="EN" load-source="patent-office">PERSONALIZED HEADPHONE VIRTUALIZATION</invention-title><invention-title mxw-id="PT132371722" lang="FR" load-source="patent-office">VIRTUALISATION D'ECOUTEURS PERSONNALISEE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919533436" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SMYTH RES LLC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR919536241" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SMYTH RESEARCH LLC</last-name></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919539866" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SMYTH STEPHEN MALCOLM</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919519184" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SMYTH, STEPHEN, MALCOLM</last-name></addressbook></inventor><inventor mxw-id="PPAR919025967" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SMYTH, STEPHEN, MALCOLM</last-name><address><street>172 Bangor Road</street><city>Newtownards BT23 7PH</city><country>GB</country></address></addressbook></inventor></inventors><assignees><assignee mxw-id="PPAR919025969" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Smyth Research LLC</last-name><iid>100953714</iid><address><street>1270 Avendia Acaso, Unit A</street><city>Camarillo, CA 93012</city><country>US</country></address></addressbook></assignee></assignees><agents><agent mxw-id="PPAR919025968" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Round, Edward Mark</last-name><iid>100042082</iid><address><street>Marks &amp; Clerk LLP 90 Long Acre</street><city>London WC2E 9RA</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="GB-2005003372-W"><document-id><country>GB</country><doc-number>2005003372</doc-number><kind>W</kind><date>20050901</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2006024850-A2"><document-id><country>WO</country><doc-number>2006024850</doc-number><kind>A2</kind><date>20060309</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549883734" load-source="docdb">AT</country><country mxw-id="DS549792929" load-source="docdb">BE</country><country mxw-id="DS549806960" load-source="docdb">BG</country><country mxw-id="DS549926201" load-source="docdb">CH</country><country mxw-id="DS549875122" load-source="docdb">CY</country><country mxw-id="DS549883735" load-source="docdb">CZ</country><country mxw-id="DS549792930" load-source="docdb">DE</country><country mxw-id="DS549875123" load-source="docdb">DK</country><country mxw-id="DS549875124" load-source="docdb">EE</country><country mxw-id="DS549890257" load-source="docdb">ES</country><country mxw-id="DS549806961" load-source="docdb">FI</country><country mxw-id="DS549806962" load-source="docdb">FR</country><country mxw-id="DS549792931" load-source="docdb">GB</country><country mxw-id="DS549875125" load-source="docdb">GR</country><country mxw-id="DS549883736" load-source="docdb">HU</country><country mxw-id="DS549926202" load-source="docdb">IE</country><country mxw-id="DS549792932" load-source="docdb">IS</country><country mxw-id="DS549806963" load-source="docdb">IT</country><country mxw-id="DS549875130" load-source="docdb">LI</country><country mxw-id="DS549790686" load-source="docdb">LT</country><country mxw-id="DS549883737" load-source="docdb">LU</country><country mxw-id="DS549790687" load-source="docdb">LV</country><country mxw-id="DS549790688" load-source="docdb">MC</country><country mxw-id="DS549890258" load-source="docdb">NL</country><country mxw-id="DS549890259" load-source="docdb">PL</country><country mxw-id="DS549926203" load-source="docdb">PT</country><country mxw-id="DS549890260" load-source="docdb">RO</country><country mxw-id="DS549890265" load-source="docdb">SE</country><country mxw-id="DS549926204" load-source="docdb">SI</country><country mxw-id="DS549899045" load-source="docdb">SK</country><country mxw-id="DS549875131" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><description mxw-id="PDES63961445" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>CROSS REFERENCE TO RELATED APPLICATIONS</b></heading><p id="p0001" num="0001">This application claims the right of priority based on United Kingdom application serial no. <patcit id="pcit0001" dnum="GB0419346A"><text>0419346.2, filed September 1, 2004</text></patcit>.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">This invention relates generally to the field of three-dimensional audio reproduction over headphones or earphones. Specifically it relates to the personalized virtualization of audio sources, such as loudspeakers used in home entertainment systems, using headphones or earphones and developing a level of realism that is difficult to distinguish from the real loudspeaker experience.</p><p id="p0003" num="0003">The idea of using headphones to generate virtual loudspeakers is a general concept well understood by those in the art, as described in <patcit id="pcit0002" dnum="US3920904A"><text>U.S. Patent No. 3,920,904</text></patcit>. In summary; a loudspeaker can be effectively virtualized over headphones or earphones for any individual primarily by acquiring a personalized room impulse response (PRIR) for the loudspeaker in question measured using microphones placed in the vicinity of that individual's left and right ear. The resulting impulse response contains information relating to the sound reproduction equipment, the loudspeaker, the room acoustics, (reverberation) and the directional properties of the subjects shoulders, head and ears, often referred to as the head related transfer function (HRTF) and typically covers a time span of hundreds of milliseconds. To generate a virtual acoustical image of loudspeaker, the audio signal that would ordinarily be played through the real loudspeaker is instead convolved with the measured left-ear and right-ear PRIR and fed to stereo headphones worn by the individual. If the individual is positioned exactly as they where during the personalization measurement then, assuming the headphones are appropriately equalized, that individual will perceive the sound to be coming from the real loudspeaker and not the headphones. The process of projecting virtual loudspeakers over headphones is herein referred to as virtualization.</p><p id="p0004" num="0004">The positions of the virtual loudspeakers projected by headphones match the head- to-loudspeaker relationships established during the personalized room impulse response (PRIR) measurements. For example, if a real loudspeaker measured during the personalization stage is in front of and to the left of the individuals head, then the corresponding virtual loudspeaker will also appear to come from the left front. This means<!-- EPO <DP n="2"> --> that if the individual orientates their head such that, from their view point, the real and virtual loudspeakers coincide, the virtual sound will appear to emanate from the real loudspeaker and, provided the personalized measurements are accurate, that individual will have considerable difficulty distinguishing between virtual and real sound sources. The implication of this is that had a listener made PRIR measurements for each loudspeaker in their home entertainment system, they would be able to recreate the entire multi-channel loudspeaker listening experience simultaneously over headphones without actually having to turn on the loudspeakers.</p><p id="p0005" num="0005">However, the illusion of simple personalized virtual sound sources is difficult to maintain in the presence of head movements, particularity those on lateral plane. For example, when the individual has the virtual and real loudspeakers aligned, the virtual illusion is strong. However if that individual now turns their head to the left, since the virtual sound source is fixed relative to the individuals head, the perceived virtual sound source will also move with the head to the left. Naturally head movements do not cause real loudspeakers to move, and so to maintain a strong virtual illusion it may be necessary to manipulate the audio signals feeding the headphones such that the virtual loudspeakers also remain fixed.</p><p id="p0006" num="0006">Binaural processing also has applications for virtualizing loudspeakers using loudspeakers, rather than headphones, as described in <patcit id="pcit0003" dnum="US5105462A"><text>U.S. Patent Nos. 5,105,462</text></patcit> and <patcit id="pcit0004" dnum="US5173944A"><text>5,173,944</text></patcit>. These also can make use of head tracking to improve the virtual illusion, as described in <patcit id="pcit0005" dnum="US6243476B"><text>U.S. Patent No. 6,243,476</text></patcit>.</p><p id="p0007" num="0007"><patcit id="pcit0006" dnum="US3962543A"><text>U.S. Patent No. 3,962,543</text></patcit> is one of the earliest publications that describe the concept of manipulating the binaural signals fed to the headphones in response to a head tracking signal in order to stabilize the perceived position of the virtual loudspeaker. However their disclosure pre-dates recent advances in digital signal processing theory and their methods and apparatus are generally not applicable to digital signal processing (DSP) type implementations.</p><p id="p0008" num="0008">A more recent DSP-based head tracked virtualizer is disclosed by <patcit id="pcit0007" dnum="US5657239A"><text>U.S. Patent Nos. 5,657,239</text></patcit> and <patcit id="pcit0008" dnum="US5717767A"><text>5,717,767</text></patcit>. This system is based on a split HRTF/room reverberation representation, typical of low complexity virtualizer systems, and uses a memory look-up to read out HRTF impulse files, in response to a look-up address derived from the head-tracking device. The room reverberation is not altered in response to head tracking. The main idea behind this system is that since the HRTF impulse data files are relatively small, typically between 64 and 256 data points, a large number of HRTF impulse responses, specific to each<!-- EPO <DP n="3"> --> ear and each loudspeaker and for a wide range of head turn angles, can be stored within the normal memory storage capabilities of typical DSP platforms.</p><p id="p0009" num="0009">The room reverberation is not modified for two reasons. First, to have stored a unique reverberation impulse response for each head turn angle would have required enormous storage capacity - each individual reverberation impulse response being typically 10000 to 24000 data points in length. Second, the computational complexity of convolving room reverberation impulses of this size would be impractical, even with signal processors available today, and since the inventors do not discuss an efficient implementation for the convolution of long impulses, it is likely that they anticipated an artificial reverberation implementation in order to reduce the computational complexity associated with room convolutions. Such implementations, by definition, would not easily lend themselves to adaptation by the head tracker address. Since personalization is not discussed and was clearly not anticipated for this system, the inventors offer no information regarding what steps would be required to incorporate such a mode of operation either for the HRTF or reverberation processes. Moreover, since this system would require many hundreds of HRTF impulse files to be stored in order to allow for sufficiently smooth HRTF switching under control of the head tracker, it would not be obvious to one skilled in the art how all of these measurements could be made in a practical way such that members of the general public could be expected to undertake them in their own home. Neither is it obvious how a single room reverberation characteristic would be determined from all the personalized measurements. Further, since the room reverberation is not adapted by the head tracker address, it is clear that this system would never be able to replicate the sound of real loudspeakers in a real room and therefore its applicability to realistic virtualization is clearly limited.</p><p id="p0010" num="0010">Head tracking is well known as a technique for detecting head movement. Many approaches have been suggested and are well known in the art. Head trackers can either be head mounted, i.e., gyroscopic, magnetic, GPS-based, optical, or they can be off head, i.e., video, or proximity. The aim of a head tracker is to measure, on a continuous basis, the orientation of the individual's head while listening to the headphones and to transmit this information to the virtualizer to allow the virtualization process to be modified in real time as changes are detected. The head track data can be sent back to the virtualizer using wires, or it can be delivered wirelessly using optical, or RF transmission techniques.<!-- EPO <DP n="4"> --> <patcit id="pcit0009" dnum="EP0465662A"><text>EP0465662</text></patcit> describes an apparatus for binaurally reproducing acoustic signals. The apparatus includes a pair of signal detecting means placed on the bead of a listener to sense a reference signal, and in response to detecting the reference signal, a calculation means calculates the distance and angle of the head relative to the reference source. This information gives the transfer characteristics for the imaginary source of sound that is located at a given position with respect to the reference source. In use, an acoustic signal processing means processes the acoustic signals based on the determined transfer characteristics. Because of the use of the headphone device, the acoustic signal apparatus maintains binaural reproduction of an audio signal even when a listener moves.</p><p id="p0011" num="0011"><patcit id="pcit0010" dnum="US5544249A"><text>US5544249</text></patcit> describes a method of simulating a room or sound impression occurring at a representative listening location in a room. In the method, a representative listening location in the room is selected and the corresponding room impulse response is determined at the representative listening location. A threshold value which exceeds over at least a portion of the duration of the determined room impulse response is determined for the determined room impulse response. By comparing the determined room impulse with the threshold value, a reduced room impulse response is produced which within the portion of the duration of the determined room impulse response only includes those contents of the determined room impulse response in which a momentary amplitude is above the threshold value. In this way, a successful true simulation can be carried out with certain portions of the room impulse responses.</p><p id="p0012" num="0012">International Patent Application No. <patcit id="pcit0011" dnum="WO9725834A"><text>WO 97/25834</text></patcit> describes processing multiple channels of an audio signal are processed through the application of filtering using a head related transfer function (HRTF) or a plurality of HRTFs, selected by a user, such that when reduced to two channels, left and right, each channel contains information that enables the listener to sense the location of multiple phantom loudspeakers when listening over headphones. The HRTFs of a sufficient number of individuals are measured and stored to create a database such that a given individual is able to select a set of HRTFs from the database such that when audio signals are processed with the selected set of HRTFs, the user perceives the corresponding sounds to be localized in the proper spatial positions.<!-- EPO <DP n="5"> --></p><p id="p0013" num="0013">Existing headphone virtualizer systems do not project a virtual acoustical image with a high enough degree of realism to stand up to direct comparison against the real loudspeaker experience. This is because the current state of the art has made no attempt to directly incorporate a personalization method into a headphone virtualizer suitable for use by the general public due to the difficulties associated with the measurements and uncertainties about how to incorporate head tracking into such a scheme.</p><heading id="h0003">SUMMARY <b>OF THE INVENTION</b></heading><p id="p0014" num="0014">According to an aspect of the invention there is provided an audio system for personalized virtualization of a set of loudspeakers in a pair of headphones, the system comprising an audio input interface for receiving a loudspeaker input signal; a headphone output interface for driving a pair of headphones with an audio signal; a headphone tracking system for detecting an orientation of the headphones; a response function interface for reading two or more sets of predetermined personalized response functions based on the detected orientation of the headphones, each predetermined personalized response function representing a transformation from a particular loudspeaker to the left headphone or the right headphone for a particular orientation of the headphones; and a virtualizer coupled to the headphone output interface, wherein the virtualizer is configured to: estimate a set of response functions for the detected orientation of the headphones by interpolating the two or more sets of predetermined personalized response functions, wherein the predetermined personalized response functions are impulse functions, and wherein two or more impulse functions are interpolated by: measuring a time delay for each impulse function, removing the time delays from each impulse function, averaging the resulting impulse functions by weighting according to the detected orientation of the headphones and the orientations of the headphones associated with the impulse functions, and reincorporating the removed delay into the averaged impulse function; transform the loudspeaker input signal using the set of estimated response functions and to provide a resulting virtualized audio signal to the headphone output interface.</p><p id="p0015" num="0015">According to another aspect of the invention, there is provided a method for virtualizing a set of loudspeakers into a pair of headphones for a listener, the method comprising receiving an audio signal for the set of loudspeakers; tracking an orientation of the headphones; selecting two or more sets of predetermined personalized response functions<!-- EPO <DP n="6"> --> based on the tracked headphones orientation, each predetermined personalized response function representing a transformation from a particular loudspeaker to the left headphone or the right headphone for a particular orientation of the headphones; estimating a set of response functions for the tracked orientation of the headphones by interpolating the two or more sets of predetermined personalized response functions, wherein the predetermined personalized response functions are impulse functions, and wherein two or more impulse functions are interpolated by: measuring a time delay for each impulse function, removing the time delays from each impulse function, averaging the resulting impulse functions by weighting according to the tracked orientation of the headphones and the orientations of the headphones that are associated with the impulse functions, and reincorporating the removed delay into the averaged impulse function; transforming the received audio signal using the set of estimated response functions providing a resulting virtualized audio signal to the headphones.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF THE DRAWINGS</b></heading><p id="p0016" num="0016"><ul><li><figref idrefs="f0001">FIG. 1</figref> is a block diagram of a 5.1ch head tracked virtualizer connected to a multi-channel AV receiver.</li><li><figref idrefs="f0002">FIG. 2</figref> illustrates the basic structure of an n-channel head tracked virtualizer under control of a head tracker input.</li><li><figref idrefs="f0003">FIG. 3</figref> illustrates a plan view of a human subject undergoing a PRIR measurement looking towards the excitation loudspeaker.</li><li><figref idrefs="f0003">FIG. 4</figref> illustrates a plan view of a human subject undergoing a PRIR measurement looking to the left of the excitation loudspeaker.</li><li><figref idrefs="f0003">FIG. 5</figref> illustrates a plan view of a human subject undergoing a PRIR measurement looking to the right of the excitation loudspeaker.</li><li><figref idrefs="f0004">FIG. 6</figref> is an example of a plot of amplitude against time of an impulse response measured at the left ear and an impulse measured at the right ear, with the human subject looking to the right of the excitation loudspeaker.</li><li><figref idrefs="f0005">FIG. 7</figref> is an example of a plot of amplitude against time of an impulse response measured at the left ear and an impulse measured at the right ear, with the human subject looking to at the excitation loudspeaker.<!-- EPO <DP n="7"> --></li><li><figref idrefs="f0005">FIG. 8</figref> is an example of a plot of amplitude against time of an impulse response measured at the left ear and an impulse measured at the right ear, with the human subject looking to the left of the excitation loudspeaker.</li><li><figref idrefs="f0006">FIG. 9</figref> is a plan view of human subject undergoing a PRIR measurement of the center point of the measurement scope - along with the resulting impulse time waveforms.</li><li><figref idrefs="f0006">FIG. 10</figref> is a plan view of human subject undergoing a PRIR measurement of the left most point of the measurement scope - along with the resulting impulse time waveforms.</li><li><figref idrefs="f0006">FIG. 11</figref> is a plan view of human subject undergoing a PRIR measurement of the right most point of the measurement scope - along with the resulting impulse time waveforms.</li><li><figref idrefs="f0007">FIG. 12</figref> illustrates a method of altering the perceived distance of a virtual sound source by modifying the impulse response waveform.</li><li><figref idrefs="f0008">FIG. 13</figref> illustrates the mapping of the PRIR measurement angles in order to formulate the inter-aural differential delay - head angle sine wave function.</li><li><figref idrefs="f0008">FIG.s 14a and 14b</figref> illustrate the 3dB ripple effect of uncompensated sub-band convolution.</li><li><figref idrefs="f0009">FIG. 15</figref> illustrates a method of interpolating between PRIRs where the measurement scope is represented by head positions +30, 0 and -30 degrees with respect to the reference viewing angle.</li><li><figref idrefs="f0010">FIG. 16</figref> is similar to <figref idrefs="f0009">FIG. 15</figref> except that the interpolation operates in the sub-band domain.</li><li><figref idrefs="f0011">FIG. 17</figref> illustrates an over-sampled variable delay buffer whose delay is adjusted dynamically by a head tracker.</li><li><figref idrefs="f0012">FIG. 18</figref> is similar to <figref idrefs="f0011">FIG. 17</figref> except that the variable delay buffers are implemented in the sub-band domain.</li><li><figref idrefs="f0013">FIG. 19</figref> is a block diagram of the concept of sub-band convolution.</li><li><figref idrefs="f0014">FIG. 20</figref> is a sketch of a miniature microphone mounted in a human subject's ear canal.</li><li><figref idrefs="f0014">FIG. 21</figref> is a sketch of the construction of the miniature microphone plug.</li><li><figref idrefs="f0015">FIG. 22</figref> is a sketch of a human subject wearing a headphone over a miniature microphone mounted in their ear canal.</li><li><figref idrefs="f0016">FIG. 23</figref> is a plan view of human subject undergoing PRIR measurement where the recorded level of the excitation signal from the left front loudspeaker is scaled prior to commencement of the test.<!-- EPO <DP n="8"> --></li><li><figref idrefs="f0017">FIG. 24</figref> is a block diagram of a MLS system that uses a pilot tone to detect excessive movements in the human subject head during PRIR measurements.</li><li><figref idrefs="f0017">FIG. 25</figref> is an extension of 24 were variations in the pilot tone phase are used to stretch or compress the recorded MLS signals in order to compensate for small head movements.</li><li><figref idrefs="f0018">FIG. 26</figref> is a plan view of human subject undergoing PRIR measurement of the right surround loudspeaker where the excitation signals are output directly to the loudspeakers.</li><li><figref idrefs="f0019">FIG. 27</figref> is a plan view of human subject undergoing PRIR measurement of the right surround loudspeaker where the excitation signals are encoded and transmitted to a AV receiver prior to driving the loudspeakers.</li><li><figref idrefs="f0020">FIG. 28</figref> is a plan view of human subject as in <figref idrefs="f0018">FIG. 26</figref> listening to virtualized signals over head tracked headphones.</li><li><figref idrefs="f0021">FIG. 29</figref> is a front elevation view of left, right and center loudspeakers positioned around a widescreen television set and showing three viewing positions that comprise the PRIR measurement scope.</li><li><figref idrefs="f0021">FIG. 30</figref> is similar to <figref idrefs="f0021">FIG. 29</figref> except that the two outer viewing positions correspond to the positions of the left and right loudspeakers.</li><li><figref idrefs="f0022">FIG. 31</figref> is similar to <figref idrefs="f0021">FIG. 29</figref> except that five viewing positions mark out the PRIR measurement scope.</li><li><figref idrefs="f0023">FIGS. 32a and 32b</figref> illustrate a triangulation method for determining head tracked PRIR interpolation coefficients for the five point scope of <figref idrefs="f0022">FIG. 31</figref>.</li><li><figref idrefs="f0024">FIGS. 33a and 33b</figref> illustrate the use of virtual loudspeaker offsets to realign the position of a virtual source with that of a real loudspeaker.</li><li><figref idrefs="f0025">FIGS. 34a and 34b</figref> illustrate a plan view of a 5-channel surround loudspeaker system and a technique that allows the PRIR interpolation to continue outside the intended head orientation scope.</li><li><figref idrefs="f0026">FIG. 35</figref> illustrates a plan view of human subject undergoing a headphone equalization measurement and the connections to related processing blocks.</li><li><figref idrefs="f0027">FIG. 36</figref> illustrates the virtualization process for a single channel using sub-band convolution where the inter-aural time delays are implemented in the time-band domain following the synthesis filter bank.<!-- EPO <DP n="9"> --></li><li><figref idrefs="f0028">FIG. 37</figref> illustrates the virtualization process for a single channel using sub-band convolution where the inter-aural time delays are implemented in the sub-band domain prior to the synthesis filter bank.</li><li><figref idrefs="f0029">FIG. 38</figref> is similar to <figref idrefs="f0027">FIG. 36</figref> except that it shows the steps necessary to extend the number of input channels.</li><li><figref idrefs="f0030">FIG. 39</figref> is similar to <figref idrefs="f0028">FIG. 37</figref> except that it shows the steps necessary to extend the number of input channels.</li><li><figref idrefs="f0031">FIG. 40</figref> is similar to <figref idrefs="f0030">FIG. 39</figref> except that it shows the steps necessary to allow two independent users to listen to the virtualized signals.</li><li><figref idrefs="f0032">FIG. 41</figref> is a block diagram of a DSP based virtualizer core processor and the primary support circuitry.</li><li><figref idrefs="f0033">FIG. 42</figref> is a block diagram of real-time DSP virtualization routine.</li><li><figref idrefs="f0034">FIG. 43</figref> is a block diagram of DSP routines that process the PRTR data prior to running the virtualizer routine.</li><li><figref idrefs="f0035">FIG. 44</figref> illustrates the concept of pre- virtualization using a single audio channel and using a three position PRIR scope.</li><li><figref idrefs="f0036">FIG. 45</figref> is similar to <figref idrefs="f0035">FIG. 44</figref> except that the pre-virtualized audio signals are encoded, stored and decoded prior to play back.</li><li><figref idrefs="f0037">FIG. 46</figref> is similar to <figref idrefs="f0036">FIG. 45</figref> except that the pre- virtualization is conducted on a secure remote server using PRTR data uploaded by the user.</li><li><figref idrefs="f0038">FIG. 47</figref> illustrates a simplified pre- virtualization concept for a three position PRTR scope where the playback consists of interpolating between combined left and right-ear signals.</li><li><figref idrefs="f0039">FIG. 48</figref> illustrates the concept of personalized virtual teleconferencing where individual PRIRs are uploaded to the conference server.</li><li><figref idrefs="f0040">FIG. 49</figref> illustrates a method of reducing the computational load of sub-band convolution by merging the late reflection portions of the PRIRs</li><li><figref idrefs="f0041">FIG. 50</figref> illustrates a method of separating the initial/early reflections from the late reflections within typical room impulse response waveforms.</li></ul></p><heading id="h0005">DETAILED DESCRIPTION</heading><heading id="h0006"><u>Personalized head tracked virtualization using headphones</u></heading><p id="p0017" num="0017">A typical application of the personalized head tracked virtualizer method disclosed herein is illustrated in <figref idrefs="f0001">FIG. 1</figref>. In this illustration a listener is watching a movie but rather than listening to the movie sound track over their loudspeakers they instead listen to a virtual<!-- EPO <DP n="10"> --> version of the loudspeaker sounds through the headphones. A DVD player 82 outputs in real-time an encoded (for example Dolby Digital, DTS, MEPG) multi-channel movie sound track via an S/PDIF serial interface 83 while playing a movie disc. The bit-stream is decoded by an Audio/Video (AV) Receiver 84 and the individual analogue audio tracks (Left, Right, Left Surround, Right Surround, Center and Sub-Woofer loudspeaker channels) are output via the pre-amplifier outputs 76 and input to the headphone virtualizer 75. The analogue input channels are digitized 70 and the digital audio is fed to the real-time personalized head tracked virtualizer core processor 123.</p><p id="p0018" num="0018">This process filters, or convolves, each loudspeaker signal with a set of left-ear and right-ear personalized room impulse responses (PRIR) that represent the transfer functions between the desired virtual loudspeaker and the listener's ears. The left-ear filtered signals and the right-ear filtered signals from all the input signals are summed to produce a single stereo (left-ear and right-ear) output that is converted back to analogue 72 and prior to driving the headphones 80. Since each input signal 76 is filtered with its own particular PRIR set, each is perceived to come from one of the original loudspeaker locations by the listener 79 when heard over the headphones 80. The virtualizer processor 123 is also able to compensate for listener head movement.</p><p id="p0019" num="0019">The listener's 79 head angles are monitored by a headphone-mounted head-tracker 81 that periodically transmits 77 the angles down to the virtualizer processor 123 via a simple asynchronous serial interface 73. The head angle information is used both to interpolate between a sparse set of PRIRs that cover typical listener's head movement range, and to alter the inter-aural delays that would have existed between the listener's ears and the various loudspeakers being virtualized. The combination of these processes is to de-rotate the virtualized sounds to counteract the head movement such that, to the listener, they appear to remain stationary.</p><p id="p0020" num="0020"><figref idrefs="f0001">FIG. 1</figref> illustrates the real-time playback mode of a head tracked virtualizer. In order for the listener to hear a convincing illusion of the loudspeaker sounds over the headphones a number of personalization measurements are made first. The primary measurement involves acquiring personalized room impulse responses, or PRIR, for each loudspeaker the user wishes to virtualize over the headphones and over a range of head movements the listener is likely to make while ordinarily using the headphones. A PRIR essentially describes the transfer function of the acoustical path between the loudspeaker and the listener's ear canal. For any one speaker it may be necessary to measure this transfer function for each ear; hence, the PRIRs exist as left-ear and right-ear sets.<!-- EPO <DP n="11"> --></p><p id="p0021" num="0021">The test involves the listener taking up their normal listening position within their loudspeaker set up, placing miniature microphones in each of their ears and then sending an excitation signal to the loudspeaker under test for a certain period of time. This is repeated for each loudspeaker and for each head orientation the user wishes to capture. If an audio signal is filtered, or convolved, with the resulting left and right-ear PRIRs and the filtered signals are used to drive the left-ear and right-ear headphone transducers respectively, then the listener will perceive that signal to come from the same location as the loudspeaker used to measure the PRIRs in the first place. In order to improve the realism of the virtualization process it may be necessary to compensate for the fact that the headphones themselves will impose an additional transfer function between their transducers and the listener's ear canals. Hence a secondary measurement is taken whereby this transfer function is also measured and used to create an inverse filter. The inverse filter is then used either to modify the PRIRs or filter, in real-time, the headphone signals, to equalize for this unwanted response.</p><p id="p0022" num="0022">The head tracked PRIR filtering, or convolution, processing 123 indicated in <figref idrefs="f0001">FIG. 1</figref> is illustrated in greater detail in <figref idrefs="f0002">FIG. 2</figref>. A digitized audio signal 41 is input to Ch 1 and applied to two convolvers 34. One convolver filters the input signal with the left-ear interpolated PRIR 15a and the other convolver filters the same signal with the right-ear interpolated PRIR. The output of each convolver is applied to a variable path length buffer 17 that creates an inter-aural differential delay between the left-ear and right-ear filtered signals. Both the PRIR interpolation 15a and the variable delay buffer 17 are adjusted according to the head orientation 10 fed back from the head tracker 81 in order to affect the virtual soundstage de-rotation. The processes described for Ch1 41 are separately implemented for all other input signals. However, all the left-ear signals, and all the right-ear signals are summed 5 separately prior to their output to the headphones.</p><heading id="h0007"><u>Personalized Room Impulse Response (PRIR) Acquisition</u></heading><p id="p0023" num="0023">One feature of an example of the disclosure is the facility to acquire personalized room impulse responses (herein referred to as PRIR) data measured in the vicinity of the users left and right ears in a convenient manner. After acquisition, the PRIR data is processed and stored for use by the virtualizer convolution engine to create the illusion of real loudspeakers. If desired, this data can also be written to portable storage media, or transmitted off board, for use by a remote compatible virtualizer, not associated with the acquisition equipment.</p><p id="p0024" num="0024">The basic techniques for acquiring personalized room impulse responses are not new and are well documented and will be known to those skilled in the art. In summary, to<!-- EPO <DP n="12"> --> acquire the impulse response, an excitation signal, for example an impulse, spark, balloon implosion, pseudo noise sequence etc, is reproduced at the desired location in space relative to the subjects head, using a suitable transducer where required, and the resulting sound waves are recorded using a microphone located either close to the subjects ears, or preferably at the entrance to the subjects ear canals, or anywhere inside the subjects ear canals.</p><p id="p0025" num="0025"><figref idrefs="f0014">FIG. 20</figref> illustrates the placement of a miniature omni-directional electret microphone capsule 87 (6mm diameter) in a single ear canal 209 of human subject 79. The outline of the subject's outer ear (pinna) is also shown 210. <figref idrefs="f0014">FIG. 21</figref> better illustrates the construction of the microphone plug that is fitted into the ear canal. The microphone capsule is embedded into a deformable foam ear plug 211, whose normal use is for noise attenuation, with the open end of the microphone 212 facing out. The capsule can be glued into the foam plug, or it can be friction fitted by expanding the foam using a sleeve fitter and allowing the foam to close over it. Depending on the height of the microphone capsule itself, the foam plug 211 would typically be trimmed to a length of around 10mm long.</p><p id="p0026" num="0026">Plugs are typically manufactured with uncompressed diameters in the range 10-14mm to accommodate difference sizes of ear canal. The signal/power and ground wires 86 soldered to the back run along the outside of the capsule wall, exiting from the front also on their way to the microphone amplifiers. The wires can be fixed to the side of the capsule if desired to reduce possibility of damage to the solder joints. To insert the microphone into the ear the user simply rolls the foam plug with the capsule inside between their fingers and having compressed the diameter of the plug, quickly inserts it into the ear using the index finger. The foam will immediately begin to slowly expand out, providing a comfortable, but tight fit in the ear canal 5 to 10 seconds later. The microphone plug is therefore able to stay in place without additional aids. Ideally when the plug is fitted, the open end of the microphone will sit flush with the entrance of the ear canal. The wires 86 should protrude as shown in <figref idrefs="f0014">FIG. 20</figref>, and pulling on these allows the user to conveniently remove the microphone plug once the tests are complete. The foam provides an additional benefit in that it seals the ears and reduces the level of exposure to excitation noise during the personalization tests.</p><p id="p0027" num="0027">Once the left-ear and right-ear microphones have been installed the personalization measurements can begin. Depending on the reverberation characteristics of the environment surrounding the measurement space, the resulting impulse waveforms will typically decay to zero within a few seconds and the recordings need not extend beyond this time. The quality of the acquired impulse responses will depend to a certain extent on the<!-- EPO <DP n="13"> --> background noise level of the environment, the quality of the transducer and recording signal chain, and on the degree of head movement experienced during the measurement process. Unfortunately, a loss of impulse response signal fidelity will impact directly the quality, or realism, of any sounds virtualized through convolution with this impulse response and so it is desirable to maximize the quality of the measurement.</p><p id="p0028" num="0028">To address this problem, an example uses, as the basis of the acquisition method, a pseudo noise sequence as the excitation signal for the personalized room impulse response measurement, known as MLS, or Maximum Length Sequence. Once again, the MLS technique is well documented, for example in <nplcit id="ncit0001" npl-type="s"><text>Berish J., "Self-contained cross- correlation program for maximum-length sequences," J. Audio Eng. Soc, vol. 33, no. 11, Nov. 1985</text></nplcit>. The MLS measurement has certain advantages over impulse or spark type excitation methods in that the pseudo noise sequences provide for higher impulse signal-to- noise ratios. In addition, the process permits one to easily conduct sequential measurements in an automated way, such that the background noise of the measurement environment and equipment inherent in the measured impulse response can be further suppressed through the process of averaging.</p><p id="p0029" num="0029">In the MLS method, a pre-calculated binary sampled sequence, whose duration is at least twice that of the expected reverberation time of the test environment, is output to a digital to analogue converter at some desired sampling rate and fed to the loudspeaker in real time as an excitation signal. Hereafter this loudspeaker is referred to as the excitation loudspeaker. The same sequence can be repeated as often as may be necessary to achieve the desired level of background noise suppression. The microphone picks up the resulting sound waves in real time, and simultaneously the signal is sampled and digitized, using the same sample time base as the excitation playback, and stored to memory. Once the desired number of sequence repetitions have been played the recording is stopped. The recorded sample file is then circularly cross-correlated against the original binary sequence to produce an averaged personalized room impulse response unique to the excitation loudspeakers position relative to the acoustical environment surrounding it and to the human subjects head on which the microphones are mounted.</p><p id="p0030" num="0030">In theory it is possible to measure the impulse response at each ear separately, i.e., using only one microphone and repeating the measurement for each ear, but it is both convenient and advantageous to place a microphone in each ear and to make simultaneous dual channel recordings in the presence of the excitation signal, hi this case each sampled<!-- EPO <DP n="14"> --> audio file recorded at each ear is processed separately giving two unique impulse responses. These files are referred to herein as the left-ear PRIR and the right-ear PRIR.</p><p id="p0031" num="0031"><figref idrefs="f0003">FIG. 3</figref> is a simplified illustration of the method of acquiring a personalized room impulse response used within the preferred examples. All analogue and digital conversion, as well as timing circuits, have been excluded for clarity. The loudspeaker 88 is first located to the desired position within the room or acoustical environment with respect to a plan view of the human subject 89. In this illustration the loudspeaker is positioned straight ahead of the subject. The human subject has mounted, one in the vicinity of each ear canal, two microphones whose outputs 86a and 86b are connected to two microphone amplifiers 96. Before the beginning of the test, the human subject positions their head to the desired orientation relative to the excitation loudspeaker and maintains this orientation, as best they can, for the duration of the measurement. In the case of <figref idrefs="f0003">FIG. 3</figref> the human subject 89 is looking straight at the loudspeaker 88. The use of the term 'looks', 'looking', 'views' or 'viewing' herein means to orientate the head such that an imaginary line perpendicular to the subjects face would pass through the point that they are looking at.</p><p id="p0032" num="0032">In one example, the measurement is conducted as follows. An MLS is output from 98 in a repetitive fashion and is input both to a loudspeaker amplifier 115 and circular cross correlation processor 97. The loudspeaker amplifier drives the loudspeaker 88 at the desired level, thereby causing a sound wave to travel outwards and towards the left and right ear microphones mounted on the human subject 89. The left and right microphone signals, 86a and 86b respectively, are input to microphone amplifiers 96. The amplified signals are sampled and digitized and input to the circular cross-correlation processing unit 97. Here they can be stored for processing off-line, after all sequences have been played, or they can be processed in real-time as each complete MLS block arrives, depending on the available digital signal processing power. Either way, the recorded digital signals are cross-correlated against the original MLS input from 98 and on completion the resulting averaged personalized room impulse response file is stored in memory 92 for later use.</p><p id="p0033" num="0033"><figref idrefs="f0005">FIG. 7</figref> illustrates the early portion of a typical impulse response plotted as amplitude against time, for the left-ear microphone 171 and the right-ear microphone 172 as might be acquired with the head oriented looking straight at the excitation speaker as indicated in <figref idrefs="f0003">FIG. 3</figref>. As indicated in <figref idrefs="f0005">FIG. 7</figref>, with the head pointed towards the excitation source, the direct path lengths from the loudspeaker to the left-ear and right-ear microphones, respectively, will be almost equal, resulting in almost coincident impulse onset times 174.<!-- EPO <DP n="15"> --></p><p id="p0034" num="0034"><figref idrefs="f0003">FIG. 4</figref> is similar to <figref idrefs="f0003">FIG. 3</figref> except that this illustrates an example of acquiring a personalized room impulse response with the human subject 90 looking at a point to the left of the excitation loudspeaker. Again, once the head orientation has been decided, this should not be changed during the measurement. <figref idrefs="f0005">FIG. 8</figref> illustrates the early portion of a typical impulse response plotted as amplitude against time, for the left-ear microphone 171 and the right-ear microphone 172 as might be acquired with the head oriented looking to the left of the excitation loudspeaker as indicated in <figref idrefs="f0003">FIG. 4</figref>. As indicated in <figref idrefs="f0005">FIG. 8</figref>, with the head pointed to the left of the excitation source, the direct path length from the loudspeaker to the left-ear microphone will now be greater than that between the loudspeaker and the right- ear microphone, causing the left-ear impulse onset 173 to be delayed 175 compared to the right-ear impulse onset 174.</p><p id="p0035" num="0035"><figref idrefs="f0003">FIG. 5</figref> is similar again except that this illustrates an example of acquiring a personalized room response impulse with the human subject 91 looking at a point to the right of the excitation loudspeaker. <figref idrefs="f0004">FIG. 6</figref> illustrates the early portion of a typical impulse response plotted as amplitude against time, for the left-ear microphone 171 and the right-ear microphone 172 as might be acquired with the head oriented looking to the right of the excitation loudspeaker as indicated in <figref idrefs="f0003">FIG. 5</figref>. As indicated in <figref idrefs="f0004">FIG. 6</figref>, with the head pointed to the right of the excitation source, the direct path length from the loudspeaker to the right-ear microphone will now be greater than that between the loudspeaker and the left- ear microphone, causing the right-ear impulse onset 173 to be delayed 175 compared to the left-ear impulse onset 174.</p><p id="p0036" num="0036">If the three measurements illustrated in <figref idrefs="f0003">FIGS. 3,4 and 5</figref> are completed successfully, that is, the human subject maintains their head orientation with a sufficient degree of accuracy during each acquisition phase, then three pairs of personalized room impulse responses would now be found in storage areas 92 (<figref idrefs="f0003">Fig.3</figref>), 93 (<figref idrefs="f0003">Fig.4</figref>) and 94 (<figref idrefs="f0003">Fig.5</figref>), each pair corresponding to the left and right-ear PRIRs for the human subject in question, looking directly at, looking to the left off, and looking to the right off, loudspeaker 88.</p><heading id="h0008"><u>Establishing the scope of listener head movement</u></heading><p id="p0037" num="0037">Disclosed herein is a method of acquiring PRIR data, for use in a personalized head tracking apparatus, that is designed to be undertaken using a persons own loudspeaker sound system and within their normal listening room environment. The acquisition method assumes that the human subject desiring to undertake the personalization tests is first positioned in the ideal listening position, i.e., the position that they would normally take up if they were using their loudspeakers to listen to music or watch a movie. For example, with<!-- EPO <DP n="16"> --> typical multi-channel home entertainment systems, as illustrated in the plan view of <figref idrefs="f0025">FIG. 34a</figref>, the loudspeakers are arranged as left front 200, center front 196, right front 197, left surround 199 and right surround 198.</p><p id="p0038" num="0038">Often a center surround speaker and bass subwoofer also form part of many home entertainment systems. In <figref idrefs="f0025">FIG. 34a</figref> the human subject 79, is positioned equidistant from all loudspeakers. As is typical in home movie systems, the front center speaker is located either above or below or behind the television/monitor/projection screen used to display the motion picture associated with the sound. The human subject then proceeds to acquire personalized measurements for each loudspeaker over a limited number of head orientations covering a listening area in and around the frontal viewing area. The measurement points can be on the same lateral plane (yaw) or they can include an elevation component (pitch), or they can account for the three degrees of head movement - yaw, pitch and roll.</p><p id="p0039" num="0039">The method aims to capture a sparse set of measurements for each loudspeaker around a periphery that defines the maximum likely range of head movements experienced by the user while listening to music, or watching movies. For example, when watching movies, it would be normal for listeners to maintain a head orientation that allows them to view the television or projector screen while listening to the movie soundtrack. Measurements could therefore be made for all loudspeakers for head positions looking off to the left of the screen, looking off to the right of the screen and, if desired, looking at some points above and below the screen, in the knowledge that, for the vast majority of time, this zone would cover all the listeners head orientations during the process of watching a movie. Introducing a range of head roll angles into the PRIR process would also be possible if this type of motion was expected during playback.</p><p id="p0040" num="0040">If the head tracking virtualizer has access to room impulse response data measured for head orientations that bound the expected user head movement range, then it is able to calculate, through interpolation, an approximate impulse response for any head orientation within that range, as indicated by a head tracker. Herein the range of head movements that the interpolator has sufficient PRIR data for which to de-rotate the virtualized loudspeakers in this way is referred to as the 'scope' of the measurements or the 'scope' of the listener's head movements. The performance of the virtualizer can be further enhanced by taking an additional personalized measurement with the head looking towards the mid point of the head tracked zone. Typically this is simply the straight-ahead position as would be the natural head orientation while watching a movie on a TV or movie screen. Further improvements may be had if measurements are taken for different head roll angles, particularly while<!-- EPO <DP n="17"> --> viewing the front screen, effectively adding a third dimension into the interpolation equation. The benefits of the sparse sampling method are many, including:
<ol><li>1) The number of PRIR measurements to be acquired by the human subject can be relatively low, without sacrificing performance, since head orientations outside the listener scope are not part of the measurement procedure.</li><li>2) Any number of loudspeakers can be accommodated in the measurement process.</li><li>3) The spatial positioning of the loudspeakers with respect to the human subject can be arbitrary, and do not need to measured, since a complete set of head related PRIR data is measured for each separate loudspeaker and subsequently deployed by the interpolator to virtualize those loudspeakers.</li><li>4) Only the relatively few head positions used while acquiring each PRIR data set need to be accurately measured with respect to the reference head orientation.</li><li>5) The spatial positioning and reverberation characteristics of the virtual loudspeakers match exactly those of the real loudspeakers for head positions within the listener scope, provided the measurement and the subsequent listening is conducted using the same sound system.</li><li>6) The method makes no assumptions about the characteristics of the loudspeaker presentation format. Sound tracks, for example, may be carried by more than one loudspeaker, as is common for diffuse surround effects channels in larger home entertainment configurations. In this case, since all associated loudspeakers will be driven by the same excitation signal, the personalization measurements will automatically carry all the information necessary to virtualize such groups of loudspeakers, within the listener scope.</li></ol></p><p id="p0041" num="0041"><figref idrefs="f0022">FIG. 31</figref> illustrates a human subject 79 looking towards a television 182 based home entertainment system. The surround and subwoofer loudspeakers are assumed to be out of sight for the purposes of this illustration. The left-front loudspeaker 180 is positioned on the left side of the TV and the right-front loudspeaker 183 on the right side. The center loudspeaker 181 is placed on top of the TV set 182. The dotted line 179 indicates a bounded area within which the listener is expected to maintain their head orientation. The X points 184, 185, 186, 187 and 177 represent imaginary points in space at which the human subject looks while each set of personalization measurement are made. The center lines 250 represent the different lines-of-sight as the subject looks at each of the X points. In the case of <figref idrefs="f0022">FIG. 31</figref> personalization measurements for all the loudspeakers, including those out-of<!-- EPO <DP n="18"> --> sight will be repeated five times, each time the human subj ect will reposition their head to look towards one of the measurement X points.</p><p id="p0042" num="0042">In this example, the five personalized head orientations are, upper left 185 i.e., the subject looks above and to the left of the left-front loudspeaker 180, upper right 186, which is above and to the right of the right-front loudspeaker 183, lower left 184, lower right 187 and screen center 177 which approximates the nominal head orientation while viewing a movie. Once all the measurements are acquired, the resulting PRIR data and their associated head orientations are stored for use by the interpolator.</p><p id="p0043" num="0043"><figref idrefs="f0021">FIG. 29</figref> illustrates an alternative personalization measurement procedure whereby only three head orientations on the same lateral plane 179 are used to make the personalized measurements, X point 176 to the left of the left-front speaker 180, X point 177 at center screen and X point 178 to the right of right-front loudspeaker. This form of measurement assumes that the most important component in head tracked virtualization is pure head rotation (yaw), since the room impulse response for head elevations (pitch) either side of this line would not be known. <figref idrefs="f0021">FIG. 30</figref> illustrates a further simplification whereby the left and right X points 176 and 178 correspond with the left and right-front loudspeakers themselves. In this variation the human subject simply needs only to look at the left-front loudspeaker, the right-front loudspeaker and the screen center, all on approximately the same lateral plane, for each set of personalization measurements, respectively.</p><p id="p0044" num="0044">The personalized room impulse response (PRIR) data sets permit the virtualization of loudspeakers and the position of each virtual loudspeaker will correspond to the position of the real loudspeaker relative to the human subjects head established during the measurement process. Hence for the interpolation method to work accurately, that is, to cause the virtual loudspeaker to appear to be positioned coincident with the real loudspeaker, provided the subjects listening position relative to the real loudspeakers is the same as during the personalization measurements, then it is only necessary for the virtualizer to know for which head orientations the personalized impulse responses correspond to, in order for it to interpolate between the data in response to head orientation signals being fed back from a head tracking device. Provided the head tracker uses the same directionality reference as the system that determined the head orientation for each personalization data set then the virtual and real loudspeakers will coincide from the listener's perspective, within the scope of the original measurements.<!-- EPO <DP n="19"> --></p><heading id="h0009"><u>Matching Virtual-Real Loudspeaker lateral and height positions</u></heading><p id="p0045" num="0045">The personalization measurement process relies on the fact that each loudspeaker is measured over some range, or scope, of the human subjects head movement. While the head orientations for each personalized data set are known and referenced to the playback head tracker coordinates, strictly speaking, examples of the disclosure do not need to know the physical position of any of the loudspeakers under test in order for accurate virtualization to be achieved. Provided the real loudspeaker positions remain the same as those used for the personalization process, then the virtual sounds will emanate from the same physical locations, However, knowledge of the physical loudspeaker positions is useful when it may be necessary to make adjustments to the virtual loudspeaker positions as a result of virtual-real loudspeaker positional misalignment. For example if the user wishes to set up loudspeakers in a listening environment other than the one used to make the measurements, then ideally they would physically arrange the loudspeakers to match the virtual loudspeaker positions as accurately as possible so as to cause the virtual sounds to coincide with the real loudspeakers. Where this is not possible then the listener will perceive the virtual sounds to emanate from locations other than the loudspeakers, a phenomenon that can reduce the realism of the virtualizer for some individuals. This problem is less of an issue for loudspeakers that are ordinarily out of sight over the normal listener's head movement scope, as might be the case for the surround loudspeakers 198 and 199 <figref idrefs="f0025">FIG. 34a</figref>, or those loudspeakers positioned above the listener.</p><p id="p0046" num="0046">Examples of the disclosure may allow for some degree of adjustment to the virtual loudspeaker lateral and/or height positions by introducing an offset to the interpolation processes. The offset represents the position of the desired virtual loudspeaker relative to the measured loudspeaker position. However the degree of head movement permitted while virtualizing such loudspeakers will be reduced by an amount equal to the offset, due to fact that the personalized room impulse responses do not cover head movements beyond the original measured boundaries. This implies that the original personalization process should be conducted over a wider head orientation range than might ordinarily be required for normal listening/viewing if minor positional adjustments are likely to be made at a later date.</p><p id="p0047" num="0047">Use of an interpolation offset to alter the position of a virtual loudspeaker is illustrated in <figref idrefs="f0024">FIGS. 33a and 33b</figref>. In <figref idrefs="f0024">FIG. 33a</figref> the dotted boundary line 179 represents the listeners viewing boundary over which the virtualizer interpolator operates using the personalized data sets measured at points 184, 185, 186, 187 and 177 for real loudspeaker 180. The center measurement point 177 represents the nominal listening/viewing head<!-- EPO <DP n="20"> --> orientation and this corresponds to the playback head tracker zero reference position. The maximum extent of left-right and up-down head movement is indicated by 214 and 215 respectively. In <figref idrefs="f0024">FIG. 33b</figref> the position of the real loudspeaker 217 now does not correspond to that which was used to make the personalized measurements 180. This implies that the virtualizer interpolator introduces an offset into its calculations 216 in order to force the virtual loudspeaker 180 to be realigned with the real loudspeaker 217 - the offset running counter to the desired virtual loudspeaker positional shift 218. The same offset is also used to adjust the inter-aural path differences. As a result, the head movement range that can be accommodated by the interpolator for this virtual loudspeaker is significantly reduced 214 and 215 - in this particular illustration, left-off-center and below-center head movements will reach the personalization measurement boundary 179 much sooner than without the offset.</p><heading id="h0010"><u>Measuring head orientations taken up during personalization measurements</u></heading><p id="p0048" num="0048">In order for the personalized room impulse response interpolation to cause the virtual loudspeaker position to coincide with that of the real loudspeaker it may be necessary for the head orientation to be established and logged for each of the personalized room response measurements, and for these orientations to be referenced to the head tracking coordinates that will be used in the virtualizer playback. These coordinates would typically be stored permanently along side the PRIR data sets since without them the head angles and virtual loudspeakers they represent may be difficult to unravel from the PRIRs themselves. The head orientation measurements can be achieved in a number of ways.</p><p id="p0049" num="0049">The most straightforward method involves the human subject wearing some form of head tracker device, in addition to the ear-mounted microphones, during the personalized measurements. This method can determine head orientations over three degrees of freedom and is therefore applicable to all levels of measurement complexity, including those that take head roll into account. For example, a head tracker could be used for the measurements illustrated in <figref idrefs="f0021">FIGS. 29, 30</figref> and <figref idrefs="f0022">31</figref>. Hence the head yaw (or rotation), pitch (elevation) and roll readings output from the head tracker may be logged prior to the start of each set of loudspeaker measurements and this information is retained for use by the virtualizer.</p><p id="p0050" num="0050">Alternatively, if a head tracker is not available, fixed physical viewing points can be set up prior to the testing, whose associated head orientations are measured manually ahead of time. This would normally involve erecting a number of viewing targets around the front loudspeakers or movie screen. The human subject simply looks towards these targets for each personalized measurement, and the associated head orientation data entered manually<!-- EPO <DP n="21"> --> into the virtualizer. In cases where the measurement head orientations are limited to the lateral plane, for example <figref idrefs="f0021">FIGS. 29 and 30</figref>, it is also possible to use the front loudspeakers themselves 180 and 183 of <figref idrefs="f0021">FIG. 30</figref>, as viewing targets and to enter their positions into the virtualizer.</p><p id="p0051" num="0051">Unfortunately when human subjects look at targets or loudspeakers often their head does not exactly point to the object they are looking at and the resulting misalignment can lead to minor dynamic tracking errors during virtualizer headphone playback. One solution to this problem is to consider the measurement points as arbitrary head angles, <figref idrefs="f0021">FIG. 29</figref>, where the head rotation angle associated with positions 176 and 178 can be estimated by analyzing the inter-aural delays of the measured personalized room impulse responses themselves. For example, if the subject positions their head looking off to the left and the front center loudspeaker 181 is selected as the excitation loudspeaker, then the delay between the left and right-ear impulse response onsets will provide an estimation of the head angle with respect to the center loudspeaker.</p><p id="p0052" num="0052">Assuming the maximum delay is known, i.e., the delay measured between the left and right-ear microphone signals when the excitation signal is directly perpendicular to the left or right ear, and the head angle is within +/- 90 degrees of the excitation loudspeaker, the head angle referenced to that loudspeaker is given as: <maths id="math0001" num="(eqn 1)"><math display="block"><mi>Head angle</mi><mo>=</mo><mi>arcsine</mi><mo>â¢</mo><mfenced separators=""><mo>-</mo><mi>delay</mi><mo>/</mo><mi>maximum absolute delay</mi></mfenced></math><img id="ib0001" file="imgb0001.tif" wi="140" he="9" img-content="math" img-format="tif"/></maths><br/>
where a positive delay occurs when the delay of the left-ear microphones exceeds that of the right-ear microphone. The accuracy of the technique is greatest when the angle subtended between the excitation loudspeaker and the subject's head is at it lowest, i.e., for off-left measurements it may be better to use the left front loudspeaker as the excitation source rather than the center front loudspeaker. Furthermore, the method can either use an estimate of the maximum absolute delay, in particular when the head to loudspeaker angle is small, or the maximum absolute delay between the users ear mounted microphones may be measured as part of the personalization procedure. Another variation is to use some type of pilot tone rather than an impulse measurement excitation signal. Under certain circumstances a tone will enable more accurate head angle measurements to be made. In this case the tone can be continuous or burst, and the delays determined by analyzing the phase difference or onset times between the left and right-ear microphone signals.</p><p id="p0053" num="0053">The head orientation angles taken up during each personalization acquisition are typically measured with respect to a reference head orientation, herein referred to as Î¸ ref, Ï‰ ref or Ïˆ ref, depending on the degrees of freedom permitted during the personalization. The<!-- EPO <DP n="22"> --> reference head orientation defines the listener's head orientation that would be taken up while viewing the movie screen or listening to music. Depending on the nature of the head tracker, the tracking coordinates may have a fixed point of reference e.g., the earth's magnetic field or an optical transmitter sitting on the TV set, or their point of reference may vary over time. With a fixed reference system it would be possible to measure the normal viewing orientation and then retain this measurement inside the virtualizer on a permanent basis for use as the reference head orientation. The measurement would be repeated only if the listener's home entertainment system were to be altered in a way that caused the viewing angles to change with respect to this reference. With floating reference head trackers, for example gyroscope based, the reference head orientation may need to be established every time the virtualizer/head tracker is switched on.</p><p id="p0054" num="0054">One possible implication of all of this is that it may not be unusual to have some virtual-real loudspeaker misalignment brought about by differences in head reference values over time. A headphone virtualization system may therefore provide to the user a convenient way of resetting the head reference orientation angles (Î¸ ref, Ï‰ ref or Ïˆ ref) as part of the normal listening set up. This could be achieved, for example, by providing a one-shot switch that when depressed would prompt the virtualizer, or head tracker, to store off the listener's current head orientation angles. The listener could interactively home in on the correct head alignment by simply listening to the virtualized loudspeakers over the headphones, move their head in the opposite direction to the perceived misalignment, while repeatedly sampling the angles using the switch, until the virtual and real loudspeakers coincide. Alternatively, some form of absolute reference method could be used, for example, using a head mounted laser and pointing the laser beam to some previously defined reference point in the listening room, for example the center of the movie screen, prior to storing off the head angles.</p><heading id="h0011"><u>Interpolation between PRIR data based on head tracker input</u></heading><p id="p0055" num="0055">Disclosed herein is a method that permits accurate interpolation between sparsely sampled PRIRs without loss of virtualization accuracy and may be important to the success of the personalized head tracking methodology disclosed herein. Left and right-ear personalized room impulse responses, (PRIRs), when convolved with an audio signal such that the left-ear convolved signal is played through the left side of a pair of headphones and the right-ear convolved signal played through right side of the headphones, cause the listener to perceive the audio coming from the same location, with respect to his head orientation, as the loudspeaker used to acquire the left-ear and right-ear PRIRs in the first place. If the listener moves their head, then the virtual loudspeaker sound will retain the same spatial relationship<!-- EPO <DP n="23"> --> with the head and the image will likely be perceived to move in unison with the head. If the same loudspeaker is measured using a range of head orientations and the alternate PRIRs are selected by the convolver when the head tracker indicates the listener's head coincides with the original measurement positions, then the virtual loudspeaker will be correctly positioned at these same head positions.</p><p id="p0056" num="0056">For head positions that do not correspond to those used during the measurements the virtual loudspeaker position may not be aligned with that of the real loudspeaker. The idea behind the interpolation method is that the impulse response characteristic between the loudspeaker and the ear-mounted microphones will probably change relatively slowly as the head turns and if measured for a small number of head positions the impulse characteristic for those head positions not specifically measured can be calculated by interpolating between those head positions for which impulse data does exist. The impulse response data loaded to the convolvers would therefore exactly match those of the original PRIRs only for head positions that correspond to the measurement head positions. Theoretically head orientations can cover the entire auditory sphere and if only a few measurements are taken to cover this range of movements, then it is likely that the differences between the PRIRs will be large and therefore not well suited to interpolation.</p><p id="p0057" num="0057">Disclosed herein is a method whereby the typical listener head movements are identified and only measurements sufficient to cover this narrow range of head movements are carried out and applied to the interpolation process. If the differences between the adjacent PRIRs are small, then by calculating intermediate impulse responses based on the measured PRIRs, the interpolation process should cause the virtual loudspeaker position to remain stationary, even when the head tracker indicates the listener's head position is no longer coincident with those of the PRIRs. In order for the interpolation process to work accurately, it is broken down into a number of steps.
<ol><li>1) The inter-aural time delays inherent in the raw impulse responses output from the personalization process is measured, logged and then removed from the impulse data, i.e., all impulse responses are time aligned. This is done only once after the personalization measurements are complete.</li><li>2) The time-aligned impulses are directly interpolated, where the interpolation coefficients are calculated in real-time, or derived from a look-up table, based on the head orientation indicated by the listener's head tracker, and the interpolated impulse is used to convolve the audio signals.</li><li>3) The left-ear and right-ear audio signals are, either prior to or following the PRIR<!-- EPO <DP n="24"> --> convolution process, passed through separate variable delay buffers whose delays are continuously adapted to match the virtual inter-aural delays that simulate the effect of the different path lengths that would ordinarily exist between the listener's left and right ears and a real loudspeaker coincident with the virtual loudspeaker. The path lengths can be calculated in real time or they can be derived from look-up tables, based on the head orientation indicated by the listener's head tracker.</li></ol></p><heading id="h0012"><u>Time alignment of impulse responses</u></heading><p id="p0058" num="0058">In order to provide effective impulse interpolation it is desirable to time-align the PRIRs. However the differential time delays between all the PRIRs are put back into the audio signals either prior to, or following, the PRIR convolution process using a combination of fixed and head-tracker-driven variable delay buffers in order to fully recreate the virtualizer illusion. One way of achieving this is to measure the various time delays, log them, and then remove these delay samples from each PRIR such that they are approximately time aligned. Another approach is to simply remove the delays and to rely on the user to input sufficient information about the PRIR head angles and the loudspeaker positions such that the delays can be calculated independent of the PRIR data.</p><p id="p0059" num="0059">If it is desired to estimate the delays from the PRIR data (rather than have the user enter the data) then the first step is to measure the absolute time delays from the loudspeaker to the ear mounted microphone by searching the raw PRIR data files and locating the onset of each impulse. Since in one implementation the playback and recording of the MLS is tightly controlled and highly reproducible, the location of each impulse onset relates to the path length between that loudspeaker and microphone. Due to latencies in the analogue and digital circuitry a certain fixed delay offset will always exist in the PRIR, even when the loudspeaker-microphone distance is small, but this can be measured during a calibration procedure and removed from the calculation.</p><p id="p0060" num="0060">Many methods exist for detecting waveform peaks and are well known in the art. A method that works consistently is one that measures the absolute peak value over the entire impulse response waveform and then uses this value to calculate a peak detection threshold. A search is then started from the beginning of the impulse file, which sequentially compares each sample to the threshold. The sample that first exceeds the threshold defines the impulse onset. The position of the sample in from the start of the file, less any hardware offset, is a measure of the total path length, in samples, between the loudspeaker and the microphone.</p><p id="p0061" num="0061">Once the delays are measured and logged for each PRIR, all the data samples up to the impulse onset are removed from the PRIR data files leaving the direct impulse waveforms<!-- EPO <DP n="25"> --> coincident with, or very close to, the start of each file. The second step involves measuring the sample delay from each real loudspeaker to the center of the head and then using this to calculate the inter-aural delays present between the left and right ear microphones for each head position taken up during the personalization measurements. The loudspeaker-head sample path length is calculated by taking the average value between the left-ear and right-ear impulse onsets. The same value should be found for all head positions used to measure the same loudspeaker, however slight differences may exist and an averaged loudspeaker path may be desirable. The inter-aural path difference is then calculated by subtracting the right-ear path length from the left-ear path length for all pairs of impulses responses for all head positions and for all loudspeakers.</p><p id="p0062" num="0062">The method described this far operates on the raw PRIR data sampled at a rate equal to that of the MLS playback through the excitation loudspeaker. Typically this sampling rate would be the region of 48 kHz. Higher MLS sampling rates are possible and indeed are often preferred when one wishes to run the virtualization system at high sampling rates, e.g., 96 kHz. Higher sampling rates also allow for a more accurate time alignment of the PRIR files and since the variable buffer implementations will typically offer delay steps down to small fractions of a sample period the additional accuracy can easily be exploited. Rather than raise the fundamental sampling rate of the MLS process, it is also possible to over-sample the PRIR data samples to any desired resolution and to time align the impulses based on the over sampled data. Once this is achieved, the impulse data is then down sampled, returning it to its original sampling rate, and stored off for use by the interpolator. Strictly speaking it is only necessary to over sample either the left-ear or right-ear of each impulse pair in order to achieve alignment.</p><heading id="h0013"><u>Impulse response interpolation,</u></heading><p id="p0063" num="0063">Interpolating the time aligned impulse data is relatively straightforward and is implemented linearly based on the listener's head orientation angles sent by the head tracker in real time. The most straightforward implementation interpolates between just two impulses responses, corresponding to two measurement angles either side of the desired nominal viewing angle. However, a significant improvement in performance may be realized by making a third measurement midway between the two outside measurements by taking up a head position that approximates the nominal viewing head orientation.</p><p id="p0064" num="0064">By way of example, the process for such a 3-point linear interpolation is illustrated in <figref idrefs="f0009">FIG. 15</figref>. The time aligned PRIR interpolation process 15, inputs three interpolation coefficients 6, 7 and 8, calculated 9 from an analysis of the head tracker head angle 10, the<!-- EPO <DP n="26"> --> reference head angle 12 and a virtual loudspeaker offset angle 11. The interpolation coefficients are used to scale the amplitude of the impulse response samples output from buffers 1, 2 and 3 respectively, using multipliers 4. The scaled samples are summed 5 and stored 13 and output 14 to the convolver on demand. The impulse response buffers each typically hold many thousands on samples, representing a personalized room impulse response with a reverberation time of 100's of milliseconds. The interpolation process ordinarily steps through all samples held in the buffers 1, 2 and 3 although for reasons of economy and speed, it is possible to run the interpolation over a smaller number of samples and use corresponding samples from one of the impulse response buffers to fill out those locations in 13 that are not interpolated. The process of reading the head tracker angles, calculating the interpolation coefficients and updating the interpolated PRIR data file 13 would ordinarily occur at the virtualizer input audio frame rate or the head tracker update rate. The basic interpolation equation for this illustration is given by: <maths id="math0002" num="(eqn 2)"><math display="block"><mi>Interpolated IR</mi><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>=</mo><mi mathvariant="normal">a</mi><mo>*</mo><mi>IR</mi><mo>â¢</mo><mn mathvariant="normal">1</mn><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>+</mo><mi mathvariant="normal">b</mi><mo>*</mo><mi>IR</mi><mo>â¢</mo><mn mathvariant="normal">2</mn><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>+</mo><mi mathvariant="normal">c</mi><mo>*</mo><mi>IR</mi><mo>â¢</mo><mn mathvariant="normal">3</mn><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>;</mo><mspace width="1em"/><mi>for n</mi><mo>=</mo><mn mathvariant="normal">0</mn><mo>,</mo><mspace width="1em"/><mi>impulse length</mi></math><img id="ib0002" file="imgb0002.tif" wi="150" he="15" img-content="math" img-format="tif"/></maths></p><p id="p0065" num="0065">In this example the impulse response buffers 1, 2 and 3 contain PRIRs that correspond to listener lateral head angles, relative to the reference head angle Î¸ ref 12, of -30 degrees (or 30 degrees anticlockwise), 0 degrees and +30 degrees respectively. The interpolation coefficients in this case would typically be calculated in response to head tracker angle Î¸<sub>T</sub> as follows. First the normalized head tracked angle Î¸ n is given by: <maths id="math0003" num="(eqn 3)"><math display="block"><mi mathvariant="normal">Î¸n</mi><mo>=</mo><mfenced separators=""><msub><mi mathvariant="normal">Î¸</mi><mi mathvariant="normal">T</mi></msub><mo>-</mo><mi mathvariant="normal">Î¸ ref</mi></mfenced><mspace width="1em"/><mi>and constrained to</mi><mspace width="1em"/><mo>-</mo><mn mathvariant="normal">30</mn><mo>&lt;</mo><mi mathvariant="normal">Î¸n</mi><mo>&lt;</mo><mn mathvariant="normal">30</mn></math><img id="ib0003" file="imgb0003.tif" wi="125" he="8" img-content="math" img-format="tif"/></maths><br/>
where the reference head angle Î¸ ref is a fixed head tracker angle corresponding to the desired viewing or listening head angle. If the virtual loudspeaker offset angle is zero then the coefficients are given by: <maths id="math0004" num="(eqn 4L)"><math display="block"><mi mathvariant="normal">a</mi><mo>=</mo><mfenced><mi mathvariant="normal">Î¸ n</mi></mfenced><mo>/</mo><mo>-</mo><mn mathvariant="normal">30</mn><mspace width="3em"/><mi>for</mi><mspace width="1em"/><mo>-</mo><mn mathvariant="normal">30</mn><mo>&lt;</mo><mi mathvariant="normal">Î¸ n</mi><mo>&lt;</mo><mo>=</mo><mn mathvariant="normal">0</mn></math><img id="ib0004" file="imgb0004.tif" wi="118" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0005" num="(eqn 5L)"><math display="block"><mi mathvariant="normal">b</mi><mo>=</mo><mn mathvariant="normal">1.0</mn><mo>-</mo><mi mathvariant="normal">a</mi><mspace width="3em"/><mi>for</mi><mspace width="1em"/><mo>-</mo><mn mathvariant="normal">30</mn><mo>&lt;</mo><mi mathvariant="normal">Î¸ n</mi><mo>&lt;</mo><mo>=</mo><mn mathvariant="normal">0</mn></math><img id="ib0005" file="imgb0005.tif" wi="118" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0006" num="(eqn 6L)"><math display="block"><mi mathvariant="normal">c</mi><mo>=</mo><mn mathvariant="normal">0.0</mn><mspace width="3em"/><mi>for</mi><mspace width="1em"/><mo>-</mo><mn mathvariant="normal">30</mn><mo>&lt;</mo><mi mathvariant="normal">Î¸ n</mi><mo>&lt;</mo><mo>=</mo><mn mathvariant="normal">0</mn></math><img id="ib0006" file="imgb0006.tif" wi="118" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0007" num="(eqn 4R)"><math display="block"><mi mathvariant="normal">a</mi><mo>=</mo><mn mathvariant="normal">0.0</mn><mspace width="3em"/><mi>for</mi><mspace width="1em"/><mn mathvariant="normal">30</mn><mo>&gt;</mo><mi mathvariant="normal">Î¸ n</mi><mo>&gt;</mo><mn mathvariant="normal">0</mn></math><img id="ib0007" file="imgb0007.tif" wi="118" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0008" num="(eqn 5R)"><math display="block"><mi mathvariant="normal">c</mi><mo>=</mo><mfenced><mi mathvariant="normal">Î¸ n</mi></mfenced><mo>/</mo><mn mathvariant="normal">30</mn><mspace width="3em"/><mi>for</mi><mspace width="1em"/><mn mathvariant="normal">30</mn><mo>&gt;</mo><mi mathvariant="normal">Î¸ n</mi><mo>&gt;</mo><mn mathvariant="normal">0</mn></math><img id="ib0008" file="imgb0008.tif" wi="118" he="9" img-content="math" img-format="tif"/></maths> <maths id="math0009" num="(eqn 6R)"><math display="block"><mi mathvariant="normal">b</mi><mo>=</mo><mn mathvariant="normal">1.0</mn><mo>-</mo><mi mathvariant="normal">c</mi><mspace width="3em"/><mi>for</mi><mspace width="1em"/><mn mathvariant="normal">30</mn><mo>&gt;</mo><mi mathvariant="normal">Î¸ n</mi><mo>&gt;</mo><mn mathvariant="normal">0</mn></math><img id="ib0009" file="imgb0009.tif" wi="118" he="8" img-content="math" img-format="tif"/></maths><br/>
and therefore are all bounded by 1 and 0. A virtual loudspeaker offset angle 6v is an angular offset that is added to the normalized head tracked angle to cause a virtual loudspeaker position to be shifted slightly with respect to Î¸ ref, as might be required, for example, to align<!-- EPO <DP n="27"> --> it with a real loudspeakers whose position does not match the measured loudspeaker. A separate Î¸v exists for each virtual loudspeaker. Use of the offsets lead to the head track range, relative to Î¸ ref, to be reduced since the PRIR files held in the three buffers are only representative for a fixed range of head angles - in this example +/- 30 degrees. For example, where Î¸ v <sub>L</sub> represents an offset to be applied to the left front virtual loudspeaker the normalized head tracked angle Î¸ n <sub>L</sub> for this loudspeaker is: <maths id="math0010" num="(eqn 7)"><math display="block"><msub><mi mathvariant="normal">Î¸n</mi><mi mathvariant="normal">L</mi></msub><mo>=</mo><mfenced separators=""><msub><mi mathvariant="normal">Î¸</mi><mi mathvariant="normal">T</mi></msub><mo>-</mo><mi mathvariant="normal">Î¸ ref</mi><mo>+</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">v</mi><mi mathvariant="normal">L</mi></msub></mfenced><mspace width="1em"/><mi>again constrained to</mi><mspace width="1em"/><mo>-</mo><mn mathvariant="normal">30</mn><mo>&lt;</mo><msub><mi mathvariant="normal">Î¸n</mi><mi mathvariant="normal">L</mi></msub><mo>&lt;</mo><mn mathvariant="normal">30</mn></math><img id="ib0010" file="imgb0010.tif" wi="143" he="10" img-content="math" img-format="tif"/></maths></p><p id="p0066" num="0066">This far the discussion has interpolated between a single set of PRIR files, corresponding to a loudspeaker measured at three head angles -30, 0 and +30 degrees. Under normal operation the personalization measurement angles will be arbitrary and almost certainly asymmetrical around the reference Î¸ ref. The more general form of the interpolation equations under these circumstances is given by: <maths id="math0011" num="(eqn 8)"><math display="block"><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>=</mo><mfenced separators=""><msub><mi mathvariant="normal">Î¸</mi><mi mathvariant="normal">T</mi></msub><mo>-</mo><mi mathvariant="normal">Î¸ ref</mi><mo>+</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">v</mi><mi mathvariant="normal">X</mi></msub></mfenced><mspace width="2em"/><mi mathvariant="normal">constrained to Î¸ L</mi><mo>&lt;</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>&lt;</mo><mi mathvariant="normal">Î¸ R</mi></math><img id="ib0011" file="imgb0011.tif" wi="147" he="9" img-content="math" img-format="tif"/></maths> <maths id="math0012" num="(eqn 9)"><math display="block"><mi mathvariant="normal">a</mi><mo>=</mo><mfenced separators=""><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>-</mo><mi mathvariant="normal">Î¸ C</mi></mfenced><mo>/</mo><mfenced separators=""><mi mathvariant="normal">Î¸ L</mi><mo>-</mo><mi mathvariant="normal">Î¸ C</mi></mfenced><mspace width="1em"/><mi mathvariant="normal">for Î¸ L</mi><mo>&lt;</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>&lt;</mo><mo>=</mo><mi mathvariant="normal">Î¸ C</mi></math><img id="ib0012" file="imgb0012.tif" wi="147" he="9" img-content="math" img-format="tif"/></maths> <maths id="math0013" num="(eqn 10)"><math display="block"><mi mathvariant="normal">b</mi><mo>=</mo><mn>1.0</mn><mo>-</mo><mi mathvariant="normal">a</mi><mspace width="2em"/><mi mathvariant="normal">for Î¸ L</mi><mo>&lt;</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>&lt;</mo><mo>=</mo><mi mathvariant="normal">Î¸ C</mi></math><img id="ib0013" file="imgb0013.tif" wi="147" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0014" num="(eqn 11)"><math display="block"><mi mathvariant="normal">c</mi><mo>=</mo><mn>0.0</mn><mspace width="2em"/><mi mathvariant="normal">for Î¸ L</mi><mo>&lt;</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>&lt;</mo><mo>=</mo><mi mathvariant="normal">Î¸ C</mi></math><img id="ib0014" file="imgb0014.tif" wi="147" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0015" num="(eqn 12)"><math display="block"><mi mathvariant="normal">a</mi><mo>=</mo><mn>0.0</mn><mspace width="2em"/><mi mathvariant="normal">for Î¸ R</mi><mo>&gt;</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>&gt;</mo><mi mathvariant="normal">Î¸ C</mi></math><img id="ib0015" file="imgb0015.tif" wi="147" he="7" img-content="math" img-format="tif"/></maths> <maths id="math0016" num="(eqn 13)"><math display="block"><mi mathvariant="normal">c</mi><mo>=</mo><mfenced separators=""><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>-</mo><mi mathvariant="normal">Î¸ C</mi></mfenced><mo>/</mo><mfenced separators=""><mi mathvariant="normal">Î¸ R</mi><mo>-</mo><mi mathvariant="normal">Î¸ C</mi></mfenced><mspace width="1em"/><mi mathvariant="normal">for Î¸ R</mi><mo>&gt;</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>&gt;</mo><mi mathvariant="normal">Î¸ C</mi></math><img id="ib0016" file="imgb0016.tif" wi="147" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0017" num="(eqn 14)"><math display="block"><mi mathvariant="normal">b</mi><mo>=</mo><mn>1.0</mn><mo>-</mo><mi mathvariant="normal">c</mi><mspace width="2em"/><mi mathvariant="normal">for Î¸ R</mi><mo>&gt;</mo><mi mathvariant="normal">Î¸</mi><mspace width="1em"/><msub><mi mathvariant="normal">n</mi><mi mathvariant="normal">X</mi></msub><mo>&gt;</mo><mi mathvariant="normal">Î¸ C</mi></math><img id="ib0017" file="imgb0017.tif" wi="147" he="9" img-content="math" img-format="tif"/></maths><br/>
where Î¸ v <sub>x</sub> is the virtual offset for loudspeaker x, Î¸ n <sub>x</sub> is the normalized head tracked angle for virtual loudspeaker x, Î¸ L, Î¸ C and Î¸ R are the three measurement angles looking to the left, looking to the center and looking to the right respectively referenced to Î¸ ref. The interpolation process is repeated for each left-ear and right-ear PRIR for all virtual loudspeakers, taking into account that the virtual offsets Î¸ v <sub>x</sub> may be different for each loudspeaker.</p><p id="p0067" num="0067">Interpolation can also be achieved when PRIR exist for head positions that include elevation (pitch). <figref idrefs="f0023">FIG. 32a</figref> illustrates an example where five PRIR measurements sets exist for head orientations A 185, B 184, C 177 D 186 and E 187. The interpolation is typically achieved by dividing the area into triangles 188, 189, 190 and 191 determining into which triangle the listener's head angle falls and then calculating the three interpolation coefficients based on where the head angle falls with respect to the three apex measurement points that form the triangle. <figref idrefs="f0023">FIG. 32b</figref> illustrates, by way of example, the current listener's head<!-- EPO <DP n="28"> --> orientation 194 located within triangle whose apexes A, B, and C correspond to three of the original measurement points 185, 184 and 177 respectively. This triangle is sub-divided again as shown where the head angle point 194 forms the new apex for each sub-triangle. Sub-area A' 192 is bounded by the head angle point 177 and apexes B and C. Likewise, sub-area B' 193 is bounded by 194, A and C, and sub-area C' 195 is bounded by 194, A and B. The interpolation equation is given by: <maths id="math0018" num="(eqn 15)"><math display="block"><mi>Interpolated IR</mi><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>=</mo><mi mathvariant="normal">a</mi><mo>*</mo><mi>IRA</mi><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>+</mo><mi mathvariant="normal">b</mi><mo>*</mo><mi>IRB</mi><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>+</mo><mi mathvariant="normal">c</mi><mo>*</mo><mi>IRC</mi><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>;</mo><mspace width="1em"/><mi>for n</mi><mo>=</mo><mn mathvariant="normal">0</mn><mo>,</mo><mspace width="1em"/><mi>impulse length</mi></math><img id="ib0018" file="imgb0018.tif" wi="159" he="12" img-content="math" img-format="tif"/></maths><br/>
where IRA(n), IRB(n) and IRC(n) are the impulse response data buffers corresponding to measurement points A, B and C respectively. The interpolation coefficients a, b and c are given by: <maths id="math0019" num="(eqn 16)"><math display="block"><mi mathvariant="normal">a</mi><mo>=</mo><mi mathvariant="normal">AÊ¹</mi><mo>/</mo><mfenced separators=""><mi mathvariant="normal">AÊ¹</mi><mo>+</mo><mi mathvariant="normal">BÊ¹</mi><mo>+</mo><mi mathvariant="normal">CÊ¹</mi></mfenced></math><img id="ib0019" file="imgb0019.tif" wi="90" he="9" img-content="math" img-format="tif"/></maths> <maths id="math0020" num="(eqn 17)"><math display="block"><mi mathvariant="normal">b</mi><mo>=</mo><mi mathvariant="normal">BÊ¹</mi><mo>/</mo><mfenced separators=""><mi mathvariant="normal">AÊ¹</mi><mo>+</mo><mi mathvariant="normal">BÊ¹</mi><mo>+</mo><mi mathvariant="normal">CÊ¹</mi></mfenced></math><img id="ib0020" file="imgb0020.tif" wi="90" he="7" img-content="math" img-format="tif"/></maths> <maths id="math0021" num="(eqn 18)"><math display="block"><mi mathvariant="normal">c</mi><mo>=</mo><mi mathvariant="normal">CÊ¹</mi><mo>/</mo><mfenced separators=""><mi mathvariant="normal">AÊ¹</mi><mo>+</mo><mi mathvariant="normal">BÊ¹</mi><mo>+</mo><mi mathvariant="normal">CÊ¹</mi></mfenced></math><img id="ib0021" file="imgb0021.tif" wi="90" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0068" num="0068">This method can be used for any of the triangles that make up the original measurement boundaries, to which the head tracker indicates the listener's head is pointing. Many methods exist in the art for calculating the sub areas A', B', and C'. The most accurate methods assume the measurement points A, B, C, D, E and the head position point 194 all lie on the surface of a sphere whose center coincides with the listeners head. If the listener's head yaw and pitch coordinates are given by Ï‰<sub>T</sub>, then, as with the case of the lateral interpolation, it is referenced to the desired viewing yaw and pitch orientation Ï‰ ref and constrained to lie within the measurement 2-dimensional bounds. In the case of <figref idrefs="f0023">FIG. 32a</figref>, the normalized tracker coordinates Ï‰n are defined as: <maths id="math0022" num="(eqn 19)"><math display="block"><mi mathvariant="normal">Ï‰ n</mi><mo>=</mo><mfenced separators=""><msub><mi mathvariant="normal">Ï‰</mi><mi mathvariant="normal">T</mi></msub><mo>-</mo><mi mathvariant="normal">Ï‰ ref</mi></mfenced><mspace width="3em"/><mi>contrained to AB</mi><mo>&lt;</mo><mi mathvariant="normal">Ï‰n</mi><mfenced><mi>yaw</mi></mfenced><mo>&lt;</mo><mi>DE</mi></math><img id="ib0022" file="imgb0022.tif" wi="165" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0023" num="(eqn 20)"><math display="block"><mi>BE</mi><mo>&lt;</mo><mi mathvariant="normal">Ï‰n</mi><mfenced><mi>pitch</mi></mfenced><mo>&lt;</mo><mi>AD</mi></math><img id="ib0023" file="imgb0023.tif" wi="89" he="8" img-content="math" img-format="tif"/></maths><br/>
where AB, DE, AD and BE represent the left, right, upper and lower bounds of the measurement area. Again, a 2-dimensional offset Ï‰v <sub>x</sub> for virtual loudspeaker x can be added to the normalized coordinates Ï‰ n to cause the perceived location of the virtual loudspeaker to be shifted with respect to the reference viewing orientation Ï‰ ref to give, <maths id="math0024" num="(eqn 21)"><math display="block"><msub><mi mathvariant="normal">Ï‰ n</mi><mi mathvariant="normal">X</mi></msub><mo>=</mo><mfenced separators=""><msub><mi mathvariant="normal">Ï‰</mi><mi mathvariant="normal">T</mi></msub><mo>-</mo><mi mathvariant="normal">Ï‰ ref</mi><mo>+</mo><msub><mi mathvariant="normal">Ï‰v</mi><mi mathvariant="normal">X</mi></msub></mfenced><mspace width="3em"/><mi>contrained to AB</mi><mo>&lt;</mo><msub><mi mathvariant="normal">Ï‰n</mi><mi mathvariant="normal">X</mi></msub><mfenced><mi>yaw</mi></mfenced><mo>&lt;</mo><mi>DE</mi></math><img id="ib0024" file="imgb0024.tif" wi="165" he="10" img-content="math" img-format="tif"/></maths> <maths id="math0025" num="(eqn 22)"><math display="block"><mi>BE</mi><mo>&lt;</mo><msub><mi mathvariant="normal">Ï‰n</mi><mi mathvariant="normal">X</mi></msub><mfenced><mi>pitch</mi></mfenced><mo>&lt;</mo><mi>AD</mi></math><img id="ib0025" file="imgb0025.tif" wi="87" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0069" num="0069">The above discussions have assumed that the PRIR measurement head orientations are measured with respect to the reference head orientation. If the PRIR<!-- EPO <DP n="29"> --> orientations are only known relative to each other, then their exact relationship to the reference head orientation may be uncertain. In this case it will be necessary to establish an approximate center reference by calculating the median point of the PRIR. measurement scope and referencing the measurement coordinates to this point. This does not guarantee exact virtual-real loudspeaker alignment during virtualization playback, since this median point may not coincide with the reference head orientation used during their acquisition. Alignment in this case can only be reliability achieved interactively while listening to virtualized loudspeakers over the headphones as described herein.</p><p id="p0070" num="0070">To reduce the computational loading of the interpolation coefficient calculations it is possible to build look-up tables of discrete values during the virtualizer initialization stage. These values would then be read out of the table based on head tracker angles. Such look-up tables could be stored alongside the PRIR data avoiding the need to regenerate the tables every time the PRIR is loaded by the virtualizer initialization routines. The discussions have also made reference to 2-position, 3-poisition and 5-position PRIR interpolation methods by way of example. It will be appreciated that the PRIR interpolation techniques are not confined to these specific examples and can be applied to many combinations of head orientations.</p><heading id="h0014"><u>Pre-interpolated impulse response storage</u></heading><p id="p0071" num="0071">One method of altering the PRIRs in response to changes in the listeners head angles is to calculate, on-the-fly, an interpolated impulse response from some set of sparsely measured PRIRs. An alternative method is to pre-calculate in advance a range of intermediate responses and to have them stored in memory. The head tracker angles, including any offsets, are then used to access these files directly, avoiding the need to generate interpolation coefficients or run the PRIR interpolation process during the real-time virtualization. This method has the advantage that the number of real time memory reads and calculations are lower than the interpolated case. The big disadvantage is that in order to achieve sufficiently smooth transitions between the intermediate responses during dynamic head tracking, many impulse response files are required, making heavy demands on system memory.</p><heading id="h0015"><u>Path length Calculation</u></heading><p id="p0072" num="0072">Since the original left and right-ear PRIRs measured for each loudspeaker and each head position are not necessarily time aligned, i.e., they may exhibit an inter-aural time difference (or delay), then after convolving the left and right-ear audio signals with the time aligned impulse responses it may be necessary to reintroduce this difference by passing the<!-- EPO <DP n="30"> --> convolved audio through variable delay buffers. Inter-aural delays will vary in a sinusoidal fashion only for head movements in the lateral plane (yaw) and for head roll. Elevating (pitch) the head does not affect the arrival times since the pitch axis is essentially aligned with the ears themselves. Hence for personalized measurements where the head position includes both rotation and elevation, it is only the yaw angle of the head tracker that is used to drive the variable delay buffers. Where PRIR data exists for head roll angles other than horizontal, the inter-aural time delay calculation takes into account changes in head tracker roll angle. The maximum extent of either the yaw or roll movements on the inter-aural time delays will ultimately depend on the position of the loudspeaker relative to the listener's head.</p><p id="p0073" num="0073">By way of example, the typical inter-aural path difference Î” between the left and right ear-mounted microphones for the lateral plane measurements of <figref idrefs="f0006">FIGS. 9, 10 and 11</figref> is illustrated in <figref idrefs="f0008">FIG. 13</figref>. Where Î” 149 is positive, as plotted on the y-axis 147, the path length is greatest for the left-ear microphone. The variation of Î” with respect to head rotation is plotted on the x-axis 150 and is approximated by a sinusoid 149, reaching peak values 148 and 155 when the axis through the ears is aligned with the sound source. The solid part of the sinusoid indicates the region of the curve that bounds the three head viewing positions 154, 153 and 151 illustrated in <figref idrefs="f0006">FIGS. 10, 9 and 11</figref> respectively. The amplitude of the sinusoid at these three points represents the path length difference measured from the PRIR data for each head position, and their relative head angle is set off against the x-axis. The path-length interpolation method involves calculating the amplitude of the sinusoid for head angles 150 indicated by the head tracker such that any intermediate path delay can be created between head angles A, B and C. Path length calculations can continue even when the head tracker indicates the head has moved outside the measured bounds as illustrated by the dotted line 149 in <figref idrefs="f0008">FIG. 13</figref>, since the sinusoid is automatically defined for the complete 0-360 degree head turn range.</p><p id="p0074" num="0074">For any particular loudspeaker the sinusoid equation is solved using the path difference and head angle values of at least two of the PRIR measurement points. The basic equations for the points A, B and C are: <maths id="math0026" num="(eqn 23)"><math display="block"><mi>PEAK</mi><mo>*</mo><mi>sin</mi><mfenced><mi mathvariant="normal">Î¸</mi></mfenced><mo>=</mo><msub><mi mathvariant="normal">Î”</mi><mi mathvariant="normal">A</mi></msub></math><img id="ib0026" file="imgb0026.tif" wi="102" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0027" num="(eqn 24)"><math display="block"><mi>PEAK</mi><mo>*</mo><mi>sin</mi><mfenced separators=""><mi mathvariant="normal">Î¸</mi><mo>+</mo><mi mathvariant="normal">Ï‰</mi></mfenced><mo>=</mo><msub><mi mathvariant="normal">Î”</mi><mi mathvariant="normal">B</mi></msub></math><img id="ib0027" file="imgb0027.tif" wi="102" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0028" num="(eqn 25)"><math display="block"><mi>PEAK</mi><mo>*</mo><mi>sin</mi><mfenced separators=""><mi mathvariant="normal">Î¸</mi><mo>+</mo><mi mathvariant="normal">Ï‰</mi><mo>+</mo><mi mathvariant="normal">Îµ</mi></mfenced><mo>=</mo><msub><mi mathvariant="normal">Î”</mi><mi mathvariant="normal">C</mi></msub></math><img id="ib0028" file="imgb0028.tif" wi="102" he="8" img-content="math" img-format="tif"/></maths><br/>
where PEAK is the maximum inter-aural delay when a sound source is perpendicular to the ears, Î¸ is the angle on the sinusoid curve corresponding to measurement point A, Î”<sub>A</sub>, Î”<sub>B</sub>, Î”<sub>C</sub><!-- EPO <DP n="31"> --> are the differential delays for points A, B and C respectively, Ï‰ is the angle subtended between points A and B, and Îµ is the angle subtended between points B and C.</p><p id="p0075" num="0075">Solving for Î¸, and using the first two equations gives: <maths id="math0029" num="(eqn 26)"><math display="block"><mi>Sin</mi><mo>â¢</mo><mfenced separators=""><mi mathvariant="normal">Î¸</mi><mo>+</mo><mi mathvariant="normal">Ï‰</mi></mfenced><mo>/</mo><mi>Sin</mi><mfenced><mi mathvariant="normal">Î¸</mi></mfenced><mo>=</mo><msub><mi mathvariant="normal">Î”</mi><mi mathvariant="normal">B</mi></msub><mo>/</mo><msub><mi mathvariant="normal">Î”</mi><mi mathvariant="normal">A</mi></msub></math><img id="ib0029" file="imgb0029.tif" wi="100" he="9" img-content="math" img-format="tif"/></maths></p><p id="p0076" num="0076">Since at least two head angles define the listener scope and associated with these angles are left and right-ear PRIR data sets that exhibit known path differences Î”, (for example Î”<sub>A</sub> and Î”<sub>B</sub>) and the angular displacement Ï‰ between the head angles is also known, then Î¸ can be readily determined by iteration. Due to measurement inaccuracies, it may be desirable to create a second ratio where additional measurements exist, say Î”<sub>C</sub> / Î”<sub>A</sub> in this example, in order to confirm the results of the first, or to generate an average. The amplitude of the sinusoid, PEAK, can then be found by substitution. The above method is repeated for all left-ear and right-ear sets of loudspeaker PRIR data. The general path difference equation for virtual loudspeaker x is given as, <maths id="math0030" num="(eqn 27)"><math display="block"><msub><mi mathvariant="normal">Î”</mi><mi mathvariant="normal">X</mi></msub><mo>=</mo><msub><mi>PEAK</mi><mi mathvariant="normal">X</mi></msub><mo>*</mo><mi>sin</mi><mfenced separators=""><msub><mi mathvariant="normal">Î¸</mi><mi mathvariant="normal">X</mi></msub><mo>+</mo><mi mathvariant="normal">Ï</mi></mfenced></math><img id="ib0030" file="imgb0030.tif" wi="106" he="9" img-content="math" img-format="tif"/></maths><br/>
where Ï is an angle related to the listener's head rotation. More specifically, since the original measurement points are referenced to Î¸ ref, the listener's head angle Î¸ t, as indicated by the tracker, is appropriately offset to give the normalized listener head angle Î¸ n: <maths id="math0031" num="(eqn 28)"><math display="block"><mi mathvariant="normal">Î¸n</mi><mo>=</mo><mfenced separators=""><mi mathvariant="normal">Î¸ t</mi><mo>-</mo><mi mathvariant="normal">Î¸ ref</mi></mfenced></math><img id="ib0031" file="imgb0031.tif" wi="106" he="9" img-content="math" img-format="tif"/></maths><br/>
This angle would typically be constrained to within the angular limits of the measurement points, but this is not strictly necessary since the path differences can be calculated correctly for all head angles. The same is true when applying the virtualized loudspeaker offsets Î¸ v <sub>x</sub> <maths id="math0032" num="(eqn 29)"><math display="block"><msub><mi mathvariant="normal">Î¸n</mi><mi mathvariant="normal">X</mi></msub><mo>=</mo><mfenced separators=""><mi mathvariant="normal">Î¸ t</mi><mo>-</mo><mi mathvariant="normal">Î¸ ref</mi><mo>+</mo><msub><mi mathvariant="normal">Î¸v</mi><mi mathvariant="normal">X</mi></msub></mfenced></math><img id="ib0032" file="imgb0032.tif" wi="103" he="9" img-content="math" img-format="tif"/></maths></p><p id="p0077" num="0077">The normalized head angle is now referenced to the sinusoid function of <figref idrefs="f0008">FIG. 13</figref>. The path length angle for each virtual loudspeaker Î¸ <sub>Î”X</sub> is calculated by subtracting the left most measurement angle Î¸A from the normalized head angle: <maths id="math0033" num="(eqn 30)"><math display="block"><msub><mi mathvariant="normal">Î¸</mi><mi mathvariant="normal">Î”X</mi></msub><mo>=</mo><mfenced separators=""><msub><mi mathvariant="normal">Î¸n</mi><mi mathvariant="normal">X</mi></msub><mo>-</mo><mi mathvariant="normal">Î¸A</mi></mfenced></math><img id="ib0033" file="imgb0033.tif" wi="101" he="9" img-content="math" img-format="tif"/></maths><br/>
Hence when the normalized angle equals the left measurement point the path length angle Î¸<sub>Î” x</sub> is zero. The path length difference for loudspeaker x is now calculated using <maths id="math0034" num="(eqn 31)"><math display="block"><msub><mi mathvariant="normal">Î”n</mi><mi mathvariant="normal">X</mi></msub><mo>=</mo><msub><mi>PEAK</mi><mi mathvariant="normal">X</mi></msub><mo>*</mo><mi>sin</mi><mfenced separators=""><msub><mi mathvariant="normal">Î¸</mi><mi mathvariant="normal">X</mi></msub><mo>+</mo><msub><mi mathvariant="normal">Î¸</mi><mi mathvariant="normal">Î”X</mi></msub></mfenced></math><img id="ib0034" file="imgb0034.tif" wi="106" he="9" img-content="math" img-format="tif"/></maths><br/>
Typically the sine function would be calculated using a subroutine or it would be estimated using some form of discrete look-up table.<!-- EPO <DP n="32"> --></p><p id="p0078" num="0078">The above explanation has focused on the example of lateral head rotation (yaw). Changes in head elevation (pitch) do not affect the inter-aural delays. This implies the choice of pitch angle is not important when it comes to constructing the sinusoidal function from their PRIR data sets. Where head roll is to be used to adjust the virtualized inter-aural delays then the same general approach can be taken using the inter-aural time delays measured from the PRTR data acquired for the different roll angles. In this case the inter-aural delays calculated from yaw head movements are modified based on the extent of the roll angle. Various procedures are available to implement such a 2-dimensional interpolation process and are well understood in the art. Moreover, the illustrations used to explain the yaw path length calculation have focused on a 3-point PRIR configuration. It will be appreciated that the path length formula can be constructed using a wide range of combinations of PRIR head orientations.</p><p id="p0079" num="0079">Apart from inter-aural (differential) delays that exist between the ears for any one loudspeaker, potentially path length differences exist between the various loudspeakers. That is, the loudspeakers may not be equidistant from the listener's head. The inter-loudspeaker differential delays are calculated by first identifying the shortest path length, i.e., the loudspeaker nearest the listener's head, and subtracting this value from itself and all the other loudspeaker path length values. These differential values can become a fixed element of the adaptive delay buffers created to implement the inter-aural delay processing. Alternatively it may be more desirable to implement these delays in the audio signal paths prior to their being split up to feed the variable inter-aural delay buffers or PRIR convolvers - whichever come first.</p><p id="p0080" num="0080">The common loudspeaker delay, i.e., the minimum path length to the head, can be implemented at any stage of the process using fixed delay buffers. Again it may be desirable to delay the inputs to the virtualizer or, alternatively, if the delay is sufficiently small that it does not introduce significant head tracking latency, it can be introduced into the headphone signal feed at the output of the virtualizer. Often however, the virtualizer hardware implementation itself will exhibit a significant signal processing delay, or latency, and so the minimum loudspeaker path delay would ordinarily be reduced by the amount of the hardware latency, and may not be required at all.</p><heading id="h0016"><u>Manually-formulated Path length Calculator</u></heading><p id="p0081" num="0081">The discussion this far has described a method of determining the path length equations and/or associated look-up tables, by analyzing the PRIR data. If the relationships between PRIR head orientation angles and the PRIR loudspeakers are already known then it<!-- EPO <DP n="33"> --> is possible to build the path length formula directly using this data. For example, if the user was to wear a head tracker while making the PRIR measurements then the PRIR angles would already be known. If, in addition, the positions of the loudspeakers were also known, with respect to the reference orientation, then it is possible to formulate the path length equations directly without any further analysis. To support such a method it would be necessary for the user to manually enter the locations of their loudspeakers into a virtualizer to allow the calculations to be made. These locations would be referenced to the same coordinates used to measure the PRIR head angles. The PRIR head angles could also be entered in the same way, or they could be sampled from the head tracker during the PRIR procedure.</p><p id="p0082" num="0082">Once the PRIR head angles and loudspeaker locations are installed in the virtualizer this data can be stored alongside the PRIR data, allowing the path length formula to be regenerated each time the PRIR is loaded by the virtualizer initialization routines.</p><heading id="h0017"><u>Implementation of a variable delay buffer</u></heading><p id="p0083" num="0083">Digital variable delay buffers are well known and many efficient implementations exist in the art. <figref idrefs="f0011">FIG. 17</figref> illustrates a typical implementation. The variable delay buffer 17 over samples 18 the input stream by inserting zeros between the samples, and then low pass filters 19 to reject image aliases. The samples enter the top of a fixed length buffer 25, and the contents of this buffer are systematically shuffled downwards to the bottom on each over sampled period. Samples are read out of a buffer location whose address 20 is determined by the inter-aural time delay calculator 24 driven by the listeners head orientation, the reference angles and any virtual loudspeaker offset, 10, 11 and 12. For example, in the absence of head roll angles, this calculator would take the form of equation 31. The samples read from the buffer are down sampled 22 and the remaining samples output. The delay of the buffer is affected by changing the address 20 of the location from where the samples are read and this can occur dynamically while the virtualizer is running. The delay can range from zero, where the output samples are fetched from the top of the buffer, to the sample size of the buffer itself, where the output samples are fetched from the bottom most location. Typically the over sampling rate 18 is in the order of 100s to ensure that the action of changing the output address does not cause audible artifacts.</p><heading id="h0018"><u>Pre-calculated path lengths</u></heading><p id="p0084" num="0084">One method of altering the inter aural path lengths in response to changes in the listeners head angles is to calculate the variable delay path lengths based on the sinusoid function via an on-the-fly calculation or through some type of sine look-up table. An<!-- EPO <DP n="34"> --> alternative method is to pre-calculate in advance a range of path lengths, for each loudspeaker, that cover the expected head movement range and to store these in look-up tables. The discrete path length values would then be accessed in response to varying head tracker angles.</p><heading id="h0019"><u>Matching Virtual-Real Loudspeaker perceived distance</u></heading><p id="p0085" num="0085">While humans are relatively insensitive to differences in perceived distances of sound sources, large differences in distance between the listener and the loudspeaker used to make personalized measurements and between the listener and the actual loudspeaker being used to visually reinforce the virtual image will be difficult to reconcile psycho-acoustically. The problem is particularly apparent when the viewing screen is relatively close to the listener's head, for example airplane and in-car entertainment systems. Moreover, in these circumstances it is often impractical to personalize such playback systems. For this reason, examples of the disclosure include a method that modifies the personalized room impulse responses themselves in order to change the perceived virtual loudspeaker distance. The modification involves identifying the direct portion of the personalized room impulse response, specific to the loudspeaker in question, and changing its amplitude and position, relative to the latter reverberant portion. If this modified room impulse response is now used in the virtualizer, the apparent distance of the virtual loudspeaker will be altered to some degree.</p><p id="p0086" num="0086">An illustration of such a modification is shown in <figref idrefs="f0007">FIG. 12</figref>. In this example the original impulse response (the upper trace) projects a virtual loudspeaker that is perceived to be too far away from the physical loudspeaker, and the modification attempts to shorten this distance (the bottom trace). Typically the direct portion of a personalized room response 161 will comprise the first 5 to 10ms of the waveform beginning from the impulse onset 162 and is defined by that part of the response that represents the impulse wave that arrives at the microphone directly from the loudspeaker prior to the arrival of any room reflections 164.</p><p id="p0087" num="0087">The direct portion of the impulse 161 between the onset 162 and first reflection 164 is copied to the modified impulse response 163 without alteration. The perceived distance of a loudspeaker is heavily influenced by the relative amplitude of the direct and reverberant portions of the impulse response, the closer the loudspeaker the greater the energy in the direct signal relative to the reflected signal. Since sound levels fall off by the inverse square of the distance from the source, if one was attempting to halve the perceived distance between the virtual and real loudspeakers then the reverberant portion would be attenuated by a factor of 4. Hence, the amplitude of the impulse response starting from the onset of the first<!-- EPO <DP n="35"> --> room reflection 164 to the end of the room impulse response 165 is adjusted appropriately and copied to the modified impulse response 163. In this example the time between the end of direct portion 166 and the start of the first reflection 167 is artificially increased by padding-out the impulse samples with zeros. This simulates the fact that the relative arrival times of the direct and reverberant portions will increase the closer a subject gets to the loudspeaker sound source. To make a loudspeaker sound more distant the modification to the impulse is done in a reverse manner - the direct portion of the impulse is attenuated relative to the reverberant portion and the arrival time can be shortened by removing impulse samples just prior to the first reflection.</p><heading id="h0020"><u>Adjusting off-center listening positions</u></heading><p id="p0088" num="0088">Even when the same loudspeaker arrangement is maintained for both personalization and listening activities, virtual-real loudspeaker alignment may not be achieved if the listening position is not the same as that used to make the personalization measurements. This problem would typically arise when, for example, more than one person is listening to the music, or watching the movie, simultaneously - in which case one or more individuals could be positioned a short distance off the desired sweet-spot. Small positional errors such as these can be easily compensated for using the techniques described herein. First, an offset in the listening position relative to the measurement position can change the lateral and height coordinates of the real loudspeakers relative to the central viewing orientation - the degree of change being different for each loudspeaker and dependant on the magnitude of the listening position offset error. If the positions of the real loudspeakers are known, then to realign them with the virtual loudspeakers, an interpolator offset, Ï‰v (or Î¸v) is deployed separately for each loudspeaker using the method described herein. Second, the distance between the listener's head and the real loudspeakers may no longer match the perceived virtual distance. Since the original distances are known, being a by-product of the personalization measurements, the distance error for each virtual loudspeaker can be calculated and the respective room impulse response data modified using the techniques described herein to remove the discrepancy.</p><heading id="h0021"><u>Head movements that fall outside the measured scope</u></heading><p id="p0089" num="0089">Disclosed herein are a number of methods that can be deployed to deal with situations were the listeners head movement exceeds the limits of the personalization measurement boundary, i.e., falls outside the scope of the head tracked de-rotation process, for example the dotted line 179 illustrated in <figref idrefs="f0022">FIG. 31</figref>. The most basic method simply freezes the interpolation process for any axis the head tracker indicates a breach of the boundary has<!-- EPO <DP n="36"> --> occurred and holds the value until the head moves back into range. The effect of this method is that virtual loudspeaker images may possibly follow the head motion for orientations outside the scope but will stabilize once inside scope.</p><p id="p0090" num="0090">Another method permits the differential path length calculation process to continue to adapt outside the scope (eqn 31), leaving the impulse response interpolation fixed at the last value used prior to breaching the scope boundary. The effect of this method is that only the high frequencies emanating from the virtual loudspeakers are likely to move with the head outside scope.</p><p id="p0091" num="0091">A further method forces the amplitude of the virtualizer outputs to be attenuated outside the scope using some type of head position attenuation profile. This can be used in combination with any of the prior methods. The effect of the attenuation is to create an acoustical window, whereby sound comes from the virtual loudspeakers only when the user is looking in the vicinity of the personalized zone (scope). This method does not need to begin attenuating the audio immediately after the head crosses outside the scope boundary, for example, in the case where only lateral measurements have been made (as illustrated in <figref idrefs="f0021">FIGS. 29 and 30</figref>), it is desirable to allow significant deviations in elevation (pitch), i.e., above and below the measurement center line 179, before triggering the attenuation process. One psycho-acoustical benefit of the attenuation method is that it significantly reinforces the virtual sound stage since it minimizes the likelihood of the listener being subjected to the illusion diminishing effect of sound image rotation. Another benefit of the attenuation method is that it allows the user to easily control the volume applied the headphones, for example, by turning their head away from the movie screen the listener can effectively mute the headphones.</p><p id="p0092" num="0092">The final method involves extending the personalization scope artificially using room impulse response data associated with other virtual loudspeakers in the same personalized data set. The method is particularly useful for multi-channel surround sound type loudspeaker systems (<figref idrefs="f0025">FIG. 34a</figref>) where there are sufficient loudspeakers to permit a reasonably accurate virtualization experience over the full +/-180 degree head turn range. However, the method does not guarantee that the virtual loudspeakers will sonically match those of the real loudspeakers since, by extending the interpolation zone, it may be necessary to use room impulse response data measured using loudspeakers positioned in locations other than the one being virtualized.</p><p id="p0093" num="0093">Apart from sonic mismatches, the method is also problematic in that loudspeakers arranged in a surround sound system may not be positioned equidistant nor at the same<!-- EPO <DP n="37"> --> elevation and thus where the personalization is conducted on a single lateral plane it may be difficult to retain an accurate alignment between the virtual and real loudspeakers as the listener's head moves through the extended scope. Where the personalization measurements include an elevation element then these height mismatches can be compensated for, dynamically as the head turns, using an interpolator offset as discussed earlier. Differences in loudspeaker distance can also be corrected dynamically, as the head rotates, using the techniques already discussed.</p><p id="p0094" num="0094">The method is illustrated in <figref idrefs="f0025">FIG. 34b</figref> using a common 5-channel surround sound loudspeaker format and depicts the various interpolation combinations that are deployed to virtualize the left front loudspeaker 200 (<figref idrefs="f0025">FIG. 34a</figref>) as the listener turns through 360 degrees. The illustration of <figref idrefs="f0025">FIG. 34a</figref> is a plan view and sets out the angular relationship between the listener 79, located in the center of imaginary circle 201, and the five loudspeakers, center 196, right front 197, right surround 198, left surround 199 and left front 200 positioned on imaginary circle 201. The front center loudspeaker 196 represents the 0 degree direction and is the direction the listener would take when viewing center screen. The left front loudspeaker 200 is positioned -30 degrees from center screen, right front loudspeaker 197 is +30 degrees from screen center, left surround loudspeaker 199 is -120 degrees from screen center and right surround loudspeaker 198 is +120 from screen center.</p><p id="p0095" num="0095"><figref idrefs="f0025">FIG. 34b</figref> assumes that personalization measurements have been carried out on a single lateral plane and that all five loudspeakers where measured for three viewing points consisting of the left front 200, screen center 196 and right front 197 loudspeakers respectively providing a scope of +/- 30 degrees on the lateral plane (previously illustrated in <figref idrefs="f0021">FIG. 30</figref>). <figref idrefs="f0025">FIG. 34b</figref> depicts the combinations of personalized data sets 202, 203, 204, 205, 206, 207 and 208 used by the interpolator to virtualize the left front loudspeaker 200 as the listener's head moves through the full 360 degrees. Since the personalization measurements for all loudspeakers were made viewing the three front loudspeaker positions, then for head angles that stay within this range (+/-30 degrees from center screen) 202 the interpolator uses the three sets of room impulse responses measured using the real left front loudspeaker. This is the normal mode of operation.</p><p id="p0096" num="0096">When the head moves beyond the left front loudspeaker into the region -30 to -90 degrees 208, the interpolator can no longer use the left front loudspeaker data and the interpolator is forced to deploy the three sets of room response impulse data measured for the right front loudspeaker. In this case the head rotation angle input to the interpolator is offset clock-wise by 60 degrees to force the right front loudspeaker impulse data to be correctly<!-- EPO <DP n="38"> --> accessed as the head turns through this zone. If the sonic characteristics of the left and right front loudspeakers are similar and they are positioned at the same elevation, then the change over will be seamless and the user should not normally be aware of the loudspeaker data mismatch.</p><p id="p0097" num="0097">For head angles between -90 and -120 degrees 207, the virtualizer interpolates between the room impulse response data measured for the right loudspeaker when the user is looking at the left front loudspeaker, and the room impulse response data measured for the right surround loudspeaker when the user is looking at the right front loudspeaker.</p><p id="p0098" num="0098">For head angles between -120 and -180 degrees 206 the interpolator uses the three sets of room impulse response data measured for the right surround loudspeaker with the appropriate angular offset applied to the interpolator.</p><p id="p0099" num="0099">For head angles between 180 and 120 degrees 205, the virtualizer interpolates between the room impulse response data measured for the right surround loudspeaker looking at the left front loudspeaker, and the room impulse response data measured for the left surround loudspeaker looking at the right front loudspeaker.</p><p id="p0100" num="0100">For head angles between 120 and 60 degrees 204 the interpolator uses the three sets of room impulse response data measured for the left surround loudspeaker again with the appropriate angular offset applied to the interpolator.</p><p id="p0101" num="0101">For head angles between 60 and 30 degrees 203, the virtualizer interpolates between the room impulse response data measured for the left surround loudspeaker looking at the left front loudspeaker, and the room impulse response data measured for the left front loudspeaker looking at the right front loudspeaker. It will be apparent to those skilled in the art that the techniques just described and illustrated in FIG. F can easily be applied to entertainment systems with more or less loudspeakers and it can be applied to personalized data sets made using both lateral (yaw) and elevation (pitch) head orientations.</p><heading id="h0022"><u>Mixing personalized and non-personalized room impulse responses</u></heading><p id="p0102" num="0102">Experiments undertaken by the inventor strongly suggest that the accuracy of virtualization is highly dependant on the deployment of the listeners own personalized room impulse response (PRIR) data. However it has also been found that the loudspeakers that are ordinarily out of sight are less critical of the accuracy of the personalized data and indeed it is often possible to use non-personal room impulses, or those acquired using a dummy head, without serious loss of rear virtualization illusion. Therefore, combinations of personalized and non-personalized, or generic, room responses to virtualize multi-channel loudspeaker configurations may be employed. This mode of operation is likely where the user does not<!-- EPO <DP n="39"> --> have time to make the necessary measurements, or where it is impractical to arrange the loudspeakers in the desired positions for measuring. Generic room impulse responses (GRIRs) take the same form as PRIRs, i.e., they represent a sparse sampling of a loudspeaker over a typical listener's head movement range or scope. Processing of the GRIR would also be similar, i.e., the inter-aural delays would be logged, the impulse waveforms time aligned and then the inter-aural delays reinstated using the variable delay buffer, and the interpolator generate intermediate impulse response data, driven dynamically by the listeners head position.</p><heading id="h0023"><u>Automatic Level Adjustment for Personalized Measurement Procedure</u></heading><p id="p0103" num="0103">Impulse response measurements made using the MLS technique become inaccurate in the presence of non-linearity in the recorded signals fed back to the circular cross-correlation processor. Non-linearity typically arises as a result of clipping at the analogue to digital conversion stage following the microphone amplifiers, or distortion in the loudspeaker transducer or loudspeaker amplifier as a result of overdriving. This implies that for robust MLS personalized room impulse response measurement methods it may be necessary to control the signals levels at each stage of the measurement chain during the measurement.</p><p id="p0104" num="0104">In one example a MLS level scaling method that is used prior to each personalized measurement session is disclosed. Once the appropriate MLS level has been determined, the resulting scale factor is used to set the MLS volume level during all subsequent personalized measurements for the particular room-speaker setup and human subject. By using a single scale factor during the personalized room impulse response acquisitions, additional scaling or inter-aural level adjustments are unnecessary prior to their deployment in the virtualizer engine.</p><p id="p0105" num="0105"><figref idrefs="f0016">FIG. 23</figref> illustrates a typical 5-channel loudspeaker MLS personalization setup. The human subject (plan view) 79 is surrounded by five loudspeakers (also plan view), and is situated at the desired measurement point, looking towards the front center loudspeaker, and has mounted in each ear, microphones whose outputs are connected to microphone amplifiers 96. The MLS, output from 98, is scaled 4 by multiplying with scale factor 101. The adjusted MLS signal 103 is input to a 1-to-5 inverse multiplexer 104 whose outputs 105 each drive one of the five loudspeakers via digital-to-analogue converters 72 and variable gain power amplifiers 106. <figref idrefs="f0016">FIG. 23</figref> specifically illustrates the MLS signal 98 being routed to the front left loudspeaker 88. The ear-mounted microphones pick up the MLS sound waves radiated<!-- EPO <DP n="40"> --> by loudspeaker 88 and these signals are amplified 96 and digitized 99 and their peak amplitudes analyzed 97 and compared to a desired threshold level 100.</p><p id="p0106" num="0106">The test begins with the loudspeaker amplifier volume 106 set high enough to allow a full scale MLS signal presented by the loudspeakers to generate a sound pressure level at the ear mounted microphones that will result in a microphone signal level that will reach or exceed the desired threshold level 100. If there is any doubt, the volume is left at its maximum setting and is not adjusted again until all the personalized room impulse responses have been acquired. The level measurement routine begins with the MLS scaled to a relatively low level, say -50dB. Since the MLS output from 98 is generated internally at digital peak level (i.e., 0dB) this results in the MLS arriving at the DACs 50dB below their digital clip level. The attenuated MLS is played out to just one loudspeaker, selected by 104, for a period long enough to allow the real-time measurement at 97 to reliably determine the peak level. In one example a period of 0.25 seconds is used. This peak value at 97 is compared to a desired level 100 and if neither of the recorded MLS microphone signals is found to exceed this threshold, the scale factor attenuation is reduced slightly and the measurement repeated.</p><p id="p0107" num="0107">In one example the scale factor attenuation is reduced in steps of 3 dB. This process of incrementally boosting the amplitude of the MLS drive to the loudspeakers and testing the resultant microphone pickup level continues until either of the microphone signals exceeds the desired level. Once the desired level has been reached, the scale factor 101 is retained for use in the actual personalization measurements. The MLS level test can be repeated for all loudspeakers to be subjected to the personalization measurement, by selecting alternative loudspeakers to test using 104. hi this case the scale factors for each loudspeaker are held until all loudspeakers have been tested and the scale factor with the highest attenuation is retained for all subsequent personalization measurements.</p><p id="p0108" num="0108">To maximize the signal-to-noise ratio of the MLS derived personalized room impulse responses the desired level threshold 100 should be set close to the digital clip level. Normally however, it is set some way below clip to provide a margin for error. Moreover, if the MLS sound pressure level is uncomfortable for the human subject, or the measurement chain has insufficient gain such that there is a risk of overdriving the loudspeaker or amplifier, then this level may be reduced further.</p><p id="p0109" num="0109">The MLS level test is abandoned if the scale factor 101 reaches a value of 1.0 (0dB) and the measured MLS level remains below the desired level 100. The test is also abandoned if the measured microphone levels do not increase in proportion to that of the<!-- EPO <DP n="41"> --> scale factor iteration step. That is, if the scale factor attenuation is reduced by 3dB at each step, then the microphone signal levels should increase by 3dB. A fixed signal level on any microphone normally indicates a problem with the microphones, loudspeaker, amplifiers and/or their interconnections.</p><p id="p0110" num="0110">The discussion above has made reference to specific step sizes and threshold values. It will be appreciated that a wide range of step sizes and thresholds may be applied to the method.</p><heading id="h0024"><u>Personalization measurements using direct loudspeaker connection</u></heading><p id="p0111" num="0111">Performing the personalized room impulse response (PRIR) measurements requires that an excitation signal be output through selected loudspeakers in real time and for the resulting room response to be recorded using ear mounted microphones. One example uses the MLS technique for making these measurements and this signal is selectively switched into the DACs prior to the power amplification stages of a typical AV receiver design. A configuration that has direct access to the loudspeaker signal feeds is illustrated in <figref idrefs="f0018">FIG. 26</figref>. The multi-channel audio inputs 76 are input via analogue-to-digital converters (ADC) 70 and connect both to the headphone virtualizer 122 inputs and to a bank of 2-way digital switches 132. Ordinarily the switches 132 are set to allow the audio signals 121 to pass through to the digital-to-analogue (DAC) converters 72 and drive the loudspeakers via variable gain power amplifiers 106. This would be the normal mode of operation and gives the user the option of listening either to the audio over the loudspeakers or the headphones. However, when the user wishes to begin a personalization measurement the virtualizer 123 isolates the loudspeakers by changing over switches 132 and a scaled digital MLS signal 103 is routed 104 to one of the loudspeakers instead, with all the remaining loudspeakers feeds muted. The virtualizer can select different loudspeakers to test by changing the MLS routing 104. After all MLS tests are complete, switches 132 are typically reset to allow the audio signals 121 to again pass to the loudspeakers.</p><heading id="h0025"><u>Personalization measurements using outboard processors</u></heading><p id="p0112" num="0112">Certain product designs are envisaged that do not have access to the loudspeaker signal paths as described above, for example when the headphone virtualizer is designed as a separate out-board processor and the multi-channel audio signals are decoded from an incoming coded bit stream. In many cases it would be cost prohibitive to include separate outputs from the virtualizer processor that could be connected to an external line-level switching systems, as would be required to send MLSs out to selected loudspeakers. While it is possible to play the excitation signal from a CD or DVD disc, via a coded digital bit<!-- EPO <DP n="42"> --> stream, it is inconvenient since it is not easy to interrupt the disc play once it begins. This would mean that simple tasks such as MLS level adjustments, head stabilization or skipping loudspeaker measurements are manually guided by the user, or assistant, dramatically increasing the difficulty and duration of the personalization process.</p><p id="p0113" num="0113">Disclosed herein is a method that uses industry standard multi-channel coding systems to provide access to the loudspeakers in an AV receiver type design with minimal overhead and cost. Such a system is illustrated in <figref idrefs="f0019">FIG. 27</figref>. The headphone virtualizer 124 houses the virtualizer 123 complete with headphone, head tracker and microphone i/o 72, 73, 96 and 99, a multi-channel decoder 114 and S/PDIF receiver 111 and transmitter 112. An external DVD player 82 connects to 124 via a digital SPDIF connection, transmitted 110 from the DVD player and received by the virtualizer using an internal SPDIF receiver 111. This signal is passed to the internal multi-channel decoder 114 and the decoded audio signals 121 passed to the virtualizer core processor 122. Ordinarily the switch 120 is positioned to allow the SPDIF data from the DVD player to pass directly to an internal SPDIF transmitter 112 and on to the AV receiver 109. The AV receiver decodes the SPDIF data stream and the resulting decoded audio signals are output to the loudspeakers 88 via variable gain power amplifiers 106. This would be the normal mode of operation and gives the user the option of listening either to the audio over the loudspeakers or the headphones, without having to make any changes to the inter-equipment signal connections.</p><p id="p0114" num="0114">However, when the user wishes to begin a personalization measurement the virtualizer 123 isolates the SPDIF signal from the DVD player by changing over switch 120 and a coded MLS bit stream, output from multi-channel encoder 119, passes out to the AV receiver 109 instead. The generated MLS samples 98 are gain ranged 4 and 101 prior to their encoding 119. Since only one audio channel is measured at any one time, the MLS is directed by the virtualizer to that specific input channel of the multi-channel encoder the virtualizer wishes to measure. All other channels would ordinarily be muted. This has the advantage that the encoding bit allocation can concentrate the available bits solely to the channel carrying the MLS and so minimize the effects of the encoding system itself. The MLS encoded bit stream is transmitted in real time to the AV receiver 109 where the MLS is decoded to PCM using a compatible multi-channel decoder 108.</p><p id="p0115" num="0115">The PCM audio is output from the decoder and the MLS passes through to the desired excitation loudspeaker 88. Simultaneously, the human subject's 79 left and right ear-mounted microphones pick up the resulting sounds and relay them, 86a and 86b to the microphone amplifiers 96 for processing by the MLS cross-correlation process 97. All other<!-- EPO <DP n="43"> --> loudspeakers will remain silent since their audio channels were muted during the encoding process 119. The method is reliant on the presence of a compatible multi-channel decoder within the AV receiver. Presently audio encoded using, e.g., the Dolby Digital, DTS (see, e.g., <patcit id="pcit0012" dnum="US5978762A"><text>U.S. Patent No. 5,978,762</text></patcit>) or MPEG I methodologies can be decoded using the vast majority of existing consumer entertainment equipment. The method will work well with all three types of encoding, but all will introduce some distortion to the MLS or excitation waveform, leading to a slight reduction of PRIR fidelity. Nevertheless, the DTS and MPEG systems can operate at higher bit rates and have forward adaptive bit allocation systems that can be modified to better exploit the fact that only one audio channel is active, and so may alter the excitation waveform less than the Dolby system. Moreover, the DTS system provides up to 23-bit quantization and perfect-reconstruction in certain modes of operation and this may result in even lower excitation distortion levels over the MPEG system.</p><p id="p0116" num="0116">In <figref idrefs="f0019">FIG. 27</figref> the MLS is generated 98, scaled 4 and then encoded 119 in real time on its way to the excitation loudspeaker. Another method is to hold in memory pre-encoded blocks of encoded MLS data, each representing a different excitation channel over a range of amplitudes. The encoded data need only represent a single MLS block, or small number of blocks, since they can be repeatedly output in a loop to the decoder during the MLS measurement. The benefit of this technique is that the computational loading is much lower, since all encoding has been done off-line. The disadvantage of the pre-encoded MLS method is that significant memory is required to store all the pre-encoded MLS data blocks. For example, a full bit rate DTS (1.536Mbps) encoded 15-bit MLS block would require approximately 1Mbit of storage for each channel and for each amplitude value.</p><p id="p0117" num="0117">Raw MLS blocks are not readily divisible by the encoding frame sizes offered by coding systems. For example, a bi-level 15-bit MLS comprises 32767 states, whereas coding frame size multiples of 384, 512, and 1536 samples are only available from MPEG I, DTS and Dolby respectively. Where it is desirable to play the encoded MLS blocks in a continuous end-to-end loop, an integer number of coding frames cover the MLS block sample length exactly. This implies that the MLS is first re-sampled in order to adjust its length so that is divisible by the coding frames. For example, the 32767 samples could be re-sampled to increase its length by one sample to 32768 and then encoded into 64 sequential DTS coded frames. The MLS cross-correlation processor then uses this same re-sampled waveform to effect the MLS de-convolution.</p><p id="p0118" num="0118">A way of avoiding having to store a range of pre-encoded MLS amplitudes for each loudspeaker is instead to alter the scale factor gains, associated with the encoded audio<!-- EPO <DP n="44"> --> channel that carries the excitation audio, by directly manipulating the scale factor codes embedded in the bit stream, prior to sending it out to the AV receiver. Adjustment of the bit stream scale factors will proportionately affect the amplitude of the decoded excitation waveform with out loss of fidelity. Such a process would reduce the number of pre-encoded blocks to be stored to just a single block per loudspeaker. This technique is particularly applicable to DTS and MPEG encoded bit streams due to their forward adaptive nature.</p><p id="p0119" num="0119">A further variation in the method involves compiling the bit streams from their pre-encoded elements prior to each loudspeaker test. For example, since only one channel is active at any one time, then in theory it may be necessary only to store the bit stream elements for a single encoded excitation audio channel. For every loudspeaker the virtualizer wishes to test, the raw encoded excitation data is repacked into the desired bit stream channel slot, muting out all other channel slots, and the stream output to the AV receiver. This technique can also make use of the scale factor adjustment process just described. In theory all channels and all amplitudes can be represented by just a single 1Mbit file, in the case of a full bit rate DTS stream format.</p><p id="p0120" num="0120">Although the MLS is one possible excitation signal, the method of using an industry standard multi-channel encoder, or pre-encoded bit streams, to carry the excitation signal to a remote decoder in order to simplify access to the loudspeakers, is equally applicable to other types of excitation waveforms such as impulses and sine waves.</p><heading id="h0026"><u>Head Stabilization during Personalization Measurements</u></heading><p id="p0121" num="0121">Background noise and head movement during the MLS based acquisition process both conspire to reduce the accuracy of the resultant personalized room impulse response (PRIR). Background noise directly affects the broadband signal-to-noise ratio of the impulse response data, but because it is uncorrelated to the MLS, it appears as random noise superimposed on each impulse response extracted from the cross-correlation process. By repeating the MLS measurement and maintaining a running average of the impulse response, the random noise will build up at half the rate of the impulse itself, thereby facilitating an improvement of the impulse signal-to-noise ratio for each new measurement. On the other hand, head movement, which causes a time smearing of the MLS waveform captured by each microphone, is not random, but correlated about an average head position.</p><p id="p0122" num="0122">The effect of smearing is to reduce the signal-to-noise ratio of the averaged impulse and to alter the response, particularly in the high frequency regions. This means that without direct intervention no amount of averaging will ever fully recover the high frequency information lost as a result of head movement. Experiments conducted by the inventor<!-- EPO <DP n="45"> --> indicate that involuntary head movements, using human subjects familiar with the personalization process, result in changes in the path length between the microphone and the excitation loudspeaker to vary by up to approximately +/-3mm, although the average variation will be much lower than this. At a sampling rate of 48 kHz this translates to about +/- half a sample period. In practice head movements measured with inexperienced subjects can be considerably greater.</p><p id="p0123" num="0123">Although it is possible to use some form of head support during measurements, for example a neck brace, or chin support, it is preferable to conduct the personalization measurements unsupported since this avoids the possibility of the support itself affecting the measured impulse response. On analysis significant head movements are primarily caused by the action of breathing and blood circulation and so are relatively low frequency and easy to track.</p><p id="p0124" num="0124">Disclosed herein are a number of alternative methods developed to improve the accuracy of acquired impulse response in the presence of head movement. The first involves identifying variations in the actual recorded MLS waveforms output from the left and right ear microphones caused by head movement. The advantage of this process is that it does not require any pilot or reference signal to implement the procedure, but its disadvantage is that the processing, necessary to measure the variations, can be intensive and/or may require the MLS signals to be stored in real-time and the processing conducted off-line. The analysis is conducted on a MLS block-by-block basis using a time or frequency based cross-correlation measure to establish the level of similarity between the incoming block waveforms. Blocks that are deemed similar to each other are kept for processing through the MLS cross-correlation. Those outside the acceptable limits are discarded. The correlation measure can use a running average of block waveforms, or it can use some type of median measure, or all MLS blocks can be cross-correlated with all others and those most similar retained for conversion to impulses.</p><p id="p0125" num="0125">Many alternate correlation techniques known in the art are equally applicable to driving this selection process. Rather than analyzing the MLS time waveform, another method involves analyzing the correlations between the resulting impulse responses output from the circular cross-correlation stage and adding, to the running average, only those impulse responses that are deemed to be sufficiently similar to some nominal impulse response associated with the desired head position. The selection process can be achieved in a similar way to that just described for the MLS waveform blocks. For example, for each individual impulse response, a cross-correlation measure could be made against all other<!-- EPO <DP n="46"> --> impulses. This measure would indicate the similarity between responses. Again, there exists in the art, many ways to measure the similarity between impulses that would be applicable to this process. Impulses that show poor correlation with respect to all other impulses would be discarded. The remaining impulses would be added together to form the average impulse response. To reduce the computational load, it maybe sufficient to measure the cross-correlation for selected portions of each impulse response, for example the early portion of the impulse response, and to use these simplified measures to drive the selection process.</p><p id="p0126" num="0126">The second method involves using some form of head tracking device that measures head movement while the MLS acquisitions are in progress. Head movement can be measured using head mounted trackers working in conjunction with the left and right-ear mounted microphones, for example a magnetic, gyroscopic, or optical type detector, or it can be measured using a camera pointing at the subjects head. Such forms of head tracking devices are well known in the art. The head movement readings are sent to the MLS processor 97 in order to drive the MLS block or impulse response selection procedure just described. Off-line processing is also possible by recording the head tracker data alongside the MLS recordings.</p><p id="p0127" num="0127">The third method involves the transmission of a pilot or reference signal that is output from a loudspeaker at the same time as the MLS to act as an acoustic head tracker. The pilot can be output from the same loudspeaker used to deliver the MLS, or it can be output from a second loudspeaker. The advantage of the pilot method over the traditional head tracked methods, in particular when the same loudspeaker is used to drive both the MLS and the pilot signal, is that no additional information regarding the MLS loudspeaker position relative to the head are required to estimate how the measured head movement will effect the left and right-ear microphone signals. For example, an MLS driven by a loudspeaker directly to the left of the human subject will be much less susceptible to head movement than an MLS emanating from a loudspeaker directly in front of the subject head. Therefore it may be necessary for a head tracked analyzer to know the angle that the MLS signal is incident to the head. Because the pilot and the MLS come from the same loudspeaker, head movement will have much the same effect on both signals.</p><p id="p0128" num="0128">Another advantage of the pilot method is that no additional equipment is required to measure the head movements, since the same microphones acquire both the MLS and pilot signals simultaneously. Therefore in it simplest form, the pilot tone method permits a very straightforward analysis of the incoming MLS signals to be made and for appropriate action to be taken in real-time while the recordings are being acquired. <figref idrefs="f0017">FIG. 24</figref> illustrates the pilot<!-- EPO <DP n="47"> --> tone implementation where the MLS 98 is low pass filtered 135, summed with the pilot 134 and output 103 to a loudspeaker. The microphone outputs 86a and 86b are amplified 96, and since the MLS and pilot tone will appear together in the recorded waveforms each microphone signal, in order to separate out the MLS and tone components, pass through low-pass 135 and complementary high-pass 136 filters respectively. The characteristics of both MLS low-pass filters 135 would typically match.</p><p id="p0129" num="0129">By over sampling the high-pass filtered pilot tones picked up by the left-ear and right-ear microphones and analyzing 137 their relative phase, or individual variations in their absolute phase, head movements down to fractions of a millimeter are easily detected. This information can be used to drive the selection process relating to the suitability of either the MLS waveform blocks or the resulting impulse responses, as described using the non-pilot-tone approach above. In addition, analysis of the pilot tone also permits a method that attempts to stretch or compress, in time, the recorded MLS signals in order to counteract the head movement. Such a method is illustrated in <figref idrefs="f0017">FIG. 25</figref> for the MLS signal recorded by the left-ear microphone. The process can be conducted in real-time, as the signals arrive from the microphones, or the composite MLS-tone signal can be stored during the measurement for processing later off-line once the recording is complete.</p><p id="p0130" num="0130">Altering the waveform timing can be achieved by over sampling the MLS waveforms 141 arriving from the microphones and implementing a variable delay buffer 142 whose delay is determined by the phase analysis of the reference tones 146. A high degree over sampling 141 is desirable in order to ensure that the action of stretching or compressing the MLS time waveform does not, in itself, introduce significant levels of distortion into the MLS signals, which would then translate into errors in the subsequent impulse responses. The variable delay buffer 142 technique described herein is well known in the art. To ensure that both the over sampled MLS and left and right-ear pilot tones remain time aligned it may be preferable to use the same over sampling anti-aliasing filters for both pilot and MLS signals. Analysis of the over sampled pilot tone phases 146 are used to implement a variable buffer output address pointer 145. The action of changing the pointer output position with respect to the input causes the effective delay of the passage of MLS samples through the buffer 142 to change. Samples read out of the buffer are down sampled 143 and input to the normal MLS cross-correlation processor 97 for conversion to impulse responses.</p><p id="p0131" num="0131">The MLS waveform stretch-compression process can also use a head tracker signal to drive the over sampled buffer output pointer position. In this case, it may be necessary to know, or estimate, the head position relative to the MLS loudspeaker position in<!-- EPO <DP n="48"> --> order to estimate the change in path length between the MLS loudspeaker and the left and right-ear microphones, that would occur as a result of the head movement detected by the tracker device.</p><heading id="h0027"><u>Equalization of Headphone</u></heading><p id="p0132" num="0132">The personalization process desires to measure the transfer function from the loudspeaker to the ear mounted microphones. With the resulting PRIR, audio signals can be filtered or virtualized using this transfer function. If these filtered audio signals can be converted back to sound and driven into the ear cavity, close to where the microphones were located that captured the original measurement, then the human subject will perceive the sound to come from the loudspeaker. Headphones are a convenient way of reproducing this sound in the vicinity of the ear but all headphones exhibit some additional filtering of their own. That is, the transfer function from the headphone to the ear is not flat and this additional filtering is compensated for, or equalized, to ensure the virtual loudspeaker fidelity matches that of the real loudspeaker as closely as possible.</p><p id="p0133" num="0133">In one example of the disclosure the MLS deconvolution technique is used, as discussed previously in connection to the PRIR measurements, to make a one-time measurement of the headphone-to-ear-mounted-microphone impulse response. This impulse response is then inverted and used as a headphone equalization filter. By convolving the headphone audio signals, present at the output of the virtualizer with this equalization filter, the effect of the headphone-ear transfer functions are effectively cancelled, or equalized, and the signals will arrive at the microphone pick up point with a flat response. It is preferable to calculate an inverse filter for each ear separately, but averaging the left and right-ear response is also possible. Once the inverse filters have been calculated they can be implemented as separate real-time equalization filters located anywhere along the virtualizer signal chain, for example at the outputs. Alternately they can be used to pre-emphasize the time aligned PRIR data sets used by the PRIR interpolator, i.e., they are used on a one-off basis to filter the PRIRs during virtualizer initialization.</p><p id="p0134" num="0134"><figref idrefs="f0015">FIG. 22</figref> illustrates the placement of an ear-mounted microphone 87 in conjunction with the fitting of headphones 80 on human subject 79. The same applies for both ears. The microphone is mounted in the ear canal 209 in the same way as it is for the personalization measurements and in approximately the same location. Indeed to ensure the greatest accuracy it is preferable both left-ear and right-ear microphones remain in the ears after the personalization measurements are complete and for the headphone equalization measurement to proceed immediately following. <figref idrefs="f0015">FIG. 22</figref> shows the microphone cables 86 having to pass<!-- EPO <DP n="49"> --> underneath the headphone cushion 80a and to maintain a good headphone-to-head seal these cables should be flexible and of low weight. The headphone transducer 213 is driven by the MLS signal via headphone cable 78.</p><p id="p0135" num="0135"><figref idrefs="f0026">FIG. 35</figref> illustrates the application of the personalization circuitry to the headphone MLS equalization measurement The MLS generation 98, gain ranging 101 and 4, microphone amplification 96, digitization 99, cross correlation 97 and impulse-averaging processes are identical to those used for the personalization measurements. However the scaled MLS signal 103 does not drive the loudspeaker but rather is redirected to the stereo headphone output circuits 72 in order to drive the headphone transducers. The MLS measurement is conducted separately for both left-ear and right-ear headphone transducers to avoid the possibility of cross talk occurring between them if conducted simultaneously. The illustration shows a human subject 79 with microphones mounted in their left ear 87a and right ear 87b. The microphones signals 86a and 86b respectively, are connected to the microphone amplifiers 96. The subject is also wearing a stereo headphone where the left ear transducer is driven from the left headphone output 80a via cable 78a and the right transducer from the right output via cable 78b.</p><p id="p0136" num="0136">In one example, the procedure for acquiring the headphone-microphone impulse responses is as follows. First the gain 101 of the MLS signal sent to the headphone is determined by analyzing the amplitude of the signals being picked up by the microphones using the same iterative approach described for the personalization measurements. The gain is measured separately for both left and right-ear circuits and the lowest gains scale factor 101 is retained and used for both MLS measurements. This ensures that amplitude differences between left and right ear impulse responses are retained. However any differences in the left or right-ear headphone transducers or the headphone drive gains will reduce the accuracy of this measurement. The MLS test then begins, starting with the left ear followed by the right ear. The MLS is output to the headphone transducer and picked up by the respective microphone in real time. As with the personalization procedure, the digitized microphone signals 99 can be stored for processing later, or the cross-correlation and impulse averaging can proceed in real time - depending on the available processing power. On completion both left and right impulse responses are time aligned and transferred 117 to the virtualizer 122 for inversion. Time alignment ensures that the headphone transducer-to-ear path lengths are symmetrical for both sides of the head. The alignment process can follow the same method described for the PRIRs.<!-- EPO <DP n="50"> --></p><p id="p0137" num="0137">The headphone-ear impulse responses can be inverted using a number of filter inversion techniques that are well known in the art. The most straightforward approach, and one that is used in an example, converts the impulse to the frequency domain, removes the phase information, inverts the amplitude of modulus frequency components and then converts back to the time domain, resulting in a linear phase inverse impulse response. Typically the original response will be smoothed or dithered at certain frequencies to mitigate the effects of strong poles and zeros during the inversion calculation. While the inversion process will often be conducted on the separate impulse responses it is important to ensure that the relative gains between the two impulse responses are inverted correctly. This is complicated by the action of spectral smoothing and it may be necessary to recalibrate the lower frequencies amplitudes to ensure the left-right inverse balance is retained for the frequencies of interest.</p><p id="p0138" num="0138">Since the inverse filters are optimized for the type of headphone used to drive out the MLS and to the particular individual that wore them, the coefficients would typically be stored alongside some type of information that makes note of the headphone make and model, and also of the person involved in the test, hi addition, since the position of the microphones may have been used in a personalization measurement session, information relating to this association could be stored also, for retrieval later.</p><heading id="h0028"><u>Equalization of loudspeakers</u></heading><p id="p0139" num="0139">Since an example of the disclosure has built into it an apparatus for measuring the transfer function between a loudspeaker and a microphone and for inverting such a transfer functions, a useful extension of this example is to provide a means to measure the frequency response of the real loudspeaker, generate an inverse filter and then use these filters to equalize the virtual loudspeakers signals such that their apparent fidelity may be improved over the real loudspeakers.</p><p id="p0140" num="0140">By equalizing the virtual loudspeakers the headphone system is no longer attempting to match the sonic fidelity of the real loudspeakers, but instead is attempting to improve on the fidelity while retaining their spatiality with respect to the listener. This process is useful when, for example, the loudspeakers are of low quality and it is desirable to improve their frequency range. The equalization method could be applied to just those loudspeakers that are suspected of under performing, or it could be applied routinely to all virtual loudspeakers.</p><p id="p0141" num="0141">The loudspeaker to microphone transfer function can be measured in much the same way as those of the personalized PRIRs. In this application only one microphone is<!-- EPO <DP n="51"> --> used and this microphone is not mounted in the ear but positioned in free space close to where the listener's head would occupy while watching movies or listening to music. Typically the microphone would be secured to some form of stand mounted boom arm so that it can be fixed at head height while the MLS measurement is made.</p><p id="p0142" num="0142">The MLS measurement process first selects the loudspeaker that will receive the MLS signal, as per the personalization method. It then establishes the necessary scale factor that properly scales the MLS signal output to this loudspeaker and proceeds to acquire the impulse response, again in the same way as the personalization method. In the case of the PRIRs the extended room reverberation response tail is retained with the direct impulse and used to convolve the audio signals. However in this case it is only the direct portion of the impulse response that is used to calculate the inverse filter. The direct portion normally covers a time period of about 1 to 10ms following the onset of the impulse and represents that part of the inoident sound wave that reaches the microphone prior to any significant room reflections. Hence the raw MLS derived impulse response is truncated and then applied to the inverse procedure described for the headphone equalization procedure. As with the headphone equalization, it may be desirable to smooth the frequency response to mitigate the effects of strong poles or zeros. Again, as with the headphone case, special care should be taken to ensure that the inter virtual-loudspeaker balance is not altered by the inversion processes, and it may be necessary to recalibrate these values prior to finalizing the inverse filters.</p><p id="p0143" num="0143">Virtual loudspeaker equalization filters can be calculated for each individual loudspeaker, or some average of many loudspeakers can be used for all virtual loudspeakers or any combination thereof. Virtual loudspeaker equalization filtering can be implemented using real time filters at the input to the virtualizer or at the virtualizer outputs or through a one-off pre-emphasis of the time aligned PRIRs (in conjunction with any desired headphone equalization) that are associated with those virtual loudspeakers.</p><heading id="h0029"><u>Sub-band Virtualization</u></heading><p id="p0144" num="0144">One feature of an example of the headphone virtualization process is the filtering, or convolution, of the incoming audio signals that represent the real loudspeaker signal feed, with the personalized room impulse responses (PRIR). For every loudspeaker to be virtualized it may be necessary to convolve the corresponding input signal with both left- ear and right-ear PRIRs giving a left-ear and right-ear stereo headphone feed. For example in many applications a 6-loudspeaker headphone virtualizer would run 12 convolution processes simultaneously and in real time. Typical living rooms exhibit a reverberation time of about<!-- EPO <DP n="52"> --> 0.3 seconds. This means that at a sampling frequency of 48kHz ideally each PRIR will comprise at least 14000 samples. For a 6-loudspeaker system that implements simple time domain non-recursive filtering (FIR) the number of convolution multiply/accumulate operations per second is 14000*48000*2*6 or 8.064 billion operations per second.</p><p id="p0145" num="0145">Such a computational requirement is beyond all low-cost digital signal processors known today and so it may be necessary to devise a more efficient method for implementing the real-time virtualization convolution processing. There exist in the art a number of such implementations based on the principle of FFT convolution, as described for example in <nplcit id="ncit0002" npl-type="s"><text>Gardner W.G., "Efficient convolution without input-output delay," J.Audio Eng. Soc., vol. 43 no. 3, Mar. 1995</text></nplcit>. One of the drawbacks of FFT convolution is that there is an implied latency, or delay to the process, due to the high frequency resolution involved. Large latencies are usually undesirable, especially when it is a requirement that the listener's head motion be tracked, and for any changes to modify the PRIR data used by the convolvers so that the virtual sound sources may be de-rotated to counteract such head movement. By definition, if the convolution process has a high latency, the same latency will appear in the de-rotation adaptation loop and could result in a noticeable time lag between the listener moving their head and the virtual loudspeaker locations being corrected.</p><p id="p0146" num="0146">Disclosed herein is an efficient convolution method that uses sub-band filter banks to implement frequency domain sub-band convolvers. Sub-band filter banks are well known in the art and their implementation will not be discussed in detail. The method leads to a significant reduction in the computational load while retaining a high level of signal fidelity and low processing latency. Medium order sub-band filter banks exhibit a relatively low latency, usually in the region of 10ms, but as a consequence exhibit low frequency resolution. Low frequency resolution in sub-band filter banks manifests as inter-sub-band leakage and in traditional critically sampled designs this leads to a high reliance on alias cancellation to maintain signal fidelity. Sub-band convolution however, by definition, may cause large shifts in amplitude between sub-bands resulting often in a complete breakdown in the alias cancellation in the overlap regions and with it detrimental changes in the reconstruction properties of the synthesis filter bank.</p><p id="p0147" num="0147">But the alias problem may be alleviated through the use a class of filter banks known as over-sampling sub-band filter banks that avoid folding back the signal leakage in the vicinity of the overlap. Over sampling filter banks do exhibit some disadvantages. First the sub-band sampling rate, by definition, is higher than the critically sampled case and therefore the computational load is proportionately higher. Second the higher sampling rate<!-- EPO <DP n="53"> --> means that the sub-band PRIR files will also contain proportionately more samples. Hence sub-band convolution computations will increase by the square of the over-sampling factor compared to the critically sampled counterparts. Over-sampling sub-band filter bank theory is also well known in the art (see, e.g., <nplcit id="ncit0003" npl-type="b"><text>Vaidyanatham, P.P., "Multirate systems and filter banks," Signal processing series, Prentice Hall, Jan. 1992</text></nplcit>), and only those details specific to understanding of the convolution method will be discussed.</p><p id="p0148" num="0148">Sub-band virtualization is a process whereby the convolution, or filtering, operates independently within the filter bank sub-bands. In one example, the steps to achieving this include:
<ol><li>1) the PRIR samples pass through the sub-band analysis filter bank as a one-off process, giving a set of smaller sub-band PRIRs;</li><li>2) the audio signal is split into sub-bands using the same analysis filter bank;</li><li>3) each sub-band PRIR is used to filter the corresponding audio sub-band signal;</li><li>4) the filtered audio sub-band signals are reconstructed back into the time domain using the synthesis filter bank.</li></ol></p><p id="p0149" num="0149">Depending on the number of sub-bands used in the filter bank, sub-band convolution has a significantly lower computational loading. For example, a 2-band critically sampled filter bank splits the 48kHz sampled audio signals into two sub-bands each of 24kHz sampling. The same filter bank is used to split the 14000-sample PRIR into two sub-band PRIRs of 7000 samples each. Using the example above, the computational load is now 7000*24000*2*2*6 or 4.032 billion operations, i.e., a reduction by a factor of 2. Hence for critically sampled filter banks, the reduction factor is simply equal to the number of sub- bands. For over-sampling filter banks the sub-band convolution gain, compared to critically sampled sub-band convolution, is reduced by the square of the over-sampling ratio, i.e., for 2x over sampling only filter banks of 8 bands and above offer a reduction over simple time domain convolution. Over-sampled filter banks are not constrained to integer over-sampling factors and typically can produce high signal fidelity using over-sampling factors in the region of 1.4x i.e., a computational improvement of approximately 2.0 over a 2x filter bank.</p><p id="p0150" num="0150">The benefits of non-integer over-sampling are not just confined to computational loading. The lower over-sampling rate also reduces the size of the sub-band PRIR files and this in turn reduces the PRIR interpolation compute loading. The most efficient implementations of non-integer over-sampled filter banks are often implemented using a real-complex-real signal flow, meaning that sub-bands signals will be complex (real and imaginary), as opposed to real. In such cases complex convolution is used to implement the<!-- EPO <DP n="54"> --> sub-band PRIR filtering, requiring complex multiplications and additions which in certain digital signal processors architectures may not be efficiently implemented compared to real number arithmetic. This class of non-integer over-sampled filter banks are well known in the art (see, e.g., <nplcit id="ncit0004" npl-type="s"><text>Cvetkovi Z., Vetterli M., "Oversampled filter banks," IEEE Trans. Signal Processing, vol. 46, no. 5, at 1245-55 (May 1998</text></nplcit>)).</p><p id="p0151" num="0151">The method of sub-band virtualization is illustrated in <figref idrefs="f0013">FIG. 19</figref>. First the PRIR data file is split into a number of sub-bands using an analysis filter bank 26 and the individual sub-band PRIR files 28 are stored 31 for use by the sub-band convolvers 30. The input audio signal is then split using a similar analysis filter bank 26 and the sub-band audio signals enter the sub-band convolver 30 that filters all the audio sub-bands with their respective sub-band PRIRs. The sub-band convolver outputs 29 are then reconstructed using a synthesis filter bank 27 to output a full band time domain virtualized audio signal.</p><p id="p0152" num="0152">Prototype low pass filters that exist in the art are designed to control the sub-band pass, transition, and stop band response such that the reconstruction amplitude ripple is minimized, and in the case of critically sampled filter banks, the alias cancellation maximized. Fundamentally they are designed to exhibit 3dB attenuation at the sub-band overlap frequency. As a result, the analysis and synthesis filters combine to leave the transition frequencies 6dB down from pass band. On summing the sub-band overlap zones add to 0dB leaving the final signal effectively ripple free across its entire pass band. However, the action of convolving one sub-band with another sub-band prior to the synthesis filter bank leads to an overlap ripple with a peak of 3dB since the audio signal has effectively passed through the prototype not twice but three times.</p><p id="p0153" num="0153"><figref idrefs="f0008">FIG. 14a</figref> illustrates an example of the ripple 160 that ordinarily occurs between any two adjacent sub-bands on reconstruction. The overlap, or transition, frequency 158 coincides with the maximum attenuation and depending on the specification of the prototype filters, this will be in the region of -3dB. Either side of the transition 157 and 159 the ripple symmetrically reduces to 0dB. Typically the bandwidth between these points is in the region 200-300Hz. By way of example <figref idrefs="f0008">FIG. 14b</figref> illustrates the resulting ripple that might be present in the reconstructed audio signal having passed through a 8-band sub-band convolver.</p><p id="p0154" num="0154">A number of methods are disclosed herein to remove this ripple 160 and restore a flat response 160a. First, since the ripple is purely an amplitude distortion, it can be equalized by passing the reconstructed signal through an FIR filter whose frequency response is the inverse of the ripple. The same inverse filter could be used to pre-emphasize the input signal or the PRIRs themselves prior to the filter bank. Second, the analysis prototype filter used to<!-- EPO <DP n="55"> --> split the PRIR files could be modified to decrease the transition attenuation to OdB. Third, a prototype filter with a transition attenuation of 2dB could be designed for both the audio and PRIR filter banks giving a combined attenuation of 6dB. Forth, the sub-band signals themselves could be filtered using a sub-band FIR filter with the appropriate inverse response, either prior to, or following the convolution stages. Redesigning the prototype filters may be preferable because increases in the overall system latency can be avoided. It will be appreciated that the ripple distortion can be equalized in a number of ways.</p><p id="p0155" num="0155"><figref idrefs="f0027">FIG. 36</figref> illustrates the steps necessary to combine the basic sub-band virtualizer with the PRTR interpolation and variable delay buffering as is required to form a single personalized head tracked virtualized channel. An audio signal is input to analysis filter bank 26 that splits the signal into a number of sub-band signals. The sub-band signals enter two separate sub-band convolution processes, one for the left-ear headphone signal 35 and the other for the right-ear headphone signal 36. Each convolution processes work in a similar way. The sub-band signals that enter the left-ear convolver block 36 are applied to individual sub-band convolvers 34 that essentially filter the sub-band audio signals with their respective left-ear sub-band time-aligned PRIR files 16, as selected by the internal sub-band PRIR interpolators driven by the head tracker angle information 10, 11, and 12.</p><p id="p0156" num="0156">The outputs of the sub-band convolvers 34 enter the synthesis filter bank 27 and are recombined back to a full band time domain left-ear signal. The process is identical for the right-ear sub-band convolution 36 except that it is the right-ear sub-band time-aligned PRIRs 16 that are used to convolve the separate sub-band audio signals. The virtualized left- ear and right ear signals then pass through variable delay buffers 17 whose path lengths are dynamically adjusted to simulate the inter-aural time delays that would exist for real sound sources coincident with the virtual loudspeaker associated with the PRIR data set, for the particular head orientation indicated by the head tracker.</p><p id="p0157" num="0157"><figref idrefs="f0010">FIG. 16</figref> illustrates in more detail the workings of the sub-band interpolation block 16 using PRIRs measured for three lateral head positions as an example. The interpolation coefficients 6, 7 and 8 are generated in 9 on analysis of the head tracker angle information 10, reference head orientation 12, and virtual loudspeaker offset 11. A separate interpolation block 15 exists for each sub-band PRIR, whose operation is identical to that of <figref idrefs="f0009">FIG. 15</figref> except that the PRIR data is in the sub-band domain. All interpolation blocks 15 (<figref idrefs="f0010">FIG. 16</figref>) use the same interpolation coefficients and the interpolated sub-band PRIR data are output 14 to the sub-band convolvers.<!-- EPO <DP n="56"> --></p><p id="p0158" num="0158"><figref idrefs="f0029">FIG. 38</figref> illustrates how the method of <figref idrefs="f0027">FIG. 36</figref> is expanded to include more virtual loudspeaker channels. For clarity the sub-band signal paths are combined as a single heavy line 28 and the head tracking signal paths are not shown. Each audio signal is split into sub-bands 26 and the corresponding sub-band signals pass through left and right-ear convolvers 35 and 36 whose outputs are recombined 27 into full band signals and passed to the variable delay buffers 17 to affect the appropriate inter-aural delays. The buffer outputs 40 for all the left-ear and right-ear signals are summed separately 5 to produce the left-ear and right-ear headphone signals respectively.</p><p id="p0159" num="0159"><figref idrefs="f0028">FIG. 37</figref> illustrates a variation of the implementation of <figref idrefs="f0027">FIG. 36</figref> where the variable delay buffers 23 are implemented in each of the sub-bands prior to the synthesis filter bank 27. Such a sub-band variable delay buffer 23 is illustrated in <figref idrefs="f0012">FIG. 18</figref>. Each sub-band signal enters its own separate over sampled delay processor 17a whose operation is identical to that illustrated in <figref idrefs="f0011">FIG. 17</figref>. The only difference between a sub-band and a full-band delay buffer implementation is that, for the same performance, the over-sampling factor can be reduced by the decimation factor of the filter bank sub-bands. For example, if the sub-band sample rate is Â½ of the input audio sampling rate then the over sampling rate of the variable buffer can be reduced by a factor of 4. This also leads to similar reductions in the size of the over sampling FIR and delay buffer. <figref idrefs="f0012">FIG. 18</figref> also shows a common output buffer address 20 being applied to all sub-band delay buffers reflecting the fact that all sub-bands within the same audio signal should exhibit the same delay.</p><p id="p0160" num="0160">Where the variable delay buffers are implemented in the sub-band domain, as in <figref idrefs="f0028">FIG. 37</figref>, certain improvements in implementation efficiency can be had by summing the left and right-ear signals in the sub-band domain and then reconstructing these using just a single synthesis stage for each. <figref idrefs="f0030">FIG. 39</figref> illustrates such an approach. Again for clarity the sub-band signal paths are represented by a single heavy line 28 and 29 and the head tracker information paths are not shown. Each input signal is split 26 into sub-bands 28 and each individual sub-band convolved and applied to sub-band variable delay buffers 37 and 38. The left-ear and right-ear sub-band signals, for all channels, output from their respective buffers are summed at sub-band adders 39 prior to their reconstruction back to full band signals using synthesis filter banks 27. The left-ear and right-ear sub-band summers 39 operate on individual sub-bands from each virtualized audio channel according to: <maths id="math0035" num="(eqn 32)"><math display="block"><msub><mi>sub</mi><mi mathvariant="normal">L</mi></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced><mo>=</mo><msub><mi>sub</mi><mrow><mi mathvariant="normal">L</mi><mo>â¢</mo><mn mathvariant="normal">1</mn></mrow></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced><mo>+</mo><msub><mi>sub</mi><mrow><mi mathvariant="normal">L</mi><mo>â¢</mo><mn mathvariant="normal">2</mn></mrow></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced><mo>+</mo><mn mathvariant="normal">....</mn><mspace width="1em"/><msub><mi>sub</mi><mi>Ln</mi></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced></math><img id="ib0035" file="imgb0035.tif" wi="131" he="8" img-content="math" img-format="tif"/></maths> <maths id="math0036" num="(eqn 33)"><math display="block"><msub><mi>sub</mi><mi mathvariant="normal">R</mi></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced><mo>=</mo><msub><mi>sub</mi><mrow><mi mathvariant="normal">R</mi><mo>â¢</mo><mn mathvariant="normal">1</mn></mrow></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced><mo>+</mo><msub><mi>sub</mi><mrow><mi mathvariant="normal">R</mi><mo>â¢</mo><mn mathvariant="normal">2</mn></mrow></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced><mo>+</mo><mn mathvariant="normal">....</mn><mspace width="1em"/><msub><mi>sub</mi><mi>Rn</mi></msub><mfenced open="[" close="]"><mi mathvariant="normal">i</mi></mfenced></math><img id="ib0036" file="imgb0036.tif" wi="131" he="9" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="57"> --> for i = 1, number of filter bank sub-bands and n = number of virtualized audio channels, where sub<sub>L</sub>[i] represents the ith left-ear sub-band and sub<sub>R</sub>[i] the ith right-ear sub-band.</p><p id="p0161" num="0161"><figref idrefs="f0031">FIG. 40</figref> illustrates an implementation were user A and user B both wish to listen to the same virtualized audio signals but using their own PRIR and head tracking signals. Again, these signals have been removed for clarity. In this case computational savings come about because the same audio sub-band signals 28 are available to both users' left and right-ear convolution processors 37 and 38, and this saving is available for any number of users.</p><p id="p0162" num="0162">In previous sections the methods of headphone and loudspeaker equalization filtering have been described. It will be appreciated by those skilled in the art that such methods are equally applicable to virtualizer implementations that make use of the sub-band convolution methods just discussed.</p><heading id="h0030"><u>Exploiting variations in sub-band Reverberation Time</u></heading><p id="p0163" num="0163">A significant benefit of the sub-band virtualization method disclosed herein is the ability to exploit deviations in the PRIR reverberation time with frequency such that further savings can be made in the convolution computational load, the PRIR interpolation computational load, and the PRIR storage space requirements. For example, typical room impulse responses will often exhibit a decline in reverberation time with rising frequency. If in this case the PRIR is split into frequency sub-bands, then the effective length of each sub-band PRIR would decline in the higher sub-bands. By way of example a 4-band critically sampled filter bank splits a 14000 sample PRIR into 4 sub-band PRIRs each of 3500 samples. However this assumes the PRIR reverberation times across the sub-bands are the same. At a sampling rate of 48kHz, PRIR lengths of 3500, 2625, 1750 and 875, (where 3500 is for the lowest frequency sub-band) may be more typical, reflecting the fact that high frequency sound is more readily absorbed by the listening room environment. More generally therefore, the effective reverberation time of any sub-band can be determined and the convolution and PRIR lengths adjusted to only cover this time period. Since the reverberation times are related to the measured PRIRs they need only be calculated once on initializing the headphone system.</p><heading id="h0031"><u>Exploiting sub-band signal Masking Thresholds</u></heading><p id="p0164" num="0164">The actual number of sub-bands involved in the convolution process may be reduced by determining those sub-bands that will not be audible or those that will be masked by adjacent sub-bands signals after the convolution. The theory of perceptual noise or signal masking is well known in the art and involves identifying parts of the signal spectrum that cannot be perceived by a human subject either because the signal level of the those parts of the spectrum is below the threshold of audibility or because those parts of the spectrum<!-- EPO <DP n="58"> --> cannot be heard due to the high signal levels and/or nature of adjacent frequencies. For example it may be determined, through the application of some audibility threshold curve, that sub-bands above 16kHz are not audible irrespective of the level of the input signals. In this case all sub-bands above this frequency would be permanently dropped from the sub-band convolution process. The associated sub-band PRIR could also be deleted from memory. More generally, the masking thresholds across the convolved sub-bands can be estimated on a frame by frame basis and those sub-bands that are deemed to fall below the threshold would be muted, or their reverberation time heavily curtailed, for the duration of the analysis frame. This implies that a fully dynamic masking threshold calculation will lead to a computational loading that will vary from frame to frame. However since in typical applications the convolution processing will be running across many audio channels at the same time, this variation will likely be smoothed out. If it is desired to maintain a fixed computational load then certain limits can be imposed on the number of active sub-bands or the total convolution tap length across any or all of the audio channels. For example the following limitations may prove perceptually acceptable.</p><p id="p0165" num="0165">First, the number of sub-bands involved in the convolutions across all channels is fixed at a maximum level such that the masking thresholds will only occasionally elect for a greater number of sub-bands. Priority could be placed on the low-frequency sub-bands such that the band limiting effect caused by exceeding the sub-band limit will be confined to the high frequency regions. Additionally priority could be given to certain audio channels and the high frequency band limiting effect confined to those channels that are considered less important.</p><p id="p0166" num="0166">Moreover, the total number of convolution taps is fixed such that the masking thresholds will only occasionally elect for a range of sub-bands whose reverberation times combine to exceed this limit. As before, priority can be placed on low-frequency sub-bands and/or on particular audio channels such that the high frequency reverberation times are reduced only in low priority audio channels.</p><heading id="h0032"><u>Exploiting variations in Signal or Loudspeaker Bandwidths</u></heading><p id="p0167" num="0167">For audio channels or loudspeakers whose bandwidth is not scaled in proportion to its sampling rate the number of sub-bands that participate in the convolution process can be lowered permanently to match the bandwidth of the application. For example the sub-woofer channel, common in many home theatre entertainment systems has an operating bandwidth that rolls off from about 120Hz. The same is true of the sub-woofer loudspeaker itself. Consequently, considerable savings can be achieved by restricting the bandwidth of the<!-- EPO <DP n="59"> --> convolution process to match that of the audio channel by allowing only those sub-bands that contain any meaningful signal to participate in the sub-band convolution process.</p><heading id="h0033"><u>Altering the Frequency-Reverberation time Characteristics</u></heading><p id="p0168" num="0168">To maximize the realism of the headphone virtualizer it is desirable to retain the frequency-reverberation time characteristics of the original PRIRs. However this characteristic can be altered by restricting the reverberation time in any sub-band by limiting the number of sub-band PRIR samples a convolver uses to filter the sub-band audio. This intervention might be required simply to limit the complexity of the convolvers at any particular frequency, as discussed, or it may be applied more aggressively if is desired to actually reduce the perceived reverberation times of the virtual loudspeakers at certain frequencies.</p><heading id="h0034"><u>Trading convolution complexity for virtualization accuracy</u></heading><p id="p0169" num="0169">The personalized room impulse response comprises three main sections. The first section is the impulse onset that records the initial passage of the impulse wave as it moves out from the loudspeaker past the ear mounted microphones. Typically the first section will extend beyond the initial impulse onset for about 5 to 10ms. Following the onset is a record of the early reflections of the impulse that have bounced off the listening room boundaries. For typical listening rooms this covers a time span of about 50ms The third section is a record of the late reflections, or room reverberations, and typically last 200 to 300ms depending on the reverberation time of the environment.</p><p id="p0170" num="0170">If the reverberation portion of the PRIR is sufficiently diffuse, that is, the sounds are perceived to come equally from all directions then the late reflection (reverberation) portion of all the acquired PRIRs will be similar. Since the reverberation sections represent the biggest portion of the entire impulse response significant savings can be obtained by merging these sections and the corresponding convolutions into a single process. <figref idrefs="f0041">FIG. 50</figref> illustrates the dissection of an original time aligned PRIR 246. The impulse onset and early reflections 242 and the late reflections 243, or reverberation, are shown separated by dashed line 241. The initial and early reflection coefficients 244 form the PRIR for the main signal convolvers. The late reflection, or reverberation, coefficients 245 are used to convolve the merged signals. The early coefficient portion 247 may be zeroed in order to maintain the original time delay, or it can be removed entirely and the delay reinstated using a fixed delay buffer.</p><p id="p0171" num="0171">By way of example <figref idrefs="f0040">FIG. 49</figref> illustrates a system that virtualizes two input signals using the modified PRIRs. For clarity the head track signals are not shown. Two audio<!-- EPO <DP n="60"> --> channels IN 1 and IN 2 are virtualized using a sub-band 28 convolution and variable time delay process for the left-ear 37 and right-ear 38 signals. The convolved and delayed sub- band signals are summed 39 and converted back to the time domain 27 resulting in left-ear and right-ear headphone signals. The PRIRs used within the left 37 and right 38 processes have been truncated to include only the onset and early reflections 244 (<figref idrefs="f0041">FIG. 50</figref>) and as such exhibit a significantly lower computational load. The head tracked sub-band PRIR interpolation within 37 and 38 operates in the normal way and is also less computationally intensive due to their reduced length. The reverberation portions of the PRIRs 245 (<figref idrefs="f0041">FIG. 50</figref>) for both input channels (CH1 and CH2) are summed together and level adjusted and loaded to the sub-band convolvers 35 and 36. These stages differ from those of 37 and 38 in that the variable delay processing is absent. Sub-band signals from both input channels 28 are summed 39 and the merged signals 240 applied to left-ear 35 and right-ear 36 sub-band convolvers. The sub-bands output from 35 and 36 are summed with their respective left-ear and right-ear sub-bands 39 prior to conversion 27 back to the time domain.</p><p id="p0172" num="0172">Head tracked inter-aural delay processing is not effective for the reverberation channels of 35 and 36 and is not used. This is because the merged audio signals no longer emanate from a single virtual loudspeaker meaning that no one delay value will likely be optimal for composite signals such as these. Convolver stages 35 and 36 do ordinarily use interpolated reverberation PRIRs, driven by the head tracker. A further simplification is possible by locking the interpolation process and convolving the merged signals with just one fixed reverberation PRIR, for example, the PRIR that represents the nominal viewing head orientation.</p><p id="p0173" num="0173">In the example of <figref idrefs="f0040">FIG. 49</figref> the initial and early reflection portions of the PRIR might typically represent only 20% the original PRIR and the two channel convolution implementation illustrated might realize a computational savings in the order of 30%. Clearly as more channels make use of the merged reverberation path the greater the savings. For example a five channel implementation might see a 60% reduction in convolution processing complexity.</p><heading id="h0035"><u>Pre-virtualization techniques</u></heading><p id="p0174" num="0174">In the normal mode of operation, an example of the system convolves the input audio signals in real time using impulse response data that is interpolated from a number of predetermined PRIRs specific to each virtual loudspeaker. The interpolation process runs continuously alongside the convolution process and uses a head-tracking device to calculate the appropriate interpolation coefficients and buffer delays such that the virtual<!-- EPO <DP n="61"> --> sound sources appear fixed in the presence of listener's head movements. A significant drawback of this mode of operation is that the stereo headphone signals output from the virtualizer are related to the listener's real time head position and only meaningful at that particular instant. Consequently the headphone signals themselves cannot ordinarily be stored (or recorded) and replayed at some later date, since the listener's head movements are unlikely to match those that occurred during the recording. Moreover, since the interpolation and differential delays cannot be retrospectively applied to the headphone signals, the listener's head movements will not de-rotate the virtual image. The concept of pre-recorded virtualization, or pre-virtualization would however offer significant reductions in the computational load at playback since the intensive convolution processes would only occur during recording and would not need to be repeated during playback. Such a process would be beneficial for applications that have limited playback processing power and where the opportunity exists for the virtualization process to be run off-line, and for the pre-virtualized (or binaural) signals instead to be processed in real time under control of the listener's head tracker device.</p><p id="p0175" num="0175">The basis of the pre-virtualization process is, by way of example, illustrated in <figref idrefs="f0035">FIG. 44</figref>. A single audio signal 41 is convolved 34 with three left-ear time-aligned PRIRs 42, 43 and 44, and three right-ear time-aligned PRIRs 45, 46 and 47. In this example, the three left-ear and right-ear PRIRs correspond to a single loudspeaker personalized for three different head orientations A, B and C. An illustration of such personalization orientations is shown in <figref idrefs="f0021">FIG. 29</figref>. The left-ear PRIRs for the head positions A, B and C, each convolve the input signal 41 to produce three separate virtualized signals 48, 49 and 50 respectively. In addition three separate virtualized signals are generated for the right-ear using right-ear PRIRs. The six virtualized signals in this example now represent the left and right-ear feeds for a headphone for three listener head orientations A, B and C. These signals can be transmitted to the play back device, or they can be stored for playback at a later time 51. The computational load of this intermediate virtualization stage is, in this case, 3 times greater then the equivalent interpolated version, since the PRIRs for all three head positions are used to convolve the signal, rather than just a single interpolated PRIR. However, where the virtualized signals are being stored, it may not be necessary for this to be conducted in real time.</p><p id="p0176" num="0176">In order for the user to listen to the virtualized version of the input audio signal 41, it may be necessary to apply the three left-ear virtualized signals 52, 53 and 54 to an interpolator 56 whose interpolation coefficients are calculated based on the listener's head<!-- EPO <DP n="62"> --> angle 10 in much the same way as the conventional PRIR interpolation operates 10. In this case the interpolation coefficients are used to output a linear combination of the three input signals every sample period. The right-ear virtualized signals are also interpolated 10 using an identical process. If, for this example, the virtualized signal samples for head position A are x1(n), those for virtualized head position B are x2(n) and those for virtualized head position C are x3(n) then the interpolated sample stream x(n) is given by: <maths id="math0037" num="(eqn 34)"><math display="block"><mi mathvariant="normal">x</mi><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>=</mo><mi mathvariant="normal">a</mi><mo>*</mo><mi mathvariant="normal">x</mi><mo>â¢</mo><mn mathvariant="normal">1</mn><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>+</mo><mi mathvariant="normal">b</mi><mo>*</mo><mi mathvariant="normal">x</mi><mo>â¢</mo><mn mathvariant="normal">2</mn><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>+</mo><mi mathvariant="normal">c</mi><mo>*</mo><mi mathvariant="normal">x</mi><mo>â¢</mo><mn mathvariant="normal">3</mn><mo>;</mo><mspace width="1em"/><mi>for nth sampling period</mi></math><img id="ib0037" file="imgb0037.tif" wi="148" he="8" img-content="math" img-format="tif"/></maths><br/>
where a, b and c are the interpolation coefficients whose values vary depending on the head tracker angles according to equations 2,3 and 4.</p><p id="p0177" num="0177">The left-ear interpolated output 56 is then applied to a variable delay buffer 17 that changes the path length of the buffer according to the listener's head angle. The interpolated right-ear signal also passes through a variable delay buffer and the difference in delays between the left and right-ear buffers is dynamically adapted to changes in the head angle such that they match the inter-aural delays that would have existed if the headphone signals were actually arriving from a real loudspeaker coincident with the virtual loudspeaker. These methods are all identical to those described in earlier sections. Both the interpolator and variable delay buffers have available to them the personalization measurement head angle information specific to the PRIRs used to create the virtualized signals, allowing them to dynamically calculate the appropriate interpolator coefficients and buffer delays as the head tracker dictates.</p><p id="p0178" num="0178">One benefit of this system is that the interpolation and variable delay processes exhibit a vastly lower computational load than that demanded by the virtualization convolution stages 34. <figref idrefs="f0035">FIG. 44</figref> illustrates a single audio signal 41, virtualized for three head positions. It will be appreciated by those skilled in the art that this process can easily be extended to cover more head positions and a greater number of virtualized audio channels. Moreover, the pre-virtualized signals 51 (<figref idrefs="f0035">FIG. 44</figref>) may be stored locally or it may be stored in some remote site and these signals may be played back by the user synchronized to other associated media streams such as motion picture or video.</p><p id="p0179" num="0179"><figref idrefs="f0036">FIG. 45</figref> illustrates an extension of the process whereby six virtualized signals are encoded 57 and output 59 to a storage device 60 as an interim stage. The process of taking the input audio samples 41, generating the different virtualized signals, encoding them and then storing them 60, continues until all the input audio samples have been processed. This may, or may not, be in real time. The personalization measurement head angle information<!-- EPO <DP n="63"> --> specific to the PRIRs used to create the virtualized signals is also included in the encoded stream.</p><p id="p0180" num="0180">Some time later, the listener wishes to listen to the virtualized sound track and the virtualized data held in storage 60 is streamed 61 to a decoder 58 that extracts the personalization measurement head angle information and reconstructs the six virtualized audio streams in real time. On reconstruction the left and right-ear signals are applied to their respective interpolators 56 whose outputs pass through the variable delay buffers 17 to recreate the virtual inter-aural delays. In this example headphone equalization is implemented using filter stages that process the buffer outputs and it is the output of these filters that are used to drive the stereo headphones. Again the benefit of this system is that the processing load associated with the decoding, interpolation, buffering and equalization is small compared to the virtualization process.</p><p id="p0181" num="0181">In the examples of <figref idrefs="f0035">FIGS. 44</figref> and <figref idrefs="f0036">45</figref>, the pre-virtualization process results in a 6-fold increase in the number of audio streams to be transmitted or stored. More generally the number of streams is equal to the number of loudspeakers to be virtualized multiplied by twice the number of personalized head measurement used by the interpolators. One way of reducing the bit rate of such a transmission, or the size of the data file to be held in storage 60 is to use some form of audio bit rate compression, or audio coding within the encoder 57. A complementary audio decoding processes would then reside in the decode process 58 to reconstruct the audio streams. High quality audio coding systems that exist today can operate at a compression ratio down to 12:1 without audible distortion. This implies that the storage requirement of a pre-virtualized encoded stream would compare favorably to that of the original uncompressed audio signal. However, it is likely that for this application even greater compression efficiencies will be possible due to the high degree of correlation between the various virtualized signals entering the encode stage 57.</p><p id="p0182" num="0182">The processes illustrated in <figref idrefs="f0035">FIGS. 44</figref> and <figref idrefs="f0036">45</figref> can be radically simplified if it is deemed acceptable to interpolate between non-time aligned pre-virtualized signals. The implication of this simplification is that the variable delay processing is dropped entirely at the playback stage allowing the left and right-ear signal groups to be summed prior to encoding, reducing the number of signals to be stored or transmitted to the decode side when more then one loudspeaker is to be virtualized.</p><p id="p0183" num="0183">The simplification is illustrated in <figref idrefs="f0038">FIG. 47</figref>. Two channels of audio are applied to the pre-virtualization process 55 and 56, each being virtualized using separate loudspeaker PRIRs. The PRIR data used to convolve the audio signals are not time aligned but retain the<!-- EPO <DP n="64"> --> inter-aural time delays present in the raw PRIR data. The pre-virtualized signals for the three head positions are summed with those of the second audio channel and these are passed through to the left and right-ear interpolator 56 whose outputs drive the headphones directly. The number of pre-virtualized signals that pass to the playback side 51 is now fixed and equals twice the number of PRIR head positions, substantially reducing the audio coding compression requirements that would be required to implement the system illustrated by <figref idrefs="f0036">FIG. 45</figref>.</p><p id="p0184" num="0184"><figref idrefs="f0038">FIG. 47</figref> illustrates the application to 2 audio channels and 3 PRIR head positions. It will be appreciated that this can easily be extended to cover any number of audio channels using two or more PRIR head positions. The main disadvantage of this simplification is that by not time aligning the PRIRs the interpolation process produces significant comb filtering effects that tend to attenuate certain higher frequencies in the headphone audio signals as the listener's head moves between the PRIR measurement points. However since the user may spend most of their time listening to the virtualized loudspeaker sound with their head positioned close to the reference orientation, this artifact may not be perceived as significant to the average user. The headphone equalization is not shown in <figref idrefs="f0038">FIG. 47</figref> for clarity but it will be appreciated that it may be included within the PRIR or during the pre-virtualization processing, or the filtering may be conducted on the decoded signals or on the headphone outputs themselves during playback.</p><p id="p0185" num="0185">The personalized pre-virtualization method of <figref idrefs="f0038">FIG. 47</figref> can be further broadened to cover many different methods for generating the left and right-ear (binaural) headphone signals. In its broadest form the method.describes a technique that generates a number of personalized binaural signals, each representing the same virtual loudspeaker arrangement but for different head orientations of the individual to which the personalized data belongs. These signals may be processed in some way, for example to aid transmission or storage, but ultimately during playback, under control from a head tracker, the binaural signals sent to the headphones are derived from these same sets of signals.In its most basic configuration, two sets of binaural signals, representing two listener head positions, will be used to generate, in real time, a single binaural signal driving the headphones and using the listener's head tracker as a means of determining the appropriate combination. Once again, headphone equalization maybe performed at various stages of the process.</p><p id="p0186" num="0186">One final variation of the pre-virtualization method is illustrated in <figref idrefs="f0037">FIG. 46</figref>. A remote server 64 contains secure audio 67 that may be downloaded 66 to customer storage 60<!-- EPO <DP n="65"> --> for playback through a portable audio player 222. The pre-virtualization could take the form of that illustrated in <figref idrefs="f0036">FIG. 45</figref>, in that the secure audio itself is downloaded and pre-virtualized in the customer's equipment. However, to avoid piracy issues, it may be desirable to force the customer to upload 65 their PRIR files 63 to the remote server and for the server to pre-virtualize the audio 68, encode the virtualized audio 57 and then download the streams 66 to customers own storage device 60. The encoded data held in storage can then be streamed to the decoder for playback over the customer's headphones as per the earlier explanations. The headphone equalization could also be uploaded to the server and incorporated into the pre-virtualization processing, or it can be implemented 62 by the player as per <figref idrefs="f0037">FIG. 46</figref>. The pre-virtualization and playback techniques may make use of the methods exemplified in <figref idrefs="f0036">FIG. 45</figref>, or they could use the simplified approach of <figref idrefs="f0038">FIG. 47</figref> (or its generalized form as discussed).</p><p id="p0187" num="0187">An advantage of this approach is simply that the audio downloaded by the customer has effectively been personalized by the action of convolving the audio with their PRIRs. The audio is much less likely to be pirated since the virtualization will likely prove somewhat ineffective for listeners other than the person for which the PRIRs were measured. Furthermore the PRIR convolution process is difficult to reverse and in the case of secure multi-channel audio, the individual channels virtually impossible to separate from the headphone signals.</p><p id="p0188" num="0188"><figref idrefs="f0037">FIG. 46</figref> illustrates the use of a portable player. However, it will be appreciated that the principle of uploading PRIR data to a remote audio site and then downloading personalized virtualized (binaural) audio can be applied to many types of consumer entertainment playback platforms. It will also be appreciated that the virtualized audio may have associated with it other types of media information such as motion picture or video data and that these signals would typically be synchronized to the virtualized audio playback such that full picture-sound synchronization is achieved. For example, if the application was DVD video playback on a computer, the movie sound tracks would be read from the DVD disk, pre-virtualized and then stored back to the computers own hard drive. The pre-virtualization would typically be performed off line. To watch the movie the computer user starts the movie and rather than listen to the decoded DVD sound track the pre-virtualized audio is played in its place (using the head tracker to simulate the inter-aural delays 17 and/or interpolate 56 in the normal way) synchronized to the picture. Pre-virtualizing the DVD sound track could also be achieved on a remote server using uploaded PRIR as illustrated in <figref idrefs="f0037">FIG. 46</figref>.<!-- EPO <DP n="66"> --></p><p id="p0189" num="0189">The description of the pre-virtualization methods has made reference, by way of example, to a 3-point PRIR measurement scope. It will be appreciated that the methods discussed can easily be expanded to accommodate fewer of more PRIR head orientations. The same applies to the number of input audio channels. Moreover many of the features of the normal real-time virtualization methods, for example those that modify the virtualizer output for head movements that fall outside the measured scope, can equally be applied to the pre-virtualized playback system. The pre-virtualization disclosure has focused on the principle of separating the process of convolution and the interpolation and variable delay processing in order to illustrate the method. It will be appreciated to those skilled in the art that the use of efficient virtualization techniques, such as the sub-band convolution method disclosed herein or other methods such as FFT convolution will lead to improved encoding and decoding implementations. For example, convolved sub-bands audio signals, or FFT coefficients themselves exhibit certain redundancies that can be better exploited by audio coding techniques to improve their bit rate compression efficiency. Moreover, many of the methods proposed to reduce the computational loading of the sub-band convolution process can also be applied to the encoding process. For example sub-bands that fall below a perceptual mask threshold and are optionally removed from the convolution process could also be deleted from the encoding process for that frame, thereby reducing the number of sub-band signals that need to be quantized and coded, leading to a reduction in the bit rate.</p><heading id="h0036"><u>Networked Real Time Personalized Virtualization Applications</u></heading><p id="p0190" num="0190">Many new applications are envisaged in which personalized head tracked virtualization is used. One such general application is networked real time personalized virtualization whereby the convolution process runs on a remote networked server that has available to it PRIR data sets for various networked participants. Such a system forms the core of virtualized telephone conferencing, internet distance learning virtual classroom and interactive networked gaming systems. A general purpose networked virtualizer is illustrated in <figref idrefs="f0039">FIG. 48</figref>. By way of example three remote users A, B and C, are connected to a virtualizer hub 226 via network 227 and wish to communicate in a three-way conference type call. The purpose of the virtualization is to cause the voices of the remote parties to emanate from the local participants headphones such that they appear to come from a distinct direction relative to their reference head orientation. For example, one option would be to make the voice of one of the remote parties to come form a virtual left front loudspeaker and the voice of the other from a virtual right front loudspeaker. Each participants head position is monitored by<!-- EPO <DP n="67"> --> the head trackers and these angles are continually streamed up to the server in order to de-rotate the virtual parties in the presence of head movements.</p><p id="p0191" num="0191">Each participant 79 wears a stereo headphone 80 whose audio signals are streamed down from the server 226. A head tracker 81 tracks the users head movement and this signal is routed up to the server to control the virtualizer 235, inter-aural delay and PRIR interpolation 236 associated with that user. Each headphone also has mounted a boom microphone 228 to allow each users digitized 229 voice signals to pass up to the server 234. Each voice signal is made available as an input to the other participant's virtualizers. In this way each user hears only the other participant's voices as virtualized sources - their own voice being fed back locally to provide a confidence signal.</p><p id="p0192" num="0192">Before beginning the conference, each participant 79 uploads to the server PRIR files (236, 237 and 238) that represent virtual loudspeakers, or point sources, measured for a number of head angles. This data could be the same as that acquired from a home entertainment system or it could be generated specifically for the application. For example it might include many more loudspeaker positions than would ordinarily be required for entertainment purposes. Each user is allocated an independent virtualizer 235 in the server with which their respective PRIR files and head tracker control signals 239 are associated. The left and right-ear outputs of each virtualizer 233 are streamed back in real time to each respective participant through their headphones 80. Clearly <figref idrefs="f0039">FIG. 48</figref> can be expanded to accommodate any number of participants.</p><p id="p0193" num="0193">Where a large transmission delay (latency) exists in the network the head tracking response time may be improved by allowing the head tracked PRIR interpolation and path length processing to be conducted at some location on the network that is more accessible to the listener, i.e., upstream and downstream delays are lower. The new location can be another server on the network or it can be located with the listener. This implies the use of pre-virtualization methods of the type illustrated in <figref idrefs="f0035">FIGS. 44</figref>, <figref idrefs="f0036">45</figref> and <figref idrefs="f0038">47</figref> would be deployed where pre-virtualized signals are transmitted to the secondary site rather than the left and right-ear audio.</p><p id="p0194" num="0194">A further simplification of the teleconference application is possible when the number of participants is small. In this case it may be more economical for each of the participants voice signals to be broadcast across to the network to all other participants. In this way the entire virtualizer reverts back to the standard home entertainment setup where each incoming voice signal is simply an input to the virtualizer equipment located with each participant. Neither a networked virtualizer nor PRIR uploading is required in this case.<!-- EPO <DP n="68"> --></p><heading id="h0037"><u>Real time implementation using a digital signal processor (DSP)</u></heading><p id="p0195" num="0195">A real time implementation of a six channel version of the headphone virtualizer for use within multi-channel home entertainment application running at a sampling rate of 48 kHz, <figref idrefs="f0001">FIG. 1</figref>, was constructed around a single digital signal processor (DSP) chip. This implementation incorporates MLS personalization routines and virtualization routines into a single program. The implementation is able to operate in the modes shown in <figref idrefs="f0018">FIGS. 26</figref>, <figref idrefs="f0019">27</figref> and <figref idrefs="f0020">28</figref> and provides for an additional sixth input 70 and loudspeaker output 72. The DSP core plus ancillary hardware is illustrated in <figref idrefs="f0032">FIG. 41</figref>. The DSP chip 123 handles all the digital signal processing necessary to perform the PRIR measurements, the headphone equalization, head tracker decoding, real time virtualization and all other associated processes. <figref idrefs="f0032">FIG. 41</figref> shows the various digital i/o signals as separate paths for the sake of clarity. The actual hardware uses a programmable logic multiplexer that enables the DSP to read and write the external decoder 114, ADC 99, DACs 92 &amp; 72, SPD1F transmitter 112, SPDIF receiver 111 and the head tracker UART 73 under interrupt or DMA control. Moreover the DSP accesses the RAM 125, Boot ROM 126 and micro-controller 127 through a multiplexed external bus and this too can operate under DMA control if desired.</p><p id="p0196" num="0196">DSP block 123 is common to <figref idrefs="f0018">FIGS. 26</figref>, <figref idrefs="f0019">27</figref> and <figref idrefs="f0020">28</figref> and these illustrations provide a summary of the main signal processing blocks that are implemented as DSP routines within the chip itself. The DSP can be configured to operate in two PRTR measurement modes.</p><p id="p0197" num="0197">Mode A) is designed for applications where direct access to the loudspeakers is not practical, as illustrated in <figref idrefs="f0019">FIG. 27</figref>. In this mode the input audio signals 121 (<figref idrefs="f0032">FIG. 41</figref>) may be derived from a local multi-channel decoder 114 whose bit stream is input via the SPDIF receiver 111, or they can be input directly from a local multi-channel ADC 70. The personalization measurement MLS signals are encoded using an industry standard multi-channel coder and output via the SPDIF transmitter 112. The MLS bit stream is subsequently decoded using a standard AV receiver 109 (<figref idrefs="f0019">FIG. 27</figref>) and directed to the desired loudspeaker.</p><p id="p0198" num="0198">Mode B) is designed for applications where direct access to the loudspeaker signals is possible, as illustrated in <figref idrefs="f0018">FIG. 26</figref>. As with mode A the input audio signals 121 (<figref idrefs="f0032">FIG. 41</figref>) may be derived from a local multi-channel decoder 114 whose bit stream is input via the SPDIF receiver 111, or they can be input directly from a local multi-channel ADC 70. The personalization measurement MLS signals, however, are output directly to a multi-channel DAC 72.</p><p id="p0199" num="0199"><figref idrefs="f0034">FIG. 43</figref> describes the steps and specifications for the personalization routines in accordance with an example of the disclosure. <figref idrefs="f0033">FIG. 42</figref> similarly describes those for the<!-- EPO <DP n="69"> --> virtualization routines. The DSP routines are separated by function and are typically run in the following order after power up for a user that does not have any previously acquired personalized data available.
<ol><li>1) Acquire PRIRs for each loudspeaker and for each head position</li><li>2) Acquire headphone-microphone transfer function for both ears and generate equalization filter</li><li>3) Generate interpolation and inter-aural time delay functions and time align PRIR</li><li>4) Pre-emphasize time aligned PRIR using headphone equalization filter</li><li>5) Generate sub-band PRIRs</li><li>6) Establish the head reference angles</li><li>7) Calculate any virtual loudspeaker offsets</li><li>8) Run virtualizer</li></ol></p><heading id="h0038"><u>Real time Loudspeaker MLS measurements using the DSP</u></heading><p id="p0200" num="0200">The personalized room impulse response measurement routine used a 15-bit binary MLS comprising 32767 states capable of measuring impulse responses up to 32767 samples. At an audio sampling rate of 48kHz this MLS can measure impulse responses within environmental reverberation times of approximately 0.68 seconds without significant circular convolution aliasing. Higher MLS orders could be used where the reverberation time of the room may exceed 0.68 seconds. The three point PRIR measurement method illustrated in <figref idrefs="f0021">FIG. 29</figref> was implemented in the real-time DSP platform. Consequently head pitch and roll were not taken into account when acquiring the PRIRs. Head movements during the MLS measurement process were also ignored and so it was assumed that the human subject's head was held reasonably still for the duration of the tests.</p><p id="p0201" num="0201">To facilitate mode A operation the 32767 sequence was resampled to 32768 samples and a continuous stream of back-to-back blocks encoded using a 5.1ch DTS coherent acoustics encoder running at 1536kbps and with the perfect reconstruction mode enabled. The MLS-encoder frame alignment was adjusted in order to ensure that the original MLS window corresponded exactly to that of 64 decoded frames of 512 samples such that the DTS bit stream could be played in a loop without causing inter-frame discontinuities at the output of the decoder. Once alignment was achieved the 64 frames were extracted from the final DTS bit stream, comprising 1048576 bits, or 32768 stereo SPDIF 16-bit payload words. Bit streams were created for each of the six channels, (where the other input signals to the encoded are muted) including the sub-woofer. Ten bit streams were created per active channel covering a range of MLS amplitudes beginning -27dB and rising to 0dB in 3dB steps.<!-- EPO <DP n="70"> --> All 60 encoded MLS sequences were encoded off-line and the bit streams pre-stored in compact flash 130 (<figref idrefs="f0032">FIG. 41</figref>) and were uploaded to system RAM 125 every time the system was initialization with mode A enabled.</p><p id="p0202" num="0202">During the personalization process all non-essential routines are suspended and the incoming left and right ear microphone samples are processed directly by the circular convolution routines on a sample-per-sample basis. The personalization measurements begins by first determining the amplitude of the MLS necessary to cause the microphones recordings to exceed a -9dB threshold. This would be tested for each loudspeaker separately and the MLS with the lowest amplitude would be used for all the subsequent PRIR measurements. The appropriate bit stream is then streamed out to the SPDIF transmitter in a loop and the digitized microphone signals 99 are circularly convolved with the original resampled MLS. This process continues for 32 MLS frame periods - approximately 22 seconds @48kHz sampling rate. For a full 5.1ch loudspeaker setup the test is typically conducted using the following procedure;</p><p id="p0203" num="0203">The human subject looks towards screen center and holds their head steady and:
<ol><li>1. the left loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>2. the right loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>3. the center loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>4. the left surround loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>5. the right surround loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured, and</li><li>6. the sub-woofer MLS bit stream is looped and the left and right-ear PRIRs measured.</li></ol>
The human subject looks towards the left loudspeaker and holds their head steady and:
<ol><li>1. the left loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>2. the right loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>3. the center loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,<!-- EPO <DP n="71"> --></li><li>4. the left surround loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>5. the right surround loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured, and</li><li>6. the sub-woofer MLS bit stream is looped and the left and right-ear PRIRs measured.</li></ol>
The human subject looks towards the right loudspeaker and holds their head steady and:
<ol><li>1. the left loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>2. the right loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>3. the center loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>4. the left surround loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured,</li><li>5. the right surround loudspeaker MLS bit stream is looped and the left and right-ear PRIRs measured, and</li><li>6. the sub-woofer MLS bit stream is looped and the left and right-ear PRIRs measured.</li></ol></p><p id="p0204" num="0204">For mode B operation 32 scaled 32767 sample MLSs were output directly to the loudspeaker under test 72 (<figref idrefs="f0032">FIG. 41</figref>). As with mode B the amplitude of the MLS is first scaled prior to commencement of the test. The MLS itself is pre-stored as a 32767 bit sequence in the compact flash 130 (<figref idrefs="f0032">FIG. 41</figref>) and uploaded to the DSP on power-up. MLS measurements are made for each loudspeaker under test and for every desired personalized head orientation.</p><p id="p0205" num="0205">The human subject looks towards screen center and holds their head steady and:
<ol><li>1. the MLS is driven out the left loudspeaker and the left and right-ear PRIRs measured,</li><li>2. the MLS is driven out the right loudspeaker and the left and right-ear PRIRs measured,</li><li>3. the MLS is driven out the center loudspeaker and the left and right-ear PRIRs measured,</li><li>4. the MLS is driven out the left surround loudspeaker and the left and right-ear PRIRs measured,</li><li>5. the MLS is driven out the right surround loudspeaker and the left and right-ear<!-- EPO <DP n="72"> --> PRIRs measured, and</li><li>6. the MLS is driven out the sub-woofer and the left and right-ear PRIRs measured.</li></ol>
The human subject looks towards the left loudspeaker and holds their head steady and:
<ol><li>1. the MLS is driven out the left loudspeaker and the left and right-ear PRIRs measured,</li><li>2. the MLS is driven out the right loudspeaker and the left and right-ear PRIRs measured,</li><li>3. the MLS is driven out the center loudspeaker and the left and right-ear PRIRs measured,</li><li>4. the MLS is driven out the left surround loudspeaker and the left and right-ear PRIRs measured,</li><li>5. the MLS is driven out the right surround loudspeaker and the left and right-ear PRIRs measured, and</li><li>6. the MLS is driven out the sub-woofer and the left and right-ear PRIRs measured.</li></ol>
The human subject looks towards the right loudspeaker and holds their head steady and:
<ol><li>1. the MLS is driven out the left loudspeaker and the left and right-ear PRIRs measured,</li><li>2. the MLS is driven out the right loudspeaker and the left and right-ear PRIRs measured,</li><li>3. the MLS is driven out the center loudspeaker and the left and right-ear PRIRs measured,</li><li>4. the MLS is driven out the left surround loudspeaker and the left and right-ear PRIRs measured,</li><li>5. the MLS is driven out the right surround loudspeaker and the left and right-ear PRIRs measured, and</li><li>6. the MLS is driven out the sub-woofer and the left and right-ear PRIRs measured.</li></ol></p><p id="p0206" num="0206">For either A or B modes the 5.1ch personalization measurements result in 18 left-right PRIR pairs of 32768 samples each and these are both held in temporary memory 116 (<figref idrefs="f0018">FIG. 26</figref> and <figref idrefs="f0019">27</figref>) for further processing and are stored back to compact flash. These measurement data can therefore be retrieved by the user at any point in the future without having to repeat the PRIR measurements.</p><heading id="h0039"><u>Real time Headphones MLS measurements using the DSP</u></heading><p id="p0207" num="0207">For both modes A and B the headphone equalization measurement is performed using the straight MLS (mode B). The MLS headphone measurement routine is identical to<!-- EPO <DP n="73"> --> the loudspeaker test except that the scaled MLS is output to the headphones via the headphone DAC rather than the loudspeaker DACs. The responses for each side of the headphone is generated separately using 32 averaged deconvolved MLS frames according to the following:
<ol><li>1. the MLS is driven out the left-ear headphone transducer and the left-ear PRIRs measured, and</li><li>2. the MLS is driven out the right-ear headphone transducer and the right-ear PRIRs measured.</li></ol></p><p id="p0208" num="0208">The left and right-ear impulse responses are time aligned to the nearest sample and truncated such that only the first 128 samples from the impulse onset remain. Each 128 sample impulse is then inverted using the method described herein. During the inverse calculation frequencies above 16125Hz are set to unity gain and pole and zeros are clipped to +/-12dB with respect to the average level between 0 and 750Hz. The resulting left-ch and right-ch 128 tap symmetrical impulse responses are stored back to the compact flash 130 (<figref idrefs="f0032">FIG. 41</figref>).</p><heading id="h0040"><u>Preparation of PRIR data</u></heading><p id="p0209" num="0209">The preparation of the PRIR data for use in the real-time virtualization routines is illustrated in <figref idrefs="f0034">FIG. 43</figref>. On completion of the PRIR measurements the raw left and right-ear PRIR for each loudspeaker and for each of the three lateral head orientations are held in memory 116. First the inter-aural time displacements for all eighteen left and right-ear PRIR pairs are measured 225 to the nearest sample and the values temporarily stored for use by the head tracker processor 9 and 24. The PRIR pairs are then time aligned 225 to the nearest sample as per the methods described herein. The time aligned PRIRs are each convolved with the headphone equalization filters 62 and split into sixteen sub-bands 26 using a 2x over-sampling analysis filter bank whose prototype low-pass filter roll-off had been extended slightly to ensure that unity gain was maintain up to the overlap point, as discussed herein.</p><p id="p0210" num="0210">The action of splitting each PRIR into sub-bands results in 16 sub-band PRIR files each of 4096 samples. The sub-band PRIR files are truncated 223 in order to optimize the computational load of the following convolution processes. For all the audio channels other than the sub-woofer, sub-bands 1 through to 10 of each PRIR are trimmed to include only the first 1500 samples (giving a reverberation time of approximately 0.25s), sub-bands 11 through to 14 are trimmed to include only the first 32 samples and sub-bands 15 and 16 are deleted altogether and therefore frequencies above 21kHz are absent from the headphone audio. For the sub-woofer channel sub-band 1 is trimmed to include only the first 1500<!-- EPO <DP n="74"> --> samples and all other sub-bands are deleted and are not included in the sub-woofer convolution calculations. Once trimmed, the sub-band PRIR data is then loaded 224 to their respective sub-band PRIR interpolation processor 16 memory for use by the real-time virtualizing processes of <figref idrefs="f0033">FIG. 42</figref>.</p><p id="p0211" num="0211">The PRIR interpolation formula (equations 8-14) were used in this DSP implementation. This required that the three PRIR measurement head angles Î¸ L, Î¸ C, and Î¸ R, corresponding to viewing head angles 176, 177 and 178 (<figref idrefs="f0021">FIG. 29</figref>), respectively, be known. The implementation assumed that the front center loudspeaker 181 was exactly aligned with the reference head angle Î¸ ref. This permitted Î¸ L, Î¸ C, and Î¸ R to be calculated by analyzing the inter-aural times delays between the left and right-ear PRIR pairs for each of the three head positions with the center loudspeaker as the MLS excitation source using equation 1. In this case the maximum absolute delay was fixed at 24 samples.</p><p id="p0212" num="0212">The inter-aural path length formula for each virtual loudspeaker are estimated using equations 23-25 and in combination with any virtual offset adjustment each differential path length is calculated using equation 31. The sine function is constructed in software using a 32 point single quadrant look up table combined with 4-bit linear interpolation providing an angular resolution of 0.25 degrees. The path length calculation continues even when the listeners head moves out of the scope of the PRIR measurements angles.</p><p id="p0213" num="0213">As an option, the PRIR interpolation and the path length formula generation routines were able to access information relating to the PRIR head angles and the loudspeaker locations manually entered into the virtualizer via the keyboard 129 (<figref idrefs="f0032">FIG. 41</figref>).</p><heading id="h0041"><u>Dynamic head tracked calculations</u></heading><p id="p0214" num="0214">The head tracker implementation was based on a headphone mounted 3-axis magnetic sensor design utilizing a 2-axis tilt accelerometer to de-rotate the magnetic readings in the presence of listener head tilt. To avoid interference, electrostatic headphones were used to reproduce the virtualized signals. The magnetic and tilt measurements and heading calculations were conducted by an onboard microcontroller at a update rate of 120Hz. The listeners head yaw, pitch and roll angles were streamed to the virtualizer using a simple asynchronous serial format transmitted at a baud rate 9600 bit/s. The bit stream comprised synchronization data, optional commands, and the three head orientations. The head angles were encoded using a +/-180 degree format using a Q2 binary format and therefore provided a basic resolution of 0.25 degrees in any axis. As a result two bytes were transmitted to encapsulate each head angle. The head tracker serial stream was connected to the out board UART 73 (<figref idrefs="f0032">FIG. 41</figref>) and each byte decoded and passed on to the DSP 123 via an interrupt<!-- EPO <DP n="75"> --> service routine. The head tracker update rate is free running (approximately 120Hz) and is not synchronized to that of the audio sampling rate of the virtualizer. On each head tracker interrupt the DSP reads the UART bus and checks for the presence of synchronizing bytes. Bytes that follow a recognized synchronization pattern are used to update the head orientation angles retained in the DSP and optionally flag head tracker commands.</p><p id="p0215" num="0215">One of the head tracker command functions is to ask the DSP to sample the current head yaw angle and copy this to the reference head orientation Î¸ ref stored internally. This command is triggered by a micro-switch mounted on the head tracker unit itself mounted on the headphones head band. In this implementation the reference angle is established by asking the listener to place the headphones on their head and then to look towards the center loudspeaker and to press the reference angle micro-switch. The DSP then uses this head yaw angle as the reference. Changes in the reference angle can be made at any time by simply pressing the switch.</p><p id="p0216" num="0216">The sub-band interpolation coefficient and variable delay path length updates are calculated at the virtualizer frame rate of 200Hz (240 input samples @Fs=48kHz). A unique set of interpolation coefficients are independently calculated for each of the audio channels to allow for virtual offset adjustments to be made (Î¸ v<sub>x</sub>) on a loudspeaker-by-loudspeaker basis. The resulting sub-band interpolation coefficients are used directly to generate an interpolated set of sub-band PRIRs for each audio channel 16 (<figref idrefs="f0010">FIG. 16</figref>).</p><p id="p0217" num="0217">However, the path length updates are not used directly to drive the over-sampled buffer addresses 20 (<figref idrefs="f0012">FIG. 18</figref>) but are used instead to update a set of' desired path length' variables. The actual path lengths are updated every 24 input samples and are incrementally adjusted using a delta function such that they adapt in the direction of the desired path length values. This means that all the virtual loudspeaker path lengths are effectively adjusted at a rate of 2kHz in response to changes in the head tracker yaw angle. The purpose of using the delta update is to ensure that the variable buffer path lengths do not change in large steps and thus avoids the possibility of introducing audible artifacts into the audio signals as a result of sudden changes in the listeners head angle.</p><p id="p0218" num="0218">For head yaw angles outside the scope of the personalization range the interpolation coefficient calculation saturates at their most extreme left or right position. Ordinarily head tracker pitch and roll angles are ignored by the virtualizer since these were not included in the PRIR measurement scope. However when the pitch angle exceeds approximately +/- 65 degrees (+/-90 degrees being horizontal) the virtualizer will switch in the loudspeaker signals, where available, 132 (<figref idrefs="f0020">FIG. 28</figref>). This provides a convenient way for<!-- EPO <DP n="76"> --> the listener to remove the headphones and to lay them flat and continue to listen to the audio via the loudspeakers.</p><heading id="h0042"><u>Real time 5.1ch DSP Virtualizer</u></heading><p id="p0219" num="0219"><figref idrefs="f0033">FIG. 42</figref> illustrates a set of routines implemented to virtualize a single input audio channel, in accordance with an example of the disclosure. All the functions are duplicated for the remainder of the channels and their left and right-ear headphone signals summed to form a composite stereo headphone output. The analogue audio input signal is digitized 70 in real time at a sample rate of 48 kHz and loaded, using an interrupt service routine, to a 240 sample buffer 71. On filling this buffer the DSP invokes a DMA routine that both copies the input samples to an internal temporary buffer and reloads the left and right channel output buffers 71 with newly virtualized audio from a pair of temporary output buffers. This DMA occurs every 240 input samples and so the virtualizer frame rate runs at 200Hz.</p><p id="p0220" num="0220">The 240 newly acquired input samples are split into 16 sub-bands 26 using a 2x over-sampled 480-tap analysis filter bank. The prototype low-pass filter for this and the synthesis filter bank is designed in the normal way i.e., the overlap point is approximately 3dB down on the pass band. The 30 samples in each sub-band are then convolved, using left- ear and right-ear sub-band convolvers 30, with the relevant sub-band PRIR samples 16 generated by the interpolation routines and using the most up-to-date interpolation coefficients. The convolved left and right-ear samples are each reconstructed back into 240 sample waveforms using a complementary 16-band sub-band 480 tap synthesis filter bank 27. The 240 reconstructed left and right-ear samples then pass through variable delay buffers 17 to effect the inter-aural time delays appropriate to the virtual loudspeaker. The variable buffer implementation uses a 500x over sampling architecture and deploys a 32000 tap anti-aliasing filter.</p><p id="p0221" num="0221">As a result, each buffer is separately able to delay the input sample stream up to 32 samples in steps down to 1/500th of a sample. As described earlier, the delays are updated every 24 input sample periods, or every 0.5ms and so the variable delays are updated 10 times in each 240 input sample period. The 240 samples output from the left-ear and right-ear variable delay buffers of each channel virtualizer are summed 5 and loaded to temporary output sample buffers in preparation for their transfer to the output buffers 71 on the next DMA input/output routine. The left and right-ear output samples are transferred in real time to the DACs 72 at a rate of 48kHz using an interrupt service routine. The resulting analogue signals are buffered and output to the headphone worn by the listener.<!-- EPO <DP n="77"> --></p><heading id="h0043"><u>Variations and Alternate Examples</u></heading><p id="p0222" num="0222">While several illustrative examples of the disclosure have been shown and described throughout the detailed description, numerous variations and alternate examples will occur to those skilled in the art. Such variations and alternate examples are contemplated and can be made without departing from the scope of the disclosure.</p><p id="p0223" num="0223">For example, the description has made reference to a personalization measurement process that establishes the scope of the listeners head movements during playback. Theoretically two or more measurement points are required in order to facilitate the interpolation. Indeed many of the examples have illustrated the use of three and five point PRIR measurement scopes. Measuring each of the loudspeakers responses in this way has the advantage that the PRIR interpolation that de-rotates head movements always has, at its disposal, PRIR data specific to the real loudspeaker that is being used to project the virtual loudspeaker, provided the head movements are within the measurement scope. In other words, virtual loudspeakers will ordinarily match, almost exactly, the experience of the real loudspeaker since they use PRIR data specific to that loudspeaker. One departure from this method is to measure only one set of PRIRs for each loudspeaker, i.e., the human subject simply takes up one fixed head position and acquires a left and right-ear PRIR for each of the loudspeakers that make up their entertainment system.</p><p id="p0224" num="0224">Normally, the human subject would look towards the screen center, or some other ideal listening orientation prior to making the measurements. In this situation any head movement detected by the head tracker that deviates from this reference head orientation is de-rotated using interpolated PRIR data sets that are not related to the loudspeaker that is being virtualized The inter-aural path length calculations, however, may remain accurate since they can be derived from the various loudspeaker PRIR data or input to the virtualizer itself manually in the normal way. The process of interpolating between adjacent loudspeaker PRIRs has already been discussed to some degree in one of the methods used extend the range of the virtualizer beyond the measured scope (see section entitled 'Head movements that fall outside the measured scope').</p><p id="p0225" num="0225"><figref idrefs="f0025">FIG. 34b</figref> illustrates the interpolation requirements for the left front loudspeaker for head rotations beyond the +/-30 degree measurement scope. In this example it was assumed that each loudspeaker was represented for a full 60 degrees of head turn and that only where insufficient coverage existed, were adjacent loudspeaker PRIRs interpolated to fill the gap, 203, 207, 205 (<figref idrefs="f0025">FIG. 34b</figref>) respectively. In the method whereby only one set of PRIRs<!-- EPO <DP n="78"> --> are measured, each zone between the loudspeakers deploys adjacent loudspeaker interpolation.</p><p id="p0226" num="0226">The following description illustrates the process using the same loudspeaker set up shown in <figref idrefs="f0025">FIG. 34</figref>. Again, in this description, the left front loudspeaker is to be virtualized throughout the entire 360 degree head turn range. Starting with the listener viewing the center loudspeaker (0 degrees), all PRIR interpolators use those responses measured directly from the real loudspeakers. As the listener's head turns away anti-clockwise, towards the left loudspeaker position, the PRIR interpolator for the left front virtual loudspeaker begins to output a linear combination of the left and center loudspeaker PRIRs to the convolver in proportional to the listener's head angle between the center and left loudspeaker positions.</p><p id="p0227" num="0227">By the time the listener's head orientation reaches the left loudspeaker position, -30 degrees, the virtual left loudspeaker convolution is conducted entirely with the center loudspeaker PRIR. As the head continues in the anti-clockwise direction, -30 through to -60 degrees, the interpolator outputs a linear combination of the center and right loudspeaker PRIRs to the convolver. From -60 through to -150 degrees the right and right surround PRIRs are used by the interpolator. From -150 through to +90 degrees the right surround and left surround PRIRs are used. Finally moving anti-clockwise from +90 through to 0 degrees the left surround and left PRIRs are used by the interpolator. This description illustrates the interpolation combinations necessary to stabilize the virtual left front loudspeaker during a 360 degree head turn. The PRIR combinations for other virtual loudspeakers are easily derived by inspecting the geometry of the specific loudspeaker arrangement and the available PRIR data sets.</p><p id="p0228" num="0228">It will be appreciated that PRIRs measured for only a single head orientation can equally be applied to the pre-virtualization methods discussed within, In these cases the scope of the binaural signals are not limited to that of the PRIR head orientations, and so the user decides the desired range of head movement, generates the appropriate interpolated loudspeaker PRIRs that cover the range, and runs the virtualization for each. The head movement limits are then sent to the playback device in order to set up the interpolator range appropriately. If required, the path length data is also sent in order to generate the inter-aural path lengths as the listener's head moves between the limits of the interpolators.</p><p id="p0229" num="0229">The foregoing description of the examples of the disclosure has been presented for the purpose of illustration; it is not intended to be exhaustive or to limit the disclosure to the precise forms described. Persons skilled in the relevant art can appreciate that many modifications and variations are possible in light of the above teachings. It is therefore<!-- EPO <DP n="79"> --> intended that the scope of the invention be limited not by this detailed description, but rather by the claims appended hereto.</p></description><claims mxw-id="PCLM56987075" lang="DE" load-source="patent-office"><!-- EPO <DP n="84"> --><claim id="c-de-01-0001" num="0001"><claim-text>Audiosystem fÃ¼r personalisierte Virtualisierung eines Satzes von Lautsprechern in einem Paar von KopfhÃ¶rern, wobei das System umfasst:
<claim-text>eine Audioeingang-Schnittstelle (70) zum Empfangen eines Lautsprecher-Eingangssignals,</claim-text>
<claim-text>eine KopfhÃ¶rerausgang-Schnittstelle (72) zum Antreiben eines Paares von KopfhÃ¶rern mit einem Audiosignal, wobei das Paar von KopfhÃ¶rern einen linken KopfhÃ¶rer und einen rechten KopfhÃ¶rer einschlieÃŸt;</claim-text>
<claim-text>ein KopfhÃ¶rer-Verfolgungssystem (81) zum Detektieren einer Orientierung der KopfhÃ¶rer;</claim-text>
<claim-text>eine Antwortfunktions-Schnittstelle (127) zum Lesen von zwei oder mehr SÃ¤tzen von vorgegebenen personalisierten Antwortfunktionen auf der Basis der detektierten Orientierung der KopfhÃ¶rer, wobei jede vorgegebene personalisierte Antwortfunktion eine Transformation von einem bestimmten Lautsprecher in den linken KopfhÃ¶rer oder den rechten KopfhÃ¶rer fÃ¼r eine bestimmte Orientierung der KopfhÃ¶rer reprÃ¤sentiert; und</claim-text>
<claim-text>einen Virtualisierer (122), an die KopfhÃ¶rerausgang-Schnittstelle gekoppelt, worin der Virtualisierer konfiguriert ist zum:
<claim-text>SchÃ¤tzen eines Satzes von Antwortfunktionen fÃ¼r die detektierte Orientierung der KopfhÃ¶rer durch Interpolieren der zwei oder mehr SÃ¤tze von vorgegebenen personalisierten Antwortfunktionen, worin die vorgegebenen personalisierten Antwortfunktionen Impulsfunktionen sind und worin zwei oder mehr Impulsfunktionen interpoliert werden durch: Messen einer ZeitverzÃ¶gerung fÃ¼r jede Impulsfunktion, Entfernen der ZeitverzÃ¶gerungen aus jeder Impulsfunktion, Mittelwertbildung der resultierenden Impulsfunktionen durch Gewichten gemÃ¤ÃŸ der detektierten Orientierung der KopfhÃ¶rer und den Orientierungen der mit den Impulsfunktionen assoziierten KopfhÃ¶rer und WiedereinfÃ¼hren der entfernten VerzÃ¶gerung in die gemittelte Impulsfunktion;</claim-text>
<claim-text>Transformieren des Lautsprecher-Eingangssignals unter Verwendung des Satzes von geschÃ¤tzten Antwortfunktionen und Anlegen eines resultierenden virtualisierten Audiosignals an die KopfhÃ¶rerausgang-Schnittstelle.</claim-text></claim-text></claim-text></claim><claim id="c-de-01-0002" num="0002"><claim-text>System nach Anspruch 1, worin die Antwortfunktions-Schnittstelle Antwortfunktionen aus einem externen Speicher liest.</claim-text></claim><claim id="c-de-01-0003" num="0003"><claim-text>System nach Anspruch 1, worin das Lautsprecher-Eingangssignal eine Vielzahl von LautsprecherkanÃ¤len umfasst und der Virtualisierer das Lautsprecher-Eingangssignal transformiert, indem er jeden Lautsprecherkanal unter Verwendung von geschÃ¤tzten Antwortfunktionen transformiert, die mit dem linken KopfhÃ¶rer und dem rechten KopfhÃ¶rer assoziiert sind.<!-- EPO <DP n="85"> --></claim-text></claim><claim id="c-de-01-0004" num="0004"><claim-text>System nach Anspruch 3, worin der Virtualisierer auÃŸerdem das transformierte Lautsprecher-Eingangssignal kombiniert. worin das Kombinieren umfasst, dass die transformierten KanÃ¤le des linken KopfhÃ¶rers und die transformierten KanÃ¤le des rechten KopfhÃ¶rers separat addiert werden, um ein virtualisiertes Doppelkanal-Audiosignal fÃ¼r die KopfhÃ¶rerausgang-Schnittstelle zu erhalten.</claim-text></claim><claim id="c-de-01-0005" num="0005"><claim-text>System nach Anspruch 1, worin der Virtualisierer auÃŸerdem dazu konfiguriert ist, eine oder mehrere der geschÃ¤tzten Antwortfunktionen anzupassen, um die wahrgenommene Entfernung der entsprechenden Lautsprecher zu Ã¤ndern.</claim-text></claim><claim id="c-de-01-0006" num="0006"><claim-text>System nach Anspruch 5, worin eine geschÃ¤tzte Antwortfunktion angepasst wird, indem ein direkter Teil und ein halliger Teil der Antwortfunktion identifiziert werden und die Amplitude und Position des direkten Teils relativ zum halligen Teil geÃ¤ndert werden.</claim-text></claim><claim id="c-de-01-0007" num="0007"><claim-text>System nach Anspruch 1, worin der Virtualiserer auÃŸerdem dazu konfiguriert ist, eine inverse Transferfunktion anzuwenden, um einen Effekt der KopfhÃ¶rer auf eine Signalausgabe daraus zu kompensieren.</claim-text></claim><claim id="c-de-01-0008" num="0008"><claim-text>System nach Anspruch 1, worin der Virtualiserer auÃŸerdem dazu konfiguriert ist, eine inverse Transferfunktion und eine ideale Referenztransferfunktion auf das Lautsprecher-Eingangssignal anzuwenden, wobei die inverse Transferfunktion dazu konstruiert ist, einen Effekt der Lautsprecher auf eine Signalausgabe daraus zu kompensieren, und die ideale Referenztransferfunktion dazu konstruiert ist, als Effekt einen Satz von Lautsprechern mit verbesserter WiedergabequalitÃ¤t zu erzeugen.</claim-text></claim><claim id="c-de-01-0009" num="0009"><claim-text>Verfahren zum Virtualisieren eines Satzes von Lautsprechern in ein Paar von KopfhÃ¶rern fÃ¼r einen ZuhÃ¶rer, wobei das Paar von KopfhÃ¶rern einen linken KopfhÃ¶rer und einen rechten KopfhÃ¶rer einschlieÃŸt, das Verfahren umfassend:
<claim-text>Empfangen eines Audiosignals fÃ¼r den Satz von Lautsprechern;</claim-text>
<claim-text>Verfolgen einer Orientierung der KopfhÃ¶rer;</claim-text>
<claim-text>AuswÃ¤hlen von zwei oder mehr SÃ¤tzen von vorgegebenen personalisierten Antwortfunktionen auf der Basis der verfolgten KopfhÃ¶rerorientierung, wobei jede vorgegebene personalisierte Antwortfunktion eine Transformation von einem bestimmten Lautsprecher in den linken KopfhÃ¶rer oder den rechten KopfhÃ¶rer fÃ¼r eine bestimmte Orientierung der KopfhÃ¶rer reprÃ¤sentiert;</claim-text>
<claim-text>SchÃ¤tzen eines Satzes von Antwortfunktionen fÃ¼r die verfolgte Orientierung der KopfhÃ¶rer durch Interpolieren der zwei oder mehr SÃ¤tze von vorgegebenen personalisierten Antwortfunktionen, worin die vorgegebenen personalisierten Antwortfunktionen Impulsfunktionen sind und worin zwei oder mehr Impulsfunktionen interpoliert werden durch: Messen einer ZeitverzÃ¶gerung fÃ¼r jede Impulsfunktion, Entfernen der ZeitverzÃ¶gerungen aus jeder Impulsfunktion, Mittelwertbildung der resultierenden Impulsfunktionen durch Gewichten gemÃ¤ÃŸ der verfolgten Orientierung der<!-- EPO <DP n="86"> --> KopfhÃ¶rer und der mit den Impulsfunktionen assoziierten Orientierungen der KopfhÃ¶rer und WiedereinfÃ¼hren der entfernten VerzÃ¶gerung in die gemittelte Impulsfunktion;</claim-text>
<claim-text>Transformieren des empfangenen Audiosignals unter Verwendung des Satzes von geschÃ¤tzten Antwortfunktionen und Bereitstellen eines resultierenden virtualisierten Audiosignals an die KopfhÃ¶rer.</claim-text></claim-text></claim><claim id="c-de-01-0010" num="0010"><claim-text>Verfahren nach Anspruch 9, auÃŸerdem umfassend:
<claim-text>Speichern einer jeden Antwortfunktion als einen Satz von Filterkoeffizienten.</claim-text></claim-text></claim><claim id="c-de-01-0011" num="0011"><claim-text>Verfahren nach Anspruch 9, worin das empfangene Audiosignal eine Vielzahl von LautsprecherkanÃ¤len umfasst und das Transformieren des empfangenen Audiosignals umfasst, dass jeder Lautsprecherkanal des empfangenen Audiosignals unter Verwendung von geschÃ¤tzten Antwortfunktionen transformiert wird, die mit dem linken KopfhÃ¶rer und dem rechten KopfhÃ¶rer assoziiert sind.</claim-text></claim><claim id="c-de-01-0012" num="0012"><claim-text>Verfahren nach Anspruch 11, auÃŸerdem umfassend, dass das transformierte Audiosignal kombiniert wird, worin das Kombinieren umfasst, dass die transformierten KanÃ¤le des linken KopfhÃ¶rers und die transformierten KanÃ¤le des rechten KopfhÃ¶rers addiert werden, um ein transformiertes Doppelkanal-Audiosignal zu erhalten, das fÃ¼r die KopfhÃ¶rer geeignet ist.</claim-text></claim><claim id="c-de-01-0013" num="0013"><claim-text>Verfahren nach Anspruch 9, auÃŸerdem umfassend:
<claim-text>Anpassen von einer oder mehreren der geschÃ¤tzten Antwortfunktionen, um die wahrgenommene Entfernung der entsprechenden Lautsprecher zu Ã¤ndern.</claim-text></claim-text></claim><claim id="c-de-01-0014" num="0014"><claim-text>Verfahren nach Anspruch 13, worin das Anpassen umfasst:
<claim-text>Identifizieren eines direkten Teils und eines halligen Teils der geschÃ¤tzten Antwortfunktion; und</claim-text>
<claim-text>Ã„ndern der Amplitude und Position des direkten Teils relativ zum halligen Teil.</claim-text></claim-text></claim><claim id="c-de-01-0015" num="0015"><claim-text>Verfahren nach Anspruch 9, auÃŸerdem umfassend:
<claim-text>Anwenden einer inversen Transferfunktion, um einen Effekt der KopfhÃ¶rer auf eine Signalausgabe daraus zu kompensieren.</claim-text></claim-text></claim><claim id="c-de-01-0016" num="0016"><claim-text>Verfahren nach Anspruch 9, auÃŸerdem umfassend:
<claim-text>Anwenden einer inversen Transferfunktion auf das empfangene Audiosignal, wobei die inverse Transferfunktion dazu konstruiert ist, einen Effekt der Lautsprecher auf eine Signalausgabe daraus zu kompensieren; und</claim-text>
<claim-text>Anwenden einer idealen Referenztransferfunktion auf das empfangene Audiosignal, wobei die ideale Referenztransferfunktion dazu konstruiert ist, als Effekt einen Satz von Lautsprechern mit verbesserter WiedergabequalitÃ¤t zu erzeugen.</claim-text></claim-text></claim></claims><claims mxw-id="PCLM56987076" lang="EN" load-source="patent-office"><!-- EPO <DP n="80"> --><claim id="c-en-01-0001" num="0001"><claim-text>An audio system for personalized virtualization of a set of loudspeakers in a pair of headphones, the system comprising:
<claim-text>an audio input interface (70) for receiving a loudspeaker input signal;</claim-text>
<claim-text>a headphone output interface (72) for driving a pair of headphones with an audio signal, the pair of headphones including a left headphone and a right headphone;</claim-text>
<claim-text>a headphone tracking system (81) for detecting an orientation of the headphones;</claim-text>
<claim-text>a response function interface (127) for reading two or more sets of predetermined personalized response functions based on the detected orientation of the headphones, each predetermined personalized response function representing a transformation from a particular loudspeaker to the left headphone or the right headphone for a particular orientation of the headphones; and</claim-text>
<claim-text>a virtualizer (122) coupled to the headphone output interface, wherein the virtualizer is configured to:
<claim-text>estimate a set of response functions for the detected orientation of the headphones by interpolating the two or more sets of predetermined personalized response functions, wherein the predetermined personalized response functions are impulse functions, and wherein two or more impulse functions are interpolated by: measuring a time delay for each Impulse function, removing the time delays from each impulse function, averaging the resulting impulse functions by weighting according to the detected orientation of the headphones and the orientations of the headphones associated with the impulse functions, and reincorporating the removed delay into the averaged impulse function;</claim-text>
<claim-text>transform the loudspeaker input signal using the set of estimated response functions and to provide a resulting virtualized audio signal to the headphone output interface.</claim-text></claim-text><!-- EPO <DP n="81"> --></claim-text></claim><claim id="c-en-01-0002" num="0002"><claim-text>The system of claim 1, wherein the response function interface reads response functions from an external memory.</claim-text></claim><claim id="c-en-01-0003" num="0003"><claim-text>The system of claim 1, wherein the loudspeaker input signal comprises a plurality of loudspeaker channels, and the virtualizer transforms the loudspeaker input signal by transforming each loudspeaker channel using estimated response functions associated with the left headphone and the right headphone.</claim-text></claim><claim id="c-en-01-0004" num="0004"><claim-text>The system of claim 3, wherein the virtualizer further combines the transformed loudspeaker input signal, wherein the combining comprises separately summing the left-headphone transformed channels and the right-headphone transformed channels to obtain a dual channel virtualized audio signal for the headphone output interface.</claim-text></claim><claim id="c-en-01-0005" num="0005"><claim-text>The system of claim 1, wherein the virtualizer is further configured to adjust one or more of the estimated response functions to change the perceived distance of the corresponding loudspeakers.</claim-text></claim><claim id="c-en-01-0006" num="0006"><claim-text>The system of claim 5, wherein an estimated response function is adjusted by identifying a direct portion and a reverberant portion of the response function, and changing the amplitude and position of the direct portion relative to the reverberant portion.</claim-text></claim><claim id="c-en-01-0007" num="0007"><claim-text>The system of claim 1, wherein the virtualizer is further configured to apply an inverse transfer function to compensate for an effect of the headphones on a signal output therefrom.</claim-text></claim><claim id="c-en-01-0008" num="0008"><claim-text>The system of claim 1, wherein the virtualizer is further configured to apply an inverse transfer function and an ideal reference transfer function to the loudspeaker input signal, the inverse transfer function designed to compensate for an effect of the loudspeakers on a signal output therefrom, and the ideal reference transfer function designed to produce an effect of a set of loudspeakers having improved fidelity.</claim-text></claim><claim id="c-en-01-0009" num="0009"><claim-text>A method for virtualizing a set of loudspeakers into a pair of headphones for a listener, the pair of headphones including a left headphone and a right headphone, the method comprising:
<claim-text>receiving an audio signal for the set of loudspeakers;<!-- EPO <DP n="82"> --></claim-text>
<claim-text>tracking an orientation of the headphones;</claim-text>
<claim-text>selecting two or more sets of predetermined personalized response functions based on the tracked headphones orientation, each predetermined personalized response function representing a transformation from a particular loudspeaker to the left headphone or the right headphone for a particular orientation of the headphones;</claim-text>
<claim-text>estimating a set of response functions for the tracked orientation of the headphones by interpolating the two or more sets of predetermined personalized response functions, wherein the predetermined personalized response functions are Impulse functions, and wherein two or more impulse functions are interpolated by: measuring a time delay for each impulse function, removing the time delays from each impulse function, averaging the resulting impulse functions by weighting according to the tracked orientation of the headphones and the orientations of the headphones that are associated with the impulse functions, and reincorporating the removed delay into the averaged impulse function;</claim-text>
<claim-text>transforming the received audio signal using the set of estimated response functions and providing a resulting virtualized audio signal to the headphones.</claim-text></claim-text></claim><claim id="c-en-01-0010" num="0010"><claim-text>The method of claim 9, further comprising:
<claim-text>storing each response function as a set of filter coefficients.</claim-text></claim-text></claim><claim id="c-en-01-0011" num="0011"><claim-text>The method of claim 9, wherein the received audio signal comprises a plurality of loudspeaker channels, and transforming the received audio signal comprises transforming each loudspeaker channel of the received audio signal using estimated response functions associated with the left headphone and the right headphone.</claim-text></claim><claim id="c-en-01-0012" num="0012"><claim-text>The method of claim 11, further comprising combining the transformed audio signal, wherein the combining comprises separately summing the left-headphone transformed channels and the right-headphone transformed channels to obtain a dual channel transformed audio signal suitable for the headphones.</claim-text></claim><claim id="c-en-01-0013" num="0013"><claim-text>The method of claim 9, further comprising:<!-- EPO <DP n="83"> -->
<claim-text>adjusting one or more of the estimated response functions to change the perceived distance of the corresponding loudspeakers.</claim-text></claim-text></claim><claim id="c-en-01-0014" num="0014"><claim-text>The method of claim 13, wherein the adjusting comprises:
<claim-text>identifying a direct portion and a reverberant portion of the estimated response function; and</claim-text>
<claim-text>changing the amplitude and position of the direct portion relative to the reverberant portion.</claim-text></claim-text></claim><claim id="c-en-01-0015" num="0015"><claim-text>The method of claim 9, further comprising:
<claim-text>applying an inverse transfer function to compensate for an effect of the headphones on a signal output therefrom.</claim-text></claim-text></claim><claim id="c-en-01-0016" num="0016"><claim-text>The method of claim 9, further comprising:
<claim-text>applying an inverse transfer function to the received audio signal, the inverse transfer function designed to compensate for an effect of the loudspeakers on a signal output therefrom; and</claim-text>
<claim-text>applying an ideal reference transfer function to the received audio signal, the ideal reference transfer function designed to produce an effect of a set of loudspeakers having improved fidelity.</claim-text></claim-text></claim></claims><claims mxw-id="PCLM56987077" lang="FR" load-source="patent-office"><!-- EPO <DP n="87"> --><claim id="c-fr-01-0001" num="0001"><claim-text>SystÃ¨me audio pour la virtualisation personnalisÃ©e d'un ensemble de haut-parleurs dans une paire d'Ã©couteurs, le systÃ¨me comprenant :
<claim-text>une interface d'entrÃ©e audio (70) pour recevoir un signal d'entrÃ©e de haut-parleur ;</claim-text>
<claim-text>une interface de sortie d'Ã©couteurs (72) pour commander une paire d'Ã©couteurs avec un signal audio, la paire d'Ã©couteurs comportant un Ã©couteur gauche et un Ã©couteur droit ;</claim-text>
<claim-text>un systÃ¨me de suivi d'Ã©couteurs (81) pour dÃ©tecter une orientation des Ã©couteurs ;</claim-text>
<claim-text>une interface de fonctions de rÃ©ponse (127) pour lire deux ensembles ou plus de fonctions de rÃ©ponse personnalisÃ©es prÃ©dÃ©terminÃ©es sur la base de l'orientation dÃ©tectÃ©e des Ã©couteurs, chaque fonction de rÃ©ponse personnalisÃ©e prÃ©dÃ©terminÃ©e reprÃ©sentant une transformation Ã  partir d'un haut-parleur particulier vers l'Ã©couteur gauche ou l'Ã©couteur droit pour une orientation particuliÃ¨re des Ã©couteurs ; et</claim-text>
<claim-text>un virtualiseur (122) couplÃ© Ã  l'interface de sortie d'Ã©couteurs, le virtualiseur Ã©tant configurÃ© pour :
<claim-text>estimer un ensemble de fonctions de rÃ©ponse pour l'orientation dÃ©tectÃ©e des Ã©couteurs par interpolation des deux ensembles ou plus de fonctions de rÃ©ponse personnalisÃ©es prÃ©dÃ©terminÃ©es, les fonctions de rÃ©ponse personnalisÃ©es prÃ©dÃ©terminÃ©es Ã©tant des fonctions d'impulsion, et deux ou plusieurs fonctions d'impulsion Ã©tant interpolÃ©es par : mesure d'un temps de retard pour chaque fonction d'impulsion, suppression des temps de retard de chaque fonction d'impulsion, dÃ©termination de la moyenne des fonctions d'impulsion obtenues par pondÃ©ration selon l'orientation dÃ©tectÃ©e des Ã©couteurs et les orientations des Ã©couteurs associÃ©es avec les fonctions d'impulsion, et rÃ©incorporation du retard supprimÃ© dans la fonction d'impulsion moyennÃ©e ;</claim-text>
<claim-text>transformer le signal d'entrÃ©e de haut-parleur au moyen de l'ensemble de fonctions de rÃ©ponse estimÃ©es et fournir un signal audio virtualisÃ© rÃ©sultant Ã  l'interface de sortie des Ã©couteurs.</claim-text></claim-text></claim-text></claim><claim id="c-fr-01-0002" num="0002"><claim-text>SystÃ¨me selon la revendication 1, dans lequel l'interface de fonctions de rÃ©ponse lit les fonctions de rÃ©ponse Ã  partir d'une mÃ©moire externe.</claim-text></claim><claim id="c-fr-01-0003" num="0003"><claim-text>SystÃ¨me selon la revendication 1, dans lequel le signal d'entrÃ©e de haut-parleur comprend une pluralitÃ© de canaux de haut-parleur, et le virtualiseur transforme le signal d'entrÃ©e de haut-parleur par transformation de chaque canal de haut-parleur au moyen des fonctions de rÃ©ponse estimÃ©es associÃ©es avec l'Ã©couteur gauche et l'Ã©couteur droit.</claim-text></claim><claim id="c-fr-01-0004" num="0004"><claim-text>SystÃ¨me selon la revendication 3, dans lequel le virtualiseur combine en outre le signal d'entrÃ©e de haut-parleur transformÃ©, dans lequel la combinaison comprend l'ajout sÃ©parÃ© des canaux transformÃ©s de l'Ã©couteur gauche et des canaux transformÃ©s de l'Ã©couteur droit pour obtenir un signal audio virtualisÃ© Ã  canal double pour l'interface de sortie des Ã©couteurs.<!-- EPO <DP n="88"> --></claim-text></claim><claim id="c-fr-01-0005" num="0005"><claim-text>SystÃ¨me selon la revendication 1, dans lequel le virtualiseur est en outre configurÃ© pour ajuster une ou plusieurs des fonctions de rÃ©ponse estimÃ©es pour modifier la distance perÃ§ue des haut-parleurs correspondants.</claim-text></claim><claim id="c-fr-01-0006" num="0006"><claim-text>SystÃ¨me selon la revendication 5, dans lequel une fonction de rÃ©ponse estimÃ©e est ajustÃ©e en identifiant une partie directe et une partie reverbÃ©rÃ©e de la fonction de rÃ©ponse, et en modifiant l'amplitude et la position de la partie directe par rapport Ã  la partie reverbÃ©rÃ©e.</claim-text></claim><claim id="c-fr-01-0007" num="0007"><claim-text>SystÃ¨me selon la revendication 1, dans lequel le virtualiseur est en outre configurÃ© pour appliquer une fonction de transfert inverse pour compenser un effet des Ã©couteurs sur un signal produit en sortie par ceux-ci.</claim-text></claim><claim id="c-fr-01-0008" num="0008"><claim-text>SystÃ¨me selon la revendication 1, dans lequel le virtualiseur est en outre configurÃ© pour appliquer une fonction de transfert inverse et une fonction de transfert de rÃ©fÃ©rence idÃ©ale au signal d'entrÃ©e de haut-parleur, la fonction de transfert inverse Ã©tant conÃ§ue pour compenser un effet des haut-parleurs sur un signal produit en sortie par ceux-ci, et la fonction de transfert de rÃ©fÃ©rence idÃ©ale Ã©tant conÃ§ue pour produire comme effet un ensemble de haut-parleurs ayant une fidÃ©litÃ© amÃ©liorÃ©e.</claim-text></claim><claim id="c-fr-01-0009" num="0009"><claim-text>ProcÃ©dÃ© de virtualisation d'un ensemble de haut-parleurs dans une paire d'Ã©couteurs pour un utilisateur, la paire d'Ã©couteurs comportant un Ã©couteur gauche et un Ã©couteur droit, le procÃ©dÃ© comprenant :
<claim-text>la rÃ©ception d'un signal audio pour l'ensemble de haut-parleurs ;</claim-text>
<claim-text>le suivi d'une orientation des Ã©couteurs ;</claim-text>
<claim-text>la sÃ©lection de deux ensembles ou plus de fonctions de rÃ©ponse personnalisÃ©es prÃ©dÃ©terminÃ©es sur la base de l'orientation des Ã©couteurs suivie, chaque fonction de rÃ©ponse personnalisÃ©e prÃ©dÃ©terminÃ©e reprÃ©sentant une transformation Ã  partir d'un haut-parleur particulier vers l'Ã©couteur gauche ou l'Ã©couteur droit pour une orientation particuliÃ¨re des Ã©couteurs ;</claim-text>
<claim-text>l'estimation d'un ensemble de fonctions de rÃ©ponse pour l'orientation suivie des Ã©couteurs par interpolation des deux ensembles ou plus de fonctions de rÃ©ponse personnalisÃ©es prÃ©dÃ©terminÃ©es, les fonctions de rÃ©ponse personnalisÃ©es prÃ©dÃ©terminÃ©es Ã©tant des fonctions d'impulsion, et deux fonctions d'impulsion ou plus Ã©tant interpolÃ©es par : mesure d'un temps de retard pour chaque fonction d'impulsion, suppression des temps de retard de chaque fonction d'impulsion, dÃ©termination de la moyenne des fonctions d'impulsion rÃ©sultantes par pondÃ©ration selon l'orientation suivie des Ã©couteurs et les orientations des Ã©couteurs qui sont associÃ©es aux fonctions d'impulsion, et rÃ©incorporation du retard supprimÃ© dans la fonction d'impulsion moyennÃ©e ;</claim-text>
<claim-text>la transformation du signal audio reÃ§u au moyen de l'ensemble de fonctions de rÃ©ponse estimÃ©es et la fourniture d'un signal audio virtualisÃ© rÃ©sultant aux Ã©couteurs.</claim-text></claim-text></claim><claim id="c-fr-01-0010" num="0010"><claim-text>ProcÃ©dÃ© selon la revendication 9, comprenant en outre :<!-- EPO <DP n="89"> -->
<claim-text>le stockage de chaque fonction de rÃ©ponse sous la forme d'un ensemble de coefficients de filtrage.</claim-text></claim-text></claim><claim id="c-fr-01-0011" num="0011"><claim-text>ProcÃ©dÃ© selon la revendication 9, dans lequel le signal audio reÃ§u comprend une pluralitÃ© de canaux de haut-parleurs, et la transformation du signal audio reÃ§u comprend la transformation de chaque canal de haut-parleur du signal audio reÃ§u au moyen de fonctions de rÃ©ponse estimÃ©es associÃ©es Ã  l'Ã©couteur gauche et Ã  l'Ã©couteur droit.</claim-text></claim><claim id="c-fr-01-0012" num="0012"><claim-text>ProcÃ©dÃ© selon la revendication 11, comprenant en outre la combinaison du signal audio transformÃ©, dans lequel la combinaison comprend l'ajout sÃ©parÃ© des canaux transformÃ©s de l'Ã©couteur gauche et des canaux transformÃ©s de l'Ã©couteur droit pour obtenir un signal audio transformÃ© Ã  double canal appropriÃ© pour les haut-parleurs.</claim-text></claim><claim id="c-fr-01-0013" num="0013"><claim-text>ProcÃ©dÃ© selon la revendication 9, comprenant en outre :
<claim-text>l'ajustement d'une ou plusieurs des fonctions de rÃ©ponse estimÃ©es pour modifier la distance perÃ§ue des haut-parleurs correspondants.</claim-text></claim-text></claim><claim id="c-fr-01-0014" num="0014"><claim-text>ProcÃ©dÃ© selon la revendication 13, dans lequel l'ajustement comprend :
<claim-text>l'identification d'une partie directe et d'une partie reverbÃ©rÃ©e de la fonction de rÃ©ponse estimÃ©e ; et</claim-text>
<claim-text>la modification de l'amplitude et de la position de la partie directe par rapport Ã  la partie reverbÃ©rÃ©e.</claim-text></claim-text></claim><claim id="c-fr-01-0015" num="0015"><claim-text>ProcÃ©dÃ© selon la revendication 9, comprenant en outre :
<claim-text>l'application d'une fonction de transfert inverse pour compenser un effet des Ã©couteurs sur un signal produit en sortie par ceux-ci.</claim-text></claim-text></claim><claim id="c-fr-01-0016" num="0016"><claim-text>ProcÃ©dÃ© selon la revendication 9, comprenant en outre :
<claim-text>l'application d'une fonction de transfert inverse au signal audio reÃ§u, la fonction de transfert inverse Ã©tant conÃ§ue pour compenser un effet des haut-parleurs sur un signal produit en sortie par ceux-ci ; et</claim-text>
<claim-text>l'application d'une fonction de transfert de rÃ©fÃ©rence idÃ©ale au signal audio reÃ§u, la fonction de transfert de rÃ©fÃ©rence idÃ©ale Ã©tant conÃ§ue pour produire comme effet un ensemble de haut-parleurs ayant une fidÃ©litÃ© amÃ©liorÃ©e.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16672642" load-source="patent-office"><!-- EPO <DP n="90"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="156" he="204" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="91"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="92"> --><figure id="f0003" num="3,4,5"><img id="if0003" file="imgf0003.tif" wi="165" he="208" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="93"> --><figure id="f0004" num="6"><img id="if0004" file="imgf0004.tif" wi="165" he="134" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="94"> --><figure id="f0005" num="7,8"><img id="if0005" file="imgf0005.tif" wi="157" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="95"> --><figure id="f0006" num="9,10,11"><img id="if0006" file="imgf0006.tif" wi="155" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="96"> --><figure id="f0007" num="12"><img id="if0007" file="imgf0007.tif" wi="156" he="163" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="97"> --><figure id="f0008" num="13,14a,14b"><img id="if0008" file="imgf0008.tif" wi="162" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="98"> --><figure id="f0009" num="15"><img id="if0009" file="imgf0009.tif" wi="165" he="191" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="99"> --><figure id="f0010" num="16"><img id="if0010" file="imgf0010.tif" wi="165" he="136" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="100"> --><figure id="f0011" num="17"><img id="if0011" file="imgf0011.tif" wi="135" he="150" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="101"> --><figure id="f0012" num="18"><img id="if0012" file="imgf0012.tif" wi="106" he="188" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="102"> --><figure id="f0013" num="19"><img id="if0013" file="imgf0013.tif" wi="161" he="166" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="103"> --><figure id="f0014" num="20,21"><img id="if0014" file="imgf0014.tif" wi="165" he="212" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="104"> --><figure id="f0015" num="22"><img id="if0015" file="imgf0015.tif" wi="143" he="202" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="105"> --><figure id="f0016" num="23"><img id="if0016" file="imgf0016.tif" wi="165" he="189" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="106"> --><figure id="f0017" num="24,25"><img id="if0017" file="imgf0017.tif" wi="164" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="107"> --><figure id="f0018" num="26"><img id="if0018" file="imgf0018.tif" wi="165" he="217" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="108"> --><figure id="f0019" num="27"><img id="if0019" file="imgf0019.tif" wi="165" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="109"> --><figure id="f0020" num="28"><img id="if0020" file="imgf0020.tif" wi="165" he="210" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="110"> --><figure id="f0021" num="29,30"><img id="if0021" file="imgf0021.tif" wi="165" he="187" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="111"> --><figure id="f0022" num="31"><img id="if0022" file="imgf0022.tif" wi="165" he="170" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="112"> --><figure id="f0023" num="32a,32b"><img id="if0023" file="imgf0023.tif" wi="165" he="194" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="113"> --><figure id="f0024" num="33a,33b"><img id="if0024" file="imgf0024.tif" wi="165" he="206" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="114"> --><figure id="f0025" num="34a,34b"><img id="if0025" file="imgf0025.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="115"> --><figure id="f0026" num="35"><img id="if0026" file="imgf0026.tif" wi="165" he="207" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="116"> --><figure id="f0027" num="36"><img id="if0027" file="imgf0027.tif" wi="165" he="221" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="117"> --><figure id="f0028" num="37"><img id="if0028" file="imgf0028.tif" wi="165" he="229" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="118"> --><figure id="f0029" num="38"><img id="if0029" file="imgf0029.tif" wi="165" he="199" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="119"> --><figure id="f0030" num="39"><img id="if0030" file="imgf0030.tif" wi="165" he="178" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="120"> --><figure id="f0031" num="40"><img id="if0031" file="imgf0031.tif" wi="165" he="209" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="121"> --><figure id="f0032" num="41"><img id="if0032" file="imgf0032.tif" wi="158" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="122"> --><figure id="f0033" num="42"><img id="if0033" file="imgf0033.tif" wi="145" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="123"> --><figure id="f0034" num="43"><img id="if0034" file="imgf0034.tif" wi="165" he="206" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="124"> --><figure id="f0035" num="44"><img id="if0035" file="imgf0035.tif" wi="158" he="224" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="125"> --><figure id="f0036" num="45"><img id="if0036" file="imgf0036.tif" wi="165" he="214" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="126"> --><figure id="f0037" num="46"><img id="if0037" file="imgf0037.tif" wi="165" he="210" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="127"> --><figure id="f0038" num="47"><img id="if0038" file="imgf0038.tif" wi="165" he="210" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="128"> --><figure id="f0039" num="48"><img id="if0039" file="imgf0039.tif" wi="163" he="230" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="129"> --><figure id="f0040" num="49"><img id="if0040" file="imgf0040.tif" wi="163" he="198" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="130"> --><figure id="f0041" num="50"><img id="if0041" file="imgf0041.tif" wi="137" he="172" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
