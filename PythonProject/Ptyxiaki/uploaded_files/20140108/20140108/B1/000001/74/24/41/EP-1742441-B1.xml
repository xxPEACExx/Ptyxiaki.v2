<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-1742441-B1" country="EP" doc-number="1742441" kind="B1" date="20140108" family-id="36111471" file-reference-id="270053" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146589050" ucid="EP-1742441-B1"><document-id><country>EP</country><doc-number>1742441</doc-number><kind>B1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-06116080-A" is-representative="YES"><document-id mxw-id="PAPP154851242" load-source="docdb" format="epo"><country>EP</country><doc-number>06116080</doc-number><kind>A</kind><date>20060626</date><lang>EN</lang></document-id><document-id mxw-id="PAPP220012626" load-source="docdb" format="original"><country>EP</country><doc-number>06116080.0</doc-number><date>20060626</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140549034" ucid="FR-0552081-A" load-source="docdb"><document-id format="epo"><country>FR</country><doc-number>0552081</doc-number><kind>A</kind><date>20050707</date></document-id></priority-claim></priority-claims><dates-of-public-availability><intention-to-grant-date><date>20130731</date></intention-to-grant-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2083236051" load-source="docdb">H04H  60/31        20080101ALI20150217RHIB        </classification-ipcr><classification-ipcr mxw-id="PCL1989327458" load-source="docdb">G06F  21/10        20130101ALI20130306BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989327459" load-source="docdb">H04N  21/266       20110101AFI20130306BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989327460" load-source="docdb">H04N  21/433       20110101ALI20130306BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989327461" load-source="docdb">H04N  21/4402      20110101ALI20130306BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989327462" load-source="docdb">H04N  21/442       20110101ALI20130306BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989327463" load-source="docdb">H04N  21/4627      20110101ALI20130306BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989327464" load-source="docdb">H04N  21/8355      20110101ALI20130306BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989625143" load-source="docdb">H04N   5/00        20110101A I20110101RMEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1989620156" load-source="docdb" scheme="CPC">H04N  21/44213     20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989622162" load-source="docdb" scheme="CPC">H04L  63/10        20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989622430" load-source="docdb" scheme="CPC">H04N  21/440281    20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989622928" load-source="docdb" scheme="CPC">H04N  21/4333      20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989623366" load-source="docdb" scheme="CPC">H04L2463/101       20130101 LA20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989625736" load-source="docdb" scheme="CPC">H04N  21/4627      20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989639825" load-source="docdb" scheme="CPC">H04N  21/8355      20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989641658" load-source="docdb" scheme="CPC">G06F  21/10        20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989647324" load-source="docdb" scheme="CPC">H04N  21/26606     20130101 FI20130101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132371783" lang="DE" load-source="patent-office">Kontrolle der digitalen Rechte vom Typ "N Abspielungen" für die digitalen Audio-/Videoinhalte</invention-title><invention-title mxw-id="PT132371784" lang="EN" load-source="patent-office">Controlling digital rights of the "play N times" type for a digital audio and/or video content</invention-title><invention-title mxw-id="PT132371785" lang="FR" load-source="patent-office">Contrôle de droits de consommation du type "N consommations autorises" d'un contenu numérique audio et/ou vidéo</invention-title><citations><patent-citations><patcit mxw-id="PCIT370311888" load-source="docdb" ucid="EP-1528795-A1"><document-id format="epo"><country>EP</country><doc-number>1528795</doc-number><kind>A1</kind><date>20050504</date></document-id><sources><source name="EXA" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT370321202" load-source="docdb" ucid="JP-2002207936-A"><document-id format="epo"><country>JP</country><doc-number>2002207936</doc-number><kind>A</kind><date>20020726</date></document-id><sources><source name="EXA" created-by-npl="N"/></sources></patcit></patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR919510182" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>THOMSON LICENSING</last-name><address><country>FR</country></address></addressbook></applicant><applicant mxw-id="PPAR919528205" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>THOMSON LICENSING</last-name></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919534398" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>TANG-TALPIN YAN-MEI</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919533520" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>TANG-TALPIN, YAN-MEI</last-name></addressbook></inventor><inventor mxw-id="PPAR919026089" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>TANG-TALPIN, YAN-MEI</last-name><address><street>53 rue du Champ Sevigne</street><city>35760, St-Gregoire</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919536972" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>DURAND ALAIN</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919504756" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>DURAND, ALAIN</last-name></addressbook></inventor><inventor mxw-id="PPAR919026087" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>DURAND, ALAIN</last-name><address><street>79, rue de Dinan</street><city>35000, Rennes</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919545329" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>BATTINI FABIEN</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919535561" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>BATTINI, FABIEN</last-name></addressbook></inventor><inventor mxw-id="PPAR919026090" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>BATTINI, FABIEN</last-name><address><street>24, Rue J. Brel</street><city>35235, Thorigne-Fouillard</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919505472" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>DIASCORN JEAN-LOUIS</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919524943" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>DIASCORN, JEAN-LOUIS</last-name></addressbook></inventor><inventor mxw-id="PPAR919026088" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>DIASCORN, JEAN-LOUIS</last-name><address><street>5 rue des Chataigniers</street><city>35830, BETTON</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919537272" load-source="docdb" sequence="5" format="epo"><addressbook><last-name>DIEHL ERIC</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919507132" load-source="docdb" sequence="5" format="intermediate"><addressbook><last-name>DIEHL, ERIC</last-name></addressbook></inventor><inventor mxw-id="PPAR919026086" load-source="patent-office" sequence="5" format="original"><addressbook><last-name>DIEHL, ERIC</last-name><address><street>La Buzardiere</street><city>35340, Liffre</city><country>FR</country></address></addressbook></inventor></inventors><assignees><assignee mxw-id="PPAR919026091" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Thomson Licensing</last-name><iid>101157220</iid><address><street>1-5, rue Jeanne d'Arc</street><city>92130 Issy-Les-Moulineaux</city><country>FR</country></address></addressbook></assignee></assignees></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549883854" load-source="docdb">DE</country><country mxw-id="DS549899142" load-source="docdb">FR</country><country mxw-id="DS549875205" load-source="docdb">GB</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><description mxw-id="PDES63961465" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">The present invention relates to a method for controlling the usage of digital rights, of the "Play N times" type, of a digital audio and/or video content and a device for implementing this method. In particular, it relates to control of the rendering, authorized for a fixed number of times, of audio content (for example music) and/or video content (for example films) on television receivers, computers, audio reproduction equipment, disc readers, portable personal systems, mobile telephones or electronic diaries.</p><p id="p0002" num="0002">In order to control the usage of their products distributed by digital networks, such as the Internet, and to avoid pirating, producers of multimedia content (by way of non-limiting examples: films, documentaries, music, music videos, video games, audiovisual material, services or other content, etc.) implement digital rights management, henceforth referred to as DRM, methods associated with the content relinquished to their customers.</p><p id="p0003" num="0003">The rights associated with a content may, for example, allow usage of the content over a certain cumulative period of time (rights of the "Play N units of time" type) and/or a certain number of times (rights of the "Play N times" type). The monitoring of the rights relinquished to the customer must therefore be carried out progressively as the content is consumed by the customers.</p><p id="p0004" num="0004">The inventors have observed the possible behaviours of the consumer when consuming digital content in order to meet their technical expectations.</p><p id="p0005" num="0005">The invention, in fact, results from the observation that it is not currently possible to count N usages within a device for consuming content, referred to as consuming device or management device, in the framework of digital rights of the "Play N times" type, while at the same time taking into<!-- EPO <DP n="2"> --> account:
<ul><li>the real normal expectations and behaviours of the customers when consuming content (in particular, "zapping", rewind, forward play and pause) and</li><li>the requirement to ring-fence the N usages, in such a manner that the content may be consumed N times and only N times.</li></ul></p><p id="p0006" num="0006">For example, when a content for which the customer has N permitted usages is consumed, the customer might wish, for a period of several seconds, to consume another product, an operation referred to as "zapping", to return to a slightly earlier point in the passage of the content, notably because something was missed, an operation referred to as rewind, or else perform a fast-forward operation.</p><p id="p0007" num="0007">In similar cases of zapping, of rewind, of forward play or of pause, the current accounting methods for the number of usages made by the customer count one additional usage to that in progress.</p><p id="p0008" num="0008">This is costly for the consumer and cannot be justified in every case.</p><p id="p0009" num="0009">The Japan patent application JP <patcit id="pcit0001" dnum="JP2002007936A"><text>2002 07936</text></patcit> discloses a data-on-demand distribution system charging a customer as a function of the number of data packets from a content he has received on his consuming device. The document does not address the issue of charges in case of either a rewind of the content or a zapping of contents.</p><p id="p0010" num="0010">The present invention therefore aims to solve the problem which consists in allowing the consuming device to keep account of the N permitted usages of a content, whose associated digital rights are of the "Play N times" type, while at the same time allowing, in accord with the expectations of the customers, a configurable capability for zapping and/or rewind and/or forward play and/or pause.</p><p id="p0011" num="0011">This usage can take place within the consuming device itself if it incorporates suitable means to do this and if it is desired by the consumer, but also within other consuming devices whose rights it manages.</p><p id="p0012" num="0012">The present invention is defined by the subject matter of the independent claims. Preferred embodiments are defined by the dependent claims.<!-- EPO <DP n="3"> --><!-- EPO <DP n="4"> --></p><p id="p0013" num="0013">Other features and advantages of the invention will become apparent from the description presented hereinafter by way of non-limiting example and which makes reference to the appended figures, in which:
<ul><li><figref idrefs="f0001">Figure 1</figref> shows schematically one embodiment of the invention,</li><li><figref idrefs="f0002">Figure 2</figref> shows schematically certain steps of one embodiment of the invention,</li><li><figref idrefs="f0003">Figure 3a</figref> shows a possible structure of a data stream of a content,</li><li><figref idrefs="f0003">Figure 3b</figref> shows schematically a data stream structure of a controlled content,</li><li><figref idrefs="f0004">Figure 4</figref> shows schematically creation and update steps of a database required for one embodiment of the invention,</li><li><figref idrefs="f0004">Figure 5</figref> shows schematically steps for controlling the access to the content in one embodiment of the invention,</li><li><figref idrefs="f0005">Figure 6</figref> shows schematically a data stream of a controlled content in one embodiment of the invention,</li><li><figref idrefs="f0006">Figure 7</figref> describes schematically one part of the architecture of a consuming device implementing one embodiment of the invention,</li><li><figref idrefs="f0007">Figure 8</figref> describes schematically the processing of a controlled content in one embodiment of the invention.</li></ul></p><p id="p0014" num="0014">The invention that relates to a method for digital rights management of the "Play N times" type is capable of multiple embodiments that will depend, notably, on the choice of consuming device and on the application of this device.<!-- EPO <DP n="5"> --></p><p id="p0015" num="0015">In other words, content may be consumed, or not:
<ul><li>on the consuming device itself depending on the technical means available to it,</li><li>or on other devices delegating, at least in part, the "Play N times" digital rights control functions to the consuming device (which may also not itself possess consuming means).</li></ul></p><p id="p0016" num="0016">An exemplary embodiment is described in the following: the consuming device is portable and, more precisely, is a personal multimedia player. This personal player is comprised within an assembly of devices, belonging to the same customer, associated with the usage of digital content. This assembly of devices is referred to as the "client domain".</p><p id="p0017" num="0017">Such a client domain 100 is shown schematically in <figref idrefs="f0001">Figure 1</figref>: providers 102(i), 1 &lt;=i&lt;=n, of video and/or audio content, supply a digital content 103, referred to as the provider content 103, and rights, referred to as provider rights, associated with the provider content 103 and comprised in a licence 101, referred to as provider licence 101.</p><p id="p0018" num="0018">When an order comes from a customer owner of the client domain 100 for a content 103 associated with the provider rights, the provision takes place via provider networks 104(i), 1 &lt;=i&lt;=n, connected to an access device 106 (for example a computer linked to the Internet) of the client domain 100.</p><p id="p0019" num="0019">In order to provide this content, a DRM process is implemented in a DRM module 114(i) of the access device 106 between each provider 102(i) and the access device 106, which DRM process manages notably the access to the content from the providers and to their associated rights (the rights being incorporated into a provider licence 101) and the payments related to a remote point of sale.</p><p id="p0020" num="0020">In this embodiment, the digital content follows an audio/video standard allowing the conditional access for the provision of audio/video content: the DVB-MPEG2 (for "Digital Video Broadcasting Motion picture Expert Group") standard.<!-- EPO <DP n="6"> --></p><p id="p0021" num="0021"><figref idrefs="f0003">Figure 3a</figref> shows schematically an exemplary structure of a content 200 in such a standard.</p><p id="p0022" num="0022">The audio and video content 200 is here formed by a series of periods, called cryptoperiods CP 202(i) or key lengths 202(i).</p><p id="p0023" num="0023">These cryptoperiods have a duration defined by the provider 102(i). This duration is generally 10 seconds. Each cryptoperiod CP 202(i) contains packets 206 of audio/video data, called A/V packets 206, which are scrambled with a control word CW(i).</p><p id="p0024" num="0024">Each control word CW(i) of a cryptoperiod 202(i) is placed within a packet 204(i) of control data or control message, called DECM(i) (the acronym for "DRM Entitlement Control Message") packet 204(i), of this same cryptoperiod 202(i). This DECM(i) packet 204(i) can also contain other data, notably a content identifier, denoted CID, that is constant throughout the various cryptoperiods for the same content.</p><p id="p0025" num="0025">In this embodiment of this invention, the data contained in the DECM(i) packet 204(i) are encrypted by means of a symmetric key K<sub>drm</sub> specific to the DRM process managed by the access device 106. This encryption function is denoted EK<sub>drm</sub> (in variants of this invention, this DECM(i) encryption does not exist, or if it exists, it may be asymmetric). Then: <maths id="math0001" num=""><math display="block"><mi>DECM</mi><mfenced><mi mathvariant="normal">i</mi></mfenced><mo>=</mo><mi>packet</mi><mi mathvariant="normal"> </mi><mn>204</mn><mfenced><mi mathvariant="normal">i</mi></mfenced><mo>=</mo><mfenced open="{" close="}" separators=""><msub><mi mathvariant="normal">E</mi><mi>kdrm</mi></msub><mfenced separators=""><mi>CID</mi><mo>,</mo><mi>CW</mi><mfenced><mi mathvariant="normal">i</mi></mfenced><mo>,</mo><mo>…</mo></mfenced></mfenced></math><img id="ib0001" file="imgb0001.tif" wi="99" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0026" num="0026">In <figref idrefs="f0003">Figure 3a</figref>, the content 200 is shown with only one DECM(i) packet per cryptoperiod 202(i) for reasons of simplification but, in practice, it may contain several DECM packets per cryptoperiod.</p><p id="p0027" num="0027">Once the provider content 103 and the provider licence 101 (<figref idrefs="f0001">Figure 1</figref>) have been transferred to the access device 106 of the client domain 100, the resulting content 124 and the resulting licence 126 must be transferred to the personal player 112.</p><p id="p0028" num="0028">In order to consume the content on a personal player 112, two types of secure content and rights transfer process can be implemented:
<ul><li>a transfer process called master / secondary process, and/or</li><li>a transfer process called access / isolated process.</li></ul><!-- EPO <DP n="7"> --></p><p id="p0029" num="0029">During a transfer towards the personal player 112 implementing a master / secondary process, when it connects to the access device 106 for acquiring a content, the personal player 112 receives the content and the rights that the customer wishes to use in the personal player 112, these rights being included within a licence, called secondary licence, associated with the content.</p><p id="p0030" num="0030">For this purpose, the personal player 112 implements a DRM process, called secondary or portable DRM process, unique to the personal player 112 and different from the master DRM processes which are implemented in the DRM modules 114(i) associated with each provider 102(i). The object of this secondary DRM process is to control access to the content in the personal player 112 and it has its own licence format. When the customer causes a content to transfer from his access device 106 towards the personal player 112, the master DRM process generates a secondary licence having a format compatible with the secondary DRM process.</p><p id="p0031" num="0031">Each master DRM process also manages the interfacing with the secondary DRM process.</p><p id="p0032" num="0032">The content present in the personal player 112 is then exclusively associated with the personal player 112. The loading of the content into the personal player 112 is a secure operation. The secondary licence is also secure.</p><p id="p0033" num="0033">The personal player 112 comprises:
<ul><li>means 136 for storing content and means 130 for implementing a secondary DRM process, called secondary or portable DRM module 130,</li><li>secure storage and processing means whose purpose is to store secret data, notably keys, and to perform cryptographical operations. In this embodiment, these means comprise a smart card. The DRM module 130 is preferably included in these secure storage and processing means.</li></ul></p><p id="p0034" num="0034">The master DRM process of the access device 106 therefore creates a secondary licence where secondary rights (which are deducted from the primary rights and hence form a sub-set of them) are included, which rights<!-- EPO <DP n="8"> --> are required for the usage of the content in the personal player 112. This secondary licence is transferred with the content into the personal player 112.</p><p id="p0035" num="0035">Subsequently, the master DRM process updates the master licence as a function of the rights transmitted to the personal player 112.</p><p id="p0036" num="0036">Then the content, together with the secondary licence, is transmitted in a secure manner from the access device 106 to the personal player 112.</p><p id="p0037" num="0037">Lastly, the customer consumes the content in the personal player 112. The secondary DRM process controls the access to the content present in the portable device and updates the secondary rights, according to the usage of the customer and the secondary licence or licences present in the personal player 112.</p><p id="p0038" num="0038">Another secure process for the transfer of content towards the personal player 112 called access/isolated process can be used, notably where it is not desired to limit the usage within the portable personal player 112 in order that this usage may take place either within the personal player 112 or within a device part of the client domain 100 managed by the personal player 112. The personal player 112 does not, in fact, necessarily contain consuming means (for example a display screen), it may solely contain means for storing content.</p><p id="p0039" num="0039">Rights protection processes have been developed to protect certain provider rights within certain parts of the domain 100, and to verify that the usage of a content takes place legitimately within these parts, in particular within the access device 106 and the part 107 of the domain 100 containing consuming devices 108, 110 which are connected to the access device 106 via continuous communications links (cable, Ethernet, wireless, etc.).</p><p id="p0040" num="0040">Examples of such processes for the protection of rights associated with content are notably described:
<ul><li>in the document <patcit id="pcit0002" dnum="WO0062505A1"><text>WO 00/62505 A1</text></patcit> entitled "Digital Home Network and method for creating and updating such a network"<!-- EPO <DP n="9"> --></li><li>or in the document <patcit id="pcit0003" dnum="EP1253762A1"><text>EP 1 253 762 A1</text></patcit> entitled "Process for managing a symmetric key in a communications network and devices for the implementation of this process" which defines a management process where the content is coded and decoded by means of a symmetric key notably known by the consuming devices 108, 110 of the network part 107.</li></ul></p><p id="p0041" num="0041">In an access/isolated transfer process (<figref idrefs="f0001">Figure 1</figref>), the content 103 and the licence 101 are transformed into a personalized content 124, and into a personalized licence 126, following a process described in the patents cited above.</p><p id="p0042" num="0042">A content 124 composed of coded video and audio packets is then obtained, where packets are incorporated in a regular manner that contain the information required for the usage of the content 124 within the consuming devices 108, 110 of the network part 107.</p><p id="p0043" num="0043">When the user wishes to consume a content on his personal player 112 or on isolated consuming devices 118, 122 of his domain, an adaptation of the personalized content 124 and of the personalized licence 126 is effected when this content is transferred from the access device 106 towards the personal player 112 where it is then stored in the form of an isolated content 132 and isolated licence 134.</p><p id="p0044" num="0044">For this purpose, the portable DRM module 130 of the personal player 112 is used.</p><p id="p0045" num="0045">It will be noted that the module 130 is generic, in other words that it does not depend on the provider of the content 102(i), and is secure, meaning that it is resistant to fraud, and stores encryption and usage clearance data.</p><p id="p0046" num="0046">At the end of the secure content transfer process, the storage means 136 of the personal player 112 contain:
<ul><li>an isolated content 132, adapted for its controlled distribution from the isolated device 112, obtained from the digital content 124,</li><li>and a licence 134, called isolated licence, obtained from the personalized licence 126 and containing the rights that the customer wishes to<!-- EPO <DP n="10"> --> use from the isolated device 112 within the domain 100, notably in the isolated part 111, and the data required to permit this use.</li></ul></p><p id="p0047" num="0047">An update of the rights remaining in the access device 106 is also performed by deducting the rights transmitted to the isolated device 112.</p><p id="p0048" num="0048">An exemplary embodiment of the invention is thus defined (notably, the consuming device is a personal player, which is comprised within a client domain and which consumes content in MPEG2 format, and the content is transferred to it by using one or other of the two transfer processes described hereinabove).</p><p id="p0049" num="0049">Two main embodiments (with variants) of the invention, varying as a function of the marker elements used, are described in the following: an embodiment implementing a series of markers or indices and an embodiment implementing tokens.</p><p id="p0050" num="0050">In the embodiment implementing a series of markers, the control process of the invention uses the master / secondary transfer process and, as a variant, the access / isolated process, as described hereinafter with reference, notably, to <figref idrefs="f0002">Figure 2</figref>.</p><p id="p0051" num="0051">The portable DRM module 130 of the personal player 112 transforms a content 103 received by the access device 106 into a content 132 according to the following steps:
<ul><li>1<sup>st</sup> step 150: the content 103, containing DECM packets 140 and the associated licence containing a packet 144 of data, denoted DEMM packet, is loaded into the storage means 136 of the personal system 112,</li><li>2<sup>nd</sup> step 152: the DEMM packet 144 is sent to the DRM module 130 in order that this module 130 knows the associated rights,</li><li>3<sup>rd</sup> step 154: the DECM packets 140 are transformed into packets 142 of control data PECM and a table 146 of control data, denoted PCD table, is created and stored in the personal system 112; the PCD table 146 is notably used for metering the number of usages consumed,</li><li>4<sup>th</sup> step 156: the content 103 is transformed into content 132, notably by incorporating the PECM packets 142 into it.</li></ul><!-- EPO <DP n="11"> --></p><p id="p0052" num="0052">The PECM packets 142 and the PCD control table 146 contain all the information for controlling the usage of the content 132.</p><p id="p0053" num="0053">Next, certain steps required specifically for the control of rights of the "Play N times" type, namely:
<ol><li>1) the transformation of the content (from a content 103 to a content 132),</li><li>2) the creation of the PCD control tables 146, and</li><li>3) the control of the rights of the Play N times type<br/>
are detailed within the framework of this embodiment of the invention.</li></ol></p><p id="p0054" num="0054">The transformation of a content 103 into a content 132 occurs in the following manner:</p><p id="p0055" num="0055">When the personal player 112 receives a licence 101, if the content 103 associated with this licence is already stored in the storage means 136 but not yet transformed, then the personal system 112 requests from the DRM module 130 the transformation of the DECM packets 140 into PECM packets 142 by following the master / secondary process and, as a variant, the access /isolated process.</p><p id="p0056" num="0056">The PECM packets 142 contain, in addition to a content identifier, called CID identifier, and to a control word, denoted CW(i), used to descramble the data of the cryptoperiod (i), a series of numbers (k = 0, 1, 2, ...L-1), called marker or index series, indexing the PECM packets 142 within the content 132.</p><p id="p0057" num="0057">These markers are used for detecting modes of usage of the content, notably rewind, forward play, pause and "zapping".</p><p id="p0058" num="0058">In this embodiment of the invention, the PECM packets 142 are encrypted using a symmetric key K<sub>c</sub>. There are several possibilities for managing the key K<sub>c</sub>:
<ul><li>First Option: K<sub>c</sub> depends on the given portable device 112. In this case, all the content comprised in this portable device 112 is protected by the same key K<sub>c</sub>.</li><li>Second option: K<sub>c</sub> depends on a content. In this case, each<!-- EPO <DP n="12"> --> content comprised in a portable device 112 uses a different key K<sub>c</sub>.</li></ul></p><p id="p0059" num="0059">In the case of the master / secondary process, the key K<sub>c</sub> is encrypted by a key K<sub>drm</sub> which is the key of the master DRM and which is transported within the DEMM packet 144.</p><p id="p0060" num="0060">The result of the encryption of K<sub>c</sub> by K<sub>drm</sub> is inserted into the PECM packet 142.</p><p id="p0061" num="0061">A PECM packet 142 can therefore be represented, in this embodiment, by: <maths id="math0002" num=""><math display="block"><mrow><msub><mi mathvariant="normal">E</mi><mrow><mi mathvariant="normal">k</mi><mo>⁢</mo><mi mathvariant="normal">c</mi></mrow></msub><mfenced separators=""><mrow><mi>CID</mi><mo>|</mo></mrow><mrow><mi>CW</mi><mo>|</mo></mrow><mi mathvariant="normal">k</mi></mfenced><mo>|</mo></mrow><msub><mi mathvariant="normal">E</mi><mi>kdrm</mi></msub><mfenced separators=""><mi mathvariant="normal">K</mi><mo>⁢</mo><mi mathvariant="normal">c</mi></mfenced></math><img id="ib0002" file="imgb0002.tif" wi="54" he="8" img-content="math" img-format="tif"/></maths><br/>
where E<sub>K</sub> represents an encryption function using the key K and where | represents the data concatenation function.</p><p id="p0062" num="0062">As shown in <figref idrefs="f0002">Figure 2</figref>, the DRM module 130 of the personal system 112 creates PECM packets 142 upon receiving the DEMM packet 144 included within the licence 101 and DECM packets 140 included within the content 103.</p><p id="p0063" num="0063">The DEMM packet 144 contains, notably, the CID content identifier, the digital rights of the content (for example, the right to see a given film twice) and the key K<sub>drm</sub> used for protecting the DECM packets 140.</p><p id="p0064" num="0064">The DECM packets 140 have a format E<sub>kdrm</sub>(CID, CW).</p><p id="p0065" num="0065">In order to convert a content, the portable DRM module 130 resets the index k to 0 and extracts the encryption key Kdrm from the DEMM packet 144.</p><p id="p0066" num="0066">If the key K<sub>c</sub> depends on the content, then the DRM portable module 130 randomly generates a key K<sub>c</sub>. Then the DRM portable module 130 DRM carries out the following actions for each DECM data packet 140:
<ul><li>Decryption of the DECM data packet 140 using the key K<sub>drm</sub> and extraction of the control word CW,</li><li>Addition of the index k,</li><li>Creation of the PECM data packet 214, and</li><li>Incrementation of the index.</li></ul><!-- EPO <DP n="13"> --></p><p id="p0067" num="0067"><figref idrefs="f0003">Figure 3b</figref> shows schematically the format of the content 300 obtained after the conversion step. The controlled content 132 in <figref idrefs="f0001">Figures 1</figref> and <figref idrefs="f0002">2</figref>, denoted content 300 in this figure, is composed of cryptoperiods 306(i). Each cryptoperiod 306(i) comprises a PECM packet 302(i) comprising a marker or index k and A/V packets 304 containing coded audio and video information. It will be noted that, even though only one PECM packet 302(i) is shown per cryptoperiod 306(i) in <figref idrefs="f0003">Figure 3b</figref>, in practice, several packets PECM(k) may be included in the same cryptoperiod, each packet PECM(k) containing an index k that is unique to it and which is, in this example, greater than the index k-1 of the preceding PECM packet within the stream of data forming the content 300.</p><p id="p0068" num="0068">The portable DRM module 130 manages the PCD control data table, each entry of which, denoted PCD[CID], corresponds to a content in the portable device.</p><p id="p0069" num="0069">The PCD usage control table contains the following information for each managed content:
<ul><li>A CID content identifier,</li><li>A usage rule ("consume N times"),</li><li>A key K<sub>drm</sub> of the master DRM: this key K<sub>drm</sub> is received within the DEMM data packet 210,</li><li>An updated number of usages still possible, denoted pn. This number is reset to N for usage rights of the "consume N times" type. Each time the content is consumed, pn is decremented,</li><li>An index or marker, denoted K<sub>PCD</sub>, of the latest data packet 302(i) PECM(k) consumed,</li><li>A maximum number, denoted M, of data packets PECM(k) that may be replayed in rewind. The number M may be fixed or transmitted within the DEMM data packet.</li></ul></p><p id="p0070" num="0070">In summary, each entry of the PCD usage control table associated with a content is represented by: <maths id="math0003" num=""><math display="block"><mi>PCD</mi><mfenced open="[" close="]"><mi>CID</mi></mfenced><mo>=</mo><mi>CID</mi><mfenced open="|" close="|"><mi>rule</mi></mfenced><mo>⁢</mo><msub><mi mathvariant="normal">K</mi><mrow><mi mathvariant="normal">d</mi><mo>⁢</mo><mi mathvariant="normal">r</mi><mo>⁢</mo><mi mathvariant="normal">m</mi></mrow></msub><mfenced open="|" close="|" separators=""><mi mathvariant="normal">p</mi><mo>⁢</mo><mi mathvariant="normal">n</mi></mfenced><mrow><msub><mi mathvariant="normal">k</mi><mi>PCD</mi></msub><mo>|</mo></mrow><mi mathvariant="normal">M</mi><mo>.</mo></math><img id="ib0003" file="imgb0003.tif" wi="87" he="9" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="14"> --></p><p id="p0071" num="0071"><figref idrefs="f0004">Figure 4</figref> shows schematically the steps leading to the creation of an entry associated with a content of the PCD table, denoted PCD[CID].</p><p id="p0072" num="0072">When the portable DRM module 130 receives a DEMM packet associated with a content in a step 402, it verifies, in a step 404, whether the entry PCD[CID] already exists for this content with the CID identifier in the PCD table:
<ul><li>if the entry PCD[CID] does not exist in the PCD table, then, in a new step 406, a new entry PCD[CID] is created, in which pn and the index K<sub>PCD</sub> are reset to N and 0, respectively. If the value of M is contained in the data packet DEMM, M is reset to this value. Otherwise, M is fixed at its default value.</li><li>if the entry PCD[CID] already exists in the PCD table, then, in a new step 408, it is updated by increasing the updated number of usages still possible pn by the value of N.</li></ul></p><p id="p0073" num="0073">When the user consumes the content (for example a film) having a CID on his personal player, the portable DRM module of the personal system looks for the entry PCD[CID] in the PCD table. If this entry PCD[CID] is not found (which means that the film licence is not available), usage is refused. Otherwise, the control of the access to the content is effected as shown schematically in <figref idrefs="f0004">Figure 5</figref>.</p><p id="p0074" num="0074">In a first step 502, the DRM module of the personal system receives a data packet PECM(k) with an index k. Then, in step 504, it compares k with the index K<sub>PCD</sub> included in the entry PCD[CID]:</p><p id="p0075" num="0075">If k ≥ k<sub>PCD</sub> (which corresponds to a usage of the content in its normal direction), then k<sub>PCD</sub> is updated with the value k during step 506. The data packet PECM(k) is decrypted in step 508 and the film can be viewed on the personal system.</p><p id="p0076" num="0076">Otherwise (for a rewind operation), the DRM module 130 calculates the value (k<sub>PCD</sub>-k), denoted bpn (for "rewinded number"), in step 510. Then, in step 512, the value of bpn is compared with M. Then, there are two possible cases:
<ul><li>If bpn is smaller than M, then the data packet PECM(k) is<!-- EPO <DP n="15"> --> decrypted and the corresponding content can be consumed. In this case, k<sub>PCD</sub> is not updated,</li><li>If bpn is larger than M, it is then considered that there is a demand for a new usage (which will be possible or not depending on the remaining rights). The personal player and notably the DRM module warn the user.</li></ul></p><p id="p0077" num="0077">In a step 514, it is verified whether pn is zero. If pn is not zero, the personal player asks the user to confirm that they wish to consume the content one more time during step 516. If the user confirms this, the number of usages still possible pn is decremented and K<sub>PCD</sub> is reset to 0 (step 518). The data packet PECM(k) is then decrypted and the content can be consumed (return to step 508). If the user refuses, then the data packet PECM(k) is not decrypted and K<sub>PCD</sub> is not updated (step 520). Then, the user can reposition his content further forward and continue his usage in progress. If pn is equal to 0, the user is informed (step 522) before terminating the usage of the content (step 520); the DRM module of the personal player can then propose to the user to acquire a new licence.</p><p id="p0078" num="0078">As a variant, it will be noted that, instead of using a precise number M of data packets PECM(k) that can be replayed in reverse without counting an additional usage, a certain percentage of the total length of the content may be used.</p><p id="p0079" num="0079">An entry PCD[CID] of the PCD table is erased when the user erases the CID identifier of the content of the personal player.</p><p id="p0080" num="0080">A variant of this process for erasing the entries PCD[CID] is to perform batch erase operations: this can be effected in a periodic fashion (for example each day) or else when it becomes necessary, for example when there is no more memory available.</p><p id="p0081" num="0081">The DRM module of the personal player is the ideal place for storing the PCD table. If its resources are limited, an alternative solution is to store a part (the key K<sub>drm</sub> must not then be in this part) of the PCD table outside of the DRM module of the personal player. However, the integrity of the PCD table must be guaranteed.<!-- EPO <DP n="16"> --></p><p id="p0082" num="0082">For example, a signature of the PCD table must then be stored in the portable DRM module. In this case, before using the PCD table, its integrity must be verified. After having updated the PCD table, the signature must also be updated. The signature can be produced by a simple hash function.</p><p id="p0083" num="0083">The DRM module of the portable device can be formed by using:
<ul><li>a smart card, such as for example a SIM card (acronym for "Subscriber Identity Module"), used for mobile telephones, or</li><li>an onboard secure processor or</li><li>a standard processor using software with anti-fraud protection.</li></ul></p><p id="p0084" num="0084">The key K<sub>c</sub> can vary depending on the content and can be encrypted (with the key K<sub>drm</sub>) by using the AES standard (acronym for Advanced Encryption Standard), as can the part with the packets PECM(k) which is encrypted with the key K<sub>c</sub>.</p><p id="p0085" num="0085">In one exemplary embodiment of the invention, M has a default value of 10800. This corresponds to 30 minutes of rewind for video content having one packet PECM(k) every 10 seconds. This default value is only used when the licence of the consuming device does not contain any value for M.</p><p id="p0086" num="0086">Another possible embodiment of this invention implements tokens or the absence of tokens in certain parts of the digital stream forming the controlled content.</p><p id="p0087" num="0087">The implementation of this embodiment of the invention assumes the existence of a content containing marks, and more precisely tokens, that may be charged.</p><p id="p0088" num="0088">The first general step of this embodiment of the invention is the creation of a content containing these tokens.</p><p id="p0089" num="0089">The marks can be linked to the presence or to the absence of digital data, called tokens.</p><p id="p0090" num="0090">In one embodiment, a token can be a Boolean variable contained in the digital stream of the content, which is equal to 1, for example, if the token is taken as being present, or equal to zero if the token is taken as being absent.<!-- EPO <DP n="17"> --></p><p id="p0091" num="0091">The content, in other words the stream of data carrying the audio /video information that is consumed by the user, is divided into regular divisions, called cryptoperiods CP(i) or key lengths.</p><p id="p0092" num="0092">Each cryptoperiod comprises coded packets of audio and/or video information, called A/V packets, together with control messages mixed with the A/V packets.</p><p id="p0093" num="0093">The control messages contain the control words, denoted CW, allowing the A/V packets of one part of the content to be decoded.</p><p id="p0094" num="0094">For reasons of security, the control messages are in part non-encrypted and in part encrypted. A sub-part of the non-encrypted part of the control messages is however made secure thanks to a signature. This signature is itself included within the control messages.</p><p id="p0095" num="0095">The control messages also contain a content identifier, denoted CID. The value of the CID identifier is the same for all the control messages of the same content and only varies from one content to another.</p><p id="p0096" num="0096">In addition, the content is accompanied by the content licence. The content licence contains the rules for usage of the content. The information contained in this licence is also protected. This licence may be included within the control messages or else be separate from the content.</p><p id="p0097" num="0097">The content licence notably contains the following values:
<ul><li>the number of usages of the content still possible, denoted STP number (for "Still To Play"),</li><li>the number of tokens equivalent to the complete usage of a content, denoted TOV number (for "Tokens for One Viewing")</li><li>the counter for tokens already used during the usage in progress, denoted TAU (for "Tokens Already Used") and</li><li>optionally, the margin accorded to the consumer with respect to the TOV number for one usage to be considered as being used, this margin being denoted TM (for "Token Margin").</li></ul><!-- EPO <DP n="18"> --></p><p id="p0098" num="0098">When the content is transferred into the consuming device, one token is added to each control message in order to form modified control messages.</p><p id="p0099" num="0099">It is possible for tokens not to be added to one portion of the content. This allows only certain parts of the content to be controlled while, at the same time, leaving complete freedom for usage of other parts. This functionality is called "complementary functionality".</p><p id="p0100" num="0100">One variant of this embodiment of the invention, called "implicit token variant", is to consider by default that all the control messages contain a token. In that case, the control messages do not, in fact, contain additional information related to the tokens.</p><p id="p0101" num="0101">In this variant, the control message is only modified in the case where the complementary functionality is used: in this case, the control messages of the uncontrollable part of the content contain additional information indicating that they do not contain tokens.</p><p id="p0102" num="0102">The token is associated with a cryptoperiod CP(i). So, in the modified control message, this token is associated with a control word CW. If there is more than one CW within the modified control message, also denoted ECM packets, then only the control words CW that need a counting functionality have an associated token.</p><p id="p0103" num="0103">If a token must be associated with a cryptoperiod, then all the ECM packets or licences carrying the control word CW for this cryptoperiod must include a token, since it cannot actually be determined which ECM packet or licence will be chosen at the time of decoding (or descrambling) of the content.</p><p id="p0104" num="0104">In the implicit token variant, also called "inverse token variant", by contrast with the real token variant, then all the ECM packets carrying the control word CW for the un-markered cryptoperiod (in other words with no token) must contain the message "not to be tallied".</p><p id="p0105" num="0105"><figref idrefs="f0005">Figure 6</figref> shows schematically a data stream of a content 600 that has, in part, been markered with real tokens (the real tokens being more "graphic" than the implicit tokens).<!-- EPO <DP n="19"> --></p><p id="p0106" num="0106">The stream is divided into cryptoperiods 602(i), each having a period 603, for example of 10s duration, and <figref idrefs="f0005">Figure 6</figref> shows the periods 602(n-2), 602(n-1), 602(n), 602(n+1) and 602(n+2).</p><p id="p0107" num="0107">Each period 602(i) contains several ECM packets 604. The time 608 between two ECM packets is, for example, 100 ms.</p><p id="p0108" num="0108">The control word CW(i) 610(i) allowing one period to be decoded 602(i) is present:
<ul><li>within certain ECM packets 604 before the period 602(i) (during a time 606, called "ECM advance" of the period 602(i-1)), which allows the decoding means to be prepared before the arrival of the period 602(i),</li><li>within all the ECM packets of the period 602(i) and</li><li>within a few packets of the period 602(i+1).</li></ul></p><p id="p0109" num="0109">Thus, each ECM packet 604 contains two control words CW 610: CW(i) 610(i) and (CW(i-1) 610(i-1) or CW(i+1) 610(i+1)).</p><p id="p0110" num="0110">As explained hereinafter, the positioning of the marks throughout the content, an operation referred to as markering, is carried out by associating a token 612 with the control word CW(i) 610(i) if the period 602(i) must be markered and by not associating a marker 612 with the control word CW(i) 610(i) if the period 602(i) must not be markered.</p><p id="p0111" num="0111">In <figref idrefs="f0005">Figure 6</figref>, the period 602(n) is not markered.</p><p id="p0112" num="0112">In this representation, the control messages are ECM packets 604.</p><p id="p0113" num="0113">Another part of this embodiment of the invention is the storage of a content, of the licence for this content and of counting structures associated with the tokens of this content.</p><p id="p0114" num="0114">The content is stored in a coded fashion on the consuming device, with its associated licence.</p><p id="p0115" num="0115">The consuming device comprises secure storage and processing means, called "secure storage means", which can incorporate:
<ul><li>a smart card (such as for example a SIM card used for mobile telephones) or</li><li>an on-board secure processor, or<!-- EPO <DP n="20"> --></li><li>a standard processor using anti-fraud protected software.</li></ul></p><p id="p0116" num="0116">These secure storage means keep the CID identifier in their memory and the licence information for each content available on the consuming device.</p><p id="p0117" num="0117">These storage means also contain a database comprising, for each available content, a set of counting data, denoted RCS (the abbreviation for Read Counting Structure). This RCS structure links the CID content identifier with the STP, TOV, TAU numbers of this content. Optionally, this entry also contains the TM margin associated with this content.</p><p id="p0118" num="0118">An RCS structure is therefore associated with each content: <maths id="math0004" num=""><math display="block"><mi>RCS</mi><mfenced><mi>content j</mi></mfenced><mo>=</mo><mfenced open="{" close="}"><msub><mi>CID</mi><mi mathvariant="normal">j</mi></msub><msub><mrow><mspace width="1em"/><mi>STP</mi></mrow><mi mathvariant="normal">j</mi></msub><msub><mrow><mspace width="1em"/><mi>TOV</mi></mrow><mi mathvariant="normal">j</mi></msub><msub><mrow><mspace width="1em"/><mi>TM</mi></mrow><mi mathvariant="normal">j</mi></msub><msub><mrow><mspace width="1em"/><mi>TAU</mi></mrow><mi mathvariant="normal">j</mi></msub></mfenced><mn>.</mn></math><img id="ib0004" file="imgb0004.tif" wi="84" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0119" num="0119">The secure storage means will contain as many RCS structures as types of content available on the consuming device.</p><p id="p0120" num="0120">The storage capacity of the RCS structures may be limited or not.</p><p id="p0121" num="0121">Since the storage capacity of the secure storage means is generally low, in the case where the RCS structures are stored there, then the database of RCS structures (hereinafter referred to as "RCS database") is generally limited.</p><p id="p0122" num="0122">In this case, several variants are possible if the capacity limit of the secure storage means is reached:
<ul><li>In a first variant, the addition of new content can be disallowed. Then, if the user wishes to add a new content to his consuming device, he must firstly remove content previously saved in his consuming device.</li><li>In a second variant, one or more old lots of content are automatically erased from the memory of the consuming device when the user wishes to add a new content to his consuming device. This automatic erasing occurs on the basis of criteria on the content, which criteria may for example be the longest time elapsed since the last use or the longest storage time in the consuming device.</li></ul><!-- EPO <DP n="21"> --></p><p id="p0123" num="0123">If these RCS structures are stored within the main memory of the personal player (which can be a hard disk), since the size of the RCS database is very small with respect to the capacity of this type of memory, the RCS database is not limited.</p><p id="p0124" num="0124">In the case where the RCS database is stored in the main memory of the personal player, then this database must be encrypted, so as to avoid a user of the personal player being able to modify it. In this case, the encryption key used to perform the encryption is stored in the secure storage means.</p><p id="p0125" num="0125">In order that the content be consumed on the consuming device, it must first be decoded using the decryption keys, also called "control words" CW, included in the control messages.</p><p id="p0126" num="0126">During this decoding operation, if the consuming device justifies its right to consume the content, the consuming device sends the control messages from the content to the secure storage means.</p><p id="p0127" num="0127">These secure storage means then extract the information required for the decryption (notably the decryption keys or control words) in order to make them available to the consuming device.</p><p id="p0128" num="0128">With regard to this invention, the justification of the right of the consuming device to consume the content comprises the step that consists in verifying that the STP number is greater than 0.</p><p id="p0129" num="0129">For this purpose, the secure storage means read the CID identifier in the control messages, then access the RCS structure corresponding to this CID identifier in order to obtain the STP number. If the STP number is greater than zero, the secure storage means permit the usage of the content. In the opposite case, they block the usage of this content.</p><p id="p0130" num="0130">If another usage is permitted, the secure storage means increase the used token counter TAU each time that decryption keys (control words CW) containing markers or tokens are extracted.</p><p id="p0131" num="0131">This token counting is independent of the mode of usage of the content (forward play or rewind, at normal speed, at high speed or slowed down).<!-- EPO <DP n="22"> --></p><p id="p0132" num="0132">Thus, for example, if the user uses rewind abusively, or if he consumes the same sequence of the content too many times, he may end up consuming all his usage credits. Then, his usage of the content is blocked, even if he might not have reached the end of this content.</p><p id="p0133" num="0133">For this reason, in one embodiment, the value of the TOV number of tokens is greater than the number of tokens contained by the content (from 50% to 100% greater).</p><p id="p0134" num="0134">Thus, even though there is still a risk of the user not reaching the end of the content before running out of his rights, in practice this should cover the majority of cases.</p><p id="p0135" num="0135">It may be noted that the token counter TAU is only incremented when a new ECM packet is consumed: which means that if the same cryptoperiod is consumed incessantly without passing to a new cryptoperiod, the TAV counter is incremented only the first time that the cryptoperiod is consumed but is not incremented for successive usages.</p><p id="p0136" num="0136">In addition to monitoring the STP number, the secure storage means continually verify the value of the token counter TAU, notably each time that the secure storage means extract decryption keys.</p><p id="p0137" num="0137">If the token counter TAU becomes greater than the TOV number of tokens equivalent to the complete usage of a content or, in one variant, greater than the sum of the TOV number of tokens and the token margin TM, then:
<ul><li>the number STP of usages still possible is decremented by 1 and</li><li>the token counter TAU is reset to zero</li></ul>
within the RCS counting structure in the database of the RCS.</p><p id="p0138" num="0138">One variant of this process consists in only modifying the counter TAU while the STP and TOV numbers and the TM margin remain constant: each time a decryption key (or control word) is processed in order to be consumed, then the token counter TAU is incremented. The secure storage means continually verify the value of the token counter TAU and if the token counter TAU becomes greater than the product of the STP number and the<!-- EPO <DP n="23"> --> TOV number (or in one variant, greater than the product of the STP number and the sum of the TOV number and the TM margin), then the control device blocks the usage of the content.</p><p id="p0139" num="0139">This embodiment of the invention that relates to a process for controlling digital rights of the "Play N times" type using tokens, is capable of multiple variants which depend, notably, on the choice of a consuming device and on the application of this consuming device.</p><p id="p0140" num="0140">This embodiment of the invention may be implemented by a portable consuming device, for example a personal multimedia system, included in the client domain such as described in <figref idrefs="f0001">Figure 1</figref>.</p><p id="p0141" num="0141">In this embodiment, the personal player comprises a secure smart card.</p><p id="p0142" num="0142">The access device is a desktop computer equipped with one or more DRM software applications, which allow it to implement one or more DRM processes.</p><p id="p0143" num="0143">The content consumed in this personal player are in the MPEG2 standard format.</p><p id="p0144" num="0144">In this embodiment, a customer may consume a digital content 103 (<figref idrefs="f0001">Figure 1</figref>) on his client domain 100 such as previously described.</p><p id="p0145" num="0145">Processes for the protection of rights have been developed in order to protect certain provider rights in certain parts of the domain 100, and to control the legitimate use of a content in those parts as has been described hereinabove in the description.</p><p id="p0146" num="0146">In this embodiment for controlling the usage by means of tokens, the control messages are the DECM packets which are inserted into the audio/video content as illustrated notably in <figref idrefs="f0003">Figure 3a</figref>. When the content is transferred into the personal player, the DECM packets are transformed into packets of control data unique to the controlled content, denoted PECM packets as previously described, either including a token or not (depending on the option chosen ― with tokens or implicit tokens).</p><p id="p0147" num="0147">When the content is transferred into the personal player, the secure<!-- EPO <DP n="24"> --> smart card creates a new entry in its RCS database, storing in this entry the values of the STP number of usages still possible, of the TOV number of tokens permitted for one usage and, optionally, of the TM margin of supplementary tokens, these values being received in the licence accompanying the content.</p><p id="p0148" num="0148">The process for counting the tokens is schematically described in <figref idrefs="f0006">Figure 7</figref>.</p><p id="p0149" num="0149">The stream 704 of data for a content already previously transferred to a personal player (which is therefore a controlled content) is transmitted to a decoder 700 comprised in this personal system.</p><p id="p0150" num="0150">Demultiplexing means 706 extract PECM packets 720 from the stream 704 of data and send the resulting stream 708 to decryption means 710.</p><p id="p0151" num="0151">The smart card 702 decrypts the PECM packet 720 (if permitted) using processing means 722 so as to obtain, notably:
<ul><li>the control word CW 750,</li><li>the content identifier CID 724, and</li><li>the usage conditions 726 (e.g. "view N times").</li></ul></p><p id="p0152" num="0152">The content identifier CID 724 is sent to a secure memory 736 of the smart card where the entries of the RCS database are stored.</p><p id="p0153" num="0153">Thus, the following are extracted from the secure memory 736:
<ul><li>the number 738 of tokens consumed TAU associated with the content whose identifier is the identifier 724,</li><li>the number 740 of tokens permitted TOV for one usage associated with the content whose identifier is the identifier 724,</li><li>the number 742 of usages still possible STP associated with the content whose identifier is the identifier 724,</li><li>the digital rights 728 associated with the content whose identifier is the identifier 724. These rights 728 are then compared with the usage conditions 726 in comparison means 730: if this comparison allows the usage of the cryptoperiod in progress to be permitted, then a message is sent to the token counter 732 that supplies the updated number 734 of tokens consumed TAU, in other words the number 738 of tokens consumed TAU<!-- EPO <DP n="25"> --> supplied by the secure memory 736 incremented by one, this updated number 734 of tokens consumed TAU then being saved in the RCS database comprised in the memory 736.</li></ul></p><p id="p0154" num="0154">Means 744 for controlling the smart card 702 then verify the numbers 738 TAU, 740 TOV and 742 STP, so as to send an authorisation 746 to means 748 for extracting the control word, if the verification is positive.</p><p id="p0155" num="0155">If the verification is negative, then the usage is blocked since the smart card does not send the control word 750 required to decrypt the content to the decoder 700.</p><p id="p0156" num="0156">With this authorization 746, selection means 748 send the control word 750, previously received from the processing means 722, to the decryption means 710.</p><p id="p0157" num="0157">These decryption means 710 decrypt the input encrypted stream 708 by means of the control word 750 in order to output a stream 712 which is sent to decoding and consuming means 714.</p><p id="p0158" num="0158">Finally, the resulting new data stream 716 is sent to means 718 for reproducing digital data (notably, display screens, loudspeakers, headphones, odour generators).</p><p id="p0159" num="0159">The secure smart card contains a protected memory. This memory can accommodate all the counting structures or RCS database entries if their number is very limited.</p><p id="p0160" num="0160">In the majority of cases, however, this number is larger than the capacity of the smart card memory. For this reason, it is preferable to store the token counting data structures in a database which is comprised in the main memory of the multimedia personal player. In this embodiment, this main memory is in fact a hard disk.</p><p id="p0161" num="0161"><figref idrefs="f0007">Figure 8</figref> describes schematically the storage and the extraction of the token counting data structures in the case where these structures are stored on a hard disk 804 of a multimedia personal player 800.</p><p id="p0162" num="0162">All the elements of this database are encrypted before being stored on the hard disk 804.<!-- EPO <DP n="26"> --></p><p id="p0163" num="0163">In fact, the database comprised in the hard disk 804 is a database of encrypted values.</p><p id="p0164" num="0164">A key 818 for the encryption and decryption of the elements comprised in the database, denoted Kcs key 818, is stored in the protected memory 808 of the secure smart card 806 comprised in the personal player 800.</p><p id="p0165" num="0165">The hard disk 804 is also used to store encrypted content data streams 802. Streams 810 output from the hard disk 804 are then sent towards the decryption means then towards reproduction means.</p><p id="p0166" num="0166">Each RCS counting data structure, such as was previously defined, is encrypted before being stored on the hard disk 804 in its encrypted form RCSE:<br/>
RCS<sub>E</sub> = E<sub>KCS</sub>(RCS), where E is an encryption function using the Kcs key 818.</p><p id="p0167" num="0167">In this embodiment, the standardized encryption function AES (abbreviation of "Advanced Encryption Standard" defined by the US National Institute of Standards and Technology) is chosen as the encryption function.</p><p id="p0168" num="0168">RCS<sub>E</sub> = AES<sub>KCS</sub>(RCS), where K<sub>CS</sub> is a secret AES 128-bit key.</p><p id="p0169" num="0169">This encryption using the AES function is carried out in AES encryption means 812.</p><p id="p0170" num="0170">Each encrypted RCSE structure 816 is stored on the hard disk. In order to extract the data from the RCS<sub>E</sub> counting structure database efficiently, an uncoded index and the uncoded CID identifier are attached to each RCS<sub>E</sub> on the hard disk 804.</p><p id="p0171" num="0171">When the secure smart card 806 reads the database of the encrypted counting data structures 816 in order to take data from it, this card 806 searches for a structure 816 on the hard disk having the same CID content identifier as the content that it wants to process. Once the card 806 has found this structure 816, it reads it and decrypts it according to the formula: <maths id="math0005" num=""><math display="block"><mi>RCS</mi><mo>=</mo><msubsup><mi>AES</mi><msub><mrow><mspace width="1em"/><mi mathvariant="normal">K</mi></mrow><mrow><mi mathvariant="normal">C</mi><mo>⁢</mo><mi mathvariant="normal">S</mi></mrow></msub><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mfenced><msub><mi>RCS</mi><mi mathvariant="normal">E</mi></msub></mfenced></math><img id="ib0005" file="imgb0005.tif" wi="50" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0172" num="0172">in the AES decryption means 814.<!-- EPO <DP n="27"> --></p><p id="p0173" num="0173">The extracted RCS data structure 820 is used to keep a tally of the number of times that one part of the content has been consumed.</p><p id="p0174" num="0174">This invention is capable of multiple variants. Thus, the invention may be implemented in multiple portable devices aside from personal entertainment systems, notably in mobile telephones or electronic diaries (PDAs).</p></description><claims mxw-id="PCLM56987135" lang="DE" load-source="patent-office"><!-- EPO <DP n="32"> --><claim id="c-de-01-0001" num="0001"><claim-text>Verfahren zum Kontrollieren digitaler Rechte des Typs "N-mal Abspielen" für einen digitalen Audio- und/oder Videoinhalt (132, 300, 600, 704), der als kontrollierter Inhalt (132, 300, 600, 704) bezeichnet wird, wobei der kontrollierte Inhalt (132, 300, 600, 704) durch einen Verbraucher an einer Verbrauchsvorrichtung (112, 800) oder an einer anderen Vorrichtung, die die Kontrolle dieser Rechte an die Verbrauchsvorrichtung delegiert, verbraucht wird, wobei das Verfahren einen durch die Verbrauchsvorrichtung ausgeführten Schritt des Sperrens des Ladens einer zusätzlichen Nutzung in mindestens einem der folgenden Fälle umfasst:
<claim-text>- der Verbraucher verbraucht vorübergehend an derselben Vorrichtung (112, 800), an der der kontrollierte Inhalt verbraucht wird, einen anderen Inhalt und kehrt daraufhin zu dem kontrollierten Inhalt zurück,</claim-text>
<claim-text>- der Verbraucher führt ein Zurückspulen des kontrollierten Inhalts (132, 300), das äquivalent einer kürzeren Nutzungsperiode als einer Schwellenperiode für das Zurückspulen ist, aus;</claim-text>
wobei in den kontrollierten Inhalt (132, 300) auf periodische Weise Markierungselemente eingefügt werden, um über den gesamten kontrollierten Inhalt eine Zahlenfolge von Indizes zu erzeugen, wobei die erste Zahl dieser Folge zu Beginn des kontrollierten Inhalts (132, 300) eingefügt wird, wobei diese Markierungselemente zur Kontrolle der Anzahl, in der ein kontrollierter Inhalt verbraucht wird, verwendet werden.<!-- EPO <DP n="33"> --></claim-text></claim><claim id="c-de-01-0002" num="0002"><claim-text>Verfahren nach Anspruch 1, <b>dadurch gekennzeichnet, dass</b> die Schwellenperiode für das Zurückspulen ein der Verbrauchsvorrichtung (112) zugeordneter fester Prozentsatz der Gesamtdauer des kontrollierten Inhalts (132, 300) ist.</claim-text></claim><claim id="c-de-01-0003" num="0003"><claim-text>Verfahren nach Anspruch 1, <b>dadurch gekennzeichnet, dass</b> die Schwellenperiode für das Zurückspulen dem kontrollierten Inhalt (132, 300) zugeordnet ist und unabhängig von der Verbrauchsvorrichtung (112) ist.</claim-text></claim><claim id="c-de-01-0004" num="0004"><claim-text>Verfahren nach Anspruch 1, <b>dadurch gekennzeichnet, dass</b> Verarbeitungsmittel (130), die Speichermitteln (136) zugeordnet sind und die der Verbrauchsvorrichtung (112) zugeordnet sind, während der Nutzung eines Teils des kontrollierten Inhalts (132, 300), der einen Index umfasst, diesen innerhalb dieses Teils des verbrauchten Inhalts vorhandenen Index abtasten, um ihn mit dem zuvor abgetasteten und gespeicherten Index zu vergleichen, ein Prozess, in dem:
<claim-text>- es keine Anforderung für eine neue Nutzung gibt, falls der neueste Index größer oder gleich dem gespeicherten ist,</claim-text>
<claim-text>- die Differenz zwischen den zwei Indizes berechnet wird, falls der neueste Index kleiner als der gespeicherte ist, wobei:
<claim-text>■ eine Anforderung für eine neue Nutzung erfolgt, falls die Differenz größer als die Schwellenperiode für das Zurückspulen ist,<!-- EPO <DP n="34"> --></claim-text>
<claim-text>■ keine Anforderung für eine neue Nutzung erfolgt, falls die Differenz nicht größer als die Schwellenperiode für das Zurückspulen ist.</claim-text></claim-text></claim-text></claim><claim id="c-de-01-0005" num="0005"><claim-text>Verfahren nach einem der Ansprüche 1 oder 4, <b>dadurch gekennzeichnet, dass</b> die Indizes in Pakete (142, 302(i)) von Kontrolldaten, die über den gesamten kontrollierten Inhalt (132, 300) regelmäßig angeordnet sind und die durch Verschlüsselung geschützt sind, eingeführt werden.</claim-text></claim><claim id="c-de-01-0006" num="0006"><claim-text>Verfahren nach einem der Ansprüche 4 oder 5, <b>dadurch gekennzeichnet, dass</b> die Verarbeitungsmittel (130) eine Datenbank enthalten, die jedem kontrollierten Inhalt (132, 300), der durch eine Kennung für diesen Inhalt repräsentiert ist, mindestens einen der folgenden Datenwerte zuordnet:
<claim-text>- die Anfangsmenge möglicher Nutzungen,</claim-text>
<claim-text>- einen oder mehrere Verschlüsselungsschlüssel,</claim-text>
<claim-text>- eine aktualisierte Anzahl noch möglicher Nutzung(en),</claim-text>
<claim-text>- den Index des neuesten Pakets (142, 302(i)) von Kontrolldaten,</claim-text>
<claim-text>- eine maximale Anzahl von Paketen (142, 302(i)) von Kontrolldaten, an denen ein Zurückspulen ausgeführt werden kann, ohne eine neue Nutzungsanforderung auszulösen.</claim-text></claim-text></claim><claim id="c-de-01-0007" num="0007"><claim-text>Verfahren zum Kontrollieren digitaler Rechte des Typs "N-mal Abspielen" für einen digitalen Audio- und/oder Videoinhalt (132, 300, 600, 704), der als kontrollierter Inhalt (132, 300, 600, 704) bezeichnet wird, wobei der kontrollierte Inhalt (132, 300, 600, 704) durch einen<!-- EPO <DP n="35"> --> Verbraucher an einer Verbrauchsvorrichtung (112, 800) oder an einer anderen Vorrichtung, die die Kontrolle dieser Rechte an die Verbrauchsvorrichtung delegiert, verbraucht wird, <b>dadurch gekennzeichnet, dass</b> das Verfahren einen durch die Verbrauchsvorrichtung ausgeführten Schritt des Sperrens des Ladens einer zusätzlichen Nutzung in mindestens einem der folgenden Fälle umfasst:
<claim-text>- der Verbraucher verbraucht vorübergehend an derselben Vorrichtung (112, 800), an der der kontrollierte Inhalt verbraucht wird, einen anderen Inhalt und kehrt daraufhin zu dem kontrollierten Inhalt zurück,</claim-text>
<claim-text>- der Verbraucher führt ein Zurückspulen des kontrollierten Inhalts aus, wobei der kontrollierte Inhalt (132, 600, 704) kontrollierbare Teile umfasst, die in Perioden (602(i)) geteilt sind, die jeweils mindestens ein Paket (604) von Kontrolldaten, Kontrollnachricht (604) genannt, enthalten, wobei diese Kontrollnachricht (604) ein Token (612) umfasst, wobei das Verfahren daraufhin die folgenden durch die Verbrauchsvorrichtung (112, 800) ausgeführten Schritte umfasst:</claim-text>
<claim-text>- fortschreitendes Detektieren jedes Tokens innerhalb der kontrollierbaren Teile des kontrollierten Inhalts, während der kontrollierte Inhalt verbraucht wird, und</claim-text>
<claim-text>- Zählen der Anzahl dieser Token, um die Anzahl der von den kontrollierbaren Teilen verbrauchten Perioden (602(i)) kontrollieren zu können.</claim-text></claim-text></claim><claim id="c-de-01-0008" num="0008"><claim-text>Verfahren nach Anspruch 7, <b>dadurch gekennzeichnet, dass</b> die Abwesenheit eines Tokens in Paketen kontrollierter<!-- EPO <DP n="36"> --> Daten detektiert und gezählt wird, um die Anzahl der Perioden (602(i)) des verbrauchten kontrollierten Inhalts zu kontrollieren.</claim-text></claim><claim id="c-de-01-0009" num="0009"><claim-text>Verfahren nach einem der Ansprüche 7 oder 8, <b>dadurch gekennzeichnet, dass</b> innerhalb der Verbrauchsvorrichtung (112, 800) eine Datenbank gebildet ist, die für jeden durch die Verbrauchsvorrichtung kontrollierten Inhalt einen Satz von Datenwerten, Zählstruktur genannt, umfasst, wobei jede Zählstruktur eine Kennung (724) für diesen Inhalt und eine Anzahl, TOV-Anzahl (740) genannt, die eine zulässige maximale Anzahl von Token (612), die während einer einzelnen Nutzung dieses kontrollierten Inhalts (132, 600, 704) detektiert und gezählt werden können, repräsentiert, umfasst.</claim-text></claim><claim id="c-de-01-0010" num="0010"><claim-text>Verfahren nach Anspruch 9, <b>dadurch gekennzeichnet, dass</b> die Anzahl detektierter und geladener Token (612) für die laufende Nutzung für jede neue verbrauchte Periode des kontrollierbaren Teils mit der TOV-Anzahl (740) in der Weise verglichen wird, dass die laufende Nutzung abgeschlossen wird und eine Anforderung für eine neue Nutzung erfolgt, falls die Anzahl detektierter und geladener Token (612) die TOV-Anzahl (740) übersteigt.</claim-text></claim><claim id="c-de-01-0011" num="0011"><claim-text>Verfahren nach Anspruch 10, <b>dadurch gekennzeichnet, dass</b> jede Zählstruktur eine Anzahl, Nutzungsspanne genannt, enthält, die eine zusätzliche maximale Anzahl von Token (612), die in Bezug auf die TOV-Anzahl (740) detektiert und gezählt werden können, in der Weise repräsentiert,<!-- EPO <DP n="37"> --> dass die laufende Nutzung abgeschlossen wird und eine Anforderung für eine neue Nutzung erfolgt, falls die Anzahl detektierter und gezählter Token (612) die Summe der TOV-Anzahl (740) und der Nutzungsspanne übersteigt.</claim-text></claim><claim id="c-de-01-0012" num="0012"><claim-text>Verfahren nach Anspruch 11, <b>dadurch gekennzeichnet, dass</b> jede Zählstruktur eine Anzahl von Nutzungen, die für jeden digitalen Inhalt noch möglich sind, die STP-Anzahl (742) genannt, umfasst.</claim-text></claim><claim id="c-de-01-0013" num="0013"><claim-text>Verfahren nach den Ansprüchen 10 oder 11, zusammen mit Anspruch 12, <b>dadurch gekennzeichnet, dass</b> das Ergebnis der Anforderung für eine neue Nutzung besteht aus:
<claim-text>- entweder dem Verbot einer neuen Nutzung, falls die STP-Anzahl (742) null ist;</claim-text>
<claim-text>- oder der Freigabe für eine neue Nutzung und somit der Verringerung der STP-Anzahl (742), falls die STP-Anzahl (742) von null verschieden ist.</claim-text></claim-text></claim><claim id="c-de-01-0014" num="0014"><claim-text>Verfahren nach Anspruch 9, <b>dadurch gekennzeichnet, dass</b> die Datenbank für die Zählstrukturen innerhalb von Speichermitteln (136, 804) der Verbrauchsvorrichtung auf verschlüsselte Weise gespeichert wird, wobei ein Verschlüsselungsschlüssel, der ermöglicht, dass Zählstrukturen dieser Datenbank entschlüsselt werden, in sicheren Speicher- und Verarbeitungsmitteln (136, 804) der Verbrauchsvorrichtung enthalten ist.</claim-text></claim><claim id="c-de-01-0015" num="0015"><claim-text>Verbrauchsvorrichtung (112, 800), <b>dadurch gekennzeichnet, dass</b> sie das Verfahren zum Kontrollieren digitaler Rechte<!-- EPO <DP n="38"> --> des Typs "N-mal Abspielen" nach einem der Ansprüche 1 bis 14 implementiert.</claim-text></claim></claims><claims mxw-id="PCLM56987136" lang="EN" load-source="patent-office"><!-- EPO <DP n="28"> --><claim id="c-en-01-0001" num="0001"><claim-text>Method for controlling digital rights of the "Play N times" type for a digital audio and/or video content (132, 300, 600, 704), referred to as controlled content (132, 300, 600, 704), the controlled content (132, 300, 600, 704) being consumed by a consumer on a consuming device (112, 800) or on another device delegating the control of these rights to the consuming device, wherein the method comprises a step, performed by the consuming device, of inhibiting the charging of one additional usage in at least one of the following cases:
<claim-text>- the consumer momentarily consumes another content on the same device (112, 800) where the controlled content is consumed and then returns to the controlled content,</claim-text>
<claim-text>- the consumer performs a rewind of the controlled content (132, 300) equivalent to a shorter usage period than a rewind threshold period;</claim-text>
where marker elements are inserted in a periodic manner within the controlled content (132, 300) so as to form a numerical series of indices throughout the controlled content, the first number of this series being inserted at the beginning of the controlled content (132, 300), these marker elements being used to control the number of times a controlled content is consumed.</claim-text></claim><claim id="c-en-01-0002" num="0002"><claim-text>Method according to Claim 1, <b>characterized in that</b> the rewind threshold period is a fixed percentage, associated with the consuming device (112), of the total duration of the controlled content (132, 300).</claim-text></claim><claim id="c-en-01-0003" num="0003"><claim-text>Method according to Claim 1, <b>characterized in that</b> the rewind threshold period is associated with the controlled content (132, 300) and is independent of the consuming device (112).</claim-text></claim><claim id="c-en-01-0004" num="0004"><claim-text>Method according to Claim 1 , <b>characterized in that</b>, during the usage of a part of the controlled content (132, 300) comprising an index, processing<!-- EPO <DP n="29"> --> means (130), associated with storage means (136) and associated with the consuming device (112), sample this index present within this part of the content consumed, in order to compare it with the index previously sampled and stored, a process in which:
<claim-text>- if the latest index is greater than or equal to that stored, then there is no demand for a new usage,</claim-text>
<claim-text>- if the latest index is smaller than that stored, then the difference between the two indices is calculated:
<claim-text>■ if the difference is greater than the rewind threshold period then a demand for a new usage is made,</claim-text>
<claim-text>■ if the difference is not greater than the rewind threshold period, then there is no demand for a new usage.</claim-text></claim-text></claim-text></claim><claim id="c-en-01-0005" num="0005"><claim-text>Method according to one of Claims 1 or 4, <b>characterized in that</b> the indices are introduced in packets (142, 302(i)) of control data regularly disposed throughout the controlled content (132, 300) and protected by encryption.</claim-text></claim><claim id="c-en-01-0006" num="0006"><claim-text>Method according to one of Claims 4 or 5, <b>characterized in that</b> the processing means (130) contain a database that associates with each controlled content (132, 300), represented by an identifier for this content, at least one of the following data values:
<claim-text>- the initial quantity of possible usages,</claim-text>
<claim-text>- one or more encryption keys,</claim-text>
<claim-text>- an updated number of usage(s) still possible,</claim-text>
<claim-text>- the index of the latest packet (142, 302(i)) of control data,</claim-text>
<claim-text>- a maximum quantity of packets (142, 302(i)) of control data on which a rewind can be carried out without triggering a new usage demand.</claim-text></claim-text></claim><claim id="c-en-01-0007" num="0007"><claim-text>Method for controlling digital rights of the "Play N times" type for a digital audio and/or video content (132, 300, 600, 704), referred to as controlled content (132, 300, 600, 704), the controlled content (132, 300, 600, 704) being consumed by a consumer on a consuming device (112, 800) or on another device delegating the control of these rights to the consuming device, <b>characterized in that</b> the method comprises a step, performed by the<!-- EPO <DP n="30"> --> consuming device, of inhibiting the charging of one additional usage in at least one of the following cases:
<claim-text>- the consumer momentarily consumes another content on the same device (112, 800) where the controlled content is consumed and then returns to the controlled content,</claim-text>
<claim-text>- the consumer performs a rewind of the controlled content (132, 300) equivalent to a shorter usage period than a rewind threshold period;</claim-text>
where the controlled content (132, 600, 704) comprises controllable parts divided into periods (602(i)) that each contain at least one packet (604) of control data, called control message (604), this control message (604) comprising a token (612), the method then comprises the steps, performed by the consuming device (112, 800), of:
<claim-text>- progressively detecting each token, within the controllable parts of the controlled content, as the controlled content is consumed, and</claim-text>
<claim-text>- counting the number of these tokens in order to be able to control the number of periods (602(i)) consumed from the controllable parts.</claim-text></claim-text></claim><claim id="c-en-01-0008" num="0008"><claim-text>Method according to Claim 7, <b>characterized in that</b> the absence of token in packets of control data is detected and counted in order to control the number of periods (602(i)) of the controlled content consumed.</claim-text></claim><claim id="c-en-01-0009" num="0009"><claim-text>Method according to one of Claims 7 or 8, <b>characterized in that</b>, within the consuming device (112, 800), a database is formed that comprises, for each content controlled by the consuming device, a set of data values, called counting structure, each counting structure comprising an identifier (724) for this content and a number, called TOV number (740), representing an allowed maximum number of tokens (612) able to be detected and counted during one single usage of this controlled content (132, 600, 704).</claim-text></claim><claim id="c-en-01-0010" num="0010"><claim-text>Method according to Claim 9, <b>characterized in that</b> the number of tokens (612) detected and charged, for the usage in progress, is compared, for each new period consumed of the controllable part, with the TOV number (740), in such a manner that, if the number of tokens (612) detected and charged<!-- EPO <DP n="31"> --> exceeds the TOV number (740), the usage in progress terminates and a demand for a new usage is made.</claim-text></claim><claim id="c-en-01-0011" num="0011"><claim-text>Method according to Claim 10, <b>characterized in that</b> each counting structure contains a number, called usage margin, representing an additional maximum number of tokens (612) that can be detected and counted with respect to the TOV number (740), in such a manner that, if the number of tokens (612) detected and counted exceeds the sum of the TOV number (740) and of the usage margin, the usage in progress terminates and a demand for a new usage is made.</claim-text></claim><claim id="c-en-01-0012" num="0012"><claim-text>Method according to Claim 11, <b>characterized in that</b> each counting structure comprises a number of usages still possible for each digital content, called STP number (742).</claim-text></claim><claim id="c-en-01-0013" num="0013"><claim-text>Method according to Claims 10 or 11 in combination with claim 12, <b>characterized in that</b> the result of the demand for a new usage consists of:
<claim-text>- either the prohibition of a new usage if the STP number (742) is zero;</claim-text>
<claim-text>- or, if the STP number (742) is non-zero, the clearance for a new usage and hence the decrease of the STP number (742).</claim-text></claim-text></claim><claim id="c-en-01-0014" num="0014"><claim-text>Method according to Claim 9, <b>characterized in that</b> the database for the counting structures is stored in an encrypted fashion within storage means (136, 804) of the consuming device, an encryption key allowing the counting structures of this database to be decrypted being contained in secure storage and processing means (136, 804) of the consuming device.</claim-text></claim><claim id="c-en-01-0015" num="0015"><claim-text>Consuming device (112, 800), <b>characterized in that</b> it implements the method for controlling digital rights of the "Play N times" type according to one of Claims 1 to 14.</claim-text></claim></claims><claims mxw-id="PCLM56987137" lang="FR" load-source="patent-office"><!-- EPO <DP n="39"> --><claim id="c-fr-01-0001" num="0001"><claim-text>Procédé pour le contrôle de droits de consommation de type « N consommations autorisées » d'un contenu numérique audio et/ou vidéo (132, 300, 600, 704), appelé contenu contrôlé (132, 300, 600, 704), le contenu contrôlé (132, 300, 600, 704) étant consommé par un consommateur sur un dispositif de consommation (112, 800) ou sur un autre dispositif déléguant le contrôle de ces droits au dispositif de consommation, dans lequel le procédé comprend une étape, effectuée par le dispositif de consommation, pour empêcher la facturation d'une utilisation supplémentaire dans au moins un des cas suivants :
<claim-text>- le consommateur consomme momentanément un autre contenu sur le même dispositif (112, 800) dans lequel le contenu contrôlé est consommé puis il retourne au contenu contrôlé ,</claim-text>
<claim-text>- le consommateur effectue un retour en arrière du contenu contrôlé (132, 300) équivalent à une période d'utilisation plus courte qu'une période seuil de retour en arrière ;</claim-text>
où des éléments de marquage sont insérés de manière périodique dans le contenu contrôlé (132, 300) afin de former une série numérique d'indices d'un bout à l'autre du contenu contrôlé, le premier numéro de cette série étant inséré au début du contenu contrôlé (132, 300), ces éléments de marquage étant utilisés pour contrôler le nombre de fois où un contenu contrôlé est consommé.</claim-text></claim><claim id="c-fr-01-0002" num="0002"><claim-text>Procédé selon la revendication 1, <b>caractérisé en ce que</b> la période seuil de retour en arrière est un pourcentage fixe, associé au dispositif de consommation (112), de la durée totale du contenu contrôlé (132, 300).</claim-text></claim><claim id="c-fr-01-0003" num="0003"><claim-text>Procédé selon la revendication 1, <b>caractérisé en ce que</b> la période seuil de retour en arrière est associée au contenu contrôlé (112, 300) et est indépendante du dispositif de consommation (112).</claim-text></claim><claim id="c-fr-01-0004" num="0004"><claim-text>Procédé selon la revendication 1, <b>caractérisé en ce que</b>, pendant l'utilisation d'une partie du contenu contrôlé (132, 300) comprenant un indice, le moyen de traitement (130) associé au moyen de stockage (136) et associé au dispositif de consommation (112), échantillonne cet indice présent dans cette partie du contenu consommé, afin de le comparer à l'indice précédemment échantillonné et stocké, un traitement dans lequel :<!-- EPO <DP n="40"> -->
<claim-text>- si l'indice le plus récent est supérieur ou égal à celui qui est stocké, alors il n'y a aucune demande de nouvelle utilisation,</claim-text>
<claim-text>- si l'indice le plus récent est inférieur à celui qui est stocké, alors la différence entre les deux indices est calculée :
<claim-text>• si la différence est supérieure à la période seuil de retour en arrière, alors une demande pour une nouvelle utilisation est effectuée,</claim-text>
<claim-text>• si la différence n'est pas supérieure à la période seuil de retour en arrière, alors il n'y a pas de demande pour une nouvelle utilisation.</claim-text></claim-text></claim-text></claim><claim id="c-fr-01-0005" num="0005"><claim-text>Procédé selon l'une des revendications 1 ou 4, <b>caractérisé en ce que</b> les indices sont introduits dans des paquets (142, 302 (i)) de données de contrôle disposés régulièrement d'un bout à l'autre du contenu contrôlé (132, 300) et protégés par codage.</claim-text></claim><claim id="c-fr-01-0006" num="0006"><claim-text>Procédé selon l'une des revendications 4 ou 5, <b>caractérisé en ce que</b> le moyen de traitement (130) contient une base de données qui associe à chaque contenu contrôlé (132, 300), représenté par un identifiant pour ce contenu, au moins une des valeurs de données suivantes :
<claim-text>- la quantité initiale d'utilisations possibles,</claim-text>
<claim-text>- une ou plusieurs clefs de codage,</claim-text>
<claim-text>- un nombre mis à jour d'utilisations encore possibles,</claim-text>
<claim-text>- l'indice du paquet le plus récent (142, 302 (i)) de données de contrôle,</claim-text>
<claim-text>- une quantité maximum de paquets (142, 302 (i)) de données de contrôle sur lesquelles il est possible d'effectuer un retour en arrière sans déclencher de nouvelle demande d'utilisation.</claim-text></claim-text></claim><claim id="c-fr-01-0007" num="0007"><claim-text>Procédé pour le contrôle de droits de consommation de type « N consommations autorisées » d'un contenu numérique audio et/ou vidéo (132, 300, 600, 704), appelé contenu contrôlé (132, 300, 600, 704), le contenu contrôlé (132, 300, 600, 704) étant consommé par un consommateur sur un dispositif de consommation (112, 800) ou sur un autre dispositif déléguant le contrôle de ces droits au dispositif de consommation, <b>caractérisé en ce que</b> le procédé comprend une étape, effectuée par le dispositif de consommation, d'empêcher la facturation d'une utilisation supplémentaire dans un des cas suivants au moins :
<claim-text>- le consommateur consomme momentanément un autre contenu sur le même dispositif (112, 800) dans lequel le contenu contrôlé est consommé puis il retourne au contenu contrôlé,<!-- EPO <DP n="41"> --></claim-text>
<claim-text>- le consommateur effectue un retour en arrière du contenu contrôlé,</claim-text>
lorsque le contenu contrôlé (132, 600, 704) comprend des parties contrôlables divisées en périodes (602 (i)) contenant chacune au moins un paquet (604) de données de contrôle, appelé message de contrôle (604), ce message de contrôle (604) comprenant un jeton (612), le procédé comprenant alors les étapes, effectuées par le dispositif de consommation (118, 800), de :
<claim-text>- détection progressive de chaque jeton, dans les parties contrôlables du contenu contrôlé, tandis que le contenu contrôlé est consommé, et</claim-text>
<claim-text>- comptage du nombre de ces jetons afin de pouvoir contrôler le nombre de périodes (602 (i)) consommé par les parties contrôlables.</claim-text></claim-text></claim><claim id="c-fr-01-0008" num="0008"><claim-text>Procédé selon la revendication 7, <b>caractérisé en ce que</b> l'absence de jeton dans les paquets de données de contrôle est détectée et comptée afin de contrôler les nombre de périodes (602 (i)) du contenu contrôlé consommé.</claim-text></claim><claim id="c-fr-01-0009" num="0009"><claim-text>Procédé selon l'une des revendications 7 ou 8, <b>caractérisé en ce que</b> dans le dispositif de consommation (112, 800), une base de données est formée et comprend, pour chaque contenu contrôlé par le dispositif de consommation, un ensemble de valeurs de données, appelé structure de comptage, chaque structure de comptage comprenant un identifiant (724) pour ce contenu et un nombre, appelé nombre de TOV (740), représentant un nombre maximum de jetons autorisé (612) qu'il est possible de détecter et de compter lors d'une seule utilisation de ce contenu contrôlé (132, 600, 704).</claim-text></claim><claim id="c-fr-01-0010" num="0010"><claim-text>Procédé selon la revendication 9, <b>caractérisé en ce que</b> le nombre de jetons (612) détecté et facturé, pour l'utilisation en cours, est comparé, pour chaque nouvelle période consommée de la partie contrôlable, au nombre de TOV (740), de telle sorte que, si le nombre de jetons (612) détecté et facturé dépasse le nombre de TOV (740), l'utilisation en cours prend fin et une demande de nouvelle utilisation est effectuée.</claim-text></claim><claim id="c-fr-01-0011" num="0011"><claim-text>Procédé selon la revendication 10, caractérisé en ce chaque structure de comptage contient un nombre, appelé marge d'utilisation, représentant un nombre maximum supplémentaire de jetons (612) qui peut être détecté et facturé en fonction du nombre de TOV (740), de telle sorte que, si le nombre de jetons (612) détecté et facturé dépasse la somme du nombre de TOV (740) et de la marge d'utilisation, l'utilisation en cours prend fin et une demande de nouvelle utilisation est effectuée.<!-- EPO <DP n="42"> --></claim-text></claim><claim id="c-fr-01-0012" num="0012"><claim-text>Procédé selon la revendication 11, <b>caractérisé en ce que</b> chaque structure de comptage comprend un nombre d'utilisations encore possibles pour chaque contenu numérique, appelé nombre STP (742).</claim-text></claim><claim id="c-fr-01-0013" num="0013"><claim-text>Procédé selon la revendication 10 ou 11 associée à la revendication 12, <b>caractérisé en ce que</b> le résultat de la demande d'une nouvelle utilisation consiste en :
<claim-text>- soit l'interdiction d'une nouvelle utilisation si la valeur du nombre STP (742) est égale à zéro ;</claim-text>
<claim-text>- soit, si la valeur du nombre STP 742) n'est pas égale à zéro, l'autorisation d'une nouvelle utilisation, d'où la diminution de la valeur du nombre STP (742).</claim-text></claim-text></claim><claim id="c-fr-01-0014" num="0014"><claim-text>Procédé selon la revendication 9, <b>caractérisé en ce que</b> la base de données pour les structures de comptage est stockée d'une façon codée dans le support de stockage (136, 804) du dispositif de consommation, une clef de codage autorisant les structures de comptage de cette base de données à être décodées, se trouvant dans un stockage sécurisé et le moyen de traitement (136, 804) du dispositif de consommation.</claim-text></claim><claim id="c-fr-01-0015" num="0015"><claim-text>Dispositif de consommation (112, 800), <b>caractérisé en ce qu'</b>il implémente le procédé de contrôle de droits de consommation numérique de type « N consommations autorisées » selon l'une des revendications 1 à 14.</claim-text></claim></claims><drawings mxw-id="PDW16672660" load-source="patent-office"><!-- EPO <DP n="43"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="162" he="226" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="44"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="186" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="45"> --><figure id="f0003" num="3a,3b"><img id="if0003" file="imgf0003.tif" wi="163" he="227" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="46"> --><figure id="f0004" num="4,5"><img id="if0004" file="imgf0004.tif" wi="165" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="47"> --><figure id="f0005" num="6"><img id="if0005" file="imgf0005.tif" wi="159" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="48"> --><figure id="f0006" num="7"><img id="if0006" file="imgf0006.tif" wi="158" he="218" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="49"> --><figure id="f0007" num="8"><img id="if0007" file="imgf0007.tif" wi="153" he="178" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
