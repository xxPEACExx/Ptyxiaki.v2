<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2305009-B1" country="EP" doc-number="2305009" kind="B1" date="20140108" family-id="40477622" file-reference-id="287197" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146588648" ucid="EP-2305009-B1"><document-id><country>EP</country><doc-number>2305009</doc-number><kind>B1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-08784891-A" is-representative="NO"><document-id mxw-id="PAPP154850840" load-source="docdb" format="epo"><country>EP</country><doc-number>08784891</doc-number><kind>A</kind><date>20080718</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140553644" ucid="EP-2008005912-W" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>2008005912</doc-number><kind>W</kind><date>20080718</date></document-id></priority-claim></priority-claims><dates-of-public-availability><intention-to-grant-date><date>20131114</date></intention-to-grant-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989326238" load-source="ipcr">H05H   9/00        20060101AFI20100202BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1989620291" load-source="docdb" scheme="CPC">H05H   9/00        20130101 FI20130101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132370577" lang="DE" load-source="patent-office">Verfahren zur Qualitätssicherung von einem Linearbeschleuniger für Strahlentherapie und Strahlentherapievorrichtung, die konfiguriert ist zur Durchführung des Verfahrens.</invention-title><invention-title mxw-id="PT132370578" lang="EN" load-source="patent-office">Method of quality assurance of a linear accelerator for radiotherapy and radiotherapy apparatus configured to carry out the method.</invention-title><invention-title mxw-id="PT132370579" lang="FR" load-source="patent-office">Procédé de contrôle de qualité d'un accélérateur linéaire pour radiothérapie et appareil de radiothérapie configuré pour exécuter le procédé.</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919512859" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ELEKTA AB</last-name><address><country>SE</country></address></addressbook></applicant><applicant mxw-id="PPAR919543091" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ELEKTA AB (PUBL)</last-name></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919534589" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SADLER PHILIP</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919510520" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SADLER, PHILIP</last-name></addressbook></inventor><inventor mxw-id="PPAR919024071" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SADLER, PHILIP</last-name><address><street>21 Goodwood Road Worthing</street><city>West Sussex BN13 2RU</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919536383" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>HARRISON DAVID</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919537110" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>HARRISON, DAVID</last-name></addressbook></inventor><inventor mxw-id="PPAR919024069" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>HARRISON, DAVID</last-name><address><street>47 Clarence Road Horsham</street><city>West Sussex RH13 5SJ</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919535934" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>MCCANN NEIL</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919534746" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>MCCANN, NEIL</last-name></addressbook></inventor><inventor mxw-id="PPAR919024070" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>MCCANN, NEIL</last-name><address><street>30 Field Close Burgess Hill</street><city>West Sussex RH15 8PP</city><country>GB</country></address></addressbook></inventor></inventors><assignees><assignee mxw-id="PPAR919024072" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Elekta AB (publ)</last-name><iid>100116057</iid><address><street>P.O. Box 7593</street><city>103 93 Stockholm</city><country>SE</country></address></addressbook></assignee></assignees><agents><agent mxw-id="PPAR919024073" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Downing, Michael Philip</last-name><suffix>et al</suffix><iid>101310150</iid><address><street>Downing IP Oak House Oak End Way</street><city>Gerrards Cross Buckinghamshire SL9 8BR</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="EP-2008005912-W"><document-id><country>EP</country><doc-number>2008005912</doc-number><kind>W</kind><date>20080718</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2010006630-A1"><document-id><country>WO</country><doc-number>2010006630</doc-number><kind>A1</kind><date>20100121</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549787574" load-source="docdb">AT</country><country mxw-id="DS549924940" load-source="docdb">BE</country><country mxw-id="DS549895131" load-source="docdb">BG</country><country mxw-id="DS549882534" load-source="docdb">CH</country><country mxw-id="DS549788829" load-source="docdb">CY</country><country mxw-id="DS549787575" load-source="docdb">CZ</country><country mxw-id="DS549924941" load-source="docdb">DE</country><country mxw-id="DS549788830" load-source="docdb">DK</country><country mxw-id="DS549788831" load-source="docdb">EE</country><country mxw-id="DS549872467" load-source="docdb">ES</country><country mxw-id="DS549895132" load-source="docdb">FI</country><country mxw-id="DS549895137" load-source="docdb">FR</country><country mxw-id="DS549924942" load-source="docdb">GB</country><country mxw-id="DS549788832" load-source="docdb">GR</country><country mxw-id="DS549924943" load-source="docdb">HR</country><country mxw-id="DS549787576" load-source="docdb">HU</country><country mxw-id="DS549882535" load-source="docdb">IE</country><country mxw-id="DS549788841" load-source="docdb">IS</country><country mxw-id="DS549895138" load-source="docdb">IT</country><country mxw-id="DS549788842" load-source="docdb">LI</country><country mxw-id="DS549804628" load-source="docdb">LT</country><country mxw-id="DS549787581" load-source="docdb">LU</country><country mxw-id="DS549804629" load-source="docdb">LV</country><country mxw-id="DS549804630" load-source="docdb">MC</country><country mxw-id="DS549878721" load-source="docdb">MT</country><country mxw-id="DS549895139" load-source="docdb">NL</country><country mxw-id="DS549872468" load-source="docdb">NO</country><country mxw-id="DS549882536" load-source="docdb">PL</country><country mxw-id="DS549878726" load-source="docdb">PT</country><country mxw-id="DS549895140" load-source="docdb">RO</country><country mxw-id="DS549882537" load-source="docdb">SE</country><country mxw-id="DS549787582" load-source="docdb">SI</country><country mxw-id="DS549872469" load-source="docdb">SK</country><country mxw-id="DS549804631" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><description mxw-id="PDES63961068" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">FIELD OF THE INVENTION</heading><p id="p0001" num="0001">The present invention relates to the field of linear accelerators ("linacs"). It is especially, but not exclusively, concerned with such accelerators for medical usage.</p><heading id="h0002">BACKGROUND ART</heading><p id="p0002" num="0002">Linacs are used to create high-energy beams of electrons and/or x-rays. These are useful in a wide range of circumstances, including for medical purposes. Such beams are harmful to tissue in their path, and therefore by careful collimation and control of the beam they can be used to deliver a radiation dose to (for example) a tumour in order to cause the tumour to stop growing or even die back.</p><p id="p0003" num="0003">If a significant amount of non-cancerous tissue receives a significant dose, this can cause side-effects. These are undesirable in principle, and will also limit the rate at which the tumour can be irradiated. This, in turn, reduces the efficiency of the treatment. For this reason, the dose applied to the patient is carefully controlled, and complex treatment plans are prepared in which the direction of irradiation, the collimation of the beam, and the beam intensity are all varied with time in an interrelated manner in order to build up a desired three-dimensional dose distribution in the patient. These treatment plans are prepared by a treatment planning computer which models the interaction of the beam and the patient.</p><p id="p0004" num="0004">This process requires that the properties of the beam be well characterised, and that the beam continues to conform to that characterisation over the long term. An international standard exists which lays down ranges of permissible parameters for the beam, but these ranges are relatively wide and nominally identical linear accelerators may produce beams that all fall within the standard but which have measurably different properties.<!-- EPO <DP n="2"> --></p><p id="p0005" num="0005">Thus, the properties of the beam produced by a specific linear accelerator will usually be characterised prior to bringing the linear accelerator into service, and those properties used to define the beam model employed by the treatment planning computer. To confirm that the beam is still behaving according to the model, routine checks are carried out over time. Typically, there is a brief daily check, a slightly more thorough weekly check, and a more involved monthly check.</p><p id="p0006" num="0006">Prior art document <patcit id="pcit0001" dnum="US20070248214A1"><text>US 2007/0248214 A1</text></patcit> discloses a target structure for a linear accelerator in a radiotherapy apparatus, in which the target converts energy in an electron beam to x-rays and provides for the monitoring and control of the effective energy of the electron beam by collecting and processing a residual current in the target structure. <patcit id="pcit0002" dnum="US20050109939A"><text>US 2005/0109939</text></patcit> discloses a radiation field detecting system for use with a radiating device such as a linear accelerator in which a radiation detector is moved through the radiation field produced by the radiating device and the information as to the radiation distribution used to conform treatment to conform treatment of a patient to account for variations in beam strength relative to expected beam strengths.</p><heading id="h0003">SUMMARY OF THE INVENTION</heading><p id="p0007" num="0007">As a result of these constraints, the process of bringing a new linac into service can be very lengthy. The linac must be physically delivered and installed into its desired location, and the necessary power, water and data lines connected. The beam properties must then be measured and checked against the standard to confirm that the linac has not been damaged in transit, and to characterise the properties of the beam. These properties (sometimes referred to as the "signature" of the beam) must be transferred to the treatment planning computer to create a digital model of that beam for use in preparing treatment plans. That model then needs to be checked in order to confirm its accuracy; this involves the preparation of a number of sample dose distributions which are then delivered by the linac to a test phantom in order to confirm that the linac is behaving as expected.<!-- EPO <DP n="3"> --></p><p id="p0008" num="0008">This process of characterisation and testing can take up to six months. During this time, the linac is not available for treatment of patients, which is (clearly) inconvenient for the clinic and for patients.</p><p id="p0009" num="0009">We therefore propose that during the factory testing of the linac, rather than simply confirming that the beam falls within the permissible ranges set out in the standard, the beam is in fact adjusted towards a standard signature. This standard signature could then be published for use by writers of treatment planning software. As a result, while there may be small differences between the actual signature of the beam and the standard signature, these will take less time to characterise and test and therefore the linac can be brought into service more quickly.</p><p id="p0010" num="0010">This also raises the prospect of preparing a plurality of linacs in or for the same clinic that have matched beams. A new (or existing) linac could be paired to a new linac, or to an existing linac, such as one that it is to operate alongside or one that it is to replace. Treatment plans would then be transferable between such pairs of linacs, thereby allowing greater flexibility in booking patients for treatment or allowing existing treatment plans to be used on the new linac.</p><p id="p0011" num="0011">In addition, the standard signature to which the linacs were approximated is placed towards the centre of the permitted ranges. This could produce linacs that were more reliable over the very long term.</p><p id="p0012" num="0012">This requires a linac that has automatically adjustable parameters, so that a suitable programmed computer is able to monitor the output of the linac and adjust its operating parameters. This means the computer is able to try a wide range of permitted adjustments to the linac before opting for that combination which approximates most closely to the published standard.</p><p id="p0013" num="0013">This also raises the prospect of fuller testing while the linac is in service. As mentioned above, a degree of routine testing is already carried out. However, if the linac is provided with a suitable detector for the beam properties then a fuller routine test could be carried out, for example overnight while the clinic is closed. Such a detector could be fitted to the linac by an operator after<!-- EPO <DP n="4"> --> completion of the last treatment of the relevant clinical session, or it could be carried by the linac continuously. In the latter case, the detector could be mounted in the beam path or it could be fitted to an extendable arm to allow it to be moved into the path of the beam when required. Some linacs are fitted with flat panel detectors for the beam, to capture portal images during treatment; while these are not optimised for beam testing, they may be useable for some purposes.<br/>
The present invention therefore provides a method of quality assurance of a linear accelerator for radiotherapy, so as to calibrate the radiation beam produced by the linear accelerator, the accelerator comprising beam control circuitry for the accelerator, an electronic apparatus for the control circuitry arranged to adjust operating parameters thereof, and a monitor for detecting properties of the beam produced by the accelerator, wherein the control apparatus is adapted to retain a set of standard beam properties, the method comprising the steps of periodically: a) locating the monitor in the path of the radiation beam; b) activating the accelerator; c) measuring the current beam properties via the monitor; d) comparing the measured beam properties to the retained set of standard beam properties, and e) adjusting the operating parameters of the linear accelerator to align the beam properties towards the standard beam properties, characterised in that steps a) to e) are carried out prior to radiotherapeutic treatment of a patient, and in that the standard beam properties are towards the centre of the permitted ranges set out in the standard.</p><p id="p0014" num="0014">These steps could, for example, follow after a period of normal operation and may be followed by a further period of normal operation, after which they may be repeated.</p><p id="p0015" num="0015">The beam properties that are measured may include at least one of beam flatness, beam width, beam energy and absolute dose.</p><p id="p0016" num="0016">The standard beam properties can be the properties of the beam produced by the linear accelerator when new, or the properties of a standard beam.<!-- EPO <DP n="5"> --></p><p id="p0017" num="0017">The control apparatus is preferably arranged to send a message if the difference between the measured beam properties and the standard beam properties exceeds a threshold. It may also send a message to a remote location if the difference between the measured beam properties and the standard beam properties exceeds a second, more demanding, threshold.</p><heading id="h0004">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p0018" num="0018">An embodiment of the present invention will now be described by way of example, with reference to the accompanying figures in which;
<ul><li><figref idrefs="f0001">Figure 1</figref> shows the main components of the system;</li><li><figref idrefs="f0001">Figure 2</figref> shows the main software architecture;</li><li><figref idrefs="f0002">Figure 3</figref> shows the BeamAcquisitionManager Associations;</li><li><figref idrefs="f0002">Figure 4</figref> shows the ScanningInterface classes;</li><li><figref idrefs="f0003">Figure 5</figref> shows the SystemsTestTestModule classes;</li><li><figref idrefs="f0003">Figure 6</figref> shows the TestModuleLinacInterface;</li><li><figref idrefs="f0004">Figure 7</figref> shows the Test Module class relationships;</li><li><figref idrefs="f0004">Figure 8</figref> shows the Test Module Message Table;</li><li><figref idrefs="f0004">Figure 9</figref> shows the TestModuleMessage;</li><li><figref idrefs="f0005">Figure 10</figref> illustrates the process for implementing ITestModuleMessenger interface;</li><li><figref idrefs="f0005">Figure 11</figref> is a DataAnalysis Class Relationship diagram;</li><li><figref idrefs="f0006">Figure 12</figref> illustrates the beam test process; and</li><li><figref idrefs="f0007">Figure 13</figref> illustrates the MLC test process.</li></ul></p><heading id="h0005">DETAILED DESCRIPTION OF THE EMBODIMENTS</heading><!-- EPO <DP n="6"> --><heading id="h0006">1 INTRODUCTION</heading><p id="p0019" num="0019">Referring to the accompanying figures, we will now describe our "Autotest" software and the relationships between its individual components, before going on to describe how this might be used in practice.</p><heading id="h0007">2 OVERVIEW</heading><p id="p0020" num="0020">The Autotest software contains one executable file and several dynamic link libraries (DLLs) that fit together to produce a suite of test tools for shelter or in-use testing. By "shelter testing", we mean the testing of a new linac that takes place immediately after manufacture. Generally, after assembly the new linac will be placed in a radiation-shielded area referred to as a "shelter", within which it can be operated safely during initial testing.</p><p id="p0021" num="0021">To accomplish this, the software needs to be able to communicate directly to the Linac and also to scanning equipment placed in the beam that provides data characterising the beam. The Autotest software controls the linac via the Desktop Pro control system; two components are used to control the Linac - the TestInterfaceClient and the FKPModuleInterface. The latter communicates with a Function Key Pad (FKP) device which enables software control of particular buttons of the actual (physical) FKP. Communication with the linac is achieved by adjustment of control circuit parameters referred to as Item Part Values or IPVs. The Autotest software also controls the scanning equipment. Both the TestInterFaceClient and the ServoClient are lower level components, and as such only a brief description of each is provided herein.</p><heading id="h0008">3 THE MAIN COMPONENTS</heading><p id="p0022" num="0022">What could be considered the main components of this system are shown in <figref idrefs="f0001">figure 1</figref> and described below. These allow communication to the hardware, and provide the main user interface.</p><heading id="h0009">3.1 TestInterfaceClient</heading><!-- EPO <DP n="7"> --><p id="p0023" num="0023">Desktop Pro provides a software interface to the Autotest software to determine the linear accelerator energy configuration, configure and start beams, read and write linear accelerator item part value and resolve item part names in the Linac database.</p><heading id="h0010">Desktop Pro itself communicates with the Linac and MLC control systems to control the actual Linac and MLC</heading><p id="p0024" num="0024">The TestInterfaceClient thus acts as a façade in order to reduce the complexity of interfaces to the main linac software. The accompanying classes in the DLL are helper classes only:
<tables id="tabl0001" num="0001"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="31mm"/><colspec colnum="2" colname="col2" colwidth="135mm"/><thead><row><entry valign="top"><b>Class</b></entry><entry valign="top"><b>Purpose</b></entry></row></thead><tbody><row><entry>TestInterfaceClient</entry><entry>The main component. This permits clients to determine the linear accelerator energy configuration, configure and start beams, read and write linear accelerator item part value and resolve item part names in the Linac database. It uses the FieldParameters class in order to load in the beam parameters, and the MachineItem class when subscribing and unsubscribing to item parts.</entry></row><row><entry/><entry>This class also allows the client to load the MLCDisplay OCX control for viewing the MLC shape.</entry></row><row><entry>FieldParameters</entry><entry>Contains the leaf positions and beam parameters needed in order to set up a beam for radiation. The BeamParametersHaveChanged property gives a crude way of determining when the user interface has changed the beam parameters.</entry></row><row><entry>MachineItemClass</entry><entry>used by the TestInterfaceClient for inserting item parts into a hashtable in order to keep track of how many subscribers there are to a particular item part.</entry></row></tbody></tgroup></table></tables><!-- EPO <DP n="8"> --></p><heading id="h0011">3.2 FKPModuleInterface</heading><p id="p0025" num="0025">This permits communication to a USB function keypad ("FKP") device that permits the linear accelerator to be enabled by the control apparatus without user action. It provides methods such as ActivateStartButton and SetASUAndAutoButtons that have a direct correlation to the hardware buttons on the device itself.</p><p id="p0026" num="0026">As a safety feature, the FKPModuleInterface also periodically sends a sync message to the FKP hardware so that if the software crashes, the linear accelerator is disabled. This message is sent on a separate thread in order to ensure regular intervals without disruption by messages sent to the GUI. The physical device also has a key-switch and an 'activate' button to enable it before it can be used.</p><p id="p0027" num="0027">Although the hardware connects via a USB port, the drivers that are installed allow communication as though the FKPDevice was connected to a serial port. The SerialPort class acts as the lower level interface to the serial port whilst the FKPModuleInterface class is used directly by New Autotest.</p><p id="p0028" num="0028">This hardware device thus provides a USB interface for the Autotest software, to facilitate software control of the radiation beam and to allow Assisted Set Up (ASU) to be performed without a user having to be present to physically press the buttons on the Function Key Pad.</p><heading id="h0012">3.3 ServoClient</heading><p id="p0029" num="0029">The ServoClient, part of the Autotest software, is present in order to provide access to the detector via a serial port. The ServoClient component is a dll that runs in the Autotest software process space whilst the separate component runs in its own process space.</p><heading id="h0013">3.4 New Autotest GUI</heading><p id="p0030" num="0030">The New Autotest GUI is essentially the 'glue' that holds the system together. It has been designed to run in two ways:<!-- EPO <DP n="9"> -->
<ul><li>On a closed or locked system connected to a Linac.</li><li>On a desktop PC.</li></ul></p><p id="p0031" num="0031">When run on a desktop PC, the software is launched by the user double-clicking the executable file, in the same manner as a user would launch any other program. When run on a closed system connected to a Linac, New Autotest is launched via the NewAutotestLauncher component described in section 7.</p><p id="p0032" num="0032">Whilst it is difficult to give a meaningful description of the software without any knowledge of its constituent classes, it is also difficult to attach any usefulness to such classes without first knowing their interactions. Therefore, a brief overview of the main classes and their interactions is initially presented followed by a more thorough description of each class in subsequent sections.</p><p id="p0033" num="0033">The main software has been designed around a Model-View-Controller architecture with the plot data acting as the Model, the GUI acting as the View and the test modules and manual scanning routines acting as the Controllers. This is presented in <figref idrefs="f0001">figure 2</figref>.</p><p id="p0034" num="0034">The test modules and any manual scanning update the PlotData class by methods such as AddPlot, LoadFile, SmoothData, SetXAndYAxisArrays, etc. The PlotData class can then inform the views that the data has changed by sending events i.e. OnPlotAdded, OnDataAppended, OnAllPlotsDeleted, etc.</p><p id="p0035" num="0035">The PlotData class implements low-level data interrogation and manipulation producing plot data, which can then be used and presented to the user by the DataAnalysis control.</p><heading id="h0014">4 BEAM DATA ACQUISITION COMPONENTS</heading><p id="p0036" num="0036">These components are the main helper classes for the project. They provide no user interface but deal with file manipulation, running tests, storing data and providing access to the scanning hardware.<!-- EPO <DP n="10"> --></p><heading id="h0015">4.1 BeamAcquisitionManager</heading><p id="p0037" num="0037">The BeamAcquisitionManager utilises the Factory design method in order to instantiate the required components for interfacing with the Beam Acquisition hardware. The components that it creates are:
<tables id="tabl0002" num="0002"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="39mm"/><colspec colnum="2" colname="col2" colwidth="127mm"/><thead><row><entry valign="top"><b>Class</b></entry><entry valign="top"><b>Purpose</b></entry></row></thead><tbody><row><entry>ManualScanningMenu</entry><entry>To allow the user to interact with the scanning hardware via a menu control.</entry></row><row><entry>ManualScanningPage</entry><entry>To allow the user to interact with the scanning hardware via a user control that can reside on the New Autotest optional monitor.</entry></row><row><entry>ManualScanningToolbar</entry><entry>To allow the user to interact with the scanning hardware via a toolbar control.</entry></row><row><entry>ScanningInterface</entry><entry>To provide an interface to the scanning hardware. Described in section 4.2.</entry></row></tbody></tgroup></table></tables></p><p id="p0038" num="0038">These associations are shown in <figref idrefs="f0002">figure 3</figref>.</p><p id="p0039" num="0039">Future developments of the New Autotest software will involve using alternative hardware for Beam measurement, therefore, it is important that a flexible means of communication to the scanning hardware is provided. The first three classes in the above table are essentially abstract classes that permit the New Autotest GUI to load in controls that allow the user to interact with this hardware.</p><p id="p0040" num="0040">The BuddelshipManualScanningControls library contains bespoke implementations of the required user interface controls needed to specifically control the 'Buddelship' (i.e. the scanning equipment). As can be seen from <figref idrefs="f0002">figure 3</figref>, these classes inherit directly from the manual scanning controls listed above.<!-- EPO <DP n="11"> --></p><p id="p0041" num="0041">The BeamAcquisitionManager class itself has been implemented as a Singleton within the scope of the NewAutotest process space. This permits components to access the scanning hardware without the need for passing references to it between classes.</p><heading id="h0016">4.2 ScanningInterface</heading><p id="p0042" num="0042">It is envisaged that this class will eventually provide a bridge between the Autotest software and the scanning component (which at present is the ServoClient). As it stands, the ScanningInterface merely acts as a wrapper around the ServoClient component, thus providing the only means of accessing beam data. As new detectors become available, the ScanningInterface can be adapted to provide a more abstract bridge between New Autotest and the detector. The ScanningInterface uses a number of classes to interact with the hardware as shown in <figref idrefs="f0002">figure 4</figref>.</p><heading id="h0017">5 TEST MODULE CLASSES</heading><heading id="h0018">5.1 Overview</heading><p id="p0043" num="0043">All test modules implement an interface referred to as ITestModule. At present, most test modules accomplish this by inheriting from a SystemsTestTestModule class that provides common functionality to all test modules required by the Systems Test department. This common functionality is provided by the composition of classes shown in <figref idrefs="f0003">figure 5</figref>. The classes shown provide the following functionality:
<tables id="tabl0003" num="0003"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="41mm"/><colspec colnum="2" colname="col2" colwidth="125mm"/><thead><row><entry valign="top"><b>Class</b></entry><entry valign="top"><b>Purpose</b></entry></row></thead><tbody><row><entry>TestModuleLinacInterface</entry><entry>Uses the TestInterfaceClient and FKPModuleInterface class to interact with the Linac. It provides functions such as setting beam parameters, enabling the ASU and setting IPVs. The TestInterfaceClient is not thread-safe and so this class also ensures TestInterfaceClient methods are called on the correct thread. This class is shown again in <figref idrefs="f0003">figure 6</figref>.</entry></row><!-- EPO <DP n="12"> --><row><entry>PlotData</entry><entry>Contains the plot data for the test module. Please refer to section 7.1 below.</entry></row><row><entry>ModuleResults</entry><entry>Contains the module results.</entry></row><row><entry>ITestModuleFileHandler</entry><entry>Provides access to file handling facilities. At present, the interface is implemented by a class that writes to XML files.</entry></row><row><entry>ITestModuleGUIUpdater</entry><entry>Handles the interface to the GUI.</entry></row></tbody></tgroup></table></tables></p><p id="p0044" num="0044"><figref idrefs="f0004">Figure 7</figref> shows a more complete hierarchy from the ITestModule interface to the test modules themselves. Additional functionality is provided further down the hierarchy by the IPVPlotter and MovingProbeTestModule classes. The IPVPlotter contains methods that permit item part values to be plotted against each other. The MovingProbeTestModule class uses the BeamAcquisitionManager to provide a reference to the ScanningInterface and so contains methods for plotting beam profiles using the scanning equipment. It is envisaged, at a later date, that an additional class (ChamberArrayTestModule) will be used to provide common functionality for test modules that need to interface to the ion chamber array panel.</p><p id="p0045" num="0045">Each test module is implemented as a separate DLL that has the same name as the test that it represents; i.e. Outgas.dll contains the class Outgas and Achromaticity.dll contains the class Achromaticity. This method of implementation permits the main GUI to dynamically load in the module, cast it to an ITestModule type, and then use polymorphism to set the test parameters and run the required test. The loading of the test module occurs in frmMain::LoadTestModule:
<pre listing-type="program-listing"> //Get the class name for this module - this is the name without any spaces,
 hyphens, commas, etc:<!-- EPO <DP n="13"> -->
 string *strClassName = TestModuleNameResolver::ConvertToClassName(strModuleName);
 //Load the required module dll from the specified folder:
 Assembly * ad = Assemble::LoadFrom(String::Concat(m_strRoot Directory, S"\\Autotest
 Module dlls\\", strClassName, S".dll"));
 //Create an instance of the test module:
 m_pCurrentTestModule = _try_cast&lt;ITestModule*&gt; (ad-
 &gt;CreateInstance(String::Concat(S"NAComponents.", strClassName)));
 //Set the required parameters for the test module:
 m_pCurrentTestModule→InitialiseParameters(objParameters);
 //Run the actual test - this is a virtual function in the generic TestModule class,
 so that
 //the method will actually run in the derived class (which is the actual test
 module):
 m_pCurrentTestModule→RunTest();</pre></p><p id="p0046" num="0046">The virtual RunTest method in each test module starts the actual test in a separate thread. This presents a problem with regards to writing item part values via the TestInterfaceClient and updating the Autotest GUI. Updating the GUI should always occur on the UI thread, and the TestInterfaceClient::WriteIPV method can only be called on the same thread that instantiated the TestInterfaceClient. To resolve this, delegates are created that permit these methods to be invoked on the correct thread within the TestModuleLinacInterface and TestModuleGUIUpdater class.</p><heading id="h0019">6 TEST MODULE COMMUNICATION</heading><p id="p0047" num="0047">The TestModuleMessages library can be used to allow test modules to communicate with one another within a sequence. Inherently, all test modules are independent of each other and test modules within a test module sequence have no knowledge of each other. There are three main cases where components may need to exchange information:
<ul><li>An instance of a test module may need to communicate with an instance of a different test module further in the sequence.<!-- EPO <DP n="14"> --></li><li>One instance of a test module may need to communicate with another instance of the same test module further in the sequence.</li><li>A derived class of NewAutotestModuleForm for one test module may need to pass parameters to a different derived class of NewAutotestModuleForm for a different test module.</li></ul></p><heading id="h0020">6.1 Test Module Message Architecture</heading><p id="p0048" num="0048">The overall mechanism comprises of a table of messages that components can create for others to access. This functions in a similar manner to the pigeon holes at a hotel reception with components 'leaving' messages for other components to 'read'.</p><p id="p0049" num="0049">The main components are the TestModuleMessageTable and the TestModuleMessage classes. The TestModuleMessageTable class is used to house a table of messages where each message is stored as a TestModuleMessage for a particular recipient. This is shown conceptually in <figref idrefs="f0004">figure 8</figref>.</p><p id="p0050" num="0050">Each 'row' in the table can contain a string relating to the recipient name and energy level, along with an instance of a TestModuleMessage that contains the message code and any arguments required. This message is shown in <figref idrefs="f0004">figure 9</figref>.</p><p id="p0051" num="0051">The table can be populated by a component sending a TestModuleMessage to the table class along with the required message recipient. Other components can then interrogate the table to see if any messages are waiting for them. Messages can be sent to and retrieved from the table thus:
<pre listing-type="program-listing"> void TestModuleMessageTable::AddMessage(String* strRecipient, TestModuleMessage*
 pMessage);
 TestModuleMessage* TestModuleMessageTable::CheckMessages(String* strRecipient)
 _gc[];</pre></p><p id="p0052" num="0052">Internally, the data will be stored in a Hashtable with the Recipient string and its corresponding TestModuleMessage constituting each key-value pair.<!-- EPO <DP n="15"> --></p><heading id="h0021">6.2 Creating the Message Table</heading><p id="p0053" num="0053">The message table, if required, is created after the test module sequence has been defined by the user and just before the sequence is run. The test module table can then be created with the test sequence information. This allows test modules or their parameter forms to make decisions based on what else is about to be run in the sequence.</p><heading id="h0022">6.3 Accessing the Table</heading><p id="p0054" num="0054">In order for components to send or receive messages, they must be allowed access to the message table. It is proposed that a separate interface is created that allows an instance of the test module table to be set. Test modules (or other components) can then implement this interface so that the main Autotest form from the GUI can pass a table reference to them as shown in <figref idrefs="f0005">figure 10</figref>. The set_TestModuleTable property will be invoked by the main Autotest GUI form after the test module has been dynamically created and tested to see if it supports the ITestModuleMessenger interface.</p><p id="p0055" num="0055">Passing a TestModuleMessageTable reference to the required component allows that component to examine which test modules are set to run in the sequence. This gives a NewAutotestModuleForm the opportunity to remain hidden if a similar form is to be shown later on.</p><heading id="h0023">7 OTHER ANCILLARY COMPONENTS</heading><heading id="h0024">7.1 PlotData</heading><p id="p0056" num="0056">The PlotData.dll contains a set of classes designed to store and analysis all plot data. The PlotData class itself provides the lower level data manipulation and analysis such as:
<tables id="tabl0004" num="0004"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="34mm"/><colspec colnum="2" colname="col2" colwidth="132mm"/><thead><row><entry valign="top"><b>Function</b></entry><entry valign="top"><b>Purpose</b></entry></row></thead><tbody><row><entry>get_MinYValue</entry><entry>Returns the minimum Y value on found on the given plot.</entry></row><!-- EPO <DP n="16"> --><row><entry>FirstXValueAtYValue</entry><entry>Searches the plot for the required Y value, and returns the value of X where this Y value first occurred.</entry></row><row><entry>TiltBetweenPoints</entry><entry>Returns the maximum tilt between two points on a plot.</entry></row></tbody></tgroup></table></tables></p><p id="p0057" num="0057">Functions such as these can be used directly by the test modules, or by the DataAnlayser classes also found in this library (shown in <figref idrefs="f0005">figure 11</figref>). These classes provide an analysis of the plot data, including a pass / fail result for a required specification (at present Standard, USA or Dutch depending on the scan type). Both the DataAnalysis control and the XrayEnergyAndFlatness test module use the DataAnalyser classes to provide the analysis for individual and group plots.</p><heading id="h0025">7.2 FileManager</heading><p id="p0058" num="0058">As the name suggests, the FileManager.dll library contains the classes used for managing all data to and from file. The types of files used are:
<tables id="tabl0005" num="0005"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="19mm"/><colspec colnum="2" colname="col2" colwidth="147mm"/><thead><row><entry valign="top"><b>File Type</b></entry><entry valign="top"><b>Use</b></entry></row></thead><tbody><row><entry>*.XML</entry><entry>Used for the test module header files. Contains information such as:</entry></row><row><entry/><entry>• Module name</entry></row><row><entry/><entry>• Energy type and level that the module was run at</entry></row><row><entry/><entry>• Linear accelerator serial number</entry></row><row><entry/><entry>• The filenames of all plot data files associated with this module</entry></row><row><entry/><entry>• Module analysis as text.</entry></row><row><entry/><entry>• Linear accelerator item part values required for AutoAnalysis</entry></row><row><entry>*.DAT</entry><entry>Used to store the XY plot data for an individual plot. They also contain a small amount of header information regarding the type of plot that the data pertains to i.e.:</entry></row><row><entry/><entry>• Scan Type</entry></row><row><entry/><entry>• Energy type and level</entry></row><row><entry/><entry>• Date/time</entry></row><row><entry>*.INI</entry><entry>These are used by the test modules to contain some of the parameters required for the test. Each test module has its own respective *.INI file, some of which are updated as the test is run (i.e. Achromaticity).</entry></row><row><entry>*.LOG</entry><entry>All information written to the DataMonitor control gets automatically written to an event log. There is also an error log file for diagnostic purposes.</entry></row></tbody></tgroup></table></tables><!-- EPO <DP n="17"> --></p><p id="p0059" num="0059">The *.DAT files will only contain data for a single plot. When a user views a group of plot results from a test module, they are viewing the *.XML file, which in turn references the correct data files to load into the GUI. The header information in the data files is handled by the DataFileHeader classes ScanDataFileHeader and IVPlotDataFileHeader. The XY plot data, however, is loaded and saved directly into the PlotData class by the PlotData class itself.</p><heading id="h0026">8 OTHER USER CONTROLS</heading><p id="p0060" num="0060">To help maintain a modular design, the larger user interface controls seen within the GUI are implemented as discrete components residing in their own assemblies. Some of these are copies of existing applets within the linac software.</p><heading id="h0027">8.1 AutotestGraphicalDisplay</heading><p id="p0061" num="0061">This component is used to bridge the gap between the main graph and all other classes. It contains functions for displaying arrays of data as plots without classes having to interact with the concrete graph classes themselves. The graphical display is likely to change with future updates of Autotest which this class helps to facilitate.</p><heading id="h0028">8.2 NewAutotestForm</heading><p id="p0062" num="0062">All forms within the project inherit from the NewAutotestForm. This class restricts the forms movement and cursor movement on a closed system. In addition to this, the NewAutotestForm.dll contains the following classes:
<tables id="tabl0006" num="0006"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="41mm"/><colspec colnum="2" colname="col2" colwidth="125mm"/><thead><row><entry valign="top"><b>Class</b></entry><entry valign="top"><b>Purpose</b></entry></row></thead><tbody><row><entry>NewAutotestMessageBox</entry><entry>All message boxes implement this class which prevents the window from being moved off screen on the closed system.</entry></row><!-- EPO <DP n="18"> --><row><entry>NewAutotestModuleForm</entry><entry>Inherits from the NewAutotestForm class and provides virtual functions for setting the Energy Type and a reference to the TestInterfaceClient.</entry></row><row><entry>NewAutotestStatusBar</entry><entry>Along with the NewAutotestStatusBarPanel, this allows the main application to set the colour of panels in the status bar.</entry></row><row><entry>ProgressIndicatorHandler</entry><entry>By using the Progresslndicator class, the ProgressIndicatorHandler allows the test modules to display a progress indicator for when the linear accelerator is interrupted or waiting for dose recovery, etc. Although the progress indicator appears as a form, it is in fact a control that is attached to the main form. This is required due to restrictions imposed by the linac software WinMan component.</entry></row></tbody></tgroup></table></tables></p><heading id="h0029">8.3 DataAnalysis</heading><p id="p0063" num="0063">The DataAnalysis control uses a hierarchy of helper classes in order to analyse the data according to the criteria required. This is required as the analysis differs depending on the energy type and protocol selected (i.e USA Flatness, Dutch, etc). The component makes extensive use of the DataAnalyser set of classes described earlier. This is to maintain consistency between the analysis given by the GUI and that provided by the test modules.</p><heading id="h0030">8.4 DataMonitor</heading><p id="p0064" num="0064">This provides the user continual feedback regarding the state of the module currently being run and is updated by the test modules each time they write to the event log. In addition to this, the majority of test modules utilise this component to display item part values that are currently being altered by<!-- EPO <DP n="19"> --> the module. It also provides a read-only version of the Beam Monitor service page.</p><heading id="h0031">8.5 GraphLegends</heading><p id="p0065" num="0065">This is a simple component that handles the list of plots loaded into the GUI.</p><heading id="h0032">8.6 ItemPartTextBox</heading><p id="p0066" num="0066">Used by several other user interface components, the ItemPartTextBox control contains a reference to the TestInterfaceClient allowing it to handle the writing of item part values to the Linac. Within the designer, a user can set properties for the item number, item part, etc leaving the component to format the value. This formatting is also used (by the ServicePages for example) to format item part values read from the Linac via the TestInterfaceClient.</p><heading id="h0033">8.7 MenuExtender</heading><p id="p0067" num="0067">This implements the IExtenderInterface in order to add icons to menu items.</p><heading id="h0034">8.8 QuickBeam</heading><p id="p0068" num="0068">This is designed to act in a manner similar to the QuickBeam applet within the linac software, Both this component and the test modules need to load a beam via the TestInterfaceClient. However, the TestInterfaceClient does not provide a means of knowing which beam is currently loaded. To prevent the test modules reloading beams that are already loaded by this applet, an instance of the TestInterfaceClient is passed between the main GUI, QuickBeam and the test modules as they are run. The other components that reside on the main user interface create their own instance of the TestInterfaceClient.</p><heading id="h0035">8.9 ServiceFunctions</heading><p id="p0069" num="0069">Provides some of the service functions that are present within the current linac software.<!-- EPO <DP n="20"> --></p><heading id="h0036">8.10 ServicePages</heading><p id="p0070" num="0070">Provides some of the service pages that are present within the current linac software including the readback of the MLC. This component relies on a separate library of pages that reside in Pages.dll.</p><heading id="h0037">9 Tools</heading><p id="p0071" num="0071">The Autotest GUI has been developed to allow additional test tools to be loaded via the tools menu item. This process is described further in section 9.3.</p><heading id="h0038">9.1 AutoAnalysis</heading><p id="p0072" num="0072">AutoAnalysis allows the user to compare the linear accelerator settings of any previously saved results with the current linear accelerator settings so the user can assess whether the results are still valid. The back-end database contains three tables that are relevant to this tool:
<tables id="tabl0007" num="0007"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="46mm"/><colspec colnum="2" colname="col2" colwidth="120mm"/><thead><row><entry valign="top"><b>Table</b></entry><entry valign="top"><b>Purpose</b></entry></row></thead><tbody><row><entry>IPVs</entry><entry>Contains lists of all the item part values that need to be checked for each module at each energy level.</entry></row><row><entry>Test Modules (ELECTRONS)</entry><entry>Contains the module status and item part value check status for each electron test module. This also contains the filename of the module header file that was copied into the Autotest Final directory.</entry></row><row><entry>Test Modules (X_RAYS)</entry><entry>Contains the module status and item part value check status for each x-ray test module. This also contains the filename of the module header file that was copied into the Autotest Final directory.</entry></row></tbody></tgroup></table></tables><!-- EPO <DP n="21"> --></p><p id="p0073" num="0073">The check between module IPVs (Item Part Values) and values stored in the linear accelerator database is made each time AutoAnalysis is launched. The last two tables in the above list (Test Modules (ELECTRONS) and Test Modules (X_RAYS)) are updated as this occurs; the IPV_CHECK field is given a value relating to whether or not the IPV check has either passed or failed. As can be seen by examining the database tables, the actual item part values are not recorded in the database (they have already been stored - in the module header file and the calibration database). AutoAnalysis provides a 'live' update of the item part values based on the values stored in the database.</p><heading id="h0039">9.2 Backups</heading><p id="p0074" num="0074">The Backups add-on tool allows the files to be backed up across the network, the tool maps the network drives as it is launched using the NET.exe utility.</p><heading id="h0040">9.3 MachineConfiguration</heading><p id="p0075" num="0075">The MachineConfiguration add-on tool reads the linear accelerator license to determine the energy configuration of that particular linear accelerator and permits access to all relevant tests/modules or prevents access to invalid tests or modules. It also allows the user to select different analysis protocols.</p><p id="p0076" num="0076">However, unlike the AutoAnalysis tool, the MachineConfiguration utility needs to run each time the software loads on a closed system. To add a degree of flexibility regarding the initialisation of New Autotest, the main GUI contains code that permits additional code to be run when the application is launched. This is detailed further in section 9.2. With regards to the MachineConfiguration tool, the static method CheckMachineConfiguration checks the Linacs current license key and serial number so that it can re-configure the AutoAnalysis database should either of these two Change.</p><heading id="h0041">9.4 Matching</heading><p id="p0077" num="0077">The matching tool allows groups of plots to be matched and analysed. Each matching configuration is saved in a *.mcfg file which contains serialized<!-- EPO <DP n="22"> --> data in the form of an ArrayList. The ArrayList contains one MatchingManager class per matching group in addition to file location and energy information. The MatchingManager class contains a list of MatchedPlot classes that relay file information for each matched plot.</p><heading id="h0042">10 LAUNCHING NEW AUTOTEST</heading><p id="p0078" num="0078">New Autotest is always launched via an out of process component that can run an integrity check on files before the main executable is run. There are two launching utilities - one for launching New Autotest on a Closed System and one for launching New Autotest on a standalone PC. Both of these check each file required by Autotest to ensure that the current version of the software is valid.</p><p id="p0079" num="0079">Three criteria must be satisfied before the software can be launched:
<ul><li>That no additional files have been introduced into the New Autotest directories.</li><li>That files in the New Autotest directories are still valid (by verifying the file checksum using the CRCGenerator component).</li><li>That there are no files missing from the New Autotest directories.</li></ul></p><p id="p0080" num="0080">To accomplish this, two files reside in the New Autotest directory:
<tables id="tabl0008" num="0008"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="38mm"/><colspec colnum="2" colname="col2" colwidth="128mm"/><thead><row><entry valign="top"><b>File</b></entry><entry valign="top"><b>Purpose</b></entry></row></thead><tbody><row><entry>New Autotest CRCs.lst</entry><entry>Contains a list of filenames with their corresponding check sum values. Every file (not listed in Exempt Files.lst) must be present and pass the CRC (Cyclic Redundancy Check).</entry></row><row><entry>Exempt Files.lst</entry><entry>Contains a list of files that are exempt from CRC checking. These are files that are expected to change, such as database files and log files.</entry></row></tbody></tgroup></table></tables><!-- EPO <DP n="23"> --></p><p id="p0081" num="0081">The New Autotest CRCs.lst file will need to be updated each time a test module or add-on tool is added.</p><heading id="h0043">10.1 Launching New Autotest on a Closed System - NewAutotestLauncher</heading><p id="p0082" num="0082">When run on a closed system (such as a cabinet connected to a Linac), New Autotest is launched via the NewAutotestLauncher component that is loaded into the linac software. This component is installed via the New Autotest installation program (described in section 8) along with the additional icon on the linac toolbar.</p><p id="p0083" num="0083">Both the NewAutotestLauncher and CRCGenerator DLLs are compiled as public assemblies that reside in the Global Assembly Cache. This is a requirement from the linac software in order for the NewAutotestLauncher to be loaded.</p><heading id="h0044">10.2 Launching New Autotest on a Standalone PC - Autotest Viewer</heading><p id="p0084" num="0084">On a standalone PC, New Autotest is launched via the Autotest Viewer executable. When the New Autotest installation program is run (described in section 8) shortcuts are created that link directly to this application. The Autotest Viewer itself checks the integrity of all files required by New Autotest (in a manner identical to the NewAutotestLauncher component) and if the check passes, launches the main New Autotest program. If the integrity check fails, then a form is shown detailing the failures.</p><p id="p0085" num="0085">To prevent a user from running the Autotest executable directly (bypassing the integrity check) a flag is set in the system registry by the launcher if the CRC check was successful. New Autotest checks this flag before the call to the main windows constructor. The flag is also reset at this point ready for the next launch.<!-- EPO <DP n="24"> --></p><heading id="h0045">11 NEW AUTOTEST EXTENSIBILITY</heading><p id="p0086" num="0086">The New Autotest application has been designed so that it can be extended without re-compiling core components. This applies to three main areas: the Test Modules (described in section 4.3), initialisation code and the add-on tools (section 6).</p><p id="p0087" num="0087">Provisional work has also been done to allow the interface to the scanning hardware to be changed (and hence the scanning hardware itself), which was detailed in sections 4.1 and 4.2. In fact, provided the public interfaces do not change, any component in any private assembly can be updated without the need for re-compiling the main software.</p><p id="p0088" num="0088">The IPVs table in the AutoAnalysis database can be updated at any time to instruct a test module to save additional item part values at the end of a test. By setting the Analyse field to Yes, this will also instruct AutoAnalysis to check the item part value with that residing in the database.</p><heading id="h0046">11.2 Adding Initialisation Code</heading><p id="p0089" num="0089">The New Autotest software allows additional code to be run as initialisation code. The method frmMain::RunInitialisationCode within the New Autotest GUI opens the file Initialisation Code.lst that contains details of any static methods in assemblies that should be run as the application starts up. Further initialisation code can be run by adding a static public method to any class in any library.</p><heading id="h0047">11.3 Add-on Tools</heading><p id="p0090" num="0090">Additional tools can be launched by the New Autotest GUI via its tools menu item. To add a tool, the component must provide a class that inherits from the abstract AddonTool class. Once compiled, place the tool in the Autotest Tools directory so that it can be attached to the tools menu.</p><heading id="h0048">12 VERSION CONTROL</heading><!-- EPO <DP n="25"> --><p id="p0091" num="0091">As detailed in section 9, New Autotest has been designed with expansion in mind: the main GUI loads each test module in dynamically and not only has no knowledge of which file versions should be run, but also has no knowledge of how many tests there are. To ensure that only the correct tests are run, all required files are integrity checked before the software is launched using the CRC file (launching is described in section 7).</p><p id="p0092" num="0092">The CRC file contains a serialised Hashtable that contains filename-checksum pairs for each file that needs to be checked. In addition to this, when the CRC file is generated (using the Factory Project Builder tool described in section 11.1) the first few entries of the hashtable a filled with special values. These are:
<ul><li>The date the CRC file was generated.</li><li>A build number to accompany the CRC file.</li><li>The part number for the Autotest software.</li></ul></p><p id="p0093" num="0093">Thus, all files required by New Autotest are tied to a build number embedded into the CRC file: adding or replacing files in the New Autotest directories will prevent the main application from being be launched unless accompanied by an updated CRC file.</p><heading id="h0049">13 DEVELOPMENT TOOLS</heading><p id="p0094" num="0094">A small number of additional tools have been created in order to develop the Autotest project.</p><heading id="h0050">13.1 Factory Project Builder</heading><p id="p0095" num="0095">This utility ensures that the project is built according to the Software Configuration Management plan for New Autotest</p><heading id="h0051">13.2 FileVersionUpdater</heading><!-- EPO <DP n="26"> --><p id="p0096" num="0096">This is a command line utility that is added as a pre-build event to every project. It is used to update the FILEVERSION resource in the project so that the file version number appears when viewing the file in windows Explorer. This file version attribute is also utilised by the NewAutotestLauncher component to display the versions of files within the New Autotest directories.</p><p id="p0097" num="0097">The tool is required as all components (except the NewAutotestLauncher and CRCGenerator) are compiled as private assemblies and as such, are not strongly named.</p><heading id="h0052">14 TEST PROCESS</heading><p id="p0098" num="0098">A standard QA check of the full therapeutic linac consists of a beam check followed by a check of the MLC (multi-leaf collimator) used to shape the beam to a desired profile.</p><heading id="h0053">14.1 Beam Test</heading><p id="p0099" num="0099">The beam test allows for the fact that the linac may be capable of a number of preset energy levels. The changes necessary to produce a beam of a different energy can effect the beam properties and therefore checks are carried out in sequence on each energy.</p><p id="p0100" num="0100">Thus, a first energy is selected and the beam established. Details are obtained of the beam energy, the beam flatness, and the absolute dose. These are compared to a retained set of properties, which can be a known gold standard or a target standard which it is desired that the linac should replicate. Where discrepancies are found, these are corrected in order to return the linac to the chosen standard. The adjustments necessary to achieve this are then recorded, and the previous settings re-instated so that (by default) patients arriving for treatment after the recalibration receive the expected dose. These adjustments are however reported to an operator so that a decision can be made as to whether the adjustments should be made permanent or discarded.</p><p id="p0101" num="0101">This is then repeated for each beam energy. Once all are done, the results are checked to confirm that the divergence was within a permitted<!-- EPO <DP n="27"> --> tolerance; if not then the linac is disabled and an alert is sent to the operator. If all is well then the MLC test is begun.</p><p id="p0102" num="0102">The record of necessary adjustments can be used for diagnostic purposes. Where these exceed a threshold then, obviously, a warning needs to be issued and the linear accelerator disabled. However, if a lower threshold is exceeded a note could be sent to a remote operator such as a service engineer or the manufacturer. This information could be used to schedule other maintenance work for a convenient time and/or to provide advance warning of forthcoming issues.</p><heading id="h0054">14.2 MLC Test</heading><p id="p0103" num="0103">This involves variation of the leaf positions according to a preset prescription and observation of the effect of this on the measured beam.</p><heading id="h0055">15 APPENDIX</heading><heading id="h0056">15.1 Databases</heading><p id="p0104" num="0104">The New Autotest application uses a number of databases. Some of these databases relate to individual test modules - they will not be described here.
<tables id="tabl0009" num="0009"><table frame="all"><tgroup cols="3"><colspec colnum="1" colname="col1" colwidth="31mm"/><colspec colnum="2" colname="col2" colwidth="103mm"/><colspec colnum="3" colname="col3" colwidth="33mm"/><thead><row><entry valign="top"><b>Database</b></entry><entry valign="top"><b>Purpose</b></entry><entry valign="top"><b>Integrity Checked</b></entry></row></thead><tbody><row><entry>AutoAnalysis.mdb</entry><entry>Described in section 6.1.</entry><entry>No</entry></row><row><entry>EnergyTables.mdb</entry><entry>Contains the electron depth dose conversion tables, the default energy reference depth tables and the default test module tables.</entry><entry>Yes</entry></row><row><entry>IonChambers.mdb</entry><entry>Used by the Manual Scanning Control for the Buddelship to store the calibration factor for different Ion chambers.</entry><entry>No</entry></row><!-- EPO <DP n="28"> --><row><entry>LeafShapes.mdb</entry><entry>Contains the leaf and diaphragm positions for MLC shapes required by New Autotest.</entry><entry>Yes</entry></row></tbody></tgroup></table></tables></p><p id="p0105" num="0105">An additional database is used by Wellhoffer's OP-Industrial software. On a Closed System, the user will not have direct access to OP-Industrial, and so the database is modified by the ServoClient component. Although installed by Wellhoffer's installation program, this database, Platform.mdb, is replaced by a pre-configured version when New Autotest is installed.</p><p id="p0106" num="0106">It will of course be understood that many variations may be made to the above-described embodiment without departing from the scope of the present invention, defined by the appended claims.</p></description><claims mxw-id="PCLM56985944" lang="DE" load-source="patent-office"><!-- EPO <DP n="31"> --><claim id="c-de-01-0001" num="0001"><claim-text>Verfahren zur Qualitätssicherung eines Linearbeschleunigers für Strahlentherapie, um den durch den Linearbeschleuniger erzeugten Bestrahlungsstrahl zu kalibrieren, wobei der Beschleuniger eine Strahlführungsschaltungsanordnung für den Beschleuniger, eine für die Führungsschaltungsanordnung vorgesehene elektronische Vorrichtung, die zum Einstellen von Betriebsparametern davon angeordnet ist, und einen Monitor zur Erfassung von Eigenschaften des durch den Beschleuniger erzeugten Strahls umfasst, wobei die Führungsschaltungsanordnung daran angepasst ist, einen Satz von Normstrahleigenschaften beizubehalten, wobei das Verfahren die Schritte umfasst zum periodischen:
<claim-text>a) Anordnen des Monitors im Weg des Bestrahlungsstrahls;</claim-text>
<claim-text>b) Aktivieren des Beschleunigers;</claim-text>
<claim-text>c) Messen der aktuellen Strahleigenschaften über den Monitor;</claim-text>
<claim-text>d) Vergleichen der gemessenen Strahleigenschaften mit dem beibehaltenen Satz von Normstrahleigenschaften und</claim-text>
<claim-text>e) Einstellen der Betriebsparameter des Linearbeschleunigers, um die Strahleigenschaften an die Normstrahleigenschaften anzugleichen,<br/>
<b>dadurch gekennzeichnet, dass</b> die Schritte a) bis e) vor einer strahlentherapeutischen Behandlung eines Patienten durchgeführt werden und dass die Normstrahleigenschaften zur Mitte der in der Norm dargelegten erlaubten Bereiche hin angeordnet werden.</claim-text></claim-text></claim><claim id="c-de-01-0002" num="0002"><claim-text>Verfahren nach Anspruch 1, wobei die Schritte (a) bis (e) nach einem Zeitraum normalen Betriebs durchgeführt werden.</claim-text></claim><claim id="c-de-01-0003" num="0003"><claim-text>Verfahren nach Anspruch 2, wobei den Schritten (a) bis (e) ein weiterer Zeitraum normalen Betriebs folgt, nach welchem die Schritte (a) bis (e) wiederholt werden.<!-- EPO <DP n="32"> --></claim-text></claim><claim id="c-de-01-0004" num="0004"><claim-text>Verfahren nach irgendeinem vorangehenden Anspruch, ferner umfassend vor Schritt (e) das Aufzeichnen der Einstellungen der Führungsschaltungsanordnung und nach Schritt (e) das Zurückbringen der Eigenschaften der Führungsschaltungsanordnung zu dem aufgezeichneten Zustand.</claim-text></claim><claim id="c-de-01-0005" num="0005"><claim-text>Verfahren nach irgendeinem vorangehenden Anspruch, ferner umfassend das Senden einer Nachricht, wenn die Differenz zwischen den gemessenen Strahleigenschaften und den Normstrahleigenschaften einen ersten Schwellwert überschreitet.</claim-text></claim><claim id="c-de-01-0006" num="0006"><claim-text>Verfahren nach Anspruch 5, ferner umfassend das Senden einer Nachricht an einen entfernten Ort, wenn die Differenz zwischen den gemessenen Strahleigenschaften und den beibehaltenen Strahleigenschaften einen zweiten Schwellwert, der höhere Anforderungen als der erste Schwellwert stellt, überschreitet.</claim-text></claim><claim id="c-de-01-0007" num="0007"><claim-text>Verfahren nach irgendeinem vorangehenden Anspruch, durchgeführt während Werksprüfungen des Linearbeschleunigers.</claim-text></claim><claim id="c-de-01-0008" num="0008"><claim-text>Verfahren nach irgendeinem vorangehenden Anspruch, wobei die Strahleigenschaften mindestens eine von der Strahlflachheit, Strahlbreite, Strahlenergie und Absolutdosis umfassen.</claim-text></claim><claim id="c-de-01-0009" num="0009"><claim-text>Verfahren nach irgendeinem vorangehenden Anspruch, wobei die Schritte b) bis e) der Reihe nach auf jedem einer Anzahl vorher eingestellter Energieniveaus, welche der Linearbeschleuniger zu erzeugen in der Lage ist, durchgeführt werden.</claim-text></claim><claim id="c-de-01-0010" num="0010"><claim-text>Strahlentherapievorrichtung, konfiguriert für die Durchführung des Verfahrens nach irgendeinem vorangehenden Anspruch, umfassend die<!-- EPO <DP n="33"> --> Führungsschaltungsanordnung, die daran angepasst ist, die Betriebsparameter des Linearbeschleunigers automatisch einzustellen.</claim-text></claim></claims><claims mxw-id="PCLM56985945" lang="EN" load-source="patent-office"><!-- EPO <DP n="29"> --><claim id="c-en-01-0001" num="0001"><claim-text>A method of quality assurance of a linear accelerator for radiotherapy, so as to calibrate the radiation beam produced by the linear accelerator, the accelerator comprising beam control circuitry for the accelerator, an electronic apparatus for the control circuitry arranged to adjust operating parameters thereof, and a monitor for detecting properties of the beam produced by the accelerator, wherein the control apparatus is adapted to retain a set of standard beam properties, the method comprising the steps of periodically:
<claim-text>a) locating the monitor in the path of the radiation beam;</claim-text>
<claim-text>b) activating the accelerator;</claim-text>
<claim-text>c) measuring the current beam properties via the monitor;</claim-text>
<claim-text>d) comparing the measured beam properties to the retained set of standard beam properties, and</claim-text>
<claim-text>e) adjusting the operating parameters of the linear accelerator to align the beam properties towards the standard beam properties,<br/>
<b>characterised in that</b> steps a) to e) are carried out prior to radiotherapeutic treatment of a patient, and <b>in that</b> the standard beam properties are towards the centre of the permitted ranges set out in the standard.</claim-text></claim-text></claim><claim id="c-en-01-0002" num="0002"><claim-text>A method according to Claim 1 in which steps (a) to (e) are taken after a period of normal operation.</claim-text></claim><claim id="c-en-01-0003" num="0003"><claim-text>A method according to Claim 2 in which steps (a) to (e) are followed by a further period of normal operation, after which steps (a) to (e) are repeated.<!-- EPO <DP n="30"> --></claim-text></claim><claim id="c-en-01-0004" num="0004"><claim-text>A method according to any preceding claim further comprising, prior to step (e), recording the settings of the control circuitry and, after step (e), returning the control circuitry settings to the recorded state.</claim-text></claim><claim id="c-en-01-0005" num="0005"><claim-text>A method according to any preceding claim further comprising sending a message if the difference between the measured beam properties and the standard beam properties exceeds a first threshold.</claim-text></claim><claim id="c-en-01-0006" num="0006"><claim-text>A method according to Claim 5 further comprising sending a message to a remote location if the difference between the measured beam properties and the retained beam properties exceeds a second threshold that is more demanding than the first threshold.</claim-text></claim><claim id="c-en-01-0007" num="0007"><claim-text>A method according to any preceding claim carried out during factory testing of the linear accelerator.</claim-text></claim><claim id="c-en-01-0008" num="0008"><claim-text>A method according to any preceding claim in which the beam properties include at least one of beam flatness, beam width, beam energy and absolute dose.</claim-text></claim><claim id="c-en-01-0009" num="0009"><claim-text>A method according to any preceding claim in which steps b) to e) are carried out in sequence on each of a number of preset energy levels of which the linear accelerator is capable of producing.</claim-text></claim><claim id="c-en-01-0010" num="0010"><claim-text>A radiotherapy apparatus configured to carry out the method according to any preceding claim, comprising said control circuitry adapted to automatically adjust the operating parameters of the linear accelerator.</claim-text></claim></claims><claims mxw-id="PCLM56985946" lang="FR" load-source="patent-office"><!-- EPO <DP n="34"> --><claim id="c-fr-01-0001" num="0001"><claim-text>Procédé de contrôle de qualité d'un accélérateur linéaire pour radiothérapie, de manière à calibrer le faisceau de radiation produit par l'accélérateur linéaire, l'accélérateur comportant un circuit de commande de faisceau pour l'accélérateur, un appareil électronique pour le circuit de commande servant à ajuster des paramètres de fonctionnement de celui-ci, et un dispositif de surveillance pour détecter des propriétés du faisceau produit par l'accélérateur,<br/>
dans lequel le circuit de commande est adapté pour retenir un ensemble de propriétés de faisceau standard, le procédé comportant les mesures périodiques de :
<claim-text>a) localisation du dispositif de surveillance sur la trajectoire du faisceau de radiation ;</claim-text>
<claim-text>b) activation de l'accélérateur ;</claim-text>
<claim-text>c) mesure des propriétés de faisceau courantes, par l'intermédiaire du dispositif de surveillance ;</claim-text>
<claim-text>d) comparaison des propriétés de faisceau mesurées avec l'ensemble des propriétés de faisceau standard retenu, et</claim-text>
<claim-text>e) ajustement des paramètres de fonctionnement de l'accélérateur linéaire pour aligner les propriétés de faisceau sur les propriétés de faisceau standard,</claim-text>
<b>caractérisé par le fait que</b> les étapes a) à e) sont mises en oeuvre avant le traitement radiothérapeutique d'un patient, et que les propriétés de faisceau standard sont proches du milieu des plages permises exposées dans la norme.</claim-text></claim><claim id="c-fr-01-0002" num="0002"><claim-text>Procédé selon la revendication 1, dans lequel les mesures (a) à (e) sont prises après une période de fonctionnement normal.<!-- EPO <DP n="35"> --></claim-text></claim><claim id="c-fr-01-0003" num="0003"><claim-text>Procédé selon la revendication 2, dans lequel les mesures (a) à (e) sont suivies d'une autre période de fonctionnement normal, après laquelle les mesures (a) à (e) sont répétées.</claim-text></claim><claim id="c-fr-01-0004" num="0004"><claim-text>Procédé selon l'une quelconque des revendications précédentes, comportant en outre, avant la mesure (e), l'enregistrement des réglages du circuit de commande et, après la mesure (e), la réinitialisation des réglages du circuit de commande à l'état enregistré.</claim-text></claim><claim id="c-fr-01-0005" num="0005"><claim-text>Procédé selon l'une quelconque des revendications précédentes, comportant en outre l'envoi d'un message si la différence entre les propriétés de faisceau mesurées et les propriétés de faisceau standard dépasse un premier seuil.</claim-text></claim><claim id="c-fr-01-0006" num="0006"><claim-text>Procédé selon la revendication 5, comportant en outre l'envoi d'un message à un emplacement à distance si la différence entre les propriétés de faisceau mesurées et les propriétés de faisceau retenues dépasse un second seuil plus exigeant que le premier seuil.</claim-text></claim><claim id="c-fr-01-0007" num="0007"><claim-text>Procédé selon l'une quelconque des revendications précédentes, mis en oeuvre pendant l'essai en usine de l'accélérateur linéaire.</claim-text></claim><claim id="c-fr-01-0008" num="0008"><claim-text>Procédé selon l'une quelconque des revendications précédentes, dans lequel les propriétés du faisceau comprennent au moins une propriété parmi l'homogénéité de faisceau, la largeur de faisceau, l'énergie de faisceau et la dose absolue.</claim-text></claim><claim id="c-fr-01-0009" num="0009"><claim-text>Procédé selon l'une quelconque des revendications précédentes, dans lequel les mesures b) à e) sont mises en oeuvre l'une après l'autre sur chacun d'un nombre de niveaux d'énergie prédéfinis sur lesquels l'accélérateur linéaire est apte à produire.<!-- EPO <DP n="36"> --></claim-text></claim><claim id="c-fr-01-0010" num="0010"><claim-text>Appareil de radiothérapie configuré pour mettre en oeuvre le procédé selon l'une quelconque des revendications précédentes, comportant ledit circuit de commande adapté pour ajuster automatiquement les paramètres de fonctionnement de l'accélérateur linéaire.</claim-text></claim></claims><drawings mxw-id="PDW16672310" load-source="patent-office"><!-- EPO <DP n="37"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="186" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="38"> --><figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="165" he="163" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="39"> --><figure id="f0003" num="5,6"><img id="if0003" file="imgf0003.tif" wi="165" he="180" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="40"> --><figure id="f0004" num="7,8,9"><img id="if0004" file="imgf0004.tif" wi="165" he="192" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="41"> --><figure id="f0005" num="10,11"><img id="if0005" file="imgf0005.tif" wi="165" he="171" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="42"> --><figure id="f0006" num="12"><img id="if0006" file="imgf0006.tif" wi="155" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="43"> --><figure id="f0007" num="13"><img id="if0007" file="imgf0007.tif" wi="141" he="212" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
