<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2192545-B1" country="EP" doc-number="2192545" kind="B1" date="20140108" family-id="40467182" file-reference-id="297580" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146588220" ucid="EP-2192545-B1"><document-id><country>EP</country><doc-number>2192545</doc-number><kind>B1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-08170064-A" is-representative="YES"><document-id mxw-id="PAPP154850412" load-source="docdb" format="epo"><country>EP</country><doc-number>08170064</doc-number><kind>A</kind><date>20081127</date><lang>EN</lang></document-id><document-id mxw-id="PAPP220280968" load-source="docdb" format="original"><country>EP</country><doc-number>08170064.3</doc-number><date>20081127</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140555626" ucid="EP-08170064-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>08170064</doc-number><kind>A</kind><date>20081127</date></document-id></priority-claim></priority-claims><dates-of-public-availability><intention-to-grant-date><date>20131016</date></intention-to-grant-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989324994" load-source="docdb">G06T   5/00        20060101AFI20090422BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2102655051" load-source="docdb" scheme="CPC">G06F   3/04847     20130101 LA20150127BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2123423364" load-source="docdb" scheme="CPC">G06T2207/20016     20130101 LA20141220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2123428895" load-source="docdb" scheme="CPC">G06T2207/10116     20130101 LA20141220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2123431089" load-source="docdb" scheme="CPC">G06T2207/30004     20130101 LA20141220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2123433956" load-source="docdb" scheme="CPC">G06T2200/24        20130101 LA20141220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2125199045" load-source="docdb" scheme="CPC">G06T   5/009       20130101 FI20141217BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132369293" lang="DE" load-source="patent-office">Verfahren zum Wechsel von mindestens der Dichte oder dem Kontrast eines Bildes</invention-title><invention-title mxw-id="PT132369294" lang="EN" load-source="patent-office">Method of changing at least one of density and contrast of an image</invention-title><invention-title mxw-id="PT132369295" lang="FR" load-source="patent-office">Procédé de changement d'au moins la densité et contraste d'une image</invention-title><citations><non-patent-citations><nplcit><text>ANONYMOUS: "Window leveling: Changing brightness and contrast", 2007, Retrieved from the Internet &lt;URL:http://impax.ucsd.edu/client/en/default.htm#topics/8519.html&gt; [retrieved on 20121108]</text><sources><source mxw-id="PNPL67063228" load-source="docdb" name="EXA"/></sources></nplcit><nplcit><text>STEVE EDDINS: "All about pixel colors: Window-level and CLim", 17 February 2006 (2006-02-17), Retrieved from the Internet &lt;URL:http://blogs.mathworks.com/steve/2006/02/17/all-about-pixel-colors-window-level/&gt; [retrieved on 20121108]</text><sources><source mxw-id="PNPL67063229" load-source="docdb" name="EXA"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR919541611" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>AGFA HEALTHCARE</last-name><address><country>BE</country></address></addressbook></applicant><applicant mxw-id="PPAR919527290" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>AGFA HEALTHCARE</last-name></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919524293" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>BERTENS TOM</last-name><address><country>BE</country></address></addressbook></inventor><inventor mxw-id="PPAR919506296" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>BERTENS, TOM</last-name></addressbook></inventor><inventor mxw-id="PPAR919022096" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>BERTENS, TOM</last-name><address><street>Agfa HealthCare NV IP Dept. 3802 Septestraat 27</street><city>2640 Mortsel</city><country>BE</country></address></addressbook></inventor><inventor mxw-id="PPAR919531861" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>VUYLSTEKE PIET</last-name><address><country>BE</country></address></addressbook></inventor><inventor mxw-id="PPAR919538903" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>VUYLSTEKE, PIET</last-name></addressbook></inventor><inventor mxw-id="PPAR919022095" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>VUYLSTEKE, PIET</last-name><address><street>Agfa HealthCare NV IP Dept. 3802 Septestraat 27</street><city>2640 Mortsel</city><country>BE</country></address></addressbook></inventor></inventors><assignees><assignee mxw-id="PPAR919022097" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Agfa Healthcare</last-name><iid>100990648</iid><address><street>Septestraat 27</street><city>2640 Mortsel</city><country>BE</country></address></addressbook></assignee></assignees></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549800088" load-source="docdb">BE</country><country mxw-id="DS549890537" load-source="docdb">DE</country><country mxw-id="DS549875917" load-source="docdb">FR</country><country mxw-id="DS549890538" load-source="docdb">GB</country><country mxw-id="DS549800101" load-source="docdb">NL</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><description mxw-id="PDES63960646" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">FIELD OF THE INVENTION</heading><p id="p0001" num="0001">The present invention relates a method for modifying at least one of contrast and density of an image.</p><heading id="h0002">BACKGROUND OF THE INVENTION</heading><p id="p0002" num="0002">In a typical medical workstation the appearance of a displayed image can be adjusted by selecting a relevant subrange of the image's grey value pixel data and converting the data in this subrange according to a specific gradation function.</p><p id="p0003" num="0003">An interactive method to adjust manually the width and the position of the selected subrange is commonly known as window width/level adjustment.</p><p id="p0004" num="0004">Such a transformation of grey value pixel data is mainly used to increase the contrast in some regions of the image or in a selected subrange of the grey value pixel data. The price to be paid is decreased contrast in other parts of the image and other ranges of the grey value pixel data.</p><p id="p0005" num="0005">The density of pixels and image regions is determined by the corresponding ordinate value of the gradation function. The contrast amplification of pixels and image regions on the other hand, is determined by the corresponding derivative value (i.e. the gradient) of the gradation function. As a consequence, if the shape of the gradation function is adjusted to accommodate a large subrange of grey values within a specified density interval, i.e. if the interval has to cope with wide latitude, then at the same time the contrast in that density interval will drop. On the other hand, if a density interval is assigned to only a narrow grey value subrange, then that interval will provide enhanced contrast.</p><p id="p0006" num="0006">If requirements with respect to density and contrast amplification are conflicting, which is often the case, then a compromise is unavoidable.<!-- EPO <DP n="2"> --></p><p id="p0007" num="0007">In the context of the present invention the term 'first enhancement method' will be used to refer to these kinds of methods and more specifically to the window width/level method. One of the advantages of the first enhancement method is the possibility to select a subrange of pixel values to be enhanced. The disadvantage is the dependency between density and contrast adjustment.</p><p id="p0008" num="0008">In order to convert the digital image information optimally into a visible image on which the diagnosis is performed, a multi-scale image processing method (also called multiresolution image processing method) has been developed by means of which the density and contrast of an image can be modified. More specifically the density and contrast can be modified independently. In the context of this invention the term 'independently' relates to processing methods in which modification of contrast does not have substantial influence on the density levels in the image and wherein modification of the density does not substantially influence the contrast in the image.</p><p id="p0009" num="0009">The above mentioned image processing method and user interface pertaining to such a method has been described extensively in patent <patcit id="pcit0001" dnum="US7298383B"><text>US 7,298,383</text></patcit>, the processing being referred as multi-scale gradation processing.</p><p id="p0010" num="0010">In the context of the present invention the term 'second enhancement method' refers to multi-scale gradation processing methods.</p><p id="p0011" num="0011">One of the advantages of the second enhancement method is the possibility to independently adjust the density and contrast of a displayed image. However, this method is not suited to accurately select a subrange of pixel values to be enhanced.</p><p id="p0012" num="0012">In a specific embodiment of patent <patcit id="pcit0002" dnum="US7298383B"><text>US 7,298,383</text></patcit>, the modification is a global modification, i.e. the change of contrast and density is applied to substantially all pixels of the displayed image.<!-- EPO <DP n="3"> --></p><p id="p0013" num="0013">It is an aspect of the present invention to provide a method which has the advantages of both methods.</p><heading id="h0003">SUMMARY OF THE INVENTION</heading><p id="p0014" num="0014">The above-mentioned aspects are realized by a method having the specific features set out in claim 1.</p><p id="p0015" num="0015">The method of the present invention can be implemented as a user interface on a display station, the user interface enabling to steer the amount of enhancement obtained according to the method of the present invention by moving at least one indicium (occasionally on the display screen).</p><p id="p0016" num="0016">Specific features for preferred embodiments of the invention are set out in the dependent claims.</p><p id="p0017" num="0017">In the context of the present invention the term 'modification' refers to density and/or contrast modification.</p><p id="p0018" num="0018">In the context of the present invention the term 'indicium' refers to a marker movable by means of a cursor, joy stick, button, mouse<!-- EPO <DP n="4"> --> click, movement of arrows on a keyboard, speech or the like by means of which the user can indicate an amount of movement which, in accordance with the present invention, corresponds with an amount of contrast and density change of the displayed image resulting from either of the enhancement methods.</p><p id="p0019" num="0019">The indicium can be displayed but does not need to be displayed.</p><p id="p0020" num="0020">The method of the present invention is applicable to images that have been subjected to multi-scale gradation processing as is described further on in this text. However, the method is also applicable to other implementations of contrast rendition whereby contrast amplification and density can be specified independently.</p><p id="p0021" num="0021">The methods in accordance with the present invention are applicable to any kind of monochrome digital images as well as to colour images. To this end, the colour images comprising three components for each pixel, commonly representing the red, green and blue channel inputs of video equipment (RGB), are preferably converted into a standard colour space that represents hue, saturation and luminance (HSL). If an image is represented in this colour space, then the methods in accordance with the present invention are preferably applied to the luminance component only, as if it were a monochrome image. If only this channel is affected, then the contrast and density can be adjusted without introducing colour distortions.</p><p id="p0022" num="0022">The method of the present invention are suited for modifying the contrast and density of any kind of (monochrome and color) images obtained from a wide variety of acquisition devices in a wide variety of fields of applications wherein interactive modifications of density and/or contrast can be performed.</p><p id="p0023" num="0023">The method has been developed for application to medical images such as digital medical images obtained by means of computed or direct radiography.</p><p id="p0024" num="0024">However, examples of other applications than medical imaging in<!-- EPO <DP n="5"> --> which the method and user interface can be applied are the following (non exhaustive): modification of images obtained by scanning systems and digital cameras in the field of photofinishing, in aerial photography, prepress, application to video images e.g. for image restoration, digital film paste up on computer etc. The invention is not limited to the enumerated acquisition methods and enumerated fields of application.</p><p id="p0025" num="0025">The method of the present invention is generally implemented in the form of a computer program product adapted to carry out the method steps of the present invention when run on a computer. The computer program product is commonly stored in a computer readable carrier medium such as a CD-ROM. Alternatively the computer program product takes the form of an electric signal and can be communicated to a user through electronic communication.</p><heading id="h0004">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p0026" num="0026"><ul><li><figref idrefs="f0001">Fig. 1</figref> shows a first example of a display window and interactive user controls for the adjustment of density and contrast,</li><li><figref idrefs="f0002">Fig. 2</figref> illustrates a second example of a display window and interactive user controls for the adjustment of density and contrast,</li><li><figref idrefs="f0003">Fig. 3</figref> illustrates a decomposition of the user input for change of contrast and density into an amount for changing contrast and density by the first enhancement method and an amount for changing contrast and density by the second enhancement method, according to the embodiment,</li><li><figref idrefs="f0004">Fig. 4</figref> illustrates a decomposition of the user input for change of contrast and density into an amount for changing contrast and density by the first enhancement method and an amount for changing contrast and density by the second enhancement method, according to the embodiment,</li><li><figref idrefs="f0005">Fig. 5</figref> illustrates the computation of the target window width/level<!-- EPO <DP n="6"> --> setting based on the grey value distribution of the pixels of interest within a processed image.</li></ul></p><heading id="h0005">DETAILED DESCRIPTION OF THE INVENTION</heading><p id="p0027" num="0027">According to the present invention two enhancement methods are used to modify contrast and/or density of an image that is e.g. displayed on a monitor.</p><p id="p0028" num="0028">A first enhancement method is used for changing the contrast and/or density of a displayed image by modifying the window width/level settings of the image.</p><p id="p0029" num="0029">A second enhancement method is used for changing the contrast and/or density independently by modifying the multi-scale representation of the image. The modification is derived from at least two gradient functions determined at different scales whereby a gradient function at a specific scale specifies how contrast amplification at that scale depends on density. This method is known as multi-scale gradation processing. This type of enhancement methods is described extensively in <patcit id="pcit0003" dnum="US7298383B"><text>US patent 7,298,383</text></patcit>.</p><p id="p0030" num="0030">In a first processing step the raw digital image is decomposed into at least two detail images at successive scales and occasionally a residual image (further referred to as multi-scale representation), according to a multi-scale transform. The components of the multi-scale representation are referred to as detail images. The pixel values of the multi-scale representation correspond with the contrast of elementary image components, relative to their close neighbourhood.</p><p id="p0031" num="0031">Next the processed multi-scale representation is subjected to a reconstruction step by applying the inverse of the decomposition transform to the modified detail images.</p><p id="p0032" num="0032">In the course of reconstruction, a series of scale-specific<!-- EPO <DP n="7"> --> conversion functions are consecutively applied to the partially reconstructed image, in order to adjust contrast amplification as a function of both grey value and scale. The thus obtained pixel values are the driving values for the hard- or softcopy reproducing device, further on referred to as density values.</p><p id="p0033" num="0033">At each stage in the reconstruction process where a conversion function is inserted, the latter is applied to the approximation image at a scale corresponding to the current iteration, and the result of conversion is used as the input image of the next iteration, as described below.</p><p id="p0034" num="0034">For example in case of a multi-scale gradation embodiment according to the Burt pyramid transform, the normal inverse transform is modified as follows.</p><p id="p0035" num="0035">From the iteration that corresponds with the scale k = L until the smallest scale k = 0, the computed approximation image <i>v<sub>k</sub></i> is pixelwise converted by a scale-specific conversion function <i>f<sub>k</sub></i>() before it is passed to the next iteration.</p><p id="p0036" num="0036">By an appropriate choice of the series of conversion functions <i>f<sub>k</sub></i>() it is possible to specify the contrast amplification as a function of grey value and scale, and to specify grey value-to-density mapping independently from contrast amplification.</p><p id="p0037" num="0037">To this end, the scale-specific conversion functions <i>f<sub>k</sub></i>() are determined as will be described below, starting from a series of functions <i>gm<sub>k</sub></i>(), referred to as scale-specific gradient functions. For a specific scale k, the corresponding scale-specific gradient function <i>gm<sub>k</sub></i>() specifies the amount of contrast amplification at that scale. Equivalently, the scale-specific gradient function at scale <i>k</i> specifies how much a small pixel value difference (i.e. scale-specific contrast) at that scale is amplified by the combined<!-- EPO <DP n="8"> --> effect of all concatenated conversion functions <i>f<sub>k</sub></i>() up to the smallest scale <i>k</i> = 0.</p><p id="p0038" num="0038">Also, the scale-specific gradient function <i>gm<sub>k</sub></i>() specifies to which extent the finally reconstructed image <i>z</i><sub>0</sub> is sensitive to a unit detail arising from a pixel with unit value in the corresponding detail image, i.e. <i>b<sub>k</sub></i> in case of the Burt pyramid transform.</p><p id="p0039" num="0039">The scale-specific gradient functions are equivalent to the partial derivative functions: <maths id="math0001" num=""><math display="block"><msub><mi mathvariant="italic">gm</mi><mi>k</mi></msub><mfenced><mi>t</mi></mfenced><mo>=</mo><mfrac><mrow><mo>∂</mo><msub><mi>z</mi><mn>0</mn></msub></mrow><mrow><mo>∂</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></mfrac><mo>,</mo><mspace width="3em"/><mi>k</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mo>…</mo><mo>,</mo><mi>L</mi></math><img id="ib0001" file="imgb0001.tif" wi="84" he="15" img-content="math" img-format="tif"/></maths><br/>
in which <i>z<sub>k</sub></i> represents the image that results from pixelwise applying the conversion function <i>f<sub>k</sub></i>() to the approximation image <i>v<sub>k</sub></i>, and <i>t</i> = <i>v<sub>L</sub></i>, i.e. the pixel value of the partially reconstructed image at scale <i>L</i>, which is the largest scale involved in multi-scale gradation. In the present context, the pixel values <i>t</i> are referred to as the large-scale average grey values.</p><p id="p0040" num="0040">Relying on the concatenation rule for derivation, the scale-specific gradient functions can be written as: <maths id="math0002" num=""><math display="block"><msub><mi mathvariant="italic">gm</mi><mi>k</mi></msub><mfenced><mi>t</mi></mfenced><mo>=</mo><msub><mi>f</mi><mn>0</mn></msub><mo>⁢</mo><mi>ʹ</mi><mfenced separators=""><msub><mi>F</mi><mn>1</mn></msub><mfenced><mi>t</mi></mfenced></mfenced><mo>⋅</mo><msub><mi>f</mi><mn>1</mn></msub><mo>⁢</mo><mi>ʹ</mi><mfenced separators=""><msub><mi>F</mi><mn>2</mn></msub><mfenced><mi>t</mi></mfenced></mfenced><mo>⋅</mo><mo>…</mo><mo>⋅</mo><msub><mi>f</mi><mi>k</mi></msub><mo>⁢</mo><mi>ʹ</mi><mfenced><mi>t</mi></mfenced><mo>,</mo></math><img id="ib0002" file="imgb0002.tif" wi="99" he="11" img-content="math" img-format="tif"/></maths><br/>
in which <i>f<sub>k</sub></i>'(<i>t</i>) represent the derivative functions of the scale-specific conversion functions.</p><p id="p0041" num="0041">The cumulative conversion functions at subsequent scales are the concatenation of scale-specific conversion functions <i>f<sub>k</sub></i>() from the largest scale <i>L</i> involved in multi-scale gradation, up to the scale considered:<!-- EPO <DP n="9"> --> <maths id="math0003" num=""><math display="block"><msub><mi>F</mi><mi>k</mi></msub><mfenced><mi>t</mi></mfenced><mo>=</mo><msub><mi>f</mi><mi>k</mi></msub><mo>∘</mo><msub><mi>f</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>∘</mo><mo>…</mo><mo>∘</mo><msub><mi>f</mi><mi>L</mi></msub><mfenced><mi>t</mi></mfenced><mo>,</mo></math><img id="ib0003" file="imgb0003.tif" wi="73" he="10" img-content="math" img-format="tif"/></maths><br/>
in which the operator o stands for function concatenation.</p><p id="p0042" num="0042">The derivative of a cumulative conversion function with respect to <i>t</i> is equal to: <maths id="math0004" num=""><math display="block"><msub><mi mathvariant="italic">F</mi><mi>k</mi></msub><mo>⁢</mo><mi>ʹ</mi><mfenced><mi>t</mi></mfenced><mo>=</mo><msub><mi>f</mi><mi>k</mi></msub><mo>⁢</mo><mi>ʹ</mi><mo>⁢</mo><mfenced separators=""><msub><mi>F</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mfenced><mi>t</mi></mfenced></mfenced><mo>⋅</mo><msub><mi>f</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>⁢</mo><mi>ʹ</mi><mo>⁢</mo><mfenced separators=""><msub><mi>F</mi><mrow><mi>k</mi><mo>+</mo><mn>2</mn></mrow></msub><mfenced><mi>t</mi></mfenced></mfenced><mo>⋅</mo><mo>…</mo><mo>⋅</mo><msub><mi>f</mi><mi>L</mi></msub><mo>⁢</mo><mi>ʹ</mi><mfenced><mi>t</mi></mfenced><mo>,</mo></math><img id="ib0004" file="imgb0004.tif" wi="117" he="11" img-content="math" img-format="tif"/></maths><br/>
or equivalently, the derivatives of cumulative conversion functions can be expressed in terms of scale-specific gradient functions: <maths id="math0005" num=""><math display="block"><msub><mi mathvariant="italic">F</mi><mn>0</mn></msub><mo>⁢</mo><mi>ʹ</mi><mfenced><mi>t</mi></mfenced><mo>=</mo><msub><mi mathvariant="italic">gm</mi><mi>L</mi></msub><mfenced><mi>t</mi></mfenced></math><img id="ib0005" file="imgb0005.tif" wi="36" he="9" img-content="math" img-format="tif"/></maths> <maths id="math0006" num=""><math display="block"><msub><mi mathvariant="italic">F</mi><mi>k</mi></msub><mo>⁢</mo><mi>ʹ</mi><mfenced><mi>t</mi></mfenced><mo>=</mo><mfrac><mrow><msub><mi mathvariant="italic">gm</mi><mi>L</mi></msub><mfenced><mi>t</mi></mfenced></mrow><mrow><msub><mi mathvariant="italic">gm</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mfenced><mi>t</mi></mfenced></mrow></mfrac><mspace width="3em"/><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>..</mn><mo>,</mo><mi>L</mi></math><img id="ib0006" file="imgb0006.tif" wi="97" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0043" num="0043">The cumulative conversion functions are then obtained by integration: <maths id="math0007" num=""><math display="block"><msub><mi>F</mi><mn>0</mn></msub><mfenced><mi>t</mi></mfenced><mo>=</mo><msubsup><mo>∫</mo><msub><mi>t</mi><mn>0</mn></msub><mi>t</mi></msubsup><mo>⁢</mo><msub><mi mathvariant="italic">gm</mi><mi>L</mi></msub><mfenced><mi>x</mi></mfenced><mo>⋅</mo><mi mathvariant="italic">dx</mi></math><img id="ib0007" file="imgb0007.tif" wi="53" he="12" img-content="math" img-format="tif"/></maths> <maths id="math0008" num=""><math display="block"><msub><mi mathvariant="italic">F</mi><mi>k</mi></msub><mfenced><mi>t</mi></mfenced><mo>=</mo><msubsup><mo>∫</mo><msub><mi>t</mi><mn>0</mn></msub><mi>t</mi></msubsup><mo>⁢</mo><mfrac><mrow><msub><mi mathvariant="italic">gm</mi><mi>L</mi></msub><mfenced><mi>t</mi></mfenced></mrow><mrow><msub><mi mathvariant="italic">gm</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mfenced><mi>t</mi></mfenced></mrow></mfrac><mo>⋅</mo><mi mathvariant="italic">dx</mi><mspace width="3em"/><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>..</mn><mo>,</mo><mi>L</mi><mo>,</mo></math><img id="ib0008" file="imgb0008.tif" wi="100" he="14" img-content="math" img-format="tif"/></maths><br/>
where <i>t</i><sub>0</sub> is the abscissa <i>t</i> at which <i>F<sub>k</sub></i>(t) = 0. This parameter determines the offset of the cumulative conversion functions. For convenience, it may be set to 0; then all cumulative conversion functions will cross the origin of the coordinate system.</p><p id="p0044" num="0044">The scale-specific conversion functions <i>f<sub>k</sub></i>() are finally obtained by inversion of the cumulative conversion functions <i>F<sub>k</sub></i>(<i>t</i>): <maths id="math0009" num=""><math display="block"><msub><mi mathvariant="italic">f</mi><mi>k</mi></msub><mo>=</mo><msub><mi>F</mi><mi>k</mi></msub><mo>∘</mo><msup><msub><mi>F</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>,</mo><mspace width="3em"/><mi>k</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>..</mn><mo>,</mo><mi>L</mi><mo>-</mo><mn>1</mn></math><img id="ib0009" file="imgb0009.tif" wi="100" he="10" img-content="math" img-format="tif"/></maths> <maths id="math0010" num=""><math display="block"><msub><mi>f</mi><mi>L</mi></msub><mo>=</mo><msub><mi mathvariant="italic">F</mi><mi>L</mi></msub></math><img id="ib0010" file="imgb0010.tif" wi="29" he="8" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="10"> --></p><heading id="h0006"><b>Initial intermediate-scale gradient functions</b></heading><p id="p0045" num="0045">In an interactive adjustment session, the initial state of the multiscale gradient functions and the corresponding displayed image are determined by the default window width/level settings with equal gradient functions for all scales.</p><p id="p0046" num="0046">With each adjustment induced by a user interaction an updated series of multiscale gradient functions is generated by applying changes to the initial series.</p><p id="p0047" num="0047">Upon every change the above method of multiscale gradation is applied to the updated multiscale gradient functions and preferably the resulting image is displayed to provide the user with feedback about the adjustment. This way, any desired modification of density or contrast can be efficiently accomplished by one or more user-induced adjustments, thereby significantly improving the workflow, also in difficult cases that require critical adjustments.</p><p id="p0048" num="0048">The first enhancement method is used to modify the contrast and density of the displayed image according to an amount of the movement of the indicium, denoted by <i>dl</i> and <i>dw.</i></p><p id="p0049" num="0049">The change of the contrast and density of the displayed image resulting from the first enhancement method, similar to the result obtained by adjusting the window width/level settings, is obtained by modifying all the relevant multiscale gradient functions <i>gm<sub>k</sub>(t)</i> in the same way. The initial multiscale gradient functions <i>gm0<sub>k</sub>(t)</i> are rescaled and slid along the abscissa axis according to an amount of the movement of the indicium: <maths id="math0011" num=""><math display="block"><msub><mi mathvariant="italic">gm</mi><mi mathvariant="italic">k</mi></msub><mfenced><mi mathvariant="italic">t</mi></mfenced><mo>=</mo><mi mathvariant="italic">a</mi><mo>*</mo><mi mathvariant="italic">gm</mi><mo>⁢</mo><msub><mn mathvariant="italic">0</mn><mi mathvariant="italic">k</mi></msub><mo>⁢</mo><mfenced separators=""><mi mathvariant="italic">a</mi><mo>*</mo><mi mathvariant="italic">t</mi><mo>+</mo><mi mathvariant="italic">b</mi></mfenced><mo>,</mo><mmultiscripts><mi mathvariant="italic">k</mi><mprescripts/><mspace width="1em"/><none/></mmultiscripts><mo>=</mo><mi mathvariant="italic">S</mi><mo>,</mo><mspace width="1em"/><mo>…</mo><mspace width="1em"/><mo>,</mo><mi mathvariant="italic">L</mi></math><img id="ib0011" file="imgb0011.tif" wi="81" he="7" img-content="math" img-format="tif"/></maths><br/>
with
<ul><li>a rescale factor and b intercept deduced from <i>dl</i> and <i>dw</i> An implementation to deduce <i>a</i> and <i>b</i> from <i>dl</i> and <i>dw</i> is the window level/width linear conversion formula of the DICOM standard: <maths id="math0012" num=""><math display="block"><mi mathvariant="italic">y</mi><mo>=</mo><mfenced separators=""><mfenced separators=""><mi mathvariant="italic">t</mi><mo>-</mo><mfenced separators=""><msub><mi mathvariant="italic">l</mi><mi mathvariant="italic">i</mi></msub><mo>+</mo><mi mathvariant="italic">dl</mi><mo>-</mo><mn mathvariant="italic">0.5</mn></mfenced></mfenced><mo>/</mo><mfenced separators=""><msub><mi mathvariant="italic">w</mi><mi mathvariant="italic">i</mi></msub><mo>+</mo><mi mathvariant="italic">dw</mi><mo>-</mo><mn mathvariant="italic">1</mn></mfenced><mo>+</mo><mn mathvariant="italic">0.5</mn></mfenced><mo>*</mo><mfenced separators=""><msub><mi mathvariant="italic">y</mi><mi mathvariant="italic">max</mi></msub><mo>-</mo><msub><mi mathvariant="italic">y</mi><mi mathvariant="italic">min</mi></msub></mfenced><mo>+</mo><msub><mi mathvariant="italic">y</mi><mi mathvariant="italic">min</mi></msub></math><img id="ib0012" file="imgb0012.tif" wi="116" he="8" img-content="math" img-format="tif"/></maths><br/>
with
<ul><li><i>(wi, li)</i> the initial window width/level settings<!-- EPO <DP n="11"> --></li><li><i>[y<sub>min</sub>, y<sub>max</sub>]</i> the range of the output value</li></ul></li></ul></p><p id="p0050" num="0050">On top of the modifications of the contrast and density of the displayed image resulting from the first enhancement method, the contrast and density of the displayed image are also modified resulting from the second enhancement method to an amount of the movement of the indicium, denoted by <i>dg</i> and <i>dc</i>. The multiscale gradient functions, eventually modified by the first enhancement method, are modified according to the method of multiscale gradation processing.</p><p id="p0051" num="0051">Preferably the multiscale contrast adjustment <i>dc</i> is carried out in a multiplicative way on the small-scale gradient function, i.e. in proportion to the contrast resulting from the first enhancement method</p><p id="p0052" num="0052">The resulting small-scale gradient function is computed as: <maths id="math0013" num=""><math display="block"><msub><mi mathvariant="italic">gm</mi><mi>S</mi></msub><mfenced><mi mathvariant="italic">t</mi></mfenced><mo>=</mo><mi mathvariant="italic">a</mi><mo>*</mo><mi mathvariant="italic">gm</mi><mo>⁢</mo><msub><mn mathvariant="italic">0</mn><mi>S</mi></msub><mo>⁢</mo><mfenced separators=""><mi mathvariant="italic">a</mi><mo>*</mo><mi mathvariant="italic">t</mi><mo>+</mo><mi mathvariant="italic">b</mi></mfenced><mo>*</mo><msup><mn mathvariant="italic">10</mn><mrow><mi mathvariant="italic">dc</mi><mo>/</mo><mn mathvariant="italic">10</mn></mrow></msup><mo>,</mo></math><img id="ib0013" file="imgb0013.tif" wi="69" he="7" img-content="math" img-format="tif"/></maths> with <i>dc</i> is expressed in dB Alternatively, the contrast is adjusted by shifting the small-scale gradient function in ordinate direction by an amount dc.</p><p id="p0053" num="0053">Next, the multiscale density adjustment <i>dg</i> is established by applying a gamma correction to the initial large-scale gradation function <i>y<sub>L</sub>0(t)</i> resulting in a mapping the mid grey pixel values to an output pixel value at 50% + <i>dg</i> of the output range with <i>dg</i> expressed in percentages. The adjusted large-scale gradation function is denoted by <i>y<sub>L</sub>(t)</i>: <maths id="math0014" num=""><math display="block"><msub><mi mathvariant="italic">y</mi><mi mathvariant="italic">L</mi></msub><mfenced><mi mathvariant="italic">t</mi></mfenced><mo>=</mo><mi mathvariant="italic">f</mi><mo>⁢</mo><mfenced separators=""><msub><mi mathvariant="italic">y</mi><mi mathvariant="italic">L</mi></msub><mo>⁢</mo><mn mathvariant="italic">0</mn><mo>⁢</mo><mfenced separators=""><mi mathvariant="italic">a</mi><mo>*</mo><mi mathvariant="italic">t</mi><mo>+</mo><mi mathvariant="italic">b</mi></mfenced></mfenced></math><img id="ib0014" file="imgb0014.tif" wi="52" he="7" img-content="math" img-format="tif"/></maths><br/>
with <maths id="math0015" num=""><math display="block"><mi mathvariant="italic">f</mi><mfenced><mi mathvariant="italic">x</mi></mfenced><mo>=</mo><mfenced separators=""><msup><mfenced separators=""><mi mathvariant="italic">c</mi><mo>*</mo><mi mathvariant="italic">x</mi><mo>+</mo><mi mathvariant="italic">d</mi></mfenced><mi mathvariant="italic">γ</mi></msup><mo>-</mo><mi mathvariant="italic">d</mi></mfenced><mo>/</mo><mi>c</mi></math><img id="ib0015" file="imgb0015.tif" wi="50" he="7" img-content="math" img-format="tif"/></maths>
<ul><li><i>c</i> and <i>d</i> rescale factor and offset to normalize the range of <i>x</i> to the range [0, 1]</li><li>γ the exponent computed as <i>-log ( (50 + dg)</i> / <i>100 )</i> /<i>log (2)</i> Alternatively, the multiscale density adjustment dg is established by applying following function to the initial large-scale gradation function yL0(t): <maths id="math0016" num=""><math display="block"><mi mathvariant="normal">f</mi><mfenced><mi mathvariant="normal">x</mi></mfenced><mo>=</mo><mi>ymin</mi><mo>+</mo><mfenced separators=""><mi>ymax</mi><mo>-</mo><mi>ymin</mi></mfenced><mo>*</mo><mfenced separators=""><mn mathvariant="normal">1</mn><mo>-</mo><mi mathvariant="normal">e</mi><mspace width="1em"/><mfenced separators=""><mi mathvariant="normal">γ</mi><mo>*</mo><mi mathvariant="normal">x</mi></mfenced></mfenced><mo>/</mo><mfenced separators=""><mn mathvariant="normal">1</mn><mo>-</mo><mi mathvariant="normal">eγ</mi></mfenced></math><img id="ib0016" file="imgb0016.tif" wi="107" he="8" img-content="math" img-format="tif"/></maths><br/>
with<!-- EPO <DP n="12"> --></li><li>x within the range [0, 1]</li><li>[ymin, ymax] the range of the output value</li><li>γ computed as 2*log ( (50 - dg) / (50 + dg ) )</li></ul>
Still another alternative to establish the multiscale density adjustment dg is to shift the large-scale gradation function yL0(a*t+b) in ordinate direction by an amount dg.<br/>
The derivative of the adjusted large-scale gradation function yiels the adjusted large-scale gradient function gmL(t).</p><p id="p0054" num="0054">A series of adjusted intermediate-scale gradient functions is obtained according to the following preferred embodiment, based on the adjusted versions of the small-scale and large-scale gradient functions: <maths id="math0017" num=""><math display="block"><msub><mi mathvariant="italic">gm</mi><mi>k</mi></msub><mfenced><mi>t</mi></mfenced><mo>=</mo><msub><mi mathvariant="italic">gm</mi><mi>S</mi></msub><mfenced><mi>t</mi></mfenced><mo>⋅</mo><msup><mfenced><mfrac><mrow><msub><mi mathvariant="italic">gm</mi><mi>L</mi></msub><mfenced><mi>t</mi></mfenced></mrow><mrow><msub><mi mathvariant="italic">gm</mi><mi>S</mi></msub><mfenced><mi>t</mi></mfenced></mrow></mfrac></mfenced><mfrac><mrow><mi>k</mi><mo>-</mo><mi>S</mi></mrow><mrow><mi>L</mi><mo>-</mo><mi>S</mi></mrow></mfrac></msup><mo>,</mo><mspace width="2em"/><mi mathvariant="normal">k</mi><mo>=</mo><mi mathvariant="normal">S</mi><mo>+</mo><mn mathvariant="normal">1</mn><mo>,</mo><mi mathvariant="normal">S</mi><mo>+</mo><mn mathvariant="normal">2</mn><mo>,</mo><mn mathvariant="normal">..</mn><mo>,</mo><mi mathvariant="normal">L</mi><mo>-</mo><mn mathvariant="normal">1</mn></math><img id="ib0017" file="imgb0017.tif" wi="139" he="24" img-content="math" img-format="tif"/></maths></p><p id="p0055" num="0055">If finally the reconstruction procedure of multiscale gradation is applied using the adjusted gradient functions <i>gm<sub>k</sub></i>, then an image with adjusted density and contrast results, in accordance with the findings of the present invention.</p><p id="p0056" num="0056">In a specific embodiment the first enhancement method is handled as special case of the second enhancement method. The first enhancement method can be established by modifying the multi-scale representation, wherein modification is obtained by rescaling and sliding the specification of the gradient functions along the abscissa axis.</p><p id="p0057" num="0057">In accordance with the findings of the present invention, it is possible to simultaneously adjust the window width/level settings and independently adjust the contrast and density using the above described multi-scale representation of a processed image and the multi-scale gradation processing technique.</p><p id="p0058" num="0058">Different embodiments of the present invention are described below.<!-- EPO <DP n="13"> --></p><heading id="h0007"><u>Figure 1</u></heading><p id="p0059" num="0059"><figref idrefs="f0001">Figure 1</figref> shows a display window A on which a medical image is displayed. Two movable indicia B and C (in the form of a slider) are shown.</p><p id="p0060" num="0060">The required amounts of density and contrast adjustment denoted by <i>dy</i> and <i>dx</i> are indicated by the movement of an indicium, i.e. a cursor (B in <figref idrefs="f0001">Fig. 1</figref> and <figref idrefs="f0002">2</figref>) in a window (A in <figref idrefs="f0001">Fig.1</figref>, <figref idrefs="f0002">Fig. 2</figref>), or by any two-dimensional pointing device or interactive controller. Preferably, the window in which the cursor can be moved is the image window, so that the viewer doesn't have to remove focus from the image during adjustment. Alternatively, two separate one-dimensional GUI controls can be used to specify the required amounts of adjustment <i>dy</i> and <i>dx</i>, such as two sliders or scroll bars.</p><p id="p0061" num="0061">In <figref idrefs="f0001">figure 1</figref>, the movement of a first indicium B relative to an initial reference position is used to determine the amount of image enhancement. The movement of an additional indicium C relative to a reference position is used to determine the amount of density and contrast enhancement obtained by applying a contrast enhancement method of the first type relative to the amount of density <i>dg</i> and contrast adjustment dc obtained by the second type.</p><p id="p0062" num="0062">Such an additional indicium can be implemented by means of a mouse click or by means of an additional button to toggle between applying the density and contrast adjustment by the first enhancement method only and applying the density and contrast adjustment by the second enhancement method only. <maths id="math0018" num=""><math display="block"><mi mathvariant="italic">dc</mi><mo>=</mo><mi>dx</mi><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dw</mi><mo>=</mo><mn>0</mn><mo>,</mo><mspace width="1em"/><mi mathvariant="italic">dg</mi><mo>=</mo><mi mathvariant="italic">dy</mi><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dl</mi><mo>=</mo><mn>0</mn><mspace width="1em"/><mfenced separators=""><mi>only multi</mi><mo>-</mo><mi>scale gradation processing</mi></mfenced></math><img id="ib0018" file="imgb0018.tif" wi="152" he="16" img-content="math" img-format="tif"/></maths><br/>
or<!-- EPO <DP n="14"> --> <maths id="math0019" num=""><math display="block"><mi mathvariant="italic">dc</mi><mo>=</mo><mn>0</mn><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dw</mi><mo>=</mo><mi mathvariant="italic">dx</mi><mo>,</mo><mspace width="1em"/><mi mathvariant="italic">dg</mi><mo>=</mo><mn>0</mn><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dl</mi><mo>=</mo><mi mathvariant="italic">dy</mi><mspace width="1em"/><mfenced separators=""><mi>only window width</mi><mo>/</mo><mi>level processing</mi></mfenced></math><img id="ib0019" file="imgb0019.tif" wi="165" he="16" img-content="math" img-format="tif"/></maths></p><p id="p0063" num="0063">In the example shown in <figref idrefs="f0001">figure 1</figref>, the additional indicium is a slider (C) and the position of the slider denoted by x is used to gradually specify the relative amount of density and contrast adjustment by the first enhancement method and the relative amount of density and contrast adjustment by the second enhancement method. Positioning the slider at one side (x = 0) corresponds with establishing the contrast and density adjustment completely by the first enhancement method and positioning the slider at the opposite side (x = 1) corresponds with establishing the contrast and density adjustment completely by the second enhancement method. This is reflected in the following formula for the amounts of adjustments by the two enhancement methods:<maths id="math0020" num=""><math display="inline"><mi mathvariant="italic">dc</mi><mo>=</mo><mi>x</mi><mo>*</mo><mi mathvariant="italic">dx</mi><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dw</mi><mo>=</mo><mfenced separators=""><mn mathvariant="italic">1</mn><mo>-</mo><mi mathvariant="italic">x</mi></mfenced><mo>*</mo><mi mathvariant="italic">dx</mi><mo>,</mo><mmultiscripts><mi mathvariant="italic">dg</mi><mprescripts/><mspace width="1em"/><none/></mmultiscripts><mo>=</mo><mi>x</mi><mo>*</mo><msub><mi mathvariant="italic">dy</mi><mspace width="1em"/></msub><mo>⁢</mo><mi>and</mi><mmultiscripts><mi mathvariant="italic">dl</mi><mprescripts/><mspace width="1em"/><none/></mmultiscripts><mo>=</mo><mfenced separators=""><mn mathvariant="italic">1</mn><mo>-</mo><mi mathvariant="italic">x</mi></mfenced><mo>*</mo><mi mathvariant="italic">dy</mi></math><img id="ib0020" file="imgb0020.tif" wi="137" he="9" img-content="math" img-format="tif" inline="yes"/></maths></p><heading id="h0008"><u>Figure 2</u></heading><p id="p0064" num="0064"><ul><li><figref idrefs="f0002">Figure 2</figref> shows an alternative example with one indicium and a limited area.</li></ul></p><p id="p0065" num="0065">In this figure the limited area is region (C). As long as the movements of the cursor (A) are located within the indicated region, one of the two enhancement methods is used, preferably the second enhancement method. As the cursor leaves this indicated region, the other enhancement method is used to adjust the contrast and density of the displayed image.</p><p id="p0066" num="0066">In a second example, the amount of density and contrast adjustment by the first enhancement method and the amount of density and contrast adjustment by the second enhancement method are deduced from the current state of a single indicium.</p><p id="p0067" num="0067">Preferably the deviation from the initial position (reference position) of the indicium is used to deduce the relative amounts of adjustments established by both enhancement methods. Small density and contrast adjustments are established by the second enhancement<!-- EPO <DP n="15"> --> method. The larger the deviation, the more the first enhancement method is used.</p><p id="p0068" num="0068">An example of a weighting function establishing this relationship is the tangens hyperbolicus function: <maths id="math0021" num=""><math display="block"><mi mathvariant="italic">dc</mi><mo>=</mo><mi>x</mi><mo>*</mo><mi mathvariant="italic">dx</mi><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dw</mi><mo>=</mo><mfenced separators=""><mn mathvariant="italic">1</mn><mo>-</mo><mi mathvariant="italic">x</mi></mfenced><mo>*</mo><mi mathvariant="italic">dx</mi><mo>,</mo><mspace width="1em"/><mi>with</mi><mspace width="1em"/><mi>x</mi><mo>=</mo><mi mathvariant="italic">tanh</mi><mfenced separators=""><mi>c</mi><mo>*</mo><mi mathvariant="italic">dx</mi></mfenced><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi>c</mi><mspace width="1em"/><mi>a scaling factor</mi></math><img id="ib0021" file="imgb0021.tif" wi="165" he="14" img-content="math" img-format="tif"/></maths> <maths id="math0022" num=""><math display="block"><mi mathvariant="italic">dg</mi><mo>=</mo><mi>y</mi><mo>*</mo><msub><mi mathvariant="italic">dy</mi><mspace width="1em"/></msub><mo>⁢</mo><mi>and</mi><mmultiscripts><mi mathvariant="italic">dl</mi><mprescripts/><mspace width="1em"/><none/></mmultiscripts><mo>=</mo><mfenced separators=""><mn mathvariant="italic">1</mn><mo>-</mo><mi mathvariant="italic">y</mi></mfenced><mo>*</mo><mi mathvariant="italic">dy</mi><mo>,</mo><mspace width="1em"/><mi>with</mi><mspace width="1em"/><mi>y</mi><mo>=</mo><mi mathvariant="italic">tanh</mi><mfenced separators=""><mi>c</mi><mo>*</mo><mi mathvariant="italic">dy</mi></mfenced><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi>c</mi><mspace width="1em"/><mi>a scaling factor</mi></math><img id="ib0022" file="imgb0022.tif" wi="165" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0069" num="0069">Another possibility is to establish the adjustments by the second enhancement method until a maximum amount of contrast and density change by the second enhancement method is reached <i>(maxDc</i>, <i>maxDg)</i> and the first enhancement method is used to further modify the displayed image: <maths id="math0023" num=""><math display="block"><mi mathvariant="italic">dc</mi><mo>=</mo><mi mathvariant="italic">min</mi><mfenced separators=""><mi mathvariant="italic">dx</mi><mmultiscripts><mi mathvariant="italic">maxDc</mi><mprescripts/><mspace width="1em"/><none/></mmultiscripts></mfenced><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dw</mi><mo>=</mo><mi mathvariant="italic">max</mi><mo>⁢</mo><mfenced separators=""><mn mathvariant="italic">0</mn><mo>,</mo><mi mathvariant="italic">dx</mi><mo>-</mo><mi mathvariant="italic">dc</mi></mfenced></math><img id="ib0023" file="imgb0023.tif" wi="100" he="7" img-content="math" img-format="tif"/></maths> <maths id="math0024" num=""><math display="block"><mi mathvariant="italic">dg</mi><mo>=</mo><mi mathvariant="italic">min</mi><mfenced separators=""><mi mathvariant="italic">dy</mi><mmultiscripts><mi mathvariant="italic">maxDg</mi><mprescripts/><mspace width="1em"/><none/></mmultiscripts></mfenced><mspace width="1em"/><mi>and</mi><mspace width="1em"/><mi mathvariant="italic">dl</mi><mo>=</mo><mi mathvariant="italic">max</mi><mo>⁢</mo><mfenced separators=""><mn mathvariant="italic">0</mn><mo>,</mo><mi mathvariant="italic">dy</mi><mo>-</mo><mi mathvariant="italic">dg</mi></mfenced></math><img id="ib0024" file="imgb0024.tif" wi="100" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0070" num="0070">In a third example, the amount of density and contrast adjustment by the first enhancement method and the amount of density and contrast adjustment by the second enhancement method are deduced from the trajectory of an indicium.</p><p id="p0071" num="0071">Preferably the direction of movements of this indicium is used to deduce the relative amounts of adjustments established by both enhancement methods. As long as the user moves the indicium (e.g. the cursor) into the same direction, the amount of adjustment by the first enhancement method is gradually increasing and the amount of adjustment by the second enhancement method is gradually decreasing.</p><p id="p0072" num="0072">As the user starts moving the cursor into the opposite directions, the further adjustments are first established by the second enhancement method.</p><p id="p0073" num="0073">Moving the cursor into the same direction is defined as a constantly increasing or decreasing of the required density or contrast<!-- EPO <DP n="16"> --> adjustment <i>dy</i> and <i>dx</i>. Moving the cursor into the opposite direction is defined as changing from an increasing required density or contrast adjustment to a decreasing required density or contrast adjustment and visa versa. Still other definitions are possible.</p><heading id="h0009"><u>Figure 3</u></heading><p id="p0074" num="0074">In the embodiment, the amount of density and contrast adjustment by the first enhancement method is computed to approximate a target window width/level setting.<br/>
Referring to <figref idrefs="f0003">figure 3</figref>, the adjustment vector <i>(dx,dy)</i> resulting from the deviation of the current position of the first indicium from the initial position <i>(w<sub>i</sub>,l<sub>i</sub>)</i> at the start of the interactive adjustment session, is decomposed into a first adjustment vector along the direction to a target window width/level setting <i>(w<sub>t</sub>, l<sub>t</sub>)</i> and a second adjustment vector, preferably orthogonally to the first one, the sum of both adjustment vectors being equal to the adjustment vector <i>(dx, dy)</i>. The first adjustment vector specifies the amount of contrast and density change resulting from the first enhancement method <i>(dw, dl)</i> and the second adjustment vector specifies the amount of contrast and density change resulting from the second enhancement method <i>(dc, dg)</i>.</p><heading id="h0010"><u>Figure 4</u></heading><p id="p0075" num="0075">Alternatively, referring to <figref idrefs="f0004">figure 4</figref>, the adjustment vector <i>(dx,dy)</i> resulting from the deviation of the current position of the first indicium from the initial position <i>(w<sub>i</sub>,l<sub>i</sub>)</i> at the start of the interactive adjustment session, is decomposed into an amount of contrast adjustment dx and an amount of density adjustment <i>dy.</i> The amount of contrast adjustment <i>dx</i> is decomposed into an amount of contrast adjustment <i>dw</i> resulting from the first enhancement method to approximate the target window width setting <i>w<sub>t</sub></i> and an amount of contrast adjustment <i>dc</i> resulting from the second enhancement method with the combination of <i>dw</i> and <i>dc</i> equal to the amount of contrast<!-- EPO <DP n="17"> --> adjustment <i>dx.</i> The amount of density adjustment <i>dy</i> is decomposed into an amount of density adjustment <i>dl</i> resulting from the first enhancement method to approximate the target level setting <i>l<sub>t</sub></i> and an amount of density adjustment <i>dg</i> resulting from the second enhancement method with the combination of <i>dl</i> and <i>dg</i> equal to the amount of density adjustment <i>dy</i>.</p><p id="p0076" num="0076">In the preferred embodiment the target window width/level setting <i>(w<sub>t</sub>, l<sub>t</sub>)</i> is computed based on the grey value distribution of the pixels of interest within the processed image.<br/>
A possible implementation is to compute the target window width/level setting <i>(w<sub>t</sub>, l<sub>t</sub>)</i> based on the minimum en maximum pixel value of the processed image: <maths id="math0025" num=""><math display="block"><msub><mi>l</mi><mi>t</mi></msub><mo>=</mo><mfenced separators=""><msub><mi mathvariant="italic">p</mi><mn mathvariant="italic">0</mn></msub><mo>+</mo><msub><mi mathvariant="italic">p</mi><mn mathvariant="italic">1</mn></msub><mo>+</mo><mi mathvariant="italic">k</mi></mfenced><mo>/</mo><mn mathvariant="italic">2</mn><mspace width="1em"/><mi>and</mi><mspace width="1em"/><msub><mi mathvariant="italic">w</mi><mi mathvariant="italic">t</mi></msub><mo>=</mo><mfenced separators=""><msub><mi mathvariant="italic">p</mi><mn mathvariant="italic">1</mn></msub><mo>+</mo><mi mathvariant="italic">l</mi><mo>-</mo><msub><mi mathvariant="italic">p</mi><mn mathvariant="italic">0</mn></msub></mfenced></math><img id="ib0025" file="imgb0025.tif" wi="105" he="7" img-content="math" img-format="tif"/></maths><br/>
with
<ul><li><i>p<sub>0</sub></i> the minimum pixel value and <i>p<sub>1</sub></i> the maximum pixel value, k and 1 being correction values typically equal to 1.</li></ul></p><p id="p0077" num="0077">Another implementation is to use the 1% and 99% percentiles of the histogram of the processed image to compute the target window width/level setting <i>(w<sub>t</sub>, l<sub>t</sub>)</i> according to the formula described above.</p><p id="p0078" num="0078">Still another, preferred implementation is, referring to <figref idrefs="f0005">figure 5</figref>, to compute the pixels of interest within the processed image as the non-background and non-foreground pixels and to compute the target window width/level setting <i>(w<sub>t</sub>, l<sub>t</sub>)</i> such that the grey value distribution of the pixels of interest is displayed over the whole range of densities, from black to white.</p></description><claims mxw-id="PCLM56984675" lang="DE" load-source="patent-office"><!-- EPO <DP n="20"> --><claim id="c-de-01-0001" num="0001"><claim-text>Verfahren zur Modifikation der Dichte und/oder des Kontrasts eines Bildes durch Anwendung eines ersten Verstärkungsverfahrens zur Änderung der Dichte und des Kontrasts durch Modifikation der Fensterbreite/Fensterlage-Einstellungen des Bildes und eines zweiten Verstärkungsverfahrens zur Änderung der Dichte und des Kontrasts durch Modifikation einer Darstellung mit mehreren Maßstäben des Bildes, wobei die Modifikation von mindestens zwei, bei unterschiedlichen Maßstäben bestimmten Gradientenfunktionen abgeleitet ist und wobei eine Gradientenfunktion bei einem vorgegebenen Maßstab bestimmt, wie die Kontrastverstärkung beim Maßstab von der Dichte abhängig ist, wobei das Ausmaß der Modifikation, das durch Anwendung des ersten und zweiten Verstärkungsverfahrens erhalten wird, durch die Bewegung eines Zeigers bestimmt wird, wobei das Verfahren die nachstehenden Schritte umfasst :
<claim-text>- Bestimmen eines Einstellvektors, der die Abweichung zwischen einem Kontrast/Dichte-Wert an einer Anfangsposition des Zeigers und einem Kontrast/Dichte-Wert an einer aktuellen Position des Zeigers definiert,</claim-text>
<claim-text>- Zerlegung des Einstellvektors in eine Summe eines ersten Einstellvektors entlang der Richtung von der Anfangsposition zu einer Fensterbreite/Fensterlage-Zieleinstellung und eines zweiten, senkrecht auf dem ersten Einstellvektor stehenden Einstellvektors, wobei die Fensterbreite/Fensterlage-Zieleinstellung als l<sub>t</sub> = (p0 + p1 + k) / 2 und w<sub>t</sub> = (p1 + 1 - p0) bestimmt wird, wobei p0 die Mindestanzahl der Pixelwerte im Bild und p1 die Höchstanzahl der Pixelwerte im Bild bedeutet und k und l Korrekturwerte bedeuten,<br/>
wobei der erste Vektor das durch das erste Verstärkungsverfahren zu erzielende Ausmaß der Modifikation des Kontrasts und der Dichte (dw, dl) spezifiziert und der zweite Vektor das durch das zweite Verstärkungsverfahren zu erzielende Ausmaß der Modifikation des Kontrasts und der Dichte (dc, dg) spezifiziert,</claim-text>
<claim-text>- Anwendung auf das Bild der durch das erste und zweite Verstärkungsverfahren zu erzielenden Ausmaße der Modifikation des Kontrasts und der Dichte.</claim-text><!-- EPO <DP n="21"> --></claim-text></claim><claim id="c-de-01-0002" num="0002"><claim-text>Verfahren nach Anspruch 1, <b>dadurch gekennzeichnet, dass</b> die Fensterbreite/Fensterlage-Zieleinstellung von der Verteilung der Grauwerte gewählter Pixel im Bild abgeleitet wird.</claim-text></claim><claim id="c-de-01-0003" num="0003"><claim-text>Verfahren nach Anspruch 1, das darin modifiziert ist, dass p0 das 1%ige Perzentil des Histogramms des Bildes und p1 das 99%ige Perzentil des Histogramms des Bildes bedeutet.</claim-text></claim><claim id="c-de-01-0004" num="0004"><claim-text>Verfahren nach Anspruch 1, <b>dadurch gekennzeichnet, dass</b> im Bild gewählte Pixel bestimmt werden und die Fensterbreite/Fensterlage-Zieleinstellung so angepasst wird, dass die Grauwertverteilung der gewählten Pixel den verfügbaren Bereich von Dichten in einem Anzeigegerät abdeckt.</claim-text></claim><claim id="c-de-01-0005" num="0005"><claim-text>Verfahren nach einem der vorstehenden Ansprüche, <b>dadurch gekennzeichnet, dass</b> die durch das erste Verstärkungsverfahren hervorgerufene Modifikation durch Modifizieren der Darstellung mit mehreren Maßstäben des Bildes erzielt wird, wobei die Modifikation durch Umskalierung und Translation der Gradientenfunktionen entlang der Abszissenachse erhalten wird.</claim-text></claim><claim id="c-de-01-0006" num="0006"><claim-text>Ein Computerprogrammprodukt, das so ausgelegt ist, dass es bei Verwendung auf einem Computer die Ausführung des Verfahrens nach einem der vorstehenden Ansprüche sichert.</claim-text></claim><claim id="c-de-01-0007" num="0007"><claim-text>Ein computerlesbares Medium, enthaltend einen auf einem Computer ausführbaren Programmcode, der so ausgelegt ist, dass er die Ausführung der Schritte nach einem der Ansprüche 1 bis 5 sichert.</claim-text></claim></claims><claims mxw-id="PCLM56984676" lang="EN" load-source="patent-office"><!-- EPO <DP n="18"> --><claim id="c-en-01-0001" num="0001"><claim-text>Method of modifying at least one of density and contrast of an image by applying a first enhancement method for changing density and contrast by modifying the window width/level settings of said image and a second enhancement method for changing density and contrast by modifying a multi-scale representation of said image whereby modification is derived from at least two gradient functions determined at different scales, a gradient function at a specific scale specifying the dependency of contrast amplification at said scale as a function of density wherein the amount of modification obtained by applying said first and second enhancement methods is determined by the movement of an indicium, <b>characterized by</b> the steps of
<claim-text>- determining an adjustment vector defining the deviation between a contrast/density value at an initial position of said indicium and a contrast/density value at a current position of said indicium,</claim-text>
<claim-text>- decomposing said adjustment vector into a sum of a first adjustment vector along the direction from said initial position to a target window width/level setting and a second adjustment vector orthogonal to the first adjustment vector; wherein said target window width/level setting is determined as l<sub>t</sub> = (p0 + p1 + k) / 2 and w<sub>t</sub> = (p1 + 1 - p0) with p0 being the minimum of the pixel values in said image and p1 being the maximum of said pixel values in said image, k and l being correction values,<br/>
said first vector specifying the amount of contrast and<br/>
density modification (dw, dl) to be generated by the first enhancement method and said second vector specifying the amount of contrast and density modification (dc,dg) to be generated by the second enhancement method,</claim-text>
<claim-text>- applying the amounts of contrast and density modification to<br/>
be generated by the first and second enhancement methods to<!-- EPO <DP n="19"> --> said image.</claim-text></claim-text></claim><claim id="c-en-01-0002" num="0002"><claim-text>Method according to claim 1 wherein said target window width/level setting is derived from the distribution of the grey values of pixels of interest in said image.</claim-text></claim><claim id="c-en-01-0003" num="0003"><claim-text>Method according to claim 1 modified in that p0 is the 1% percentile of the histogram of said image and p1 is the 99% percentile of the histogram of.said image.</claim-text></claim><claim id="c-en-01-0004" num="0004"><claim-text>Method according to claim 1 wherein pixels of interest in said image are determined and said target window width/level setting is adjusted so that the grey value distribution of said pixels of interest covers the available range of densities in a display device.</claim-text></claim><claim id="c-en-01-0005" num="0005"><claim-text>Method according to any of the preceding claims wherein<br/>
modification resulting from said first enhancement method is established by modifying the multi-scale representation of said image, wherein modification is obtained by rescaling and<br/>
translating the gradient functions along the abscissa axis.</claim-text></claim><claim id="c-en-01-0006" num="0006"><claim-text>A computer program product adapted to carry out the method of any of the preceding claims when run on a computer.</claim-text></claim><claim id="c-en-01-0007" num="0007"><claim-text>A computer readable medium comprising computer executable program code adapted to carry out the steps of any of claims 1 - 5.</claim-text></claim></claims><claims mxw-id="PCLM56984677" lang="FR" load-source="patent-office"><!-- EPO <DP n="22"> --><claim id="c-fr-01-0001" num="0001"><claim-text>Procédé pour la modification de la densité et/ou du contraste d'une image en appliquant un premier procédé de rehaussement servant à modifier la densité et le contraste par modification des réglages de largeur/niveau de fenêtre de l'image et un deuxième procédé de rehaussement servant à modifier la densité et le contraste par modification d'une représentation à échelles multiples de l'image, ladite modification étant dérivée d'au moins deux fonctions de gradient déterminées à différentes échelles et une fonction de gradient à une échelle spécifique spécifiant la façon dont le rehaussement du contraste à ladite échelle dépend de la densité, le degré de la modification obtenue par application des premier et deuxième procédés de rehaussement étant déterminé par le mouvement d'un repère, ledit procédé comprenant les étapes consistant à :
<claim-text>- déterminer un vecteur de réglage définissant la déviation entre la valeur de contraste/densité à une position initiale du repère et une valeur de contraste/densité à une position actuelle du repère,</claim-text>
<claim-text>- décomposer le vecteur de réglage en une somme d'un premier vecteur de réglage le long de la direction de la position initiale vers un réglage de largeur/niveau de fenêtre final et d'un deuxième vecteur de réglage qui est perpendiculaire au premier vecteur de réglage, ledit réglage de largeur/niveau de fenêtre final étant déterminé comme l<sub>t</sub> = (p0 + p1 + k) / 2 et w<sub>t</sub> = (p1 + 1 - p0), où p0 représente la quantité minimale de valeurs de pixel dans l'image et p1 représente la quantité maximale de valeurs de pixel et k et l représentent des valeurs correctrices, ledit premier vecteur spécifiant le degré de modification du contraste et de la densité (dw, dl) à réaliser par le premier procédé de rehaussement et ledit deuxième vecteur spécifiant le degré de modification du contraste et de la densité (dc, dg) à réaliser par le deuxième procédé de rehaussement,</claim-text>
<claim-text>- appliquer à l'image les degrés de modification du contraste et de la densité à réaliser par les premier et deuxième procédés de rehaussement.</claim-text><!-- EPO <DP n="23"> --></claim-text></claim><claim id="c-fr-01-0002" num="0002"><claim-text>Procédé selon la revendication 1, <b>caractérisé en ce que</b> le réglage de largeur/niveau de fenêtre final est dérivé de la distribution des valeurs de gris de pixels d'intérêt dans l'image.</claim-text></claim><claim id="c-fr-01-0003" num="0003"><claim-text>Procédé selon la revendication 1, modifié en ce que p0 représente le percentile 1% de l'histogramme de l'image et p1 représente le percentile 99% de l'histogramme de l'image.</claim-text></claim><claim id="c-fr-01-0004" num="0004"><claim-text>Procédé selon la revendication 1, <b>caractérisé en ce que</b> des pixels d'intérêt dans l'image sont déterminés et que le réglage de largeur/niveau de fenêtre final est adapté de façon à ce que la distribution des valeurs de gris des pixels d'intérêt couvre la plage de densités disponible dans un dispositif d'affichage.</claim-text></claim><claim id="c-fr-01-0005" num="0005"><claim-text>Procédé selon l'une quelconque des revendications précédentes, <b>caractérisé en ce que</b> la modification réalisée par le premier procédé de rehaussement est concrétisée en modifiant la représentation à échelles multiples de l'image, ladite modification étant obtenue par la mise à l'échelle et la translation des fonctions de gradient le long de l'axe de l'abscisse.</claim-text></claim><claim id="c-fr-01-0006" num="0006"><claim-text>Un produit de programme informatique qui, lorsqu'il est utilisé sur un ordinateur, assure l'application du procédé selon l'une quelconque des revendications précédentes.</claim-text></claim><claim id="c-fr-01-0007" num="0007"><claim-text>Un support lisible par ordinateur, comprenant un code de programme exécutable sur ordinateur conçu de façon à assurer l'exécution des étapes selon l'une quelconque des revendications 1 à 5.</claim-text></claim></claims><drawings mxw-id="PDW16671928" load-source="patent-office"><!-- EPO <DP n="24"> --><figure id="f0001" num="1A,1B,1C"><img id="if0001" file="imgf0001.tif" wi="138" he="129" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="25"> --><figure id="f0002" num="2A,2B,2C"><img id="if0002" file="imgf0002.tif" wi="124" he="125" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="26"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="144" he="124" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="27"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="143" he="131" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="28"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="135" he="162" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
