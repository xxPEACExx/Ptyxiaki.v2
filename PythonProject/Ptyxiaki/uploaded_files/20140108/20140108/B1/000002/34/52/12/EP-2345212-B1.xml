<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2345212-B1" country="EP" doc-number="2345212" kind="B1" date="20140108" family-id="42153078" file-reference-id="299959" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146588585" ucid="EP-2345212-B1"><document-id><country>EP</country><doc-number>2345212</doc-number><kind>B1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-08878023-A" is-representative="NO"><document-id mxw-id="PAPP154850777" load-source="docdb" format="epo"><country>EP</country><doc-number>08878023</doc-number><kind>A</kind><date>20081107</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140552719" ucid="SE-2008051281-W" load-source="docdb"><document-id format="epo"><country>SE</country><doc-number>2008051281</doc-number><kind>W</kind><date>20081107</date></document-id></priority-claim></priority-claims><dates-of-public-availability><intention-to-grant-date><date>20130816</date></intention-to-grant-date><search-report-dispatch-date><date>20120910</date></search-report-dispatch-date></dates-of-public-availability><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989326048" load-source="ipcr">H04L  29/06        20060101ALI20130709BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989326049" load-source="ipcr">H04L  12/70        20130101AFI20130709BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1989631216" load-source="docdb" scheme="CPC">H04L  45/00        20130101 FI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989641221" load-source="docdb" scheme="CPC">H04L  63/0227      20130101 LI20130101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132370388" lang="DE" load-source="patent-office">VERFAHREN UND VORRICHTUNG ZUM WEITERLEITEN VON DATENPAKETEN UNTER VERWENDUNG AGGREGIERENDER ROUTER-SCHLÜSSEL</invention-title><invention-title mxw-id="PT132370389" lang="EN" load-source="patent-office">METHOD AND APPARATUS FOR FORWARDING DATA PACKETS USING AGGREGATING ROUTER KEYS</invention-title><invention-title mxw-id="PT132370390" lang="FR" load-source="patent-office">PROCÉDÉ ET APPAREIL DESTINÉS À TRANSFÉRER DES PAQUETS DE DONNÉES À L'AIDE DE CLÉS DE ROUTEUR D AGRÉGATION</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919539008" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ERICSSON TELEFON AB L M</last-name><address><country>SE</country></address></addressbook></applicant><applicant mxw-id="PPAR919510461" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>TELEFONAKTIEBOLAGET L M ERICSSON (PUBL)</last-name></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919539000" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>CSASZAR ANDRAS</last-name><address><country>HU</country></address></addressbook></inventor><inventor mxw-id="PPAR919536604" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>CSASZAR, ANDRAS</last-name></addressbook></inventor><inventor mxw-id="PPAR919023789" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>CSÁSZÁR, András</last-name><address><street>Mátyás király út. 12</street><city>H-1125 Budaspest</city><country>HU</country></address></addressbook></inventor><inventor mxw-id="PPAR919536527" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>MAGNUSSON LARS G</last-name><address><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919524364" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>MAGNUSSON, LARS G</last-name></addressbook></inventor><inventor mxw-id="PPAR919023790" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>MAGNUSSON, LARS G</last-name><address><street>Töjnavägen 43</street><city>S-191 34 Sollentuna</city><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919537712" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>NAESLUND MATS</last-name><address><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919508127" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>NAESLUND, MATS</last-name></addressbook></inventor><inventor mxw-id="PPAR919023788" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>NÄSLUND, Mats</last-name><address><street>Stopvägen 95</street><city>S-168 36 Bromma</city><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919532624" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>WESTBERG LARS</last-name><address><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919544272" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>WESTBERG, LARS</last-name></addressbook></inventor><inventor mxw-id="PPAR919023787" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>WESTBERG, LARS</last-name><address><street>Långtora Grän</street><city>S-745 96 Enköping</city><country>SE</country></address></addressbook></inventor></inventors><assignees><assignee mxw-id="PPAR919023791" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Telefonaktiebolaget L M Ericsson (publ)</last-name><iid>101075752</iid><address><city>164 83 Stockholm</city><country>SE</country></address></addressbook></assignee></assignees><agents><agent mxw-id="PPAR919023792" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Egrelius, Fredrik</last-name><suffix>et al</suffix><iid>101307911</iid><address><street>Ericsson AB Patent Unit Kista Device, Service &amp; Media Torshamnsgatan 21-23</street><city>164 80 Stockholm</city><country>SE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="SE-2008051281-W"><document-id><country>SE</country><doc-number>2008051281</doc-number><kind>W</kind><date>20081107</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2010053416-A1"><document-id><country>WO</country><doc-number>2010053416</doc-number><kind>A1</kind><date>20100514</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549881700" load-source="docdb">AT</country><country mxw-id="DS549877523" load-source="docdb">BE</country><country mxw-id="DS549787884" load-source="docdb">BG</country><country mxw-id="DS549786993" load-source="docdb">CH</country><country mxw-id="DS549894425" load-source="docdb">CY</country><country mxw-id="DS549881701" load-source="docdb">CZ</country><country mxw-id="DS549877524" load-source="docdb">DE</country><country mxw-id="DS549894426" load-source="docdb">DK</country><country mxw-id="DS549894427" load-source="docdb">EE</country><country mxw-id="DS549804084" load-source="docdb">ES</country><country mxw-id="DS549787897" load-source="docdb">FI</country><country mxw-id="DS549787898" load-source="docdb">FR</country><country mxw-id="DS549877525" load-source="docdb">GB</country><country mxw-id="DS549894428" load-source="docdb">GR</country><country mxw-id="DS549877530" load-source="docdb">HR</country><country mxw-id="DS549881706" load-source="docdb">HU</country><country mxw-id="DS549786994" load-source="docdb">IE</country><country mxw-id="DS549894433" load-source="docdb">IS</country><country mxw-id="DS549787899" load-source="docdb">IT</country><country mxw-id="DS549894434" load-source="docdb">LI</country><country mxw-id="DS549871769" load-source="docdb">LT</country><country mxw-id="DS549924677" load-source="docdb">LU</country><country mxw-id="DS549871774" load-source="docdb">LV</country><country mxw-id="DS549871775" load-source="docdb">MC</country><country mxw-id="DS549924678" load-source="docdb">MT</country><country mxw-id="DS549804085" load-source="docdb">NL</country><country mxw-id="DS549787900" load-source="docdb">NO</country><country mxw-id="DS549924679" load-source="docdb">PL</country><country mxw-id="DS549786995" load-source="docdb">PT</country><country mxw-id="DS549804086" load-source="docdb">RO</country><country mxw-id="DS549924680" load-source="docdb">SE</country><country mxw-id="DS549877531" load-source="docdb">SI</country><country mxw-id="DS549787913" load-source="docdb">SK</country><country mxw-id="DS549894435" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><description mxw-id="PDES63961005" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">TECHNICAL FIELD</heading><p id="p0001" num="0001">The present invention relates generally to a method and apparatus for supporting a forwarding process for data packets in a public packet-switched network such as the Internet, such that unwanted data packets can be avoided.</p><heading id="h0002">BACKGROUND</heading><p id="p0002" num="0002">Packet-based transmission of digitally encoded information between different parties over IP (Internet Protocol) networks is used for a variety of communication services, such as e-mail messaging, Internet browsing, voice and video telephony, content streaming, games, and so forth. Digitally encoded information is arranged into data packets at a sending party, which are then transmitted towards a targeted receiving party over a transmission path. The transmission path between the sending party and the receiving party may include various networks, switches, gateways, routers and interfaces. The communicating parties are often referred to as "end-hosts" which may be any type of equipment capable of packet-based IP communication, such as fixed and mobile telephones, computers, servers, game stations, etc. In this description, the term end-host will generally represent any such communication equipment.</p><p id="p0003" num="0003">An end-host connected to the Internet or other IP network has typically been assigned a forwarding identity in the form of an IP address needed for routing any data packets directed to that end-host along a transmission path. Typically, the end-host has also been assigned a more or less intelligible name in a text string, e.g. a conventional e-mail address or web address, such as <u>user@operator.com,</u><!-- EPO <DP n="2"> --> which is associated with an assigned IP address of either the actual user/end-host or some other host receiving messages on behalf of the user. A DNS (Domain Name Server) system comprising a hierarchy of DNS servers is used for retrieving the current IP address of a particular host name. Thus, an end-host can query the DNS system with a host name to communicate with, and the DNS will then reply by providing the current IP address of the corresponding end-host. This type of query is sometimes referred to as a destination query, identity query or address query, the latter being used throughout this description.</p><p id="p0004" num="0004">Data packets are basically configured with a data field containing payload data and a header field in which the sending end-host inserts the destination address of the target end-host, i.e. the IP address obtained from the DNS system. Thus, each data packet is routed over multiple network nodes, generally referred to as IP routers, along a suitable transmission path based on the destination address in the packet's header field.</p><p id="p0005" num="0005">In addition to simply receiving and forwarding data packets, an IP router may also be capable of other functions such as security functions, packet scheduling, and translation of addresses and protocols. Further, end-hosts may have a filter/firewall functionality for determining whether incoming data packets should be admitted or discarded, e.g. according to settings typically made by a user or administrator associated with the end-host.</p><p id="p0006" num="0006">Each router in an IP network typically comprises ingress and egress units acting as interfaces for receiving and sending data packets, respectively. The router also comprises a routing or forwarding function for determining which router an incoming data packet should be sent to as a<!-- EPO <DP n="3"> --> "next hop" towards the final destination, based on a forwarding table defined in the router. As is well-known in this field, a data packet can often be routed along multiple alternative paths depending on the network topology and the current traffic load.</p><p id="p0007" num="0007">Links to the "nearest" neighbouring routers are provided in each router by means of corresponding ports, and a forwarding architecture is also configured in the routers based on the distribution of topology information and link information. Each port can have an IP address and an IP mask configured on its interfaces, and routing protocols are used to distribute this information among the routers in the network in a configuring procedure. From the distributed topology information, each router then calculates its own forwarding table, containing multiple destination IP-addresses and associated outgoing ports. As each incoming data packet has a destination IP-address in its header, the forwarding table is used to find the suitable entry in the forwarding table from that IP-address. The main function of the forwarding table is thus to determine the appropriate outgoing port, leading to the next hop router, for each incoming packet.</p><p id="p0008" num="0008">In <figref idrefs="f0001">Fig. 1</figref>, the basic structure of a conventional IP router 100 is shown, when situated in an IP network. Among other things, IP router 100 comprises an ingress part 100a, an egress part 100b and a forwarding function here schematically represented by a forwarding table 100c. The egress part 100b comprises a plurality of outgoing ports P<sub>A</sub>, P<sub>B</sub>, P<sub>C</sub>, ... leading to different neighbouring routers A, B, C, ..., respectively, to which router 100 is directly connected. Any incoming data packet 102 has a payload field PL and a<!-- EPO <DP n="4"> --> header H, the latter containing the destination address for the packet.</p><p id="p0009" num="0009">The forwarding table 100c is comprised of multiple entries each containing an IP mask, an IP address and an outgoing port number. The IP mask may be defined in terms of a hexadecimal encoded string such as, e.g., FF.FF.FF.0, or FF.FF.8.0, etc. Briefly described, the destination address in header H- is combined with the IP masks in for warding table 100c by applying a logic "AND"-operation, in order to detect a matching entry with the same IP address. The purpose of this masking mechanism is to aggregate the traffic towards several distinct destinations, and to simplify identification of the outgoing port for the aggregate. Effectively, the bit mask works similar to a "wildcard" when comparing and matching destination addresses to the entries. Once a matching entry is found, the packet can be sent out on the outgoing port according to the port number of that entry.</p><p id="p0010" num="0010">The incoming data packet 102, which may have been forwarded from a previous router (not shown) to router 100, is thus first received at the ingress unit 100a. It is then determined which next router the packet should be sent to, based on the destination address in header H and using the forwarding table 100c and the above logic "AND"-operation. In this example, the incoming packet 102 has a destination IP address that, when combined with the mask, matches the IP address of an entry in forwarding table 100c having port number P<sub>C</sub>. The packet 102 is therefore sent out on the corresponding port which is connected to router C, being the next-hop router in this case.</p><p id="p0011" num="0011">As mentioned above, a routing protocol is used to distribute topology and link information among the routers<!-- EPO <DP n="5"> --> in an IP network. The currently used routing protocols are configured to obtain "resilience", i.e. packets must be rerouted in a different path in the case of link or node failure in the original path. The routing protocols are also configured to facilitate router management, since configuring routers is typically a cumbersome task which is generally desirable to simplify. Thus, in case of detecting failure in a link or node, the routing protocol will reconfigure the forwarding table in affected routers and at the same time distribute the information to the routers, thereby simplifying the management. In order to obtain scalability, which otherwise is an inherent problem in the routing architecture, the routing process can use aggregation of routes based on the above hierarchical bit-mask scheme, which is well-known in the art and not necessary to describe here further.</p><p id="p0012" num="0012">However, a major problem in IP-networks and the Internet is that the security support is generally insufficient, as explained below. In a sense, the above mentioned resilience can sometimes make it "too easy" to get across packets through the network. This is because the current routing architecture and protocols were originally designed for a "friendly" environment, i.e. assuming that there are no "illicit" or "corrupt" users communicating in IP networks and that no protection is necessary for the transmission of data packets. Nevertheless, it has been found necessary or desirable to add various security solutions to the IP architecture in order to protect the communicated data, such as IP-sec on a low layer and also TLS (Transport Layer Security) on a higher layer. These protocols can provide authentication and encryption of the data packets. Further, MPLS (Multiprotocol Label Switching)<!-- EPO <DP n="6"> --> is a solution for building Layer 3 VPNs (Virtual Private Networks) to ensure secure communication. In the VPN case when an intranet is used, private addressing is required and the network is somewhat isolated from the public Internet such that external un-authorized hosts are not allowed to reach and communicate with the hosts attached to the intranet.</p><p id="p0013" num="0013">Other prior solutions for providing security in the routing protocol include: secure communication between routers such that no illicit entity can eavesdrop, manipulate or imitate a router, the establishment of IP-sec tunnels between router ports to protect the transport of packets between routers, and link security on the layer 2, e.g. according to IEEE 802.1AE or IEEE 802.10. Various authentication procedures using cryptographic keys can also be used, e.g. according to DNSSec (DNS Security), HIP (Host Identity Protocol) and CGA (Cryptographically Generated Addresses), to enhance the security. However, while protection against unwanted traffic is used for certain applications (e.g. spam filtering for e-mails), no basic protection against violating end-hosts and unwanted data packets has been generally provided in the public IP infrastructure, though.</p><p id="p0014" num="0014">Since the internal forwarding identities, i.e. IP addresses, are publicly distributed end-to-end in the manner described above, any end-host is basically able to send messages and data packets to any other end-host over the Internet, resulting in the well-known problems of flooding, spamming, virus, fraud and so-called "Denial-of-service" (DoS) threats. Hence, it has generally become a problem that any end-host can get across data packets totally out of control of the receiving end-host, and that public packet-switched<!-- EPO <DP n="7"> --> networks such as the Internet have no mechanism in the IP infrastructure for preventing that data packets from potentially illicit or corrupt end-users are routed to the receiver.</p><p id="p0015" num="0015">More or less complex functionality can be added though at the end-host or in the link layer, such as filters/firewalls or the like, in order to limit the connectivity. However, these solutions are "last line of defence" solutions, meaning that the transport of unwanted data packets can still consume network resources along the entire sender-receiver path, while the packets are anyway discarded at the receiver.</p><p id="p0016" num="0016">Another problem in communication systems with plenty of end-hosts and multiple routers, is that the forwarding tables in the routers would comprise an enormous number of entries if a security solution is used that cannot employ the above-described bit-masking of IP addresses nor any equivalent thereof, to achieve aggregation of routes. Such large forwarding tables can be very complex to handle, requiring substantial resources for storing, processing and communication, which may typically result in undesirable costs and delays. In particular, if a cryptographic security mechanism is introduced in the routers, the overhead would become even greater, e.g. due to management of cryptographic keys and/or cryptographic processing, thereby making complexity reductions in the routers all the more desirable. See also documents <patcit id="pcit0001" dnum="US200409485B"><text>US 2004/09485</text></patcit>, <patcit id="pcit0002" dnum="US2006059337A"><text>US 2006/059337</text></patcit> and <patcit id="pcit0003" dnum="US6836462B"><text>US 6836 462</text></patcit>.</p><heading id="h0003">SUMMARY</heading><p id="p0017" num="0017">It is an object of the present invention to address at least some of the problems outlined above. It is also an object to obtain a mechanism for avoiding transmission of unwanted data packets in a packet-switched<!-- EPO <DP n="8"> --> network, and at the same time be able to use forwarding tables of convenient size in the routers. These objects and others can be achieved by providing methods and apparatuses as defined in the attached independent claims.</p><p id="p0018" num="0018">According to one aspect, a method is provided for supporting the forwarding of received data packets in a router of a packet-switched network. In this method, a forwarding table is configured in the router based on aggregating router keys and associated aggregation related instructions received from a key manager. Each aggregating router key represents a set of destinations or routes. When a data packet is received comprising an ingress tag derived from a sender key or router key, a matching function is applied to the ingress tag and at least one entry in the forwarding table, the entry comprising a candidate ingress key and an outgoing port indication, in order to find a matching table entry. An outgoing port is selected for the packet according to a found matching table entry that further comprises an associated aggregation related instruction. An egress tag is then created according to the aggregation related instruction in the matching table entry, and the packet with the created egress tag attached is sent from the selected outgoing port to a next hop router.</p><p id="p0019" num="0019">According to another aspect, an apparatus is provided in a router of a packet-switched network for supporting the forwarding of received data packets. The router comprises a forwarding unit adapted to configure a forwarding table based on aggregating router keys and associated aggregation related instructions received from a key manager, each aggregating router key representing a set of destinations. The router further comprises an ingress unit adapted to receive a data packet comprising an ingress<!-- EPO <DP n="9"> --> tag derived from a sender key or router key, and an egress unit for sending the data packet to a next hop node.</p><p id="p0020" num="0020">The forwarding unit comprises a tag matching unit adapted to apply a matching function to the received ingress tag and at least one entry in the forwarding table comprising a candidate ingress key and an outgoing port indication, in order to find a matching table entry. The tag matching unit is further adapted to select an outgoing port for the packet according to a found matching table entry that further comprises an associated aggregation related instruction. The forwarding unit also comprises a tag creating unit adapted to create an egress tag according to the aggregation related instruction in the matching table entry, and to attach the egress tag to the packet which is to be sent by the egress unit from the selected outgoing port to a next hop router.</p><p id="p0021" num="0021">The above method and apparatus in the router can be configured according to different embodiments. In one embodiment, the matching function includes applying a tag derivation function TDF to the candidate ingress key in a table entry to derive a candidate ingress tag. A match is then considered to be found if the candidate ingress tag satisfies a predetermined relation with the received ingress tag in the packet. The predetermined relation may be equality, i.e. a match is considered to be found if the candidate ingress tag equals the ingress tag in the packet.</p><p id="p0022" num="0022">In another embodiment, the egress tag is created by applying another tag derivation function TDF' to an egress key in the matching table entry. The received data packet may further contain a key index associated to an entry or a set of entries in the forwarding table, and the<!-- EPO <DP n="10"> --> key index is used to find the proper entry/entries for applying the matching function.</p><p id="p0023" num="0023">In further embodiments, the egress tag may be created by attaching one or more additional sub-tags, derived from one or more egress keys in the matching table entry, to the packet alongside the received ingress tag to execute aggregation, or by removing one or more additional sub-tags from the packet to execute de-aggregation. The egress tag may further be created by applying a predetermined combination function to the received ingress tag and the one or more additional sub-tags when executing aggregation. For example, the combination function may be concatenation or an XOR function.</p><p id="p0024" num="0024">A hierarchical scheme of router keys and destination keys may also be used for executing aggregation of routes. In that case, the egress tag may be created by exchanging the received ingress tag for a new tag derived from an egress key in the matching table entry and also adding associated aggregation information to the egress tag, wherein the aggregation information can be used to determine the original destination.</p><p id="p0025" num="0025">The hierarchical router key scheme above may be generated from a root value by means of a function f(p,q), where p is the router key value of a node position above a current tree level and q is an integer indicating a node position within the current tree level. Destination keys of end-hosts then correspond to leaves of the tree-structure, and any f-values on one or more tree levels above the leaves can be used as aggregating router keys. The resulting key scheme may be composed of key values that can be calculated, along a path from the root (x) downwards, according to the following chain: (x, f(x), f(f(x)), ..., f(f(...f(x)...))).<!-- EPO <DP n="11"> --></p><p id="p0026" num="0026">According to yet another aspect, a method is provided in a key manager for supporting the forwarding of data packets at routers in a packet-switched network. In this method, destination keys are registered for end-hosts connected to access routers in the network, and the location of routers enabled to execute route aggregation and de-aggregation, respectively, is determined. Aggregating router keys and associated aggregation instructions are also created, each aggregating router key representing a set of destinations. Then, the aggregating router keys and associated aggregation instructions are distributed to the routers for execution of route aggregation and de-aggregation, thereby enabling the routers to configure their own forwarding tables based on the distributed information.</p><p id="p0027" num="0027">According to yet another aspect, an apparatus is provided in a key manager for supporting the forwarding of data packets at routers in a packet-switched network. This apparatus comprises a network controlling unit adapted to register destination keys for end-hosts connected to access routers in the network, and further adapted to determine the location of routers enabled to execute route aggregation and de-aggregation, respectively. The key manager apparatus further comprises a key distributor adapted to create aggregating router keys and associated aggregation instructions, each aggregating router key representing a set of destinations. The key distributor is further adapted to distribute the aggregating router keys and associated aggregation instructions to the routers enabled to execute route aggregation and de-aggregation, thereby enabling the routers to configure their own forwarding tables based on the distributed information.<!-- EPO <DP n="12"> --></p><p id="p0028" num="0028">The key manager apparatus may further comprise an address query manager adapted to receive an address query from a querying end-host regarding a target end-host. The address query manager is further adapted to create a sender key by applying a key derivation function KDF to at least a destination key associated with the target end-host, and to send the created sender key to the querying end-host in response to-the address query. Thereby, the querying end-host is able to get across data packets to the target end-host by attaching a sender tag generated from the sender key to a transmitted data packet, the sender tag directing the transmitted data packet to the target end-host.</p><p id="p0029" num="0029">Further possible features and benefits of the present invention will become apparent from the detailed description below.</p><heading id="h0004">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p0030" num="0030">The present invention will now be described in more detail by means of exemplary embodiments and with reference to the accompanying drawings, in which:
<ul><li><figref idrefs="f0001">Fig. 1</figref> is a schematic block diagram illustrating a conventional router in an IP network, according to the prior art.</li><li><figref idrefs="f0001">Fig. 2</figref> illustrates a typical transmission path scenario for routing data packets from a sending end-host A to a receiving end-host B, where the present invention can be utilised.</li><li><figref idrefs="f0001">Fig. 2a</figref> illustrates a part of an exemplary forwarding table, according to one embodiment.</li><li><figref idrefs="f0002">Fig. 3</figref> illustrates an exemplary network topology and transmission scenario where aggregating router keys are used to support the forwarding process for a packet.<!-- EPO <DP n="13"> --></li><li>Fig's 3a and 3b-c, respectively, illustrate two different embodiments of how the final destination address of the receiving end-host can be preserved in the packet of the transmission scenario of <figref idrefs="f0002">Fig. 3</figref>.</li><li><figref idrefs="f0003">Fig. 4</figref> is a block diagram illustrating how aggregation can be used in a router when forwarding a data packet sent from an end-host A, according to further embodiments.</li><li><figref idrefs="f0004">Fig. 5</figref> is a flow chart with steps in a procedure performed by a key manager to support a forwarding process for data packets in routers of a packet-switched network, according to yet another embodiment.</li><li><figref idrefs="f0005">Fig. 6</figref> is a flow chart with steps in a procedure performed by a router in a packet-switched network for executing a forwarding process for a data packet, according to yet another embodiment.</li><li><figref idrefs="f0006">Fig. 7</figref> is a schematic block diagram illustrating a key manager and a router in a packet-switched network in more detail, according to further embodiments.</li></ul></p><heading id="h0005">DETAILED DESCRIPTION</heading><p id="p0031" num="0031">The present invention provides a packet forwarding scheme allowing for aggregation of routes when at the same time end-hosts are protected from receiving unwanted data packets by a security solution in the forwarding architecture that avoids using conventional IP addresses in the address field of transmitted packets. Instead, destination keys, associated with target end-hosts, and preconfigured router keys, associated with the destination keys and the network topology, are used for routing data packets through the IP network. Tags derived from the above destination keys and router keys, are inserted in the<!-- EPO <DP n="14"> --> headers of the transmitted packets, e.g. in an address field, and the routers can then determine a destination key or router key from the tag in the packet to perform a forwarding operation.</p><p id="p0032" num="0032">When using such a scheme, the requirement of being able to route packets to the correct destination, and at the same time enabling end-hosts to protect themselves from unwanted packets, would naturally imply the use of destination keys associated to individual end-hosts in all routers and corresponding entries in the forwarding tables. As a result, aggregation of routes cannot be obtained in the conventional manner as when a regular IP addressing scheme is used.</p><p id="p0033" num="0033">Instead, aggregation of routes is obtained by attaching tags in the transmitted packets which are derived from special aggregating router keys that represent a set of plural routes or destinations. Such tags can then be changed, added to or removed from the packet by a router according to an aggregation related instruction in a matching entry in the router's forwarding table, to execute aggregation or de-aggregation, respectively, in that router. Thereby, the size of forwarding tables in the routers can be reduced by including such aggregating router keys, as compared to not employing aggregation of routes in the routers where a table entry is provided for each and every end-host in the network. In this description, "aggregation" implies routing towards an increased number of destinations and "de-aggregation" implies routing towards a reduced number of destinations.</p><p id="p0034" num="0034">An exemplary transmission scenario is schematically illustrated in <figref idrefs="f0001">Fig. 2</figref>, with the following nodes basically involved when transmitting data packets through a network<!-- EPO <DP n="15"> --> with routers R, in accordance with embodiments described below: A sending end-host A connected to an access router R1, a plurality of intermediate routers R that may potentially be used in the transmission path, and an access router Rx to which a receiving end-host B is connected, access router R1 thus being a "first-hop router" and access router Rx being a "last-hop router" in the network. A DNS server system is also used for handling address queries Q and for generally distributing routing information I to the routers. In the following description, the term "key manager" is used to generally represent a DNS system or any other similar functional unit or system.</p><p id="p0035" num="0035">According to embodiments to be described below, a security solution can be built into the core protocol of the forwarding architecture used by routers in the network. Generally, any packets transmitted over a public packet-switched communication network must pass the forwarding mechanism in the forwarding plane of the routers in the transmission path, e.g. as described above. By embedding a packet forwarding control mechanism within the forwarding plane in a router, to be described below, the resulting security will effectively be enforced in the IP infrastructure to control the routing of any packet passing that router.</p><p id="p0036" num="0036">Briefly described, predefined implicit destination keys, associated with target end-hosts, and preconfigured router keys, associated with the destination keys and router positions in a network topology, are used instead of explicit IP addresses for routing data packets through the IP network. A key manager thus registers such destination keys for end-hosts, being potential receivers of data packets. In this process, the destination keys may be<!-- EPO <DP n="16"> --> assigned by the key manager or selected by the end-hosts, depending on the implementation.</p><p id="p0037" num="0037">The key manager will then provide a corresponding sender key rather than an IP address in response to an "address query" or the like from a querying end-host for a target end-host. In this description, the term "address query" should be understood as any query for information that can be used for authorising communication of data packets to the target end-host.</p><p id="p0038" num="0038">The key manager creates the sender key by applying a "Key Derivation Function KDF" to at least the destination key of the target end-host and optionally also to the identity of the querying end-host, to be described in more detail below. Alternatively, the sender key may be created by applying a KDF to another key being related to the destination key and possibly also to destination keys of other end-hosts to obtain aggregation of plural routes or destinations. The destination key of the target end-host is thus effectively "concealed" in the sender key provided to the querying end-host. This can be obtained by using a one-way function or hashing function as KDF.</p><p id="p0039" num="0039">The querying end-host then further derives a sender tag from the obtained sender key by applying a "Tag Derivation Function TDF" to the sender key, and attaches the sender tag in the header of each transmitted data packet of at least an ongoing data flow or session with the receiving target end-host. The sender tag thus implicitly encodes the destination key of the target end-host. Alternatively, the key manager may derive the sender tag and deliver it directly to the sender. The TDF may likewise be a one-way function or hashing function.<!-- EPO <DP n="17"> --></p><p id="p0040" num="0040">Further, the key manager creates different router keys, based on the registered destination keys and the network topology, and distributes the router keys to routers in the IP network to form a basis for creating forwarding tables in the routers. It is further determined which routers can execute route aggregation or de-aggregation, respectively, depending on their positions in the network topology. Different criteria can be used for deciding where aggregation/de-aggregation should be executed in a network topology. One way is to use the table-size as an indicator of the need to perform aggregation. However, various other methods can also be applied to determine the placement of aggregation/de-aggregation which is out-of-scope of this description. A hierarchical tree-like topology of the router network may in some cases also be determined, such that the routers are positioned at different hierarchical levels in the topology.</p><p id="p0041" num="0041">By having detailed knowledge of in which routers aggregation or de-aggregation can be executed, and also the network location of each end-host for which a destination key has been registered, the key manager can create "aggregating router keys", i.e. keys that represent sets of plural destinations and can be used for routing in routers at different hierarchical levels in the network topology. These aggregating router keys are thus distributed to the appropriate routers, e.g. in a configuring procedure.</p><p id="p0042" num="0042">The routers can then configure their own forwarding tables by means of the distributed router keys. As indicated above, the router keys are created based on the location of routers in network where aggregation or de-aggregation can be executed, wherein at least some of the distributed router keys are aggregating router keys associated to a group of<!-- EPO <DP n="18"> --> plural destinations or routers in the network, in order to reduce or limit the number of entries in the forwarding table in the routers.</p><p id="p0043" num="0043">The key manager further defines and distributes an aggregation related instruction associated with each aggregating router key, to be included in a policy field or the like of any forwarding table entries containing an aggregating router key. This instruction basically tells the router if and how to execute aggregation or de-aggregation, e.g. by changing an existing router tag in the packet, or by adding or removing one or more router tags to/from the packet, respectively, according to different possible embodiments which will be described in more detail below.</p><p id="p0044" num="0044">Optionally, the key manager may also distribute key indexes for inclusion in the forwarding tables, each key index being associated to one or more rows in the table with different router keys, in order to facilitate the forwarding operation in a manner to be described below. In practice, the key manager can basically assign a key index to each router key.</p><p id="p0045" num="0045">Thus, the forwarding table in a router has entries with router keys, corresponding outgoing ports and optional key indexes. The table entries with aggregating router keys also contain an associated aggregation related instruction in a policy field or the like, basically dictating that the router should perform aggregation or de-aggregation, as mentioned above.</p><p id="p0046" num="0046">In this description, the tag in an outgoing or forwarded packet is generally referred to as an "egress tag" derived from an "egress key", whereas the tag in an incoming or received packet is referred to as an "ingress tag".<!-- EPO <DP n="19"> --> Further, an "ingress key" is the key from which the received ingress tag has been derived.</p><p id="p0047" num="0047">In the forwarding operation performed by a router having received a data packet containing an ingress tag, the ingress tag is matched with the ingress keys in the forwarding table by using a predetermined TDF, e.g. entry by entry, and when a matching entry is found the corresponding outgoing port in that entry is selected for sending out the packet. The router further checks if the matching table entry contains an aggregation related instruction, e.g. dictating that the router should change the received router tag, or add or remove one or more router tags to/from the packet, to be described below. An egress tag, e.g. derived from an explicit egress key in the matching table entry or derived according to an associated aggregation related instruction, is thus attached to the packet header before sending out the packet on the outgoing port to the next-hop router.</p><p id="p0048" num="0048">If no matching entry is found in the table, the packet may be handled according to a predefined "default policy", e.g. dictating that the packet is discarded and not forwarded any further. The router will typically employ such a policy if some unauthorized sending end-host, not knowing the appropriate key, tries to get across a data packet with a "faked" tag inserted.</p><p id="p0049" num="0049">When the packet is received by the next-hop router, the process above will basically be repeated. If key indexing is used, a key index in the ingress tag of the received packet will point directly to one entry, or to a limited set of entries, in the forwarding table, thereby identifying the ingress key(s) in the entry/entries. The<!-- EPO <DP n="20"> --> router can then limit the matching operation above to the ingress key(s) identified by the key index.</p><p id="p0050" num="0050">In this way, by not exposing the destination/ sender/router keys to unauthorized parties, interception of explicit end-host addresses or identities that can be used by others to get across data packets, is not feasible. As a result, unsolicited data packets to those end-hosts can be essentially avoided, unless a valid key or tag can be correctly "guessed" by an unauthorized party which is most unlikely. The sender and router keys and optional key indexing are thus useful in the forwarding operation performed by routers in the transmission path, in a manner to be described in more detail below with reference to specific exemplary embodiments. Further, by populating the forwarding tables with aggregating router keys that represent a group of destinations, and with associated aggregation related instructions, the forwarding operations can be made more effective and the forwarding tables will be of limited size and not too large, particularly in networks with numerous end-hosts and routers.</p><p id="p0051" num="0051">Basically, when an aggregating router key has been used to generate an egress tag at a certain router, the routing task of subsequent routers is simplified. However, as the packet is transferred closer to its destination, aggregation may at some point not be possible any more. On the other hand, the number of potential destination/routes will at that point also begin to diminish, maintaining the effectiveness of the routing.</p><p id="p0052" num="0052"><figref idrefs="f0001">Fig. 2a</figref> illustrates a forwarding table that can be used in the present solution, in which an exemplary entry or table row is denoted "x". The table has plural columns 200-210 comprising an optional first column 200 with an ingress<!-- EPO <DP n="21"> --> key index "IKi" that can be used for finding one or more appropriate entries for executing the matching operation, i.e. matching an ingress tag attached to an incoming packet with an ingress key "IK" present in a second column 202 in the table. A single ingress key index may point to a set of multiple entries in the table to which the matching operation can be limited.</p><p id="p0053" num="0053">A third column 204 may contain one or more egress keys "EK" from which one or more new egress tags are to be created, once a matching entry is found, for inclusion in the packet when forwarded to the next-hop router. An optional fourth column 206 contains an egress key index "EKi" to be attached to outgoing data packets, which will effectively be used as the ingress key index when received by a next-hop router. A fifth column 208 contains a port number "P" indicating the port on which a received and matched packet is to be sent out towards the next-hop router.</p><p id="p0054" num="0054">Finally, if an aggregating router key is used as ingress or egress key, a sixth column 210 contains an aggregation related instruction "Agg" associated with the aggregating router key, basically dictating that the router should execute aggregation or de-aggregation and also how the new egress tag should be created, to be described below. Column 210 may be referred to as a "policy field" which may also contain various other data such as policy rules or the like, e.g. "drop packet", "use default port", "retrieve new router key from DNS", "request previous hop router to explicitly authenticate itself", and so forth. If key indexing is not used, the optional columns 200 and 206 will naturally be omitted.<!-- EPO <DP n="22"> --></p><p id="p0055" num="0055">An exemplary network topology and transmission scenario where aggregating router keys are used to support a forwarding process, is schematically illustrated in <figref idrefs="f0002">Fig. 3</figref>. A plurality of routers are interconnected according to a known network topology, in this case greatly simplified, and a plurality of end-hosts are connected to access routers in the network.</p><p id="p0056" num="0056">In this figure, only some of the routers R1-R7 and end-hosts A-G are shown, while a real network has typically a much greater number of end-hosts and routers than illustrated here. The routers R1-R7 have configured their own forwarding tables from previously distributed router keys and aggregation related instructions, etc, determined from the network topology and destination keys defined for the end-hosts A-G, as described above.</p><p id="p0057" num="0057">In this example, a first end-host A being connected to an access router R1, sends a data packet to R1 in a first hop 3:1, destined to another end-host B being connected to an access router R5. End-host A has attached a sender tag to the packet which has been derived from an obtained sender key associated with the destination end-host B in the manner described above, thus associated exclusively to end-host B. The receiving router R1 then matches the router tag in the packet with entries in its forwarding table to determine an outgoing port that leads to router R2 as the next-hop router.</p><p id="p0058" num="0058">It can be seen from the network topology of this figure that all packets that are destined to any of end-hosts B-E, can be forwarded in router R2 by an aggregating router key that is associated to router R3 as the next hop, since R3 can forward packets to all of B-E. On the other hand, packets destined to end-hosts F and G should be<!-- EPO <DP n="23"> --> forwarded in router R2 by another aggregating router key that is associated to router R4 instead. In this description, a router key that is said to be "associated" to a particular router is to be generally understood as a key that matches a forwarding table entry with an outgoing port number providing a path to that router.</p><p id="p0059" num="0059">However, it should be noted that in the forwarding tables, there is not necessarily a one-to-one correspondence between which egress key and port to use. In fact, a plurality of next-hop routers may be available to forward packets towards a certain set of destinations "S". For instance, in the example of <figref idrefs="f0002">Fig. 3</figref>, router R2 could forward packets to D or E via either R3 or R4. Thus, more than one port may be used in router R2 to forward any packets containing an egress tag derived from one and the same egress key associated to destinations in set S. For example, local congestion conditions may dictate the use of a particular outgoing port regardless of the egress key value.</p><p id="p0060" num="0060">In this example, the table entry in R1 that matches the sender tag in the present received packet contains an aggregation related instruction dictating that aggregation towards R3 should be executed by router R1. However, the aggregation can be done in other ways, e.g. by the sending end-host A aided by a key manager or by another router in the transmission path. The aggregation related instruction in the matching table entry at router R1 thus dictates that aggregation should be executed by attaching a new egress tag to the packet which has been derived from an aggregating router key merely associated to router R3 and not to the more detailed destination of end-host B, hence the aggregation. However, the detailed destination of end-host B must somehow be preserved in the packet for later use, which<!-- EPO <DP n="24"> --> can be done in different ways as described later below. Router R1 then sends the packet with the new tag attached, to the determined next-hop router R2 in a second hop 3:2.</p><p id="p0061" num="0061">When receiving the packet from router R1, router R2 can match the attached tag with entries in its forwarding table to determine an outgoing port that accordingly leads to router R3. Before sending the packet further to router R3, router- R2 should execute de-aggregation, i.e. according to an aggregation related instruction found in the matching table entry at router R2, by changing the tag in the packet such that the tag used by the next router R3 to forward the packet is derived from a router key that is associated to router R5. Router R2 then sends the packet to router R3 with the changed tag attached, in a third hop 3:3.</p><p id="p0062" num="0062">Alternatively, Router R2 may send the packet to router R3 without changing the tag in the packet, wherein router R3 can deduce from the attached tag that the packet should be sent to router R5. Yet another alternative is that R2 executes de-aggregation by simply removing the tag pointing to R3 and leaving only the original tag associated directly to the destination B.</p><p id="p0063" num="0063">When receiving the packet from router R2, router R3 matches the attached tag with entries in its forwarding table to determine an outgoing port that accordingly leads to router R5. Moreover, according to an aggregation related instruction found in the matching table entry, router R3 executes further de-aggregation by changing the tag in the packet such that the tag used by the next router R5 to forward the packet is derived from a router key that eventually is associated to end-user B.</p><p id="p0064" num="0064">Router R3 then sends the packet to router R5 with the changed tag attached, in a fourth hop 3:4. Since the tag<!-- EPO <DP n="25"> --> in the packet is derived from a router key now associated to the final detailed destination address of end-user B, de-aggregation has been completed and the packet is therefore finally sent from router R5 to end-host B, in a final fifth hop 3:5.</p><p id="p0065" num="0065">In the example above, a two-level aggregation was executed at router R1 by attaching a tag derived from a key that merely is associated to router R3, and a one-level de-aggregation was executed in each of routers R2 and R3 by attaching tags derived from keys associated to router R5 and to end-host B, respectively. Thereby, the number of table entries can be reduced at least in routers R2 and R3 to provide for forwarding operations based on tags derived from aggregating router keys in the manner described above.</p><p id="p0066" num="0066">In this context, a "two-level aggregation" basically implies using a router key associated to a plurality of destination groups, while a one-level de-aggregation implies changing that router key to a router key associated to a single destination group. Further, when no aggregation is made, i.e. a "zero-level aggregation", a router key is used associated to a distinct destination, e.g. end-host. Generally expressed, a "k-level aggregation" implies using a router key associated to a group of plural (k-1)-level aggregated destinations. The term "k-level aggregating" implies changing the router key to a router key associated to a k-level aggregated set of destinations.</p><p id="p0067" num="0067">Reducing the number of table entries should be understood in relation to the alternative where each router maintains keys for all possible destinations handled by that router. For example, router R3 will only need to use 2 aggregating keys for routing associated to R5 and R6,<!-- EPO <DP n="26"> --> respectively, as opposed to 4 keys covering all 4 possible destinations B-E.</p><p id="p0068" num="0068">However, any other aggregation and de-aggregation schemes can be used, depending on the network topology and location of the sending and receiving end-hosts. For example, a transmission path may comprise any number of intermediate routers between access routers of the sending and receiving end-hosts, and any level of aggregation may be executed, either step-wise in plural successive routers along the path, or preferably by introducing multiple levels of aggregation at a single router. Further, it may not be necessary to execute aggregation nor de-aggregation at all in some router(s) in the path, which is controlled by aggregation related instructions in the matching table entries as described above. In the case of a hierarchical network topology, aggregation "upwards" in the hierarchy is first executed for the packet "early" in the transmission path, and de-aggregation "downwards" in the hierarchy is then executed "later" in the path.</p><p id="p0069" num="0069">Common for all these aggregation schemes is that the aggregation of routes is made to reduce the forwarding table size, while de-aggregation must be done for a transmitted packet to enable identification of its eventual destination. One skilled in the art will realise that many different methods can be applied to identify which router positions in the network topology are "most suitable" for executing the aggregation/de-aggregation, which is however outside the scope of this description.</p><p id="p0070" num="0070">It was mentioned above that when aggregation is executed, the final destination address of the receiving end-host must be preserved in the packet. If a tag generated from an aggregating router key, e.g. associated to a set of<!-- EPO <DP n="27"> --> destinations, were otherwise to simply replace a tag generated from a key associated exclusively to a single destination, the correct destination would, from this point on, be impossible to identify.</p><p id="p0071" num="0071">Two different embodiments of how this can be done in the transmission scenario of <figref idrefs="f0002">Fig. 3</figref> will now be described in more detail with reference to <figref idrefs="f0002">Fig. 3a</figref> and to Fig's 3b and 3c, respectively. Even though these embodiments refer specifically to the transmission example and network topology of <figref idrefs="f0002">Fig. 3</figref>, one skilled in the art will readily understand how to generally apply the described mechanisms and schemes in other transmission scenarios and network topologies.</p><p id="p0072" num="0072">In the embodiment illustrated by means of <figref idrefs="f0002">Fig. 3a</figref>, route aggregation is executed by combining the original tag attached to the packet by the sending end-host A with various added tags derived from aggregating router keys each effectively associated to plural end-hosts at different levels. In this embodiment, an ingress tag of a received packet may thus be composed of plural "sub-tags" when one or more levels of aggregation have already been made by previous routers, while the original tag is maintained in the packet as an "innermost" tag. Each packet-receiving router is then preferably obliged to use the "latest" or "outmost" tag to determine the next hop, i.e. matching that tag with candidate ingress keys in the forwarding table. If no match is found for the outmost tag, the router may try the next tag, and so forth. If no match is found for any sub-tag, the packet may be discarded or routed according to a default routing policy.</p><p id="p0073" num="0073">When multiple tags are used in this manner to compose a total ingress or egress tag, it should be<!-- EPO <DP n="28"> --> indicated where to find each individual sub-tag within the packet. For instance, each sub-tag may start with a "bit-offset" or the like, indicating where the next tag can be found and the last tag may then have a zero-offset to indicate "no further tags" or similar. Another possibility is to use a predetermined fixed size for the sub-tags known in beforehand to the routers. In any case, tags can be added in a header of the packet, or, as exemplified in the figures, in a "tail" or "trailer" of the packet.</p><p id="p0074" num="0074"><figref idrefs="f0002">Fig. 3a</figref> shows the packet with a payload field and different tags attached at the different hops in the transmission scenario of <figref idrefs="f0002">Fig. 3</figref>. Thus, when end-host A sends the packet to the first-hop router R1 in hop 3:1, only the original tag denoted "TAG 1" is attached thereto, derived from a destination key that is associated exclusively to end-user B.</p><p id="p0075" num="0075">When router R1 sends the packet to the next router R2 in hop 3:2, two additional sub-tags denoted "TAG 2" and "TAG 3" have been attached to the packet alongside the original tag, where TAG 2 is placed next to TAG 1 and TAG 3 is placed next to TAG 2. Router R1 has derived TAG 2 and TAG 3 from respective aggregating router keys according to the aggregation related instruction in the matching table entry. TAG 3 is the packet's latest or outmost sub-tag representing the highest level router key with respect to aggregation, in this case associated to router R3, and should therefore be used by the packet receiving router R2 to find the next-hop router R3.</p><p id="p0076" num="0076">When router R2 has found router R3 based on TAG 3, de-aggregation is executed by removing the outmost sub-tag TAG 3 from the packet, leaving TAG 2 as the outmost sub-tag associated to router R5 when the packet is sent to R3 in hop<!-- EPO <DP n="29"> --> 3:3. Likewise, when router R3 has found router R5 based on TAG 2, a further de-aggregation step is executed by removing the outmost sub-tag TAG 2 from the packet, leaving the original TAG 1 associated exclusively to end-host B when the packet is sent to R5 in hop 3:4.</p><p id="p0077" num="0077">Generally speaking, the ingress tag of a received packet is changed in this embodiment by attaching one or more additional sub-tags, derived from one or more egress keys in a matching table entry, to the packet to execute aggregation, whereas the total ingress tag is changed by removing the additional sub-tags from the packet, one by one, to execute de-aggregation.</p><p id="p0078" num="0078">In the description above for <figref idrefs="f0002">Fig. 3a</figref>, it is assumed that the added TAG 2 and TAG 3 are simply concatenated successively with the original TAG 1 to create a new egress tag. However, it is possible to add these sub-tags in a more integrated manner such that a new egress tag is formed by a combination of the original TAG 1 and the added TAG 2 and TAG 3. In the general case, a predetermined combination function "C" can be applied to the received ingress tag and one or more tags derived from one or more egress keys of a matching table entry. The function C may be concatenation, as described above, or some other function, e.g. the known logical "XOR" function. If n egress keys are found in a matching table entry, this can be generally expressed as: <maths id="math0001" num="(1)"><math display="block"><mi>new egress tag</mi><mo>=</mo><mi mathvariant="normal">C</mi><mfenced separators=""><mi>ingress tag</mi><mo>,</mo><mspace width="1em"/><mi>TDF</mi><mfenced separators=""><mi>egress</mi><mspace width="1em"/><msub><mi>key</mi><mn mathvariant="normal">1</mn></msub></mfenced><mo>,</mo><mspace width="1em"/><mi>TDF</mi><mfenced separators=""><mi>egress</mi><mspace width="1em"/><msub><mi>key</mi><mn mathvariant="normal">2</mn></msub></mfenced><mo>…</mo><mo>,</mo><mi>TDF</mi><mfenced separators=""><mi>egress</mi><mspace width="1em"/><msub><mi>key</mi><mi mathvariant="normal">n</mi></msub></mfenced></mfenced></math><img id="ib0001" file="imgb0001.tif" wi="160" he="14" img-content="math" img-format="tif"/></maths></p><p id="p0079" num="0079">It should be noted that while this approach can be used to save communication bandwidth, it also makes the matching operation more complex. For instance, in a<!-- EPO <DP n="30"> --> forwarding table with N ingress keys, to process an ingress tag combined by 3 XOR:ed tags, roughly N^3 possible ingress key combinations may need to be considered. At the same time, the need for bandwidth is roughly reduced threefold.</p><p id="p0080" num="0080">As described above, when a matching table entry is found, a new egress tag is created for the packet according to the aggregation related instruction in the matching table entry. For example, this instruction may dictate any of the following:
<ul><li>Apply the matching function to the "next" tag even if a match has already been found for an outmost tag,</li><li>Use one or more egress keys in the matching table entry to generate one or more additional sub-tags for the packet to execute aggregation,</li><li>Remove zero or more sub-tags before attaching the new egress tag as the outmost sub-tag to execute de-aggregation.</li><li>Apply a combination function C (e.g. concatenation, a logical XOR-operation, etc.) to a received ingress tag in the packet and one or more egress keys in the matching table entry to execute either aggregation or de-aggregation.</li></ul></p><p id="p0081" num="0081">When using the tag combination function of (1), adding a tag could in fact potentially mean either "aggregate" or "de-aggregate", depending on whether the key used to produce the added sub-tag represents a larger or smaller set of destinations. Thus aggregation/de-aggregation may be implicit from the "type" of egress key used. Further, it can sometimes be assumed that the very first router in the path has sufficient knowledge to perform all aggregation<!-- EPO <DP n="31"> --> levels at once, as router R1 in the example above, such that only de-aggregation will take place in subsequent routers.</p><p id="p0082" num="0082">In the above embodiment exemplified by <figref idrefs="f0002">Fig. 3a</figref>, once the network topology and aggregation/de-aggregation points have been determined, each destination or group of destinations could technically be assigned random, independent destination and router keys, to be distributed to appropriate routers. However, it is possible to reduce the number of keys that need to be explicitly distributed and managed, which is shown in the other embodiment illustrated jointly by means of Fig's 3b and 3c. In this embodiment, a hierarchical scheme of router keys and destination keys is used for executing aggregation of routes at different levels by exchanging the original tag, attached to the packet by the sending end-host A, for a new tag derived from an aggregating router key. A piece of associated aggregation information is also added to the tag, that can be used to determine the original destination.</p><p id="p0083" num="0083"><figref idrefs="f0002">Fig. 3b</figref> shows an example of how such a hierarchical key scheme with nodes at different levels of a tree structure can be generated from a root value x by means of a function f(p,q), where p is the router key value of a node position above in the tree and q is an integer indicating a node position within the current tree level. The resulting key scheme will then be composed of key values that can be calculated, along a path from the root downwards, according to the following chain:</p><p id="p0084" num="0084">(x, f(x), f(f(x)), ..., f(f(...f(x)...))), and so forth. The destination keys of individual end-hosts in the network have key values at nodes right at the bottom of this tree structure, forming "leaves" on the tree.<!-- EPO <DP n="32"> --></p><p id="p0085" num="0085">It should be noted that the tree structure should not be understood as reflecting a physical network topology, but it should in general be viewed as a logical overlay on the physical network. In particular, all leaves are not necessarily "occupied" by a physical end-host. Moreover, while the higher-level (non-leaf) keys intuitively correspond to intermediate nodes in the network, i.e. routers, all intermediary nodes are not necessarily actually associated with physical routers. For instance, a certain router R could handle a sub-set of the keys, e.g. corresponding to a sub-set of the tree, and so forth.</p><p id="p0086" num="0086">From the value of f(p,q) of any node in this tree-structure, the entire sub-tree of f-values below that node can be easily generated. Assuming that destination keys of end-hosts correspond to leaves of the tree-structure, any f-values on one or more tree levels above the leaves can be used as aggregating router keys. Thereby, a cryptographic tree structure of keys can be superimposed on any hierarchic router topology. In one possible embodiment, the function f may be a one-way function which is easy to compute "forwards" but difficult to compute "backward", i.e. to "invert" the function. Although the tree structure shown in <figref idrefs="f0002">Fig. 3b</figref> is binary, it is possible to use any "n-ary" or other tree structure to generate router and destination keys, and the present embodiment is not limited in this respect.</p><p id="p0087" num="0087">Thus, by distributing a single key value to a router, the entire (sub-)tree below that key value can be re-constructed locally by the router, without explicitly distributing any additional key(s). On the other hand, it may be a security advantage that keys associated to "higher level" routers (which may conceptually be more "important"<!-- EPO <DP n="33"> --> routers) cannot be deduced from keys associated to "lower level" routers or end-hosts.</p><p id="p0088" num="0088">Aggregation is executed by moving "upwards" in the tree structure to select a new egress key for the packet, while de-aggregation is done by moving "downwards" in the tree to select a new egress key. Thus, when aggregation is executed for a packet by attaching a tag derived from a new key one or more tree levels above the previous key, the added aggregation information should basically indicate at which branch the previous key was located. In the case of a binary key tree structure, this information may simply be either "left" or "right" for each aggregation level. In the general case of a n-ary key tree structure, this information would comprise an integer between 1 and n for each aggregation level.</p><p id="p0089" num="0089">For example, if a router has found a match for a key k = f(x,1) in its forwarding table and should de-aggregate towards the destination by moving downwards in a tree from the node f(x,1), according to an associated aggregation related instruction in the forwarding table, it must be determined whether de-aggregation should be made towards f(f(x,1),a) or towards f(f(x,1),b), since f(x,1) is a common root of both. This can be solved by adding associated aggregation information at each aggregation step, as indicated above.</p><p id="p0090" num="0090">Thus, if an aggregating router earlier in the transmission path exchanges a tag generated by f(f(x,1),a) by one generated by f(x,1), the router can add "a" to the tag as aggregation information. This information "a" will enable a de-aggregating router later in the transmission path to de-aggregate from f(x,1) towards f(f(x,1),a), and not towards f(f(x,1),b). In general, each aggregation step<!-- EPO <DP n="34"> --> will thus expand the tag size with one piece of aggregation information.</p><p id="p0091" num="0091">As mentioned above, if the function f is a one-way function, it is not possible to compute "upwards" in the tree structure to execute aggregation, although it is relatively easy to compute "downwards" in the tree structure to execute de-aggregation. This can be solved as follows. Assuming that a router in the network has some "highest" level of aggregation that it should perform, a key can be distributed to that router located at a node position high enough in the tree to enable the router to compute any node value in a sub-tree below that highest node position to produce an aggregating router key. Thus, if a router is given a key corresponding to the root of a sub-tree, and also knowing the function f, it can compute all node values in the entire sub-tree below the given root key for aggregation of the corresponding destinations.</p><p id="p0092" num="0092"><figref idrefs="f0003">Fig. 3c</figref> shows the packet with a payload field and different tags attached at the different hops in the transmission scenario of <figref idrefs="f0002">Fig. 3</figref>, in this case using the hierarchical router key scheme of <figref idrefs="f0002">Fig. 3b</figref>. In this example, a tag in a received packet is also exchanged for a new tag derived from an aggregating or de-aggregating router key as follows. As in the embodiment of <figref idrefs="f0002">Fig. 3a</figref>, only the original tag denoted "TAG o", derived from a destination key that is associated exclusively to end-host B, is attached to the packet sent from end-host A to the first-hop router R1 in hop 3:1.</p><p id="p0093" num="0093">When router R1 sends the packet to the next router R2 in hop 3:2, a new tag "TAG ij" is attached to the packet derived from a two-level aggregating router key according to an aggregation related instruction in the matching table<!-- EPO <DP n="35"> --> entry. "TAG ij" is derived from a router key associated to router R3, which thus can be used by the packet receiving router R2 to find the next-hop router R3. Additional aggregation information "Agg-info ij" is also attached to the packet alongside "TAG ij" indicating how the aggregation was made for two levels i and j, respectively, thereby enabling de-aggregation towards the correct key in routers further down the transmission path.</p><p id="p0094" num="0094">As described above, aggregation information "a" can generally be added to the new tag enabling de-aggregation from f(x,1) towards f(f(x,1),a). In this case, "Agg-info ij" indicates a two-level aggregation such that de-aggregation can be executed in two following routers for levels i and j, respectively. Specifically, "Agg-info ij" would indicate that the path from the key associated to R3 leads to B via R5. In this binary tree example, two "left" branches should be followed from R2 when executing de-aggregation according to "Agg-info ij".</p><p id="p0095" num="0095">When router R2 has found router R3 based on "TAG ij", de-aggregation is executed by exchanging "TAG ij" for a new tag "TAG i" associated to router R5 when the packet is sent to R3 in hop 3:3. Also, new aggregation information "Agg-info i" associated with the new tag is also attached to the packet alongside "TAG i" indicating how the aggregation was made for level i, i.e. that the "left" branch should be followed in the next hop 3:4. Likewise, when router R3 has found router R5 based on "TAG i", a further de-aggregation step is executed by exchanging the previous "TAG i" for the original "TAG o" associated exclusively to end-host B when the packet is sent to R5 in hop 3:4.</p><p id="p0096" num="0096">Generally speaking, aggregation is executed in this embodiment by exchanging a tag in a received packet for a<!-- EPO <DP n="36"> --> new tag, being derived from an aggregating router key according to the aggregation instructions, and also attaching additional associated aggregation information indicating how the aggregation was made. On the other hand, de-aggregation is executed by exchanging a tag in a received packet for a new tag determined based on the additional aggregation information in the packet.</p><p id="p0097" num="0097">While the embodiment of Fig's 3b-c above is based on a hierarchical key structure, it is possible to use either a "flat" key structure with more or less randomly generated key values, or a hierarchical key structure as described above, in the embodiment of <figref idrefs="f0002">Fig. 3a</figref>. Further, these two embodiments can also be used either separately or in conjunction.</p><p id="p0098" num="0098">If a matching table entry is found for the received ingress tag, a new egress tag is created for the packet according to the aggregation related instruction in the matching table entry. Assuming that a certain key value k in the key tree has resulted in a match, this instruction may dictate any of the following:
<ul><li>Execute aggregation by using a key at a certain level "above" k in the tree to produce the new egress tag. This also typically implies adding aggregation information in the case of a hierarchical key structure.</li><li>Execute de-aggregation by using a key at a certain level "below" k according to the additional aggregation information in the packet, to produce the egress tag.</li><li>Execute neither aggregation nor de-aggregation. The new egress tag may in this case be generated either using the same key k, or an explicit egress key in the matching table entry. This key may be part of another key tree,<!-- EPO <DP n="37"> --> generated as part of some other key tree, e.g. for routing between different administrative domains where each domain would typically have distinct key trees.</li></ul></p><p id="p0099" num="0099">The aggregation/de-aggregation scheme used could also be implicit by simply configuring the forwarding tables in the routers with appropriate egress keys according to the key hierarchy described above.</p><p id="p0100" num="0100">The aggregation mechanisms above can also be further understood by considering an analogy from the transmission of a physical letter by ordinary post mail. The detailed destination address is originally presented on the letter typically including a street address, city and country, effectively forming a hierarchical addressing scheme. For example, a letter may be sent from Texas in the US to 17 Main Street, Stockholm, Sweden. The receiving post office in Texas will immediately see that the letter is directed to Sweden, but will not need to read the more detailed information of street address and city. This could mean that the letter is first sent to an international post terminal in New York which sends all outgoing post destined to Sweden, to an international post terminal of Gothenburg in Sweden.</p><p id="p0101" num="0101">Initially, two levels of aggregation have thus been made by only reading the country in the address to determine the "next hop" for the letter, discarding the levels of both city and street, respectively. Referring to <figref idrefs="f0002">Fig. 3</figref>, router R1 may thus be equivalent to the post office in Texas, router R2 may be equivalent to the post terminal in New York, while router R3 may be equivalent to the post terminal in Gothenburg, Sweden, and so forth. More detailed information in the address of the letter will then be read<!-- EPO <DP n="38"> --> in Gothenburg and Stockholm, respectively, as a result of gradual de-aggregation. In this context, the need for multiple tags and/or path information in the key tree can also be understood as follows. The analogy for not using multiple tags would be that the post office in Texas, only being interested in the country of destination, would in that case erase street/city from the address and only keep "Sweden" before forwarding the letter. While the letter would reach Sweden, it would not be possible to "route" the letter any further towards the destination.</p><p id="p0102" num="0102"><figref idrefs="f0003">Fig. 4</figref> is a block diagram illustrating how the forwarding of a data packet, sent from an end-host A towards a target end-host, not shown, can be supported in a packet-switched network, according to some further exemplary embodiments. This procedure is shown as a series of actions or steps mainly involving end-host A, a key manager 400 and a router 402 somewhere in the transmission path between end-host A and the target end-host. In this example, router 402 employs aggregation of routes as described below.</p><p id="p0103" num="0103">In a first <b>step 4:1,</b> destination keys associated with various end-hosts B,C,D, ... are registered and stored in the key manager 400, where each unique destination key actually identifies or "defines" a corresponding destination, i.e. end-host. In this process, a destination key may be settled in agreement between the end-host and the key manager 400, preferably after authenticating the end-host. Effectively, this step can substitute the assignment of IP addresses to end-hosts according to the prior art.</p><p id="p0104" num="0104">Key manager 400 also determines the location of routers that can execute aggregation and de-aggregation, respectively, in a <b>step 4:2.</b> Various different ways can be conceived to determine the location of aggregation and de-aggregation<!-- EPO <DP n="39"> --> in the network topology, e.g. dependent on forwarding table size, and/or by determining a hierarchical network structure, the location of end-hosts, and so forth, which is however not necessary to describe here further. Key manager 400 further creates aggregating router keys and associated aggregation related instructions from the above registered destination keys, in a next <b>step 4:3.</b> As mentioned above when describing <figref idrefs="f0001">Fig. 2a</figref>, a key index may also be defined for each created router key. The destination keys and router keys may be arranged in a hierarchical or "flat" key structure, which may however impose different aggregation schemes as described above.</p><p id="p0105" num="0105">Then, key manager 400 generally distributes the created aggregating router keys with associated aggregation related instructions and optional key indexes, to routers in the network where aggregation can be employed, including the router 402 shown here, in a further <b>step 4:4.</b> Key manager 400 may also distribute non-aggregating router keys and destination keys to some of the routers, which is however not considered in this description. The routers are then able to configure their own forwarding tables accordingly, comprising the distributed aggregating router keys and optional key indexes which will be used to forward incoming data packets, thereby creating a useful forwarding architecture in the network. By using aggregating router keys, excessively large forwarding tables can thus be avoided as explained above. The forwarding operation in a router based on an aggregating router key will be described in more detail later below.</p><p id="p0106" num="0106">The distribution of router keys, associated aggregation related instructions and optional key indexes may be executed in a configuration process or otherwise,<!-- EPO <DP n="40"> --> e.g. using a routing protocol such as when configuring a conventional forwarding architecture in a router domain as described above. The routers can then configure their forwarding tables with entries comprising different ingress and egress keys and outgoing ports, based on the distributed information. A distributed router key may in fact include a pair of ingress and egress keys.</p><p id="p0107" num="0107">End-host A intends to communicate with a target end-host and at some point, in a next <b>step 4:5,</b> accordingly sends an address query or similar to the key manager 400, e.g. referring to an e-mail address or web address of the target end-host in a conventional manner such as described above. Key manager 400 may then apply a policy defined for the target end-host, to determine if the querying end-host is authorised to send data packets to the target end-host or not.</p><p id="p0108" num="0108">Assuming that end-host A is authorised and can be allowed to send packets to the target end-host, the key manager 400 retrieves the destination key associated with the target end-host and creates a sender key from the destination key by applying a key derivation function KDF to at least the destination key and optionally also to other data such as the identity of the querying end-host, a time stamp, and/or a random number used for randomisation, often referred to as "RAND" or "NONCE". This can be expressed as: <maths id="math0002" num="(2)"><math display="block"><mi>Sender_key</mi><mo>=</mo><mi>KDF</mi><mfenced separators=""><mi>Destination_key</mi><mo>,</mo><mo>&lt;</mo><mi>other data</mi><mo>&gt;</mo></mfenced></math><img id="ib0002" file="imgb0002.tif" wi="154" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0109" num="0109">If the identity of the querying end-host is used as "other data" in (2), the sender key will be uniquely associated with that end-host. KDF may preferably be a cryptographic function or the like.<!-- EPO <DP n="41"> --></p><p id="p0110" num="0110">In a further <b>step 4:6,</b> key manager 400 then provides the sender key to end-host A, in response to the query of step 4:5, such that end-host A can derive a sender tag therefrom and send data packets to the target end-host with the sender tag attached as ingress tag. The access router to which end-host A is connected should also be able to access the same sender key in order to perform a matching operation on the ingress tag, which is however not considered in this description.</p><p id="p0111" num="0111">End-host A thus applies a predefined first tag derivation function TDF to at least the received sender key, to create a sender tag "TAG" which is inserted as egress tag in a packet which is transmitted in a next <b>step 4:7.</b> The egress tag can be inserted in the destination field in the packet header, just as the destination IP address would be conventionally according to the prior art.</p><p id="p0112" num="0112">Depending on the implementation, the TDF may also be applied to "other data" such as payload data contained in the packet to be sent, a time stamp, and/or to a RAND or NONCE used for randomisation. This can be expressed as: <maths id="math0003" num="(3)"><math display="block"><mi>Sender_tag</mi><mo>=</mo><mi>TDF</mi><mfenced separators=""><mi>Sender_key</mi><mo>,</mo><mo>&lt;</mo><mi>other data</mi><mo>&gt;</mo></mfenced></math><img id="ib0003" file="imgb0003.tif" wi="154" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0113" num="0113">If payload in the packet is comprised in the "other data", the sender tag will be unique for that packet only. TDF may be a cryptographic function or the like. End-host A may have been preconfigured to use TDF when transmitting data packets, or TDF may be submitted to end-host A together with the sender key in step 4:6. Furthermore, TDF is also known in the network, at least to the access router of end-host A.<!-- EPO <DP n="42"> --></p><p id="p0114" num="0114">Attaching the sender tag to a transmitted data packet will effectively authorise that packet to be routed towards its destination through the network. If a router detects that a received data packet does not contain any valid tag, the packet cannot be authorised and may simply be discarded. Thus, any attempt to attach a fake sender tag to a packet will most likely be unsuccessful if the TDF is a "strong" cryptographic function, and any packet with a non-valid tag attached will effectively be stopped in the forwarding process.</p><p id="p0115" num="0115">In a further <b>step 4:8,</b> the data packet originally sent from end-host A is received by an ingress part 402a at router 402. An ingress tag "TAG" is attached to the received packet, and optionally also an ingress key index, if used. The packet may be received from a previous router, not shown, or directly from end-host A if router 402 is A's access router. A forwarding unit 402b at router 402 is generally configured to perform a forwarding operation for each incoming data packet by means of a forwarding table schematically shown in forwarding unit 402b, in order to find an outgoing port in an egress unit 402c.</p><p id="p0116" num="0116">In a further <b>step 4:9,</b> forwarding unit 402b executes a matching operation for the attached "TAG" and different ingress keys IK in the forwarding table, using a known TDF, in order to find a matching entry in the table. In other words, forwarding unit 300b tries to match the received ingress tag with an ingress key IK for one entry at a time in the table.</p><p id="p0117" num="0117">In more detail, the matching operation may include that the router applies the TDF to a "candidate" ingress key in a row of the forwarding table to derive a candidate ingress tag. If the candidate ingress tag satisfies a<!-- EPO <DP n="43"> --> predetermined relation with the received ingress tag in the packet, a match is considered to be found. The predetermined relation may be equality, i.e. a match is considered to be found if the candidate ingress tag is identical to the ingress tag in the packet. If the two tags do not match, the next candidate key in the table is tried, and so forth.</p><p id="p0118" num="0118">If an ingress key index IKi was included in the received packet, it is only necessary to perform the matching operation to the one or more entries in the table that contains that ingress key index IKi. Using an ingress key index IKi will thus effectively speed up the matching operation for each received data packet by limiting the number of potential candidate ingress tags in the table. It is also possible to only use an included ingress key index IKi to find the proper port, i.e. without performing the matching operation for security.</p><p id="p0119" num="0119">It should be noted that when aggregated router keys are used but not key indexes, it may be useful to populate the entries of a router's table with keys corresponding to high (or higher) levels of aggregation in the same order by which the router performs a sequential search in the table for a match. Thereby, a matching table entry can be found as early as possible.</p><p id="p0120" num="0120">If a matching entry is found in step 4:9, the port in that entry, in this case port P(x), is determined as the proper outgoing port for the packet, in a following <b>step 4:10.</b> If no matching entry is found in step 4:9, the packet is not authorised and will therefore be discarded in step 4:10, thereby stopping any such packets from being forwarded in this router. The matching operation of step 4:9 will thus authorise the packet for further routing.<!-- EPO <DP n="44"> --></p><p id="p0121" num="0121">Since router 402 employs aggregation of multiple destinations, its forwarding table comprises an aggregation related instruction associated with each aggregating router key in the table, which is read from a policy field in the table, such as in column 210 in <figref idrefs="f0001">Fig. 2a</figref>. In this case, the matching table entry contains an aggregation related instruction and forwarding unit 402b thus creates a new egress tag for the packet based on that instruction, in a next <b>step 4:11.</b> This can be done according to any of the embodiments described with reference to Fig's 3a-c above, thus either exchanging the received tag for a new tag together with associated aggregation information when a hierarchical key scheme is used, or adding/removing an additional tag to/from the received tag when combined tags are used.</p><p id="p0122" num="0122">Another tag derivation function TDF' may also be applied to an egress key EK found in the matching entry, to obtain a new additional or exchanged tag. The TDF' should be known by the next-hop router to enable a matching operation therein. TDF and TDF' may be different or equal functions.</p><p id="p0123" num="0123">The new egress tag TAG' can thus be expressed as: <maths id="math0004" num="(4)"><math display="block"><mi>Egress_tag</mi><mo>=</mo><mi>TDFʹ</mi><mfenced separators=""><mi>Egress router_key</mi><mo>,</mo><mo>&lt;</mo><mi>other data</mi><mo>&gt;</mo></mfenced></math><img id="ib0004" file="imgb0004.tif" wi="154" he="9" img-content="math" img-format="tif"/></maths></p><p id="p0124" num="0124">The "other data" in (4) may be payload data contained in the packet, and/or a RAND or NONCE used for randomisation. The new combined or exchanged egress tag is attached to the packet in a further <b>step 4:12.</b></p><p id="p0125" num="0125">If key indexing is used, an egress key index EKi found in the matching entry is also attached to the packet in step 4:11. The attached EKi will then be used in the next-hop router as ingress key index IKi to find the<!-- EPO <DP n="45"> --> relevant row(s) in its forwarding table for executing the matching operation, and so forth.</p><p id="p0126" num="0126">According to the matching table entry, the packet is then forwarded to port P(x) of the egress unit 402c, in a following <b>step 4:13.</b> Finally, the packet with the new egress tag TAG' attached is sent out on port P(x) as the next hop, in a last <b>step 4:14.</b> The next-hop router will then be able to match the new ingress tag TAG' with entries in its forwarding table to determine the next hop, basically in the same fashion as described above.</p><p id="p0127" num="0127"><figref idrefs="f0004">Fig. 5</figref> is a flow chart with steps in an exemplary procedure to support a forwarding process for data packets in routers of a packet-switched network, as executed by a key manager, e.g. the key manager 400 in <figref idrefs="f0003">Fig. 4</figref>. In a first <b>step 500,</b> destination keys are registered for different end-hosts connected to access routers in the network, e.g. as explained above for step 4:1 of <figref idrefs="f0003">Fig. 4</figref>. In a next <b>step 502,</b> it is determined the location of routers in the network that can execute route aggregation and de-aggregation, respectively, e.g. as in step 4:2 of <figref idrefs="f0003">Fig. 4</figref>.</p><p id="p0128" num="0128">In a further <b>step 504,</b> aggregating router keys and associated aggregation related instructions are created based on the determined placement of aggregation and de-aggregation, each aggregating router key generally representing a set of plural destinations, e.g. as in step 4:3 of <figref idrefs="f0003">Fig. 4</figref>. In a next <b>step 506,</b> the aggregating router keys and associated aggregation related instructions above are distributed to the routers that can execute route aggregation and de-aggregation, respectively, e.g. as in step 4:4 of <figref idrefs="f0003">Fig. 4</figref>. Thereby, these routers are enabled to configure their own forwarding tables from the distributed information. Non-aggregating router keys and destination<!-- EPO <DP n="46"> --> keys may also be distributed to some of the routers, which is however not considered in this description. Steps 500-506 could be executed in a configuration procedure or otherwise.</p><p id="p0129" num="0129">In a further <b>step 508,</b> an address query is received at some point from a querying end-host, basically requesting a destination address or similar of a target end-host. The address query can be made in a conventional manner such as described above, e.g. referring to an e-mail address or web address of the target end-host. In a next <b>step 510,</b> a sender key is created by applying a key derivation function KDF to at least a destination key associated with the target end-host, or to a key related to said destination key.</p><p id="p0130" num="0130">In a final <b>step 512,</b> the key manager provides the sender key to the querying end-host derived from a destination key associated with the target end-host. It may also be checked whether the querying end-host is authorised to send data packets to the target end-host. If not, the query may simply be rejected. Thereby, the querying end-host is able to get across data packets to the target end-host by attaching a sender tag derived from the received sender key to each transmitted packet, basically in the manner described above for step 4:7.</p><p id="p0131" num="0131"><figref idrefs="f0005">Fig. 6</figref> is a flow chart with steps in an exemplary procedure for supporting a forwarding process for received data packets in a router of a packet-switched network, e.g. the router 402 in <figref idrefs="f0003">Fig. 4</figref>. In a first <b>step 600,</b> a forwarding table is configured from aggregating router keys and associated aggregation related instructions received from a key manager, e.g. a DNS system, as in step 4:4 of <figref idrefs="f0003">Fig. 4</figref>.</p><p id="p0132" num="0132">In a next <b>step 602,</b> a data packet is received by the router. The packet may have been transmitted either from a neighbouring router, or from a sending end-host as the<!-- EPO <DP n="47"> --> first hop if the router is an access router for the sending end-host, e.g. as in hop 3:1 in <figref idrefs="f0003">Fig. 4</figref>. In an optional next <b>step 604,</b> it may be checked whether the packet contains an ingress tag derived from a key that the key manager has provided. If no such ingress tag is found, the packet could be discarded at this point in a further <b>step 606.</b></p><p id="p0133" num="0133">On the other hand, if the packet contains an ingress tag, a matching operation is applied to the received ingress tag and different candidate ingress keys in the forwarding table, e.g. using a known TDF as described above for step 4:9 in <figref idrefs="f0003">Fig. 4</figref>, in a following <b>step 608,</b> in order to find a matching entry in the table. If key indexing is used in the forwarding table and a key index is also attached to the received packet, the key index can be used in this step to limit the matching operation to one entry or just a few entries in order to rapidly find a matching entry in the table.</p><p id="p0134" num="0134">In a next <b>step 610,</b> it is determined whether a matching entry is found in the forwarding table by means of the matching operation. If not, the packet is discarded in a <b>step 612.</b> If a matching entry is found, an outgoing port is selected for the packet according to the matching entry, in a further <b>step 614.</b></p><p id="p0135" num="0135">In a following <b>step 616,</b> it is further checked whether an aggregation related instruction is present in the matching table entry, which is thus associated with the ingress key in the matching table entry, basically instructing the router to execute either aggregation or de-aggregation. If present, the aggregation related instruction may thus dictate that the received tag should be changed, or that one or more router tags should be added or removed<!-- EPO <DP n="48"> --> to/from the packet, respectively, according to any of the embodiments described for Fig's 3a-c above.</p><p id="p0136" num="0136">If no such aggregation related instruction is found in the entry, a new egress tag may be derived by applying a tag derivation function to an egress key in the matching table entry, in an optional <b>step 618.</b> Alternatively, the received tag may be reused as egress tag when sending the packet to the next hop router.</p><p id="p0137" num="0137">On the other hand, if an aggregation related instruction is present in the matching table entry, a new egress tag is created according to that instruction, in a further <b>step 620.</b> Finally, the packet is sent to the next hop router from the determined port with the new egress tag attached, in a last shown <b>step 622.</b> If key indexing is used, an egress key index in the matching table entry may also be attached to the packet. The receiving next hop node is then able to basically repeat the procedure according to steps 600-622 above.</p><p id="p0138" num="0138"><figref idrefs="f0006">Fig. 7</figref> is a logic block diagram illustrating in more detail an apparatus in a key manager 700 and an arrangement in a router 702 in a packet-switched network, for supporting the forwarding of data packets in the network, in accordance with further exemplary embodiments.</p><p id="p0139" num="0139">Key manager 700 comprises a network controlling unit 700b adapted to register destination keys for end-hosts connected to access routers in the network. The network controlling unit 700b is further adapted to determine the location of routers in the network that can execute route aggregation and de-aggregation, respectively, e.g. based on a forwarding table size, a hierarchical network structure, the location of end-hosts, etc.<!-- EPO <DP n="49"> --></p><p id="p0140" num="0140">Key manager 700 also comprises a key distributor 700c adapted to create aggregating router keys and associated aggregation instructions, each aggregating router key representing a set of plural destinations. Key distributor 700c is further adapted to distribute the aggregating router keys and associated aggregation instructions to the routers that can execute route aggregation and de-aggregation, thereby enabling the routers to configure their own forwarding tables.</p><p id="p0141" num="0141">Network controlling unit 700b may also hold information indicating which end-hosts are authorised to send packets to each registered end-host. This information may comprise policies defined for the registered end-hosts and determining if a querying end-host is authorised to send data packets to a particular destination.</p><p id="p0142" num="0142">The key manager 700 further comprises an address query manager 700a adapted to receive an address query from a querying end-host A regarding a target end-host, not shown. The address query manager 700a is also adapted to create a sender key by applying a key derivation function KDF to at least a destination key associated with the target end-host or to a key related to said destination key, and to send the created sender key to the querying end-host in response to the address query. Thereby, the querying end-host is able to get across data packets to the target end-host by attaching a sender tag generated from the sender key to a transmitted data packet, the sender tag directing the transmitted data packet to the target end-host.</p><p id="p0143" num="0143">The router 702 comprises an ingress part 704 adapted to receive a data packet P from a neighbouring node such as another router in the network, or directly from a sending end-host. The ingress part 704 may be further<!-- EPO <DP n="50"> --> adapted to admit the packet if a valid ingress tag is attached to the packet, and to otherwise discard the packet if not including a valid ingress tag.</p><p id="p0144" num="0144">The router 702 also comprises a forwarding unit 706 adapted to configure a forwarding table from aggregating router keys and associated aggregation related instructions received from key distributor 700c in the key manager 700. Forwarding unit 706 also comprises a forwarding table 706a and a tag matching unit 706b for matching the received ingress tag with ingress keys in entries of the forwarding table 706a, to determine an outgoing port for the packet from a matching table entry, e.g. in the manner described for steps 4:9-4:10 in <figref idrefs="f0003">Fig. 4</figref> and steps 608-614 in <figref idrefs="f0005">Fig. 6</figref>, respectively.</p><p id="p0145" num="0145">The forwarding unit 706 further includes a tag creating unit 706c adapted to create an egress tag for the packet according to an aggregation related instruction present in a matching table entry. The router 702 also comprises an egress part 708 adapted to send the packet to a next hop node, e.g. another neighbouring router, from the determined outgoing port with the created new egress tag attached to the packet.</p><p id="p0146" num="0146">It should be noted that <figref idrefs="f0006">Fig 7</figref> merely illustrates various functional units in the key manager 700 and router 702, respectively, in a logical sense. However, the skilled person is free to implement these functions in practice using any suitable software and hardware means. Thus, the present invention is generally not limited to the shown structure of the key manager 700 and router 702.</p><p id="p0147" num="0147">In this solution, a router can thus match an ingress tag included in a received data packet with routing or ingress keys in the forwarding table, in the manner<!-- EPO <DP n="51"> --> described above, to verify the packet and, at the same time find the correct outgoing port. If a match is found in an entry of the forwarding table, the port number in that entry is determined to be the correct outgoing port for the packet.</p><p id="p0148" num="0148">The described embodiments enable a forwarding architecture where scalable forwarding tables can be used in routes. The routing of data packets can also be controlled to avoid flooding, spamming, virus, fraud, DoS attacks and generally unsolicited traffic. While the invention has been described with reference to specific exemplary embodiments, the description is generally only intended to illustrate the inventive concept and should not be taken as limiting the scope of the invention. The present invention is defined by the appended claims.</p></description><claims mxw-id="PCLM56985755" lang="DE" load-source="patent-office"><!-- EPO <DP n="59"> --><claim id="c-de-01-0001" num="0001"><claim-text>Verfahren zum Unterstützen des Weiterleitens von empfangenen Datenpaketen in einem Router (402, 702) eines paketvermittelten Netzes, die folgenden Schritte umfassend:
<claim-text>- Konfigurieren einer Weiterleitungstabelle auf der Basis von Aggregationsrouterschlüsseln und assoziierten Aggregation betreffenden Anweisungen, die von einem Schlüsselmanager empfangen werden, wobei jeder Aggregationsrouterschlüssel einen Satz von Zielen repräsentiert,</claim-text>
<claim-text>- Empfangen eines Datenpakets, einen Ingress-Tag umfassend, der von einem Senderschlüssel oder Routerschlüssel abgeleitet ist,</claim-text>
<claim-text>- Anwenden einer Matching-Funktion auf den empfangenen Ingress-Tag und mindestens einen Eintrag in der Weiterleitungstabelle, wobei der Eintrag einen Ingress-Schlüssel-Kandidaten und eine Ausgangsport-Anzeige umfasst, um einen Tabelleneintrag-Match zu finden,</claim-text>
<claim-text>- Auswählen eines Ausgangsports für das Paket gemäß einem gefundenen Tabelleneintrag-Match, der außerdem eine assoziierte Aggregation betreffende Anweisung umfasst,</claim-text>
<claim-text>- Erzeugen eines Egress-Tags gemäß der Aggregation betreffenden Anweisung im Tabelleneintrag-Match, und</claim-text>
<claim-text>- Senden des Pakets mit dem angefügten erzeugten Egress-Tag vom ausgewählten Ausgangsport an einen nächsten Hop-Router.</claim-text></claim-text></claim><claim id="c-de-01-0002" num="0002"><claim-text>Verfahren nach Anspruch 1, worin die Matching-Funktion das Anwenden einer Tag-Ableitungsfunktion TDF auf den Ingress-Schlüssel-Kandidaten in einem Tabelleneintrag einschließt, um einen Ingress-Tag-Kandidaten abzuleiten, und angenommen wird, dass ein Match gefunden wurde, falls der Ingress-Tag-Kandidat eine vorgegebene Relation mit dem empfangenen Ingress-Tag im Paket erfüllt.</claim-text></claim><claim id="c-de-01-0003" num="0003"><claim-text>Verfahren nach einem der Ansprüche 1-2, worin das empfangene Datenpaket außerdem einen Schlüsselindex enthält, der mit einem Eintrag oder einem Satz von Einträgen in der Weiterleitungstabelle assoziiert ist, und der Schlüsselindex dazu verwendet wird, den mindestens einen richtigen Eintrag zum Anwenden der Matching-Funktion zu finden.</claim-text></claim><claim id="c-de-01-0004" num="0004"><claim-text>Verfahren nach einem der Ansprüche 1-3, worin ein hierarchisches Schema von Routerschlüsseln und Zielschlüsseln zum Ausführen von Aggregation von Routen verwendet wird und der Egress-Tag erzeugt wird, indem der empfangene Ingress-Tag für einen von einem Egress-Schlüssel im Tabelleneintrag-Match abgeleiteten neuen Tag ausgetauscht wird und außerdem assoziierte Aggregationsinformation dem Egress-Tag hinzugefügt wird, worin die Aggregationsinformation dazu verwendet werden kann, das ursprüngliche Ziel zu bestimmen.<!-- EPO <DP n="60"> --></claim-text></claim><claim id="c-de-01-0005" num="0005"><claim-text>Vorrichtung in einem Router (402, 702) eines paketvermittelten Netzes zum Unterstützen des Weiterleitens von empfangenen Datenpaketen im Router, Folgendes umfassend:
<claim-text>- eine Weiterleitungseinheit (402b, 706), angepasst zum Konfigurieren einer Weiterleitungstabelle auf der Basis von Aggregationsrouterschlüsseln und assoziierten Aggregation betreffenden Anweisungen, die von einem Schlüsselmanager (400, 700) empfangen werden, wobei jeder Aggregationsrouterschlüssel einen Satz von Zielen repräsentiert,</claim-text>
<claim-text>- eine Ingress-Einheit (704), angepasst zum Empfangen eines Datenpakets (P), einen Ingress-Tag umfassend, der von einem Senderschlüssel oder Routerschlüssel abgeleitet ist, und</claim-text>
<claim-text>- eine Egress-Einheit (708) zum Senden des Datenpakets (P') an einen nächsten Hop-Knoten,</claim-text>
worin der Weiterleitungseinheit umfasst:
<claim-text>- eine Tag-Matching-Einheit (706b), angepasst zum Anwenden einer Matching-Funktion auf den empfangenen Ingress-Tag und mindestens einen Eintrag in der Weiterleitungstabelle, wobei der Eintrag einen Ingress-Schlüssel-Kandidaten und eine Ausgansport-Anzeige umfasst, um einen Tabelleneintrag-Match zu finden, und außerdem dazu angepasst, einen Ausgangsport für das Paket gemäß einem gefundenen Tabelleneintrag-Match auszuwählen, der außerdem eine assoziierte Aggregation betreffende Anweisung umfasst, und</claim-text>
<claim-text>- eine Tag-Erzeugungseinheit (706c), angepasst zum Erzeugen eines Egress-Tags gemäß der Aggregation betreffenden Anweisung im Tabelleneintrag-Match, und zum Anschließen des Egress-Tags an das Paket, das durch die Egress-Einheit vom ausgewählten Ausgangsport an einen nächsten Hop-Router zu senden ist.</claim-text></claim-text></claim><claim id="c-de-01-0006" num="0006"><claim-text>Vorrichtung nach Anspruch 5, worin die Tag-Matching-Einheit außerdem dazu angepasst ist, eine Tag-Ableitungsfunktion TDF auf den Ingress-Schlüssel-Kandidaten in jedem Tabelleneintrag anzuwenden, um einen Ingress-Tag-Kandidaten abzuleiten, worin angenommen wird, dass ein Match gefunden wurde, falls der Ingress-Tag-Kandidat eine vorgegebene Relation mit dem empfangenen Ingress-Tag im Paket erfüllt.</claim-text></claim><claim id="c-de-01-0007" num="0007"><claim-text>Vorrichtung nach Anspruch 6, worin die vorgegebene Relation Gleichheit ist, d. h. es wird angenommen, dass ein Match gefunden wurde, falls der Ingress-Tag-Kandidat gleich dem Ingress-Tag im Paket ist.</claim-text></claim><claim id="c-de-01-0008" num="0008"><claim-text>Vorrichtung nach einem der Ansprüche 5-7, worin die Tag-Erzeugungseinheit (706c) außerdem dazu angepasst ist, den Egress-Tag dadurch zu erzeugen, dass eine andere Tag-Ableitungsfunktion TDF' auf einen Egress-Schlüssel im Tabelleneintrag-Match angewendet wird.<!-- EPO <DP n="61"> --></claim-text></claim><claim id="c-de-01-0009" num="0009"><claim-text>Vorrichtung nach einem der Ansprüche 5-8, worin die Tag-Erzeugungseinheit (706c) außerdem dazu angepasst ist, den Egress-Tag dadurch zu erzeugen, dass ein oder mehrere zusätzliche Sub-Tags, die von einem oder mehreren Egress-Schlüsseln im Tabelleneintrag-Match abgeleitet sind, an das Paket neben dem empfangenen Ingress-Tag angeschlossen werden, um Aggregation auszuführen, oder durch Entfernen von einem oder mehreren zusätzlichen Sub-Tags aus dem Paket, um Deaggregation auszuführen.</claim-text></claim><claim id="c-de-01-0010" num="0010"><claim-text>Vorrichtung nach Anspruch 9, worin die Tag-Erzeugungseinheit (706c) außerdem dazu angepasst ist, den Egress-Tag dadurch zu erzeugen, dass eine vorgegebene Kombinationsfunktion (C) auf den empfangenen Ingress-Tag und den einen oder die mehreren zusätzlichen Sub-Tags angewendet wird, wenn Aggregation ausgeführt wird.</claim-text></claim><claim id="c-de-01-0011" num="0011"><claim-text>Vorrichtung nach Anspruch 10, worin die Kombinationsfunktion Konkatenation oder eine XOR-Funktion ist.</claim-text></claim><claim id="c-de-01-0012" num="0012"><claim-text>Vorrichtung nach einem der Ansprüche 5-8, worin ein hierarchisches Schema von Routerschlüsseln und Zielschlüsseln zum Ausführen der Aggregation von Routen verwendet wird, und die Tag-Erzeugungseinheit (706c) außerdem dazu angepasst ist, den Egress-Tag zu erzeugen, indem der empfangene Ingress-Tag für einen von einem Egress-Schlüssel im Tabelleneintrag-Match abgeleiteten neuen Tag ausgetauscht wird und außerdem assoziierte Aggregationsinformation zum Egress-Tag hinzugefügt wird, worin die Aggregationsinformation dazu verwendet werden kann, das ursprüngliche Ziel zu bestimmen.</claim-text></claim><claim id="c-de-01-0013" num="0013"><claim-text>Vorrichtung nach Anspruch 12, worin das hierarchische Routerschlüsselschema von einem Wurzelwert (x) mittels einer Funktion f(p, q) erzeugt wird, wo p der Routerschlüsselwert einer Knotenposition über einer gegenwärtigen Baumebene ist und q eine ganze Zahl ist, die eine Knotenposition innerhalb der gegenwärtigen Baumebene anzeigt, worin Zielschlüssel von Ende-Hosts Blättern der Baumstruktur entsprechen und ein f-Wert auf einer oder mehreren Baum-Ebenen über den Blättern als Aggregationsrouterschlüssel verwendet werden kann.</claim-text></claim><claim id="c-de-01-0014" num="0014"><claim-text>Vorrichtung nach Anspruch 13, worin das sich ergebende Schlüsselschema aus Schlüsselwerten besteht, die entlang einem Pfad von der Wurzel (x) nach unten gemäß der folgenden Kette berechnet werden können: (x, f(x), f(f(x)),..., f(f(...f(x)...))).</claim-text></claim><claim id="c-de-01-0015" num="0015"><claim-text>Verfahren zum Unterstützen des Weiterleitens von Datenpaketen an Routern in einem paketvermittelten Netz, folgende Schritte umfassend, die von einem Schlüsselmanager (400, 700) ausgeführt werden:
<claim-text>- (500) Registrieren von Zielschlüsseln für Ende-Hosts (B, C, D,...), die an Zugangs-Router im Netz angeschlossen sind,</claim-text>
<claim-text>- (502) Bestimmen des Standorts von Routern, die Routen-Aggregation bzw. -Deaggregation ausführen können,<!-- EPO <DP n="62"> --></claim-text>
<claim-text>- (504) Erzeugen von Aggregationsrouterschlüsseln und assoziierten Aggregationsanweisungen, wobei jeder Aggregationsrouterschlüssel einen Satz von Zielen repräsentiert, und</claim-text>
<claim-text>- (506) Verteilen der Aggregationsrouterschlüssel und assoziierten Aggregationsanweisungen an die Router zum Ausführen von Routen-Aggregation und -Deaggregation, wodurch den Routern ermöglicht wird, ihre eigenen Weiterleitungstabellen auf der Basis der verteilten Information zu konfigurieren.</claim-text></claim-text></claim><claim id="c-de-01-0016" num="0016"><claim-text>Verfahren nach Anspruch 15, die folgenden weiteren Schritte umfassend:
<claim-text>- Empfangen einer Adressabfrage von einem abfragenden Ende-Host (A), einen Ziel-Ende-Host betreffend,</claim-text>
<claim-text>- Erzeugen eines Senderschlüssels durch Anwenden einer Schlüsselableitungsfunktion KDF auf mindestens einen Zielschlüssel, der mit dem Ziel-Ende-Host assoziiert ist, und</claim-text>
<claim-text>- Senden des erzeugten Senderschlüssels an den abfragenden Ende-Host als Antwort auf die Adressabfrage, wodurch dem abfragenden Ende-Host ermöglicht wird, Datenpakete zum Ziel-Ende-Host zu transportieren, indem ein vom Senderschlüssel erzeugter Sender-Tag an ein zu übertragendes Datenpaket angehängt wird, wobei der Sender-Tag das Datenpaket an den Ziel-Ende-Host leitet.</claim-text></claim-text></claim><claim id="c-de-01-0017" num="0017"><claim-text>Vorrichtung in einem Schlüsselmanager (400, 700) zum Unterstützen des Weiterleitens von Datenpaketen an Routern in einem paketvermittelten Netz, Folgendes umfassend:
<claim-text>- eine Netzsteuereinheit (700b), angepasst zum Registrieren von Zielschlüsseln für Ende-Hosts, die an Zugangsrouter im Netz angeschlossen sind, und außerdem dazu angepasst, den Standort von Routern zu bestimmen, die befähigt sind, Routen-Aggregation bzw. -Deaggregation auszuführen, und</claim-text>
<claim-text>- einen Schlüsselverteiler (700c), angepasst zum Erzeugen von Aggregationsrouterschlüsseln und assoziierten Aggregationsanweisungen, wobei jeder Aggregationsrouterschlüssel einen Satz von Zielen repräsentiert, und außerdem dazu angepasst, die Aggregationsrouterschlüssel und assoziierten Aggregationsanweisungen an die Router zu verteilen, die Routen-Aggregation und -Deaggregation ausführen können, wodurch den Routern ermöglicht wird, ihre eigenen Weiterleitungstabellen auf der Basis der verteilten Information zu konfigurieren.</claim-text></claim-text></claim><claim id="c-de-01-0018" num="0018"><claim-text>Vorrichtung nach Anspruch 17, außerdem einen Adressabfragemanager (700a) umfassend, der dazu angepasst ist, eine Adressabfrage von einem abfragenden Ende-Host (A) zu empfangen, die einen Ziel-Ende-Host betrifft, einen Senderschlüssel durch Anwenden einer Schlüsselableitungsfunktion KDF auf mindestens einen Zielschlüssel zu erzeugen, der mit dem Ziel-Ende-Host assoziiert ist, und den erzeugten Senderschlüssel an den abfragenden Ende-Host als Antwort auf die Adressabfrage zu senden, wodurch<!-- EPO <DP n="63"> --> dem abfragenden Ende-Host ermöglicht wird, Datenpakete zum Ziel-Ende-Host zu transportieren, indem ein vom Senderschlüssel erzeugter Sender-Tag an ein übertragenes Datenpaket angehängt wird, wobei der Sender-Tag das übertragene Datenpaket an den Ziel-Ende-Host leitet.</claim-text></claim></claims><claims mxw-id="PCLM56985756" lang="EN" load-source="patent-office"><!-- EPO <DP n="52"> --><claim id="c-en-01-0001" num="0001"><claim-text>A method of supporting the forwarding of received data packets in a router (402,702) of a packet-switched network, comprising the following steps:
<claim-text>- configuring a forwarding table based on aggregating router keys and associated aggregation related instructions received from a key manager, each aggregating router key representing a set of destinations,</claim-text>
<claim-text>- receiving a data packet comprising an ingress tag derived from a sender key or router key,</claim-text>
<claim-text>- applying a matching function to the received ingress tag and at least one entry in the forwarding table, said entry comprising a candidate ingress key and an outgoing port indication, in order to find a matching table entry,</claim-text>
<claim-text>- selecting an outgoing port for the packet according to a found matching table entry that further comprises an associated aggregation related instruction,</claim-text>
<claim-text>- creating an egress tag according to the aggregation related instruction in the matching table entry, and</claim-text>
<claim-text>- sending the packet with the created egress tag attached from the selected outgoing port to a next hop router.</claim-text></claim-text></claim><claim id="c-en-01-0002" num="0002"><claim-text>A method according to claim 1, wherein said matching function includes applying a tag derivation function TDF to said candidate ingress key in a table entry to derive a candidate ingress tag, and a match is considered to be found if the candidate ingress tag satisfies a predetermined relation with the received ingress tag in the packet.<!-- EPO <DP n="53"> --></claim-text></claim><claim id="c-en-01-0003" num="0003"><claim-text>A method according to any of claims 1-2, wherein the received data packet further contains a key index associated to an entry or a set of entries in the forwarding table, and the key index is used to find the proper entry/entries for applying the matching function.</claim-text></claim><claim id="c-en-01-0004" num="0004"><claim-text>A method according to any of claims 1-3, wherein a hierarchical scheme of router keys and destination keys is used for executing aggregation of routes, and said egress tag is created by exchanging the received ingress tag for a new tag derived from an egress key in the matching table entry and also adding associated aggregation information to the egress tag, wherein said aggregation information can be used to determine the original destination.</claim-text></claim><claim id="c-en-01-0005" num="0005"><claim-text>An apparatus in a router (402,702) of a packet-switched network for supporting the forwarding of received data packets in said router, comprising:
<claim-text>- a forwarding unit (402b,706) adapted to configure a forwarding table based on aggregating router keys and associated aggregation related instructions received from a key manager (400,700), each aggregating router key representing a set of destinations,</claim-text>
<claim-text>- an ingress unit (704) adapted to receive a data packet (P) comprising an ingress tag derived from a sender key or router key, and</claim-text>
<claim-text>- an egress unit (708) for sending the data packet (P') to a next hop node,<br/>
wherein the forwarding unit comprises:<!-- EPO <DP n="54"> -->
<claim-text>- a tag matching unit (706b) adapted to apply a matching function to the received ingress tag and at least one entry in the forwarding table, said entry comprising a candidate ingress key and an outgoing port indication, in order to find a matching table entry, and further adapted to select an outgoing port for the packet according to a found matching table entry that further comprises an associated aggregation related instruction, and</claim-text>
<claim-text>- a tag creating unit (706c) adapted to create an egress tag according to the aggregation related instruction in the matching table entry, and to attach the egress tag to the packet which is to be sent by the egress unit from the selected outgoing port to a next hop router.</claim-text></claim-text></claim-text></claim><claim id="c-en-01-0006" num="0006"><claim-text>An apparatus according to claim 5, wherein the tag matching unit is further adapted to apply a tag derivation function TDF to said candidate ingress key in each table entry to derive a candidate ingress tag, wherein a match is considered to be found if the candidate ingress tag satisfies a predetermined relation with the received ingress tag in the packet.</claim-text></claim><claim id="c-en-01-0007" num="0007"><claim-text>An apparatus according to claim 6, wherein the predetermined relation is equality, i.e. a match is considered to be found if the candidate ingress tag equals the ingress tag in the packet.</claim-text></claim><claim id="c-en-01-0008" num="0008"><claim-text>An apparatus according to any of claims 5-7, wherein the tag creating unit (706c) is further adapted to create the<!-- EPO <DP n="55"> --> egress tag by applying another tag derivation function TDF' to an egress key in the matching table entry.</claim-text></claim><claim id="c-en-01-0009" num="0009"><claim-text>An apparatus according to any of claims 5-8, wherein the tag creating unit (706c) is further adapted to create the egress tag by attaching one or more additional sub-tags, derived from one or more egress keys in the matching table entry, to the packet alongside the received ingress tag to execute aggregation, or by removing one or more additional sub-tags from the packet to execute de-aggregation.</claim-text></claim><claim id="c-en-01-0010" num="0010"><claim-text>An apparatus according to claim 9, wherein the tag creating unit (706c) is further adapted to create the egress tag by applying a predetermined combination function (C) to the received ingress tag and said one or more additional sub-tags when executing aggregation.</claim-text></claim><claim id="c-en-01-0011" num="0011"><claim-text>An apparatus according to claim 10, wherein said combination function is concatenation or an XOR function.</claim-text></claim><claim id="c-en-01-0012" num="0012"><claim-text>An apparatus according to any of claims 5-8, wherein a hierarchical scheme of router keys and destination keys is used for executing aggregation of routes, and the tag creating unit (706c) is further adapted to create the egress tag by exchanging the received ingress tag for a new tag derived from an egress key in the matching table entry and also adding associated aggregation information to the egress tag, wherein said aggregation information can be used to determine the original destination.<!-- EPO <DP n="56"> --></claim-text></claim><claim id="c-en-01-0013" num="0013"><claim-text>An apparatus according to claim 12, wherein said hierarchical router key scheme is generated from a root value (x) by means of a function f(p,q), where p is the router key value of a node position above a current tree level and q is an integer indicating a node position within the current tree level, wherein destination keys of end-hosts correspond to leaves of the tree-structure, and any f-values on one or more tree levels above the leaves can be used as aggregating router keys.</claim-text></claim><claim id="c-en-01-0014" num="0014"><claim-text>An apparatus according to claim 13, wherein the resulting key scheme is composed of key values that can be calculated, along a path from the root (x) downwards, according to the following chain: (x, f (x), f(f(x)) ,..., f(f(...f(x)...))).</claim-text></claim><claim id="c-en-01-0015" num="0015"><claim-text>A method of supporting the forwarding of data packets at routers in a packet-switched network, comprising the following steps performed by a key manager (400,700):
<claim-text>- (500) registering destination keys for end-hosts (B,C,D, ...) connected to access routers in the network,</claim-text>
<claim-text>- (502) determining the location of routers enabled to execute route aggregation and de-aggregation, respectively,</claim-text>
<claim-text>- (504) creating aggregating router keys and associated aggregation instructions, each aggregating router key representing a set of destinations, and</claim-text>
<claim-text>- (506) distributing the aggregating router keys and associated aggregation instructions to the routers for execution of route aggregation and de-aggregation, thereby enabling said routers to configure their own forwarding tables based on the distributed information.</claim-text><!-- EPO <DP n="57"> --></claim-text></claim><claim id="c-en-01-0016" num="0016"><claim-text>A method according to claim 15, comprising the following further steps:
<claim-text>- receiving an address query from a querying end-host (A) regarding a target end-host,</claim-text>
<claim-text>- creating a sender key by applying a key derivation function KDF to at least a destination key associated with the target end-host, and</claim-text>
<claim-text>- sending the created sender key to the querying end-host in response to said address query, thereby enabling the querying end-host to get across data packets to the target end-host by attaching a sender tag generated from said sender key to a data packet to be transmitted, the sender tag directing said data packet to the target end-host.</claim-text></claim-text></claim><claim id="c-en-01-0017" num="0017"><claim-text>An apparatus in a key manager (400,700) for supporting the forwarding of data packets at routers in a packet-switched network, comprising:
<claim-text>- a network controlling unit (700b) adapted to register destination keys for end-hosts connected to access routers in the network, and further adapted to determine the location of routers enabled to execute route aggregation and de-aggregation, respectively, and</claim-text>
<claim-text>- a key distributor (700c) adapted to create aggregating router keys and associated aggregation instructions, each aggregating router key representing a set of destinations, and further adapted to distribute the aggregating router keys and associated aggregation instructions to the routers that can execute route aggregation and de-aggregation, thereby enabling said<!-- EPO <DP n="58"> --> routers to configure their own forwarding tables based on the distributed information.</claim-text></claim-text></claim><claim id="c-en-01-0018" num="0018"><claim-text>An apparatus according to claim 17, further comprising an address query manager (700a) adapted to receive an address query from a querying end-host (A) regarding a target end-host, create a sender key by applying a key derivation function KDF to at least a destination key associated with the target end-host, and to send the created sender key to the querying end-host in response to said address query, thereby enabling the querying end-host to get across data packets to the target end-host by attaching a sender tag generated from said sender key to a transmitted data packet, the sender tag directing said transmitted data packet to the target end-host.</claim-text></claim></claims><claims mxw-id="PCLM56985757" lang="FR" load-source="patent-office"><!-- EPO <DP n="64"> --><claim id="c-fr-01-0001" num="0001"><claim-text>Procédé pour supporter le réacheminement de paquets de données reçus dans un routeur (402, 702) d'un réseau de commutation de paquets, comprenant les étapes suivantes :
<claim-text>configurer une table de réacheminement sur la base de clés de routeur d'agrégation et d'instructions relatives à une agrégation associées reçues depuis un gestionnaire de clé, chaque clé de routeur d'agrégation représentant un ensemble de destinations,</claim-text>
<claim-text>recevoir un paquet de données comprenant une étiquette d'entrée dérivée d'une clé d'émetteur ou d'une clé de routeur,</claim-text>
<claim-text>appliquer une fonction de correspondance à l'étiquette d'entrée reçue et au moins une entrée dans la table de réacheminement, ladite entrée comprenant une clé d'entrée candidate et une indication de port de sortie, afin de trouver une entrée de table correspondante,</claim-text>
<claim-text>sélectionner un port de sortie pour le paquet conformément à une entrée de table correspondante trouvée qui comprend en outre une instruction relative à une agrégation associée,</claim-text>
<claim-text>créer une étiquette de sortie conformément à l'instruction relative à une agrégation dans l'entrée de table correspondante, et</claim-text>
<claim-text>envoyer le paquet avec l'étiquette de sortie créée attachée à partir du port de sortie sélectionné vers un routeur de bond suivant.</claim-text></claim-text></claim><claim id="c-fr-01-0002" num="0002"><claim-text>Procédé selon la revendication 1, dans lequel ladite fonction de correspondance comprend d'appliquer une fonction de dérivation d'étiquette, TDF, à ladite clé d'entrée candidate dans une table d'entrée pour dériver une étiquette d'entrée candidate, et une correspondance est considérée comme trouvée si l'étiquette d'entrée candidate satisfait une relation prédéterminée avec l'étiquette d'entrée reçue dans le paquet.</claim-text></claim><claim id="c-fr-01-0003" num="0003"><claim-text>Procédé selon l'une quelconque des revendications 1 à 2, dans lequel le paquet de données reçus contient en outre un index clé associé à une entrée ou un ensemble d'entrées dans la table de réacheminement, et l'index clé est utilisé pour trouver l'entrée/les entrées propres pour appliquer la fonction de correspondance.</claim-text></claim><claim id="c-fr-01-0004" num="0004"><claim-text>Procédé selon l'une quelconque des revendications 1 à 3, dans lequel un schéma hiérarchique de clés de routeur et de clés de destinations est utilisé pour exécuter une agrégation de routes, et ladite étiquette de sortie est créée en échangeant l'étiquette d'entrée reçue pour une nouvelle étiquette dérivée d'une clé de sortie dans l'entrée de table correspondante et également en ajoutant des informations d'agrégation associée à l'étiquette de sortie, où lesdites informations d'agrégation peuvent être utilisées pour déterminer la destination originale.<!-- EPO <DP n="65"> --></claim-text></claim><claim id="c-fr-01-0005" num="0005"><claim-text>Appareil dans un routeur (402, 702) d'un réseau de commutation de paquets pour supporter le réacheminement de paquets de données reçus dans ledit routeur, comprenant :
<claim-text>une unité de réacheminement (402b, 706) conçue pour configurer une table de réacheminement sur la base de clés de routeur d'agrégation et d'instructions relatives à une agrégation associées reçues depuis un gestionnaire de clés (400, 700), chaque clé de routeur d'agrégation représentant un ensemble de destinations,</claim-text>
<claim-text>une unité d'entrée (704) conçue pour recevoir un paquet de données (P) comprenant une étiquette d'entrée dérivée d'une clé d'émetteur ou d'une clé de routeur, et</claim-text>
<claim-text>une unité de sortie (708) pour envoyer le paquet de données (P') à un noeud de bond suivant,</claim-text>
<claim-text>où l'unité de réacheminement comprend :
<claim-text>une unité de correspondance d'étiquette (706b) conçue pour appliquer une fonction de correspondance à l'étiquette d'entrée reçue et au moins une entrée dans la table de réacheminement, ladite entrée comprenant une clé d'entrée candidate et une indication de port de sortie, afin de trouver une entrée de table correspondante, et conçue en outre pour sélectionner un port de sortie pour le paquet conformément à une entrée de table correspondante trouvée qui comprend en outre une instruction relative à une agrégation associée, et</claim-text>
<claim-text>une unité de création d'étiquette (706c) conçue pour créer une étiquette de sortie conformément à l'instruction relative à une agrégation dans l'entrée de table correspondante, et pour attacher l'étiquette de sortie au paquet qui doit être envoyé par l'unité de sortie depuis le port de sortie sélectionné vers un routeur de bond suivant.</claim-text></claim-text></claim-text></claim><claim id="c-fr-01-0006" num="0006"><claim-text>Appareil selon la revendication 5, dans lequel l'unité de correspondance d'étiquette est en outre conçue pour appliquer une fonction de dérivation d'étiquette, TDF, à ladite clé d'entrée candidate dans chaque entrée de table pour dériver une étiquette d'entrée candidate, où une correspondance est considérée comme trouvée si l'étiquette d'entrée candidate satisfait une relation prédéterminée avec l'étiquette d'entrée reçue dans le paquet.</claim-text></claim><claim id="c-fr-01-0007" num="0007"><claim-text>Appareil selon la revendication 6, dans lequel la relation prédéterminée est une égalité, c'est-à-dire qu'une correspondance est considérée comme trouvée si l'étiquette d'entrée candidate est égale à l'étiquette d'entrée dans le paquet.</claim-text></claim><claim id="c-fr-01-0008" num="0008"><claim-text>Appareil selon l'une quelconque des revendications 5 à 7, dans lequel l'unité de création d'étiquette (706c) est en outre conçue pour créer l'étiquette de sortie en appliquant une autre fonction de dérivation d'étiquette TDF' à une clé de sortie dans l'entrée de table correspondante.</claim-text></claim><claim id="c-fr-01-0009" num="0009"><claim-text>Appareil selon l'une quelconque des revendications 5 à 8, dans lequel l'unité de création d'étiquette (706c) est en outre conçue pour créer l'étiquette de sortie en attachant une ou plusieurs sous-étiquettes additionnelles, dérivées d'une ou plusieurs clés de sortie<!-- EPO <DP n="66"> --> dans l'entrée de table correspondante, au paquet avec l'étiquette d'entrée reçue pour exécuter une agrégation, ou en enlevant une ou plusieurs sous-étiquettes additionnelles du paquet pour exécuter une désagrégation.</claim-text></claim><claim id="c-fr-01-0010" num="0010"><claim-text>Appareil selon la revendication 9, dans lequel l'unité de création d'étiquette (706c) est en outre conçue pour créer l'étiquette de sortie en appliquant une fonction de combinaison prédéterminée (C) à l'étiquette d'entrée reçue et à ladite une ou plusieurs sous-étiquettes additionnelles lors de l'exécution d'une agrégation.</claim-text></claim><claim id="c-fr-01-0011" num="0011"><claim-text>Appareil selon la revendication 10, dans lequel ladite fonction de combinaison est une fonction de concaténation ou une fonction OU exclusif.</claim-text></claim><claim id="c-fr-01-0012" num="0012"><claim-text>Appareil selon l'une quelconque des revendications 5 à 8, dans lequel un schéma hiérarchique de clés de routeur et de clés de destinations est utilisé pour exécuter une agrégation de routes, et l'unité de création d'étiquette (706c) est en outre conçue pour créer l'étiquette de sortie en échangeant l'étiquette d'entrée reçue pour une nouvelle étiquette dérivée d'une clé de sortie dans l'entrée de table correspondante et également en ajoutant des informations d'agrégation associée à l'étiquette de sortie, où lesdites informations d'agrégation peuvent être utilisées pour déterminer la destination originale.</claim-text></claim><claim id="c-fr-01-0013" num="0013"><claim-text>Appareil selon la revendication 12, dans lequel ledit schéma de clé de routeur hiérarchique est généré à partie d'une valeur racine (x) au moyen d'une fonction f (p, q), où p est la valeur de la clé de routeur d'une position de noeud au-dessus d'un niveau d'arborescence courant et q est un entier indiquant une position de noeud dans le niveau d'arborescence courant, où des clés de destination d'hôtes d'extrémité correspondent à des feuilles de la structure arborescente, et toutes valeurs f sur un ou plusieurs niveaux d'arborescence au-dessus des feuilles peuvent être utilisées comme clés de routeur d'agrégation.</claim-text></claim><claim id="c-fr-01-0014" num="0014"><claim-text>Appareil selon la revendication 13, dans lequel le schéma de clé résultant est composé de valeurs clé qui peuvent être calculées, le long d'un chemin depuis la racine (x) vers le bas, conformément à la chaîne suivante : (x, f (x), f(f(x)),..., f(f(...f(x)...))).</claim-text></claim><claim id="c-fr-01-0015" num="0015"><claim-text>Procédé pour supporter le réacheminement de paquets de données au niveau de routeurs dans un réseau de commutation de paquets, comprenant les étapes suivantes exécutées par un gestionnaire de clés (400, 700) :
<claim-text>(500) enregistrer des clés de destination pour des hôtes d'extrémité (B, C, D,...) connectés à des routeurs d'accès dans le réseau,</claim-text>
<claim-text>(502) déterminer la position de routeurs capables d'exécuter une agrégation et une désagrégation de route, respectivement,</claim-text>
<claim-text>(504) créer des clés de routeur d'agrégation et des instructions d'agrégation associées, chaque clé de routeur d'agrégation représentant un ensemble de destinations, et (506) distribuer les clés de routeur d'agrégation et les instructions d'agrégation associées aux routeurs pour exécution d'une agrégation et d'une désagrégation de route,<!-- EPO <DP n="67"> --> permettant ainsi auxdits routeurs de confirmer leurs propres tables de réacheminement sur la base des informations distribuées.</claim-text></claim-text></claim><claim id="c-fr-01-0016" num="0016"><claim-text>Procédé selon la revendication 15, comprenant en outre les étapes suivantes :
<claim-text>recevoir une demande d'adresse depuis un hôte d'extrémité demandeur (A) concernant un hôte d'extrémité cible,</claim-text>
<claim-text>créer une clé d'émetteur en appliquant une fonction de dérivation de clé KDF à au moins une clé de destination associée à l'hôte d'extrémité cible, et</claim-text>
<claim-text>envoyer la clé d'émetteur créée à l'hôte d'extrémité demandeur en réponse à ladite demande d'adresse, permettant ainsi à l'hôte d'extrémité demandeur de traverser des paquets de données jusqu'à l'hôte d'extrémité cible en attachant une étiquette d'émetteur générée depuis ladite clé d'émetteur à un paquet de données à transmettre, l'étiquette d'émetteur dirigeant ledit paquet de données vers l'hôte d'extrémité cible.</claim-text></claim-text></claim><claim id="c-fr-01-0017" num="0017"><claim-text>Appareil dans un gestionnaire de clés (400, 700) pour supporter le réacheminement de paquets de données au niveau de routeurs dans un réseau de commutation de paquets, comprenant :
<claim-text>une unité de commande de réseau (700b) conçue pour enregistrer des clés de destination pour des hôtes d'extrémité connectés à des routeurs d'accès dans le réseau, et conçue en outre pour déterminer la position des routeurs capables d'exécuter une agrégation et une désagrégation de route, respectivement, et</claim-text>
<claim-text>un distributeur de clé (700c) conçu pour créer des clés de routeur d'agrégation et des instructions d'agrégation associées, chaque clé de routeur d'agrégation représentant un ensemble de destinations, et conçu en outre pour distribuer les clés de routeur d'agrégation et les instructions d'agrégation associées aux routeurs qui peuvent exécuter une agrégation et une désagrégation de route, permettant ainsi auxdits routeurs de configurer leur propres tables de réacheminement sur la base des informations distribuées.</claim-text></claim-text></claim><claim id="c-fr-01-0018" num="0018"><claim-text>Appareil selon la revendication 17, comprenant en outre un gestionnaire de demande d'adresse (700a) conçu pour recevoir une demande d'adresse depuis un hôte d'extrémité demandeur (A) concernant un hôte d'extrémité cible, pour créer une clé d'émetteur en appliquant une fonction de dérivation de clé KDF à au moins une clé de destination associée à l'hôte d'extrémité cible, et pour envoyer la clé d'émetteur créée à l'hôte d'extrémité demandeur en réponse à ladite demande d'adresse, permettant ainsi à l'hôte d'extrémité demandeur de traverser les paquets de données jusqu'à l'hôte d'extrémité cible en attachant une étiquette d'émetteur générée depuis ladite clé d'émetteur à un paquet de données transmis, l'étiquette d'émetteur dirigeant ledit paquet de données transmis vers l'hôte d'extrémité cible.</claim-text></claim></claims><drawings mxw-id="PDW16672251" load-source="patent-office"><!-- EPO <DP n="68"> --><figure id="f0001" num="1,2,2a"><img id="if0001" file="imgf0001.tif" wi="163" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="69"> --><figure id="f0002" num="3,3a,3b"><img id="if0002" file="imgf0002.tif" wi="164" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="70"> --><figure id="f0003" num="3c,4"><img id="if0003" file="imgf0003.tif" wi="165" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="71"> --><figure id="f0004" num="5"><img id="if0004" file="imgf0004.tif" wi="141" he="183" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="72"> --><figure id="f0005" num="6"><img id="if0005" file="imgf0005.tif" wi="158" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="73"> --><figure id="f0006" num="7"><img id="if0006" file="imgf0006.tif" wi="163" he="155" img-content="drawing" img-format="tif"/></figure></drawings><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
