<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2683068-A1" country="EP" doc-number="2683068" kind="A1" date="20140108" family-id="46724219" file-reference-id="315087" date-produced="20180822" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146585181" ucid="EP-2683068-A1"><document-id><country>EP</country><doc-number>2683068</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12175428-A" is-representative="YES"><document-id mxw-id="PAPP154847373" load-source="docdb" format="epo"><country>EP</country><doc-number>12175428</doc-number><kind>A</kind><date>20120706</date><lang>EN</lang></document-id><document-id mxw-id="PAPP211531931" load-source="docdb" format="original"><country>EP</country><doc-number>12175428.7</doc-number><date>20120706</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140556082" ucid="EP-12175428-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12175428</doc-number><kind>A</kind><date>20120706</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989320812" load-source="docdb">H02M   3/335       20060101AFI20131122BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1919310036" load-source="docdb" scheme="CPC">H02M   3/33523     20130101 LI20160709BHEP        </classification-cpc><classification-cpc mxw-id="PCL2003767476" load-source="docdb" scheme="CPC">H02M   3/33507     20130101 FI20140109BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132360176" lang="DE" load-source="patent-office">Regelkreis für eine Schaltnetzteil-Stromversorgung</invention-title><invention-title mxw-id="PT132360177" lang="EN" load-source="patent-office">Control circuit for a switched-mode power supply</invention-title><invention-title mxw-id="PT132360178" lang="FR" load-source="patent-office">Circuit de commande pour alimentation électrique en mode commuté</invention-title><citations><patent-citations><patcit mxw-id="PCIT242943191" load-source="docdb" ucid="DE-10120287-A1"><document-id format="epo"><country>DE</country><doc-number>10120287</doc-number><kind>A1</kind><date>20021121</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242943192" load-source="docdb" ucid="US-20030042437-A1"><document-id format="epo"><country>US</country><doc-number>20030042437</doc-number><kind>A1</kind><date>20030306</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242943193" load-source="docdb" ucid="US-20090016086-A1"><document-id format="epo"><country>US</country><doc-number>20090016086</doc-number><kind>A1</kind><date>20090115</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242943194" load-source="docdb" ucid="US-20110222318-A1"><document-id format="epo"><country>US</country><doc-number>20110222318</doc-number><kind>A1</kind><date>20110915</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>None</text><sources><source mxw-id="PNPL45210971" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR919518567" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>NXP BV</last-name><address><country>NL</country></address></addressbook></applicant><applicant mxw-id="PPAR919537128" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>NXP B.V.</last-name></addressbook></applicant><applicant mxw-id="PPAR919017520" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>NXP B.V.</last-name><iid>100810158</iid><address><street>High Tech Campus 60</street><city>5656 AG Eindhoven</city><country>NL</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919533480" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ZHANG CHENG</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919537826" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ZHANG, CHENG</last-name></addressbook></inventor><inventor mxw-id="PPAR919013599" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ZHANG, CHENG</last-name><address><street>c/o NXP Semiconductors, Intellectual Property and Licensing 60 High Street</street><city>Redhill, Surrey RH1 1NY</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919528160" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>STRIJKER JOAN WICHARD</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919529106" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>STRIJKER, JOAN WICHARD</last-name></addressbook></inventor><inventor mxw-id="PPAR919010782" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>STRIJKER, JOAN WICHARD</last-name><address><street>c/o NXP Semiconductors, Intellectual Property and Licensing 60 High Street</street><city>Redhill, Surrey RH1 1NY</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919517718" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>HALBERSTADT HANS</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR919544883" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>HALBERSTADT, HANS</last-name></addressbook></inventor><inventor mxw-id="PPAR919006125" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>HALBERSTADT, HANS</last-name><address><street>c/o NXP Semiconductors, Intellectual Property and Licensing 60 High Street</street><city>Redhill, Surrey RH1 1NY</city><country>GB</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919012639" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Hardingham, Christopher Mark</last-name><iid>101368012</iid><address><street>NXP B.V. Intellectuel Property &amp; Licensing Red Central 60 High Street</street><city>Redhill, Surrey RH1 1SH</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549816941" load-source="docdb">AL</country><country mxw-id="DS549819721" load-source="docdb">AT</country><country mxw-id="DS549816947" load-source="docdb">BE</country><country mxw-id="DS549745656" load-source="docdb">BG</country><country mxw-id="DS549745777" load-source="docdb">CH</country><country mxw-id="DS549815672" load-source="docdb">CY</country><country mxw-id="DS549819726" load-source="docdb">CZ</country><country mxw-id="DS549816948" load-source="docdb">DE</country><country mxw-id="DS549815673" load-source="docdb">DK</country><country mxw-id="DS549815678" load-source="docdb">EE</country><country mxw-id="DS549908864" load-source="docdb">ES</country><country mxw-id="DS549745665" load-source="docdb">FI</country><country mxw-id="DS549745666" load-source="docdb">FR</country><country mxw-id="DS549816949" load-source="docdb">GB</country><country mxw-id="DS549815679" load-source="docdb">GR</country><country mxw-id="DS549816950" load-source="docdb">HR</country><country mxw-id="DS549819727" load-source="docdb">HU</country><country mxw-id="DS549745778" load-source="docdb">IE</country><country mxw-id="DS549816951" load-source="docdb">IS</country><country mxw-id="DS549745667" load-source="docdb">IT</country><country mxw-id="DS549815680" load-source="docdb">LI</country><country mxw-id="DS549743500" load-source="docdb">LT</country><country mxw-id="DS549819728" load-source="docdb">LU</country><country mxw-id="DS549743513" load-source="docdb">LV</country><country mxw-id="DS549743514" load-source="docdb">MC</country><country mxw-id="DS549818574" load-source="docdb">MK</country><country mxw-id="DS549818575" load-source="docdb">MT</country><country mxw-id="DS549819729" load-source="docdb">NL</country><country mxw-id="DS549908865" load-source="docdb">NO</country><country mxw-id="DS549819742" load-source="docdb">PL</country><country mxw-id="DS549743516" load-source="docdb">PT</country><country mxw-id="DS549819743" load-source="docdb">RO</country><country mxw-id="DS549743525" load-source="docdb">RS</country><country mxw-id="DS549819744" load-source="docdb">SE</country><country mxw-id="DS549743526" load-source="docdb">SI</country><country mxw-id="DS549745779" load-source="docdb">SK</country><country mxw-id="DS549745780" load-source="docdb">SM</country><country mxw-id="DS549818576" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128673353" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A control circuit for a switched-mode power supply having an input side (101) connectable to an electrical power source and an output side (102) connectable to a load. The control circuit comprises: a primary control circuit (140) adapted to generate a driving signal for a switching element (110) at the input side of the power supply; a secondary control circuit (150) adapted to monitor an output signal at the output side (102) of the power supply; and an opto-coupler (300, 400), wherein the opto-coupler is arranged to receive its input from the secondary control circuit and to provide a control signal to the primary control circuit, and the primary control circuit comprises a compensation circuit (900, 1000, 1100, 1400, 2010, 2610) adapted to process the control signal to generate a compensation signal for reducing power consumption in the opto-coupler, wherein the compensation circuit is adapted to generate the compensation signal such that a current in the opto-coupler tends to return to a desired minimum value.
<img id="iaf01" file="imgaf001.tif" wi="124" he="78" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128737504" lang="EN" source="EPO" load-source="docdb"><p>A control circuit for a switched-mode power supply having an input side (101) connectable to an electrical power source and an output side (102) connectable to a load. The control circuit comprises: a primary control circuit (140) adapted to generate a driving signal for a switching element (110) at the input side of the power supply; a secondary control circuit (150) adapted to monitor an output signal at the output side (102) of the power supply; and an opto-coupler (300, 400), wherein the opto-coupler is arranged to receive its input from the secondary control circuit and to provide a control signal to the primary control circuit, and the primary control circuit comprises a compensation circuit (900, 1000, 1100, 1400, 2010, 2610) adapted to process the control signal to generate a compensation signal for reducing power consumption in the opto-coupler, wherein the compensation circuit is adapted to generate the compensation signal such that a current in the opto-coupler tends to return to a desired minimum value.</p></abstract><description mxw-id="PDES63959341" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">This invention relates to control of a Switched Mode Power Supply (SMPS). In particular, it relates to the control of a secondary-sensed SMPS, comprising an opto-coupler for control feedback between the secondary (output) side and the primary (input) side of the SMPS. The control circuits described herein may be particularly relevant for a SMPS which comprises a flyback converter, or a resonant converter.</p><p id="p0002" num="0002">A Switched Mode Power Supply converts electrical power from an electrical source into electrical power with voltage and current characteristics different from the source and delivers it to a load. The conversion is performed using a switching element, which repeatedly switches between a conductive state, in which current flows through it and a non-conductive state, in which substantially no current flows.</p><p id="p0003" num="0003">An SMPS can offer efficient conversion of the electrical characteristics (in particular, voltage and current) of a power source, to drive a load that requires different characteristics. The switching element dissipates very little energy in its "on" and "off" states and the transitions between these states are very short (almost instantaneous). This enables the SMPS to be more efficient than a linear power supply, which regulates output power by continually dissipating energy.</p><p id="p0004" num="0004">The SMPS will typically incorporate a control circuit, for monitoring the load (which may be variable) and controlling the switching element so that a consistent output is delivered. For example, if the load draws more current, tending to pull down the output voltage of the SMPS, the control circuit may increase a duty cycle of the switching element, so as to inject more electrical power into the converter and pull up the output voltage.</p><p id="p0005" num="0005">A typical example application is the use of a SMPS to convert high-voltage AC mains electricity into low-voltage DC electricity, suitable for driving electronic components such as integrated circuits. It is a common requirement in this and other applications for the input side of the SMPS to be electrically isolated from the output side. For this reason, the actual power delivery may be accomplished using a transformer. It may also be required to include isolation in the control circuit - since the control circuit provides feedback from the output side to the input side of the SMPS. The isolation in the control circuit is commonly provided by an opto-coupler. This electronic component is also known as an opto-isolator or photo-coupler. It comprises a light source (emitter) and a<!-- EPO <DP n="2"> --> photosensor, optically coupled to the source, whereby the photosensor is operable to detect the intensity of light emitted from the source. The emitter may, for example, comprise a Light Emitting Diode (LED); in particular, an infrared LED. The photosensor may comprise a photoresistor, a photodiode, or a phototransistor, among others.</p><p id="p0006" num="0006">According to an aspect of the invention, there is provided a control circuit for a switched-mode power supply having an input side connectable to an electrical power source and an output side connectable to a load, the control circuit comprising:
<ul><li>a primary control circuit adapted to generate a driving signal for a switching element at the input side of the power supply;</li><li>a secondary control circuit adapted to monitor an output signal at the output side of the power supply; and</li><li>an opto-coupler,</li><li>wherein the opto-coupler is arranged to receive its input from the secondary control circuit and to provide a control signal to the primary control circuit, and</li><li>the primary control circuit comprises a compensation circuit adapted to process the control signal to generate a compensation signal for reducing power consumption in the opto-coupler,</li><li>wherein the compensation circuit is adapted to generate the compensation signal such that a current in the opto-coupler tends to return to a desired minimum value.</li></ul></p><p id="p0007" num="0007">The compensation circuit may be adapted to generate the compensation signal such that it responds to low-frequency variations in the input to the opto-coupler to a greater extent than high-frequency variations, so that the current in the opto-coupler tends to return to a desired minimum steady-state value.</p><p id="p0008" num="0008">This provides a relatively high gain in the overall control loop of the SMPS, up to a relatively low frequency, and a relatively low gain, at higher frequencies. This helps to reduce the steady-state current flowing in the opto-coupler, without negatively influencing the stability of the regulation loop. The overall control loop is the feedback loop formed by the input side and output side of the SMPS, together with the feedback path provided by the secondary control circuit and primary control circuit.</p><p id="p0009" num="0009">The compensation circuit may comprise an adaptive voltage supply for the opto-coupler.</p><p id="p0010" num="0010">In this case, the compensation signal is preferably a supply voltage delivered to a resistor coupled in series with the opto-coupler.<!-- EPO <DP n="3"> --></p><p id="p0011" num="0011">The compensation circuit may comprise a transconductance amplifier; and the compensation signal may be a compensation current output from said amplifier.</p><p id="p0012" num="0012">In this case, the primary control circuit preferably further comprises a fixed current source and the current in the opto-coupler is the sum of the current produced by the fixed current source and the compensation current.</p><p id="p0013" num="0013">The control signal may be a control current and the compensation circuit may comprise an adaptive current supply for the opto-coupler.</p><p id="p0014" num="0014">The compensation signal may be a reference current and the current in the opto-coupler may be the sum of the control current and the reference current. The reference current may be the output of the adaptive current supply.</p><p id="p0015" num="0015">The compensation circuit may be adapted to generate the reference current as a function of a low-pass filtered version of the control current.</p><p id="p0016" num="0016">This helps to provide the desired behaviour, wherein low-frequency, slow changes in the steady state signals are tracked with relatively high gain. Meanwhile, high-frequency transient behaviour is not reflected in the compensation signal.</p><p id="p0017" num="0017">In some embodiments, a time constant with which the compensation signal responds to variations in the input to the opto-coupler may be variable.</p><p id="p0018" num="0018">This is a further advantageous way of providing the desired loop stability and temporal response.</p><p id="p0019" num="0019">The time constant may be variable according to at least one of: an amplitude of the control signal; and whether or not the switched-mode power supply is operating in a burst mode.</p><p id="p0020" num="0020">The time constant may be changed if the control signal reaches or exceeds a predetermined threshold or if a difference between the control signal and the compensation signal reaches or exceeds a threshold. This allows the circuit to respond quickly to large amplitude changes, when necessary.</p><p id="p0021" num="0021">Alternatively or in addition, the time constant may be changed depending upon whether or not the power supply is operating in burst mode. The time constant is preferably chosen to be long in a normal operating mode (when low gain is required) and short in a burst operating mode (when higher gain is required). This helps to provide the desired stability and response at low and high frequencies.</p><p id="p0022" num="0022">According to another aspect of the invention there is provided a control circuit for a switched-mode power supply having an input side connectable to an electrical power source and an output side connectable to a load, the control circuit comprising:<!-- EPO <DP n="4"> -->
<ul><li>a primary control circuit adapted to generate a driving signal for a switching element at the input side of the power supply;</li><li>a secondary control circuit adapted to monitor an output signal at the output side of the power supply; and</li><li>an opto-coupler,</li><li>wherein the opto-coupler is arranged to receive its input from the secondary control circuit and to provide its output as a control signal to the primary control circuit, and</li><li>the primary control circuit comprises a compensation circuit adapted to process the control signal to generate a compensation signal,</li><li>the primary control circuit being adapted to generate the driving signal based upon a combination of the control signal and the compensation signal,</li><li>and wherein the compensation circuit is adapted to detect, in the control signal, changes from a desired operating condition and generate the compensation signal so as to make the control signal return to the desired condition.</li></ul></p><p id="p0023" num="0023">The present inventors have recognised that the opto-coupler is a potentially significant cause of energy loss, in an SMPS. The operating current of an opto-coupler must remain higher than a minimum value to guarantee a normal function of the opto-coupler. The maximum operating current occurs at minimum load and a minimum current is required that occurs at a maximum load. In a conventional control circuit configuration, the maximum operating current of the opto-coupler is then determined by the parameters of the SMPS. However, the inventors have recognised that it is possible to reduce the range of the current flowing in the opto-coupler without reducing the operating power range of the SMPS. This can enable the total power dissipation (loss) in the SMPS to be reduced, because the maximum energy loss in the opto-coupler is reduced, compared to the conventional control circuit.</p><p id="p0024" num="0024">The inventors have further recognised that in a common control circuit configuration, the opto-coupler draws maximum current when the SMPS is lightly loaded or has no load. The invention has particular benefit for such a circuit configuration, because the opto-coupler current at no-load contributes a substantial proportion of the total energy consumption in this state.</p><p id="p0025" num="0025">According to embodiments of the circuit summarised above, the compensation signal corrects for changes in the control signal - in particular changes that are caused by a change in the load - in order to return the control signal to the desired operation point or range. This is advantageous because the control signal is provided by the output of the<!-- EPO <DP n="5"> --> opto-coupler and is therefore directly related to energy dissipation in the opto-coupler. With a control circuit according to an embodiment of the present invention, the operating point of the opto-coupler can be chosen so as to reduce the energy dissipation in the opto-coupler. When the load on the power supply changes, this is detected by the secondary control circuit and fed-back to the primary control circuit via the opto-coupler. However, instead of the opto-coupler remaining at a different operating point (voltage and/or current) or operation range, the compensation circuit adapts the compensation signal so that the opto-coupler output can return to its original (low-loss) operating point or range. This helps to increase the overall energy efficiency of the power supply, by avoiding unnecessary energy dissipation.</p><p id="p0026" num="0026">The compensation circuit - through the feedback loop formed by the switched-mode power supply and its control circuit - tends to resist and undo changes in the control signal by changing the compensation signal to adapt the power delivered to the load. One implication of this is that different driving signals can be generated for the same value of the control signal by varying the value of the compensation signal. That is, the parameters of the driving signal are no longer a monotonic function of the control signal. Similarly, the output power generated as a result of the switching is no longer a monotonic function of the control signal (since the switching is controlled by the driving signal).</p><p id="p0027" num="0027">The desired operating condition of the control signal may comprise a desired voltage or desired voltage range, or a desired current or desired current range, or any combination of these parameters.</p><p id="p0028" num="0028">The switching element at the input side controls the flow of power into the input side and therefore the power delivered at the output side of the SMPS. The driving signal is for controlling the switching element to switch between open (non-conductive) and closed (conductive) states.</p><p id="p0029" num="0029">The input to the opto-coupler may comprise a current generated by the secondary control circuit. The output from the opto-coupler, which comprises the control signal for the primary control circuit, may comprise an output voltage across the output of the opto-coupler.</p><p id="p0030" num="0030">Note that, as summarised above, the compensation signal is generated based on the control signal; however, it is also able to influence the control signal, in order to bias it to the desired operating point. The compensation signal can influence the control signal by means of a feedback loop: the compensation signal affects the driving signal (because the driving signal is generated by combining the control signal and the compensation signal); the driving signal controls the switching of the switching element and thereby the<!-- EPO <DP n="6"> --> output power of the SMPS; the secondary control circuit monitors the output power of the SMPS and this determines the input current to the opto-coupler; and the opto-coupler output is the control signal.</p><p id="p0031" num="0031">The compensation circuit may comprise at least one comparator, configured to compare the control signal with at least one predetermined threshold value, and a counter, coupled to the comparator and configured to increment or decrement a level of the compensation signal when the control signal reaches or crosses the threshold.</p><p id="p0032" num="0032">The counter changes the compensation signal when the control signal reaches or crosses the threshold. The predetermined threshold may be fixed or may be dependent upon the level of the compensation signal.</p><p id="p0033" num="0033">Here, stepping the compensation signal to a different value is analogous to changing gear in a car. The control signal is analogous to the throttle (accelerator) controlling the revolution of the engine. By shifting gears, the car can maintain the same speed with lower revs.</p><p id="p0034" num="0034">The compensation circuit may comprises: a first comparator arranged to increment a value of the counter if the control signal exceeds a first threshold; and a second comparator arranged to decrement the value of the counter if the control signal drops below a second threshold.</p><p id="p0035" num="0035">Continuing the analogy above, the first comparator triggers a change to a higher "gear" and the second comparator triggers a change to a lower "gear". The first and second thresholds represent a desired operating range for the control signal.</p><p id="p0036" num="0036">The compensation circuit may further comprise a first timer, configured to disable further incrementing or decrementing of the compensation signal level for a predetermined time interval after a previous increment or decrement has occurred, respectively.</p><p id="p0037" num="0037">Waiting for a predetermined time interval allows the control signal to drop back within the desired range. The timer suppresses unnecessary additional steps (increments or decrements) in the compensation signal. If the control signal reverts to the desired range within the interval, then the preceding increment/decrement in the compensation signal was sufficient, and not further step is made. On the other hand, if the control signal is still outside the desired range after the time interval has elapsed, then the comparator will trigger the counter once more to further increment or decrement the compensation signal. For the first timer, the duration of the time interval may be chosen according to the reaction time of the feedback loop. A longer reaction time can be accommodated by choosing a longer duration for the time interval.<!-- EPO <DP n="7"> --></p><p id="p0038" num="0038">The compensation circuit may further comprise a second timer, configured to disable incrementing of the compensation signal level for a predetermined time interval after a previous decrement has occurred; and/or disable decrementing of the compensation signal level for a predetermined time interval after a previous increment has occurred.</p><p id="p0039" num="0039">The second timer suppresses bounce - that is, it prevents the compensation signal from reverting to its previous level immediately after an increment or decrement has occurred. This improves the stability of the circuit.</p><p id="p0040" num="0040">The time interval associated with the second timer may be longer or shorter than the time interval associated with the first timer. The time interval for the second timer may be chosen according to the stabilization time of the feedback loop - a longer stabilization time can be accommodated by a longer duration for the time interval.</p><p id="p0041" num="0041">The primary control circuit may be configured so that the compensation signal controls a peak current in the input side of the power supply.</p><p id="p0042" num="0042">The current in the input side may increase while the switching element is turned on. The peak current may be determined by switching off the element, when a threshold is reached. The peak current can therefore influence the output power delivered to the load, by controlling the duty cycle of the switching element. The current in the input side may be sensed by measuring the voltage across a sense-resistor connected in series with the switching element. This voltage provides a sense signal.</p><p id="p0043" num="0043">Note that the peak current may also, optionally, be influenced by other factors - it need not be uniquely determined by the compensation signal.</p><p id="p0044" num="0044">The control signal may be coupled to one input of a comparator which determines the peak current and the other input of the comparator may depend upon the compensation signal.</p><p id="p0045" num="0045">The compensation signal may be indirectly coupled to the other input of the comparator. For example, the compensation signal may be combined with a sense signal which is proportional to a current flowing in the switching element. In particular, the compensation signal and sense signal may be combined by adding them, or subtracting one from the other.</p><p id="p0046" num="0046">The primary control circuit may be configured such that the compensation signal controls a conversion frequency of the power supply.</p><p id="p0047" num="0047">The conversion frequency may be defined as the frequency with which the switching element is turned on - for example, a conversion frequency of 100 kHz would mean that the switching element is turned on one hundred thousand times per second.<!-- EPO <DP n="8"> --> The conversion frequency influences the power supplied to the load by controlling how often the switching element is activated. Therefore, the compensation signal may be used to determine the frequency of the driving signal.</p><p id="p0048" num="0048">Note that the conversion frequency need not be uniquely determined by the compensation signal - it may also, optionally, be affected by other factors.</p><p id="p0049" num="0049">The primary control circuit may comprise a Voltage Controlled Oscillator controlled by the compensation signal.</p><p id="p0050" num="0050">The control input of the VCO may be coupled to the output of the compensation circuit.</p><p id="p0051" num="0051">When the compensation circuit comprises the at least one comparator and the counter, as summarised above, the Voltage Controlled Oscillator (VCO) may be controlled by the output of the counter.</p><p id="p0052" num="0052">The primary control circuit may comprise a latch and the output of the Voltage Controlled Oscillator may be coupled to an input of the latch.</p><p id="p0053" num="0053">The latch may be an RS-latch. The output of the VCO may be coupled to a SET input of the latch. The RESET input of the latch may be coupled to the output of a comparator. This comparator may be arranged to compare the control signal with a sense signal that is proportional to a current flowing in the switching element.</p><p id="p0054" num="0054">A first range of output power deliverable by the power supply at a first value of the compensation signal may overlap with a second range of output power deliverable by the power supply at a second, different value of the compensation signal.</p><p id="p0055" num="0055">The output power actually delivered within each range may be determined by the control signal. Thus, the same feature may also be specified as follows: the output power delivered for a maximum value of the control signal and a first value of the compensation signal is more than the output power delivered for a minimum value of the control signal and a second, higher value of the compensation signal.</p><p id="p0056" num="0056">Overlapping ranges, as summarised above, can ensure that there is always a steady-state solution near the boundary between ranges, and also avoid undesired gear shift caused by noise or crosstalk near the boundary of the gears. In cases where there is no overlap, if the load power just corresponds to the boundary of the two gears, small amplitude noise can cause continual gear shifts between the maximum power of the lower gear and minimum power of the higher gear. Over the manufacture spread of the primary control circuit or the transformer, it may occur that the maximum power of lower gear is lower than the minimum power of higher gear. As a result, a small "power gap" may appear. If the DC load power falls in this gap, the converter will continually shift gears,<!-- EPO <DP n="9"> --> since there is no steady state solution. The use of overlapping ranges can help to avoid this.</p><p id="p0057" num="0057">In some embodiments, the compensation signal is continuously variable.</p><p id="p0058" num="0058">Here, continuously variable means that the compensation signal can assume and maintain substantially any value within a range. A contrast may be drawn with a discrete-valued signal, which can only step between discontinuous levels.</p><p id="p0059" num="0059">The primary control circuit may be adapted to add the compensation signal and the control signal, and to use the resulting summed signal to generate the driving signal.</p><p id="p0060" num="0060">In this case, the compensation is direct, in that the summed signal replaces the control signal for generating the driving signal. The compensation signal and the control signal both influence the same parameter of the primary control circuit.</p><p id="p0061" num="0061">The compensation circuit may be adapted to compare the control signal with a predetermined reference value and to generate the compensation signal based on the result of this comparison.</p><p id="p0062" num="0062">By means of the feedback loop, through the input and output sides of the SMPS and the secondary and primary control circuits, the compensation signal can bias the control signal toward the predetermined reference value. This means that the opto-coupler always tends to revert to a desired operating point, which can be chosen so as to reduce or minimise power consumption.</p><p id="p0063" num="0063">The compensation circuit may be adapted to generate the compensation signal based on low-pass filtering of the result of the comparison.</p><p id="p0064" num="0064">As a result of the low-pass filtering, the compensation signal can adapt to long term changes in the load. Meanwhile, short term changes in the load can cause the control signal to change in response.</p><p id="p0065" num="0065">Optionally, the primary control circuit may further comprise a boundary detector and corrector unit adapted to detect clipping of the control signal at a maximum and/or minimum voltage and, in response, to modify the compensation signal. For example, the boundary detector and corrector unit may set the compensation signal to a value of zero when clipping is detected.</p><p id="p0066" num="0066">According to another aspect of the invention, there is provided a SMPS comprising any one of the control circuits as summarised above.</p><p id="p0067" num="0067">In general, any of the control circuits summarised above may be used with any kind of SMPS. In some embodiments, the primary side of the SMPS is electrically (galvanically) isolated from the secondary side of the SMPS. In particular, this isolation may be provided by a transformer.<!-- EPO <DP n="10"> --></p><p id="p0068" num="0068">In any of the control circuits summarised above, the SMPS may comprise a flyback converter, or a resonant converter. A flyback converter is a buck-boost converter comprising a transformer for galvanic isolation. In a resonant converter a half bridge stage is applied to drive a resonant tank. In the resonant tank energy resonates between a capacitor and at least one inductor, while part of this resonating energy is delivered to a load. For mains isolation, the inductor may be replaced by a transformer. A well-known example of a resonant converter is an LLC converter.</p><p id="p0069" num="0069">The invention will now be described by way of example with reference to the accompanying drawings, in which:
<ul><li><figref idrefs="f0001">Fig. 1</figref> shows a schematic circuit diagram for a Switched-Mode Power Supply (SMPS) with a flyback converter controlled by a control circuit according to an embodiment of the invention;</li><li><figref idrefs="f0001">Fig. 2</figref> illustrates a mode of operation of the SMPS of <figref idrefs="f0001">Fig. 1</figref>;</li><li><figref idrefs="f0002">Fig. 3</figref> shows a secondary control circuit suitable for the SMPS of <figref idrefs="f0001">Fig. 1</figref>;</li><li><figref idrefs="f0002">Fig. 4</figref> shows a primary control circuit for the SMPS, according to a comparative example;</li><li><figref idrefs="f0003">Fig. 5</figref> is a sketch of a typical control signal vs. power characteristic of the SMPS;</li><li><figref idrefs="f0003">Fig. 6</figref> is a sketch of a corresponding relationship between opto-coupler current and power;</li><li><figref idrefs="f0003">Fig. 7</figref> shows a control-signal vs. power characteristic, having a plurality of "gears" according to an embodiment of a first aspect of the invention;</li><li><figref idrefs="f0004">Fig. 8</figref> illustrates a transition from a high power to a low power, with the characteristic of <figref idrefs="f0003">Fig. 7</figref>;</li><li><figref idrefs="f0004">Fig. 9</figref> shows a primary control circuit according to a first embodiment of the first aspect of the invention;</li><li><figref idrefs="f0005">Fig. 10</figref> shows a primary control circuit according to a second embodiment of the first aspect of the invention;</li><li><figref idrefs="f0006">Fig. 11</figref> shows a primary control circuit according to a third embodiment of the first aspect of the invention;</li><li><figref idrefs="f0006">Fig. 12</figref> shows an alternative to the characteristic of <figref idrefs="f0003">Fig. 7</figref>, with variable threshold voltages;</li><li><figref idrefs="f0007">Fig. 13</figref> shows a further alternative characteristic, wherein the power ranges of successive gears overlap;<!-- EPO <DP n="11"> --></li><li><figref idrefs="f0007">Fig. 14</figref> shows a primary control circuit according to a first embodiment of a second aspect of the invention;</li><li><figref idrefs="f0008">Fig. 15</figref> is illustrates the operation of a SMPS according to a comparative example;</li><li><figref idrefs="f0008">Fig. 16</figref> illustrates the operation of a SMPS with the primary control circuit of <figref idrefs="f0007">Fig. 14</figref>;</li><li><figref idrefs="f0009">Fig. 17</figref> shows a primary control circuit according to a second embodiment of the second aspect of the invention;</li><li><figref idrefs="f0009">Fig. 18</figref> shows a schematic diagram of a current domain representation for embodiments according to the third aspect of the invention;</li><li><figref idrefs="f0010">Fig. 19</figref> shows a schematic diagram of a voltage domain representation for embodiments according to the third aspect of the invention;</li><li><figref idrefs="f0010">Fig. 20</figref> is a schematic diagram of a primary control circuit according to first embodiment of the third aspect of the invention;</li><li><figref idrefs="f0011">Fig. 21</figref> is a plot of the complex input impedance of the primary control circuit of <figref idrefs="f0010">Fig. 20</figref>;</li><li><figref idrefs="f0011">Fig. 22</figref> illustrates schematically how the primary control circuit of <figref idrefs="f0010">Fig. 20</figref> is able to reduce power consumption in the SMPS at no-load;</li><li><figref idrefs="f0012">Fig. 23</figref> is a schematic diagram of a primary control circuit according to a second embodiment of the third aspect of the invention;</li><li><figref idrefs="f0012">Fig. 24</figref> is a schematic diagram of a primary control circuit according to a third embodiment of the third aspect of the invention;</li><li><figref idrefs="f0013">Fig. 25</figref> is a schematic diagram of a variant of the primary control circuit in <figref idrefs="f0012">Fig. 24</figref>;<br/>
and</li><li><figref idrefs="f0014">Fig. 26</figref> is a schematic diagram of a primary control circuit according to a fourth embodiment of the third aspect of the invention;</li></ul></p><p id="p0070" num="0070">Exemplary embodiments of the invention will now be described. These embodiments relate to a SMPS comprising a flyback converter. However, as those skilled in the art will appreciate, the scope of the present invention is not limited to flyback converters - this is simply used as a convenient example, for the purposes of explanation.</p><p id="p0071" num="0071"><figref idrefs="f0001">Fig. 1</figref> shows a secondary sensed flyback converter operating with Discrete Conducting Mode (DCM). It consists of a transformer 100; power switch 110; a rectification diode 120; a load capacitor C<sub>L</sub>; a sense resistor 130; a primary control circuit 140; and a secondary control circuit 150.<!-- EPO <DP n="12"> --></p><p id="p0072" num="0072">The switch 110 is connected in series with the primary side 101 of the transformer. In this embodiment, the switch is provided by a Metal Oxide Semiconductor (MOS) Field Effect Transistor (FET). The sense resistor 130 is connected to the source of the transistor 110. The voltage across the sense resistor 130 provides one input to the primary control circuit 140. The output of the primary control circuit 140 is a driving signal, which is connected to the gate of the switching transistor 110.</p><p id="p0073" num="0073">The rectifying diode 120 and load capacitor C<sub>L</sub> are connected in series with the secondary side 102 of the transformer. The output voltage of the SMPS is provided across the terminals of the capacitor. This voltage is monitored by the secondary control circuit 150. The secondary control circuit 150 is galvanically isolated from the primary control circuit 140; however, the circuits are adapted so that an output of the secondary control circuit 150 is optically coupled to an input of the primary control circuit 140. (This optical coupling is omitted from <figref idrefs="f0001">Fig. 1</figref>, for clarity.)</p><p id="p0074" num="0074">The timing diagram of the flyback converter of <figref idrefs="f0001">Fig. 1</figref> is shown in <figref idrefs="f0001">Fig.2</figref>. Here, I<sub>sw</sub> is the current flowing in the switch 110 and I<sub>d</sub> is the current in the diode 120. During the primary stroke 201 of each conversion cycle, the switch 110 is turned on, and the current of the switch as well as the primary current of transformer will increase. In this phase, energy is stored in the primary side 101 of transformer. Then, during the secondary stroke 202, the switch 110 is turned off, a decreasing current (related to the primary current of the transformer during the first stroke) will flow to the load through the diode 120, and the transformer 100 is being demagnetized. After the current flowing to the load drops to zero, the first stoke 201 starts again at a predetermined time instant. The power delivered to the load can be controlled by various parameters, such as the peak current, I<sub>peak</sub>, which is reached during the primary stroke 201, the conversion frequency and so on. The conversion frequency is defined as the frequency with which the switch 110 is turned on.</p><p id="p0075" num="0075">The secondary control circuit 150 is shown in greater detail in <figref idrefs="f0002">Fig. 3</figref>. It comprises a resistive divider (R1, R2), a Light Emitting Diode (LED) 300, which forms one half of an opto-coupler, a resistor, R<sub>LED</sub>, connected to the LED to set the gain, an error amplifier 310, and a capacitor 320 connected between the input and the output of the error amplifier. The output voltage of the converter is sensed by the resistive divider, and then processed by the error amplifier 310 that controls the current flowing through the LED. In particular, the error amplifier amplifies the difference between a voltage signal produced by the resistive divider (coupled to the inverting input of the amplifier) and a reference voltage, V<sub>ref</sub> (coupled to the non-inverting input).The current, I<sub>opto</sub>, flowing in the LED determines its light emission. The emitted light intensity will be detected by the other half of the opto-coupler,<!-- EPO <DP n="13"> --> in the primary control circuit 140, in order to control the power delivery. Thus, the secondary and primary control circuits together form a feedback loop from the output of the SMPS to the driving signal which controls the switch 110. The capacitor 320 stabilizes the entire feedback loop by providing a local negative feedback for the error amplifier. Due to the high DC gain of the error amplifier 310, the DC value of V<sub>out</sub> will be determined by the reference voltage (V<sub>ref</sub>) in the error amplifier.</p><p id="p0076" num="0076">The secondary circuit monitors the output voltage of the SMPS. However, there is an error amplifier consisting of a opamp and a capacitor (shown in <figref idrefs="f0002">Fig. 3</figref>) in the feedback loop. The high DC gain of the error amplifier ensures a high DC loop-gain, which makes the output voltage almost independent of the load current. The capacitor in the error amplifier (shown in <figref idrefs="f0002">Fig.3</figref>) is used to reduce the loop gain at high frequency, and thus stabilize the control loop.</p><p id="p0077" num="0077">In the present embodiment of the invention, the secondary control circuit 150 is similar to that of a conventional secondary-sensed SMPS. Likewise, the overall principle of operation of the flyback converter may be similar to a conventional SMPS. For this reason, the secondary control circuit and general operation of the SMPS will not be described in further detail here.</p><p id="p0078" num="0078">An exemplary conventional primary control circuit 140 is shown in <figref idrefs="f0002">Fig. 4</figref>. A lighting-controlled bipolar transistor 400 is connected in series with a resistor 410, in order to generate the primary control signal V<sub>ctrl</sub>. The transistor 400 forms the other half of the opto-coupler, of which the LED 300 in the secondary control circuit forms the first half. When the LED 300 shines more brightly, more light falls on the lighting-controlled transistor 400, allowing a larger current to flow. This pulls the control signal, V<sub>ctrl</sub>, lower. Conversely, when less light falls on the transistor, V<sub>ctrl</sub> will assume a higher value. A capacitor 430 is connected in parallel with the transistor 400, and is used for noise filtering for the control signal.</p><p id="p0079" num="0079">The control signal V<sub>ctrl</sub> is connected to the inverting input of a comparator 420, as a reference level to determine the peak current in primary side of the transformer. The non-inverting input of the comparator 420 is connected to the sense resistor 130. The output of the comparator 420 is coupled to the "Reset" input of an RS latch 440. The "Set" input of latch 440 is provided by a periodic square-wave signal fc. The output of the latch 440 provides the input to a driver circuit 450. In turn, the driver circuit 450 drives the gate of the power MOSFET 110 to make it turn on or off.</p><p id="p0080" num="0080">When the sense voltage (across the sense resistor 130) reaches V<sub>ctrl</sub> during the primary stroke, the comparator output will reset the RS latch, so as to turn off the switch<!-- EPO <DP n="14"> --> 110. Then, the periodic signal fc will set the latch again at a predetermined moment to turn the switch 110 on again.</p><p id="p0081" num="0081">The polarity of the secondary control circuit 150, shown in <figref idrefs="f0002">Fig. 3</figref>, determines that lower load power will correspond to lower values of the control signal V<sub>ctrl</sub> and higher current in the opto-coupler 300, 400. Likewise, higher load power corresponds to higher values of the control signal and lower opto-coupler current. This ensures negative feedback in the overall control loop for the converter. When the load power is very low, V<sub>ctrl</sub> will drop below a threshold level V<sub>br</sub>, then the primary control circuit 140 will disable the power conversion. As a result, the output voltage will drop due to the load current, which makes V<sub>ctrl</sub> higher than the threshold again. Thus, at very low power, the power converter will work in a burst-mode, and V<sub>ctrl</sub> will be approximately equal to the threshold V<sub>br</sub> in steady-state. The graph of <figref idrefs="f0003">Fig. 5</figref> shows an exemplary approximate relationship between the control signal and output power, for the conventional primary control circuit of <figref idrefs="f0002">Fig. 4</figref>. The corresponding relationship between opto-coupler current and output power is illustrated in <figref idrefs="f0003">Fig. 6</figref>.</p><p id="p0082" num="0082">In practice, the current in the opto-coupler 300, 400 always has a finite minimum required value to ensure proper operation. The horizontal dashed line in <figref idrefs="f0003">Fig. 6</figref> indicates this minimum allowed opto-coupler current. With the control circuit configuration exemplified in <figref idrefs="f0002">Figs. 3 and 4</figref>, this minimum current corresponds to the highest power that the converter will deliver. Consequently, in order to provide a wide range of output power levels, a high opto-coupler current will be drawn in the low-load or no-load condition. The energy dissipated due to this current can be a dominant factor in the no-load power consumption of the SMPS. Nevertheless, the configuration of the secondary control circuit illustrated in <figref idrefs="f0002">Fig.3</figref> is desirable due to the availability of low-cost error-amplifiers, such as the TL431 manufactured by Texas Instruments. Therefore, changing the polarity of the secondary control circuit is not an acceptable solution, for many cost-sensitive products.</p><p id="p0083" num="0083">According to embodiments of the present invention, the primary control circuit is modified so that the DC range of the control signal V<sub>ctrl</sub> is reduced, which enables the opto-coupler to operate in a smaller current range from its minimum operating current.</p><p id="p0084" num="0084">According to a first aspect of the invention, this is achieved by defining upper and lower limits, V<sub>H</sub> and V<sub>L</sub>, for the DC value of V<sub>ctrl</sub> at least over the majority of the load power range and changing another parameter (or "gear") in the primary control circuit when V<sub>ctrl</sub> goes outside this range. If the required value of V<sub>ctrl</sub> to achieve a given power output is higher than the upper limit and the other parameter (or gear) has not achieved the value for the maximum power delivery, that parameter (or "gear") will have a step change, so as<!-- EPO <DP n="15"> --> to deliver more power to the load. Similarly, if the required value of V<sub>ctrl</sub> is lower than the low limit and the other parameter (or gear) has not achieved the value for the minimum power delivery, this parameter or "gear" will have a step change to deliver less power to the load. As a result, due to the negative feedback of the whole converter, V<sub>ctrl</sub> will be well limited in the defined range at steady state, and this range of V<sub>ctrl</sub> can be much smaller than that with a conventional primary control circuit over the same load power range, due to the "gear" shifting. Therefore, the opto-coupler current at no-load can be significantly reduced, if the power converter is designed such that the highest value of V<sub>ctrl</sub> over the whole load power range corresponds to the minimum allowed opto-coupler operating current. With this approach, V<sub>ctrl</sub> as a function of load power is shown in <figref idrefs="f0003">Fig. 7</figref>, where each gear G1-G4 defines a certain range of power delivered to the load. In the example shown in <figref idrefs="f0003">Fig. 7</figref>, there are four gears.</p><p id="p0085" num="0085">Since the "gear" shift can be immediate or very fast, the transient response time for large load steps may also be improved, since V<sub>ctrl</sub> can remain almost unchanged during a gear-shift. This is illustrated by the dashed arrows shown in <figref idrefs="f0004">Fig. 8</figref>, for a load step from a high load power PH, to a low load power PL. Note that part of the trace is omitted for V<sub>ctrl</sub> due to the gear-shifting - that is, the control voltage does not need to traverse from high to low in each intermediate gear. This provides an additional advantage (in addition to the reduction in the maximum opto-coupler current).</p><p id="p0086" num="0086">A first embodiment of a primary control circuit 140a according to this first aspect of the invention is shown in <figref idrefs="f0004">Fig. 9</figref>. In <figref idrefs="f0004">Fig. 9</figref>, components that are identical to the circuit of <figref idrefs="f0002">Fig. 4</figref> are given the same reference numerals, and will not be described again.</p><p id="p0087" num="0087">In this embodiment, the peak current in the primary side of the transformer is used as the gear or parameter that is shifted to compensate for V<sub>ctrl</sub>. A compensation circuit 900 is provided, to set the parameter. The input to this circuit 900 is the control signal V<sub>ctrl</sub>; and the output is a compensation signal. The compensation signal is input to a subtractor unit 940, where it is subtracted from the sense signal. The output of this subtraction is input to the non-inverting input of the comparator 420. Consequently, in contrast to the conventional circuit of shown in <figref idrefs="f0002">Fig. 4</figref>, the primary control circuit of this embodiment differs in that the input to the comparator 420 is determined by the difference between the sense signal and the compensation signal, instead of being determined by the sense signal alone.</p><p id="p0088" num="0088">The compensation signal comprises two comparators 910 and 912. These are arranged to compare the control signal V<sub>ctrl</sub> with two reference levels, to determine if the gear needs to shift to higher or lower level. V<sub>ctrl</sub> is coupled to the inverting input of the first<!-- EPO <DP n="16"> --> comparator 910; while the non-inverting input is coupled to the low threshold level V<sub>L</sub>. V<sub>ctrl</sub> is also coupled to the non-inverting input of the second comparator 912; while the inverting input is coupled to the high threshold V<sub>H</sub>.</p><p id="p0089" num="0089">A counter 920 receives the outputs of these two comparators. The counter determines the state of the gear-parameter by counting up or down. A positive edge from the first comparator 910 causes the counter to decrement; and a positive edge from the second comparator causes the counter to increment.</p><p id="p0090" num="0090">The output of the counter is coupled to the input of a Digital-to-Analogue Converter (DAC). This is operable to convert the counter output into an analogue signal which forms the compensation signal. By using a slow DAC, the gear shift may be made gradual. Alternatively, by using a fast DAC, the gear shift can be immediate. In some implementations, V<sub>H</sub> and V<sub>L</sub> can also be made variable by adding two extra DACs which convert the counter output into V<sub>H</sub> and V<sub>L</sub> separately. In this case, the thresholds V<sub>H</sub> and V<sub>L</sub> are dependent on the state of the gear as shown in <figref idrefs="f0006">Fig. 12</figref>. With different offsets added and/or different resolutions, the different DACs can convert the same input digital code (provided by the counter) into appropriate different analogue values.</p><p id="p0091" num="0091">A second embodiment of a primary control circuit 140b, according to the first aspect of the invention, is shown in <figref idrefs="f0005">Fig. 10</figref>. The compensation circuit 1000 in this embodiment is similar to the embodiment of <figref idrefs="f0004">Fig. 9</figref>, with the addition of three timers 1010, 1020, 1030, to control when the gear-parameter can change. In particular, the timers disable gear shifts in some circumstances.</p><p id="p0092" num="0092">According to the circuit shown in <figref idrefs="f0005">Fig. 10</figref>, when <i>shifth</i> or <i>shiffl</i> becomes high, the counter 920 will count up or down, respectively, so as to shift the gear. The first timer 1010 starts immediately after the gear-shifting. The output of the first timer is a control input to the counter 920. This timer 1010 stops after about 100µs. At this instant, if the same input <i>shifth</i> or <i>shiftl</i> that triggered the timer is still high, the gear-parameter will be shifted further and the timer 1010 will be restarted. Otherwise, no further gear shift will happen. Thus, the first timer 1010 enables multiple shifts to happen in an orderly fashion, by preventing further increments or decrements until a predetetermined time interval after the preceding increment or decrement, respectively. If V<sub>ctrl</sub> reverts back into the defined range within the delay time, a further gear shift is abandoned. Otherwise, gear will shift to further higher or lower level after the delay.</p><p id="p0093" num="0093">The other timers help to prevent oscillations. When <i>shiffl</i> becomes high, the gear-parameter will be decremented to one level lower. At this instant, the second timer 1020 will start and its output, <i>enableh,</i> will become low immediately. After a time interval,<!-- EPO <DP n="17"> --> <i>enableh</i> will become high again. The output of the second timer is provided as an input to an AND gate 1040, the other input of which is provided by the signal <i>shifth,</i> from comparator 912. The output of the AND gate is coupled to the counter 920. In this way, the second timer disables an upward gear-shift (back to the previous, higher level) until after a time delay. Likewise, when <i>shifth</i> becomes high, the gear-parameter will shift to one level higher, the third timer 1030 will start and <i>enablel</i> will be low immediately, in order to disable a gear shift back to the previous (lower) level until after a time delay. In this embodiment, the time delay of the second and third timers is about 300µs.</p><p id="p0094" num="0094">A third embodiment of a primary control circuit 140c according to the first aspect of the invention is shown in <figref idrefs="f0006">Fig. 11</figref>. Here, instead of peak current, conversion frequency is used as the gear parameter. The compensation circuit 1100 is configured similarly to the compensation circuit 900 of <figref idrefs="f0004">Fig. 9</figref>. However, the compensation signal output by the DAC 930 is used to drive a voltage-controlled-oscillator (VCO) 1110. The output of this VCO 1110 provides the signal fc that controls the the "Set" input on the RS latch 440. Thus the compensation signal determines the frequency with which the switch 110 is turned on, and thereby the conversion frequency of the flyback converter.</p><p id="p0095" num="0095">As mentioned above for <figref idrefs="f0004">Fig. 9</figref>, by using a slow DAC 930, the gear shift can be made gradual. Alternatively, by using a fast DAC, the gear shift can be immediate. V<sub>H</sub> and V<sub>L</sub> can also be made variable by adding two extra DACs which convert the counter output into V<sub>H</sub> and V<sub>L</sub> separately. Also, timers can be added in exactly the same way as shown in <figref idrefs="f0005">Fig. 10</figref> (and described above), to disable shifting of the gears under predefined conditions.</p><p id="p0096" num="0096">As those skilled in the art will appreciate, the embodiments described above are examples to show how the principles of the first aspect of the invention can be implemented. The scope of the first aspect is not limited to these examples. In particular, it is noted that any suitable number of gears can be chosen. Each gear corresponds to a signal-level of the compensation signal. In the examples above, the number of gears is determined by the counter: each value output by the counter corresponds to a different compensation signal level.</p><p id="p0097" num="0097">In the embodiments above, the "gear"-parameters chosen were the peak current in primary side of transformer and the conversion frequency respectively. However, other gear-parameters may also be chosen. In some embodiments, a combination of gear-parameters may be used. For example, both the peak current and the conversion frequency might be varied concurrently. In the embodiments above, the parameter used as the "gear" was uniform for all the gears. However, in other embodiments, different<!-- EPO <DP n="18"> --> gears (G1, G2, etc.) may be provided by shifting different parameters. As mentioned, the shifting of the or each gear-parameter may be immediate, but could also be gradual.</p><p id="p0098" num="0098">Note that for all the embodiments shown above, V<sub>H</sub> and V<sub>L</sub> were uniform for all gears - that is, over the whole power-range. However, this is not essential. For example, as shown in <figref idrefs="f0006">Fig. 12</figref>, V<sub>H</sub> and V<sub>L</sub> may increase (in particular, linearly) over the whole power range.</p><p id="p0099" num="0099">Note that for the embodiments described above, the maximum power of each lower gear was identical to the minimum power of the next-higher gear. This is not essential. Indeed, it may be desirable in some cases to provide some "hysteresis", whereby the power-ranges of the gears overlap over some finite range. For example, the minimum output power of a gear G<sub>n</sub> may be lower than the maximum output power in the adjacent lower gear G<sub>(n-1)</sub>. This is illustrated in <figref idrefs="f0007">Fig. 13</figref>. The benefit of this overlap is that it can avoid repeated shifts between two adjacent gears when the load power happens to fluctuate near to the boundary of the two gears: for example, after a shift to a higher gear is triggered, it is possible for the power consumption in the load to reduce slightly (below the power-level at which the upward-shift was triggered) without triggering a shift back to the lower gear. This approach can be used in addition to the use of time-delays to prevent undesired gear-shifting. As summarised previously above, the use of overlap can also help to mitigate the effects of process-spread, by helping to avoid gaps between the maximum power of one gear and the minimum power of a higher gear.</p><p id="p0100" num="0100">According to a second aspect of the invention, the DC range of the control signal V<sub>ctrl</sub> is reduced in a different way. Instead of shifting an independent parameter of the primary control circuit, the circuit includes an adaptive offset which is added to the control signal and the combined signal is then used to control the output power.</p><p id="p0101" num="0101">A first embodiment of a primary control circuit 140d according to the second aspect of the invention is shown (in part) in <figref idrefs="f0007">Fig. 14</figref>. In this embodiment, an offset is added to the control signal V<sub>ctrl</sub> by a summation block 1440. In particular, a compensation circuit 1400 is provided, which produces a compensation signal, vcomp, to be added to the control signal by the summation block 1440. The compensation circuit comprises a transconductance amplifier 1410, with a current source output 1420 and a Low-Pass Filter (LPF) 1430. The input to the compensation circuit is the control signal V<sub>ctrl</sub>. This input is provided to the non-inverting input of the amplifier 1410. A reference voltage V<sub>ref</sub> is provided at the inverting input of the amplifier. The output of the amplifier 1410 is a current source 1420. This in turn is coupled to the input of the filter 1430. The low-pass filtered output signal is the compensation signal, which is provided to the summation block 1440<!-- EPO <DP n="19"> --> of the primary control circuit. Note that the compensation signal in this example is continuously variable.</p><p id="p0102" num="0102">The amplifier 1410 creates an error signal based on the difference between the reference V<sub>ref</sub> and the instantaneous value of the control signal V<sub>ctrl</sub>. Due to the low pass filter after the amplifier, the compensation signal will be slowly regulated to a value that ensures that V<sub>ctrl</sub> equals V<sub>ref</sub>. This regulation occurs because of the feedback pathway through the power supply. This gives a steady state characteristic in which V<sub>ctrl</sub> always returns to a uniform desired value V<sub>ref</sub> over a long time interval. Over a shorter time interval, however, the low pass filter prevents compensation signal from changing suddenly. Therefore, for the short term dynamic relationship between V<sub>ctrl</sub> and output power, the original gain is maintained, allowing for the desired loop specification - for example, in terms of stability and dynamic response. The compensation circuit can be understood as providing a parallel feedback pathway, with a slower time constant. The time constant of this second feedback path should be chosen such that the stability of the main loop (based on V<sub>ctrl</sub>) is not significantly affected by the second pathway. The time constant can be adjusted by the gain and frequency dependent behavior of the second feedback path.</p><p id="p0103" num="0103">In this embodiment, using a transconductance amplifier, the LPF includes a capacitor. Assuming the main regulation loop of the SMPS is much faster than the adjusting loop, the timeconstant is defined by the product of 1/transconductance of 1410 (1/GM) and capacitor in the LPF. This can be understood by assuming V1 is constant (belonging to a certain output power and a fast loop) as V1 is constant, a variation deltaV at the compensation output (vcomp) should induce -deltaV at Vctrl, effectively giving a minus 1 gain from compensation signal to Vcontrol and therefore a loopgain of the local loop equal to GM x 1/(jwC) and transfer from Vref to compensation signal vcomp/Vref=gm/jwC/[1+gm/jwC]=1/[1+jwC/GM] giving Tau=C/GM</p><p id="p0104" num="0104">The fixed steady state value for V<sub>ctrl</sub> reduces the current consumption at no load, because the resistor at the opto-coupler output can now be chosen according to a single desired opto-coupler current, which is valid for both high and low loads.</p><p id="p0105" num="0105">The output of the summation block (adder) 1440 is provided to the remaining part of the primary control circuit. Comparing <figref idrefs="f0007">Fig. 14</figref> with the conventional primary control circuit of <figref idrefs="f0002">Fig. 4</figref>, it can be seen that the combined signal V1 replaces the control signal V<sub>ctrl</sub> at the input to the comparator 420. However, as those skilled in the art will appreciate, the compensation circuit 1400 and adder 1440 shown in <figref idrefs="f0007">Fig. 14</figref> can be used in a variety of other suitable primary control circuits for switched mode power supplies. In all such<!-- EPO <DP n="20"> --> embodiments, the combined signal V1 produced by the adder 1440 can replace the direct use of the control signal V<sub>ctrl</sub> output by the opto-coupler.</p><p id="p0106" num="0106"><figref idrefs="f0008">Figs. 15 and 16</figref> show the results of simulations of an SMPS based on the primary control circuit of <figref idrefs="f0007">Fig. 14</figref>. In greater detail, the parameters of the circuit are as follows:
<ul><li>C<sub>L</sub> : 1000 µF</li><li>R1 : 100 kΩ</li><li>R2 : 150 kΩ</li><li>R<sub>LED</sub> : 1 kΩ</li><li>Feedback capacitor 320, in secondary control circuit: 200pF</li><li>Resistor (not shown in <figref idrefs="f0002">Fig. 3</figref>) connected in series with this capacitor: 500 kΩ</li><li>Resistor 410, in series with light-controlled transistor: 1.5 kΩ</li></ul></p><p id="p0107" num="0107">In the simulation, the SMPS was represented by a current source that models the transfer from control input to output current, as delivered to the output electrolytic capacitor of the SMPS (C<sub>L</sub>). V<sub>ref</sub>, which determines the control signal V<sub>ctrl</sub> in steady state operation, was set to 3V.</p><p id="p0108" num="0108">The error loop of <figref idrefs="f0002">Fig. 3</figref> can alternatively be implemented in a slightly different way. The gain can be set by Rled only and killing the gain of 310 by adding a large capacitor. It is also possible to let 310 determine the gain together with Rled. Then the compensation network around 310 can for example be a capacitor in series with a resistor and optionally a second capacitor in parallel. Nevertheless, as those skilled in the art will appreciate such implementation details do not change the basic idea of the invention.</p><p id="p0109" num="0109"><figref idrefs="f0008">Fig. 15</figref> shows the results when the compensation circuit 1400 is disabled, as a comparative example. This corresponds to the operation of the circuit illustrated in <figref idrefs="f0002">Fig. 4</figref>. The first (top) plot shows the total opto-coupler current; the second plot shows the load current; the third plot shows the control signal V<sub>ctrl</sub>; the fourth plot shows the compensation signal; and the fifth (bottom) plot shows the output voltage V<sub>out</sub>.</p><p id="p0110" num="0110">At a time t=1ms, the load steps from a high load to low load. This is seen in the load current in the second plot. It can be seen clearly that the total opto-coupler current increases in response to this reduction in the load. The total opto-coupler current is the sum of the input current and output current of the opto-coupler. The control signal V<sub>ctrl</sub> drops in conjunction with the increase in the opto-coupler current.</p><p id="p0111" num="0111"><figref idrefs="f0008">Fig. 16</figref> shows the corresponding results when the adaptive offset provided by the compensation circuit 1400 is activated. Initially, after the step in the load, the opto-coupler current increases, but thanks to the slow, adaptive part, the current in the opto-coupler<!-- EPO <DP n="21"> --> gradually returns to the same steady-state value, independent of the load. Meanwhile, the dynamic performance of the loop is not altered.</p><p id="p0112" num="0112">An optional additional feature of the second aspect of the invention concerns a correction to the compensation signal when the clipping of the control signal occurs. As the compensation signal adds an offset to the control signal, the risk is increased that as a result of a step-change in the load, Vctrl could clip. In order to prevent this problem, a boundary detector and corrector block 1710 is added to the adaptive part of the compensation circuit. This is shown in a second embodiment of the primary control circuit 140e, according to the second aspect of the invention, as illustrated in <figref idrefs="f0009">Fig. 17</figref>. The boundary detector can detect the clipping situation and can change the instantaneous offset generated by the compensation circuit. The offset can for example be made 0 when a clipping situation is detected.</p><p id="p0113" num="0113">The boundary detector detects when Vctrl reaches an upper or lower edge of the operating window. In response, the value of the compensation signal is overruled by a correction mechanism in order to maintain V1 within the edges of the desired operation window. The correction mechanism is based on the difference between an edge of the operating window and the value of Vctrl. The implementation of the boundary detector and correction block 1710 will be within the capabilities of one skilled in the art. For example, a transconductance amplifier with only one direction of current flow could be used, where current is put into the capacitor or drawn from the capacitor of the LPF when a border is crossed and with a current proportional to the difference between Vctrl and border. This could be implemented by 2 amplifiers, one for an upper limit and one for a lower limit. In other embodiments, a digital counter counting up or down proportional to vref-vctrl followed by an AD converter is possible. In this case, the correction mechanism should be based for example on adapting the counter.</p><p id="p0114" num="0114">According to a third aspect of the invention, the opto-coupler current is reduced in yet another way. According to embodiments of the third aspect, the compensation circuit provides an additional feedback loop between the control signal which determines the power output and the opto-coupler. This separate loop regulates the current in the opto-coupler to a desired (often, but not necessarily fixed) level over a long time, but for high frequency changes, the original characteristic of increasing current when reducing Vcontrol is used, in this way preventing a potential instability problem of the main regulation loop.</p><p id="p0115" num="0115">In one part of the third aspect of the invention, the transfer from the output current of the opto-coupler to the control variable of the SMPS is given a specific behaviour in<!-- EPO <DP n="22"> --> order to reduce the current in the opto-coupler at low load levels of the SMPS, without negatively influencing the stability of the regulation loop of the SMPS. With respect to this transfer, a distinction between current domain and voltage domain representation can be made. Therefore a basic schematic diagram of the primary control circuit of the SMPS will be explained. Embodiments can be grouped in two categories, based on either a current domain or a voltage domain representation.</p><p id="p0116" num="0116">In the current domain representation, illustrated in <figref idrefs="f0009">Fig. 18</figref>, the current lcontrol is the control signal controlling the converted power. The bias voltage Vbias is necessary to define a proper voltage to keep the opto-coupler output out of saturation. The opto-coupler current is the sum of a reference current, Iref, generated by a current source and the control current lcontrol.</p><p id="p0117" num="0117">In the voltage domain representation, shown in <figref idrefs="f0010">Fig. 19</figref>, the voltage Vcontrol is the control signal controlling the converted power level. In the voltage domain representation, an element Zin is necessary to convert the opto-coupler current, lopto, to a voltage.</p><p id="p0118" num="0118">As already explained, it is desired to keep the current lopto at a low level at no load. As lopto is largest at no load, while at any operating point a current above a lower limit is required, it is desired to keep the current lopto constant over all values of Vcontrol. However, with such a constant current, the gain from lopto to Vcontrol would become infinite, giving stability problems for the SMPS. A way to prevent instability is now to make lopto constant with respect to the control signal only for steady-state (DC). For higher frequencies lopto can follow the normal behaviour as determined by lcontrol, in the current domain representation; or lref+lzin=F(Vcontrol), for the voltage domain representation. Therefore, the loop-gain of the SMPS is well defined for the frequencies that define the stability requirements. (frequency for 0dB loop-gain). For the current-domain representation of <figref idrefs="f0009">Fig. 18</figref>, this means that for high frequencies, lref+lcontrol should be kept constant and equal to the desired current lopto_ref. For the voltage domain representation of <figref idrefs="f0010">Fig. 19</figref>, this means that Iref + IZin should be kept constant and equal to the desired current lopto_ref.</p><p id="p0119" num="0119">A first embodiment according to the third aspect of the invention will now be described, with reference to <figref idrefs="f0010">Fig. 20</figref>. This embodiment is derived from the voltage domain representation. The current Iref+IZin is defined by a single resistor Rcoll connected to a supply voltage Vsupply. The compensation circuit comprises adaptive voltage supply 2010 for the opto-coupler. The input to the compensation circuit 2010 is the control voltage Vcontrol. The compensation signal output from the circuit 2010 is the supply voltage Vsupply. A first subtractor block 2040 subtracts the supply voltage from the control<!-- EPO <DP n="23"> --> voltage to generate a difference voltage Vdiff. This provides one input to another subtractor block 2050, which subtracts a reference voltage Vref from the difference Voltage Vdiff. The result of this subtraction is an error voltage Verror, which is input to an integrator filter 2020. The output of the integrator filter is input to a buffer 2030, which produces the supply voltage.</p><p id="p0120" num="0120">The current in the series resistor Rcoll is regulated to a desired DC value by taking the difference Vdiff= Vsupply-Vcontrol and creating an error signal Verror, being Vdiff-Vref and integrating this Verror to get the voltage Vsupply. Due to the integrator action, Verror is regulated to 0 in DC giving Vsupply-Vcontrol=Vref giving lopto=Vref/Rcoll and an input impedance of infinity. Meanwhile, for higher frequencies, Vsupply cannot be adapted that fast. This results in an input impedance of Rcoll. In general, using an integrator with time constant Tau according to <maths id="math0001" num="(1)"><math display="block"><mi>Vsupply</mi><mo>=</mo><mfrac><mn>1</mn><mi>Tau</mi></mfrac><mo>⋅</mo><mo>∫</mo><mi>Vcontrol</mi><mo>-</mo><mi>Vsupply</mi><mo>-</mo><mi>Vrefdt</mi></math><img id="ib0001" file="imgb0001.tif" wi="98" he="19" img-content="math" img-format="tif"/></maths><br/>
The input impedance in the laplace domain can be calculated as: <maths id="math0002" num="(2)"><math display="block"><mi>Zin</mi><mo>=</mo><mfrac><mrow><mi>Rcoll</mi><mo>⋅</mo><mfenced separators=""><mn mathvariant="normal">1</mn><mo>+</mo><mi>Tau</mi><mo>⋅</mo><mi mathvariant="normal">s</mi></mfenced></mrow><mrow><mi>Tau</mi><mo>⋅</mo><mi mathvariant="normal">s</mi></mrow></mfrac></math><img id="ib0002" file="imgb0002.tif" wi="77" he="17" img-content="math" img-format="tif"/></maths><br/>
The impedance curve is plotted in <figref idrefs="f0011">Fig. 21</figref> for an example with Tau=200us and Rcoll=10k. The plot clearly shows that the impedance behaves as a resistor of 10k for frequencies significantly above F=1/(2.pi.Tau)=800Hz. This means that for the loop stability where the value of Zin at 0dB loop-gain (usually at a frequency of approx 3kHz or higher) the network can be replaced by a resistor of 10k as if a simple 10k resistor was used, while still the advantage of a constant opto-coupler current remains (instead of an increasing opto-coupler current when Rcoll is really a fixed resistor of 10k).</p><p id="p0121" num="0121">This effect can be explained with reference to <figref idrefs="f0011">Fig. 22</figref>. For low power levels, Vcontrol needs to be low. As can be seen <figref idrefs="f0011">Fig. 22</figref>, the constant opto-coupler current gives a significant improvement in the current consumption at the output of the opto-coupler. A typical example of a prior art control block with a maximum control voltage of 5V and a minimum current of 100uA includes a resistor of 20kohm, supplied from a 7V DC source. At low loads, the voltage drops to 0V, giving a current of 350uA. With a worst case CTR of 0.2, which is a practical value at such low bias-current levels, the dissipation by the communication circuit of a 19V adapter is already 19V x 350uA/0.2=33mwatt at the diode side and 15V x 350uA=5mWatt at the opto-coupler output side (assuming a 15V IC supply voltage). On the other hand, calculating the power consumption for the present<!-- EPO <DP n="24"> --> embodiment gives: primary side dissipation=15V x 100uA=1.5mW; and secondary side dissipation=19V x 100uA/0.2=9.5mW, giving a total dissipation of 11mwatt. This means that the present embodiment allows for a no-load input power below 30mw, while prior art solutions are not able to realize this.</p><p id="p0122" num="0122">A primary control circuit according to a second embodiment of the third aspect of the invention will now be described, with reference to <figref idrefs="f0012">Fig. 23</figref>. In this example, the impedance at the output of the opto-coupler is formed by a fixed current source 2310 drawing the desired current lcoll. In order to achieve the desired resistive behaviour for high frequencies, a transconductance amplifier 2330 with transconductance GM and a differentiating network is used. The output currents of the fixed current source 2310 and the transconductance amplifier 2330 are coupled together in parallel, in series with the opto-coupler. The control voltage Vcontrol is the output of the opto-coupler, as in the previous embodiment. The control voltage is input to a buffer 2320, which in turn provides the input to the differentiating network. The network comprises a capacitor C1 and resistor R1 in series. The non-inverting input Vplus of the transconductance amplifier 2330 is coupled to the node between the capacitor and resistor. The inverting input is coupled to ground. The differentiating network has time constant Tau=R1.C1. This gives a similar impedance as the embodiment used in equation (2) while GM=1/Rcoll <maths id="math0003" num="(3)"><math display="block"><mi>Zin</mi><mo>=</mo><mfrac><mn mathvariant="normal">1</mn><mi>GM</mi></mfrac><mo>⋅</mo><mfrac><mrow><mn mathvariant="normal">1</mn><mo>+</mo><mi mathvariant="normal">s</mi><mo>⋅</mo><mi>Tau</mi></mrow><mrow><mi mathvariant="normal">s</mi><mo>⋅</mo><mi>Tau</mi></mrow></mfrac></math><img id="ib0003" file="imgb0003.tif" wi="67" he="15" img-content="math" img-format="tif"/></maths></p><p id="p0123" num="0123">A primary control circuit according to a third embodiment of the third aspect is described with reference to <figref idrefs="f0012">Fig. 24</figref>. This embodiment uses the current domain representation of <figref idrefs="f0009">Fig. 18</figref>. In this case, the desired current source behaviour is realized by making the current lref a function of lcontrol (preferably lref=loptoref-lcontrol) so that lopto becomes constant, having the same value for each operating point of lcontrol.</p><p id="p0124" num="0124">The circuit of <figref idrefs="f0012">Fig. 24</figref> is based on the use of current mirrors 2410, 2420, 2430. A current mirror input, as indicated by the square, conducts in one direction and is then low-ohmic and can be described by a voltage source. This voltage source relates to the MOS transistor diode characteristic of an input transistor. This is the relation between gate source voltage and drain current for a MOS transistor connected as diode - that is, with the drain connected to the gate, similar to a bipolar diode that can be obtained by taking a bipolar transistor and connecting the collector to the base The output is high-ohmic and represents a current source being the input current scaled by a scaling factor, being 1 in this case. A current mirror can have several outputs.<!-- EPO <DP n="25"> --></p><p id="p0125" num="0125">A current source 2440 is connected to the input of two current mirrors 2420 and 2430. As both inputs of mirror 2420 and mirror 2430 are connected together, the supply voltage of both mirrors is chosen such that a certain bias current flows in both inputs and outputs.</p><p id="p0126" num="0126">The input of a third current mirror 2410 is connected to the optocoupler output and the lref output of the mirrors 2420 and 2430. The third current mirror 2410 is therefore biased by a current lcontrol=lopto-lref. An output of the third mirror 2410 is connected to the input of the first current mirror 2420 and the current source 2440, therefore giving lref=loptoref-lcontrol. On the other hand it also holds that lcontrol+lref=iopto. Both equations combined give one solution: lopto=ioptoref. Thus, Iref is the output of the adaptive current supply 2420, 2430 in order to make lopto equal to loptoref.</p><p id="p0127" num="0127">As soon as lopto becones larger than ioptoref, lcontrol rapidly increases to infinity, while it drops to 0 when lopto becomes smaller than loptoref.</p><p id="p0128" num="0128">The circuit principle of <figref idrefs="f0012">Fig. 24</figref> therefore gives an infinitely large control current, lcontrol, for lopto&gt;loptoref and zero control current, lcontrol, for lopto&lt;loptoref. Therefore, a current limit for lref&lt;0 should be added in practice to limit lcontrol to a maximum. Although this circuit gives the desired infinite gain from lopto to lcontrol for DC, also for AC, this gain is infinite, while it is desired according to the invention to have a well defined gain for frequencies above a certain value.</p><p id="p0129" num="0129">In order to realize the desired behaviour where lcontrol is proportional to lopto for high frequencies, a filter can be added in the path where lcontrol is fed back to be subtracted from loptoref. Without this path, the original principle of <figref idrefs="f0009">Fig. 18</figref> remains with lref=loptoref, making lcontrol proportional to lopto. With a filter, the frequency for changeover between the proportional mode and the infinite gain mode can be set. An example of an embodiment with such a filter 2510 is given in <figref idrefs="f0013">Fig. 25</figref>. This embodiment is otherwise similar to the embodiment of <figref idrefs="f0012">Fig. 24</figref>. The filter comprises a capacitor C1 to ground and a series resistor R1.</p><p id="p0130" num="0130">For low frequencies, l_filtered equals lcontrol, giving the infinite gain mode. For high frequencies, C1 and R1 form a current divider, where most of the current is shorted to ground by C1, effectively taking away the feedback path and giving a gain from lopto to lcontrol of 1. As those skilled in the art will appreciate, although the filter is implemented using analogue components R1 and C1 in this embodiment, any other implementation of the filter, such as a digital implementation, is assumed to be within the scope of the invention.<!-- EPO <DP n="26"> --></p><p id="p0131" num="0131">According to a second part of the third aspect of the invention, the time constant is deliberately made low under certain conditions, in order to get a high gain behaviour up to a relatively low frequency, and the time constant is deliberately made high under certain other conditions, in order to get a high gain behaviour up to a relatively high frequency. The need for this second part of the third aspect of the invention is now further explained using the embodiment of <figref idrefs="f0010">Fig. 20</figref> as an example.</p><p id="p0132" num="0132">When the SMPS operates at a fixed power level, the regulation loop is set at a certain operating point, where the control signal Vcontrol is set at a certain value. However, as Vsupply is regulated in order to achieve the desired current in the opto coupler, it is not always possible to increase Vcontrol to the desired level within a desired time. For small variations of the load, Vcontrol does not need to vary much; however for large positive load steps, Vcontrol is unable to rise above Vsupply. Since Vsupply can only adapt with a relatively long time constant, Vcontrol cannot follow the command of the error loop and will saturate close to the level of Vsupply. According to the second part of the third aspect of the invention, it is detected that Vsupply-Vcontrol reaches a minimum threshold, indicating that Vcontrol is close to saturation. In response, the time constant Tau is reduced, in order to let Vsupply rise as fast as needed according to the response of Vcontrol as a result of the main regulation loop. Similarly, in the case where a large negative step change of the load occurs, Vcontrol suddenly drops, resulting in an increased current in the optocoupler, because Vsupply cannot follow the steep change of Vcontrol. As the drive current for the LED side of the opto coupler is dimensioned for small current consumption, there is a risk that the driver saturates to its maximum level, making it impossible to follow the desired response. The present solution is to detect that Vsupply-Vcontrol reaches a maximum threshold, indicating that Vsupply cannot follow and, in response, the time constant Tau is reduced, in order to let Vsupply fall as fast as needed according to the response of Vcontrol as result of the main regulation loop.</p><p id="p0133" num="0133"><figref idrefs="f0014">Fig. 26</figref> is a schematic diagram of a primary control circuit according to a fourth embodiment of the third aspect of the invention. This embodiment exploits the second part of the third aspect, as described above. It is similar in structure and operation to the embodiment of <figref idrefs="f0010">Fig. 20</figref>, with the addition of two comparators 2660 and 2662. The integrator filter 2620 comprises means to vary the time constant under the control of the comparator outputs. The comparators are arranged to detect when Vcontrol-Vsupply reaches a lower or upper threshold and the outputs of the comparators adapt the time constant Tau to a low value. This allows a faster response. The reduced value of Tau can typically be a factor of 10 to 100 times smaller than its normal value.<!-- EPO <DP n="27"> --></p><p id="p0134" num="0134">A similar adaptation may also be applied to other embodiments of the third aspect of the invention. For example in the embodiment of <figref idrefs="f0012">Fig. 23</figref> Tau can be adapted when the current in the GM amplifier 2330 output reaches an upper or lower limit, while in the embodiment of <figref idrefs="f0013">Fig. 25</figref>, the time constant Tau of the filter can be made smaller when lopto reaches a lower or upper limit.</p><p id="p0135" num="0135">An example means for varying the time constant is to make R1 a switched resistor, where during an interval T1 R1 is connected and during the interval Tper-T1 R1 is disconnected, in this way interrupting the current. The effective value of R1 is then set by the duty cycle: T1/(Tper-T1).</p><p id="p0136" num="0136">According to a third part of the third aspect of the invention, the time constant is reduced under certain conditions, in order to get a high gain behaviour up to a relatively low frequency, and the time constant is increased under certain other conditions, in order to get a high gain behaviour up to a relatively high frequency. The purpose of this part of the third aspect of the invention will now be explained in greater detail.</p><p id="p0137" num="0137">An SMPS operating in normal operation should have a stable loop and therefore a "low gain" is desired. For the embodiment of <figref idrefs="f0010">Fig. 20</figref>, this means that for frequencies in the range of the 0dB loop-gain region, the transfer from lopto to Vcontrol should be Rcoll. For the embodiment of <figref idrefs="f0012">Fig. 23</figref>, this means that for frequencies in the range of the 0dB loop-gain region, the transfer from lopto to Vcontrol should be 1/GM and for the embodiment of <figref idrefs="f0013">Fig. 25</figref> this means that for frequencies in the range of the 0dB loop-gain region, the transfer from lopto to Icontrol should be equal to a constant, where the constant is the current gain of the mirror at the left side.</p><p id="p0138" num="0138">However, an SMPS operating in burst mode can suffer from this limited gain. In a burst mode, the SMPS delivers power during a burst on time interval; outside this burst on time, no power or a significantly lower power is delivered.</p><p id="p0139" num="0139">In specific implementations of a burst mode, the start of the burst on time is set when the current in the opto-coupler output rises above a certain level - providing an indication that the regulated output voltage of the SMPS is dropping below the regulated level. As this event is effectively a digital flag rather than an analogue value, the analogue behaviour when the low gain is selected can cause instability problems during the burst mode. This may result in different burst on times for subsequent burst periods. The reason is that the trajectory from zero current in the opto-coupler to the level where it starts the burst on time depends on the history of the previous cycle - for example, due to the capacitor in the compensation network when the gain at the opto-coupler output is low. It is therefore preferred that a high gain can be selected in burst mode in order to make the<!-- EPO <DP n="28"> --> turn on instant more like a digital decision which is less sensitive to the previous operation history. This can help to prevent the potential instability identified above.</p><p id="p0140" num="0140">One reason that a burst mode is desirable is to prevent audible noise when the converter operates at switching frequencies below the audible limit of 20 kHz. In specific implementations of a burst mode, the burst on time is therefore defined by the condition that the primary control circuit tries to reduce the switching frequency below the audible limit. If this condition occurs, this is defined as the beginning of the burst on time. The action to be taken is then to overrule the control input and maintain the frequency just above the audible limit as long as the burst on time is maintained. At the end of the burst on time, the overruling mechanism is disabled until the start of the next burst on time. During the burst off time, the converter is not switching. The third part of the third aspect of the invention can give an advantage by producing a high gain during the burst off time, in order to make the decision to start the burst on time digital, and use a low gain during the burst on time. This can help to prevent overshoots at the control input during the beginning of the burst on time.</p><p id="p0141" num="0141">While the invention has been illustrated and described in detail in the drawings and foregoing description, such illustration and description are to be considered illustrative or exemplary and not restrictive; the invention is not limited to the disclosed embodiments.</p><p id="p0142" num="0142">For example, it is possible to operate the invention in an embodiment wherein the various aspects of the invention are combined. For example, the compensation circuit may produce two compensation signals - one of which is added as a continuously-variable offset to the control signal; and another which provides discrete-valued control of another parameter in the primary control circuit.</p><p id="p0143" num="0143">A control circuit according to an embodiment of the invention can be used to control a flyback converter, as described by way of example above. However, in other embodiments, the SMPS may be of a different type - including but not limited to a resonant-type converter.</p><p id="p0144" num="0144">In general, the compensation circuit may comprise analogue electronic components, digital logic, or a mixture of both.</p><p id="p0145" num="0145">The operative signals in the compensation circuit may be voltage or current signals. That is, the circuit may operate in current mode or voltage mode.</p><p id="p0146" num="0146">Other variations to the disclosed embodiments can be understood and effected by those skilled in the art in practicing the claimed invention, from a study of the drawings, the disclosure, and the appended claims. In the claims, the word "comprising" does not<!-- EPO <DP n="29"> --> exclude other elements or steps, and the indefinite article "a" or "an" does not exclude a plurality. Any reference signs in the claims should not be construed as limiting the scope.</p></description><claims mxw-id="PCLM56982375" lang="EN" load-source="patent-office"><!-- EPO <DP n="30"> --><claim id="c-en-0001" num="0001"><claim-text>A control circuit for a switched-mode power supply having an input side (101) connectable to an electrical power source and an output side (102) connectable to a load, the control circuit comprising:
<claim-text>a primary control circuit (140) adapted to generate a driving signal for a switching element (110) at the input side of the power supply;</claim-text>
<claim-text>a secondary control circuit (150) adapted to monitor an output signal at the output side (102) of the power supply; and</claim-text>
<claim-text>an opto-coupler (300, 400),</claim-text>
<claim-text>wherein the opto-coupler is arranged to receive its input from the secondary control circuit and to provide a control signal to the primary control circuit, and</claim-text>
<claim-text>the primary control circuit comprises a compensation circuit (900, 1000, 1100, 1400) adapted to process the control signal to generate a compensation signal for reducing power consumption in the opto-coupler,</claim-text>
<claim-text>wherein the compensation circuit is adapted to generate the compensation signal such that a current in the opto-coupler tends to return to a desired minimum value.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The control circuit of claim 1, wherein the compensation circuit is adapted to generate the compensation signal such that it responds to low-frequency variations in the input to the opto-coupler to a greater extent than high-frequency variations, so that the current in the opto-coupler tends to return to a desired minimum steady-state value.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The control circuit of claim 1 or claim 2, wherein the compensation circuit comprises an adaptive voltage supply (2010, 2610) for the opto-coupler.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The control circuit of claim 1 or claim 2, wherein the compensation circuit comprises a transconductance amplifier (2330); and the compensation signal is a compensation current output from said amplifier.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The control circuit of claim 1 or claim 2, wherein the control signal is a control current and the compensation circuit comprises an adaptive current supply for the opto-coupler.<!-- EPO <DP n="31"> --></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The control circuit of claim 5, wherein the compensation signal is a reference current and the current in the opto-coupler is the sum of the control current and the reference current.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The control circuit of claim 6, wherein the compensation circuit is adapted to generate the reference current as a function of a low-pass filtered version of the control current.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The control circuit of any preceding claim, wherein a time constant with which the compensation signal responds to variations in the input to the opto-coupler is variable.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The control circuit of claim 8, wherein the time constant is variable according to at least one of:
<claim-text>an amplitude of the control signal; and</claim-text>
<claim-text>whether or not the switched-mode power supply is operating in a burst mode.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The control circuit of claim 1 or claim 2, wherein the primary control circuit is adapted to generate the driving signal based upon a combination of the control signal and the compensation signal,<br/>
and wherein the compensation circuit is adapted to detect, in the control signal, changes from a desired operating condition and generate the compensation signal such that the control signal tends to return to the desired condition.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The control circuit of claim 10, wherein the primary control circuit (140d, 140e) is adapted to add the compensation signal and the control signal, and to use the resulting summed signal to generate the driving signal.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The control circuit of claim 11, wherein the compensation circuit (1400) is adapted to compare the control signal with a predetermined reference value and to generate the compensation signal based on the result of this comparison, preferably by low-pass filtering it.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The control circuit of claim 10, wherein the compensation circuit comprises at least one comparator (910, 912), configured to compare the control signal with at least one predetermined threshold value, and<br/>
<!-- EPO <DP n="32"> -->a counter (920), coupled to the comparator and configured to increment or decrement a level of the compensation signal when the control signal reaches or crosses the threshold.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The control circuit of claim 13, wherein the compensation circuit comprises:
<claim-text>a first comparator (912) arranged to increment a value of the counter if the control signal exceeds a first threshold; and</claim-text>
<claim-text>a second comparator (910) arranged to decrement the value of the counter if the control signal drops below a second threshold.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The control circuit of any of claims 10 to 14, wherein the primary control circuit is configured so that the compensation signal influences a peak current in the input side of the power supply, or a conversion frequency of the power supply.</claim-text></claim></claims><drawings mxw-id="PDW16670755" load-source="patent-office"><!-- EPO <DP n="33"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="221" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="165" he="213" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0003" num="5,6,7"><img id="if0003" file="imgf0003.tif" wi="105" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0004" num="8,9"><img id="if0004" file="imgf0004.tif" wi="165" he="228" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="37"> --><figure id="f0005" num="10"><img id="if0005" file="imgf0005.tif" wi="165" he="173" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="38"> --><figure id="f0006" num="11,12"><img id="if0006" file="imgf0006.tif" wi="157" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="39"> --><figure id="f0007" num="13,14"><img id="if0007" file="imgf0007.tif" wi="163" he="224" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="40"> --><figure id="f0008" num="15,16"><img id="if0008" file="imgf0008.tif" wi="165" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="41"> --><figure id="f0009" num="17,18"><img id="if0009" file="imgf0009.tif" wi="165" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="42"> --><figure id="f0010" num="19,20"><img id="if0010" file="imgf0010.tif" wi="157" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="43"> --><figure id="f0011" num="21,22"><img id="if0011" file="imgf0011.tif" wi="157" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="44"> --><figure id="f0012" num="23,24"><img id="if0012" file="imgf0012.tif" wi="160" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="45"> --><figure id="f0013" num="25"><img id="if0013" file="imgf0013.tif" wi="164" he="146" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="46"> --><figure id="f0014" num="26"><img id="if0014" file="imgf0014.tif" wi="165" he="173" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="158" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="164" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
