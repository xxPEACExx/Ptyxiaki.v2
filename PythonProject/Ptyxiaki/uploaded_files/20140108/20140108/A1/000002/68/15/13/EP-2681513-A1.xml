<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2681513-A1" country="EP" doc-number="2681513" kind="A1" date="20140108" family-id="46384438" file-reference-id="314269" date-produced="20180823" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146586456" ucid="EP-2681513-A1"><document-id><country>EP</country><doc-number>2681513</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12730046-A" is-representative="NO"><document-id mxw-id="PAPP154848648" load-source="docdb" format="epo"><country>EP</country><doc-number>12730046</doc-number><kind>A</kind><date>20120301</date><lang>EN</lang></document-id><document-id mxw-id="PAPP210428306" load-source="docdb" format="original"><country>EP</country><doc-number>12730046.5</doc-number><date>20120301</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140547543" ucid="JP-2011045265-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011045265</doc-number><kind>A</kind><date>20110302</date></document-id></priority-claim><priority-claim mxw-id="PPC140547260" ucid="JP-2011275235-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011275235</doc-number><kind>A</kind><date>20111216</date></document-id></priority-claim><priority-claim mxw-id="PPC140553749" ucid="JP-2012055894-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2012055894</doc-number><kind>W</kind><date>20120301</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989321530" load-source="docdb">G01C  25/00        20060101ALI20120919BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989321841" load-source="docdb">G01C  21/16        20060101AFI20120919BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1713570678" load-source="docdb" scheme="CPC">Y02D  70/164       20180101 LA20180103BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924003513" load-source="docdb" scheme="CPC">G01C  21/10        20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924004715" load-source="docdb" scheme="CPC">B60G  17/018       20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924004797" load-source="docdb" scheme="CPC">G01C   9/08        20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924004837" load-source="docdb" scheme="CPC">B60G  17/019       20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924006586" load-source="docdb" scheme="CPC">G01C  21/28        20130101 LI20160627BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924006793" load-source="docdb" scheme="CPC">H04W  52/0254      20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924006915" load-source="docdb" scheme="CPC">G01C  21/12        20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924008690" load-source="docdb" scheme="CPC">B60G2400/0512      20130101 LA20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924008774" load-source="docdb" scheme="CPC">B60G2400/0513      20130101 LA20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924009515" load-source="docdb" scheme="CPC">G01S  19/42        20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924009672" load-source="docdb" scheme="CPC">G01C  25/005       20130101 LI20160627BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924010792" load-source="docdb" scheme="CPC">G01G  19/086       20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924011363" load-source="docdb" scheme="CPC">G01S  19/49        20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924011841" load-source="docdb" scheme="CPC">B60G2400/05        20130101 LA20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1924013114" load-source="docdb" scheme="CPC">B60G  17/0195      20130101 LI20160625BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989619917" load-source="docdb" scheme="CPC">G01C  21/16        20130101 FI20131221BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132364001" lang="DE" load-source="patent-office">HALTUNGSBESTIMMUNGSVERFAHREN, POSITIONSBERECHNUNGSVERFAHREN UND HALTUNGSBESTIMMUNGSVORRICHTUNG</invention-title><invention-title mxw-id="PT132364002" lang="EN" load-source="patent-office">ATTITUDE DETERMINATION METHOD, POSITION CALCULATION METHOD, AND ATTITUDE DETERMINATION DEVICE</invention-title><invention-title mxw-id="PT132364003" lang="FR" load-source="patent-office">PROCÉDÉ DE DÉTERMINATION DE L'ATTITUDE, PROCÉDÉ DE CALCUL DE LA POSITION ET DISPOSITIF DE DÉTERMINATION DE L'ATTITUDE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919542888" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SEIKO EPSON CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR919526575" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SEIKO EPSON CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR919010700" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Seiko Epson Corporation</last-name><iid>100217777</iid><address><street>4-1, Nishi-shinjuku 2-chome</street><city>Shinjuku-ku Tokyo 163-0811</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919539180" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>MIZUOCHI SHUNICHI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919523260" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>MIZUOCHI, SHUNICHI</last-name></addressbook></inventor><inventor mxw-id="PPAR919016899" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>MIZUOCHI, SHUNICHI</last-name><address><street>c/o Seiko Epson Corporation 3-5 Owa 3-chome</street><city>Suwa-shi Nagano 392-8502</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919518194" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>KUMAR ANAND</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919519781" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>KUMAR, ANAND</last-name></addressbook></inventor><inventor mxw-id="PPAR919009145" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>KUMAR, ANAND</last-name><address><street>c/o Seiko Epson Corporation 3-5 Owa 3-chome</street><city>Suwa-shi Nagano 392-8502</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919536846" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>SATO AKINOBU</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919530579" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>SATO, AKINOBU</last-name></addressbook></inventor><inventor mxw-id="PPAR919012997" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>SATO, AKINOBU</last-name><address><street>c/o Seiko Epson Corporation 3-5 Owa 3-chome</street><city>Suwa-shi Nagano 392-8502</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919527567" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>ONDA KENJI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919525241" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>ONDA, KENJI</last-name></addressbook></inventor><inventor mxw-id="PPAR919014814" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>ONDA, KENJI</last-name><address><street>c/o Seiko Epson Corporation 3-5 Owa 3-chome</street><city>Suwa-shi Nagano 392-8502</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919513351" load-source="docdb" sequence="5" format="epo"><addressbook><last-name>SANJAY RAMA</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919514525" load-source="docdb" sequence="5" format="intermediate"><addressbook><last-name>SANJAY, RAMA</last-name></addressbook></inventor><inventor mxw-id="PPAR919006591" load-source="patent-office" sequence="5" format="original"><addressbook><last-name>SANJAY, RAMA</last-name><address><street>c/o Seiko Epson Corporation 3-5 Owa 3-chome</street><city>Suwa-shi Nagano 392-8502</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919011417" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>HOFFMANN EITLE</last-name><iid>100061036</iid><address><street>Patent- und Rechtsanwälte Arabellastrasse 4</street><city>81925 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2012055894-W"><document-id><country>JP</country><doc-number>2012055894</doc-number><kind>W</kind><date>20120301</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012118232-A1"><document-id><country>WO</country><doc-number>2012118232</doc-number><kind>A1</kind><date>20120907</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549839816" load-source="docdb">AL</country><country mxw-id="DS549771097" load-source="docdb">AT</country><country mxw-id="DS549839817" load-source="docdb">BE</country><country mxw-id="DS549839046" load-source="docdb">BG</country><country mxw-id="DS549761111" load-source="docdb">CH</country><country mxw-id="DS549852929" load-source="docdb">CY</country><country mxw-id="DS549771098" load-source="docdb">CZ</country><country mxw-id="DS549839058" load-source="docdb">DE</country><country mxw-id="DS549839822" load-source="docdb">DK</country><country mxw-id="DS549852930" load-source="docdb">EE</country><country mxw-id="DS549760798" load-source="docdb">ES</country><country mxw-id="DS549839047" load-source="docdb">FI</country><country mxw-id="DS549839048" load-source="docdb">FR</country><country mxw-id="DS549839059" load-source="docdb">GB</country><country mxw-id="DS549839823" load-source="docdb">GR</country><country mxw-id="DS549839824" load-source="docdb">HR</country><country mxw-id="DS549852931" load-source="docdb">HU</country><country mxw-id="DS549761112" load-source="docdb">IE</country><country mxw-id="DS549839825" load-source="docdb">IS</country><country mxw-id="DS549839049" load-source="docdb">IT</country><country mxw-id="DS549852932" load-source="docdb">LI</country><country mxw-id="DS549839060" load-source="docdb">LT</country><country mxw-id="DS549771099" load-source="docdb">LU</country><country mxw-id="DS549839061" load-source="docdb">LV</country><country mxw-id="DS549839066" load-source="docdb">MC</country><country mxw-id="DS549914968" load-source="docdb">MK</country><country mxw-id="DS549914969" load-source="docdb">MT</country><country mxw-id="DS549760799" load-source="docdb">NL</country><country mxw-id="DS549914970" load-source="docdb">NO</country><country mxw-id="DS549760800" load-source="docdb">PL</country><country mxw-id="DS549771100" load-source="docdb">PT</country><country mxw-id="DS549760809" load-source="docdb">RO</country><country mxw-id="DS549771105" load-source="docdb">RS</country><country mxw-id="DS549760810" load-source="docdb">SE</country><country mxw-id="DS549852933" load-source="docdb">SI</country><country mxw-id="DS549914971" load-source="docdb">SK</country><country mxw-id="DS549914972" load-source="docdb">SM</country><country mxw-id="DS549761121" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA99833758" ref-ucid="WO-2012118232-A1" lang="EN" load-source="patent-office"><p num="0000">A new method for determining an attitude of a sensor with respect to a moving body is proposed. A movement vector is measured by a sensor 3 mounted in the moving body. In addition, the attitude of the sensor 3 with respect to the moving body is determined using the movement vector measured by the sensor 3 when the moving body starts to move.</p></abstract><abstract mxw-id="PA100330005" ref-ucid="WO-2012118232-A1" lang="EN" source="national office" load-source="docdb"><p>A new method for determining an attitude of a sensor with respect to a moving body is proposed. A movement vector is measured by a sensor 3 mounted in the moving body. In addition, the attitude of the sensor 3 with respect to the moving body is determined using the movement vector measured by the sensor 3 when the moving body starts to move.</p></abstract><abstract mxw-id="PA99833759" ref-ucid="WO-2012118232-A1" lang="FR" load-source="patent-office"><p num="0000">La présente invention porte sur un nouveau procédé de détermination de l'attitude d'un capteur par rapport à un corps en déplacement. Un vecteur mouvement est mesuré par un capteur (3) installé dans le corps en déplacement. De plus, l'attitude du capteur (3) par rapport au corps en déplacement est déterminée à l'aide du vecteur mouvement mesuré par le capteur (3) lorsque le corps en déplacement commence à se déplacer.</p></abstract><abstract mxw-id="PA100330006" ref-ucid="WO-2012118232-A1" lang="FR" source="national office" load-source="docdb"><p>La présente invention porte sur un nouveau procédé de détermination de l'attitude d'un capteur par rapport à un corps en déplacement. Un vecteur mouvement est mesuré par un capteur (3) installé dans le corps en déplacement. De plus, l'attitude du capteur (3) par rapport au corps en déplacement est déterminée à l'aide du vecteur mouvement mesuré par le capteur (3) lorsque le corps en déplacement commence à se déplacer.</p></abstract><description mxw-id="PDES51232847" ref-ucid="WO-2012118232-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="3"/>--><p id="p0001" num="0001"> DESCRIPTION </p><p id="p0002" num="0002">Title of Invention </p><p id="p0003" num="0003">ATTITUDE DETERMINATION METHOD, POSITION CALCULATION METHOD, </p><p id="p0004" num="0004"> AND ATTITUDE DETERMINATION DEVICE . </p><p id="p0005" num="0005">Technical Field </p><p id="p0006" num="0006"> [0001] </p><p id="p0007" num="0007"> The present invention relates to a method of determining the attitude of a sensor with respect to a moving body. </p><p id="p0008" num="0008">Background Art </p><p id="p0009" num="0009"> [0002] </p><p id="p0010" num="0010"> The use of sensors in various fields, such as so- called seamless positioning, motion sensing, and attitude control, has been drawing attention. An acceleration sensor, a gyro sensor, a pressure sensor, a geomagnetic sensor, and the like are widely known as sensors. A technique of calculating the position of a moving body (for example, a bicycle or an automobile, a train, a ship, an airplane, and the like) by performing an inertial navigation operation using a measurement result of a sensor has also been proposed. </p><p id="p0011" num="0011"> [0003] </p><p id="p0012" num="0012"> In the inertial navigation operation, there is a 
<!-- EPO <DP n="4"/>-->
problem in that the accuracy of position calculation is reduced due to various error components included in the measurement result of a sensor. For this reason, various techniques for improving the accuracy of position calculation have been proposed. For example, PTL 1 discloses a technique of correcting an inertial navigation operation result by applying a Kalman filter using the constraint condition regarding the movement direction of a moving body. </p><p id="p0013" num="0013">Citation List </p><p id="p0014" num="0014"> Patent Literature </p><p id="p0015" num="0015"> [0004] </p><p id="p0016" num="0016"> [PTL 1] U.S. Unexamined Patent Application</p><p id="p0017" num="0017">Publication No. 2010/0019963 </p><p id="p0018" num="0018">Summary of Invention </p><p id="p0019" num="0019">Technical Problem </p><p id="p0020" num="0020"> [0005] </p><p id="p0021" num="0021"> The technique disclosed in PTL 1 assumes that an error is included in the measurement result of a sensor and estimates errors included in various quantities, such as the position or velocity of a moving body which is a result of the inertial navigation operation, using the constraint condition regarding the movement direction of the moving body. In this technique, however, the correct correspondence relationship between the coordinate system 
<!-- EPO <DP n="5"/>-->
of a sensor and the coordinate system of a moving body should be known. </p><p id="p0022" num="0022"> [0006] </p><p id="p0023" num="0023"> The measurement result of a sensor is a value in the coordinate system (local coordinate system) of the sensor. The measurement result of the sensor is not a value in the coordinate system of the moving body. Therefore, when using the constraint condition regarding the movement direction of the moving body, it is necessary to perform coordinate transformation between the coordinate system of the sensor and the coordinate system of the moving body or to fix the sensor to the moving body so that the coordinate system of the sensor and the coordinate system of the moving body match correctly each other. However, even if calibration is performed, it is difficult to correctly perform coordinate transformation from the coordinate system of the sensor to the coordinate system of the moving body and it is also difficult to fix the sensor to the moving body so that the coordinate system of the sensor and the coordinate system of the moving body match correctly. A slight error may occur, or an error may increase with time. </p><p id="p0024" num="0024"> [0007] </p><p id="p0025" num="0025"> In addition, in the case of disposing a portable electronic apparatus, such as a mobile phone, a navigation 
<!-- EPO <DP n="6"/>-->
apparatus, a PDA (Personal Digital Assistant), or a personal computer including a sensor for inertial navigation, so as to be carried by the moving body and performing an inertial navigation operation using the electronic apparatus, it is extremely difficult to correctly know the correspondence relationship between the coordinate system of the sensor and the coordinate system of the moving body. </p><p id="p0026" num="0026"> [0008] </p><p id="p0027" num="0027"> When correct coordinate transformation between the coordinate system of the sensor and the coordinate system of the moving body is not possible, coherence between the coordinate system of the sensor and the coordinate system of the moving body is not satisfied. Accordingly, an error occurs in the inertial navigation operation result. In addition, a difference between the actual position and the calculated position tends to increase gradually as the inertial navigation operation continues. </p><p id="p0028" num="0028"> [0009] </p><p id="p0029" num="0029"> In order to know the correct correspondence relationship between the coordinate system of the sensor and the coordinate system of the moving body, it is necessary to determine the correct attitude of the sensor with respect to the moving body. </p><p id="p0030" num="0030"> [0010] 
<!-- EPO <DP n="7"/>-->
 The present invention has been made in view of the problems described above, and it is an object of the present invention to propose a new technique for determining the attitude of a sensor with respect to a moving body. </p><p id="p0031" num="0031">Solution to Problem </p><p id="p0032" num="0032"> [0011] </p><p id="p0033" num="0033"> In order to solve the above-described problem, according to a first aspect of the present invention, there is provided an attitude determination method including: a step of measuring a movement vector by a sensor which is mounted in a moving body and measures the movement vector; and a step of determining a attitude of the sensor with respect to the moving body using the movement vector measured by the sensor when the moving body starts to move. </p><p id="p0034" num="0034"> [0012] </p><p id="p0035" num="0035"> In addition, according to another aspect of the present invention, there is provided an attitude determination device that determines an attitude of a sensor, which is mounted in a moving body and measures a movement vector, with respect to the moving body using the movement vector measured by the sensor when the moving body starts to move. </p><p id="p0036" num="0036"> [0013] 
<!-- EPO <DP n="8"/>-->
 According to the first aspect and the like of the present invention, the attitude of the sensor with respect to the moving body is determined using a movement vector measured by the sensor when the moving body starts to move. The movement vector means a -vector regarding the movement of a moving body called an acceleration vector or a velocity vector of a moving body. In addition, the attitude of a sensor with respect to a moving body means a relative attitude of the sensor with respect to the moving body. Although described in embodiments in detail later, the attitude of the sensor with respect to the moving body can be determined using a movement vector measured by the sensor when the- moving body starts to move. </p><p id="p0037" num="0037"> [0014] </p><p id="p0038" num="0038"> In addition, according to a second aspect of the present invention, in the attitude determination method according to the first aspect of the present invention, a step of compensating for a measurement result of the sensor using a first constraint condition regarding a velocity of the moving body when the moving body is in a stop state may be further included. </p><p id="p0039" num="0039"> [0015] </p><p id="p0040" num="0040"> According to the second aspect of the present invention, when the moving body is in a stop state, the measurement result of the sensor is compensated for using 
<!-- EPO <DP n="9"/>-->
the first constraint condition regarding the velocity of the moving body. In this case, the attitude of the sensor can be determined using the movement vector compensated for when the moving body is in a stop state, in combination with the first aspect of the present invention. As a result, it becomes possible to perform attitude determination more accurately. </p><p id="p0041" num="0041"> [0016] </p><p id="p0042" num="0042"> In addition, according to a third aspect of the present invention, in the attitude determination method according to the first or second aspect of the present invention, the step of determining the attitude may be determining at least one of a pitch component and a yaw component without determining a roll component of the attitude with respect to the moving body. </p><p id="p0043" num="0043"> [0017] </p><p id="p0044" num="0044"> According to<sup>'</sup> the third aspect of the present invention, the attitude of the sensor can be easily determined by determining at least one of the pitch component and the yaw component without determining the roll component of the attitude with respect to the moving body. </p><p id="p0045" num="0045"> [0018] </p><p id="p0046" num="0046"> In addition, according to a fourth aspect of the present invention, in the attitude determination method 
<!-- EPO <DP n="10"/>-->
according to any one of the first to third aspects of the present invention, the step of measuring the movement vector may be measuring a movement vector in an absolute coordinate system which is a coordinate system for determining a moving space of the moving body, and the step of determining the attitude may be determining the attitude of the sensor using the movement vector and a direction of the sensor expressed in the absolute coordinate system. </p><p id="p0047" num="0047"> [0019] </p><p id="p0048" num="0048"> According to the fourth aspect, the attitude of the sensor with respect to the moving body is determined using a movement vector in the absolute coordinate system for determining the moving space of the moving body and the direction of the sensor expressed in the absolute coordinate system. If the direction of the sensor expressed in the absolute coordinate system is known, the movement vector in the absolute coordinate system can be coordinate-transformed to that in the coordinate system of the sensor. Then, the attitude of the sensor can be appropriately determined using the movement vector after transformation. </p><p id="p0049" num="0049"> [0020] </p><p id="p0050" num="0050"> In addition, according to a fifth aspect of the present invention, in the attitude determination method 
<!-- EPO <DP n="11"/>-->
according to any one of the first to third aspects of the present invention, the step of determining the attitude may include: a step of calculating a velocity vector in a local coordinate system, which is a measurement coordinate system of the sensor, using a movement vector measured by the sensor when the moving body is stopped and a movement vector measured when the moving body starts to move; and a step of determining the attitude of the sensor using the velocity vector. </p><p id="p0051" num="0051"> [0021] </p><p id="p0052" num="0052"> According to the fifth aspect of the present invention, it is possible to calculate a velocity vector after removing a bias error and the like of the sensor by calculating a velocity vector in the local coordinate system, which is a<sup>'</sup> measurement coordinate system of the sensor, using a movement vector measured by the sensor when the moving body is stopped and a movement vector measured when the moving body starts to move. </p><p id="p0053" num="0053"> [0022] </p><p id="p0054" num="0054"> In addition, according to a sixth aspect of the present invention, in the attitude determination method according to any one of the first to fifth aspects of the present invention, the step of determining the attitude may be determining the attitude using the movement vector when the stop of the moving body is released and the 
<!-- EPO <DP n="12"/>-->
velocity or acceleration of the moving body reaches a predetermined threshold value. </p><p id="p0055" num="0055"> [0023] </p><p id="p0056" num="0056"> According to the sixth aspect of the present invention, the attitude is determined using the movement vector when the stop of the moving body is released and the velocity or acceleration of the moving body reaches a predetermined threshold value. By performing attitude determination when the velocity or acceleration of the moving body reaches a predetermined value without performing attitude determination immediately even if the stoppage of the moving body is released, it is possible to improve the accuracy of attitude determination. </p><p id="p0057" num="0057"> [0024] </p><p id="p0058" num="0058"> In addition, according to a seventh aspect of the present invention, there is provided a<sub>.</sub> position calculation method including: a step of determining the attitude using the attitude determination method according to any one of the first to sixth aspects of the present invention; and a step of calculating a position of the moving body using the attitude and the movement vector. </p><p id="p0059" num="0059"> [0025] </p><p id="p0060" num="0060"> According to the seventh aspect of the present invention, the position of the moving body can be appropriately calculated using the movement vector and the 
<!-- EPO <DP n="13"/>-->
attitude determined using the attitude determination method according to the aspect described above. </p><p id="p0061" num="0061"> [0026] </p><p id="p0062" num="0062"> Moreover, according to an eighth aspect of the present invention, in the position calculation method according to the seventh aspect of the present invention, the step of calculating the position may include: a step of calculating an absolute coordinate position of the moving body in the absolute coordinate system using the movement vector; a step of performing coordinate transformation of the absolute coordinate position to a moving body coordinate position based on the moving body using the attitude and a direction of the sensor expressed in the absolute coordinate system; and a step of correcting the absolute coordinate position using the moving body coordinate position and a second constraint condition regarding a movement direction of the moving body. </p><p id="p0063" num="0063"> [0027] </p><p id="p0064" num="0064"> According to the eighth aspect of the present invention, the absolute coordinate position of the moving body in the absolute coordinate system can be calculated using the movement vector. For example, the position of a moving body is calculated by integrating a movement vector in the absolute coordinate system. In order to associate 
<!-- EPO <DP n="14"/>-->
the absolute coordinate system with the coordinate system having a moving body as a reference, a relative attitude of the sensor with respect to the moving body and the direction of the sensor expressed in the absolute coordinate system are needed. Then, the absolute coordinate position is coordinate-transformed to the moving body coordinate position using the attitude of the sensor, which is determined using the attitude determination method described above, and the direction of the sensor expressed in the absolute coordinate system. As a result,<sup>'</sup> an operation in the coordinate system having a moving body as a reference becomes possible. In addition, the absolute coordinate position of the moving body can be appropriately corrected using the second constraint condition regarding the movement direction of the moving body and the moving body coordinate position. Brief . Description of Drawings </p><p id="p0065" num="0065"> [0028] </p><p id="p0066" num="0066"> [Fig. 1] Fig. 1 is a system configuration view of the entire system. </p><p id="p0067" num="0067"> [Fig. 2] Fig. 2 is a system configuration view of a first mounting attitude determination system. </p><p id="p0068" num="0068"> [Fig. 3] Fig. 3 is a system configuration view of a second mounting attitude determination system. </p><p id="p0069" num="0069"> [Fig. 4] Fig. 4 is a system configuration view of a 
<!-- EPO <DP n="15"/>-->
first position calculation system. </p><p id="p0070" num="0070"> [Fig. 5] Fig. 5 is a system configuration view of a first inertial navigation system. </p><p id="p0071" num="0071"> [Fig. 6] Fig. 6 is a system configuration view of a second position calculation system. </p><p id="p0072" num="0072"> [Fig. 7] Fig. 7 is a system configuration view of a second inertial navigation system. </p><p id="p0073" num="0073"> [Fig. 8] Fig. 8 is an example of a simulation result after position calculation using a known method. </p><p id="p0074" num="0074"> [Fig. 9] Fig. 9 is an example, of a simulation result after position calculation using a method in an embodiment. </p><p id="p0075" num="0075"> [Fig. 10] Fig. 10 is a block diagram showing the functional configuration of a car navigation apparatus. </p><p id="p0076" num="0076"> [Fig. 11] Fig. 11 is a conceptual view showing a processing unit as a functional block. </p><p id="p0077" num="0077"> [Fig. 12] Fig. 12 is a flow chart showing the flow of navigation processing. </p><p id="p0078" num="0078"> [Fig. 13] Fig. 13 is a flow chart showing the flow of correction processing. </p><p id="p0079" num="0079"> [Fig. 14] Fig. 14 is an example of an experimental result of position calculation using known navigation processing. </p><p id="p0080" num="0080"> [Fig. 15] Fig. 15 is an example of an experimental result of position calculation using the navigation processing in the embodiment. 
<!-- EPO <DP n="16"/>-->
 [Fig. 16] Fig. 16 is a flow chart showing the flow of second navigation processing. </p><p id="p0081" num="0081"> [Fig. 17] Fig. 17 is an example of an experimental result when the movement direction switching correspondence logic is not applied. </p><p id="p0082" num="0082"> [Fig. 18] Fig. 18 is an example of an experimental result when the movement direction switching correspondence logic is applied. </p><p id="p0083" num="0083"> [Fig. 19] Fig. 19 is a conceptual view showing a processing unit in a modification as a functional block. </p><p id="p0084" num="0084"> [Fig. 20] Fig. 20 is a conceptual view showing a processing unit in a modification as a functional block. </p><p id="p0085" num="0085"> [Fig. 21] Fig. 21 is a flow chart showing the flow of second mounting attitude determination processing. </p><p id="p0086" num="0086">Description of Embodiments </p><p id="p0087" num="0087"> [0029] </p><p id="p0088" num="0088"> Hereinafter, an example of a preferred embodiment of the present invention will be described with reference to the drawings. Here, it is needless to say that embodiments to which the present invention can be applied are not limited to the embodiment described below. </p><p id="p0089" num="0089"> [0030] </p><p id="p0090" num="0090"> 1. Principles </p><p id="p0091" num="0091"> 1-1. Entire system </p><p id="p0092" num="0092"> Fig. 1 is a view showing an example of the system 
<!-- EPO <DP n="17"/>-->
configuration of the entire system related to an attitude determination method and a position calculation method in the present embodiment. The entire system is configured as a system having a moving body in which a sensor 3 is mounted. Although the moving body may be any of a bicycle or an automobile (including a four-wheeled vehicle and a motorbike) , a train, an airplane, a ship, and the like, the present embodiment will be described using a four- wheeled vehicle as a moving body. </p><p id="p0093" num="0093"> [0031] </p><p id="p0094" num="0094"> In the present embodiment, three types of coordinate systems are defined. The first coordinate system is a local coordinate system which is a sensor coordinate system corresponding to the sensor 3. In this specification, the local coordinate system is also called an L (Local) frame. The local coordinate system is a three-dimensional Cartesian coordinate system corresponding to the sensor 3. In the present embodiment, three axes of the local coordinate system are written as x, y, and z axes. </p><p id="p0095" num="0095"> [0032] </p><p id="p0096" num="0096"> The second coordinate system is a moving body coordinate system corresponding to the moving body. In this specification, the moving body coordinate system is also called a V (vehicle) frame. For example, the V frame 
<!-- EPO <DP n="18"/>-->
is defined as a three-dimensional Cartesian coordinate system in which a back and forth direction (front direction of a moving body, is positive) is a roll axis (R axis), a left and right direction (right direction is positive) is a pitch axis (P axis) , and a vertical direction (vertically downward direction is positive) is a yaw axis (Q axis) . In the present embodiment, three axes of the moving body coordinate system are written as R, P, and Q axes. </p><p id="p0097" num="0097"> [0033] · </p><p id="p0098" num="0098"> The third coordinate system is an absolute coordinate system which is a coordinate system which determines the moving space of a moving body. In this specification, the absolute coordinate system is also called an A (Absolute) frame. For example, the A frame is defined as the NED (North East Down) coordinate system known as a north east down coordinate system or the ECEF (Earth Centered Earth Fixed) coordinate system known as an earth centered earth fixed coordinate system. In the present embodiment, three axes of the absolute coordinate system are written as X, Y, and Z axes. </p><p id="p0099" num="0099"> [0034] </p><p id="p0100" num="0100"> The sensor 3 is various kinds of sensors mounted in a moving body. For example, when applying the sensor 3 to an inertial navigation system which calculates the 
<!-- EPO <DP n="19"/>-->
position or the velocity independently using a measurement result of the sensor 3, a sensor for inertial navigation (inertial. sensor) such as an acceleration sensor 3A or an attitude sensor 3B is used as the sensor 3. </p><p id="p0101" num="0101"> [0035] </p><p id="p0102" num="0102"> The acceleration sensor 3A is a sensor which detects the acceleration of a moving body in the local coordinate system. For example, an MEMS sensor using the technique of MEMS (Micro Electro Mechanical System) is used. The acceleration sensor 3A is fixed to the moving body. The measurement value of the acceleration sensor 3A is acceleration of the moving body measured in the local coordinate system. </p><p id="p0103" num="0103"> [0036] </p><p id="p0104" num="0104"> The attitude sensor 3B is a sensor for detecting the absolute attitude which is a direction of the sensor 3 in the absolute coordinate system. For example, a sensor, such as a gyro sensor 3C or a magnetic sensor, is used. The attitude sensor 3B may be formed as a single gyro sensor 3C or a single magnetic sensor or may be formed by combining these sensors. In addition, the attitude sensor 3B may also be configured to include an acceleration sensor. The attitude sensor 3B is fixed to the moving body. The measurement value of the attitude sensor 3B is a direction of the sensor 3 expressed in the absolute 
<!-- EPO <DP n="20"/>-->
coordinate system. </p><p id="p0105" num="0105"> [0037] </p><p id="p0106" num="0106"> The acceleration or the velocity of a moving body has both .direction and magnitude. Therefore, a scalar and a vector will be appropriately distinguished for explanation in this specification. In principle, it is assumed that the acceleration or the velocity expresses the magnitude (scalar quantity) of acceleration or velocity and an acceleration vector or a velocity vector expresses acceleration or velocity when both direction and magnitude are taken into consideration. Moreover, in the present embodiment, the acceleration vector and the velocity vector of a moving body are collectively called a "movement vector" of the moving body. In addition, in order to clarify various quantities defined in each coordinate system, explanation will be given in a state where the type of the coordinate system is added to the head Of words indicating each of the various quantities. For <sup>1</sup> example, the acceleration - vector expressed in the local coordinate system is called a "local coordinate acceleration vector", and the acceleration vector expressed in the absolute coordinate system is called an "absolute coordinate acceleration vector". This is the same for other various quantities. </p><p id="p0107" num="0107"> [0038] 
<!-- EPO <DP n="21"/>-->
 In addition, the attitude of the sensor 3 is expressed by the Euler angles of a roll angle, a pitch angle, and a yaw angle. The direction of the sensor 3 expressed in the absolute coordinate system is expressed as an "absolute attitude", and the attitude angle is called an "absolute attitude, angle". In addition, a relative attitude of the sensor 3 to the moving body (relative attitude) is expressed as a "mounting attitude", and the attitude angle (relative attitude angle) is called a "mounting attitude angle" . </p><p id="p0108" num="0108"> [0039] </p><p id="p0109" num="0109"> In addition, in drawings referred to in the following explanation, double lines indicate blocks of various kinds of sensors 3 and a single line indicates a processing block which performs arithmetic processing using a measurement result of the sensor 3. The processing block shown by the single line is a processing block in which a processor mounted in the sensor 3 or a processor (host processor) mounted in an electronic apparatus is a main body of processing. In addition, it is assumed that the main body of processing of each processing block can be appropriately set according to a system to which the present invention is applied. </p><p id="p0110" num="0110"> [0040] </p><p id="p0111" num="0111"> 1-2. Mounting attitude determining method 
<!-- EPO <DP n="22"/>-->
 A mounting attitude determining method in the present embodiment will be described. One object is to determine a mounting attitude, which is a relative attitude of the sensor 3 with respect to a moving body, when the sensor 3 is fixed to the moving body. In the present embodiment, the mounting attitude of the sensor 3 is determined using a movement vector measured by the sensor 3 when a moving body starts to move. As described above, a velocity vector and an acceleration vector are included in the movement vector. Therefore, in the present embodiment, the mounting attitude of the sensor 3 is determined using a velocity vector or an acceleration vector measured when a moving body starts to move. </p><p id="p0112" num="0112"> [0041] </p><p id="p0113" num="0113"> (1) First mounting attitude determination method Fig. 2 -is a system configuration view of a first mounting attitude determination system 1A (first attitude determination device) related to the first mounting attitude determination method. The first mounting attitude determination system 1A has an acceleration sensor 3A, a local coordinate velocity vector calculation section 5, and a mounting attitude determination section 10, for example. </p><p id="p0114" num="0114"> [0042] </p><p id="p0115" num="0115"> The local coordinate velocity vector calculation 
<!-- EPO <DP n="23"/>-->
section 5 calculates a local coordinate velocity vector by executing integration and addition processing on the local coordinate acceleration vector input from the acceleration sensor 3A. In the present embodiment, "integration" means adding values of a predetermined time cumulatively. In addition, "addition" means adding a result obtained by integration to a result updated last. </p><p id="p0116" num="0116"> [0043] </p><p id="p0117" num="0117"> Specifically, the local coordinate velocity vector calculation section 5 calculates a variation of a velocity vector,, which is expressed in the local coordinate system, for a predetermined time by integrating the local coordinate acceleration vector of the predetermined time. Then, the local coordinate velocity vector calculation section 5 newly calculates and updates a local coordinate velocity vector by adding the calculated variation of the velocity vector to the local coordinate velocity vector updated last. </p><p id="p0118" num="0118"> [0044] </p><p id="p0119" num="0119"> The mounting attitude determination section 10 determines a mounting attitude using the local coordinate velocity vector input from the local coordinate velocity vector calculation section 5. The mounting attitude determination section 10 determines the attitude (mounting attitude) of the sensor 3 with respect to the moving body 
<!-- EPO <DP n="24"/>-->
using the velocity vector measured when the moving body starts to move from the stop state. </p><p id="p0120" num="0120"> [0045] </p><p id="p0121" num="0121"> In the present embodiment, when the moving body is in a stop state, a measurement result of the sensor 3 is compensated for using the constraint condition regarding the velocity of the moving body (first constraint condition) . If the moving body is in a stop state, ideally, the velocity vector of the moving body is a zero vector. Accordingly, when the moving body is in a stop state, a motion model that each component of the velocity vector of the moving body is 0 can be applied. The, velocity vector of the moving body referred to herein is a velocity vector in the moving body coordinate system (V frame) . </p><p id="p0122" num="0122"> [0046] </p><p id="p0123" num="0123"> It is possible to apply a method of correcting the velocity vector of a moving body on the basis of the motion model described above. Specifically, a technique may be mentioned in which a velocity constraint condition at the time of stop, in which each component of a velocity vector of a moving body is 0 when the moving body is in a stop state, is given and a measurement result of the sensor 3 is corrected using a Kalman filter (KF) , for example. 
<!-- EPO <DP n="25"/>-->
 [0047] </p><p id="p0124" num="0124"> The Kalman filter is one of estimation methods which estimate a state of a system on the basis of a probability theory using the amount of external observation changing every moment. For example, a method may be considered in which a "state" to be estimated is set to an error included in the measurement result of the sensor 3 and the measurement result of the sensor 3 is corrected using the above-described velocity constraint condition as "observation information". Moreover, a method of resetting the measurement result of the sensor 3 on the basis of the above-described velocity constraint condition at the time of stoppage may also be considered in addition to the Kalman filter. That is, the sensor 3 is calibrated using the velocity constraint condition at the time of stoppage . </p><p id="p0125" num="0125"> [0048] </p><p id="p0126" num="0126"> As described above, when the moving body is in a stop state, an error included in the measurement result of the sensor 3 can be reduced (made small) by compensating for the measurement result of the sensor 3 using the constraint condition (first constraint condition) regarding the velocity of the moving body. If the moving body starts to move in a state where an error has been reduced, the measurement result of the sensor 3 is reduced 
<!-- EPO <DP n="26"/>-->
for a while. Therefore, in the present embodiment, the attitude (mounting attitude) of the sensor 3 with respect to the moving body is determined using a movement vector measured by the sensor 3 when the moving body starts to move . </p><p id="p0127" num="0127"> [0049] </p><p id="p0128" num="0128"> There is a relationship of the following Expression (1) between a velocity vector expressed in the local coordinate system (local coordinate velocity vector) and a velocity vector expressed in the moving body coordinate system (moving body coordinate velocity vector) . </p><p id="p0129" num="0129"> [Expression 1] 
<img id="imgf000026_0001" he="22" wi="10" file="imgf000026_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>

<img id="imgf000026_0002" he="21" wi="30" file="imgf000026_0002.tif" img-format="tif" img-content="table" orientation="portrait" inline="no"/>
 </p><p id="p0130" num="0130"> [0050] </p><p id="p0131" num="0131"> In Expressions in this specification, a component of a velocity vector is expressed as a lowercase letter "v" . Moreover, in the notation of a velocity vector, the type of the coordinate system is expressed by an uppercase superscript. "L", "V", and "A" mean a local coordinate system, a moving body coordinate system, and an absolute coordinate system, respectively. In addition, a component of each axis of the corresponding coordinate system is expressed by a lowercase subscript. For example, the 
<!-- EPO <DP n="27"/>-->
notation of "x", "y", and "z" is used in the case of three axes of the local coordinate system. </p><p id="p0132" num="0132"> [0051], </p><p id="p0133" num="0133"> In addition, in this specification, a coordinate transformation matrix is expressed by uppercase "C" . In each coordinate transformation matrix, a subscript indicates a coordinate system before coordinate transformation and a superscript indicates a coordinate system after coordinate transformation. For example, "C<sub>L</sub><sup>V</sup>" indicates a coordinate transformation matrix from the local coordinate system (L frame) to the moving body coordinate system (V frame) , and "C<sub>A</sub><sup>V</sup>" indicates a coordinate transformation matrix from the absolute coordinate system (A frame) to the local coordinate system (L frame) . </p><p id="p0134" num="0134"> . [0052] </p><p id="p0135" num="0135"> Here, a constraint condition regarding the movement direction of a moving body (second constraint condition) is applied. For example, if the moving body is a four- wheeled , vehicle, it can be assumed that the four-wheeled vehicle does not jump or drift in normal traveling. That is, assuming that velocity components of the moving body in horizontal and vertical directions are 0, the constraint condition in which velocity components in the Q-axis direction and the P-axis direction of the moving 
<!-- EPO <DP n="28"/>-->
body coordinate system (V frame) are 0 is set. That is, the constraint condition {v<sub>P</sub><sup>v</sup> = v<sub>Q</sub><sup>v</sup> = 0} is set for the velocity of the moving body. </p><p id="p0136" num="0136"> ■ [0053] </p><p id="p0137" num="0137"> , In this case, from Expression (1), the pitch angle "Θ" which is a pitch component of the mounting attitude and a yaw angle "ψ" which is a yaw component can be calculated as shown in Expressions (2) and (3). </p><p id="p0138" num="0138"> [Expression 2] · · · (2)</p><p id="p0139" num="0139"><img id="imgf000028_0001" he="14" wi="48" file="imgf000028_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/></p><p id="p0140" num="0140"> [Expression 3] </p><p id="p0141" num="0141"> ψ - arctan2y<sub>y</sub><sup>L</sup>,v<sub>x</sub><sup>L</sup>) · · · (3) </p><p id="p0142" num="0142"> [0054] </p><p id="p0143" num="0143"> The pitch angle "Θ" and the yaw angle "ψ indicate rotation angles of the sensor 3 around the P and Q axes of the moving body coordinate system, respectively. That is, it can be said that the pitch angle "Θ" and the yaw angle "ψ indicate relative attitude angles of the sensor 3 with respect to the moving body. </p><p id="p0144" num="0144"> [0055] </p><p id="p0145" num="0145"> In addition, the velocity of an automobile immediately after the automobile starts to move becomes a value close to 0. If the mounting attitude angle is calculated according to Expressions (2)· and (3) in this 
<!-- EPO <DP n="29"/>-->
state, sufficient · arithmetic precision may not be guaranteed by the operation of floating-point numbers. Therefore, it is effective to determine a mounting attitude when the velocity or acceleration becomes large to some extent without immediately calculating the mounting attitude angle even if the automobile starts to move. For example, it is effective to determine a mounting attitude when a predetermined time (set as a time of 1 second or less) elapses immediately after the brake control of an automobile is released or to determine a mounting attitude when the automobile reaches a predetermined speed of "1 km/h or more and 20 km/h or less" after the brake control is released. </p><p id="p0146" num="0146"> [0056] </p><p id="p0147" num="0147"> . (2) Second mounting attitude determination method Fig. 3 is a system configuration view of a second mounting attitude determination system IB (second attitude determination device) related to a second mounting attitude determination method. The second mounting attitude determination system IB has an acceleration sensor 3A, a attitude sensor 3B, an LA coordinate transformation matrix calculation section 20, an absolute coordinate acceleration vector calculation section 30, an absolute coordinate velocity vector calculation section 40, and a mounting attitude determination section 10, for 
<!-- EPO <DP n="30"/>-->
example. In the present embodiment, the acceleration sensor 3A and the attitude sensor 3B are integrally formed so as to measure values in the common local coordinate' system. </p><p id="p0148" num="0148"> .[0057] </p><p id="p0149" num="0149"> The LA coordinate transformation matrix calculation section 20 calculates a coordinate transformation matrix from the local coordinate system to the absolute coordinate system (hereinafter, referred to as an "LA coordinate transformation matrix") using the absolute attitude angle of the sensor 3 (direction of the sensor 3 expressed in the absolute coordinate system) input from the attitude sensor 3B. In addition, since the LA coordinate transformation matrix itself is well known, explanation using Expression and the like will be omitted. </p><p id="p0150" num="0150"> [0058] </p><p id="p0151" num="0151"> The absolute coordinate acceleration vector calculation section 30 performs coordinate transformation of the local coordinate acceleration vector, which is input from the acceleration sensor 3A, to an absolute coordinate acceleration vector using the LA coordinate transformation matrix input from the LA coordinate transformation matrix calculation section 20. </p><p id="p0152" num="0152"> [0059] </p><p id="p0153" num="0153"> The absolute coordinate velocity vector calculation 
<!-- EPO <DP n="31"/>-->
section 40 calculate an absolute coordinate velocity vector by performing integration and addition processing on the absolute coordinate acceleration vector input from the absolute coordinate acceleration vector calculation section 30. That is, by integrating the absolute coordinate acceleration vector of a predetermined time, a variation of the velocity vector of the moving body for the predetermined time is calculated. Then, the absolute coordinate velocity vector calculation section 40 newly calculates and updates an absolute coordinate velocity vector by adding the calculated variation of the velocity vector to the absolute coordinate velocity vector updated last . </p><p id="p0154" num="0154"> [0060] </p><p id="p0155" num="0155"> The mounting attitude determination section 10 determines the mounting attitude of the acceleration sensor 3A using the absolute coordinate velocity vector input from the absolute coordinate velocity . vector calculation section 40 and the absolute attitude angle input from the attitude sensor 3B. , The mounting attitude determination section 10 has as a functional section an AL coordinate transformation matrix calculation section 11 which calculates a coordinate transformation matrix from the absolute coordinate system to the local coordinate system (hereinafter, referred to as an "AL coordinate 
<!-- EPO <DP n="32"/>-->
transformation matrix") . </p><p id="p0156" num="0156"> [0061] </p><p id="p0157" num="0157"> There is a relationship of the following Expression (4) between a velocity vector expressed in the absolute coordinate system (absolute coordinate velocity vector) and a velocity vector expressed in the moving body coordinate system (moving body coordinate velocity vector) . </p><p id="p0158" num="0158"> [Expression 4] 
<img id="imgf000032_0001" he="21" wi="36" file="imgf000032_0001.tif" img-format="tif" img-content="table" orientation="portrait" inline="no"/>
 </p><p id="p0159" num="0159"> [0062] </p><p id="p0160" num="0160"> Here, "C<sub>A</sub><sup>V</sup>" indicates an AL coordinate transformation matrix. In addition, "C<sub>L</sub><sup>V</sup>" indicates a coordinate transformation matrix from the local coordinate system (L frame) to the moving body coordinate system (V frame) (hereinafter, referred to as an "LV coordinate transformation matrix") . </p><p id="p0161" num="0161"> [0063] </p><p id="p0162" num="0162"> From Expression (4), it can be seen that two steps of coordinate transformation is required in order to associate the absolute coordinate system with the moving body coordinate system. That is, , as a first step, coordinate transformation of an absolute coordinate velocity vector to a local coordinate velocity vector is 
<!-- EPO <DP n="33"/>-->
performed using an AL coordinate transformation matrix</p><p id="p0163" num="0163">Then, as a second step, coordinate transformation of the local coordinate velocity vector to a moving body coordinate velocity vector is performed using an LV coordinate transformation matrix "C<sub>L</sub><sup>V</sup>" . </p><p id="p0164" num="0164"> [0064] </p><p id="p0165" num="0165"> The AL coordinate transformation matrix "C<sub>A</sub><sup>L</sup>" is a matrix set by the direction (absolute attitude) of the sensor 3 expressed in the absolute coordinate system, and is an inverse matrix of the LA coordinate transformation matrix calculated by the LA coordinate transformation matrix calculation section 20. In this case, if coordinate transformation of the absolute coordinate velocity vector to the local coordinate velocity vector is performed using the AL coordinate transformation matrix, Expression (4) becomes equal to Expression (1) . That is, since the following Expression (5) is satisfied, Expression (1) is derived from Expressions (4) and (5) . </p><p id="p0166" num="0166"> [Expression 5] 
<img id="imgf000033_0001" he="23" wi="49" file="imgf000033_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0167" num="0167"> [0065] </p><p id="p0168" num="0168"> Thus, since Expression (1) can be derived, the mounting attitude can be determined in the same manner as 
<!-- EPO <DP n="34"/>-->
in the first mounting attitude determination method. That is, in the moving body coordinate system (V frame), the mounting attitude angle is calculated according to Expressions (2) and (3) on the basis of the constraint condition . in which velocity components in the Q-axis direction and the P-axis direction are 0 {v<sub>P</sub><sup>v</sup> = v<sub>Q</sub><sup>v</sup> = 0}. </p><p id="p0169" num="0169"> [0066] </p><p id="p0170" num="0170"> In order to realize the above, the AL coordinate transformation matrix calculation section 11 of the mounting attitude determination section 10 calculates an AL coordinate transformation matrix using the absolute attitude angle input from the attitude sensor 3. Then, the mounting attitude determination section 10 performs coordinate transformation of the absolute coordinate velocity vector, which is input from the absolute coordinate velocity vector calculation section 40, to a local coordinate velocity vector using the AL coordinate transformation matrix calculated by the AL coordinate transformation matrix calculation section 11. Then, using' the local coordinate velocity vector, the mounting attitude angle is finally calculated according to Expressions (2) and (3) . </p><p id="p0171" num="0171"> [0067] </p><p id="p0172" num="0172"> 1-3. Position calculation method </p><p id="p0173" num="0173"> Next, a position calculation method for calculating 
<!-- EPO <DP n="35"/>-->
the position of a moving body using the movement vector and the mounting attitude of the sensor 3 determined using the above mounting attitude determination method will be described. </p><p id="p0174" num="0174"> [0068] </p><p id="p0175" num="0175"> (1) First position calculation method </p><p id="p0176" num="0176"> Fig. 4 is a system configuration view of a first position calculation system 2A (first position calculation device) related to a first position calculation method. The first position calculation system 2A has a first inertial navigation system (first INS) 4A, a mounting attitude determination section 10, a moving state determination section 60, a velocity constraint setting section 70, an LV coordinate transformation matrix calculation section 80, and a correction section 90, for example. </p><p id="p0177" num="0177"> [0069] </p><p id="p0178" num="0178"> The first inertial navigation system 4A is an inertial navigation system known as an INS, and an example of the system configuration is shown in Fig. 5. The first inertial navigation system 4A has an acceleration sensor 3A, a gyro sensor 3C, a local coordinate velocity vector calculation section 5, an absolute attitude determination section 15, an LA coordinate transformation matrix calculation section 20, an absolute coordinate 
<!-- EPO <DP n="36"/>-->
acceleration vector calculation section 30, an absolute coordinate velocity vector calculation section 40, and an absolute coordinate position calculation section 50, for example. </p><p id="p0179" num="0179"> [0070] </p><p id="p0180" num="0180"> The local coordinate velocity vector calculation section 5 calculates a local coordinate velocity vector by executing integration and addition processing on the local coordinate acceleration vector input from the acceleration sensor 3A. </p><p id="p0181" num="0181"> [0071] </p><p id="p0182" num="0182"> The absolute attitude determination section 15 determines an absolute attitude angle by executing integration and addition processing on the local coordinate angular velocity input from the gyro sensor 3C. Specifically, a variation of the attitude angle of the sensor 3 from the given reference attitude which is expressed in the absolute coordinate system is calculated by integrating the local coordinate angular velocity input from the gyro sensor 3C. Then, the absolute attitude angle is newly calculated and updated by adding the attitude angle variation to the reference attitude. </p><p id="p0183" num="0183"> [0072] </p><p id="p0184" num="0184"> The LA coordinate transformation matrix calculation section 20, the absolute coordinate acceleration vector 
<!-- EPO <DP n="37"/>-->
calculation section 30, and the absolute coordinate velocity vector calculation section 40 calculate an LA coordinate transformation matrix, an absolute coordinate acceleration vector, and an absolute coordinate velocity vector, respectively, as in Fig. 3. </p><p id="p0185" num="0185"> [0073] </p><p id="p0186" num="0186"> The absolute coordinate position calculation section 50 calculates the absolute coordinate position Of a moving body by executing integration and addition processing on the absolute coordinate velocity vector input from the absolute coordinate velocity vector calculation section 40. That is, by integrating the absolute coordinate velocity vector of a predetermined time, a position variation for the predetermined time is calculated. Then, the absolute coordinate position calculation section 50 newly calculates and updates an absolute coordinate position by adding the calculated position variation to the absolute coordinate position updated last. </p><p id="p0187" num="0187"> [0074] </p><p id="p0188" num="0188"> The local velocity vector calculated by the local coordinate velocity vector calculation section 5, the absolute attitude angle calculated by the absolute attitude determination section 15, the absolute coordinate velocity vector calculated by the absolute coordinate velocity vector calculation section 40, and the absolute 
<!-- EPO <DP n="38"/>-->
coordinate position calculated by the absolute coordinate position calculation section 50 are output from the first inertial navigation system 4A. </p><p id="p0189" num="0189"> [0075] </p><p id="p0190" num="0190"> Returning to the explanation of Fig. 4, the mounting attitude determination section 10 determines the mounting attitude of the first inertial navigation system 4A with respect to the moving body using the local coordinate velocity vector input from the first inertial navigation system 4A. </p><p id="p0191" num="0191"> [0076] </p><p id="p0192" num="0192"> The moving state determination section 60 determines a moving state of the moving body. Determination regarding the moving state of the moving body can be realized by various kinds of methods. For example, a method of performing determination using a measurement result of the acceleration sensor 3A or the gyro sensor 3C provided in the inertial navigation system may be mentioned. In addition, when the moving body is an automobile, a moving state of the moving body may be determined using the speed measured by a speed detection system (for example, a speed pulse) mounted in the automobile . </p><p id="p0193" num="0193"> [0077] </p><p id="p0194" num="0194"> The velocity constraint setting section 70 sets the 
<!-- EPO <DP n="39"/>-->
velocity constraint condition applied to the correction section 90 on the basis of the moving state input from the moving state determination section 60. In the present embodiment, two types of "velocity constraint condition at the time of stop" which is a velocity constraint condition when a moving body is in a stop state and "velocity constraint condition at the time of movement" which is a velocity constraint condition when the moving body moves are changeably set. </p><p id="p0195" num="0195"> [0078] </p><p id="p0196" num="0196"> The velocity constraint condition at the time of stop is a first constraint condition regarding the velocity of a moving body, and is a constraint condition applied when the moving body is in a stop state. Specifically, the velocity constraint condition at the time of stop is a constraint condition set on the assumption that the velocity vector of a moving body is a zero vector when the moving body is stopped. Although the coordinate system in <sup>'</sup> which the velocity constraint condition at the time of stop is applied is arbitrary, applying it in the absolute coordinate system may be considered, for example. In this case, for example, {v<sub>x</sub><sup>A¾</sup>= Vy<sup>A</sup> = v<sub>z</sub><sup>A</sup> = 0} is given as the constraint condition. </p><p id="p0197" num="0197"> [0079] </p><p id="p0198" num="0198"> The velocity constraint condition at the time of 
<!-- EPO <DP n="40"/>-->
movement is a second constraint condition regarding the movement direction of a moving body, and is a constraint applied when the moving body moves. As described above, if the moving body is a four-wheeled vehicle, the velocity constraint condition at the time of movement is a constraint condition set on the assumption that the moving body does not jump or drift in normal traveling. In this case, for example, {v<sub>P</sub><sup>v</sup> = v<sub>Q</sub><sup>v</sup> = 0} is given as the constraint condition. This constraint condition is an effective condition in the moving body coordinate system. </p><p id="p0199" num="0199"> [0080] </p><p id="p0200" num="0200"> The LV coordinate transformation matrix calculation section 80 calculates a coordinate transformation matrix from the local coordinate system to the moving body coordinate system (hereinafter, referred to as an "LV coordinate transformation matrix") using the mounting attitude angle input from the mounting attitude determination section 10., In addition, since the LA coordinate transformation matrix itself is well, known, explanation using Expressions and the like will be omitted. </p><p id="p0201" num="0201"> [0081] </p><p id="p0202" num="0202"> The correction section 90 corrects inertial navigation operation results input from the first inertial navigation system 4A. It is preferable that the correction section 90 be configured to correct at least an 
<!-- EPO <DP n="41"/>-->
absolute coordinate position of the inertial navigation operation results. That is, it is preferable to configure the correction section 90 so as to perform an error estimation operation for at least the absolute coordinate position and estimate the absolute coordinate position using the estimated position error. </p><p id="p0203" num="0203"> [0082] </p><p id="p0204" num="0204"> In the present embodiment, a case is exemplified in which the correction section 90 corrects not only the absolute coordinate position but also the absolute coordinate velocity vector and the absolute attitude angle collectively. The correction section 90 has an error estimation section 91 and an AL coordinate transformation matrix calculation section 93. </p><p id="p0205" num="0205"> [0083] </p><p id="p0206" num="0206"> The error estimation section 91 estimates an error included in the inertial navigation operation result input from the first inertial navigation system 4A (hereinafter, referred to as an "inertial navigation operation error") by performing a predetermined error estimation operation. Various methods may be applied as a method of estimating an inertial navigation operation error. As a typical method, a Kalman filter may be applied. </p><p id="p0207" num="0207"> [0084] </p><p id="p0208" num="0208"> Specifically, a state vector "X" is set as in the 
<!-- EPO <DP n="42"/>-->
following Expression (6), for example. </p><p id="p0209" num="0209"> [Expression δΡ </p><p id="p0210" num="0210"> X = w (6) </p><p id="p0211" num="0211"> δΑ </p><p id="p0212" num="0212">Here, "δΡ", "δν", and "δΑ" indicate an error of an absolute coordinate position (position error) , an error of an absolute coordinate velocity vector (velocity vector error) , and an error of an absolute attitude angle (attitude angle error) , respectively. </p><p id="p0213" num="0213"> [0085] </p><p id="p0214" num="0214"> When the moving body is in a stop state, for example, an observation vector at the time of stop "Z<sub>st0</sub>p" shown in the following Expression (7) is set according to the velocity constraint condition at the time of stop. In addition, when the moving body moves, for example, an observation vector at the time of movement "Z<sub>move</sub>" shown in the following Expression (8) is set according to the velocity constraint condition at the time of movement. </p><p id="p0215" num="0215"> [Expression 7] 
<img id="imgf000042_0001" he="20" wi="53" file="imgf000042_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0216" num="0216"> [Expression 
<!-- EPO <DP n="43"/>-->
 
<img id="imgf000043_0001" he="21" wi="37" file="imgf000043_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0217" num="0217"> [0086] </p><p id="p0218" num="0218"> In Expression (8), |V| indicates the magnitude of the velocity. The magnitude of the velocity may be calculated as the magnitude (scalar) of an absolute coordinate velocity vector obtained by inertial navigation operation or may be calculated as the magnitude of a velocity acquired from an external system, such as a velocity detection system. </p><p id="p0219" num="0219"> [0087] </p><p id="p0220" num="0220"> The state vector "X" and the observation vector "Z" are set as described above, and an estimation operation (time update) and a correction operation (observation update) based on the theory of the Kalman filter are performed to calculate an estimate (state estimate) of the state vector "X". </p><p id="p0221" num="0221"> [0088] </p><p id="p0222" num="0222"> In the above definition Expression, the state vector "X" is defined as an inertial navigation operation error expressed in the absolute coordinate system. Since the observation vector at the time of stop "Z<sub>s</sub>top " is defined in the absolute coordinate system, an operation in the same coordinate system is possible. However, since the 
<!-- EPO <DP n="44"/>-->
observation vector at the time of movement "Z<sub>move</sub>" is defined in the moving body coordinate system, an operation in the same coordinate system is difficult. </p><p id="p0223" num="0223"> [0089] </p><p id="p0224" num="0224"> Therefore, the AL coordinate transformation matrix calculation section 93 calculates an AL coordinate transformation matrix using the absolute attitude angle input from the first inertial navigation system 4A. Then, the state vector "X" expressed in the absolute coordinate system is coordinate-transformed to the state vector "X" expressed in the moving body coordinate system using the calculated AL coordinate transformation matrix and the LV coordinate transformation matrix input from the LV coordinate transformation matrix calculation section 80. That is, two steps of coordinate transformation into the state vector "X" are performed using two kinds of coordinate transformation matrices. </p><p id="p0225" num="0225"> [0090] </p><p id="p0226" num="0226"> Similarly, using the AL coordinate transformation matrix and the LV coordinate transformation matrix, an absolute coordinate position, an absolute coordinate velocity vector, and an absolute attitude angle which are inertial navigation operation results are coordinate- transformed to a moving body coordinate position, a moving body coordinate velocity vector, and a moving body 
<!-- EPO <DP n="45"/>-->
attitude angle expressed in the moving body coordinate system, respectively. That is, two steps of coordinate transformation into inertial navigation operation results are performed using two kinds of coordinate transformation matrices. </p><p id="p0227" num="0227"> [0091] </p><p id="p0228" num="0228"> An inertial navigation operation error is estimated by performing an error estimation operation using a Kalman filter for the state vector "X", which has been coordinate-transformed to the moving body coordinate system, by applying the observation vector at the time of movement "Z<sub>move</sub>" defined in the moving body coordinate system. Then, the moving body coordinate position, the moving body coordinate velocity vector, and the moving body attitude angle are corrected using the inertial navigation operation error estimated in the moving body coordinate system. Then, final correction results are obtained by performing retransformation from the moving body coordinate system to the absolute coordinate system. </p><p id="p0229" num="0229"> [0092] </p><p id="p0230" num="0230"> The corrected position, the corrected velocity vector, and the corrected attitude angle which are output from the correction section 90 are fed back to the first inertial navigation system 4A. In the first inertial navigation system 4A, the absolute coordinate position, 
<!-- EPO <DP n="46"/>-->
the absolute coordinate velocity vector, and the absolute attitude angle calculated by the absolute coordinate position calculation section 50, the absolute coordinate velocity vector calculation section 40, and the absolute attitude determination section 15 are corrected using the corrected position, the corrected velocity vector, and the corrected attitude angle input from the correction section 90, respectively. </p><p id="p0231" num="0231"> [0093] . </p><p id="p0232" num="0232"> (2) Second position calculation method </p><p id="p0233" num="0233"> Fig 6 is a system configuration view of a second position calculation system 2B (second position calculation device) related to a second position calculation method. The second position calculation system 2B has a second inertial navigation system (second INS) 4B, a mounting attitude determination section 10, a moving state determination section 60, a velocity constraint setting section 70, an LV coordinate transformation matrix calculation section 80, and a correction section 90, for example.. </p><p id="p0234" num="0234"> [0094] </p><p id="p0235" num="0235"> Fig. 7 is a view showing an example of the system configuration of the second inertial navigation system 4B. The second inertial navigation system 4B has an acceleration sensor 3A, a gyro sensor 3C, an absolute 
<!-- EPO <DP n="47"/>-->
attitude determination section 15, an LA coordinate transformation matrix calculation section 20, an absolute coordinate acceleration vector calculation section 30, an absolute coordinate velocity vector calculation section 40, and an absolute coordinate position calculation section 50, for example. This, configuration is a configuration excluding the local coordinate velocity vector calculation section 5 from the first inertial navigation system 4A of Fig. 5. </p><p id="p0236" num="0236"> [0095] </p><p id="p0237" num="0237"> The absolute attitude angle calculated by the absolute attitude determination section 15, the absolute coordinate velocity vector calculated by the absolute coordinate velocity vector calculation section 40, and the absolute coordinate position calculated by the absolute coordinate position calculation section 50 are output from the second inertial navigation system 4B. </p><p id="p0238" num="0238"> [0096] </p><p id="p0239" num="0239"> Returning to the explanation of Fig. 6, the mounting attitude determination section 10 determines the mounting attitude of the second inertial navigation system 4B with respect to the moving body using the absolute coordinate velocity vector input from the second inertial navigation system 4B. The mounting attitude determination section 10 has an AL coordinate transformation matrix calculation 
<!-- EPO <DP n="48"/>-->
section 11 as a functional section and determines the mounting attitude in the same manner as in the second mounting attitude determination system IB of Fig. 3. </p><p id="p0240" num="0240"> [0097] </p><p id="p0241" num="0241"> The correction section 90 corrects the inertial navigation operation results input from the second inertial navigation system 4B using the mounting attitude angle and the AL coordinate transformation matrix input from the mounting attitude determination section 10, the velocity constraint condition input from the velocity constraint setting section 70, and the LV coordinate transformation matrix input from the LV coordinate transformation matrix calculation section 80. The correction section 90 has the error estimation section 91 as a functional section. </p><p id="p0242" num="0242"> [0098] </p><p id="p0243" num="0243"> The corrected position, the corrected . velocity vector, and the corrected attitude angle which are correction results of the inertial navigation operation results are output from the correction section 90. In addition, these correction results are fed back to the second inertial navigation system 4B. The second inertial navigation system 4B corrects the inertial navigation operation result using the correction results input from the correction section 90. 
<!-- EPO <DP n="49"/>-->
 [0099] </p><p id="p0244" num="0244"> 1-4. Simulation result </p><p id="p0245" num="0245"> In order to show the effectiveness of the above position calculation method, a result of a simulation experiment for calculating the position of a moving body will be described. A simulation experiment was conducted in which the sensor 3 was fixed to the moving body so as to cause installation shift and the position of the moving body was calculated using the above-described position calculation method. </p><p id="p0246" num="0246"> [0100] </p><p id="p0247" num="0247"> Fig. 8 shows a simulation result when a known method is used. In contrast, Fig. 9 shows a simulation result when the method of the present embodiment is used. In each drawing, the horizontal axis indicates an east-west direction, the vertical axis indicates a north-south direction, and the unit is meter [m] . A diamond-shaped path which took one round largely in the counterclockwise direction with the position of "0 m" in the east-west direction and "0 m" in the north-south direction as its start point was followed. The goal point is the same as the start point. A dotted line indicates the actual trajectory of a moving body, and a solid line indicates the trajectory of the calculated position. </p><p id="p0248" num="0248"> [0101] 
<!-- EPO <DP n="50"/>-->
 Referring to Fig. 8, it can be seen that a serious position error occurs when the known method is used. That is, far from calculating the position along the diamond- shaped trajectory, it can be seen that the position deviates toward the east direction immediately after the start and eventually, the position far from the goal point is determined to be a goal point. This is because the position calculation was performed without determining the mounting attitude of the sensor 3. That is, since position calculation was performed by applying the velocity constraint condition at the time of movement (second constraint condition) defined in the moving body coordinate system although the local coordinate system and the moving body coordinate system did not match each other, the position was calculated in a wrong direction from the first and the error increases cumulatively with time. </p><p id="p0249" num="0249"> [0102] </p><p id="p0250" num="0250"> In contrast, referring to Fig. 9, it can be seen that the almost correct trajectory along the diamond- shaped actual trajectory is obtained when the method of the present embodiment is used. This is because' the position calculation could be performed by determining the mounting attitude of the sensor 3 as correctly as possible. That is, such a good result was obtained since the mounting attitude of the sensor 3 was determined and then 
<!-- EPO <DP n="51"/>-->
coordinate transformation to the moving body coordinate system was performed in consideration of the amount of shift between the local coordinate system and the moving body coordinate system and position calculation was performed by applying the velocity constraint condition at the time of movement defined in the moving body coordinate system. </p><p id="p0251" num="0251"> [0103] </p><p id="p0252" num="0252"> 2. Examples </p><p id="p0253" num="0253"> Next, an example of a navigation system ; to which the above attitude determination method and the above position calculation method are applied will be described. Here, it is needless to say that examples to which the present invention can be applied are not limited to the example described below. </p><p id="p0254" num="0254"> [0104] </p><p id="p0255" num="0255"> The navigation system in this example is configured as a system in which a car navigation apparatus 1000, to which the mounting attitude determination system (attitude determination device) and the position calculation system (position calculation device) explained in the principles are applied, is mounted in a four-wheeled vehicle (hereinafter, simply referred to as an "automobile") which is a kind of moving body. </p><p id="p0256" num="0256"> [0105] 
<!-- EPO <DP n="52"/>-->
 The car navigation apparatus 1000 is an electronic apparatus mounted in an automobile, and includes an IMU</p><p id="p0257" num="0257">(Inertial Measurement Unit) 400 as a sensor module having the acceleration . sensor 3A and the gyro sensor 3C. The IMU 400 is a sensor unit known as an inertial measurement unit, and is configured to be able to measure and output an acceleration vector and an angular velocity expressed in the local coordinate system. </p><p id="p0258" num="0258"> [0106] </p><p id="p0259" num="0259"> The car navigation apparatus 1000 calculates the position of the automobile in the absolute 'coordinate system by performing inertial navigation operation processing using a measurement result of the IMU 400. In this example, a case where an NED coordinate system is used as the absolute coordinate system will be described. That is, the car navigation apparatus 1000 calculates the position of the automobile in the NED coordinate system. Then, the car navigation apparatus 1000 generates a navigation screen obtained by plotting the calculated position and displays the navigation screen on a display which is a display unit 300. </p><p id="p0260" num="0260"> [0107] ·. <sup>'</sup> </p><p id="p0261" num="0261"> 2-1. Functional configuration </p><p id="p0262" num="0262"> Fig. 10 is a block diagram showing an example of- the functional configuration of the car navigation apparatus 
<!-- EPO <DP n="53"/>-->
1000. The car navigation apparatus 1000 is configured to include as the main functional configuration a processing unit 100, an operation unit 200, the display unit 300, the IMU 400, and a storage unit 500. </p><p id="p0263" num="0263"> [01,08] </p><p id="p0264" num="0264"> The processing unit 100 is a controller which performs overall control of the units of the car navigation apparatus 1000 according to various kinds of programs, such as a system program, stored in the storage unit 500, and includes a processor, such as a CPU (Central Processing Unit) . The processing unit 100 calculates the position and the like of the automobile by performing inertial navigation operation processing using the measurement result of the IMU 400. The processing unit 100 functions as an attitude determination device which determines the attitude of the IMU 400 with respect to the automobile and also functions as a position calculation device which calculates the position of the automobile. </p><p id="p0265" num="0265"> [0109] </p><p id="p0266" num="0266"> Fig. 11 is a block diagram mainly showing a functional block related to the processing unit 100. The processing unit 100 has as functional sections an inertial navigation operation section 105, a mounting attitude determination section 110, a moving state determination section 160, a velocity constraint setting section 170, an 
<!-- EPO <DP n="54"/>-->
LV coordinate transformation matrix calculation section 180, and a correction section 190. </p><p id="p0267" num="0267"> [0110] </p><p id="p0268" num="0268"> The inertial navigation operation section 105 calculates an NED coordinate position, an NED coordinate velocity vector, and an absolute attitude angle of an automobile by performing inertial navigation operation processing using the local coordinate acceleration vector and the local coordinate angular velocity input from the IMU 400. </p><p id="p0269" num="0269"> [0111] </p><p id="p0270" num="0270"> The correction section 190 corrects the NED coordinate position, the NED coordinate velocity vector, and the absolute attitude angle input from the inertial navigation operation section 105 using the mounting attitude angle of the IMU 400 input from the mounting attitude determination section 110 and the velocity constraint condition input from the velocity constraint setting section 170. The correction section 190 has a KF error estimation section 191 and an NL coordinate transformation matrix calculation section 193 as a functional section. </p><p id="p0271" num="0271"> [0112] </p><p id="p0272" num="0272"> The KF error estimation section 191 estimates an inertial navigation operation error included in the 
<!-- EPO <DP n="55"/>-->
inertial navigation operation result in the NED coordinate system using a Kalman filter. </p><p id="p0273" num="0273"> [0113] </p><p id="p0274" num="0274"> The NL coordinate transformation matrix calculation section 193 calculates a coordinate transformation matrix from the NED coordinate system to the local coordinate system (hereinafter, referred to as an "NL coordinate transformation matrix") using the absolute attitude angle input from the inertial navigation operation section 105. </p><p id="p0275" num="0275"> [0114] </p><p id="p0276" num="0276"> Returning to the explanation of Fig. 10, the operation unit 200 is an input device configured to include a touch panel or a button switch, for example, and outputs a signal of a pressed key or button to the processing unit 100. By the operation of the operation unit 200, various kinds of instruction input, such as input of a destination, are performed. </p><p id="p0277" num="0277"> [0115] </p><p id="p0278" num="0278"> The display unit 300 is formed by an LCD (Liquid Crystal Display) or the like, and is a display device which performs various kinds of display on the basis of a display signal input from the processing unit 100. A navigation screen or the like is displayed on the display unit 300. </p><p id="p0279" num="0279"> [0116] 
<!-- EPO <DP n="56"/>-->
 The IMU 400 is a sensor unit known as an inertial measurement unit, and is configured to include the acceleration sensor 3A and the gyro sensor 3C, for example. </p><p id="p0280" num="0280"> [0117] </p><p id="p0281" num="0281"> The storage unit 500 is formed by storage devices, such as a ROM (Read Only Memory) or a flash ROM and a RAM (Random Access Memory) , and stores a system program of the car navigation device 1000, various programs or data used to realize various functions involving a navigation function, and the like. In addition, the storage unit 500 has a work area where data being processed, a processing result, and the like in various kinds of processing are temporarily stored. </p><p id="p0282" num="0282"> [0118] </p><p id="p0283" num="0283"> 2-2. Data configuration </p><p id="p0284" num="0284"> As shown in Fig. 10, a navigation program 510 which is read by the processing unit 100 and executed as navigation processing (refer to Fig. 12) is stored as a program in the storage unit 500. The navigation program 510 includes a correction program 511, which is executed as correction processing (refer to Fig. 13) , as a subroutine. Details of this processing will be described later using a flow chart. </p><p id="p0285" num="0285"> [0119] </p><p id="p0286" num="0286"> In addition, a velocity constraint condition 520, 
<!-- EPO <DP n="57"/>-->
IMU measurement data 530, inertial navigation operation data 540, mounting attitude data 550, coordinate transformation matrix data 560, estimated error data 570, and corrected inertial navigation operation data 580 are stored as data in the storage unit 500. </p><p id="p0287" num="0287"> [0120] </p><p id="p0288" num="0288"> The velocity constraint condition 520 is a constraint condition of a velocity according to the moving state of an automobile, and a velocity constraint condition at the time of stop 521 and a velocity constraint condition at the time of movement 523 are included in the velocity constraint condition 520. </p><p id="p0289" num="0289"> [0121] </p><p id="p0290" num="0290"> The IMU measurement data 530 is data of a measurement result of the IMU 400. A local coordinate acceleration vector measured by the acceleration sensor 3A and a local coordinate angular velocity measured by the gyro sensor 3C are stored, in time series. </p><p id="p0291" num="0291"> [0122] </p><p id="p0292" num="0292"> The inertial navigation operation data 540 is data of the NED coordinate position, the NED coordinate velocity vector, and. the absolute attitude angle calculated when the processing unit 100 performs inertial navigation operation processing using the measurement result of the IMU 400. 
<!-- EPO <DP n="58"/>-->
 [0123] </p><p id="p0293" num="0293"> The mounting attitude data 550 is data in which the mounting attitude angle of the IMU 400 calculated by the processing unit 100 is stored. The coordinate transformation matrix data 560 is data in which various kinds of coordinate transformation matrices calculated by the processing unit 100 are stored. </p><p id="p0294" num="0294"> [0124] </p><p id="p0295" num="0295"> The estimated error data 570 is data in which an inertial navigation operation error estimated by performing a KF error estimation operation by the processing unit 100 is stored. In addition, the corrected inertial navigation operation data 580 is data obtained when the processing unit 100 corrects an inertial navigation operation result using the inertial navigation operation error. </p><p id="p0296" num="0296"> [0125] </p><p id="p0297" num="0297"> 2-3. Flow of processing </p><p id="p0298" num="0298"> Fig. 12 is a flow chart showing the flow of navigation processing which is executed in the car navigation apparatus 1000 when the navigation program 510 stored in the storage unit 500 is read and executed by the processing unit 100. In the following navigation processing, the local coordinate acceleration vector and the local coordinate angular velocity measured by the IMU 
<!-- EPO <DP n="59"/>-->
400 are stored in the IMU measurement data 530 of the storage unit 500 when necessary. <sub>(</sub> </p><p id="p0299" num="0299"> [0126] </p><p id="p0300" num="0300"> First, the processing unit 100 performs initial setting (step Al) . For example, the processing unit 100 performs initial setting of various parameter values used in a Kalman filter. In addition, the processing unit 100 assumes that an automobile is in a stop state and sets the velocity constraint condition at the time of stop 521 to "ON" and the velocity constraint condition at the time of movement 523 to "OFF". </p><p id="p0301" num="0301"> [0127] </p><p id="p0302" num="0302"> Then, the inertial navigation operation section 105 starts inertial navigation operation processing (step A3) . That is, the inertial navigation operation section 105 performs inertial navigation operation processing using the measurement data of the IMU 400 stored in the IMU measurement data 530. Then, the result is stored in the storage unit 500 as the inertial navigation operation data 540. </p><p id="p0303" num="0303"> [0128] </p><p id="p0304" num="0304"> Then, the correction section 190 starts correction processing according to the . correction program 511 stored in the storage unit 500 (step A5) . </p><p id="p0305" num="0305"> [0129] 
<!-- EPO <DP n="60"/>-->
 Fig. 13 is a flow chart showing the flow of correction processing. </p><p id="p0306" num="0306"> First, the KF error estimation section 191 determines whether or not the velocity constraint condition at the time of movement 523 is set to "ON" (step Bl) . Then, when it is determined that the velocity constraint condition at the time of movement 523 is set to "ON" (step Bl; Yes), the NL coordinate transformation matrix calculation section 193 calculates an NL coordinate transformation matrix using the newest absolute attitude angle and stores the calculated NL coordinate transformation matrix in the coordinate transformation matrix data 560 of the storage unit 500 (step B3) . </p><p id="p0307" num="0307"> [0130] </p><p id="p0308" num="0308"> Then, the KF error estimation .section 191 converts the NED coordinate velocity vector into a moving body coordinate velocity vector using the NL coordinate transformation matrix calculated in step B3 (step B5) . Then, the KF error estimation section 191 calculates a difference between a constraint velocity vector at the time of movement and a moving body coordinate velocity vector and sets this as an observation vector at the time of movement (step B7) . </p><p id="p0309" num="0309"> [0131] </p><p id="p0310" num="0310"> Then, the KF error estimation section 191 performs 
<!-- EPO <DP n="61"/>-->
KF error estimation processing (step B9) . That is, the KF error estimation section 191 estimates an inertial navigation operation error by performing a prediction operation and a correction operation using as observation information the observation vector at the time of movement set in step B7. Then, the KF error estimation section 191 corrects the inertial navigation operation result using the estimated inertial navigation operation error and stores the result in the corrected inertial navigation operation data 580 of the storage unit 500 (step Bll), and then the process returns to step Bl . </p><p id="p0311" num="0311"> [0132] </p><p id="p0312" num="0312"> In addition, when it is determined that the velocity constraint condition at the time of movement 523 is not set to "ON" in step Bl (step Bl; No), the KF error estimation section 191 determines whether or not the velocity constraint condition at the time of stop 521 is set to "ON" (step B13) Then, when it is determined that the velocity constraint condition at the time of movement 523 is set to "ON" (step B13; Yes), the KF error estimation section 191 calculates a difference between the constraint velocity vector at the time of stop and the NED coordinate velocity vector and sets this as an observation vector at the time of stop (step B15) . </p><p id="p0313" num="0313"> [0133] 
<!-- EPO <DP n="62"/>-->
 Then, the KF error estimation section 191 performs KF error estimation processing (step B17) . That is, the KF error estimation section 191 estimates an inertial navigation operation error by performing a prediction operation and a correction operation using as observation information the observation vector at the time of stop set in step B15. Then, the KF error estimation section 191 corrects the inertial navigation operation result using the estimated inertial navigation operation error and stores the result in the corrected inertial navigation operation data 580 of the storage unit 500 (step B19) , and then the process returns to step Bl . </p><p id="p0314" num="0314"> [0134] </p><p id="p0315" num="0315"> In addition, when it is determined that the velocity constraint condition at the time of stop 521 is not set to "ON" in step B13 (step B13; No) , the correction section 190 returns to step Bl. </p><p id="p0316" num="0316"> [0135] </p><p id="p0317" num="0317"> Returning to the explanation of Fig. 12, when correction processing starts in step A5, the moving state determination section 160 determines a moving state of the automobile (step A7). Then, the processing unit 100 determines whether or not the automobile has started to move from the stop state (step A9) . For example, the processing unit 100 determines the start of movement of 
<!-- EPO <DP n="63"/>-->
the automobile by receiving a release signal of brake control of the automobile from the outside or receiving the vehicle speed information from the outside. </p><p id="p0318" num="0318"> [0136] </p><p id="p0319" num="0319"> When it is determined that the automobile has started to move (step A9; Yes), the velocity constraint setting section 170 sets the velocity constraint condition at the time of stop 521 to "OFF" (step All) . Then, the processing unit 100 determines whether or not a predetermined mounting attitude determination activation condition is satisfied (step A13) . As also described in the principles, the mounting attitude determination activation condition is a condition set in order to ensure the determination accuracy of the mounting attitude. For example, a condition "velocity or acceleration of a moving body reaches a predetermined threshold value after the stop of the moving body is released" is preferably set as the activation condition </p><p id="p0320" num="0320"> [0137] </p><p id="p0321" num="0321"> When it is determined that the mounting attitude determination activation condition is not yet satisfied in step A13 (step A13; No) , the processing unit 100 proceeds to step A27. When it is determined that the mounting attitude determination activation condition is <sub>.</sub> satisfied (step A13; Yes), the mounting attitude determination 
<!-- EPO <DP n="64"/>-->
section 110 performs mounting attitude determination processing (step A15) . That is, using the newest local coordinate velocity vector, a mounting attitude angle is calculated according to Expressions (2) and (3) and the mounting attitude data 550 of the storage unit 500 is updated. </p><p id="p0322" num="0322"> [0138] </p><p id="p0323" num="0323"> Then, the processing unit 100 calculates an LV coordinate transformation matrix using the mounting attitude angle calculated in step A15 and updates the coordinate transformation matrix data 560 of the storage unit 500 (step A17) . Then, the processing unit 100 sets the velocity constraint condition at the time of movement 523 to "ON" (step A19) . </p><p id="p0324" num="0324"> [0139] </p><p id="p0325" num="0325"> On the other hand, when the start of movement of the automobile is not detected in step A9 (step A9; No), the processing unit 100 determines whether or not the automobile has changed from the movement state to the stop state, (step A21). When it is determined that the automobile has not changed to the stop state (step A21; No), the processing unit 100 proceeds to step A27. </p><p id="p0326" num="0326"> [0140] </p><p id="p0327" num="0327"> In addition, when it is determined that the automobile has changed from the movement state to the stop 
<!-- EPO <DP n="65"/>-->
state (step A21; Yes), the processing unit 100 sets the velocity constraint condition at the time of movement 523 to "OFF" (step A23) and also sets the velocity constraint condition at the time of stop 521 to "ON" (step A25) . Then, the processing unit 100 proceeds to step A27. </p><p id="p0328" num="0328"> [0141] </p><p id="p0329" num="0329"> The processing unit 100 determines whether or not this is a position output timing (step A27) . When it is determined that this is not a position output timing (step A27; No), the process proceeds to step A31. In addition, when it is determined that this is a position output timing (step A27; Yes), the processing unit 100 outputs the newest corrected position (step A29) . That is, the processing unit 100 updates the navigation screen of the display unit 300 by performing map matching processing or the like on the newest corrected position. </p><p id="p0330" num="0330"> [0142] </p><p id="p0331" num="0331"> Then, the processing unit 100 determines whether to end the navigation processing (step A31). For example, when the user gives an instruction to end the navigation through the operation unit 200, it is determined that the navigation processing is to be ended. Then, when it is determined that the processing is not yet to be ended (step A31; No), the processing unit 100 returns to step A7. In addition, when it is determined that the processing is 
<!-- EPO <DP n="66"/>-->
to be ended (step A31; Yes), the processing unit 100 ends the navigation processing. </p><p id="p0332" num="0332"> [0143] </p><p id="p0333" num="0333"> 2-4. Experimental results </p><p id="p0334" num="0334"> An experiment to calculate the position by -mounting the car navigation apparatus 1000 in an automobile and making the automobile actually travel was performed. Specifically, an experiment to calculate the above navigation position and plot the position was performed. </p><p id="p0335" num="0335"> [0144] </p><p id="p0336" num="0336"> Fig. 14 shows an experimental result when the known car navigation apparatus 1000 is used. In contrast, Fig. 15 shows an experimental result when the car navigation apparatus 1000 in this example is used. In both the cases, the map matching function is set to OFF. Although the view on the drawings is the same as the simulation results in Figs. 8 and 9, the paths are different since the experimental results in Figs. 14 and 15 are results obtained by actually performing traveling experiments. An automobile was made to actually travel from the start point to the goal point in a state where the position of "0 m" in the east-west direction and "0 m" in the north- south direction was set as its start point and the position near "12000 m" in the east direction and "10000 m" in the south direction was set as its 'goal position. 
<!-- EPO <DP n="67"/>-->
 [0145] </p><p id="p0337" num="0337"> This result shows that the position is calculated in a wrong direction immediately after the start and a position far from the goal point is eventually determined as the goal point in the experimental result of the known car navigation apparatus 1000 in Fig. 14, as in the simulation result of Fig. 8. In contrast, from the experimental result of the car navigation apparatus 1000 in this example of Fig. 15, it can be seen that the correct trajectory along the almost actual trajectory is obtained as in the simulation result of Fig. 9. Therefore, it was clear that the position calculation method of the present embodiment was also effective in the real environment. </p><p id="p0338" num="0338"> [0146] </p><p id="p0339" num="0339"> 3. Operations and effects </p><p id="p0340" num="0340"> According to the present embodiment, a movement vector is measured by the sensor 3 mounted in the moving body. Then, the attitude of the sensor 3 with respect to the moving body is determined using a movement vector measured by the .sensor 3 when the moving body starts to move . </p><p id="p0341" num="0341"> [0147] </p><p id="p0342" num="0342"> In the first mounting attitude determination system 1A, the local coordinate velocity vector calculation 
<!-- EPO <DP n="68"/>-->
section 5 calculates a local coordinate velocity vector using a local coordinate acceleration vector measured by the acceleration sensor 3A. Then, the mounting attitude determination section 10 determines a pitch component and a yaw component of the mounting attitude of the acceleration sensor 3A using a local coordinate , velocity vector when the moving body starts to move. </p><p id="p0343" num="0343"> [0148] </p><p id="p0344" num="0344"> In addition, in the second mounting attitude determination system IB, the LA coordinate transformation matrix calculation section 20 calculates a coordinate transformation matrix from the local coordinate system to the absolute coordinate system (LA coordinate transformation matrix) using a direction (absolute attitude) of the sensor 3 expressed in the absolute coordinate system which is measured by the attitude sensor 3B. Then, the absolute coordinate acceleration vector calculation section 30 performs coordinate transformation of the local coordinate acceleration vector, which has been measured by the acceleration sensor 3A, to an absolute coordinate acceleration vector using the LA coordinate transformation matrix. In addition, the absolute coordinate velocity vector calculation section 40 calculates an absolute coordinate velocity vector using the absolute coordinate acceleration vector. The mounting 
<!-- EPO <DP n="69"/>-->
attitude determination section 10 calculates a coordinate transformation matrix from the absolute coordinate system to the local coordinate system (AL coordinate transformation matrix) using the direction of the sensor 3 expressed in the absolute coordinate system, which has been measured by the attitude sensor 3B, and determines a pitch component and a yaw component of the mounting attitude of the acceleration sensor 3A using the AL coordinate transformation matrix and the absolute coordinate velocity vector. </p><p id="p0345" num="0345"> [0149] </p><p id="p0346" num="0346"> In addition, when the moving body is in a stop state, a compensation operation for compensating for a measurement . result of the , sensor 3 is performed. For example, when the moving body is in a stop state, a measurement result of the sensor 3 is compensated for using a constraint condition in which each component of a velocity vector of the moving body is 0 (first constraint condition) . As a result, an error included in the measurement result of the sensor 3 can be reduced when the moving body is in a stop state. Even if the moving body starts to move in a state where an error is reduced, an error of the velocity vector of the moving body is suppressed if time has not elapsed that much. Therefore, the relative attitude of the sensor 3 with respect to the 
<!-- EPO <DP n="70"/>-->
moving body can be correctly determined by using the velocity vector when the moving body starts to move. </p><p id="p0347" num="0347"> [0150] </p><p id="p0348" num="0348"> In addition, in the first position calculation system 2A, the inertial navigation operation results (the absolute coordinate position, the absolute coordinate velocity vector, and the absolute attitude angle) of the first inertial navigation system 4A are corrected by the correction section 90. The correction section 90 estimates an inertial navigation operation error by performing a predetermined error estimation operation using the mounting attitude of the first inertial navigation system 4A determined by the mounting attitude determination section 10, the velocity constraint condition at the time of stop (first constraint condition) or the velocity constraint condition at the time of movement (second constraint condition) set by the velocity constraint setting section 70, and the LV coordinate transformation matrix calculated by the LV coordinate transformation matrix calculation section 80. Then, the inertial navigation operation result is corrected using the estimated inertial navigation -operation error. In addition, also in the second position calculation system 2B, the inertial navigation operation results (the absolute coordinate position, the absolute coordinate 
<!-- EPO <DP n="71"/>-->
velocity vector, and the absolute attitude angle) of the second inertial navigation system 4B are similarly corrected by the correction section 90. </p><p id="p0349" num="0349"> [0151] </p><p id="p0350" num="0350"> Thus, by appropriately performing coordinate transformation between the two kinds of coordinate systems in consideration of the amount of shift between the local coordinate system and the moving body coordinate system using the mounting attitude of the sensor 3 determined using the first or second mounting attitude determination method and the movement vector (the acceleration vector or the velocity vector) measured by the sensor 3, the position of the moving body can be calculated more accurately. </p><p id="p0351" num="0351"> [0152] </p><p id="p0352" num="0352"> 4. Modifications </p><p id="p0353" num="0353"> Undoubtedly, examples to which the present invention can be applied are not limited to the above-described examples, and various modifications may be made without departing from the spirit and scope of the present invention. Hereinafter, modifications will be described, and the same components as in the above example are denoted by the same reference numerals and explanation thereof will be omitted. The following explanation will be focused on different parts from the above examples. 
<!-- EPO <DP n="72"/>-->
 [0153] </p><p id="p0354" num="0354"> 4-1. Travel direction switching correspondence logic In the above embodiment, calculating the position using the LV coordinate transformation matrix calculated when a moving body starts to move has been described. However, the moving body does not necessarily move only forward in the movement direction. For example, if the moving body is a four-wheeled vehicle, the four-wheeled vehicle may move backward without being limited to moving forward. </p><p id="p0355" num="0355"> [0154] </p><p id="p0356" num="0356"> Accordingly, performing calculation using the same LV coordinate transformation matrix before and after the movement direction change when the movement direction of a moving body switches between forward movement and backward movement is based on the assumption that the velocity or the position of the moving body is not appropriately calculated in that case. This is because the mounting attitude of the sensor 3 is determined using a movement vector with respect to the movement direction of the moving body when the moving body starts to move in the method of the present embodiment and accordingly, coherence between the mounting attitude and the movement direction is not satisfied if the movement direction of the moving body is reversed. 
<!-- EPO <DP n="73"/>-->
 [0155] </p><p id="p0357" num="0357"> In view of the above-described problem, it is preferable to apply the following movement direction switching correspondence logic. Specifically, it is determined whether or not the movement direction of a moving body has been reversed on the basis of a velocity vector of the moving body in the moving body coordinate system, for example. Then, when the movement direction of the moving body is reversed, an LV coordinate transformation matrix stored after being calculated at the start of movement is updated by rotation of 180° and calculation is performed using the updated LV coordinate transformation matrix. </p><p id="p0358" num="0358"> [0156] </p><p id="p0359" num="0359"> Fig. 16 is a flow chart showing the flow of second navigation processing executed by the car navigation apparatus 1000 of the example instead of the navigation processing in Fig. 12. </p><p id="p0360" num="0360"> [0157] </p><p id="p0361" num="0361"> In the second navigation processing, the processing unit 100 determines whether or not positive and negative signs of velocity components of the roll axis (R axis) of the moving body coordinate system have been reversed after step A19 or step A25 (step C25) . When the signs have not been reversed (step C25; No) , the processing unit 100 
<!-- EPO <DP n="74"/>-->
 determines that the movement direction of an automobile has not changed and proceeds to step A27. </p><p id="p0362" num="0362"> [0158] </p><p id="p0363" num="0363"> On the other hand, when the positive and negative signs have been reversed (step C25; Yes), the processing unit 100 determines that the movement direction of the automobile has changed and updates the coordinate transformation matrix data 560 by rotating the newest LV coordinate transformation matrix, which is stored in the coordinate transformation matrix data 560, by 180° (step C26) . Then, the processing unit 100 proceeds to step A27. </p><p id="p0364" num="0364"> [0159] </p><p id="p0365" num="0365"> Figs. 17 and 18 are experimental results showing the effectiveness of the above-described movement direction switching correspondence logic. Fig. 17 is an experimental result when the movement direction switching correspondence logic is not applied. In contrast, Fig. 18 is an experimental result when the movement direction switching correspondence logic is applied. The sensor 3 was mounted such that the front of a movement direction (forward direction) of an automobile and the x-axis ■positive direction of the sensor 3 matched each other. That is, the mounting attitude angle of the sensor 3 in this case is "0°" . </p><p id="p0366" num="0366"> [0160] 
<!-- EPO <DP n="75"/>-->
 The automobile was in a stop state during a period from time "tO" to "tl". Then, the automobile started to move backward at time "tl", and the automobile stopped for the moment at time "t2" and moved forward. In each drawing, the horizontal axis indicates a time axis, and the vertical axis indicates a roll axis velocity (unit is [m/s]) of an automobile and a mounting attitude angle</p><p id="p0367" num="0367">(unit is [°] ) of the sensor 3. In addition, a thick solid line indicates a determined mounting attitude angle of the sensor 3, and a thin solid line indicates a calculated roll axis velocity of an automobile. </p><p id="p0368" num="0368"> [0161] </p><p id="p0369" num="0369"> Referring to these drawings, the roll axis velocity is 0 from time "tO" to "tl". Then, when the automobile starts to move backward at time "tl", the roll axis velocity becomes a negative value and decreases gradually until time "t2" . </p><p id="p0370" num="0370"> [0162] </p><p id="p0371" num="0371"> Then, when the absolute value of the roll axis velocity exceeds a predetermined threshold value at time "t2", the mounting attitude determination activation condition is satisfied (step A13 in Fig. 16; Yes) . Accordingly, the mounting attitude of the sensor 3 is determined (step A15 in Fig. 16) . In this case, since the mounting attitude determination section 10 determines the 
<!-- EPO <DP n="76"/>-->
mounting attitude by recognizing the backward movement direction of the automobile as a movement direction of the automobile, the mounting attitude determination section 10 determines the mounting attitude to be "180°" although the actual mounting attitude angle of the sensor 3 is "0°". </p><p id="p0372" num="0372"> [0163] </p><p id="p0373" num="0373"> In this case, the LV coordinate transformation matrix is calculated using the mounting attitude angle of "180°" (step A17 in Fig. 16) and calculation using the LV coordinate transformation matrix is performed. For this reason, the roll axis velocity of the automobile is calculated as a positive value. Since the automobile moves backward, the actual roll axis velocity is a negative value. </p><p id="p0374" num="0374"> [0164] </p><p id="p0375" num="0375"> When the movement direction switching correspondence logic is not applied, the sign of the roll axis velocity is not changed as shown in Fig. 17 since calculation is performed in a state where the mounting attitude angle of the sensor 3 is recognized to be "180°" even if the automobile starts to move forward at time "t3". Accordingly, the roll axis velocity which is to be calculated as a positive value is calculated as a negative value, and the roll axis velocity increases in the negative direction as the automobile accelerates forward. 
<!-- EPO <DP n="77"/>-->
 [0165] </p><p id="p0376" num="0376"> In contrast, a case when the movement direction switching correspondence logic is applied is as shown in Fig. 18. When the start of forward movement of an automobile at time "t3" is detected (step C25 in Fig. 16; Yes), the LV coordinate transformation matrix calculated by setting the mounting attitude angle to "180°" is inverted to be updated (step C26. in Fig. 16). Then, calculation is performed using the inverted LV coordinate transformation matrix. Accordingly, the sign of the calculated roll axis velocity changes from negative to positive. Then, as the automobile accelerates forward, the roll axis velocity increases in the positive direction.<sup>"</sup> Thus, it is possible to respond to changes in the movement direction of a moving body appropriately by applying the movement direction switching correspondence logic. </p><p id="p0377" num="0377"> [0166] <sub>x</sub> </p><p id="p0378" num="0378"> 4-2. Correction method of a correction section </p><p id="p0379" num="0379"> In the above embodiment, the Kalman filter has been described as an example of a method of correcting an inertial navigation operation result, the correction method is not limited to this. For example, a velocity vector may be corrected by performing averaging processing of a constraint velocity vector, which is included in the velocity constraint condition set by the velocity 
<!-- EPO <DP n="78"/>-->
constraint setting section 70, and a velocity vector obtained by the inertial navigation operation. </p><p id="p0380" num="0380"> [0167] </p><p id="p0381" num="0381"> In addition, the velocity vector obtained by the inertial navigation operation may be corrected using the speed of a moving body measured by a speed detection system and the direction of the moving body measured by an azimuth sensor, such as a magnetic sensor. For example, regarding the magnitude of a velocity vector, it is also possible to perform averaging processing of the magnitude of the velocity vector obtained by the inertial navigation operation and the speed measured by the speed detection system. In addition, regarding the direction of a velocity vector, it is also possible to perform averaging processing of the direction of the velocity vector obtained by the inertial navigation operation and the direction of the moving body measured by the azimuth sensor. </p><p id="p0382" num="0382"> [0168] </p><p id="p0383" num="0383"> As the averaging processing, simple arithmetic averaging or geometric averaging may be applied or weighted averaging may be applied. If the inertial navigation operation result is trusted and the velocity vector is corrected, it is preferable to perform weighted averaging under the condition in which the weight of the 
<!-- EPO <DP n="79"/>-->
inertial navigation operation result is set to be higher than the weight of a measurement result of a speed detection system or an azimuth sensor. On the contrary, if a measurement result of a speed detection system or an azimuth sensor is trusted and the velocity vector is corrected, it is preferable to perform weighted averaging under the condition in which the weight of the inertial navigation operation result is set to be lower than the weight of the measurement result of the speed detection system or the azimuth sensor. In addition to these methods, any method may be applied as a correction method of a correction section. </p><p id="p0384" num="0384"> [0169] </p><p id="p0385" num="0385"> 4-3. Main component of processing </p><p id="p0386" num="0386"> In the example described above, the IMU 400 is mounted in an electronic apparatus, and a processing unit of the electronic apparatus performs inertial navigation operation processing on the basis of a measurement result of the IMU 400. However, it is also possible to mount an INS in an electronic apparatus and to perform inertial navigation operation processing by a processing unit of the INS. In this case, the processing unit of the electronic apparatus performs processing for estimating an error (inertial navigation operation error) included in an inertial navigation operation result output from the INS. 
<!-- EPO <DP n="80"/>-->
Then, an inertial navigation operation result input from the INS is corrected using the estimated inertial navigation operation error. </p><p id="p0387" num="0387"> [0170] </p><p id="p0388" num="0388"> In addition, it is also possible to mount a sensor unit, to which a satellite positioning system such as a GPS (Global Positioning System) is applied, in an electronic apparatus and to correct an inertial navigation operation result using a measurement result of this sensor unit. </p><p id="p0389" num="0389"> [0171] </p><p id="p0390" num="0390"> Fig. 19 is a view showing the configuration of an electronic apparatus in this case, and mainly shows a functional block related to the processing unit 100. In the electronic apparatus shown in Fig. 19, an INS 700 is mounted instead of the' IMU 400 in Fig. 11, and a GPS unit 800 is further mounted. In this case, since the processing unit 100 does not perform inertial navigation operation processing, the inertial navigation operation section 105 in Fig. 11 is removed. </p><p id="p0391" num="0391"> [0172] </p><p id="p0392" num="0392"> The mounting attitude determination section 110 determines the mounting attitude of the INS 700 using a local coordinate velocity vector input from the INS 700. The KF error estimation section 191 of the correction 
<!-- EPO <DP n="81"/>-->
section 190 estimates an inertial navigation operation error, which is included in the inertial navigation operation result of the INS 700, using not only the velocity constraint condition input from the velocity constraint setting section 170 but also measurement information input from the GPS unit 800 as observation information. </p><p id="p0393" num="0393"> [0173] </p><p id="p0394" num="0394"> The measurement information is various quantities related to a GPS satellite signal received from a GPS satellite. For example, various quantities called a carrier phase or a code phase, a Doppler frequency, a pseudo range, and a pseudo range change rate (range rate) of a GPS satellite signal are included in the measurement information.. In addition, since the method of estimating an inertial navigation operation error using the measurement information of a GPS as observation information is well known, explanation using Expressions and the like will be omitted. </p><p id="p0395" num="0395"> [0174] </p><p id="p0396" num="0396"> 4-4. Attitude determination timing-</p><p id="p0397" num="0397">In the above embodiment, . determining the mounting attitude of the sensor 3 whenever a moving body starts to move after the moving body stops has been described. However, the attitude determination timing may be 
<!-- EPO <DP n="82"/>-->
appropriately set. For example, it is also possible to determine the mounting attitude of the sensor 3 only at the first movement start timing of a moving body after the sensor 3 is mounted in the moving body. In this case, it is preferable that mounting attitude determination be not performed after the first time and processing be performed using the mounting attitude determined at the first time. </p><p id="p0398" num="0398"> [0175] </p><p id="p0399" num="0399"> 4-5. Component of attitude determination </p><p id="p0400" num="0400"> In the above embodiment, determining both the pitch component and the yaw component of the mounting attitude of the sensor 3 with respect to the moving body has been described. However, only one of the pitch component and the yaw component may be determined. </p><p id="p0401" num="0401"> [0176] </p><p id="p0402" num="0402"> 4-6. Error of installation shift </p><p id="p0403" num="0403"> The above embodiment is based on the assumption that the mounting attitude of the sensor 3 is not changed during movement. However, a change of the mounting attitude of the sensor 3 caused by vibration or the like during the movement, that is, installation shift may occur. Therefore, it is possible to estimate an error angle of installation shift by adding a component of an error angle caused by installation shift to the state vector of Expression (6) and to perform KF error estimation 
<!-- EPO <DP n="83"/>-->
processing (step B9) using an observation vector at the time of movement calculated by the KF error estimation section 191 in a state where the velocity constraint condition at the time of movement 523 is set to "ON". In this way, even if the mounting attitude of the sensor 3 change during movement, it becomes possible to correct the mounting attitude determined in the mounting attitude determination processing of step Al5 in Fig. 12 or Fig. 16 when necessary. </p><p id="p0404" num="0404"> [0177] </p><p id="p0405" num="0405"> 4-7. Modifications of mounting attitude determination processing </p><p id="p0406" num="0406"> In the mounting attitude determination described using Fig. 3 and the like, when there is a bias error in a local coordinate acceleration vector measured by the IMU 400, a case may be considered in which attitude determination cannot be correctly performed since a bias error is also included in the calculated AL coordinate transformation matrix. - Therefore, the following processing may be performed. </p><p id="p0407" num="0407"> [0178] </p><p id="p0408" num="0408"> That is, as shown in Fig. 20, in the functional block of the processing unit 100 shown in Fig. 11, the local coordinate acceleration vector and the local coordinate angular velocity measured by the IMU 400 are 
<!-- EPO <DP n="84"/>-->
input to the mounting attitude determination section 110. Then, the mounting attitude determination section 110 (processing unit 100) executes second mounting attitude determination processing shown in Fig. 21. </p><p id="p0409" num="0409"> [0179] </p><p id="p0410" num="0410"> In Fig. 21, the processing unit 100 determines whether or not an automobile is in a stop state (step Dl) . When the automobile is in a stop state, the processing unit 100 resets the local coordinate velocity vector to a zero vector (step D3), and acquires and updates the local coordinate angular velocity and the local coordinate acceleration vector measured by the IMU 400 as measurement data at the time of stop (step D5) . In this case, the local coordinate angular velocity is referred to as a local coordinate angular velocity at the time of stop Qs, and the local coordinate acceleration is referred to as local coordinate acceleration at the time of stop as. </p><p id="p0411" num="0411"> [0180] </p><p id="p0412" num="0412"> While the stop state continues, steps D3 to D5 are repeatedly performed. When it is determined that the stop is released and the automobile has started to move (step D7; YES), the processing unit 100 proceeds to the next processing. Here, the local coordinate angular velocity and the local coordinate acceleration measured by the IMU 400 during movement are denoted by reference numerals Ωπι 
<!-- EPO <DP n="85"/>-->
and am, respectively, for the following explanation. First, rotation information of the local coordinate is calculated (step D9) . Specifically, a time change (time differential) of the local coordinate angular velocity Om with respect to the local coordinate angular velocity at the time of stop Qs is integrated and added. This value indicates rotation of, the coordinate system itself with respect to the local coordinate system at the time of stop, that is, local coordinate rotation information. </p><p id="p0413" num="0413"> [0181] </p><p id="p0414" num="0414"> Then, the local coordinate acceleration vector at the time of stop as is converted into acceleration ams in the local coordinate system, which is measured by the IMU 400, by inverse transformation using the local coordinate rotation information calculated in step D9 (step Dll) . Then, by taking a difference between the local coordinate acceleration am measured by the IMU 400 and the converted acceleration ams, acceleration af at the corresponding point of time is calculated (step D13) . .The converted acceleration ams and the acceleration am in the<sup>'</sup> local coordinate system measured by the IMU 400 are acceleration on the same local coordinate system. In addition, even if there is a bias error in both the acceleration vectors, the bias error is offset as a result of the error calculation. In addition, the acceleration of gravity is 
<!-- EPO <DP n="86"/>-->
also offset. Therefore, the vector af related to the pure acceleration of the automobile itself in the local coordinate system which is measured by the IMU 400 is obtained. </p><p id="p0415" num="0415"> [0182] </p><p id="p0416" num="0416"> iThen, the local coordinate velocity vector is updated using the obtained acceleration vector af (step D15) . In the case of first updating, a velocity vector immediately after the start of movement in the local coordinate system at the time of stop is obtained ' since the local coordinate velocity vector reset in step D3 is updated for the first time. Then, processing of steps D9 to D15 is repeated until- the mounting attitude determination timing (step D17).. The mounting attitude determination timing is preferably determined on the basis of whether or not the mounting attitude determination activation condition in step A13 of Fig. 12 is satisfied. At the attitude determination timing, the mounting attitude is determined on the basis of the newest local coordinate velocity vector using the above-described Expressions (2) and (3) (step D19) . </p><p id="p0417" num="0417"> [0183] </p><p id="p0418" num="0418"> The second mounting attitude determination processing described above is preferably executed in parallel during the execution of navigation processing. 
<!-- EPO <DP n="87"/>-->
For example, a step of starting the execution of the second mounting attitude determination processing is added between steps A3 and A5 of Fig. 12 or Fig. 16. In this case, since the second mounting attitude determination processing becomes processing which replaces the mounting attitude determination processing executed in step A15 of Fig. 12 or Fig. 16, the mounting attitude determination processing may not be performed in step A15. </p><p id="p0419" num="0419"> [0184] </p><p id="p0420" num="0420"> In addition, tests to check the effect of the second mounting attitude determination processing were performed. A determination result of the known mounting attitude determination processing and a determination result of the second mounting attitude determination processing when bias errors were caused in the x and z axes of the local coordinate system were compared with each other. In the first test in which a bias error of +1 [mG] was caused in the x axis and a bias error of -1 [mG] was caused in the z axis, an error of the yaw angle was -3.40 [deg] and an error of the pitch angle was +5.53 [deg] in the known mounting attitude determination processing. On the other hand, in the second mounting attitude determination processing, an error of the yaw angle was +0.06 [deg] and an error of the pitch angle was -0.01 [deg]. Moreover, in the second test in which a bias error of +100 [mG] was 
<!-- EPO <DP n="88"/>-->
caused in the x axis and a bias error of -100 [mG] was caused in the z axis, an error of the yaw angle was +74.26 [deg] and an error of the pitch angle was -34.30 [deg] in the known mounting attitude determination processing. On the other hand, in the second mounting attitude determination processing, an error of the yaw angle was +0.05 [deg] and an error of the pitch angle was +0.00 [deg] . </p><p id="p0421" num="0421"> [0185] </p><p id="p0422" num="0422"> 4-8. Moving body </p><p id="p0423" num="0423"> The present invention can be applied to various kinds of moving bodies. A preferable application example is a four-wheeled vehicle. However, if constraints on the movement direction that vertical or horizontal movement is not performed at the time of movement can be imposed, the present invention may also be applied to moving bodies involving two-wheeled vehicles or bicycles, trains, ships, and human beings, for example. </p><p id="p0424" num="0424"> [0186] </p><p id="p0425" num="0425"> 4-9. Electronic apparatus </p><p id="p0426" num="0426"> In the above example, the case where the present invention is applied to the car navigation apparatus has been described as an example. However, electronic apparatuses to which the present invention can be applied are not limited to this. For example, the present 
<!-- EPO <DP n="89"/>-->
invention may also be applied to other electronic apparatuses, such as portable navigation apparatuses (portable navigation) or mobile phones, personal computers, and PDAs . </p><p id="p0427" num="0427"> Reference Signs List </p><p id="p0428" num="0428"> [0187] </p><p id="p0429" num="0429"> 1A: first mounting attitude determination system IB: second mounting attitude determination system 2A: first position calculation system </p><p id="p0430" num="0430"> 2B: second position calculation system </p><p id="p0431" num="0431"> 3: sensor </p><p id="p0432" num="0432"> 3A: acceleration sensor </p><p id="p0433" num="0433"> 3B: attitude sensor </p><p id="p0434" num="0434"> 3C: gyro sensor </p><p id="p0435" num="0435"> 4A: first inertial navigation system </p><p id="p0436" num="0436"> 4B: second inertial navigation system </p><p id="p0437" num="0437"> 5: .local coordinate velocity vector calculation section </p><p id="p0438" num="0438"> 10 mounting attitude determination section </p><p id="p0439" num="0439"> ' 15: absolute attitude determination section </p><p id="p0440" num="0440"> 20: LA coordinate transformation matrix calculation section </p><p id="p0441" num="0441"> 30: absolute coordinate acceleration vector calculation section </p><p id="p0442" num="0442"> 40: absolute coordinate velocity vector calculation 
<!-- EPO <DP n="90"/>-->
section </p><p id="p0443" num="0443"> 50: absolute coordinate position calculation section</p><p id="p0444" num="0444">60: moving state determination section </p><p id="p0445" num="0445"> 70: velocity constraint setting section </p><p id="p0446" num="0446"> 80: LV coordinate transformation matrix calculation section </p><p id="p0447" num="0447"> 90: correction section 
</p></description><claims mxw-id="PCLM44852003" ref-ucid="WO-2012118232-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="91"/>-->Claims </claim-statement><claim id="clm-0001" num="1"><claim-text>[Claim 1] </claim-text><claim-text> An attitude determination method comprising: </claim-text><claim-text> a step of measuring a movement vector by a sensor which is mounted in a moving body and measures the movement vector; and </claim-text><claim-text> a step of determining an attitude of the sensor with respect to the moving body using the movement vector measured by the sensor when the moving body starts to move.</claim-text></claim><claim id="clm-0002" num="2"><claim-text>[Claim 2] </claim-text><claim-text> The attitude determination method according to claim 1, further comprising: </claim-text><claim-text> a step of compensating for a measurement result of the sensor using a first constraint condition regarding a velocity of the moving body when the moving body is in a stop state. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>[Claim 3] </claim-text><claim-text> The attitude determination method according to- claim 1 or 2, </claim-text><claim-text> wherein the step of determining the attitude is to determine at least one of a pitch component and a yaw component without determining a roll component of the attitude with respect to the moving body. </claim-text></claim><claim id="clm-0004" num="4"><claim-text>[Claim 4] <!-- EPO <DP n="92"/>--> The attitude determination method according to any one of claims 1 to 3, </claim-text><claim-text> wherein the step of measuring the movement vector is to measure a movement vector in an absolute coordinate system which describes a moving space of the moving body, and </claim-text><claim-text> the step of determining the attitude is to determine the attitude of the sensor using the movement vector and a direction of the sensor expressed in the absolute coordinate system. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>[Claim 5] </claim-text><claim-text> The attitude determination method according to any one of claims 1 to 3, </claim-text><claim-text> wherein the step of determining the attitude includes : </claim-text><claim-text> a step of calculating a velocity vector in a local coordinate system, which is a measurement coordinate system of the sensor, using a . movement vector measured by the sensor when the moving body is stopped and a movement vector measured when the moving body starts to move; and a step of determining the attitude of the sensor using the velocity vector. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>[Claim 6] </claim-text><claim-text> The attitude determination method according to any one of claims 1 to 5, <!-- EPO <DP n="93"/>--> wherein the step of determining the attitude is to determine the attitude using the movement vector when the stop of the moving body is released and the velocity or acceleration of the moving body reaches a predetermined threshold value. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>[Claim 7] </claim-text><claim-text> A position calculation method comprising: </claim-text><claim-text> a step of determining the attitude using the attitude determination method . according to any one of claims 1 to 6; and </claim-text><claim-text> a step of calculating a position of the moving body using the attitude and the movement vector. </claim-text></claim><claim id="clm-0008" num="8"><claim-text> [Claim 8] </claim-text><claim-text> The position calculation method according to claim 7, wherein the step of calculating the position includes : </claim-text><claim-text> a step of calculating an absolute coordinate position of the moving body in the absolute coordinate system using the movement vector; </claim-text><claim-text> a step of performing coordinate transformation of the absolute coordinate position to a moving body coordinate position based on the moving body using the attitude and a direction of the sensor expressed in the absolute coordinate system; and </claim-text><claim-text> a step of correcting the absolute coordinate <!-- EPO <DP n="94"/>--> position using the moving body coordinate position and a second constraint condition regarding a movement direction of the moving body. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>[Claim 9] </claim-text><claim-text> An attitude determination device that determines a attitude of a sensor, which is mounted in a moving body and measures a movement vector/ with respect to the moving body using the movement vector measured by the sensor when the moving body starts to move. </claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
