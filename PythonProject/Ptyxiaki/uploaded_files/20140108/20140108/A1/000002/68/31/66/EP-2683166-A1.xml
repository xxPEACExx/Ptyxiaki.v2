<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2683166-A1" country="EP" doc-number="2683166" kind="A1" date="20140108" family-id="46757537" file-reference-id="318296" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146585083" ucid="EP-2683166-A1"><document-id><country>EP</country><doc-number>2683166</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-11859802-A" is-representative="NO"><document-id mxw-id="PAPP154847275" load-source="docdb" format="epo"><country>EP</country><doc-number>11859802</doc-number><kind>A</kind><date>20110729</date><lang>JA</lang></document-id><document-id mxw-id="PAPP195456506" load-source="docdb" format="original"><country>EP</country><doc-number>11859802.8</doc-number><date>20110729</date><lang>JA</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140554600" ucid="JP-2011042514-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011042514</doc-number><kind>A</kind><date>20110228</date></document-id></priority-claim><priority-claim mxw-id="PPC140549802" ucid="JP-2011067419-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011067419</doc-number><kind>W</kind><date>20110729</date></document-id></priority-claim><priority-claim mxw-id="PPC140555508" ucid="JP-2011162414-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011162414</doc-number><kind>A</kind><date>20110725</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2090238708" load-source="docdb">G06T   3/40        20060101ALI20150226BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2090243580" load-source="docdb">H04N   9/07        20060101AFI20150226BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2092283590" load-source="docdb" scheme="CPC">G06T   3/4015      20130101 LI20150211BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989625406" load-source="docdb" scheme="CPC">H04N   9/735       20130101 FI20131114BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989648626" load-source="docdb" scheme="CPC">G02F   1/133514    20130101 LI20131122BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989648964" load-source="docdb" scheme="CPC">H04N   9/045       20130101 LI20130803BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132359882" lang="DE" load-source="patent-office">FARBBILDFORMUNGSVORRICHTUNG</invention-title><invention-title mxw-id="PT132359883" lang="EN" load-source="patent-office">COLOR IMAGING DEVICE</invention-title><invention-title mxw-id="PT132359884" lang="FR" load-source="patent-office">DISPOSITIF D'IMAGERIE COULEUR</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919511744" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>FUJIFILM CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR919507200" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>FUJIFILM CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR919016017" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Fujifilm Corporation</last-name><iid>100813527</iid><address><street>26-30, Nishiazabu 2-chome</street><city>Minato-ku Tokyo 106-8620</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919531910" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>TANAKA SEIJI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919515341" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>TANAKA, SEIJI</last-name></addressbook></inventor><inventor mxw-id="PPAR919019764" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>TANAKA, SEIJI</last-name><address><street>c/o FUJIFILM Corporation 1-324 Uetake-cho Kita-ku</street><city>Saitama-shi Saitama 331-9624</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919017404" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Klunker . Schmitt-Nilson . Hirsch</last-name><iid>100060668</iid><address><street>Patentanwälte Destouchesstrasse 68</street><city>80796 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2011067419-W"><document-id><country>JP</country><doc-number>2011067419</doc-number><kind>W</kind><date>20110729</date><lang>JA</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012117583-A1"><document-id><country>WO</country><doc-number>2012117583</doc-number><kind>A1</kind><date>20120907</date><lang>JA</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549742253" load-source="docdb">AL</country><country mxw-id="DS549744063" load-source="docdb">AT</country><country mxw-id="DS549742254" load-source="docdb">BE</country><country mxw-id="DS549744502" load-source="docdb">BG</country><country mxw-id="DS549813968" load-source="docdb">CH</country><country mxw-id="DS549908408" load-source="docdb">CY</country><country mxw-id="DS549744064" load-source="docdb">CZ</country><country mxw-id="DS549742255" load-source="docdb">DE</country><country mxw-id="DS549908409" load-source="docdb">DK</country><country mxw-id="DS549908410" load-source="docdb">EE</country><country mxw-id="DS549815485" load-source="docdb">ES</country><country mxw-id="DS549744503" load-source="docdb">FI</country><country mxw-id="DS549813969" load-source="docdb">FR</country><country mxw-id="DS549742256" load-source="docdb">GB</country><country mxw-id="DS549908411" load-source="docdb">GR</country><country mxw-id="DS549742261" load-source="docdb">HR</country><country mxw-id="DS549744073" load-source="docdb">HU</country><country mxw-id="DS549815490" load-source="docdb">IE</country><country mxw-id="DS549908412" load-source="docdb">IS</country><country mxw-id="DS549813974" load-source="docdb">IT</country><country mxw-id="DS549908413" load-source="docdb">LI</country><country mxw-id="DS549744504" load-source="docdb">LT</country><country mxw-id="DS549818306" load-source="docdb">LU</country><country mxw-id="DS549744509" load-source="docdb">LV</country><country mxw-id="DS549744510" load-source="docdb">MC</country><country mxw-id="DS549818307" load-source="docdb">MK</country><country mxw-id="DS549818308" load-source="docdb">MT</country><country mxw-id="DS549818309" load-source="docdb">NL</country><country mxw-id="DS549813975" load-source="docdb">NO</country><country mxw-id="DS549818314" load-source="docdb">PL</country><country mxw-id="DS549815491" load-source="docdb">PT</country><country mxw-id="DS549815964" load-source="docdb">RO</country><country mxw-id="DS549815492" load-source="docdb">RS</country><country mxw-id="DS549818315" load-source="docdb">SE</country><country mxw-id="DS549742262" load-source="docdb">SI</country><country mxw-id="DS549813976" load-source="docdb">SK</country><country mxw-id="DS549813977" load-source="docdb">SM</country><country mxw-id="DS549908414" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128673255" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A single-plate color imaging element including color filters having a color filter array where the color filters of all RGB colors are periodically arranged in each line in the horizontal and vertical directions is used. Weighted average filters including filter coefficients with equal proportions of sums of the filter coefficients of each color in the lines in the horizontal and vertical directions are used to calculate weighted average values of each color of the pixel values of the pixels in a mosaic image output from the color imaging element. In the calculation of the pixel value of another color at the pixel position of a target pixel of synchronization processing at a center section of the weighted average filters, the pixel value of the target pixel is interpolated based on a color ratio or a color difference of the calculated weighted average values to estimate the pixel value of the another color.<img id="iaf01" file="imgaf001.tif" wi="102" he="89" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128737406" lang="EN" source="EPO" load-source="docdb"><p>A single-plate color imaging element including color filters having a color filter array where the color filters of all RGB colors are periodically arranged in each line in the horizontal and vertical directions is used. Weighted average filters including filter coefficients with equal proportions of sums of the filter coefficients of each color in the lines in the horizontal and vertical directions are used to calculate weighted average values of each color of the pixel values of the pixels in a mosaic image output from the color imaging element. In the calculation of the pixel value of another color at the pixel position of a target pixel of synchronization processing at a center section of the weighted average filters, the pixel value of the target pixel is interpolated based on a color ratio or a color difference of the calculated weighted average values to estimate the pixel value of the another color.</p></abstract><description mxw-id="PDES63959243" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">{Technical Field}</heading><p id="p0001" num="0001">The present invention relates to a color imaging apparatus, and particularly, to a color imaging apparatus that can suppress generation of color moire.</p><heading id="h0002">{Background Art}</heading><p id="p0002" num="0002">In a color imaging apparatus including a single-plate color imaging element, an output image from the color imaging element is a RAW image (mosaic image). Therefore, a multi-channel image is obtained by a process of interpolating a pixel of a missing color from a surrounding pixel (synchronization processing). In this case, there is a problem in reproduction characteristics of a high-frequency image signal.</p><p id="p0003" num="0003">A primary-color Bayer array as a color array most widely used in the single-plate color imaging element includes green (G) pixels arranged in a check pattern and red (R) and blue (B) arranged line-sequentially. Therefore, there is a problem of low-frequency coloring (color moire) caused by folding of high frequency signals exceeding reproduction bands of the colors and caused by deviation of phases of the colors.</p><p id="p0004" num="0004">For example, a black and white vertical-striped pattern (high frequency image) as shown in <figref idrefs="f0007">Figure 10(A)</figref> enters an imaging element in a Bayer array shown in <figref idrefs="f0007">Figure 10(B)</figref>, and the pattern is sorted into Bayer color arrays to compare the colors. As shown in <figref idrefs="f0007">Figures 10(C) to 10(F)</figref>, R forms a light and flat color image, B forms a dark and flat color image, and G forms a light and dark mosaic color image. Although there is no density difference (level difference) between RGB with respect to the original black and white image, the image is colored depending on the color array and the input frequency.</p><p id="p0005" num="0005">In the color imaging apparatus using the single-plate color imaging element, an optical low-pass filter formed by an anisotropic substance such as crystal is generally arranged on the front side of the color imaging element to prevent optically reducing the<!-- EPO <DP n="2"> --> high frequency wave. However, although the coloring caused by folding of the high frequency signal can be reduced in the method, there is a problem that the resolution is reduced accordingly.</p><p id="p0006" num="0006">To solve the problem, a color imaging element is proposed, wherein a color filter array of the color imaging element is a three-color random array satisfying array restrictions in which an arbitrary target pixel is adjacent to three colors including the color of the target pixel on four sides of the target pixel (PTL 1).</p><p id="p0007" num="0007">An image sensor of a color filter array is also proposed, wherein the image sensor includes a plurality of filters with different spectral sensitivity, and first and second filters among the plurality of filters are alternately arranged in a first predetermined period in one of the diagonal directions of a pixel grid of the image sensor and are alternately arranged in a second predetermined period in the other diagonal direction (PTL 2).</p><p id="p0008" num="0008">Furthermore, an image apparatus including a color imaging element is also proposed, wherein R and B among the three primary colors of RGB are arranged every three pixels in horizontal and vertical directions, and G is arranged between R and B (PTL 3). In the color imaging element described in PTL 3, G pixels that most contribute to obtaining luminance signals are arranged much more than RB pixels, on the ground that the resolution of color difference signals can be lower than the resolution of the luminance signals. This can increase the resolution in the horizontal and vertical directions.</p><heading id="h0003">{Citation List}</heading><heading id="h0004">{Patent Literature}</heading><p id="p0009" num="0009"><ul><li>{PTL 1}<br/>
Japanese Patent Application Laid-Open No. <patcit id="pcit0001" dnum="JP2000308080A"><text>2000-308080</text></patcit></li><li>{PTL 2}<br/>
Japanese Patent Application Laid-Open No. <patcit id="pcit0002" dnum="JP2005136766A"><text>2005-136766</text></patcit></li><li>{PTL 3}<br/>
Japanese Patent Application Laid-Open No. <patcit id="pcit0003" dnum="JP8023543A"><text>8-23543</text></patcit></li></ul></p><heading id="h0005">{Summary of Invention}</heading><!-- EPO <DP n="3"> --><heading id="h0006">{Technical Problem}</heading><p id="p0010" num="0010">The three-color random array described in PTL 1 is effective for low-frequency color moire, but is not effective for a false color of a high frequency section.</p><p id="p0011" num="0011">Meanwhile, in the color filter array of the image sensor described in PTL 2, the R, G, and B filters are periodically arranged in the lines in the horizontal and vertical directions of the color filter array. In synchronization processing of a mosaic image output from the image sensor including the color filter array in the invention described in PTL 2, a local area in a predetermined image size is extracted around the target pixel, statistics related to a color distribution shape of the color of the target pixel in the local area and a color distribution shape of another color to be estimated are calculated, and the color distribution shapes are linearly regressed based on the intensity of the colors at the target pixel position and the statistics of the color distribution shapes to thereby calculate an estimation value of the another color at the target pixel position. The calculation of the statistics (covariance values) related to the color distribution shapes and the regression calculation process are necessary in the invention described in PTL 2, and there is a problem that the image processing is complicated.</p><p id="p0012" num="0012">The color imaging element described in PTL 3 includes lines with only G pixels in the horizontal or vertical direction. Therefore, the color imaging element is not effective for the false color of a high frequency section in the horizontal or vertical direction.</p><p id="p0013" num="0013">The present invention has been made in view of the circumstances, and an object of the present invention is to provide a color imaging apparatus that can suppress generation of a false color of a high frequency section by simple image processing.</p><heading id="h0007">{Solution to Problem}</heading><p id="p0014" num="0014">To attain the object, an invention according to an aspect of the present invention includes a color imaging apparatus including: a single-plate color imaging element including color filters arranged on a plurality of pixels formed by photoelectric conversion elements arranged in horizontal and vertical directions, the color filters having a color filter array where all colors are periodically arranged in each line in the horizontal and vertical directions; an image acquisition unit that acquires a mosaic image from the color imaging element; weighted average filters with predetermined<!-- EPO <DP n="4"> --> filter coefficients, wherein a relationship between the colors of the pixels and the filter coefficients in a local area extracted from the mosaic image corresponding to the weighted average filters is set so that proportions of sums of the filter coefficients of each color in the lines in the horizontal and vertical directions are equal; a weighted average calculation unit that calculates weighted average values of each color based on the filter coefficients of the weighted average filters and pixel values of the pixels in the local area extracted from the mosaic image corresponding to the weighted average filters; a synchronization processing unit that calculates a pixel value of another color at a pixel position of a target pixel of synchronization processing at a center section of the weighted average filters and that interpolates a pixel value of the target pixel based on a color ratio or a color difference between the calculated weighted average values of the color and the another color of the target pixel to calculate the pixel value of the another color; and a control unit that repeatedly operates the weighted average calculation unit and the synchronization processing unit while shifting the local area extracted from the mosaic image corresponding to the weighted average filters by a target pixel unit of the synchronization processing.</p><p id="p0015" num="0015">According to the color imaging apparatus of the aspect of the present invention, the single-plate color imaging element including the color filters of all colors in the color filter array periodically arranged in the lines in the horizontal and vertical directions is used. Therefore, the filter coefficients for the colors of the pixels in the local area extracted from the mosaic image corresponding to the weighted average filters can be set so that the proportions of the sums of the filter coefficients of each color in the lines in the horizontal and vertical directions are equal.</p><p id="p0016" num="0016">The proportions of the sums of each color are equal in any line in the horizontal and vertical directions in the filter coefficients of the weighted average filters. Therefore, regardless of the type of the frequency input in the horizontal and vertical directions, the relationship between the colors as a result of the application of the filter coefficients is not fluctuated, and coloring due to folding of the high frequency wave does not occur. More specifically, the weighted average values of each color calculated based on the filter coefficients of the weighted average filters and the pixel values of the pixels in the local area extracted from the mosaic image corresponding to the weighted average filters indicate accurate colors in the local area regardless of the<!-- EPO <DP n="5"> --> type of the frequency input in the horizontal and vertical directions in the local area. Therefore, in the calculation of the pixel value of another color at the pixel position of a target pixel of synchronization processing at a center section of the weighted average filters, the pixel value of the target pixel can be interpolated based on a color ratio or a color difference of the calculated weighted average values to accurately estimate the pixel value of the another color.</p><p id="p0017" num="0017">In the color imaging apparatus according to another aspect of the present invention, the color filter array of the color imaging element includes a basic array pattern including first filters corresponding to a first color that most contributes to obtaining luminance signals and second filters corresponding to two or more second colors other than the first color, the basic array pattern is repeatedly arranged in the horizontal and vertical directions, and a proportion of the number of pixels of the first color corresponding to the first filters and proportions of the numbers of pixels of each color of the second colors corresponding to the second filters are different. More specifically, even if the proportion of the number of pixels of the first color corresponding to the first filter and the proportions of the numbers of pixels of each color of the second colors corresponding to the second filters are different, the proportions of the sums of the filter coefficients of each color are equal in any line in the horizontal and vertical directions in the filter coefficients of the weighted average filters. Therefore, the relationship between the colors as a result of the application of the filter coefficients is not fluctuated, and coloring due to folding of the high frequency wave does not occur.</p><p id="p0018" num="0018">Preferably, in the color imaging apparatus according to another aspect of the present invention, the proportion of the number of pixels of the first color corresponding to the first filters is greater than the proportions of the numbers of pixels of each color of the second colors corresponding to the second filters. The proportion of the number of pixels of the first color that most contributes to obtaining the luminance signals is greater than the proportions of the numbers of pixels of each color of the second colors corresponding to the second filters. Therefore, aliasing can be suppressed, and high frequency wave reproducibility is excellent.</p><p id="p0019" num="0019">Preferably, in the color imaging apparatus according to another aspect of the present invention, the weighted average filters are filters weighted to increase the filter<!-- EPO <DP n="6"> --> coefficients at the center section. As a result, the colors at the pixel positions of the target pixels of the synchronization processing can be accurately obtained.</p><p id="p0020" num="0020">Preferably, in the color imaging apparatus according to another aspect of the present invention, the weighted average filters have the filter coefficients that are horizontally symmetric, vertically symmetric, and point symmetric. As a result, in the calculation of the weighted averages of each color by extracting the local area from the mosaic image, the same weighted average filters can be used even if the extracted local area is shifted.</p><p id="p0021" num="0021">In the color imaging apparatus according to another aspect of the present invention, the color filters include R filters, G filters, and B filters corresponding to colors of red (R), green (G), and blue (B) arranged in a predetermined color filter array, wherein when the weighted average values of each color of the pixel values of R, G, and B pixels corresponding to the R filters, the G filters, and the B filters calculated by the weighted average calculation unit are Rf, Gf, and Bf, respectively, if the target pixel of the synchronization processing is a G pixel, and the pixel value is G, the synchronization processing unit calculates pixel values R and B of the R and B pixels at the position of the target pixel by the following formulas <maths id="math0001" num=""><math display="block"><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>×</mo><mfenced separators=""><mi>Rf</mi><mo>/</mo><mi>Gf</mi></mfenced><mspace width="1em"/><mi>and B</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>×</mo><mfenced separators=""><mi>Bf</mi><mo>/</mo><mi>Gf</mi></mfenced><mo>,</mo></math><img id="ib0001" file="imgb0001.tif" wi="64" he="8" img-content="math" img-format="tif"/></maths> wherein<br/>
if the target pixel of the synchronization processing is an R pixel, and the pixel value is R, the synchronization processing unit calculates pixel values G and B of the G and B pixels at the position of the target pixel by the following formulas <maths id="math0002" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>×</mo><mfenced separators=""><mi>Gf</mi><mo>/</mo><mi>Rf</mi></mfenced><mspace width="1em"/><mi>and B</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>×</mo><mfenced separators=""><mi>Bf</mi><mo>/</mo><mi>Rf</mi></mfenced><mo>,</mo></math><img id="ib0002" file="imgb0002.tif" wi="63" he="8" img-content="math" img-format="tif"/></maths> wherein<br/>
if the target pixel of the synchronization processing is a B pixel, and the pixel value is B, the synchronization processing unit calculates pixel values G and R of the G and R pixels at the position of the target pixel by the following formulas <maths id="math0003" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>×</mo><mfenced separators=""><mi>Gf</mi><mo>/</mo><mi>Bf</mi></mfenced><mspace width="1em"/><mi>and R</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>×</mo><mfenced separators=""><mi>Rf</mi><mo>/</mo><mi>Bf</mi></mfenced><mn>.</mn></math><img id="ib0003" file="imgb0003.tif" wi="66" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0022" num="0022">The ratio of the weighted average values (Rf, Gf, Bf) of each color in the local area indicates the ratio (color ratio) of RGB of the original colors at the pixel position of the target pixel in the local area. The pixel value at the position of the target pixel can be interpolated based on the color ratio to accurately estimate the pixel value of another color.<!-- EPO <DP n="7"> --></p><p id="p0023" num="0023">In the color imaging apparatus according to another aspect of the present invention, the color filters include R filters, G filters, and B filters corresponding to colors of red (R), green (G), and blue (B) arranged in a predetermined color filter array, wherein when the weighted average values of each color of the pixel values of R, G, and B pixels corresponding to the R filters, the G filters, and the B filters calculated by the weighted average calculation unit are Rf, Gf, and Bf, respectively, if the target pixel of the synchronization processing is a G pixel, and the pixel value is G, the synchronization processing unit calculates pixel values R and B of the R and B pixels at the position of the target pixel by the following formulas <maths id="math0004" num=""><math display="block"><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>+</mo><mfenced separators=""><mi mathvariant="normal">R</mi><mo>⁢</mo><mi mathvariant="normal">f</mi><mo>-</mo><mi mathvariant="normal">G</mi><mo>⁢</mo><mi mathvariant="normal">f</mi></mfenced><mo>⁢</mo><mtext mathvariant="normal"> </mtext><mtext mathvariant="normal"> </mtext><mi mathvariant="normal">a</mi><mo>⁢</mo><mi mathvariant="normal">n</mi><mo>⁢</mo><mi mathvariant="normal">d</mi><mo>⁢</mo><mtext mathvariant="normal"> </mtext><mtext mathvariant="normal"> </mtext><mi mathvariant="normal">B</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>+</mo><mfenced separators=""><mi mathvariant="normal">B</mi><mo>⁢</mo><mi mathvariant="normal">f</mi><mo>-</mo><mi mathvariant="normal">G</mi><mo>⁢</mo><mi mathvariant="normal">f</mi></mfenced><mo>,</mo></math><img id="ib0004" file="imgb0004.tif" wi="64" he="9" img-content="math" img-format="tif"/></maths> wherein<br/>
if the target pixel of the synchronization processing is an R pixel, and the pixel value is R, the synchronization processing unit calculates pixel values G and B of the G and B pixels at the position of the target pixel by the following formulas <maths id="math0005" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>+</mo><mfenced separators=""><mi mathvariant="normal">G</mi><mo>⁢</mo><mi mathvariant="normal">f</mi><mo>-</mo><mi mathvariant="normal">R</mi><mo>⁢</mo><mi mathvariant="normal">f</mi></mfenced><mo>⁢</mo><mtext mathvariant="normal"> </mtext><mtext mathvariant="normal"> </mtext><mi mathvariant="normal">a</mi><mo>⁢</mo><mi mathvariant="normal">n</mi><mo>⁢</mo><mi mathvariant="normal">d</mi><mo>⁢</mo><mtext mathvariant="normal"> </mtext><mtext mathvariant="normal"> </mtext><mi mathvariant="normal">B</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>+</mo><mfenced separators=""><mi mathvariant="normal">B</mi><mo>⁢</mo><mi mathvariant="normal">f</mi><mo>-</mo><mi mathvariant="normal">R</mi><mo>⁢</mo><mi mathvariant="normal">f</mi></mfenced><mo>,</mo></math><img id="ib0005" file="imgb0005.tif" wi="64" he="9" img-content="math" img-format="tif"/></maths> wherein<br/>
if the target pixel of the synchronization processing is a B pixel, and the pixel value is B, the synchronization processing unit calculates pixel values G and R of the G and R pixels at the position of the target pixel by the following formulas <maths id="math0006" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>+</mo><mfenced separators=""><mi>Gf</mi><mo>-</mo><mi>Bf</mi></mfenced><mspace width="1em"/><mi>and R</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>+</mo><mfenced separators=""><mi>Rf</mi><mo>-</mo><mi>Bf</mi></mfenced><mn>.</mn></math><img id="ib0006" file="imgb0006.tif" wi="66" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0024" num="0024">The difference between the weighted average values (Rf, Gf, Bf) of each color in the local area indicates the difference (color difference) between RGB of the original colors at the pixel position of the target pixel in the local area. The pixel value at the position of the target pixel can be interpolated based on the color difference to accurately estimate the pixel value of another color.</p><p id="p0025" num="0025">In the color imaging apparatus according to another aspect of the present invention, the color filters include R filters, G filters, and B filters corresponding to colors of red (R), green (G), and blue (B) arranged in a predetermined color filter array, the filter array includes: a first array corresponding to 3×3 pixels, the first array including G filters arranged at a center and four corners, B filters vertically arranged across the G filter at the center, and R filters horizontally arranged across the G filter at the center; and a second array corresponding to 3×3 pixels, the second array including G filters arranged at a center and four corners, R filters vertically arranged across the G filter at the center, and B filters horizontally arranged across the G filter at the center,<!-- EPO <DP n="8"> --> wherein the first and second arrays are alternately arranged in the horizontal and vertical directions, the weight average filters have a kernel size of 9×9, and the control unit repeatedly operates the weighted average calculation unit and the synchronization processing unit while sequentially shifting the weighted average filter to set one of the first and second arrays at the center.</p><p id="p0026" num="0026">The first and second arrays include vertically and horizontally symmetric color filters, and just the R and B filters are switched between the first and second arrays. Therefore, in the processing while shifting the weighted average filters by 3×3 pixels, the proportions of the sums of the filter coefficients of each color in the lines in the horizontal and vertical directions can be equal without changing the filter coefficients of the weighted average filters.</p><heading id="h0008">{Advantageous Effects of Invention}</heading><p id="p0027" num="0027">According to the present invention, the filter coefficients for the colors of the pixels in the local area extracted from the mosaic image corresponding to the weighted average filters are set so that the proportions of the sums of the filter coefficients of each color in the lines in the horizontal and vertical directions are equal, and the weighted average values of each color are calculated based on the filter coefficients of the weighted average filters and the pixel values of the pixels in the local area extracted from the mosaic image corresponding to the weighted average filters. Therefore, the color ratio or the color difference of the weighted average values of each color in the local area indicates the color ratio or the color difference of the original colors at the pixel position of the target pixel of the local area. As a result, the pixel value of another color can be accurately estimated by interpolating the pixel value of the target pixel based on the color ratio or the color difference of the calculated weighted average values.</p><p id="p0028" num="0028">The color ratio or the color difference of the weighted average values of each color in the local area does not change regardless of the type of the frequency input in the horizontal and vertical directions in the local area. Therefore, false determination of color does not occur, and generation of a false color of a high frequency section can be suppressed. The pixel value of another color can be estimated by simple calculation of weighted average and interpolation.<!-- EPO <DP n="9"> --></p><heading id="h0009">{Brief Description of Drawings}</heading><p id="p0029" num="0029"><ul><li>{<figref idrefs="f0001">Figure 1} Figure 1</figref> is a block diagram showing embodiments of a color imaging apparatus according to the present invention.</li><li>{<figref idrefs="f0001">Figure 2} Figure 2</figref> is a diagram showing a color filter array of color filters arranged on the color imaging element of a first embodiment.</li><li>{<figref idrefs="f0002">Figure 3} Figure 3</figref> is a diagram showing a basic array pattern included in the color filter array of the color imaging element of the first embodiment.</li><li>{<figref idrefs="f0002">Figure 4} Figure 4</figref> is a diagram showing a state in which the basic array pattern of 6×6 pixels included in the color filter array of the color imaging element of the first embodiment is divided into A arrays and B arrays of 3×3 pixels, and the A arrays and the B arrays are arranged.</li><li>{<figref idrefs="f0003">Figure 5} Figure 5</figref> is a diagram showing weighted average filters applied to the color imaging element of the first embodiment.</li><li>{<figref idrefs="f0003">Figure 6A} Figures 6A</figref> is a diagram showing an image when a vertical-striped high frequency wave is input.</li><li>{<figref idrefs="f0004">Figure 6B} Figure 6B</figref> is a diagram used to explain that there is no color deviation in colors of weighted average values applied with the weighted average filters when a vertical-striped high frequency wave is input.</li><li>{<figref idrefs="f0004">Figure 7} Figure 7</figref> is a diagram showing a second embodiment of the color imaging element and the weighted average filters applied to the present invention.</li><li>{<figref idrefs="f0005">Figure 8} Figure 8</figref> is a diagram showing a third embodiment of the color imaging element applied to the present invention.</li><li>{<figref idrefs="f0005">Figure 9A} Figure 9A</figref> is a diagram showing a third embodiment of the weighted average filters applied to the color imaging element of the third embodiment.</li><li>{<figref idrefs="f0006">Figure 9B} Figure 9B</figref> is a diagram showing weighted average filters applied when a local area of 6×6 pixels shown in <figref idrefs="f0005">Figure 9A</figref> is moved by two pixels in the horizontal direction.</li><li>{<figref idrefs="f0007">Figure 10} Figure 10</figref> is a diagram used to explain a problem of a conventional color imaging element with color filters in a Bayer array.</li></ul></p><heading id="h0010">{Description of Embodiments}</heading><!-- EPO <DP n="10"> --><p id="p0030" num="0030">Hereinafter, preferred embodiments of a color imaging apparatus according to the present invention will be described in detail with reference to the attached drawings.</p><heading id="h0011">{Overall Configuration of Color Imaging Apparatus}</heading><p id="p0031" num="0031"><figref idrefs="f0001">Figure 1</figref> is a block diagram showing embodiments of the color imaging apparatus according to the present invention.</p><p id="p0032" num="0032">An imaging optical system 10 images a subject, and an optical image indicating a subject image is formed on a light receiving surface of a color imaging element 12 (color imaging element of a first embodiment).</p><p id="p0033" num="0033">The color imaging element 12 is a single-plate color imaging element including: a plurality of pixels (not shown) including photoelectric conversion elements arranged in horizontal and vertical directions (two-dimensional array); and color filters in a predetermined color filter array arranged on light receiving surfaces of the pixels. The color filter array of the color imaging element 12 is characterized by including the filters of all colors of red (R), green (G), and blue (B) periodically arranged in the lines in the horizontal and vertical directions. The details will be described later.</p><p id="p0034" num="0034">The photoelectric conversion elements convert the subject image formed on the color imaging element 12 to signal charges corresponding to amounts of incident light. The signal charges accumulated on the photoelectric conversion elements are sequentially read out from the color imaging element 12 as voltage signals (image signals) corresponding to the signal charges based on drive pulses provided from a drive unit 18 according to an instruction of a control unit 20. The image signals read out from the color imaging element 12 are R, G, and B signals indicating a mosaic image of R, G, and B corresponding to the color filter array of the color imaging element 12. The color imaging element 12 is not limited to a CCD (Charge Coupled Device) color imaging element and may be another type of imaging element such as a CMOS (Complementary Metal Oxide Semiconductor) imaging element.</p><p id="p0035" num="0035">The image signals read out from the color imaging element 12 are input to an image processing unit 14. The image processing unit 14 includes: a correlated double sampling circuit (CDS) that removes reset noise included in the image signals; an AGC circuit that amplifies the image signals and controls the size at a certain level; and an A/D converter. The image processing unit 14 applies a correlated double sampling process to the input image signals and amplifies the image signals, and then outputs<!-- EPO <DP n="11"> --> RAW data, which is formed by converting the image signals to digital image signals, to the image processing unit 16.</p><p id="p0036" num="0036">The image processing unit 16 includes a white balance correction circuit, a gamma correction circuit, a synchronization processing circuit according to the present invention (processing circuit that calculates (converts to synchronous system) all color information of RGB of the pixels from the mosaic image of RGB associated with the color filter array of the single-plate color imaging element 12), a luminance/color difference signal generation circuit, a contour correction circuit, a color correction circuit, and the like. According to an instruction from the control unit 20, the image processing unit 16 applies required signal processing to the RAW data of the mosaic image input from the image processing unit 14 to generate image data (YUV data) including luminance data (Y data) and color difference data (Cr, Cb data).</p><p id="p0037" num="0037">For still images, a compression/expansion processing circuit applies a compression process, which is compliant with a JPEG standard, to the image data generated by the image processing unit 16. For moving images, the compression/expansion processing circuit applies a compression process, which is compliant with an MPEG2 standard, to the image data. The image data is recorded in a recording medium (memory card) and is output and displayed on a display device (not shown) such as a liquid crystal monitor.</p><p id="p0038" num="0038">Details of the processing by the synchronization processing circuit according to the present invention in the image processing unit 16 will be described later.</p><heading id="h0012">&lt;Features of Color Filter Array&gt;</heading><p id="p0039" num="0039">The color filter array of the color imaging element 12 has the following features (1), (2), and (3).</p><heading id="h0013">{Feature (1)}</heading><p id="p0040" num="0040"><figref idrefs="f0001">Figure 2</figref> is a diagram showing the color filter array of the color filters arranged on the color imaging element 12. As shown in <figref idrefs="f0001">Figure 2</figref>, the color filter array of the color imaging element 12 includes a basic array pattern P (pattern indicated by a thick frame) formed by a square array pattern corresponding to 6×6 pixels, and the basic array pattern P is repeatedly arranged in the horizontal and vertical directions. Therefore, the color filter array includes filters of R, G, and B colors (R filters, G filters, and B filters) arranged in a predetermined cycle.<!-- EPO <DP n="12"> --></p><p id="p0041" num="0041">In this way, the R filters, the G filters, and the B filters are arranged in a predetermined cycle. Therefore, the synchronization processing and the like of the R, G, and B signals read out from the color imaging element 12 can be processed according to the repeated pattern.</p><heading id="h0014">{Feature (2)}</heading><p id="p0042" num="0042">In the color filter array shown in <figref idrefs="f0001">Figure 2</figref>, the filters of all colors of R, G, and B are arranged in the lines in the horizontal and vertical directions.</p><p id="p0043" num="0043"><figref idrefs="f0002">Figure 3</figref> shows a state in which the basic array pattern P shown in <figref idrefs="f0001">Figure 2</figref> is divided into four sets of 3×3 pixels.</p><p id="p0044" num="0044">As shown in <figref idrefs="f0002">Figure 3</figref>, the basic array pattern P can be perceived as a pattern including A arrays of 3×3 pixels surrounded by a frame of solid lines and B arrays of 3x3 pixels surrounded by a frame of broken lines alternately arranged in the horizontal and vertical directions as shown in <figref idrefs="f0002">Figure 4</figref>.</p><p id="p0045" num="0045">Each of the A and B arrays includes G filters as luminance pixels arranged at four corners and a center, and the G filters are arranged on both diagonals. In the A array, the R filters are arranged in the horizontal direction, and the B filters are arranged in the vertical direction, across the G filter at the center. Meanwhile, in the B array, the B filters are arranged in the horizontal direction, and the R filters are arranged in the vertical direction, across the G filter at the center. Therefore, although the positional relationship between the R and B filters is opposite in the A and B arrays, the rest of the arrangement is the same.</p><heading id="h0015">{Feature (3)}</heading><p id="p0046" num="0046">The basic array pattern of the color filter array shown in <figref idrefs="f0001">Figure 2</figref> is point symmetric with respect to the center (center of four G filters) of the basic array pattern. As shown in <figref idrefs="f0002">Figure 3</figref>, the A arrays and the B arrays in the basic array pattern are also point symmetric with respect to the G filters at the centers.</p><heading id="h0016">{Feature (4)}</heading><p id="p0047" num="0047">In the basic array pattern of the color filter array shown in <figref idrefs="f0001">Figure 2</figref>, the numbers of pixels of the R pixels, the G pixels, and the B pixels corresponding to the R, G, and B filters in the basic array pattern are eight pixels, twenty pixels, and eight pixels, respectively. More specifically, the ratio of the numbers of pixels of the RGB pixels is 2:5:2, and the proportion of the number of pixels of the G pixels that most contribute to<!-- EPO <DP n="13"> --> obtaining the luminance signals is greater than the proportions of the numbers of pixels of the R or B pixels of the other colors.</p><heading id="h0017">{Weighted Average Filters Used in Synchronization Processing Circuit of Image Processing Unit 16}</heading><p id="p0048" num="0048"><figref idrefs="f0003">Figure 5</figref> is a diagram showing an embodiment of weighted average filters used in the synchronization processing circuit of the image processing unit 16. <figref idrefs="f0003">Figure 5</figref> particularly shows filter coefficients of the weighted average filters.</p><p id="p0049" num="0049">As shown in <figref idrefs="f0003">Figure 5</figref>, the weighted average filters (weighted average filters of the first embodiment) have a kernel size of 9×9, and filter coefficients shown in <figref idrefs="f0003">Figure 5</figref> are set.</p><p id="p0050" num="0050">More specifically, for the filter coefficients of the weighted average filters, a local area of 9×9 pixels is extracted from the mosaic image obtained from the color imaging element 12 so that the A array is at the center. The filter coefficients of each color are extracted corresponding to the colors of the pixels in the local area, and the sums of the filter coefficients of each color are calculated. The filter coefficients are set so that the proportions of the sums of the filter coefficients of each color of RGB in the lines in the horizontal and vertical directions are equal (1:1:1).</p><p id="p0051" num="0051">For example, the filter coefficients of the uppermost row are 0, 2, 1, 1, 4, 1, 1, 2, and 0 in <figref idrefs="f0003">Figure 5</figref>. It can be recognized that the sums of the colors are R=4, G=0+1+1+1+1+0=4, and B=2+2=4, and the sums are in a relationship of 4:4:4=1:1:1. The relationship holds true for all rows and columns (lines in the horizontal and vertical directions) in the filter coefficients.</p><p id="p0052" num="0052">The filter coefficients are weighted in the weighted average filters so that when the filter coefficients are compared in each area divided into the size of 3×3, the filter coefficient of 3×3 at the center section is the largest, the vertical and horizontal filter coefficients of 3×3 across the center section are the next largest, and the filter coefficients of 3×3 at the four corners are the smallest.</p><p id="p0053" num="0053">The filter coefficients are set in the weighted average filters so that the filter coefficients are horizontally symmetric, vertically symmetric, and point symmetric.</p><p id="p0054" num="0054">When weighted average values of RGB are calculated based on the weighted average filters with the configuration described above and based on the pixel values of the pixels in the local area of 9×9 pixels extracted from the mosaic image, color<!-- EPO <DP n="14"> --> deviation does not occur in the colors based on the weighted average values of RGB regardless of the type of the frequency input in the horizontal and vertical directions, and coloring due to the folding of the high frequency wave does not occur.</p><p id="p0055" num="0055">For example, when a vertical-striped high frequency wave shown in <figref idrefs="f0003">figure 6A</figref> is input, the sums of the filter coefficients of each color are 32:32:32 (see <figref idrefs="f0004">Figure 6B</figref>), and it can be recognized from the color ratio that the image is black and white.</p><heading id="h0018">{Synchronization Processing by Synchronization Processing Circuit of Image Processing Unit 16}</heading><p id="p0056" num="0056">A method of applying synchronization processing to the mosaic image of RGB by the synchronization processing circuit of the image processing unit 16 will be described.</p><p id="p0057" num="0057">As shown in <figref idrefs="f0003">Figure 5</figref>, a local area of 9×9 pixels is extracted from the mosaic image obtained from the color imaging element 12 so that the A array is at the center. The weighted average values of each color of RGB are calculated based on the pixel values of the pixels in the local area and the filter coefficients of the weighted average filters. More specifically, the pixel values of the pixels in the local area are multiplied by the filter coefficients of the weighted average filters at the pixel positions. The results of multiplication are added color by color to calculate the sums of the colors, and the sums of the colors are further divided by 64 to calculate the weighted average values. The number 64 is a sum of the filter coefficients of RGB of the weighted average filters.</p><p id="p0058" num="0058">Proportions (color ratio) of the weighted average values of RGB are calculated from the calculated weighted average values of RGB. 3×3 pixels (pixels in a thick frame shown in <figref idrefs="f0003">Figure 5</figref>) at the center section in the local area of 9×9 pixels are set as target pixels of the synchronization processing, and the pixel values at the pixel positions of the target pixels are interpolated by the calculated color ratio to calculate the pixel values of the other values at the pixel positions.</p><p id="p0059" num="0059">Specifically, when the calculated weighted average values of each color of RGB are Rf, Gf, and Bf, the target pixel of the synchronization processing is a G pixel, and the pixel value is G, pixel values R and B at the position of the target pixel are calculated by the following formulas. <maths id="math0007" num="(1)"><math display="block"><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>×</mo><mfenced separators=""><mi>Rf</mi><mo>/</mo><mi>Gf</mi></mfenced><mo>,</mo><mspace width="1em"/><mi mathvariant="normal">B</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>×</mo><mfenced separators=""><mi>Bf</mi><mo>/</mo><mi>Gf</mi></mfenced></math><img id="ib0007" file="imgb0007.tif" wi="87" he="10" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="15"> --></p><p id="p0060" num="0060">Similarly, when the target value of the synchronization processing is an R pixel, and the pixel value is R, pixel values G and B of the G and B pixels at the position of the target pixel are calculated by the following formulas. <maths id="math0008" num="(2)"><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>×</mo><mfenced separators=""><mi>Gf</mi><mo>/</mo><mi>Rf</mi></mfenced><mo>,</mo><mspace width="1em"/><mi mathvariant="normal">B</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>×</mo><mfenced separators=""><mi>Bf</mi><mo>/</mo><mi>Rf</mi></mfenced></math><img id="ib0008" file="imgb0008.tif" wi="89" he="9" img-content="math" img-format="tif"/></maths></p><p id="p0061" num="0061">When the target pixel of the synchronization processing is a B pixel, and the pixel value is B, pixel values G and R of the G and R pixels at the position of the target pixel are calculated by the following formulas. <maths id="math0009" num="(3)"><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>×</mo><mfenced separators=""><mi>Gf</mi><mo>/</mo><mi>Bf</mi></mfenced><mo>,</mo><mspace width="1em"/><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>×</mo><mfenced separators=""><mi>Rf</mi><mo>/</mo><mi>Bf</mi></mfenced></math><img id="ib0009" file="imgb0009.tif" wi="87" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0062" num="0062">When the synchronization processing for calculating the pixel values of RGB is finished for all pixels of 3×3 pixels at the center section in the local area of 9×9 pixels, the same process is applied while shifting the local area extracted from the mosaic image by 3×3 pixels.</p><p id="p0063" num="0063">If the local area of 9×9 pixels is shifted by three pixels in the horizontal or vertical direction from the state shown in <figref idrefs="f0003">Figure 5</figref>, the B array of 3×3 pixels is positioned at the center section of the local area of 9×9 pixels after the shift (see <figref idrefs="f0002">Figure 4</figref>). As described, the arrangements of the G filters are the same in the A and B arrays, and only the positions of the R and B filters are different. Meanwhile, the same values are allocated to the filter coefficients at the positions corresponding to the R filters and at the positions corresponding to the B filters in the weighted average filters. Therefore, the same weighted average filters can be used when the synchronization processing is executed while shifting the local area.</p><p id="p0064" num="0064">The filter coefficients are set so that the proportions of the sums of the filter coefficients of each color of RGB in the lines in the horizontal and vertical directions are equal. Therefore, if the weighted average values of RGB are calculated based on the weighted average filters when the weighted average filters are applied to the mosaic image of RGB obtained from the color imaging element 12, the colors of the local area based on the weighted average values of RGB can be accurately indicated regardless of the type of the frequency input in the horizontal and vertical directions. The synchronization processing is executed based on the colors from the weighted average values of RGB, and the generation of the false color can be controlled. As a result, it is possible not to arrange an optical low-pass filter for controlling the generation of the false color on an optical path from a plane of incident to an imaging plane of the optical<!-- EPO <DP n="16"> --> system. Even if the optical low-pass filter is applied, a filter with less effect of cutting high frequency components for preventing the generation of the false color can be applied, and a loss of resolution can be prevented.</p><p id="p0065" num="0065">In the embodiment, the pixel value at the pixel position of the target pixel is interpolated based on the color ratio of the weighted average values of RGB to calculate the pixel values of the other colors at the target position. However, the arrangement is not limited to this, and the pixel value of the target pixel can be interpolated based on the color difference between the weighted average values of RGB to calculate the pixel values of the other colors.</p><p id="p0066" num="0066">Specifically, when the weighted average values of each color of RGB are Rf, Gf, and Bf, the target pixel of the synchronization processing is a G pixel, and the pixel value is G, pixel values R and B at the position of the target pixel are calculated by the following formulas. <maths id="math0010" num="(4)"><math display="block"><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>+</mo><mfenced separators=""><mi>Rf</mi><mo>-</mo><mi>Gf</mi></mfenced><mo>,</mo><mspace width="1em"/><mi mathvariant="normal">B</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>+</mo><mfenced separators=""><mi>Bf</mi><mo>-</mo><mi>Gf</mi></mfenced></math><img id="ib0010" file="imgb0010.tif" wi="84" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0067" num="0067">Similarly, when the target pixel of the synchronization processing is an R pixel, and the pixel value is R, pixel values G and B of the G and B pixels at the position of the target pixel are calculated by the following formulas. <maths id="math0011" num="(5)"><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>+</mo><mfenced separators=""><mi>Gf</mi><mo>-</mo><mi>Rf</mi></mfenced><mo>,</mo><mspace width="1em"/><mi mathvariant="normal">B</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>+</mo><mfenced separators=""><mi>Bf</mi><mo>-</mo><mi>Rf</mi></mfenced></math><img id="ib0011" file="imgb0011.tif" wi="86" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0068" num="0068">When the target pixel of the synchronization processing is a B pixel, and the pixel value is B, pixel values G and R of the G and R pixels at the position of the target pixel are calculated by the following formulas. <maths id="math0012" num="(6)"><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>+</mo><mfenced separators=""><mi>Gf</mi><mo>-</mo><mi>Bf</mi></mfenced><mo>,</mo><mspace width="1em"/><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>+</mo><mfenced separators=""><mi>Rf</mi><mo>-</mo><mi>Bf</mi></mfenced></math><img id="ib0012" file="imgb0012.tif" wi="86" he="8" img-content="math" img-format="tif"/></maths></p><heading id="h0019">{Second Embodiment of Color Imaging Element and Weighted Average Filters}</heading><p id="p0069" num="0069"><figref idrefs="f0004">Figure 7</figref> is a diagram showing a second embodiment of the color imaging element and the weighted average filters applied to the present invention. <figref idrefs="f0004">Figure 7</figref> particularly shows a color filter array of the color filters arranged on the color imaging element and filter coefficients of the weighted average filters applied to the color filter array.</p><p id="p0070" num="0070">As shown in <figref idrefs="f0004">Figure 7</figref>, in the color filter array of the color imaging element of the second embodiment, a horizontal line includes RGBRGBRGB..., the next horizontal line includes GBRGBRGBR..., the next horizontal line includes BRGBRGBRG..., and this is repeated.<!-- EPO <DP n="17"> --></p><p id="p0071" num="0071">More specifically, the color filter array includes the filters of the colors of R, G, and B (R filters, G filters, and B filters) arranged in a predetermined cycle.</p><p id="p0072" num="0072">As shown in <figref idrefs="f0004">Figure 7</figref>, the color filter array includes the filters of all colors of R, G, and B arranged in the lines in the horizontal and vertical directions.</p><p id="p0073" num="0073">In this way, the color filter array of the color imaging element of the second embodiment includes the same features as the features (1) and (2) of the color filter array of the color imaging element 12 in the first embodiment.</p><p id="p0074" num="0074">Meanwhile, the weighted average filters of the second embodiment applied to the color imaging element have a kernel size of 6×6 as shown in a thick frame of <figref idrefs="f0004">Figure 7</figref>, and filter coefficients shown in <figref idrefs="f0004">Figure 7</figref> are set.</p><p id="p0075" num="0075">More specifically, for the filter coefficients of the weighted average filters of the second embodiment, a local area of 6×6 pixels is extracted from the mosaic image obtained from the color imaging element of the second embodiment. The filter coefficients of each color are extracted corresponding to the colors of the pixels in the local area, and the sums of the filter coefficients of each color are calculated. The filter coefficients are set so that the proportions of the sums of the filter coefficients of each color of RGB in the lines in the horizontal vertical directions are equal (1:1:1).</p><p id="p0076" num="0076">For example, the filter coefficients of the uppermost row are 0, 1, 2, 2, 1, and 0 in <figref idrefs="f0004">Figure 7</figref>. It can be recognized that the sums of the colors are R=0+2=2, G=1+1=2, and B=2+0=2, and the sums are in a relationship of 2:2:2=1:1:1. The relationship holds true for all rows and columns (lines in the horizontal and vertical directions) in the filter coefficients.</p><p id="p0077" num="0077">The filter coefficients are weighted in the weighted average filters so that when the filter coefficients are compared in each area divided into the size of 2×2, the filter coefficient of 2×2 at the center section is the largest, the vertical and horizontal filter coefficients of 2×2 across the center section are the next largest, and the filter coefficients of 2×2 at the four corners are the smallest.</p><p id="p0078" num="0078">The filter coefficients are set in the weighted average filters so that the filter coefficients are horizontally symmetric, vertically symmetric, and point symmetric.</p><p id="p0079" num="0079">When weighted average values of RGB are calculated based on the weighted average filters with the configuration described above and based on the pixel values of the pixels in the local area of 6×6 pixels extracted from the mosaic image, color<!-- EPO <DP n="18"> --> deviation does not occur in the colors based on the weighted average values of RGB regardless of the type of the frequency input in the horizontal and vertical directions, and coloring due to the folding of the high frequency wave does not occur.</p><p id="p0080" num="0080">As in the first embodiment, the weighted average values of RGB are calculated based on the pixel values of the pixels in the local area of 6×6 pixels extracted from the mosaic image and the filter coefficients of the weighted average filters. The pixel values of the target pixels of 2×2 pixels at the center section in the local area of 6×6 pixels can be interpolated based on the color ratio or the color difference between the calculated weighted average values of RGB to calculate the pixel values of the other colors.</p><p id="p0081" num="0081">When the synchronization processing for calculating the pixel values of RGB is finished for all pixels of 2×2 pixels at the center section in the local area of 6×6 pixels, the same process is applied while shifting the local area extracted from the mosaic image by two pixels in the horizontal or vertical direction. In this case, the same weighted average filters can be used.</p><heading id="h0020">{Third Embodiment of Color Imaging Element and Weighted Average Filters}</heading><p id="p0082" num="0082"><figref idrefs="f0005">Figure 8</figref> is a diagram showing a third embodiment of the color imaging element applied to the present invention. <figref idrefs="f0005">Figure 8</figref> particularly shows a color filter array of the color filters arranged on the color imaging element.</p><p id="p0083" num="0083"><figref idrefs="f0005 f0006">Figure 9</figref> shows filer coefficients of weighted average filters applied to the color imaging element.</p><p id="p0084" num="0084">As shown in <figref idrefs="f0005">Figure 8</figref>, the color filter array of the color imaging element of the third embodiment includes a basic array pattern (pattern indicated by a thick frame) formed by a square array pattern corresponding to 4×4 pixels, and the basic array pattern is repeatedly arranged in the horizontal and vertical directions. Therefore, the color filter array includes filters of R, G, and B colors (R filters, G filters, and B filters) arranged in a predetermined cycle.</p><p id="p0085" num="0085">The color filter array includes the filters of all colors of R, G, and B arranged in the lines of the horizontal and vertical directions.</p><p id="p0086" num="0086">The basic array pattern of the color filter array is point symmetric with respect to the center of the basic array pattern.<!-- EPO <DP n="19"> --></p><p id="p0087" num="0087">Furthermore, in the basic array pattern of the color filter array shown in <figref idrefs="f0005">Figure 8</figref>, the numbers of pixels of the R pixels, the G pixels, and the B pixels corresponding to the R, G, and B filters in the basic array pattern are four pixels, eight pixels, and four pixels, respectively. More specifically, the ratio of the numbers of pixels of the RGB pixels is 1:2:1, and the proportion of the number of pixels of the G pixels that most contribute to obtaining the luminance signals is greater than the proportions of the numbers of pixels of the R or B pixels of the other colors.</p><p id="p0088" num="0088">In this way, the color filter array of the color imaging element of the third embodiment has the same features as the features (1), (2), (3), and (4) of the color filter array of the color imaging element 12 of the first embodiment.</p><p id="p0089" num="0089">Meanwhile, the weighted average filters of the third embodiment applied to the color imaging element has the kernel size of 6×6 as shown by thick frames of <figref idrefs="f0005">Figures 9A</figref> and <figref idrefs="f0006">9B</figref>, and filter coefficients shown in <figref idrefs="f0005">Figures 9A</figref> and <figref idrefs="f0006">9B</figref> are set.</p><p id="p0090" num="0090">More specifically, for the filter coefficients of the weighted average filters of the third embodiment, a local area of 6×6 pixels is extracted from the mosaic image obtained from the color imaging element of the third embodiment. The filter coefficients of each color are extracted corresponding to the colors of the pixels in the local area, and the sums of the filter coefficients of each color are calculated. The filter coefficients are set so that the proportions of the sums of the filter coefficients of each color of RGB in the lines in the horizontal vertical directions are equal (1:1:1).</p><p id="p0091" num="0091">For example, the filter coefficients of the uppermost row are 2, 1, 2, 4, 2, and 1 in <figref idrefs="f0005">Figure 9A</figref>. It can be recognized that the sums of the colors are R=4, G=1+2+1=4, and B=2+2=4, and the sums are in a relationship of 4:4:4=1:1:1. The relationship holds true for all rows and columns (lines in the horizontal and vertical directions) in the filter coefficients.</p><p id="p0092" num="0092">The filter coefficients are weighted in the weighted average filters so that when the filter coefficients are compared in each area divided into the size of 2×2, the filter coefficient of 2×2 at the center section is the largest, the vertical and horizontal filter coefficients of 2×2 across the center section are the next largest, and the filter coefficients of 2×2 at the four corners are the smallest.</p><p id="p0093" num="0093">When weighted average values of RGB are calculated based on the weighted average filters with the configuration described above and based on the pixel values of<!-- EPO <DP n="20"> --> the pixels in the local area of 6×6 pixels extracted from the mosaic image, color deviation does not occur in the colors based on the weighted average values of RGB regardless of the type of the frequency input in the horizontal and vertical directions, and coloring due to the folding of the high frequency wave does not occur.</p><p id="p0094" num="0094">As in the first embodiment, the weighted average values of RGB are calculated based on the pixel values of the pixels in the local area of 6×6 pixels extracted from the mosaic image and the filter coefficients of the weighted average filters. The pixel values of the target pixels of 2×2 pixels at the center section in the local area of 6×6 pixels can be interpolated based on the color ratio or the color difference between the calculated weighted average values of RGB to calculate the pixel values of the other colors.</p><p id="p0095" num="0095">When the synchronization processing for calculating the pixel values of RGB is finished for all pixels of 2×2 pixels at the center section in the local area of 6×6 pixels, the same process is applied while shifting the local area extracted from the mosaic image by two pixels in the horizontal or vertical direction. In this case, different weighted average filters are used.</p><p id="p0096" num="0096">More specifically, when there are G pixels at upper left and lower right of the 2×2 pixels at the center section in the local area of the 6×6 pixels extracted from the mosaic image as shown in <figref idrefs="f0005">Figure 9A</figref>, the weighted average filters with the filter coefficients shown in <figref idrefs="f0005">Figure 9A</figref> are used. When the local area extracted from the mosaic image is shifted by two pixels in the horizontal direction as shown in <figref idrefs="f0006">Figure 9B</figref>, and there are G pixels at upper right and lower left of the 2×2 pixels at the center section of the local area, the weighted average filters with the filter coefficients shown in <figref idrefs="f0006">Figure 9B</figref> are used.</p><heading id="h0021">{Others}</heading><p id="p0097" num="0097">Although the color imaging apparatus including the color imaging element with color filters of three primary colors of RGB has been described in the embodiments, the present invention is not limited to this. The present invention can also be applied to a color imaging apparatus including a color imaging element with color filters of four colors including three primary colors of RGB and another color (for example, emerald (E)).<!-- EPO <DP n="21"> --></p><p id="p0098" num="0098">The present invention can also be applied to a color imaging apparatus including a color imaging element with color filters of four complementary colors including G in addition to C (cyan), M (magenta), and Y (yellow) that are complementary colors of the primary colors RGB.</p><p id="p0099" num="0099">It is obvious that the present invention is not limited to the embodiments, and various modifications can be made without departing from the spirit of the present invention.</p><heading id="h0022">{Reference Signs List}</heading><p id="p0100" num="0100">10 ... imaging optical system, 12 ... color imaging element, 14 ... image processing unit, 16 ... image processing unit, 18 ... drive unit, 20 ... control unit</p></description><claims mxw-id="PCLM56982272" lang="EN" load-source="patent-office"><!-- EPO <DP n="22"> --><claim id="c-en-0001" num="0001"><claim-text>A color imaging apparatus comprising:
<claim-text>a single-plate color imaging element including color filters arranged on a plurality of pixels formed by photoelectric conversion elements arranged in horizontal and vertical directions, the color filters having a color filter array where all colors are periodically arranged in each line in the horizontal and vertical directions;</claim-text>
<claim-text>an image acquisition unit that acquires a mosaic image from the color imaging element;</claim-text>
<claim-text>weighted average filters with predetermined filter coefficients, wherein a relationship between the colors of the pixels and the filter coefficients in a local area extracted from the mosaic image corresponding to the weighted average filters is set so that proportions of sums of the filter coefficients of each color in the lines in the horizontal and vertical directions are equal;</claim-text>
<claim-text>a weighted average calculation unit that calculates weighted average values of each color based on the filter coefficients of the weighted average filters and pixel values of the pixels in the local area extracted from the mosaic image corresponding to the weighted average filters;</claim-text>
<claim-text>a synchronization processing unit that calculates a pixel value of another color at a pixel position of a target pixel of synchronization processing at a center section of the weighted average filters and that interpolates a pixel value of the target pixel based on a color ratio or a color difference between the calculated weighted average values of the color and the another color of the target pixel to calculate the pixel value of the another color; and</claim-text>
<claim-text>a control unit that repeatedly operates the weighted average calculation unit and the synchronization processing unit while shifting the local area extracted from the mosaic image corresponding to the weighted average filters by a target pixel unit of the synchronization processing.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The color imaging apparatus according to claim 1, wherein<br/>
the color filter array of the color imaging element includes a basic array pattern including first filters corresponding to a first color that most contributes to obtaining luminance signals and second filters corresponding to two or more second colors other<!-- EPO <DP n="23"> --> than the first color, the basic array pattern is repeatedly arranged in the horizontal and vertical directions, and<br/>
a proportion of the number of pixels of the first color corresponding to the first filters and proportions of the numbers of pixels of each color of the second colors corresponding to the second filters are different.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The color imaging apparatus according to claim 2, wherein<br/>
the proportion of the number of pixels of the first color corresponding to the first filters is greater than the proportions of the numbers of pixels of each color of the second colors corresponding to the second filters.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The color imaging apparatus according to any one of claims 1 to 3, wherein<br/>
the weighted average filters are filters weighted to increase the filter coefficients at the center section.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The color imaging apparatus according to any one of claims 1 to 4, wherein<br/>
the weighted average filters have the filter coefficients that are horizontally symmetric, vertically symmetric, and point symmetric.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The color imaging apparatus according to any one of claims 1 to 5, wherein<br/>
the color filters include R filters, G filters, and B filters corresponding to colors of red (R), green (G), and blue (B) arranged in a predetermined color filter array, wherein<br/>
when the weighted average values of each color of the pixel values of R, G, and B pixels corresponding to the R filters, the G filters, and the B filters calculated by the weighted average calculation unit are Rf, Gf, and Bf, respectively,<br/>
if the target pixel of the synchronization processing is a G pixel, and the pixel value is G, the synchronization processing unit calculates pixel values R and B of the R and B pixels at the position of the target pixel by the following formulas <maths id="math0013" num=""><math display="block"><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>×</mo><mfenced separators=""><mi>Rf</mi><mo>/</mo><mi>Gf</mi></mfenced><mspace width="1em"/><mi>and B</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>×</mo><mfenced separators=""><mi>Bf</mi><mo>/</mo><mi>Gf</mi></mfenced><mo>,</mo></math><img id="ib0013" file="imgb0013.tif" wi="64" he="8" img-content="math" img-format="tif"/></maths> wherein<br/>
if the target pixel of the synchronization processing is an R pixel, and the pixel value is R, the synchronization processing unit calculates pixel values G and B of the G and B pixels at the position of the target pixel by the following formulas <maths id="math0014" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>×</mo><mfenced separators=""><mi>Gf</mi><mo>/</mo><mi>Rf</mi></mfenced><mspace width="1em"/><mi>and B</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>×</mo><mfenced separators=""><mi>Bf</mi><mo>/</mo><mi>Rf</mi></mfenced><mo>,</mo></math><img id="ib0014" file="imgb0014.tif" wi="64" he="10" img-content="math" img-format="tif"/></maths> wherein<br/>
<!-- EPO <DP n="24"> -->if the target pixel of the synchronization processing is a B pixel, and the pixel value is B, the synchronization processing unit calculates pixel values G and R of the G and R pixels at the position of the target pixel by the following formulas <maths id="math0015" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>×</mo><mfenced separators=""><mi>Gf</mi><mo>/</mo><mi>Bf</mi></mfenced><mspace width="1em"/><mi>and R</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>×</mo><mfenced separators=""><mi>Rf</mi><mo>/</mo><mi>Bf</mi></mfenced><mn>.</mn></math><img id="ib0015" file="imgb0015.tif" wi="65" he="8" img-content="math" img-format="tif"/></maths></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The color imaging apparatus according to any one of claims 1 to 5, wherein<br/>
the color filters include R filters, G filters, and B filters corresponding to colors of red (R), green (G), and blue (B) arranged in a predetermined color filter array, wherein<br/>
when the weighted average values of each color of the pixel values of R, G, and B pixels corresponding to the R filters, the G filters, and the B filters calculated by the weighted average calculation unit are Rf, Gf, and Bf, respectively,<br/>
if the target pixel of the synchronization processing is a G pixel, and the pixel value is G, the synchronization processing unit calculates pixel values R and B of the R and B pixels at the position of the target pixel by the following formulas <maths id="math0016" num=""><math display="block"><mi mathvariant="normal">R</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>+</mo><mfenced separators=""><mi>Rf</mi><mo>-</mo><mi>Gf</mi></mfenced><mspace width="1em"/><mi>and B</mi><mo>=</mo><mi mathvariant="normal">G</mi><mo>+</mo><mfenced separators=""><mi>Bf</mi><mo>-</mo><mi>Gf</mi></mfenced><mo>,</mo></math><img id="ib0016" file="imgb0016.tif" wi="66" he="7" img-content="math" img-format="tif"/></maths> wherein<br/>
if the target pixel of the synchronization processing is an R pixel, and the pixel value is R, the synchronization processing unit calculates pixel values G and B of the G and B pixels at the position of the target pixel by the following formulas <maths id="math0017" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>+</mo><mfenced separators=""><mi>Gf</mi><mo>-</mo><mi>Rf</mi></mfenced><mspace width="1em"/><mi>and B</mi><mo>=</mo><mi mathvariant="normal">R</mi><mo>+</mo><mfenced separators=""><mi>Bf</mi><mo>-</mo><mi>Rf</mi></mfenced><mo>,</mo></math><img id="ib0017" file="imgb0017.tif" wi="65" he="10" img-content="math" img-format="tif"/></maths> wherein<br/>
if the target pixel of the synchronization processing is a B pixel, and the pixel value is B, the synchronization processing unit calculates pixel values G and R of the G and R pixels at the position of the target pixel by the following formulas <maths id="math0018" num=""><math display="block"><mi mathvariant="normal">G</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>+</mo><mfenced separators=""><mi>Gf</mi><mo>-</mo><mi>Bf</mi></mfenced><mspace width="1em"/><mi>and R</mi><mo>=</mo><mi mathvariant="normal">B</mi><mo>+</mo><mfenced separators=""><mi>Rf</mi><mo>-</mo><mi>Bf</mi></mfenced><mn>.</mn></math><img id="ib0018" file="imgb0018.tif" wi="60" he="4" img-content="math" img-format="tif"/></maths></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The color imaging apparatus according to any one of claims 1 to 7, wherein<br/>
the color filters include R filters, G filters, and B filters corresponding to colors of red (R), green (G), and blue (B) arranged in a predetermined color filter array,<br/>
the filter array includes: a first array corresponding to 3×3 pixels, the first array including G filters arranged at a center and four corners, B filters vertically arranged across the G filter at the center, and R filters horizontally arranged across the G filter at the center; and a second array corresponding to 3×3 pixels, the second array including G filters arranged at a center and four corners, R filters vertically arranged across the G filter at the center, and B filters horizontally arranged across the G filter at the center,<!-- EPO <DP n="25"> --> wherein the first and second arrays are alternately arranged in the horizontal and vertical directions,<br/>
the weight average filters have a kernel size of 9×9, and<br/>
the control unit repeatedly operates the weighted average calculation unit and the synchronization processing unit while sequentially shifting the weighted average filter to set one of the first and second arrays at the center.</claim-text></claim></claims><drawings mxw-id="PDW16670657" load-source="patent-office"><!-- EPO <DP n="26"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="159" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="27"> --><figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="139" he="226" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="28"> --><figure id="f0003" num="5,6A"><img id="if0003" file="imgf0003.tif" wi="134" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="29"> --><figure id="f0004" num="6B,7"><img id="if0004" file="imgf0004.tif" wi="129" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="30"> --><figure id="f0005" num="8,9A"><img id="if0005" file="imgf0005.tif" wi="134" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0006" num="9B"><img id="if0006" file="imgf0006.tif" wi="137" he="117" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0007" num="10(A),10(B),10(C),10(D),10(E)"><img id="if0007" file="imgf0007.tif" wi="109" he="202" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="227" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="164" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
