<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2683157-A1" country="EP" doc-number="2683157" kind="A1" date="20140108" family-id="46757716" file-reference-id="252638" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146585092" ucid="EP-2683157-A1"><document-id><country>EP</country><doc-number>2683157</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12752551-A" is-representative="YES"><document-id mxw-id="PAPP154847284" load-source="docdb" format="epo"><country>EP</country><doc-number>12752551</doc-number><kind>A</kind><date>20120126</date><lang>JA</lang></document-id><document-id mxw-id="PAPP201283912" load-source="docdb" format="original"><country>EP</country><doc-number>12752551.7</doc-number><date>20120126</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140550112" ucid="JP-2011044254-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2011044254</doc-number><kind>A</kind><date>20110301</date></document-id></priority-claim><priority-claim mxw-id="PPC140555509" ucid="JP-2012051601-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2012051601</doc-number><kind>W</kind><date>20120126</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL2102369168" load-source="docdb">H04N   5/355       20110101ALI20140722BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL2102372221" load-source="docdb">H04N   5/353       20110101AFI20140722BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL2102375155" load-source="docdb">H04N   5/374       20110101ALI20140722BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL2102376267" load-source="docdb">H04N   5/235       20060101ALI20140722BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1953523027" load-source="docdb" scheme="CPC">H04N   5/35554     20130101 LI20160405BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1953523028" load-source="docdb" scheme="CPC">H04N   5/3535      20130101 LI20160405BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1953523029" load-source="docdb" scheme="CPC">H04N   5/3532      20130101 LI20160405BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1953523030" load-source="docdb" scheme="CPC">H04N   5/2355      20130101 LI20160405BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1953523031" load-source="docdb" scheme="CPC">H04N   5/2329      20130101 LI20160405BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1953523032" load-source="docdb" scheme="CPC">H04N   5/374       20130101 LI20160405BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989638515" load-source="docdb" scheme="CPC">H04N   5/2353      20130101 FI20131205BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132359909" lang="DE" load-source="patent-office">BILDAUFNAHMEVORRICHTUNG, STEUERVERFAHREN FÜR DIE BILDAUFNAHMEVORRICHTUNG, STEUERVERFAHREN UND PROGRAMM DAFÜR</invention-title><invention-title mxw-id="PT132359910" lang="EN" load-source="patent-office">IMAGE PICKUP APPARATUS, IMAGE PICKUP APPARATUS CONTROL METHOD, AND PROGRAM</invention-title><invention-title mxw-id="PT132359911" lang="FR" load-source="patent-office">APPAREIL DE PRISE DE VUE, PROCÉDÉ DE COMMANDE D'APPAREIL DE PRISE DE VUE ET PROGRAMME</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919541864" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SONY CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR919522450" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SONY CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR919010879" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Sony Corporation</last-name><iid>100830309</iid><address><street>1-7-1 Konan Minato-ku</street><city>Tokyo 108-0075</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919535706" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>KAIZU SHUN</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919510014" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>Kaizu, Shun</last-name></addressbook></inventor><inventor mxw-id="PPAR919017330" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Kaizu, Shun</last-name><address><street>c/o Sony Corporation 1-7-1 Konan Minato-ku</street><city>Tokyo 108-0075</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919521537" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>MITSUNAGA TOMOO</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919525155" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>MITSUNAGA, TOMOO</last-name></addressbook></inventor><inventor mxw-id="PPAR919014972" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>MITSUNAGA, TOMOO</last-name><address><street>c/o Sony Corporation 1-7-1 Konan Minato-ku</street><city>Tokyo 108-0075</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919006692" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Ealey, Douglas Ralph</last-name><iid>101077806</iid><address><street>D Young &amp; Co LLP 120 Holborn</street><city>London EC1N 2DY</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2012051601-W"><document-id><country>JP</country><doc-number>2012051601</doc-number><kind>W</kind><date>20120126</date><lang>JA</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012117774-A1"><document-id><country>WO</country><doc-number>2012117774</doc-number><kind>A1</kind><date>20120907</date><lang>JA</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549814061" load-source="docdb">AL</country><country mxw-id="DS549816068" load-source="docdb">AT</country><country mxw-id="DS549814070" load-source="docdb">BE</country><country mxw-id="DS549742360" load-source="docdb">BG</country><country mxw-id="DS549908456" load-source="docdb">CH</country><country mxw-id="DS549815571" load-source="docdb">CY</country><country mxw-id="DS549816069" load-source="docdb">CZ</country><country mxw-id="DS549814071" load-source="docdb">DE</country><country mxw-id="DS549815572" load-source="docdb">DK</country><country mxw-id="DS549815573" load-source="docdb">EE</country><country mxw-id="DS549744211" load-source="docdb">ES</country><country mxw-id="DS549744618" load-source="docdb">FI</country><country mxw-id="DS549742369" load-source="docdb">FR</country><country mxw-id="DS549814072" load-source="docdb">GB</country><country mxw-id="DS549815578" load-source="docdb">GR</country><country mxw-id="DS549814073" load-source="docdb">HR</country><country mxw-id="DS549816078" load-source="docdb">HU</country><country mxw-id="DS549908457" load-source="docdb">IE</country><country mxw-id="DS549815579" load-source="docdb">IS</country><country mxw-id="DS549742370" load-source="docdb">IT</country><country mxw-id="DS549815580" load-source="docdb">LI</country><country mxw-id="DS549744619" load-source="docdb">LT</country><country mxw-id="DS549818395" load-source="docdb">LU</country><country mxw-id="DS549744620" load-source="docdb">LV</country><country mxw-id="DS549744629" load-source="docdb">MC</country><country mxw-id="DS549818396" load-source="docdb">MK</country><country mxw-id="DS549818397" load-source="docdb">MT</country><country mxw-id="DS549814078" load-source="docdb">NL</country><country mxw-id="DS549742371" load-source="docdb">NO</country><country mxw-id="DS549744630" load-source="docdb">PL</country><country mxw-id="DS549908458" load-source="docdb">PT</country><country mxw-id="DS549814079" load-source="docdb">RO</country><country mxw-id="DS549908459" load-source="docdb">RS</country><country mxw-id="DS549744631" load-source="docdb">SE</country><country mxw-id="DS549744212" load-source="docdb">SI</country><country mxw-id="DS549742372" load-source="docdb">SK</country><country mxw-id="DS549744632" load-source="docdb">SM</country><country mxw-id="DS549815581" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128673264" lang="EN" load-source="patent-office"><p id="pa01" num="0001">An apparatus and a method are provided, which realize image pickup processing in which setting of an exposure time is performed in units of regions in an image pickup apparatus. An electronic shutter control unit that controls an exposure start time of an image pickup device by an electronic shutter operation and a mechanical shutter control unit that controls an exposure end time of the image pickup device by a mechanical shutter operation. The electronic shutter control unit calculates the exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and controls the electronic shutter to operate at the calculated exposure start time in units of image regions. For example, the exposure time control in units of regions is executed by subtracting a mechanical shutter an exposure time from a mechanical shutter operation time in units of row blocks, for example, and calculating a reset time serving as an exposure start time as an electronic shutter operation time.<img id="iaf01" file="imgaf001.tif" wi="140" he="81" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128737415" lang="EN" source="EPO" load-source="docdb"><p>An apparatus and a method are provided, which realize image pickup processing in which setting of an exposure time is performed in units of regions in an image pickup apparatus. An electronic shutter control unit that controls an exposure start time of an image pickup device by an electronic shutter operation and a mechanical shutter control unit that controls an exposure end time of the image pickup device by a mechanical shutter operation. The electronic shutter control unit calculates the exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and controls the electronic shutter to operate at the calculated exposure start time in units of image regions. For example, the exposure time control in units of regions is executed by subtracting a mechanical shutter an exposure time from a mechanical shutter operation time in units of row blocks, for example, and calculating a reset time serving as an exposure start time as an electronic shutter operation time.</p></abstract><description mxw-id="PDES63959252" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">TECHNICAL FIELD</heading><p id="p0001" num="0001">The present invention relates to an image pickup apparatus, a method of controlling an image pickup apparatus, and a program. To be specific, an image pickup apparatus, a method of controlling an image pickup apparatus and a program that executes readout of pixel values of a photographed image as row sequential readout processing.</p><heading id="h0002">BACKGROUND ART</heading><p id="p0002" num="0002">Hereinafter, an outline of the following two technologies related to exposure control processing will be described as background technologies.
<ol><li>(1) A focal-plane shutter operation and occurrence of distortion</li><li>(2) Dynamic range expansion processing by exposure time control (shutter control)</li></ol></p><heading id="h0003">(1) A focal-plane shutter operation and occurrence of distortion</heading><p id="p0003" num="0003">First, a focal-plane shutter operation and occurrence of distortion will be described.</p><p id="p0004" num="0004">As a shutter operation system of image photographing processing in an image pickup apparatus, there is a shutter operation that controls exposure start and exposure end from one direction of an image pickup device surface. This shutter operation is called a focal-plane shutter operation or a rolling shutter operation. For example, there is a characteristic such that the exposure times between rows are slightly shifted when the exposure start and the exposure end are controlled from an upper row to a lower row of the image pickup device.</p><p id="p0005" num="0005">A configuration of a CMOS image sensor and an example of photographing processing will be described as an example of the image pickup device having a focal-plane shutter operation function with reference to <figref idrefs="f0001">Fig. 1</figref>.</p><p id="p0006" num="0006"><figref idrefs="f0001">Fig. 1</figref> is a diagram illustrating a part of a configuration of an image pickup device (CMOS image sensor) 101. The image pickup device (CMOS image sensor) 101 is configured from a vertical scanning circuit 102, a horizontal scanning circuit 103, and a plurality of pixels 104 arranged in an array<!-- EPO <DP n="2"> --> manner.</p><p id="p0007" num="0007">Electric charges are accumulated in a photodiode inside a pixel 104 by exposure processing associated with photographing of an object.</p><p id="p0008" num="0008">The electric charges accumulated in the photodiode of each pixel are output to a vertical signal line 113 through an amplifier transistor and a transfer transistor. A signal current output to the vertical signal line 113 is further supplied to the horizontal scanning circuit 103, is subjected to predetermined signal processing, and is then output outside through a signal output line 114.</p><p id="p0009" num="0009">Since vertically aligned pixels are commonly connected to the vertical signal line 113, to independently read out a signal of each pixel, only a signal of one pixel at a time should be output to the vertical signal line 113.</p><p id="p0010" num="0010">That is, in the image pickup device (CMOS image sensor) 101, a signal is read out from each of pixels 104d aligned in the lowermost row, first, as illustrated in <figref idrefs="f0002">Fig. 2 (A)</figref>. The readout of signals from the row of pixels 104c is performed, next, as illustrated in <figref idrefs="f0002">Fig. 2(B)</figref>. Then, the readout of signals by changing the row is performed in sequence, so that the signal of each pixel can be independently read out. A control signal of the readout of pixels is, for example, output from a horizontal reset line 111 and a horizontal select line 112 connected to the vertical scanning circuit 102 illustrated in <figref idrefs="f0001">Fig. 1</figref>.</p><p id="p0011" num="0011">Each of the pixels 104 that configure the image pickup device (CMOS image sensor) starts exposure again immediately after the readout processing of the accumulated electric charges. That is, the exposure processing for a next image frame is started.</p><p id="p0012" num="0012">In this way, when the readout processing is executed in sequence in units of rows, and the exposure processing is started immediately afterwards, start times and end times of exposure of the photodiode 104a in the head row and the photodiode 104d in the bottom row are different, that is, a gap occurs between exposure times (or exposure periods).</p><p id="p0013" num="0013">This is a characteristic of the shutter operation, called a focal-plane shutter operation or a rolling shutter operation.</p><p id="p0014" num="0014">Note that, although only the four rows of 104a to 104d are illustrated<!-- EPO <DP n="3"> --> in the drawing, this illustrates only a part of the image pickup device. A large number of rows, such as several hundred to several thousands of rows, are set in an actual image pickup device, and the readout is executed in a unit of each row in sequence.</p><p id="p0015" num="0015">An example of start and end timings of exposure of each row, and a start timing of readout of the electric charges will be described with reference to <figref idrefs="f0003">Figs. 3</figref> and <figref idrefs="f0004">4</figref>.</p><p id="p0016" num="0016">In both of <figref idrefs="f0003">Figs. 3</figref> and <figref idrefs="f0004">4</figref>, the horizontal axis represents a time axis and the vertical axis represents a row.</p><p id="p0017" num="0017">For example, in <figref idrefs="f0003">Fig. 3</figref>, a time gap occurs in the readout timings of the electric charges in units of rows, as illustrated in the drawing with the dotted lines 151a, a, and 151b.</p><p id="p0018" num="0018">A plurality of rectangular blocks illustrated in <figref idrefs="f0003">Fig. 3</figref> illustrates an exposure time of a given photographed image frame, and is an exposure time in units of row blocks made of a row or a plurality of rows.</p><p id="p0019" num="0019">Immediately after the timing illustrated in the readout line 151a of an image frame photographed in advance, the exposure processing is started. As illustrated in the readout line 151a, the exposure start times are slightly shifted in units of rows. In the graph illustrated in the drawing, an upper side row is started to expose in advance, and rows toward a lower side is started to expose later.</p><p id="p0020" num="0020">The uppermost row has the exposure start time at a time (t1), and the bottommost row has the exposure start time at a time (t2).</p><p id="p0021" num="0021">The right end of the plurality of rectangular blocks illustrated in <figref idrefs="f0003">Fig. 3</figref> is a timing at which the readout processing of an exposed image is executed, and accumulated electric charges of pixels in each row is read out at a timing illustrated in the readout line 151b.</p><p id="p0022" num="0022">In this example, the exposure end time ≈ the readout processing time, and as illustrated in the readout line 151b of <figref idrefs="f0003">Fig. 3</figref>, the readout processing of pixels in each row is performed from a head row in sequence.</p><p id="p0023" num="0023">The uppermost row has the exposure end time at a time (t2), and the bottommost row has the exposure end time at a time (t3).</p><p id="p0024" num="0024">Note that, in this example, since the exposure starts and the exposure ends of each row have gaps at the same timing in units of rows, the exposure times of all rows are the same.</p><p id="p0025" num="0025"><!-- EPO <DP n="4"> --><figref idrefs="f0004">Fig. 4</figref> illustrates exposure processing and readout timing corresponding to images of two consecutive photographed frames at the time of photographing a moving image.</p><p id="p0026" num="0026">As illustrated in <figref idrefs="f0004">Fig. 4</figref>, a preceding photographed frame N has the exposure time during a period of readout lines 152a to 152b, and the readout of pixel values from each row is executed at the timing illustrated in the readout line 152b.</p><p id="p0027" num="0027">A subsequent photographed frame N + 1 has the exposure time during readout lines 152b to 152c, and the readout of pixel values from each row is executed at the timing illustrated in the readout line 152c.</p><p id="p0028" num="0028">In the example illustrated in <figref idrefs="f0004">Fig. 4</figref>, the preceding photographed frame N has:
<ul><li>the exposure start time, in which the uppermost row has a time (t1a), and the bottommost row has a time (t1b), and</li><li>the exposure end time, in which the uppermost row has a time (t1b), and the bottommost row has a time (t1c).</li></ul></p><p id="p0029" num="0029">The subsequent photographed frame N + 1 has:
<ul><li>the exposure start time, in which the uppermost row has a time (t2a), and the bottommost row has a time (t2b), and</li><li>the exposure end time, in which the uppermost row has a time (t2b), and the bottommost row has a time (t2c).</li></ul></p><p id="p0030" num="0030">In the example illustrated in <figref idrefs="f0004">Fig. 4</figref>, for example, the exposure time of the bottommost row of the preceding photographed frame N and the exposure time of the uppermost row of the subsequent photographed frame N + 1 are almost the same period of time. That is, a phenomenon occurs, in which lower side image data of the preceding image frame and upper side image data of the subsequent frame are images at almost the same period of time.</p><p id="p0031" num="0031">As a result, for example, when a moving object is photographed, or when photographing processing is performed, in which the camera itself is moved during exposure, distortion occurs in an image due to the gap of exposure times between rows caused by a focal-plane shutter operation.</p><p id="p0032" num="0032">An example of image distortion will be described with reference to <figref idrefs="f0005">Fig. 5</figref>.</p><p id="p0033" num="0033"><figref idrefs="f0005">Fig. 5 (A)</figref> is a photograph example photographed with the camera being stopped.<!-- EPO <DP n="5"> --></p><p id="p0034" num="0034"><figref idrefs="f0005">Fig. 5(B)</figref> is a photograph example photographed while the camera is moved in a lateral direction.</p><p id="p0035" num="0035">While distortion does not occur in the image of <figref idrefs="f0005">Fig. 5 (A)</figref>, distortion occurs in the image illustrated in <figref idrefs="f0005">Fig. 5(B)</figref>.</p><p id="p0036" num="0036">Similarly, <figref idrefs="f0005">Fig. 5 (C)</figref> is a photograph example when a car is photographed with being stopped.</p><p id="p0037" num="0037"><figref idrefs="f0005">Fig. 5(D)</figref> is a photograph example when a car is photographed with being moved.</p><p id="p0038" num="0038">While distortion does not occur in the image of <figref idrefs="f0005">Fig. 5 (C)</figref>, distortion occurs in the image illustrated in <figref idrefs="f0005">Fig. 5(D)</figref>.</p><p id="p0039" num="0039">Such distortion occurs because there is a gap between the exposure times of the image pickup device described with reference to <figref idrefs="f0003">Figs. 3</figref> and <figref idrefs="f0004">4</figref>, that is, the exposure times are slightly different from an upper end row to a lower end row. This occurrence phenomenon of distortion is referred to as a focal-plane shutter phenomenon, or a rolling shutter phenomenon.</p><p id="p0040" num="0040">The image pickup device that performs a focal-plane shutter operation is capable of obtaining a photographed image without distortion or having reduced distortion by mechanically shading light reaching the image pickup device.</p><p id="p0041" num="0041">A digital camera that employs a mechanical focal-plane shutter (hereinafter, a mechanical shutter) used in a silver halide camera has been known. That is, the digital camera has a configuration in which a front curtain that controls exposure start and a back curtain that controls exposure end are performed by mechanical shutters as dousers. The widths of these two curtains are adjusted to control the exposure time. The speed of the mechanical shutter is higher than the focal-plane shutter (readout scanning of the sensor) of the image pickup device, and a photographed image having reduced distortion can be obtained.</p><p id="p0042" num="0042">Patent Documents 1 and 2 disclose a configuration using an electronic shutter as the front curtain that controls the exposure start and using a mechanical shutter (douser) as the back curtain that controls the exposure end. The electronic shutter that is the front curtain is performed by reset scanning of pixels in time with travelling of the mechanical shutter that is the back curtain. That is, it is a method of reading out a signal after the mechanical shutter that is the back curtain is closed and the pixels<!-- EPO <DP n="6"> --> are shaded.</p><p id="p0043" num="0043">Patent Document 1 discloses a configuration in which only the electronic shutter is used in the exposure start and the exposure end when a moving image is photographed, and the exposure start is controlled by the electronic shutter and the exposure end is controlled by the mechanical shutter when a still image is photographed. This configuration enables the photographing of a moving image as well as a sufficiently accurate shutter operation even when a still image is photographed.</p><p id="p0044" num="0044">Patent Document 2 describes an effect of reducing a mechanical shutter that controls the exposure start by controlling the exposure start by the electronic shutter and controlling the exposure end by the mechanical shutter.</p><p id="p0045" num="0045">Patent Documents 1 and 2 only disclose a configuration in which the exposure time, that is, the time from start to end of exposure is the same length in all pixels.</p><heading id="h0004">(2) Dynamic range expansion processing by exposure time control (shutter control)</heading><p id="p0046" num="0046">Next, dynamic range expansion processing by exposure time control (shutter control) will be described.</p><p id="p0047" num="0047">A dynamic range of a photographed image can be expanded by controlling the exposure time to each pixel of the image pickup device.</p><p id="p0048" num="0048">In a bright object region, if the exposure time is made longer, the accumulated electric charges of a pixel are saturated, and an accurate pixel value cannot be obtained.</p><p id="p0049" num="0049">Meanwhile, in a dark object region, if the exposure time is made longer, an accurate pixel value corresponding to object luminance can be easily obtained.</p><p id="p0050" num="0050">Therefore, in the region where the object is bright, a pixel value of a pixel, in which the exposure time is set short, is obtained as an effective pixel value. Meanwhile, in the region where an object is dark, a pixel value of a pixel, in which the exposure time is set longer, is obtained as an effective pixel value. A method of expanding the dynamic range is to combine these values to generate an output image. Note that, in outputting a final pixel value, pixel value adjustment processing based on the exposure time is executed.<!-- EPO <DP n="7"> --></p><p id="p0051" num="0051">Patent Documents 3 and 4, and Non Patent Document 1 disclose a technology in which a different exposure time is set in each pixel row of the image pickup device, and the dynamic range of a photographed image is expanded. For example, it is configured such that a short time exposure row and a long time exposure row are set in every other pixel row of the image pickup device.</p><p id="p0052" num="0052">For example, Patent Document 3 discloses a configuration in which a high sensitive pixel (long time exposure pixel) and a low sensitive pixel (short time exposure pixel) are set by causing the electronic shutter operation of the CMOS image sensor to perform different operations in even rows and in an odd rows. A high dynamic range image can be photographed by combination of pixel values according to object luminance.</p><p id="p0053" num="0053">Patent Document 4 discloses a configuration in which two patterns of exposure times are set in each row, or in each of a plurality of rows with more than one row, and the patterns are changed by an electronic shutter operation. Further, Patent Document 4 also discloses a method in which three patterns of exposure times are set, and are set in units of rows according to the brightness of a portion of a screen.</p><p id="p0054" num="0054">Further, Non Patent Document 1 discloses a configuration in which arbitrary exposure time control can be further freely performed in units of rows. The technique of Non Patent Document 1 is a configuration in which a dynamic range can be expanded by setting an individual exposure time in units of rows according to the brightness of an image.</p><p id="p0055" num="0055">The configurations of Patent Documents 3 and 4, and Non Patent Document 1 execute the exposure time control in units of regions by a configuration using an electronic shutter.</p><p id="p0056" num="0056">Further, Patent Document 5 discloses a configuration, in which processing that executes reset scanning twice in every one row in an alternate manner, the reset scanning once resetting the electric charges accumulated in each pixel by the electronic shutter, or multiple reset processing that executes the reset processing three times at the rate of once in every three rows is performed, and the exposure control by a configuration of a mechanical shutter and an electronic shutter used in combination is performed, so that the photographing with a plurality of predetermined different exposure times<!-- EPO <DP n="8"> --> in units of rows is performed, and the dynamic range is expanded.</p><p id="p0057" num="0057">However, Patent Document 5 described above has a configuration in which a plurality of different exposure times is set in units of rows in advance and the photographing is performed, and does not have a configuration in which adaptive exposure time control is performed according to the luminance of an object.</p><heading id="h0005">(3) Summary of related art</heading><p id="p0058" num="0058">As described above, in the configuration using a focal-plane shutter, a gap of an exposure period occurs in units of rows, and distortion caused by the gap occurs.</p><p id="p0059" num="0059">Further, while the technology of expanding the dynamic range by performing exposure period control in units of regions has been known, even in this configuration, a gap of an exposure period in units of rows cannot be prevented when a focal-plane shutter is used, and distortion caused by the gap occurs.</p><heading id="h0006">CITATION LIST</heading><heading id="h0007">PATENT DOCUMENT</heading><p id="p0060" num="0060"><ul><li>Patent Document 1: <patcit id="pcit0001" dnum="JP11041523A"><text>JP 11-41523 A</text></patcit></li><li>Patent Document 2: <patcit id="pcit0002" dnum="JP2000152057A"><text>JP 2000-152057 A</text></patcit></li><li>Patent Document 3: <patcit id="pcit0003" dnum="JP2006253876A"><text>JP 2006-253876 A</text></patcit></li><li>Patent Document 4: Japanese Patent Application No. <patcit id="pcit0004" dnum="JP2006542337A"><text>2006-542337</text></patcit></li><li>Patent Document 5: <patcit id="pcit0005" dnum="JP2008118573A"><text>JP 2008-118573 A</text></patcit></li></ul></p><heading id="h0008">NON PATENT DOCUMENT</heading><p id="p0061" num="0061">Non Patent Document 1: <nplcit id="ncit0001" npl-type="s"><text>Jenwei Gu et al, Coded Rolling Shutter Photography: Flexible Space-Time Sampling, Computational Photography (ICCP), 2010</text></nplcit>.</p><heading id="h0009">SUMMARY OF THE INVENTION</heading><heading id="h0010">PROBLEMS TO BE SOLVED BY THE INVENTION</heading><p id="p0062" num="0062">As described above, an image pickup device that performs a focal-plane operation is subject to distortion in a photographed image at the time of photographing a moving object.</p><p id="p0063" num="0063">The present invention has been made in view of the foregoing, and an objective of the present invention is to provide an image pickup apparatus,<!-- EPO <DP n="9"> --> a method of controlling an image pickup apparatus, and a program that capable of suppressing distortion in a photographed image in an image pickup device that performs a focal-plane operation.</p><p id="p0064" num="0064">Further, in a configuration of an embodiment of the present invention, an objective is to provide an image pickup apparatus, a method of controlling an image pickup apparatus, and a program that realize adaptive exposure time control in units of regions according to the brightness of the object in a configuration in which an electronic shutter and a mechanical shutter are used in combination.</p><p id="p0065" num="0065">Further, in a configuration of an embodiment of the present invention, an objective is to provide an image pickup apparatus, a method of controlling an image pickup apparatus, and a program that enable photographing of a wide dynamic range image having less distortion in photographing an image by a focal-plane shutter operation.</p><heading id="h0011">SOLUTIONS TO PROBLEMS</heading><p id="p0066" num="0066">A first aspect of the present invention is an image pickup apparatus including:
<ul><li>an image pickup device;</li><li>an electronic shutter control unit configured to control an exposure start time of the image pickup device by an electronic shutter operation; and</li><li>a mechanical shutter control unit configured to control an exposure end time of the image pickup device by a mechanical shutter operation,</li><li>wherein the electronic shutter control unit calculates an exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and controls an electronic shutter to operate at the calculated exposure start time in units of image regions.</li></ul></p><p id="p0067" num="0067">Further, in an embodiment of the image pickup apparatus of the present invention, the image pickup apparatus includes an exposure time calculation unit configured to calculate an exposure time of a subsequent photographed image in units of image regions according to luminance information in units of image regions obtained from a preliminary photographed image, wherein the electronic shutter control unit calculates an exposure start time in<!-- EPO <DP n="10"> --> units of image regions based on the exposure time in units of image regions calculated by the exposure time calculation unit, and an operation time of the mechanical shutter in units of image regions, and controls the electronic shutter to operate at the calculated exposure start time in units of image regions.</p><p id="p0068" num="0068">Further, in an embodiment of the image pickup apparatus of the present invention, the exposure time calculation unit executes exposure time calculation processing in units of image regions, in which an exposure time of the subsequent photographed image is set to be a long time for an image region having low luminance in units of image regions and obtained from the preliminary photographed image, and an exposure time of the subsequent photographed image is set to be a short time for an image region having high luminance in units of image regions and obtained from the preliminary photographed image.</p><p id="p0069" num="0069">Further, in an embodiment of the image pickup apparatus of the present invention, the exposure time calculation unit calculates an exposure time of the subsequent photographed image frame in units of image regions according to the luminance information obtained from a preceding photographed image frame of an image frame configuring a photographed moving image when the moving image is photographed.</p><p id="p0070" num="0070">Further, in an embodiment of the image pickup apparatus of the present invention, the image pickup apparatus includes an exposure time calculation unit configured to calculate an exposure time in units of row blocks configured from one or more rows as an image region according to luminance information based on a preliminary photographed image, wherein the electronic shutter control unit has a configuration configured to calculate an exposure start time in units of image regions based on the exposure time in units of row blocks calculated by the exposure time calculation unit, and an operation time of the mechanical shutter in units of row blocks, and to control an electronic shutter to operate at the calculated exposure start time in units of image regions, and calculates an exposure start time of a row block i: Tri according to the following expression: <maths id="math0001" num=""><math display="block"><mi>Tri</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texi</mi></math><img id="ib0001" file="imgb0001.tif" wi="43" he="7" img-content="math" img-format="tif"/></maths>
<ul><li>where a row block number is i,</li><li>the exposure time of the row block i is Texi, and</li><li>a mechanical shutter operation time of the row block i is Tmi.</li></ul><!-- EPO <DP n="11"> --></p><p id="p0071" num="0071">Further, in an embodiment of the image pickup apparatus of the present invention, the image pickup apparatus includes an exposure time calculation unit configured to calculate an exposure time in units of matrix blocks configured from one or more pixels as an image region according to luminance information based on a preliminary photographed image, wherein the electronic shutter control unit has a configuration configured to calculate an exposure start time in units of image regions based on the exposure time in units of matrix blocks calculated by the exposure time calculation unit, and an operation time of the mechanical shutter in units of rows, and to control an electronic shutter to operate at the calculated exposure start time in units of image regions, and calculates an exposure start time of a matrix block ij: Trij according to the following expression: <maths id="math0002" num=""><math display="block"><mi>Trij</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texij</mi></math><img id="ib0002" file="imgb0002.tif" wi="47" he="7" img-content="math" img-format="tif"/></maths>
<ul><li>where a row block number is i, a line block number is j,</li><li>the exposure time of the matrix block ij is Texij, and</li><li>a mechanical shutter operation time of the matrix block ij is Tmi.</li></ul></p><p id="p0072" num="0072">Further, in an embodiment of the image pickup apparatus of the present invention, the image pickup device is an image pickup device configured to execute pixel value readout processing in units of rows in sequence, and the mechanical shutter control unit controls the mechanical shutter to operate at a time preceding the pixel value readout processing of the image pickup device to terminate the exposure time.</p><p id="p0073" num="0073">Further, in an embodiment of the image pickup apparatus of the present invention, the electronic shutter control unit outputs a reset signal resetting an electric charge accumulated in each pixel of the image pickup device, in units of image regions of the image pickup device, and sets the exposure time of a unit of each image region as a time from outputting of the reset signal to the operation time of the mechanical shutter, and perform exposure time control in units of image regions.</p><p id="p0074" num="0074">Further, in an embodiment of the image pickup apparatus of the present invention, the image pickup apparatus further includes a signal processing unit configured to input an image output by an image pickup device by image pickup processing in which different exposure times are set in units of image regions, and to calculate a pixel value of the output image by multiplying a gain corresponding to a reciprocal number of the exposure time to the<!-- EPO <DP n="12"> --> input image.</p><p id="p0075" num="0075">Further, in an embodiment of the image pickup apparatus of the present invention, the image pickup apparatus further includes a sensitivity difference compensation unit configured to execute luminance comparison between a first image photographed without operating the mechanical shutter and a second image photographed with operating the mechanical shutter, to calculate a difference between a calculated exposure time in units of regions set to the second image and an actual exposure time of the actually photographed second image in units of regions based on information of the luminance comparison, and to execute pixel value correction compensating the calculated difference between the exposure times.</p><p id="p0076" num="0076">Further, a second aspect of the present invention is a method of controlling an image pickup apparatus executed in the image pickup apparatus, the method including:
<ul><li>an electronic shutter control step of controlling an exposure start time of an image pickup device by an electronic shutter operation by an electronic shutter control unit; and</li><li>a mechanical shutter control step of controlling an exposure end time of the image pickup device by a mechanical shutter operation, executed by a mechanical shutter control unit,</li><li>wherein the electronic shutter control step executes</li><li>a step of calculating an exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and</li><li>a step of controlling an electronic shutter to operate at the calculated exposure start time in units of image regions.</li></ul></p><p id="p0077" num="0077">Further, a third aspect of the present invention is a program for causing an image pickup apparatus to execute image pickup processing executing:
<ul><li>an electronic shutter control step of causing an electronic shutter control unit to control an exposure start time of an image pickup device by an electronic shutter operation, and</li><li>a mechanical shutter control step of causing a mechanical shutter control unit to control an exposure end time of the image pickup device by a mechanical shutter operation, and</li><li>the electronic shutter control step executes<!-- EPO <DP n="13"> --></li><li>a step of calculating an exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and</li><li>a step of controlling an electronic shutter to operate at the calculated exposure start time in units of image regions.</li></ul></p><p id="p0078" num="0078">Note that the program of the present invention is a program provided to an information processing apparatus or a computer system capable of executing various program codes, with a storage medium, for example. Such a program is executed in a program execution unit in the information processing apparatus or in the computer system, so that processing according to the program is realized.</p><p id="p0079" num="0079">Other objectives, characteristics, and advantages of the present invention will become clear by further detailed description based on the embodiments of the present invention described below and the appended drawings. Note that the system in the present specification is a theoretical assembled configuration made of a plurality of devices, and is not limited to one having devices in configurations in the same housing.</p><heading id="h0012">EFFECTS OF THE INVENTION</heading><p id="p0080" num="0080">According to an embodiment of the present invention, an apparatus and a method are provided, which realize setting of exposure times in units of regions in the image pickup apparatus, and photographing of an image having reduced image distortion.</p><p id="p0081" num="0081">To be specific, an electronic shutter control unit that controls an exposure start time of the image pickup device by an electronic shutter operation, and a mechanical shutter control unit that controls an exposure end time of the image pickup device by a mechanical shutter operation, are included. The electronic shutter control unit calculates an exposure start time in units of image regions based on an exposure time individually set in units of predetermined image regions, such as in units of row blocks, and an operation time of a mechanical shutter in units of image regions, and operates an electronic shutter at the calculated exposure start time in units of image regions.</p><p id="p0082" num="0082">For example, the exposure time is subtracted from the mechanical shutter operation time in units of row blocks, and a reset time as the exposure start time is calculated as an electronic shutter operation time, so that<!-- EPO <DP n="14"> --> exposure time control in units of regions is executed.</p><p id="p0083" num="0083">With this processing, exposure control set in an arbitrary exposure time becomes possible in units of image regions, and a time difference between rows of the exposure end times can be reduced by the mechanical shutter, whereby, for example, the image distortion likely to occur at the time of photographing a moving object can be reduced.</p><heading id="h0013">BRIEF DESCRIPTION OF DRAWINGS</heading><p id="p0084" num="0084"><ul><li><figref idrefs="f0001">Fig. 1</figref> is a diagram describing a configuration of an image pickup device and image pickup processing.</li><li><figref idrefs="f0002">Fig. 2</figref> is a diagram describing a configuration of an image pickup device and image pickup processing.</li><li><figref idrefs="f0003">Fig. 3</figref> is a diagram describing an image pickup processing sequence by a focal-plane operation.</li><li><figref idrefs="f0004">Fig. 4</figref> is a diagram describing an image pickup processing sequence by a focal-plane operation.</li><li><figref idrefs="f0005">Fig. 5</figref> is a diagram describing an example of occurrence of image distortion as a problem in the image pickup processing by the focal-plane operation.</li><li><figref idrefs="f0006">Fig. 6</figref> is a diagram describing a configuration and processing of an image pickup apparatus.</li><li><figref idrefs="f0007">Fig. 7</figref> is a diagram describing a configuration and an operation example of a mechanical shutter.</li><li><figref idrefs="f0008">Fig. 8</figref> is a diagram describing an example of setting processing of an exposure time in units of regions.</li><li><figref idrefs="f0009">Fig. 9</figref> is a diagram describing an example of calculation processing of an exposure time in units of regions calculated based on a luminance image, a luminance statistic, and luminance information.</li><li><figref idrefs="f0010">Fig. 10</figref> is a diagram describing an example of processing of exposure time control in units of regions executed by an image pickup apparatus.</li><li><figref idrefs="f0011">Fig. 11</figref> is a diagram describing exposure control processing in units of matrix blocks.</li><li><figref idrefs="f0012">Fig. 12</figref> is a diagram describing an example of exposure time control in units of predetermined regions.</li><li><figref idrefs="f0013">Fig. 13</figref> is a diagram describing an example of region division of an image pickup device that performs exposure time control in units of predetermined regions.<!-- EPO <DP n="15"> --></li><li><figref idrefs="f0014">Fig. 14</figref> is a diagram describing a configuration and processing of an image pickup apparatus having a sensitivity difference compensation unit.</li><li><figref idrefs="f0015">Fig. 15</figref> is a diagram describing an example of region division of an image pickup device that performs exposure time control in units of predetermined regions.</li></ul></p><heading id="h0014">MODE FOR CARRYING OUT THE INVENTION</heading><p id="p0085" num="0085">Hereinafter, details of an image pickup apparatus, a method of controlling an image pickup apparatus, and a program of the present invention will be described with reference to the drawings. Description will be given according to the following items.
<ol><li>1. A configuration example of an image pickup apparatus</li><li>2. A basic configuration of exposure time control in units of regions using an electronic shutter</li><li>3. Exposure time calculation processing in units of regions in an exposure time calculation unit</li><li>4. Exposure time control processing in units of regions by electronic shutter control in consideration of a mechanical shutter operation</li><li>5. Other embodiments</li><li>6. Correction processing responding to an operation change of a mechanical shutter</li></ol></p><heading id="h0015">[1. A configuration example of an image pickup apparatus]</heading><p id="p0086" num="0086">First, a part of a configuration of an image pickup apparatus will be described with reference to <figref idrefs="f0006">Fig. 6</figref>.</p><p id="p0087" num="0087">As illustrated in <figref idrefs="f0006">Fig. 6</figref>, an image pickup apparatus includes an optical lens 201, a mechanical shutter 202 configured from so-called a douser, an image pickup device 203 configured from a CMOS image sensor and the like, a signal processing unit 204, an exposure time calculation unit 206, an electronic shutter control unit 207, and a mechanical shutter control unit 208.</p><p id="p0088" num="0088">Note that the image pickup apparatus is capable of photographing a moving image and a still image, and realizes exposure time control in units of regions according to object luminance.</p><p id="p0089" num="0089">For example, at the time of photographing a moving image, the luminance information in units of regions is acquired in a preceding image frame,<!-- EPO <DP n="16"> --> and the exposure time control in units of regions is performed in the next photographed frame based on measured luminance information of the units of regions.</p><p id="p0090" num="0090">At the time of photographing a still image, the luminance information in units of regions is acquired using the last photographed of a photographed image, and at the time of photographing a still image to be photographed, exposure time control in units of regions is performed based on measured luminance information in units of regions.</p><p id="p0091" num="0091">Incident light through the optical lens 201 enters the image pickup device (CMOS image sensor) 203 during the mechanical shutter 202 is open, the electric charges is accumulated in each pixel according to the incident light, and a photoelectrically converted signal based on the accumulated electric charges is output to the signal processing unit 204 as image data.</p><p id="p0092" num="0092">The image pickup device (CMOS image sensor) 203 has a similar configuration to the one described above with reference to <figref idrefs="f0001">Fig. 1</figref>. Note that, although details will be described below, the image pickup device (CMOS image sensor) 203 has a configuration capable of controlling an exposure time in units of regions.</p><p id="p0093" num="0093">The signal processing unit 204 applies predetermined image processing to the input image, for example, applies image processing such as white balance adjustment processing and gamma correction processing to generate and output an output image 205. In addition, the signal processing unit 204 adjusts, in consideration of an exposure time of a photographed image in units of regions, an output pixel value by multiplying a gain of a reciprocal number of the exposure time in each region. The output image 205 is generated by performing the above-described processing.</p><p id="p0094" num="0094">Further, the signal processing unit 204 calculates a luminance component in units of regions of an image photographed in advance as information for the exposure time control in units of regions at the time of photographing the next image, and outputs the calculated data to the exposure time calculation unit 206.</p><p id="p0095" num="0095">The exposure time calculation unit 206 determines an exposure time (shutter time) of the image in units of regions based on the luminance component in units of image regions input from the signal processing unit 204, for example, and determines exposure time information in units of image regions<!-- EPO <DP n="17"> --> to the electronic shutter control unit 207.</p><p id="p0096" num="0096">The electronic shutter control unit 207 controls an operation timing of the electronic shutter that controls exposure start (front curtain) to control an exposure start time of the CMOS image sensor 203 based on the exposure time (shutter time) in units of regions determined by the exposure time calculation unit 206 and a predetermined operation timing of the mechanical shutter.</p><p id="p0097" num="0097">Meanwhile, the mechanical shutter control unit 208 operates the mechanical shutter 202 that controls exposure end (back curtain) at a predetermined timing preceding pixel readout processing of the image pickup device.</p><p id="p0098" num="0098">The mechanical shutter 202 includes a shutter curtain (douser) corresponding to the back curtain that terminates the exposure processing as illustrated in <figref idrefs="f0007">Fig. 7(A)</figref>, and travels at a predetermined speed in the row direction as illustrated in <figref idrefs="f0007">Fig. 7(B)</figref>.</p><p id="p0099" num="0099">In <figref idrefs="f0007">Fig. 7(B)</figref>, the vertical axis represents a row of the image pickup device and the horizontal axis represents a time. By the operation of the mechanical shutter 202, rows at an upper side are shared in sequence, and the bottommost row is lastly shaded.</p><p id="p0100" num="0100">As an example, in a row L1, which is a given row in the image pickup device, light is reached and the electric charges is accumulated during a period before a time T1, but is shaded by the mechanical shutter 202 and the accumulation of the electric charges to the pixel is stopped on and after the exposure time T1.</p><heading id="h0016">[2. A basic configuration of exposure time control in units of regions using an electronic shutter]</heading><p id="p0101" num="0101">Next, a basic configuration of the exposure time control in units of regions using the electronic shutter will be described.</p><p id="p0102" num="0102">The image pickup device 203 is an image sensor capable of setting different exposure times in units of predetermined pixel regions.</p><p id="p0103" num="0103">As an example, an exposure control configuration that enables setting of different exposure times in units of rows will be described with reference to <figref idrefs="f0008">Fig. 8</figref>.</p><p id="p0104" num="0104">Note that, in <figref idrefs="f0008">Fig. 8</figref>, to describe the basic configuration of the exposure<!-- EPO <DP n="18"> --> time control in units of rows, the mechanical shutter 202 is described as being in an open state (open) over an entire period.</p><p id="p0105" num="0105">A plurality of rectangular blocks illustrated in <figref idrefs="f0008">Fig. 8</figref> illustrates an exposure time in units of row blocks made of a row or a plurality of rows.</p><p id="p0106" num="0106">A readout timing performs readout in sequence in every row in a conventional manner according to the focal-plane operation. A line 211 illustrated in <figref idrefs="f0008">Fig. 8</figref> represents the readout timing. The readout processing at a timing shifted by a certain time is performed in each unit of row by sequential scanning in units of rows.</p><p id="p0107" num="0107">Immediately after the readout processing illustrated in the line 211, the next electric charge accumulation of pixels in the image pickup device is instantly started, and reset scanning in which the electric charges accumulated after the readout processing illustrated in the line 211 is reset is executed by an electronic shutter operation.</p><p id="p0108" num="0108">That is, a reset (R) signal illustrated in <figref idrefs="f0008">Fig. 8</figref> is output by the electronic shutter operation in units of rows, and an exposure start timing is controlled in each row.</p><p id="p0109" num="0109">The reset (R) signal illustrated in <figref idrefs="f0008">Fig. 8</figref> is a signal by the electronic shutter operation, and resets the electric charges accumulated after the readout processing. The electric charges accumulated in the pixels from the readout processing of the line 211 to the reset (R) signal is reset.</p><p id="p0110" num="0110">As a result, the period from the reset (R) signal to the next readout signal line 211 (the rectangular block illustrated in the drawing) is set as an accumulation period of the electric charges corresponding to the pixel value.</p><p id="p0111" num="0111">As illustrated in <figref idrefs="f0008">Fig. 8</figref>, the reset signal (R) can be output at different timings in units of row blocks made of units of rows or of a plurality of rows, and can set different exposure times in units of row blocks made of units of rows or of a plurality of rows.</p><p id="p0112" num="0112">To be specific, in a region where an object is bright, the exposure time is set short. Meanwhile, in a region where an object is dark, the exposure time is set long. An image having a wide dynamic range can be output by generating an output image by combining the above. Note that, in outputting<!-- EPO <DP n="19"> --> a final pixel value, pixel value adjustment processing based on each exposure time is executed.</p><p id="p0113" num="0113">Note that, in the example illustrated in <figref idrefs="f0008">Fig. 8</figref>, description has been given by omitting the mechanical shutter as the back curtain that controls the exposure end time. However, a utilizing configuration of the mechanical shutter as the back curtain that controls the exposure end time will be described below.</p><p id="p0114" num="0114">The image signal obtained from the image pickup device 203 is output to the signal processing unit 204.</p><p id="p0115" num="0115">The signal processing unit 204 performs, in consideration of the exposure time of each row described with reference to <figref idrefs="f0008">Fig. 8</figref>, processing of multiplying a gain of a reciprocal number of the exposure time. With this processing, an image having a wide dynamic range and a favorable S/N can be obtained.</p><p id="p0116" num="0116">That is, in a region where an object is bright, the pixel value obtained by setting the exposure time short is obtained, while in a region where an object is dark, the pixel value obtained by setting the exposure time long is obtained, and an output image is generated by combining these pixel values. With this processing, an image having a wide dynamic range can be output. Note that, in outputting a final pixel value, the processing of multiplying a gain of a reciprocal number of the exposure time is executed as pixel value adjustment processing based on each exposure time.</p><p id="p0117" num="0117">The signal processing unit 204 performs camera signal processing similar to a conventional one, such as white balance adjustment processing and gamma correction processing, and obtains the output image 205.</p><p id="p0118" num="0118">Further, the signal processing unit 204 calculates, as described above, a luminance component of the image photographed in advance in units of regions as information for the exposure time control in units of regions at the time of photographing an image, and outputs the luminance component to the exposure time calculation unit 206. For example, the luminance component is a luminance image like the one illustrated in <figref idrefs="f0009">Fig. 9(A)</figref>.</p><heading id="h0017">[3. Processing of calculating an exposure time in units of regions by an exposure time calculation unit]</heading><!-- EPO <DP n="20"> --><p id="p0119" num="0119">Next, processing of calculating an exposure time in units of regions in an exposure time calculation unit will be described.</p><p id="p0120" num="0120">The exposure time calculation unit 206 inputs luminance information in units of image regions from the signal processing unit 204. For example, the luminance image illustrated in <figref idrefs="f0009">Fig. 9(A)</figref> is obtained.</p><p id="p0121" num="0121">The luminance image illustrated in <figref idrefs="f0009">Fig. 9(A)</figref> is configured from the luminance information of pixels of an object in a photographed image.</p><p id="p0122" num="0122">Note that, as described above, in the image photographing processing of a still image, preliminary photographing is performed immediately before an image frame photographed the user, and obtains a luminance image from the preliminary photographed frame. The exposure time control of a next image frame photographed by the user is performed in units of regions using the obtained luminance information.</p><p id="p0123" num="0123">Further, in photographing a moving image, a luminance image like the one illustrated in <figref idrefs="f0009">Fig. 9(A)</figref> is obtained using an image of the preceding photographed frame. That is, the luminance image is obtained from the preceding photographed image frame, and the exposure time control of a subsequent photographed image is performed in units of regions using the luminance information.</p><p id="p0124" num="0124">First, the exposure time calculation unit 206 divides the luminance image obtained from the signal processing unit 204 into row blocks made of a plurality of rows as illustrated in <figref idrefs="f0009">Fig. 9(A)</figref>.</p><p id="p0125" num="0125">Next, a luminance statistic in units of row blocks as illustrated in <figref idrefs="f0009">Fig. 9(B)</figref>. The vertical axis represents a row and the horizontal axis represents a luminance statistic in <figref idrefs="f0009">Fig. 9(B)</figref>. The luminance statistic is a statistic that indicates the brightness of each row block. For example, a luminance average value of a block and the like is used.</p><p id="p0126" num="0126">In the example illustrated in <figref idrefs="f0009">Fig. 9(B)</figref>, the uppermost row block is a row block having the highest luminance, and the bottommost row block is a row block having the lowest luminance.</p><p id="p0127" num="0127">The luminance statistic in units of row blocks illustrated in <figref idrefs="f0009">Fig. 9(B)</figref> corresponds to the luminance image illustrated in <figref idrefs="f0009">Fig. 9(A)</figref>. The uppermost row block of the luminance image illustrated in the <figref idrefs="f0009">Fig. 9(A)</figref> is a bright object like the sky, and the average luminance of the uppermost row block is high. Meanwhile, the bottommost row block is a dark object like soil, and the average luminance of the bottommost row block is low.<!-- EPO <DP n="21"> --></p><p id="p0128" num="0128">As described above, the exposure time calculation unit 206 acquires the luminance image illustrated in <figref idrefs="f0009">Fig. 9(A)</figref> from the signal processing unit 204 to generate a luminance statistic in units of regions illustrated in <figref idrefs="f0009">Fig. 9(B)</figref> (in the present embodiment, in units of row blocks).</p><p id="p0129" num="0129">The exposure time calculation unit 206 further calculates an exposure time to be set in units of regions (in the present example, in units of row blocks) as illustrated in <figref idrefs="f0009">Fig. 9(C)</figref> based on the luminance statistic in units of regions illustrated in <figref idrefs="f0009">Fig. 9(B)</figref>.</p><p id="p0130" num="0130">Note that, as described above, the exposure time in the units of regions is calculated based on a preliminary picked-up image in photographing a still image, and is applied to a still image next photographed by the user.</p><p id="p0131" num="0131">In processing of photographing a moving image, the exposure time is calculated based on the preceding photographed image, and is applied to a next photographed image frame.</p><p id="p0132" num="0132">The exposure time calculation unit 206 performs the following processing in calculation of the exposure time:
<ul><li>a short exposure time is set to a bright region, that is, a high luminance region, and</li><li>a long exposure time is set to a dark region, which is a low luminance region.</li></ul></p><p id="p0133" num="0133">By executing the setting of an exposure time in units of regions, saturation of pixel values is prevented in the high luminance region, and an effective pixel value can be obtained. In addition, a pixel value having a high S/N can be obtained in the low luminance region.</p><p id="p0134" num="0134">As illustrated in <figref idrefs="f0009">Fig. 9(C)</figref>,<br/>
the exposure time of the uppermost row block that is a row block having the highest luminance is set low, and<br/>
the exposure time of the bottommost row block that is a row block having the lowest luminance is set long.</p><p id="p0135" num="0135">With this processing, a pixel value can be obtained, in which the S/N of each region from the high luminance region to the low luminance region has been improved, and an image having a wide dynamic range and a favorable S/N can be photographed.</p><p id="p0136" num="0136">The exposure time calculation unit 206 determines the exposure time<!-- EPO <DP n="22"> --> in units of regions (in this example, in units of row blocks) by the above-described processing, and outputs the determined exposure time information in units of regions to the electronic shutter control unit 207.</p><heading id="h0018">[4. Processing of controlling an exposure time in units of regions by electronic shutter control in consideration of a mechanical shutter operation]</heading><p id="p0137" num="0137">Next, processing of controlling an exposure time in units of regions by electronic shutter control in consideration of a mechanical shutter operation will be described.</p><p id="p0138" num="0138">The electronic shutter control unit 207 performs shutter control based on the exposure time information in units of regions. To be specific, control of the exposure start time of the image pickup device (CMOS image sensor) 203 is executed by the electronic shutter control unit 207.</p><p id="p0139" num="0139">In controlling an individual, processing in consideration of an operation timing of the mechanical shutter 202 controlled by the mechanical shutter control unit 208 is performed.</p><p id="p0140" num="0140">Details of the processing will be described with reference to <figref idrefs="f0010">Fig. 10</figref>.</p><p id="p0141" num="0141"><figref idrefs="f0010">Fig. 10 (A)</figref> illustrates a setting result of the exposure time in units of regions (in this example, in units of row blocks) calculated by the exposure time calculation unit 206 illustrated in <figref idrefs="f0009">Fig. 9(C)</figref>. That is, setting information of the exposure time in units of regions calculated based on the luminance of the object.</p><p id="p0142" num="0142">In the setting example of the exposure time illustrated in <figref idrefs="f0010">Fig. 10(A)</figref>,<br/>
the setting of the exposure time of the uppermost row block that is a row block having the highest luminance is short, and<br/>
the setting of the exposure time of the bottommost row block that is a row block having the lowest luminance is long.</p><p id="p0143" num="0143"><figref idrefs="f0010">Fig. 10(B)</figref> is a diagram illustrating an example of the shutter control for executing the exposure time control in units of regions according to the exposure time in units of regions illustrated in <figref idrefs="f0010">Fig. 10(A)</figref>.</p><p id="p0144" num="0144"><figref idrefs="f0010">Fig. 10(B)</figref> illustrates an exposure timing of a representative row of each row block.</p><p id="p0145" num="0145">Note that the row block is made of a plurality of rows, but for the purpose of simple description, in <figref idrefs="f0010">Fig. 10(B)</figref>, only one representative row<!-- EPO <DP n="23"> --> is selected from one row block, and the exposure timing of the representative row is illustrated. In the following description related to <figref idrefs="f0010">Fig. 10</figref>, a "row" means the representative row of a row block.</p><p id="p0146" num="0146"><figref idrefs="f0010">Fig. 10(B)</figref> is a graph in which the vertical axis represents a row of the image pickup device, and the horizontal axis represents a time.</p><p id="p0147" num="0147">The reset signal (R) is an electronic shutter operation timing serving as an exposure start time of each row.</p><p id="p0148" num="0148">The electric charges accumulated in the pixels of each row is reset before an input of the reset signal (R), and the electric charges accumulated in the pixels during a period from the input of the reset signal (R) to the mechanical shutter timing 221 illustrated in <figref idrefs="f0010">Fig. 10(B)</figref> are output as a pixel value.</p><p id="p0149" num="0149">It is a shading period on and after the mechanical shutter timing 221, and sequential readout processing of the pixel value is then executed at a readout timing 222 in units of rows. That is, the readout processing of the pixel value is performed according to the focal-plane operation.</p><p id="p0150" num="0150">Note that the vertical scanning circuit of the image pickup device 203 has a circuit that generates a reset pulse at a timing of the electronic shutter in each row like the one illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>.</p><p id="p0151" num="0151">Note that <figref idrefs="f0010">Fig. 10</figref> illustrates:
<ol><li>(a) an input of the reset (R) signal,</li><li>(b) the mechanical shutter operation timing 221, and</li><li>(c) the readout timing 222</li></ol>
of one image frame. For example, at the time of photographing a moving image, the processing of these (a), (b), and (c) is repeatedly executed in units of frames.</p><p id="p0152" num="0152">As illustrated in <figref idrefs="f0010">Fig. 10(A)</figref>, in the setting example of the exposure time based on the luminance of the preceding photographed image in units of regions,<br/>
the exposure time of a representative row of the head row block (hereinafter, referred to as head row) is set to be Tex1, and<br/>
the exposure time of a representative row of the last row block (hereinafter, referred to as bottom row) is set to be TexN.</p><p id="p0153" num="0153">The set exposure times in the units of regions are, as described with reference to <figref idrefs="f0009">Fig. 9</figref> above, the exposure times in units of regions calculated by the exposure time calculation unit 206 based on the luminance information<!-- EPO <DP n="24"> --> of the preceding photographed image of units of regions.</p><p id="p0154" num="0154">The mechanical shutter control unit 208 controls, as illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>, the mechanical shutter to start earlier than the readout 222 of the image pickup device.</p><p id="p0155" num="0155">The electronic shutter control unit 207 controls an output timing of the reset signal (R) in units of regions according to the setting of the exposure time in units of regions illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>. That is, the output timing of the reset signal (R) as the exposure start time is determined in units of rows, and is output to the image pickup device 203.</p><p id="p0156" num="0156">The operation timing of the electronic shutter is determined based on the setting information of the exposure time in units of regions and the mechanical shutter operation timing 221 illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>.</p><p id="p0157" num="0157">As illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>, the mechanical shutter timing 221 that functions as the back curtain that terminates the exposure time is controlled to start earlier than the readout 222 of the image pickup device. The scanning speed of the mechanical shutter is known, and, as illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>,<br/>
the operation timing of the mechanical shutter of the head row is represented as Tm1, and<br/>
the operation timing of the mechanical shutter of the bottom row is represented as TmN.</p><p id="p0158" num="0158">The electronic shutter control unit 207 determines the electronic shutter operation timing at which the reset signal (R) functioning as the front curtain that starts the exposure time is output from these pieces of information.</p><p id="p0159" num="0159">For example, as illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>,<br/>
the electronic shutter operation timing of the head row is Tr1, and<br/>
the electronic shutter operation timing of the bottom row is TrN.</p><p id="p0160" num="0160">The electronic shutter control unit 207 calculates Tr1 and TrN with the following expressions. <maths id="math0003" num=""><math display="block"><mi>Tr</mi><mo>⁢</mo><mn>1</mn><mo>=</mo><mi>Tm</mi><mo>⁢</mo><mn>1</mn><mo>-</mo><mi>Tex</mi><mo>⁢</mo><mn>1</mn></math><img id="ib0003" file="imgb0003.tif" wi="45" he="6" img-content="math" img-format="tif"/></maths> <maths id="math0004" num=""><math display="block"><mi>TrN</mi><mo>=</mo><mi>TmN</mi><mo>-</mo><mi>TexN</mi></math><img id="ib0004" file="imgb0004.tif" wi="45" he="7" img-content="math" img-format="tif"/></maths><br/>
where,
<ul><li>Tm1 represents the operation timing of the mechanical shutter of the head row,<!-- EPO <DP n="25"> --></li><li>TmN represents the operation timing of the mechanical shutter of the bottom row,</li><li>Tex1 represents the exposure time of the head row, and</li><li>TexN is the exposure time of the bottom row.</li></ul></p><p id="p0161" num="0161">With the above described expressions,<br/>
the electronic shutter operation timing of the head row: Tr1, and<br/>
the electronic shutter operation timing of the bottom row: TrN are calculated.</p><p id="p0162" num="0162">Regarding other rows, the electronic shutter operation timing (an output timing of the reset signal (R)) is calculated according to similar calculation expressions.</p><p id="p0163" num="0163">For example, the electronic shutter timing Tri of a row i is calculated with the following expression: <maths id="math0005" num=""><math display="block"><mi>Tri</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texi</mi></math><img id="ib0005" file="imgb0005.tif" wi="44" he="7" img-content="math" img-format="tif"/></maths><br/>
where,
<ul><li>Tmi is the operation timing of the mechanical shutter in the row i, and</li><li>Texi is the exposure time in the row i.</li></ul></p><p id="p0164" num="0164">As described above, the image pickup apparatus of the present embodiment sets<br/>
the mechanical shutter operation timing 221 that defines the exposure end time ahead of the readout timing 222, and<br/>
determines electronic shutter operation timing(output timing of the reset signal (R)) as the exposure start time in units of regions base on the mechanical shutter operation timing 221 in units of regions and the exposure time setting information (<figref idrefs="f0010">Fig. 10(A)</figref>) in units of regions.</p><p id="p0165" num="0165">By performing the processing, the exposure time setting in units of regions (in the present embodiment, in units of row blocks) illustrated as the rectangular block on the left side of the mechanical shutter operation timing 221 illustrated in <figref idrefs="f0010">Fig. 10(B)</figref> is realized.</p><p id="p0166" num="0166">This exposure time in units of regions is based on the preceding photographed image that has performed the luminance measurement, and sets the exposure time that reflects the brightness of the object.</p><p id="p0167" num="0167">In this way, according to the configuration of the present embodiment, setting processing of the exposure time in units of regions based on the<!-- EPO <DP n="26"> --> object luminance in units of regions is realized. As a result, even in a case where an object having a wide range of luminance from a high luminance region to a low luminance region is photographed, the saturation of the pixel value in the high luminance region is prevented, and the obtainment of the effective pixel value having less noise in the low luminance region becomes possible, whereby an image having a wide dynamic range can be output. Note that, when setting of different exposure times is performed, the output image is generated in the signal processing unit 204, as described above, by performing a pixel value adjustment with a gain value according to the exposure time.</p><p id="p0168" num="0168">Further, in the image pickup apparatus of the present embodiment, as illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>, the mechanical shutter operation timing 221 that defines the end of the exposure time is set ahead of the readout timing 222. In the mechanical shutter operation timing 221, the exposure end time in units of regions (in the present example, in units of row blocks) is set.</p><p id="p0169" num="0169">As illustrated in <figref idrefs="f0010">Fig. 10(B)</figref>, the delay in time between rows of the mechanical shutter operation timing 221 is smaller than the delay in time between rows of the readout timing executed as a focal plane operation.</p><p id="p0170" num="0170">To be specific, the operation time Tm (all) of the mechanical shutter from the head row to the bottom row is calculated with the following expression: <maths id="math0006" num=""><math display="block"><mi>Tm</mi><mfenced><mi>all</mi></mfenced><mo>=</mo><mi>TmN</mi><mo>-</mo><mi>Tm</mi><mo>⁢</mo><mn>1</mn></math><img id="ib0006" file="imgb0006.tif" wi="48" he="6" img-content="math" img-format="tif"/></maths><br/>
where,
<ul><li>Tm1 represents the operation timing of the mechanical shutter of the head row, and</li><li>TmN is the operation timing of the mechanical shutter of the bottom row.</li></ul></p><p id="p0171" num="0171">Meanwhile, the operation time Tread(all) of the pixel readout processing from the head row to the bottom row is calculated with the following expression: <maths id="math0007" num=""><math display="block"><mi>Tread</mi><mfenced><mi>all</mi></mfenced><mo>=</mo><mi>TreadN</mi><mo>-</mo><mi>Tread</mi><mo>⁢</mo><mn>1</mn></math><img id="ib0007" file="imgb0007.tif" wi="72" he="6" img-content="math" img-format="tif"/></maths><br/>
where,
<ul><li>Tread1 represents the readout timing of the head row, and</li><li>TreadN represents the readout timing of the bottom row.</li></ul></p><p id="p0172" num="0172">As understood from <figref idrefs="f0010">Fig. 10(B)</figref>,<!-- EPO <DP n="27"> --> <maths id="math0008" num=""><math display="block"><mfenced separators=""><mi>TmN</mi><mo>-</mo><mi>Tm</mi><mo>⁢</mo><mn>1</mn></mfenced><mo>&lt;</mo><mfenced separators=""><mi>TreadN</mi><mo>-</mo><mi>Tread</mi><mo>⁢</mo><mn>1</mn></mfenced></math><img id="ib0008" file="imgb0008.tif" wi="76" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0173" num="0173">That is, <maths id="math0009" num=""><math display="block"><mi>Tm</mi><mfenced><mi>all</mi></mfenced><mo>&lt;</mo><mi>Tread</mi><mfenced><mi>all</mi></mfenced></math><img id="ib0009" file="imgb0009.tif" wi="51" he="7" img-content="math" img-format="tif"/></maths></p><p id="p0174" num="0174">That is, by using the mechanical shutter for the control of the end time of the exposure period, the time gaps of the exposure period end time from the upper end row to the bottom row can be reduced.</p><p id="p0175" num="0175">As a result, for example, when a moving object is photographed or when the photographing is performed with the camera being moved, the photographing of the object in which the upper end and the lower end of the photographed image are in almost the same period of time becomes possible, and a high-quality image in which no distortion occurs or the distortion is suppressed, as illustrated with reference to <figref idrefs="f0005">Fig. 5</figref> can be generated and output.</p><heading id="h0019">[5. Other embodiments]</heading><p id="p0176" num="0176">Next, other configuration examples of the image pickup apparatus according to the present invention will be described.</p><p id="p0177" num="0177">The image pickup device (CMOS image sensor) 203 in the above-described embodiment has a configuration that enables the control of an arbitrary exposure time where a unit of the exposure time control is a units of row, that is in units of rows as illustrated in <figref idrefs="f0008">Fig. 8</figref>.</p><p id="p0178" num="0178">However, the unit of control of the exposure time is not limited to the unit of row, and can be set to various units of regions of the image pickup device other than the row.</p><p id="p0179" num="0179">For example, by combining the above-described technique of the present invention and the configurations disclosed in the above-described Patent Documents 3 and 4 and Non Patent Document 1, control in which a different exposure time in each arbitrary region is possible.</p><p id="p0180" num="0180">As the unit of the exposure control is not limited to the unit of row, and a configuration of performing control in each pixel, or in each block made of a plurality of pixels is possible. For example, by using an image pickup device having a configuration in which the reset signal that controls the exposure start time described with reference to <figref idrefs="f0010">Fig. 10(b)</figref> is input in each pixel, or in each pixel block, the exposure time setting in each pixel or in each pixel block becomes possible.</p><p id="p0181" num="0181"><!-- EPO <DP n="28"> --> For example, like <figref idrefs="f0011">Fig. 11</figref>, a configuration in which block division is performed in units of matrices, and the exposure time control is performed in each matrix block is possible.</p><p id="p0182" num="0182">An exposure time calculation unit 206 inputs the luminance information in units of image regions from a signal processing unit 204. For example, a luminance image illustrated in <figref idrefs="f0011">Fig. 11(A)</figref> is obtained.</p><p id="p0183" num="0183">The luminance image illustrated in <figref idrefs="f0011">Fig. 11(A)</figref> is configured from luminance information of pixels of an object in a photographed image.</p><p id="p0184" num="0184">The exposure time calculation unit 206 first divides the luminance image obtained from the signal processing unit 204 in units of matrix blocks made of one or more rows and lines as illustrated in <figref idrefs="f0011">Fig. 11(A)</figref>.</p><p id="p0185" num="0185">Note that an identifier of the matrix block is indicated as a matrix block ij, using<br/>
a row-direction identifier of block, which corresponds to the number of blocks from above: i, and<br/>
a line-direction identifier of block, which corresponds to the number of blocks from left: j</p><p id="p0186" num="0186">The matrix block ij indicates a matrix block corresponding to a i-th block from above and a j-th block from left.</p><p id="p0187" num="0187">Next, the exposure time calculation unit 206 calculates a luminance statistic in units of matrix blocks as illustrated in <figref idrefs="f0011">Fig. 11(B)</figref>. The axes of <figref idrefs="f0011">Fig. 11 (B)</figref> represent a row, line, and luminance statistic. The luminance statistic is a statistic expressing the brightness of matrix blocks. For example, a luminance average value of a block and the like are used.</p><p id="p0188" num="0188">In this way, the exposure time calculation unit 206 obtains the luminance image illustrated in <figref idrefs="f0011">Fig. 11 (A)</figref> from the signal processing unit 204, and generates the luminance statistic in units of regions (in the present embodiment, in units of matrix blocks) illustrated in <figref idrefs="f0011">Fig. 11(B)</figref>.</p><p id="p0189" num="0189">Further, the exposure time calculation unit 206 calculates an exposure time to be set in units of regions (in the present example, in units of matrix blocks) as illustrated in <figref idrefs="f0011">Fig. 11 (C)</figref> based on the luminance statistic in units of regions illustrated in <figref idrefs="f0011">Fig. 11(B)</figref>.</p><p id="p0190" num="0190">Note that, as described above, the exposure time in the units of regions is calculated based on a preliminary picked-up image in photographing a still image, and is applied to a next still image photographed by the user.<!-- EPO <DP n="29"> --></p><p id="p0191" num="0191">In the processing of photographing a moving image, the exposure time is calculated based on a preceding photographed image, and is applied to a next photographed image frame.</p><p id="p0192" num="0192">The exposure time calculation unit 206 performs the following processing in calculating the exposure time:
<ul><li>setting a short exposure time in a bright region, that is, a high luminance region, and</li><li>setting a long exposure time in a dark region, that is, a low luminance region.</li></ul></p><p id="p0193" num="0193">By executing such setting of the exposure time in units of regions, the saturation of pixel values in the high luminance region can be prevented, and an effective pixel value can be obtained. In addition, a pixel value having a high S/N can be obtained in the low luminance region.</p><p id="p0194" num="0194">The exposure time calculation unit 206 determines, by the above-described processing, the exposure time in units of regions (in the present example, in units of matrix blocks), and outputs the determined exposure time information in units of regions to the electronic shutter control unit 207.</p><p id="p0195" num="0195">The electronic shutter control unit 207 determines an electronic shutter operation timing at which a reset signal (R) that functions as a front curtain that starts the exposure time is output, from the information, in units of matrix blocks.</p><p id="p0196" num="0196">In this case, a focal-plane shutter operation and a mechanical shutter operation are controlled in units of rows, similarly to the control described with reference to <figref idrefs="f0010">Fig. 10</figref> above. As for a reset operation serving as exposure start is independently controlled in the row direction and in the line direction.</p><p id="p0197" num="0197">An electronic shutter timing Trij of the row i and the line j, which outputs the reset signal (R) that functions as a front curtain that starts the exposure time of the matrix block ij is calculated with the following expression: <maths id="math0010" num=""><math display="block"><mi>Trij</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texij</mi></math><img id="ib0010" file="imgb0010.tif" wi="48" he="7" img-content="math" img-format="tif"/></maths><br/>
where,
<ul><li>Tmi represents an operation timing of the mechanical shutter in the matrix block ij, and<!-- EPO <DP n="30"> --></li><li>Texij represents the exposure time in the matrix block ij (see <figref idrefs="f0011">Fig. 11(c)</figref>).</li><li>The exposure time control in units of matrix blocks that are various pixel sets is realized by the above-described exposure time control.</li></ul></p><p id="p0198" num="0198">Further, in the above-described embodiments, a configuration has been described, in which the exposure time of a next photographed image in units of regions is controlled based on the luminance information of an image photographed in advance. However, as another example, a configuration of periodically controlling different exposure times, as illustrated in <figref idrefs="f0012">Fig. 12</figref> may be employed.</p><p id="p0199" num="0199">As a setting example of the unit of exposure control, control can be performed in various units of regions, such as in units of pixels, in a particular pixel cycle, and with a pixel pattern, as illustrated in <figref idrefs="f0013">Fig. 13. Fig. 13</figref> is a diagram describing an example of region division of an image pickup device that performs the exposure time control in units of predetermined regions.</p><p id="p0200" num="0200"><ul><li><figref idrefs="f0013">Fig. 13(a)</figref> illustrates an example in which setting of two exposure times is performed in units of two rows.</li><li><figref idrefs="f0013">Fig. 13(b)</figref> illustrates an example in which setting of two exposure times is performed in units of four pixels.</li><li><figref idrefs="f0013">Fig. 13(c)</figref> illustrates an example in which setting of two exposure times is performed in units of lines of three pixels both in horizontal and vertical directions.</li></ul></p><p id="p0201" num="0201">By configuring an image pickup device that enables an output of the reset signal described with reference to <figref idrefs="f0010">Fig. 10(b)</figref>, in units of various regions as described above, and by outputting the reset signal to the image pickup device in units of regions, the exposure time control in units of regions having various forms other than the unit of row becomes possible.</p><heading id="h0020">[6. Correction processing responding to an operation change of a mechanical shutter]</heading><p id="p0202" num="0202">Next, an embodiment having a correction processing configuration responding to an operation change of a mechanical shutter will be described.</p><p id="p0203" num="0203">In the above-described embodiments, as described with reference to <figref idrefs="f0007">Fig. 7</figref>, it has been described assuming that the scanning speed of the mechanical shutter is known and the scanning speed is not changed. However, the scanning<!-- EPO <DP n="31"> --> speed of the mechanical shutter may be changed due to aging or other changes in electrical and mechanical characteristics.</p><p id="p0204" num="0204">In such a case, if the processing using the calculation expression of an output timing of an electronic shutter (reset signal (R)) described with reference to <figref idrefs="f0008">Fig. 8</figref> above, a wrong exposure time may be set.</p><p id="p0205" num="0205">To be specific, when the output timing of the electronic shutter (reset signal (R)) is calculated using the following expression that calculates the electronic shutter timing Tri in the exposure time calculation unit 206, there is a possibility that an exposure time (Texi) to be controlled cannot be obtained. <maths id="math0011" num=""><math display="block"><mi>Tri</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texi</mi></math><img id="ib0011" file="imgb0011.tif" wi="43" he="7" img-content="math" img-format="tif"/></maths><br/>
where,
<ul><li>Tmi represents an operation timing of the mechanical shutter in the row i, and</li><li>Texi represents the exposure time in the row i.</li></ul></p><p id="p0206" num="0206">That is, in the above expression,<br/>
there is a possibility of generating an error caused by the change of [Tmi] that is an operation timing of the mechanical shutter in the row i.</p><p id="p0207" num="0207">Hereinafter, to prevent such a generation of an error, a configuration example provided with a sensitivity difference compensation unit in a signal processing unit 204 as illustrated in <figref idrefs="f0014">Fig. 14</figref> will be described.</p><p id="p0208" num="0208">A processing example of the sensitivity difference compensation unit configured in the signal processing unit 204 will be described.</p><p id="p0209" num="0209">In photographing a still image, the exposure time calculation unit 206 obtains a luminance image from a camera signal processing unit 204 by performing preliminary image pickup.</p><p id="p0210" num="0210">For example, the luminance image is the one described with reference to <figref idrefs="f0009">Fig. 9(a)</figref> above.</p><p id="p0211" num="0211">In preliminary photographing for obtaining luminance information, an image is obtained only by a focal-plane shutter operation by electronic shutter scanning and readout scanning. That is, preliminary photographing for obtaining a luminance image is performed without using the mechanical shutter to define an end time of the exposure period.</p><p id="p0212" num="0212">With this preliminary photographing processing, the luminance<!-- EPO <DP n="32"> --> statistic can be calculated without being subject to the mechanical shutter.</p><p id="p0213" num="0213">Following that, as actual photographing, the photographing processing described with reference to <figref idrefs="f0010">Fig. 10</figref> of the above-described embodiment, that is,<br/>
a photographed image is obtained by controlling an exposure start time using an electronic shutter (reset signal (R)), and<br/>
controlling the exposure end time using the mechanical shutter.</p><p id="p0214" num="0214">At the time of this actual photographing, the reset signal (R) is output according to an electronic shutter timing Tri calculated with the following expression, which is an expression of the electronic shutter timing Tri calculated in the exposure time calculation unit 206: <maths id="math0012" num=""><math display="block"><mi>Tri</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texi</mi></math><img id="ib0012" file="imgb0012.tif" wi="46" he="6" img-content="math" img-format="tif"/></maths></p><p id="p0215" num="0215">When the value of [Tmi] in the above expression, that is, the operation timing of the mechanical shutter in the row i is correct, assuming that an object is not moved from start of preliminary photographing to end of actual photographing, the luminance statistic calculated from an image by the preliminary photographing and the luminance statistic calculated from an image by the actual photographing are supposed to be exactly equal.</p><p id="p0216" num="0216">However, when the scanning speed of the mechanical shutter is changed due to aging, for example, and the value [Tmi] in the above expression, that is, the operation timing of the mechanical shutter in the row [i] is changed, an actual exposure time at the time of image photographing processing is different from an anticipated exposure time [Texi] when control according to the above expression is performed.</p><p id="p0217" num="0217">As a result, the luminance statistic of the region has a different value by the gap between the exposure times.</p><p id="p0218" num="0218">A luminance difference occurs in the corresponding regions of the preliminary photographed image and of the actual photographed image due to the gap between the exposure times.</p><p id="p0219" num="0219">The sensitivity difference compensation unit of the signal processing unit 204 illustrated in <figref idrefs="f0014">Fig. 14</figref> calculates the luminance difference between the corresponding image regions of the preliminary photographed image and of the actual photographed image, and calculates a gap of the operation timing of the mechanical shutter, and a gap of the exposure time at the time of the actual photographing.<!-- EPO <DP n="33"> --></p><p id="p0220" num="0220">Further, the sensitivity difference compensation unit calculates, from the calculated values, a pixel value when a correct exposure time is set, and performs image correction processing in which the calculated pixel value, that is, a pixel value when a proper exposure time is set, is set to a pixel value of an output image to generate the output image.</p><p id="p0221" num="0221">By performing the image correction in this way, even if there is a change in the operation of the mechanical shutter, an output image in which a corrected pixel value is set according to a correct exposure time can be generated and output.</p><p id="p0222" num="0222">Note that, as a setting example of the unit of exposure control, a plurality of examples illustrated in <figref idrefs="f0013">Fig. 13</figref> has been described, regarding various units of regions, such as by units of pixels, in a particular pixel cycle, and with a pixel pattern. However, other setting examples can be further employed. For example, configurations illustrated in <figref idrefs="f0015">Figs. 15(a) to 15(h)</figref> are possible.</p><p id="p0223" num="0223"><ul><li><figref idrefs="f0015">Fig. 15(a)</figref> illustrates an example having a similar configuration to <figref idrefs="f0013">Fig. 13(a)</figref>, and in which setting of two exposure times is performed in units of two rows.</li><li><figref idrefs="f0015">Fig. 15(b)</figref> illustrates an example having a similar configuration to <figref idrefs="f0013">Fig. 13(b)</figref>, and in which setting of two exposure times is performed in units of four pixels.</li><li><figref idrefs="f0015">Fig. 15(c)</figref> illustrates an example having a similar configuration to <figref idrefs="f0013">Fig. 13(c)</figref>, and in which setting of two exposure times is performed in units of lines of three pixels both in horizontal and vertical directions.</li><li><figref idrefs="f0015">Fig. 15(d)</figref> illustrates an example in which setting of two exposure times is performed in units of two rows.</li><li><figref idrefs="f0015">Fig. 15(e)</figref> illustrates an example in which setting of two exposure times is performed in units of one row.</li><li><figref idrefs="f0015">Fig. 15(f)</figref> illustrates an example in which setting of two exposure times is performed in units of one pixel.</li><li><figref idrefs="f0015">Fig. 15(g)</figref> illustrates an example in which setting of two exposure times is performed in units of one row.</li><li><figref idrefs="f0015">Fig. 15(h)</figref> is an example in which a predetermined pattern is set in units of four rows, and setting of two exposure times is performed.</li></ul></p><p id="p0224" num="0224">With these various units of regions, the image pickup device capable of outputting a reset signal described with reference to <figref idrefs="f0010">Fig. 10(b)</figref> is<!-- EPO <DP n="34"> --> configured, and it is configured such that the reset signal is output to the image pickup device in units of regions, whereby exposure time control in units of regions having various forms other than the units of rows becomes possible.</p><p id="p0225" num="0225">As described above, the present invention has been described in detail with reference to the specific embodiments. However, it is apparent a person skilled in the art can achieve alteration and substitution of the embodiments without departing from the gist of the present invention. That is, the present invention has been exemplarily disclosed, and should not be interpreted in a limited manner. To judge the gist of the present invention, the section of the claims should be considered.</p><p id="p0226" num="0226">Further, the series of processing described in the specification can be executed by hardware, software, or a composite configuration of both of them. When the processing by software is executed, a program in which processing sequence is recorded can be installed into a memory in a computer incorporated in dedicated hardware and executed, or can be installed into a general-purpose computer capable of executing various types of processing and executed. For example, the program can be recorded on a recording medium in advance. Other than installing the program from the recording medium to the computer, the program can be received through a network such as a local area network (LAN), and the Internet, and can be installed into a recording medium such as a built-in hard disk.</p><p id="p0227" num="0227">Note that the various types of processing described in the specification is not only executed in time series according to the description, but also may be executed in parallel or in an individual manner according to processing ability of the device that executes the processing or as necessary. Further, the system in the present specification is a theoretical assembled configuration made of a plurality of devices, and is not limited to one having devices in configurations in the same housing.</p><heading id="h0021">INDUSTRIAL APPLICABILITY</heading><p id="p0228" num="0228">As described above, according to an embodiment of the present invention, an apparatus and a method are provided, which realize setting of an exposure time in units of regions in an image pickup apparatus, and photographing of an image having reduced image distortion.<!-- EPO <DP n="35"> --></p><p id="p0229" num="0229">To be specific, an electronic shutter control unit that controls an exposure start time of the image pickup device by an electronic shutter operation, and a mechanical shutter control unit that controls an exposure end time of the image pickup device by a mechanical shutter operation are included. The electronic shutter control unit calculates an exposure start time in units of image regions based on an exposure time individually set in units of predetermined image regions, such as in units of row blocks, and an operation time of a mechanical shutter in units of image regions, and operates an electronic shutter at the calculated exposure start time in units of image regions.</p><p id="p0230" num="0230">For example, the exposure time is subtracted from the mechanical shutter operation time in units of row blocks, and a reset time as the exposure start time is calculated as an electronic shutter operation time, so that exposure time control in units of regions is executed.</p><p id="p0231" num="0231">With this processing, exposure control set in an arbitrary exposure time becomes possible in units of image regions, and a time difference between the exposure end times can be reduced by the mechanical shutter, whereby, for example, the image distortion likely to occur at the time of photographing a moving object can be reduced.</p><heading id="h0022">REFERENCE SIGNS LIST</heading><p id="p0232" num="0232"><dl id="dl0001" compact="compact"><dt>101</dt><dd>Image pickup device</dd><dt>102</dt><dd>Vertical scanning circuit</dd><dt>103</dt><dd>Horizontal scanning circuit</dd><dt>104</dt><dd>Pixel</dd><dt>111</dt><dd>Horizontal reset line</dd><dt>112</dt><dd>Horizontal select line</dd><dt>113</dt><dd>Vertical signal line</dd><dt>114</dt><dd>Signal output line</dd><dt>201</dt><dd>Optical lens</dd><dt>202</dt><dd>Mechanical shutter</dd><dt>203</dt><dd>Image pickup device</dd><dt>204</dt><dd>Signal processing unit</dd><dt>205</dt><dd>Output image</dd><dt>206</dt><dd>Exposure time calculation unit</dd><dt>207</dt><dd>Electronic shutter control unit</dd><dt>208</dt><dd>Mechanical shutter control unit</dd></dl></p></description><claims mxw-id="PCLM56982281" lang="EN" load-source="patent-office"><!-- EPO <DP n="36"> --><claim id="c-en-0001" num="0001"><claim-text>An image pickup apparatus comprising:
<claim-text>an image pickup device;</claim-text>
<claim-text>an electronic shutter control unit configured to control an exposure start time of the image pickup device by an electronic shutter operation; and</claim-text>
<claim-text>a mechanical shutter control unit configured to control an exposure end time of the image pickup device by a mechanical shutter operation,</claim-text>
<claim-text>wherein the electronic shutter control unit calculates an exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and controls an electronic shutter to operate at the calculated exposure start time in units of image regions.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The image pickup apparatus according to claim 1, comprising:
<claim-text>an exposure time calculation unit configured to calculate an exposure time of a subsequent photographed image in units of image regions according to luminance information in units of image regions obtained from a preliminary photographed image,</claim-text>
<claim-text>wherein the electronic shutter control unit calculates an exposure start time in units of image regions based on the exposure time in units of image regions calculated by the exposure time calculation unit, and an operation time of the mechanical shutter in units of image regions, and controls the electronic shutter to operate at the calculated exposure start time in units of image regions.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The image pickup apparatus according to claim 2, wherein the exposure time calculation unit executes exposure time calculation processing in units of image regions, in which<br/>
an exposure time of the subsequent photographed image is set to be a long time for an image region having low luminance in units of image regions and obtained from the preliminary photographed image, and<br/>
an exposure time of the subsequent photographed image is set to be a short time for an image region having high luminance in units of image regions and obtained from the preliminary photographed image.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The image pickup apparatus according to claim 2, wherein the exposure time calculation unit calculates an exposure time of the subsequent<!-- EPO <DP n="37"> --> photographed image frame in units of image regions according to the luminance information obtained from a preceding photographed image frame of an image frame configuring a photographed moving image when the moving image is photographed.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The image pickup apparatus according to claim 1, comprising:
<claim-text>an exposure time calculation unit configured to calculate an exposure time in units of row blocks configured from one or more rows as an image region according to luminance information based on a preliminary photographed image,</claim-text>
<claim-text>wherein the electronic shutter control unit</claim-text>
<claim-text>has a configuration configured to calculate an exposure start time in units of image regions based on the exposure time in units of row blocks calculated by the exposure time calculation unit, and an operation time of the mechanical shutter in units of row blocks, and to control an electronic shutter to operate at the calculated exposure start time in units of image regions, and</claim-text>
<claim-text>calculates an exposure start time of a row block i: Tri according to the following expression: <maths id="math0013" num=""><math display="block"><mi>Tri</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texi</mi></math><img id="ib0013" file="imgb0013.tif" wi="48" he="7" img-content="math" img-format="tif"/></maths>
<claim-text>where a row block number is i,</claim-text>
<claim-text>the exposure time of the row block i is Texi, and</claim-text>
<claim-text>a mechanical shutter operation time of the row block i is Tmi.</claim-text></claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The image pickup apparatus according to claim 1, comprising:
<claim-text>an exposure time calculation unit configured to calculate an exposure time in units of matrix blocks configured from one or more pixels as an image region according to luminance information based on a preliminary photographed image,</claim-text>
<claim-text>wherein the electronic shutter control unit</claim-text>
<claim-text>has a configuration configured to calculate an exposure start time in units of image regions based on the exposure time in units of matrix blocks calculated by the exposure time calculation unit, and an operation time of the mechanical shutter in units of rows, and to control an electronic shutter to operate at the calculated exposure start time in units of image regions, and</claim-text>
<claim-text>calculates an exposure start time of a matrix block ij : Trij according to the following expression: <maths id="math0014" num=""><math display="block"><mi>Trij</mi><mo>=</mo><mi>Tmi</mi><mo>-</mo><mi>Texij</mi></math><img id="ib0014" file="imgb0014.tif" wi="52" he="9" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="38"> -->
<claim-text>where a row block number is i, a line block number is j,</claim-text>
<claim-text>the exposure time of the matrix block ij is Texij, and</claim-text>
<claim-text>a mechanical shutter operation time of the matrix block ij is Tmi.</claim-text></claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The image pickup apparatus according to claim 1, wherein<br/>
the image pickup device is an image pickup device configured to execute pixel value readout processing in units of rows in sequence, and<br/>
the mechanical shutter control unit controls the mechanical shutter to operate at a time preceding the pixel value readout processing of the image pickup device to terminate the exposure time.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The image pickup apparatus according to claim 1, wherein the electronic shutter control unit<br/>
outputs a reset signal resetting an electric charge accumulated in each pixel of the image pickup device, in units of image regions of the image pickup device, and<br/>
sets the exposure time of a unit of each image region as a time from outputting of the reset signal to the operation time of the mechanical shutter, and perform exposure time control in units of image regions.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The image pickup apparatus according to claim 1, further comprising:
<claim-text>a signal processing unit configured to input an image output by an image pickup device by image pickup processing in which different exposure times are set in units of image regions, and to calculate a pixel value of the output image by multiplying a gain corresponding to a reciprocal number of the exposure time to the input image.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The image pickup apparatus according to claim 1, further comprising:
<claim-text>a sensitivity difference compensation unit configured to execute luminance comparison between a first image photographed without operating the mechanical shutter and a second image photographed with operating the mechanical shutter, to calculate a difference between a calculated exposure time in units of regions set to the second image and an actual exposure time of the actually photographed second image in units of regions based on information of the luminance comparison, and to execute pixel value correction compensating the calculated difference between the exposure times.</claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>A method of controlling an image pickup apparatus executed in the<!-- EPO <DP n="39"> --> image pickup apparatus, the method comprising:
<claim-text>an electronic shutter control step of controlling an exposure start time of an image pickup device by an electronic shutter operation by an electronic shutter control unit; and</claim-text>
<claim-text>a mechanical shutter control step of controlling an exposure end time of the image pickup device by a mechanical shutter operation, executed by a mechanical shutter control unit,</claim-text>
<claim-text>wherein the electronic shutter control step executes</claim-text>
<claim-text>a step of calculating an exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and</claim-text>
<claim-text>a step of controlling an electronic shutter to operate at the calculated exposure start time in units of image regions.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>A program for causing an image pickup apparatus to execute image pickup processing executing:
<claim-text>an electronic shutter control step of causing an electronic shutter control unit to control an exposure start time of an image pickup device by an electronic shutter operation, and</claim-text>
<claim-text>a mechanical shutter control step of causing a mechanical shutter control unit to control an exposure end time of the image pickup device by a mechanical shutter operation, and</claim-text>
<claim-text>the electronic shutter control step executes</claim-text>
<claim-text>a step of calculating an exposure start time in units of image regions based on an exposure time individually set in units of image regions, and an operation time of the mechanical shutter in units of image regions, and</claim-text>
<claim-text>a step of controlling an electronic shutter to operate at the calculated exposure start time in units of image regions.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW16670666" load-source="patent-office"><!-- EPO <DP n="40"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="160" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="41"> --><figure id="f0002" num="2(A),2(B)"><img id="if0002" file="imgf0002.tif" wi="147" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="42"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="165" he="172" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="43"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="162" he="174" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="44"> --><figure id="f0005" num="5(A),5(B),5(C),5(D)"><img id="if0005" file="imgf0005.tif" wi="165" he="171" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="45"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="152" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="46"> --><figure id="f0007" num="7(A),7(B)"><img id="if0007" file="imgf0007.tif" wi="150" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="47"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="165" he="179" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="48"> --><figure id="f0009" num="9(A),9(B),9(C)"><img id="if0009" file="imgf0009.tif" wi="113" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="49"> --><figure id="f0010" num="10(A),10(B)"><img id="if0010" file="imgf0010.tif" wi="136" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="50"> --><figure id="f0011" num="11(A),11(B),11(C)"><img id="if0011" file="imgf0011.tif" wi="125" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="51"> --><figure id="f0012" num="12"><img id="if0012" file="imgf0012.tif" wi="150" he="157" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="52"> --><figure id="f0013" num="13(a),13(b),13(c)"><img id="if0013" file="imgf0013.tif" wi="99" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="53"> --><figure id="f0014" num="14"><img id="if0014" file="imgf0014.tif" wi="144" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="54"> --><figure id="f0015" num="15(a),15(b),15(c),15(d),15(e),15(f),15(g),15(h)"><img id="if0015" file="imgf0015.tif" wi="165" he="201" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="163" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="163" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
