<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2681716-A1" country="EP" doc-number="2681716" kind="A1" date="20140108" family-id="46797323" file-reference-id="317508" date-produced="20180822" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146586090" ucid="EP-2681716-A1"><document-id><country>EP</country><doc-number>2681716</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12755459-A" is-representative="NO"><document-id mxw-id="PAPP154848282" load-source="docdb" format="epo"><country>EP</country><doc-number>12755459</doc-number><kind>A</kind><date>20120302</date><lang>EN</lang></document-id><document-id mxw-id="PAPP220440007" load-source="docdb" format="original"><country>EP</country><doc-number>12755459.0</doc-number><date>20120302</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140546967" ucid="AU-2011900785-A" load-source="docdb"><document-id format="epo"><country>AU</country><doc-number>2011900785</doc-number><kind>A</kind><date>20110304</date></document-id></priority-claim><priority-claim mxw-id="PPC140548659" ucid="AU-2012000208-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>AU</country><doc-number>2012000208</doc-number><kind>W</kind><date>20120302</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL2109739739" load-source="docdb">G06T   7/00        20060101AFI20140826BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2133815787" load-source="docdb" scheme="CPC">H04N   9/643       20130101 FI20141126BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2133822603" load-source="docdb" scheme="CPC">H04N   9/735       20130101 LI20141126BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989626332" load-source="docdb" scheme="CPC">G01J   3/462       20130101 LI20130620BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989629507" load-source="docdb" scheme="CPC">G01J   3/52        20130101 LI20130611BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989630710" load-source="docdb" scheme="CPC">H04N   1/6075      20130101 LI20130607BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989631550" load-source="docdb" scheme="CPC">H04N   1/6033      20130101 LI20130607BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989639165" load-source="docdb" scheme="CPC">H04N  17/002       20130101 LI20130611BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989647345" load-source="docdb" scheme="CPC">G01J   3/465       20130101 LA20130620BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989651472" load-source="docdb" scheme="CPC">G01J   3/524       20130101 LI20130620BHEP        </classification-cpc><classification-cpc mxw-id="PCL2100276304" load-source="docdb" scheme="CPC">H04N   1/6005      20130101 LI20140725BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132362903" lang="DE" load-source="patent-office">FARBKALIBRIERUNGSVERFAHREN FÜR EINE BILDERFASSUNGSVORRICHTUNG</invention-title><invention-title mxw-id="PT132362904" lang="EN" load-source="patent-office">COLOUR CALIBRATION METHOD FOR AN IMAGE CAPTURE DEVICE</invention-title><invention-title mxw-id="PT132362905" lang="FR" load-source="patent-office">PROCÉDÉ D'ÉTALONNAGE DE COULEURS POUR UN DISPOSITIF DE CAPTURE D'IMAGE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919533091" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>LBT INNOVATIONS LTD</last-name><address><country>AU</country></address></addressbook></applicant><applicant mxw-id="PPAR919541818" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>LBT INNOVATIONS LIMITED</last-name></addressbook></applicant><applicant mxw-id="PPAR919015446" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>LBT Innovations Limited</last-name><iid>101406310</iid><address><street>300 Flinders Street</street><city>Adelaide, South Australia 5000</city><country>AU</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919532213" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>VAN DEN HENGEL ANTON JOHN</last-name><address><country>AU</country></address></addressbook></inventor><inventor mxw-id="PPAR1319204978" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>VAN DEN HENGEL, ANTON JOHN</last-name></addressbook></inventor><inventor mxw-id="PPAR919016095" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>VAN DEN HENGEL, ANTON, JOHN</last-name><address><street>School of Computer Science The University of Adelaide</street><city>Adelaide, South Australia 5005</city><country>AU</country></address></addressbook></inventor><inventor mxw-id="PPAR919521285" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>HILL RHYS ERNST</last-name><address><country>AU</country></address></addressbook></inventor><inventor mxw-id="PPAR1319204979" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>HILL, RHYS ERNST</last-name></addressbook></inventor><inventor mxw-id="PPAR919008140" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>HILL, Rhys, Ernst</last-name><address><street>School of Computer Science University of Adelaide</street><city>Adelaide, South Australia 5005</city><country>AU</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919007815" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Karlsson, Mona</last-name><iid>101386059</iid><address><street>AWAPATENT AB Box 665 Studiegången 3</street><city>831 27 Östersund</city><country>SE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="AU-2012000208-W"><document-id><country>AU</country><doc-number>2012000208</doc-number><kind>W</kind><date>20120302</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012119189-A1"><document-id><country>WO</country><doc-number>2012119189</doc-number><kind>A1</kind><date>20120913</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549913231" load-source="docdb">AL</country><country mxw-id="DS549844720" load-source="docdb">AT</country><country mxw-id="DS549913232" load-source="docdb">BE</country><country mxw-id="DS549763910" load-source="docdb">BG</country><country mxw-id="DS549756800" load-source="docdb">CH</country><country mxw-id="DS549834012" load-source="docdb">CY</country><country mxw-id="DS549844721" load-source="docdb">CZ</country><country mxw-id="DS549913233" load-source="docdb">DE</country><country mxw-id="DS549834013" load-source="docdb">DK</country><country mxw-id="DS549834026" load-source="docdb">EE</country><country mxw-id="DS549756185" load-source="docdb">ES</country><country mxw-id="DS549763911" load-source="docdb">FI</country><country mxw-id="DS549756805" load-source="docdb">FR</country><country mxw-id="DS549913234" load-source="docdb">GB</country><country mxw-id="DS549834027" load-source="docdb">GR</country><country mxw-id="DS549913235" load-source="docdb">HR</country><country mxw-id="DS549844730" load-source="docdb">HU</country><country mxw-id="DS549756186" load-source="docdb">IE</country><country mxw-id="DS549834028" load-source="docdb">IS</country><country mxw-id="DS549756806" load-source="docdb">IT</country><country mxw-id="DS549834029" load-source="docdb">LI</country><country mxw-id="DS549763912" load-source="docdb">LT</country><country mxw-id="DS549832837" load-source="docdb">LU</country><country mxw-id="DS549763921" load-source="docdb">LV</country><country mxw-id="DS549763922" load-source="docdb">MC</country><country mxw-id="DS549832846" load-source="docdb">MK</country><country mxw-id="DS549832847" load-source="docdb">MT</country><country mxw-id="DS549756187" load-source="docdb">NL</country><country mxw-id="DS549831077" load-source="docdb">NO</country><country mxw-id="DS549756188" load-source="docdb">PL</country><country mxw-id="DS549832848" load-source="docdb">PT</country><country mxw-id="DS549756807" load-source="docdb">RO</country><country mxw-id="DS549832849" load-source="docdb">RS</country><country mxw-id="DS549756197" load-source="docdb">SE</country><country mxw-id="DS549844731" load-source="docdb">SI</country><country mxw-id="DS549831082" load-source="docdb">SK</country><country mxw-id="DS549831083" load-source="docdb">SM</country><country mxw-id="DS549763923" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA100074537" ref-ucid="WO-2012119189-A1" lang="EN" load-source="patent-office"><p num="0000">A method for providing a mapping from apparent colour to actual colour for an image capture device including capturing an image of a reference colour chart having a plurality of colour patches using the image capture device, wherein each colour patch has an associated reference colour, measuring the apparent colour of the plurality of colour patches in the captured image, selecting a plurality of control points representing different hue values within a circular hue space, determining an angular offset for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised, the angular offset representing a hue correction, wherein interpolation of the angular offsets for the control points provides a mapping from apparent colour to actual colour for the image capture device.</p></abstract><abstract mxw-id="PA100342285" ref-ucid="WO-2012119189-A1" lang="EN" source="national office" load-source="docdb"><p>A method for providing a mapping from apparent colour to actual colour for an image capture device including capturing an image of a reference colour chart having a plurality of colour patches using the image capture device, wherein each colour patch has an associated reference colour, measuring the apparent colour of the plurality of colour patches in the captured image, selecting a plurality of control points representing different hue values within a circular hue space, determining an angular offset for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised, the angular offset representing a hue correction, wherein interpolation of the angular offsets for the control points provides a mapping from apparent colour to actual colour for the image capture device.</p></abstract><abstract mxw-id="PA100074538" ref-ucid="WO-2012119189-A1" lang="FR" load-source="patent-office"><p num="0000">Un procédé pour réaliser un mappage d'une couleur apparente vers une couleur réelle pour un dispositif de capture d'image consiste à capturer une image d'un graphique de couleurs de référence comportant une pluralité de pastilles de couleur en utilisant le dispositif de capture d'image, chaque pastille de couleur étant associée à une couleur de référence, mesurer la couleur apparente de la pluralité de pastilles de couleur dans l'image capturée, sélectionner une pluralité de points de contrôle représentant différentes valeurs de teinte dans un espace de teintes circulaire, déterminer un décalage angulaire pour chaque point de contrôle de sorte que la distance entre une couleur apparente transformée et la couleur de référence pour chaque pastille de couleur soit réduite à un minimum, le décalage angulaire représentant une correction de teinte, une interpolation des décalages angulaires pour les points de contrôle fournissant un mappage d'une couleur apparente vers une couleur réelle pour le dispositif de capture d'image.</p></abstract><abstract mxw-id="PA100342286" ref-ucid="WO-2012119189-A1" lang="FR" source="national office" load-source="docdb"><p>Un procédé pour réaliser un mappage d'une couleur apparente vers une couleur réelle pour un dispositif de capture d'image consiste à capturer une image d'un graphique de couleurs de référence comportant une pluralité de pastilles de couleur en utilisant le dispositif de capture d'image, chaque pastille de couleur étant associée à une couleur de référence, mesurer la couleur apparente de la pluralité de pastilles de couleur dans l'image capturée, sélectionner une pluralité de points de contrôle représentant différentes valeurs de teinte dans un espace de teintes circulaire, déterminer un décalage angulaire pour chaque point de contrôle de sorte que la distance entre une couleur apparente transformée et la couleur de référence pour chaque pastille de couleur soit réduite à un minimum, le décalage angulaire représentant une correction de teinte, une interpolation des décalages angulaires pour les points de contrôle fournissant un mappage d'une couleur apparente vers une couleur réelle pour le dispositif de capture d'image.</p></abstract><description mxw-id="PDES51374508" ref-ucid="WO-2012119189-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="3"/>--><p id="p0001" num="0001"> COLOUR CALIBRATION METHOD FOR AN IMAGE CAPTURE DEVICE </p><p id="p0002" num="0002">This application claims priority from Australian Provisional Patent Application No. 201 1900785 filed on 4 March 201 1 , the contents of which are to be taken as incorporated herein by this reference. </p><p id="p0003" num="0003">FIELD OF THE INVENTION The present invention relates to methods and software for providing a mapping from apparent colour to actual colour for an image capture device, and methods and software for using the mapping in colour calibrating images captured by the device. </p><p id="p0004" num="0004">BACKGROUND TO THE INVENTION </p><p id="p0005" num="0005">A digital camera, in an existing example, captures an image using a sensor such as a charge-coupled device (CCD) or a Complementary Metal-Oxide Semiconductor (CMOS) sensor. Most of these camera sensors can read only one colour at each physical location, returning raw data as a pattern of values from each channel in a particular colour space, for instance red, green and blue (RGB), for each position or pixel in the image. For example, each R, G and B value may be represented as a number between 0 and a defined maximum such as 255, and the combination of RGB values at a pixel represents a particular colour. The camera captures RGB values by reference to a camera colour space. However, it is rare for the camera colour space to exactly match a known reference colour space. Thus there is a difference between the "apparent colour" that a camera interprets as e.g. R=120, G=1 10, B=105 and the "actual colour" e.g. R=100, G=100, B=100 in a reference colour space. Therefore, colour calibration methods are needed to map apparent colour as captured by the camera to actual colour in a reference colour space. This ensures that two different devices capturing images of the same physical object report the same actual colour values. Further, lighting effects can have a very significant effect of the observed colour of an object. Most lights are not pure white, due to innate physical properties of the lights themselves, which then causes measured colours to differ from true colour. </p><p id="p0006" num="0006">Colour mapping is usually performed as a combination of linear and non-linear transformations of the apparent colour to actual colour by, for example, multiplication 
<!-- EPO <DP n="4"/>-->
 of the colour vector via an appropriate matrix and passing the individual colour values through a polynomial. </p><p id="p0007" num="0007">Computing such a transform is a difficult process, and requires a large number of colour samples, and preferably knowledge of the camera sensor itself. Such a technique is difficult to apply in some situations where space or time constraints render such a process impractical. Simple colour correction, such as white balance correction, is sufficient in some applications with such space or time constraints; however in some applications a higher accuracy mapping is required. </p><p id="p0008" num="0008">It is an aim of the present invention to provide a mapping for an image capture device that addresses one or more of the limitations of existing colour mapping methods. </p><p id="p0009" num="0009">The above discussion of background art is included to explain the context of the present invention. It is not to be taken as an admission that any of the documents or other material referred to was published, known or part of the common general knowledge at the priority date of any one of the claims of this specification. </p><p id="p0010" num="0010">SUMMARY OF THE INVENTION </p><p id="p0011" num="0011">The present invention provides a method for providing a mapping from apparent colour to actual colour for an image capture device including: </p><p id="p0012" num="0012"> capturing an image of a reference colour chart having a plurality of colour patches using the image capture device, wherein each colour patch has an associated reference colour, </p><p id="p0013" num="0013"> measuring the apparent colour of the plurality of colour patches in the captured image, </p><p id="p0014" num="0014"> selecting a plurality of control points representing different hue values within a circular hue space, </p><p id="p0015" num="0015"> determining an angular offset for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised, the angular offset representing a hue correction, </p><p id="p0016" num="0016"> wherein interpolation of the angular offsets for the control points provides a mapping from apparent colour to actual colour for the image capture device. For example, images used for microbiological assessment purposes, such as identifying microbial growth (e.g. bacterial colonies) grown on a solid culture medium, must be accurate as the colour, shape and texture of bacterial colonies and the colour 
<!-- EPO <DP n="5"/>-->
 of the solid culture medium (such as agar) are used in identifying the bacterial type. Therefore, in the example, it will be appreciated by those persons skilled in the art that it is important that the colour of an image is close to actual colour. It will also be appreciated by those persons skilled in the art that mapping from apparent colour to actual colour for captured images can be used in respect of other applications, such as high-end photography. </p><p id="p0017" num="0017">The apparent colour and reference colour (input colours) may be measured in any colour space, for example RGB, YUV, LAB, XYZ. The mapping to actual colour (output colour) may transform the apparent colour to the same colour space, or it may transform the apparent colour to a different colour space. The distance between the transformed apparent colour and the reference colour may be measured in the input or output colour space. The hue value of a control point refers to the hue value in the HSV (hue saturation value) colour space. The HSV space is used as an intermediary between the input and output spaces. This colour space is represented by a cone, with the angle around the central vertical axis corresponding to hue, the distance from the vertical axis corresponding to saturation, and the distance along the vertical axis corresponding to value (brightness). The circular hue space refers to a circular cross section of the HSV cone. </p><p id="p0018" num="0018">The method is able to produce a mapping from a small number of reference colours. For example, a mapping produced using 24 colour patches has been found to produce a sufficient calibration for use in imaging bacterial colonies to a sufficient accuracy for microbiological assessment purposes. The number of required patches depends on the fidelity of the mapping that is required, and is adjustable. An image that has been colour corrected using the mapping may be used in training a machine learning algorithm to classify the bacterial colonies, for example as described in the co-pending International patent application of the same Applicant and with the same filing date titled "Method and Software for Analysing Microbial Growth"; the contents of which are herein incorporated by reference. </p><p id="p0019" num="0019">The angular offsets of the control points may be used to map an apparent hue to an actual hue of a pixel in any other image taken by the same image capture device under the same lighting conditions, by interpolating between the angular offsets for the control points to determine an interpolated angular offset for the apparent hue of 
<!-- EPO <DP n="6"/>-->
 the pixel in the image. The interpolated angular offset is then applied to the apparent hue to achieve an approximation of the actual hue (and therefore actual colour). By applying a transform in a circular hue space, the method of the present invention may provide a more accurate approximation than a straightforward linear transformation of the original colour values. It is to be understood by those persons skilled in the art that references to "actual colour" does not require that the apparent colour be mapped perfectly to the reference colour space. Rather, the mapping provides an approximation of the actual colour. The image capture device may be a digital camera, such as a high resolution colour digital camera, digital scanner or digital video camera. </p><p id="p0020" num="0020">Turning now to the selection of control points, the plurality of control points may be evenly spaced around the circular hue space. The angular position of the control point on the circular hue space represents its hue value. For example, the control points may form a single ring around the space, with a uniform distance between adjacent control points in the ring. Selecting the positions for the control points may include computing an error for a series of candidate mappings using different numbers of control points, and selecting a mapping from the series based on the minimal number of points yielding an acceptable error. It will be appreciated that is desirable to select as few control points as possible, in the interests of computational efficiency and estimation accuracy. </p><p id="p0021" num="0021">Measuring the apparent colour of a colour patch in the image captured by the image capture device may further include: measuring a colour of a colour patch, white balance correcting the measured colour, brightness correcting the measured colour, and determining the apparent colour using the resulting white balance and brightness corrected colour. The white balance correction may be done using a weighting determined from a neutral grey patch in the colour chart, where the R, G and B values should be equal. The brightness may be corrected using a curve computed using a plurality of grey patches in the colour chart which have known brightness. Thus, the colour mapping is performed with data that has been corrected for white balance and brightness. This reduces the complexity of the transformation and thus the computation time required compared with producing a mapping that accounts for white balance and brightness. 
<!-- EPO <DP n="7"/>-->
 Determining the angular offset for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised may include minimising a cost function that includes the sum of the squares of the distance between the transformed apparent colour and the reference colour for each colour patch. The cost function may further include the sum of the squares of the angular offsets. </p><p id="p0022" num="0022">In an embodiment, the method may further include determining a scale for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised, the scale representing a saturation correction, wherein interpolation of the scales for the control points provide a further mapping from apparent colour to actual colour for the image capture device. </p><p id="p0023" num="0023">The interpolated scale for the apparent saturation is applied to the apparent saturation to obtain an approximation of the actual saturation. The control points may represent hue values that are nearest to the position of the apparent hue and saturation of the colour patch in the circular hue space. The control points may include one or two (or more) rings of control points around the circular hue space, each ring having a different saturation value. In one example, two rings of control points are used, with control points in each ring having the same hue but different saturation values, such as 0.5 and 1 . The control points of course need not be in rings, and could be spaced in another arrangement around the circular hue space. </p><p id="p0024" num="0024">As above, determining the scale for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised may include minimising a cost function that includes the sum of the squares of the distance between the transformed apparent colour and the reference colour for each colour patch. The cost function may further include the sum of the squares of one minus each saturation scale to encourage final scales around one. </p><p id="p0025" num="0025">Alternatively, saturation could be mapped using a curve similar to the brightness curve, rather than simply scaling it. </p><p id="p0026" num="0026">To apply the mapping, the method may include: capturing an image using the image capture device, for one or more pixels in the image; determining the apparent hue of the pixel; interpolating between the angular offsets of two or more control points in the circular hue space to determine an angular offset associated with the apparent hue; 
<!-- EPO <DP n="8"/>-->
 and applying the angular offset to the apparent hue. The method may further include for the one or more pixels in the image: determining the apparent saturation of the pixel; interpolating between the scales of the two or more control points in the circular hue space to determine a scale associated with the apparent saturation; and applying the scale to the apparent saturation. </p><p id="p0027" num="0027">The two or more control points may represent hue values that are nearest to the apparent hue in the circular hue space. This has been found, in exemplary embodiments, to produce a satisfactory mapping. Preferably four control points and cubic interpolation is used. Alternatively, the angular offsets may be transformed using a higher order interpolation method. However, in this case a greater amount of processing would be required to determine the optimised angular offsets. Linear interpolation could alternatively be used, but it would be less smooth, and would produce discontinuities in the colour space when crossing over a control point. </p><p id="p0028" num="0028">Once the apparent hue and saturation for a pixel is determined, the colour may be converted to any appropriate colour space e.g. for display. </p><p id="p0029" num="0029">In addition, the present invention provides software for use with a computer including a processor and memory for storing the software, the software including a series of instructions executable by the processor to carry out the method in accordance with any one of the embodiments described above. </p><p id="p0030" num="0030">The present invention also extends to a computer readable media including the software, and apparatus including a processor, a memory and software resident in memory accessible to the processor, the software executable by the processor to carry out the method in accordance with any one of the embodiments described above. BRIEF DESCRIPTION OF THE DRAWINGS </p><p id="p0031" num="0031"> Embodiments of the present invention will now be described, by way of example only, with reference to the accompanying drawings. It is to be understood that the particularity of the drawings does not supersede the generality of the preceding description of the invention. </p><p id="p0032" num="0032">Fig. 1 is an example processing system and image capture device for performing methods according to embodiments of the invention. 
<!-- EPO <DP n="9"/>-->
 Fig. 2 is a flow chart illustrating a method for computing a mapping from apparent colour to actual colour. Fig. 3 is a graph showing an example curve for correcting the brightness of a captured image. </p><p id="p0033" num="0033">Fig. 4 is a diagram of a HSV space showing a plurality of control points within a circular hue space. </p><p id="p0034" num="0034">Fig. 5 is a graphical representation of (a) the mapping across the hue/saturation space, (b) the isolated hue mapping function and (c) the isolated saturation mapping function for a particular image capture device. Fig. 6 is a graph showing the accuracy of the mapping. </p><p id="p0035" num="0035">Fig. 7 is two photos of a colour chart (a) before colour calibration and (b) after colour calibration. Fig. 8 is a flow chart illustrating a method for mapping an apparent colour to an actual colour. </p><p id="p0036" num="0036">DETAILED DESCRIPTION OF AN EMBODIMENT </p><p id="p0037" num="0037"> An example processing system and image capture device for use with embodiments of the invention will be described with reference to Fig. 1 . The processing system 10 includes a processor 12, a memory 14, at least one input device 16, at least one output device 18, a communications port 20, an interface 22 and a storage device 24. As is shown, the components of the processing system 10 are coupled together via a bus or group of buses 26. </p><p id="p0038" num="0038">The processor 12 may include more than one processing device, for example to handle different functions within the processing system 10. The memory 14 may include any suitable memory device and including, for example, volatile or non-volatile memory, solid state storage devices, magnetic devices, etc. The memory 14 may store instructions for execution by the processor 12. 
<!-- EPO <DP n="10"/>-->
 Input device 16 receives input data and may include, for example, a keyboard, a mouse or other pointer device, a trackball, joystick or touch-screen, a microphone, a data receiver or antenna such as a modem or wireless data adaptor, data acquisition card, etc. An input device 16 may be operable by a user to enter input data, or it may receive data from another input data source. </p><p id="p0039" num="0039">Output device 18 produces or generates output data. Output device 18 may include a display device, a set of audio speakers, a printer, a port (for example a USB port), a peripheral component adaptor, a data transmitter or antenna such as a modem or wireless network adaptor, etc. </p><p id="p0040" num="0040">The storage device 24 can include any form of data or information storage means, for example, volatile or non-volatile memory, solid state storage devices, magnetic devices, etc. A file system and files may be stored on the storage device 24. </p><p id="p0041" num="0041">The communications port 20 allows the processing system 10 to communicate with other devices via a hard wired or wireless network. The interface 22 couples the processing system 10 to one or more peripheral devices. For example interface 22 may include a PCI card or PC card. </p><p id="p0042" num="0042">The processing system 10 may be any form of terminal, server processing system, specialised hardware, computer, computer system or computerised device, personal computer (PC), mobile or cellular telephone, mobile data terminal, portable computer, Personal Digital Assistant (PDA), pager or any other similar type of device. </p><p id="p0043" num="0043">An image capture device 30 in the form of a colour digital camera is also shown in Fig. 1 . The camera 30 may communicate with the processing system 10 via a physical or wireless interface 32. A method for producing a mapping from apparent colour to actual colour may be executed on processor 12 using software stored in the memory 14. With reference to Fig. 2, at step 40, an image of a reference colour chart is captured. The chart may be a standard "gretagmacbeth ColorChecker™Color Rendition Chart", which has 24 colour patches, each of which has an associated reference red, green and blue channel value. The image may be captured by activating the camera manually or via electronic signals sent using the software. The data captured by the camera sensors 
<!-- EPO <DP n="11"/>-->
 is transmitted via the interface 32 to the processing system 10, with colour calibration disabled. </p><p id="p0044" num="0044">At step 42, the user indicates the location of each colour patch in the reference colour chart. For example, the software could cause a GUI to display a preview of the image from the camera 30, and the user may click in the four corner squares of the chart in a specific order to enable the locations of the colour patches to be determined. In other alternatives, the location of the patches may be determined using machine vision techniques or by the placing of the reference colour chart in a specific known location that is a fixed distance from the camera. </p><p id="p0045" num="0045">The average colour of each location is captured in a 21 x 21 pixel window and used for the patch colour at step 44. Of course, it will be appreciated that different sized pixel windows could be used to compute the average colour. </p><p id="p0046" num="0046">At step 46, the white balance is computed from a single patch - namely the third darkest grey patch in the reference colour chart. It is assumed that the R, G and B values are equal in this neutral grey patch. The white balance is represented as: 
<img id="imgf000011_0001" he="18" wi="31" file="imgf000011_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0047" num="0047">where w<sub>g</sub> is implicitly defined as one. The weightings w<sub>r</sub> and w<sub>b</sub> are calculated to produce r' and b' values equal to the g' value. The computed white balance</p><p id="p0048" num="0048">W = \w<sub>r</sub> , 1 , Wh] </p><p id="p0049" num="0049">values will be used to correct the white balance of images captured by the camera. Once the white balance has been computed, at step 48, a curve C is computed which maps the apparent grey colour values together as well as possible. This provides a brightness mapping for the camera. The form of the curve is: where g is the input colour, g' is the output and a, b and c are the parameters of the curve C that are computed. Fig. 3 shows an example curve obtained from this process. Once estimated, the curve may be applied independently per colour channel. The final stage of the colour mapping function (step 50) aims to produce a mapping for the hue and saturation of each pixel. 
<!-- EPO <DP n="12"/>-->
 The apparent hue and saturation of a plurality of the colour patches is measured, based on the white balance and colour corrected image and a hue and saturation mapping is computed at step 50. The hue mapping is provided using a series of control points to map the apparent hue values to actual hue values. It uses cubic interpolation (or another higher order interpolation method) to achieve this. Each control point consists of a position in a circular hue space, which is fixed, and an angular offset, which is computed during optimisation. The offset is cubically interpolated to provide an offset for a particular hue value that will map the particular hue value to an actual hue. </p><p id="p0050" num="0050">The saturation mapping function uses a series of control points to scale saturation values. These control points may be the same or different from the control points used to map the hue values. The saturation mapping function may use the same interpolation scheme as the hue mapping function. Note that saturation must be in the range [0, 1 ] and hence the output value from this function is clamped to ensure this range is enforced. In an alternative, the saturation mapping may be done via a curve similar to that applied for brightness correction. </p><p id="p0051" num="0051">The control points used in the hue and saturation mapping functions may be spread evenly around the edge of the circular hue space as shown in Fig. 4. This circular hue space includes 16 control points, represented by coloured circles (for example, control point 52). For example, the coloured circle at hue of 0 degrees and saturation of 1 may be red, at hue of 90 degrees and saturation of 1 may be green, at hue of 180 degrees and saturation of 1 may be blue and at hue of 270 degrees and saturation of 1 may be purple. The direction of angular offset 54 and scale 56 is also shown in Fig. 4. The angular position of the control points are defined by their hue value and the radial position of the control points are defined by their saturation. Two rings of control points are shown, an inner ring having saturation of 0.5 and an outer ring having saturation of 1 . In the case of a single ring of control points, only a single value is required to select the appropriate point, the value corresponding to hue. Hue is expressed as an angle and the function must take account of this when selecting control points. </p><p id="p0052" num="0052">The maximum number of control points is defined by the number of colour samples available. Each control point has two parameters, and each sample provides three residuals. Hence, n colour samples can have at most 3n/2 control points. In practice, however, the measurement process induces errors in the colour measurements. 
<!-- EPO <DP n="13"/>-->
 Selecting the control points may include computing an error for a series of candidate mappings using different numbers of control points, and selecting a mapping from the series based on the minimal number of points yielding an acceptable error. It has been found that 12 control points are sufficient for a chart with 24 patches. </p><p id="p0053" num="0053">Since the brightness curve has already been estimated, it is assumed that the brightness values are correct; hence they need not be adjusted. </p><p id="p0054" num="0054">The angular offsets and scales are optimised to best map the apparent colours of patches from the image onto the actual colours of the equivalent colour patches in the reference colour chart. This is done by calculating a mapping f (p), such that the distance between the true and mapped colours is minimised: </p><p id="p0055" num="0055">' = 2 ||p<sub>*</sub> - /(p<sub>?</sub> )||<sup>2</sup> where I<sup>5</sup>* is a true colour and I<sup>5'</sup>* is a measured colour. The colour may be represented in any colour space, for example RGB, YUV, LAB or XYZ. </p><p id="p0056" num="0056">Note that hue is expressed as an angle and the function must take account of this when selecting control points. This is done by using a cost function. The cost function includes terms which ensure the scales maintain a value around one and the offsets around zero to prevent very large changes (such as offsets of 360°). Given the following error measure: </p><p id="p0057" num="0057"> £ = [pi - fi i , pjv - /(ΡΛ&lt; Ι.&lt;<sup>■</sup> ·<sup>■</sup> - «i&gt; · · · - i - ¾ ] where ^ i is the offset for the control point and s, is the scale for control point. It is sought to select and s, to minimise £ ie </p><p id="p0058" num="0058"> firffTO tll i f . . l it H <sup>*</sup>~ </p><p id="p0059" num="0059"> ■ </p><p id="p0060" num="0060"> A solution to this may be obtained using the Levenberg-Marquardt algorithm, though any other unconstrained minimiser would also suffice. The cost function tries to minimise the error in mapping the colours together, while keeping the hue offsets near zero and the saturation scales near one. </p><p id="p0061" num="0061">Thus, what is involved is determining an angular offset 54 and scale 56 for each control point that minimises the sum of squares of the distance between a transformed apparent colour (e.g. RGB) and the reference colour (e.g. RGB) for each 
<!-- EPO <DP n="14"/>-->
 patch, minimises the angular offset and keeps the scale close to one (minimises 1 minus the scale). </p><p id="p0062" num="0062">The result is a mapping in the form of angular offsets and/or scales for the control points. Fig. 5 shows a graphical representation of (a) the mapping across the hue/saturation space, (b) the isolated hue mapping function and (c) the isolated saturation mapping function for a particular camera. Fig. 6 provides some details on the accuracy of the mapping. Each position on the y-axis represents one of the 24 colour patches and the x-axis represents the colour values, where each can be between zero and one. An example of colour correcting an image using the mapping is shown in Fig. 7. The first image (a) shows the input image, as captured by the camera, after the user has selected the position of the colour patches. Note that in this example, the white balance is already roughly correct. The second image (b) shows the corrected colours. The small coloured squares visible over the patches show the true colour of each patch. </p><p id="p0063" num="0063">This mapping can then be used to colour correct an image captured using the same (or the same type of) image capture device. With reference to Fig. 8, a method for mapping an apparent colour to an actual colour includes at step 60 capturing an image using the camera. The apparent RGB colour values for each pixel may be determined and the colour values may be white balance and brightness corrected using the weights/curve previously computed. The method then involves at step 62 for one or more pixels in the image, determining the apparent hue and saturation of the pixel (step 64), interpolating between the angular offsets of two or more control points in the circular hue space to determine an angular offset associated with the apparent hue (step 66), interpolating between the scales of the two or more control points in the circular hue space to determine a scale associated with the apparent saturation (step 68), applying the angular offset to the apparent hue (step 70), and applying the scale to the apparent saturation (step 72). Once the mapping has been applied, the HSV space colour can be transformed back into the RGB space, or to any other output space as desired. </p><p id="p0064" num="0064">It is to be understood that various alterations, additions and/or modifications may be made to the parts previously described without departing from the ambit of the present invention, and that, in the light of the above teachings, the present invention may be implemented in software, firmware and/or hardware in a variety of manners as would be understood by the skilled person. 
</p></description><claims mxw-id="PCLM44999128" ref-ucid="WO-2012119189-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="15"/>--> CLAIMS </claim-statement><claim id="clm-0001" num="1"><claim-text>1 . A method for providing a mapping from apparent colour to actual colour for an image capture device including: </claim-text><claim-text> capturing an image of a reference colour chart having a plurality of colour patches using the image capture device, wherein each colour patch has an associated reference colour, </claim-text><claim-text> measuring the apparent colour of the plurality of colour patches in the captured image, </claim-text><claim-text> selecting a plurality of control points representing different hue values within a circular hue space, </claim-text><claim-text> determining an angular offset for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised, the angular offset representing a hue correction, </claim-text><claim-text> wherein interpolation of the angular offsets for the control points provides a mapping from apparent colour to actual colour for the image capture device. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. A method according to claim 1 , wherein the plurality of control points are evenly spaced around the circular hue space. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. A method according to any one of the preceding claims, wherein selecting the plurality of control points includes: </claim-text><claim-text> computing an error for a series of candidate mappings using different numbers of control points, and </claim-text><claim-text> selecting a mapping from the series based on the minimal number of points yielding an acceptable error. </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. A method according to any one of the preceding claims, wherein measuring the apparent colour of a colour patch includes: </claim-text><claim-text> measuring a colour of a colour patch, </claim-text><claim-text> white balance correcting the measured colour, </claim-text><claim-text> brightness correcting the measured colour, and </claim-text><claim-text> determining the apparent colour using the resulting white balance and brightness corrected colour. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. A method according to any one of the preceding claims, wherein determining the angular offset for each control point such that the distance between a transformed <!-- EPO <DP n="16"/>--> apparent colour and the reference colour for each colour patch is minimised includes minimising a cost function that includes the sum of the squares of the distance between the transformed apparent colour and the reference colour for each colour patch. </claim-text><claim-text>i </claim-text></claim><claim id="clm-0006" num="6"><claim-text> 6. A method according to claim 5, wherein the cost function further includes the sum of the squares of the angular offsets. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. A method according to any one of the preceding claims, further including: determining a scale for each control point such that the distance between a transformed apparent colour and the reference colour for each colour patch is minimised, the scale representing a saturation correction, </claim-text><claim-text> wherein interpolation of the scales for the control points provides a further mapping from apparent colour to actual colour for the image capture device. </claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. A method according to claim 7, when dependent from claim 5 or 6, wherein the cost function further includes the sum of the squares of one minus each saturation. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>A method according to any one of the preceding claims, further including: capturing an image using the image capture device, </claim-text><claim-text> for one or more pixels in the image: </claim-text><claim-text> determining the apparent hue of the pixel, </claim-text><claim-text> interpolating between the angular offsets of two or more control points in the circular hue space to determine an angular offset associated with the apparent hue, and </claim-text><claim-text> applying the angular offset to the apparent hue. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. A method according to claim 9, when dependent on claim 7 or 8, further including: </claim-text><claim-text> for the one or more pixels in the image: </claim-text><claim-text> determining the apparent saturation of the pixel, </claim-text><claim-text> interpolating between the scales of the two or more control points in the circular hue space to determine a scale associated with the apparent saturation, and </claim-text><claim-text> applying the scale to the apparent saturation. <!-- EPO <DP n="17"/>--> </claim-text></claim><claim id="clm-0011" num="11"><claim-text>1 1 . Software for use with a computer including a processor and memory for storing the software, the software including a series of instructions executable by the processor to carry out the method as claimed in any one of the preceding claims. </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. A computer readable media including software as claimed in claim 1 1 . </claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. Apparatus including </claim-text><claim-text> a processor; </claim-text><claim-text> a memory; and </claim-text><claim-text> software resident in memory accessible to the processor, the software including a series of instructions executable by the processor to carry out the method as claimed in any one of claims 1 to 10. </claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
