<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2681858-A1" country="EP" doc-number="2681858" kind="A1" date="20140108" family-id="44546158" file-reference-id="311159" date-produced="20180823" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146586430" ucid="EP-2681858-A1"><document-id><country>EP</country><doc-number>2681858</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-11705625-A" is-representative="NO"><document-id mxw-id="PAPP154848622" load-source="docdb" format="epo"><country>EP</country><doc-number>11705625</doc-number><kind>A</kind><date>20110302</date><lang>EN</lang></document-id><document-id mxw-id="PAPP220440098" load-source="docdb" format="original"><country>EP</country><doc-number>11705625.9</doc-number><date>20110302</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140547208" ucid="EP-2011053091-W" linkage-type="A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>2011053091</doc-number><kind>W</kind><date>20110302</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989319714" load-source="docdb">H04H  20/67        20080101AFI20120917BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL1989320442" load-source="docdb">H04N   7/24        20110101ALI20120917BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1989622323" load-source="docdb" scheme="CPC">H04N  21/23412     20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989624666" load-source="docdb" scheme="CPC">H04N  21/64315     20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989627621" load-source="docdb" scheme="CPC">H04N  21/23608     20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989630012" load-source="docdb" scheme="CPC">H04H  20/67        20130101 FI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989630900" load-source="docdb" scheme="CPC">H04N  21/2381      20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989633257" load-source="docdb" scheme="CPC">H04N  21/4381      20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989639481" load-source="docdb" scheme="CPC">H04N  21/6143      20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989648285" load-source="docdb" scheme="CPC">H04N  21/6193      20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989651085" load-source="docdb" scheme="CPC">H04N  21/4363      20130101 LI20130101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132363923" lang="DE" load-source="patent-office">DETERMINISTISCHES RE-MULTIPLEXING FÜR SFN-NETZWERKE</invention-title><invention-title mxw-id="PT132363924" lang="EN" load-source="patent-office">DETERMINISTIC RE-MULTIPLEXING FOR SFN NETWORKS</invention-title><invention-title mxw-id="PT132363925" lang="FR" load-source="patent-office">REMULTIPLEXAGE DÉTERMINISTE POUR DES RÉSEAUX SFN</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919537515" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>NEVION EUROP AS</last-name><address><country>NO</country></address></addressbook></applicant><applicant mxw-id="PPAR919518218" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>NEVION EUROPE AS</last-name></addressbook></applicant><applicant mxw-id="PPAR919008341" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Nevion Europe AS</last-name><iid>101421844</iid><address><street>P.O. Box 1020</street><city>3204 Sandefjord</city><country>NO</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919538696" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>STEPHANSEN HELGE</last-name><address><country>NO</country></address></addressbook></inventor><inventor mxw-id="PPAR919504714" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>STEPHANSEN, Helge</last-name></addressbook></inventor><inventor mxw-id="PPAR919017763" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>STEPHANSEN, Helge</last-name><address><street>Løkenåsen 18</street><city>N-1900 Fetsund</city><country>NO</country></address></addressbook></inventor><inventor mxw-id="PPAR919504058" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>JENSEN BJOERN TOMMY</last-name><address><country>NO</country></address></addressbook></inventor><inventor mxw-id="PPAR919540906" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>JENSEN, BJOERN, TOMMY</last-name></addressbook></inventor><inventor mxw-id="PPAR919008084" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>JENSEN, Bjørn, Tommy</last-name><address><street>Lokes vei 26</street><city>N-1344 Haslum</city><country>NO</country></address></addressbook></inventor><inventor mxw-id="PPAR919516963" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>ROGNSTAD IVAR</last-name><address><country>NO</country></address></addressbook></inventor><inventor mxw-id="PPAR919541558" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>ROGNSTAD, Ivar</last-name></addressbook></inventor><inventor mxw-id="PPAR919018281" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>ROGNSTAD, Ivar</last-name><address><street>Haakon Tveters vei 23</street><city>N-0682 Oslo</city><country>NO</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919006400" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Onsagers AS</last-name><iid>101235194</iid><address><street>Munkedamsveien 35 P.O. Box 1813 Vika</street><city>0123 Oslo</city><country>NO</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="EP-2011053091-W"><document-id><country>EP</country><doc-number>2011053091</doc-number><kind>W</kind><date>20110302</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012116743-A1"><document-id><country>WO</country><doc-number>2012116743</doc-number><kind>A1</kind><date>20120907</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549770841" load-source="docdb">AL</country><country mxw-id="DS549838724" load-source="docdb">AT</country><country mxw-id="DS549770842" load-source="docdb">BE</country><country mxw-id="DS549760446" load-source="docdb">BG</country><country mxw-id="DS549838548" load-source="docdb">CH</country><country mxw-id="DS549914839" load-source="docdb">CY</country><country mxw-id="DS549838725" load-source="docdb">CZ</country><country mxw-id="DS549770843" load-source="docdb">DE</country><country mxw-id="DS549914840" load-source="docdb">DK</country><country mxw-id="DS549914841" load-source="docdb">EE</country><country mxw-id="DS549838742" load-source="docdb">ES</country><country mxw-id="DS549760447" load-source="docdb">FI</country><country mxw-id="DS549760448" load-source="docdb">FR</country><country mxw-id="DS549770844" load-source="docdb">GB</country><country mxw-id="DS549914842" load-source="docdb">GR</country><country mxw-id="DS549770849" load-source="docdb">HR</country><country mxw-id="DS549838730" load-source="docdb">HU</country><country mxw-id="DS549838549" load-source="docdb">IE</country><country mxw-id="DS549770850" load-source="docdb">IS</country><country mxw-id="DS549760461" load-source="docdb">IT</country><country mxw-id="DS549914843" load-source="docdb">LI</country><country mxw-id="DS549760848" load-source="docdb">LT</country><country mxw-id="DS549838731" load-source="docdb">LU</country><country mxw-id="DS549760853" load-source="docdb">LV</country><country mxw-id="DS549760854" load-source="docdb">MC</country><country mxw-id="DS549852121" load-source="docdb">MK</country><country mxw-id="DS549852126" load-source="docdb">MT</country><country mxw-id="DS549770851" load-source="docdb">NL</country><country mxw-id="DS549760462" load-source="docdb">NO</country><country mxw-id="DS549760855" load-source="docdb">PL</country><country mxw-id="DS549838554" load-source="docdb">PT</country><country mxw-id="DS549770852" load-source="docdb">RO</country><country mxw-id="DS549838555" load-source="docdb">RS</country><country mxw-id="DS549770857" load-source="docdb">SE</country><country mxw-id="DS549838556" load-source="docdb">SI</country><country mxw-id="DS549760463" load-source="docdb">SK</country><country mxw-id="DS549760856" load-source="docdb">SM</country><country mxw-id="DS549914844" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA99836794" ref-ucid="WO-2012116743-A1" lang="EN" load-source="patent-office"><p num="0000">Method and system for deterministic re-multiplexing of transport streams for SFN networks.</p></abstract><abstract mxw-id="PA100332566" ref-ucid="WO-2012116743-A1" lang="EN" source="national office" load-source="docdb"><p>Method and system for deterministic re-multiplexing of transport streams for SFN networks.</p></abstract><abstract mxw-id="PA99836795" ref-ucid="WO-2012116743-A1" lang="FR" load-source="patent-office"><p num="0000">L'invention porte sur un procédé et un système pour un remultiplexage déterministe de flux de transport pour des réseaux SFN.</p></abstract><abstract mxw-id="PA100332567" ref-ucid="WO-2012116743-A1" lang="FR" source="national office" load-source="docdb"><p>L'invention porte sur un procédé et un système pour un remultiplexage déterministe de flux de transport pour des réseaux SFN.</p></abstract><description mxw-id="PDES51233401" ref-ucid="WO-2012116743-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="2"/>--><p id="p0001" num="0001"> Deterministic re-multiplexing for SFN Networks </p><p id="p0002" num="0002">Introduction </p><p id="p0003" num="0003"> The present invention relates to a method and system for sending signals over a Single Frequency Network. More specifically, the invention is described by a solution for deterministic re-multiplexing of transport streams, to achieve identical signals to feed modulators at different transmitter sites in a Single Frequency Network. The invention makes it possible to use a common satellite transmission to feed both end users directly, and also multiple SFN regions in a terrestrial broadcast network. The principles described in the solution are applicable to both DVB-T and DVB-T2 networks. </p><p id="p0004" num="0004">Background </p><p id="p0005" num="0005"> A Single Frequency Network (SFN) is a broadcasting network where several transmitters simultaneously send the same signal at the same time over the same frequency channel in the same geographical area. Use of SFN may increase the coverage area and decrease the outage probability in comparison to use of Multi Frequency Networks. </p><p id="p0006" num="0006"> In an SFN region, it is crucial that all transmitters are fed with exactly the same bit stream. Everything from packet sequence to Program Clock Reference (PCR) stamps in the transmitted signals need to be identical, bit-by-bit. The transport stream to be transmitted is generally divided into a continuous sequence of transmission blocks, where information about transmission time for a block is contained in a system specific block descriptor transport stream (TS) packet. SFN can be implemented by letting SFN adapters generate these block descriptor packets. </p><p id="p0007" num="0007"> Often, local adaptation of the content in an SFN region is required; for example insertion of local programs/services. A regional multiplexer typically needs to receive two or more feeds, forwarding select content from each feed as needed for that region. The challenge with this scenario is that all regional multiplexers at different sites in the same SFN region need to produce exactly the same output to fulfil the SFN system requirements.</p><p id="p0008" num="0008">The proposed solution involves multiplexers both at the main head-end and regional head-ends. The examples and drawings in this disclosure assume that a satellite system is used as the distribution method between the main head end and the SFN regions. The described system will however work fine with other types of distribution systems, like IP networks. </p><p id="p0009" num="0009"> The proposed solution is designed so that the re-multiplexing, i.e. the SFN adaptation process, becomes fully deterministic, making it possible for a set of geographically distributed multiplexers to produce exactly the same output stream when fed with the same input signals and the same configuration settings. 
<!-- EPO <DP n="3"/>-->
 Brief description of the invention </p><p id="p0010" num="0010"> The main characteristics of the solution are deterministic placement of Transport Stream (TS) packets received from different input streams. This means that it is possible to multiplex services from one or more input sources without any fixed limit, and the resulting output packet sequence is fully predictable. </p><p id="p0011" num="0011"> The deterministic re-multiplexing of transport streams in SFN is performed by a method comprising the following steps that are performed at the main head end: </p><p id="p0012" num="0012"> - receiving feeds from at least one source, each feed being multiplexed by </p><p id="p0013" num="0013"> multiplexers being referenced by a common 1PPS signal; </p><p id="p0014" num="0014"> providing internally virtual SFN adapters for each multiplexer, where these adapters generate virtual SFN streams denoting the block structure to be used at remote receiving SFN regions; </p><p id="p0015" num="0015"> inserting Time Marker Packets (TMP) into said virtual SFN streams, said TMPs comprising timing information measured relative to said 1PPS signals, where said TMPs have a frequency corresponding to the frequency of system specific block descriptor packets for the local SFN transmission scheme; </p><p id="p0016" num="0016"> applying modulation with rate adaptation to outgoing final multiplexed transport streams, </p><p id="p0017" num="0017"> and where the following steps are performed at each regional transmitter site: </p><p id="p0018" num="0018"> receiving at least one of said final multiplexed transport streams on the inputs of deterministic re-multiplexers; </p><p id="p0019" num="0019"> extracting the timing information from said Time Marker Packets in a virtual SFN stream to produce a compliant and fully deterministic output stream that will be accepted by each local SFN modulator for the region. </p><p id="p0020" num="0020"> The invention also comprises a system with means for performing deterministic re- multiplexing of transport streams in SFN. </p><p id="p0021" num="0021">The enclosed main claims define the scope of protection, and dependent claims define further aspects of the invention. </p><p id="p0022" num="0022">Brief description of the drawings </p><p id="p0023" num="0023"> The present invention will be described in detail with reference to a preferred </p><p id="p0024" num="0024">embodiment as shown in the following drawings: </p><p id="p0025" num="0025"> Figure 1 shows a system overview of the deterministic SFN re-multiplexing; </p><p id="p0026" num="0026">Figure 2 shows the time marker packet insertion process; 
<!-- EPO <DP n="4"/>-->
 Figure 3 shows details of the Time Marker Packet, and </p><p id="p0027" num="0027"> Figure 4 shows an overview of the deterministic re-multiplexing process. </p><p id="p0028" num="0028">Detailed description </p><p id="p0029" num="0029">The object of the present invention is to perform deterministic re-multiplexing of transport streams in Single Frequency Networks (SFN). </p><p id="p0030" num="0030"> Figure 1 shows an example of an overview of a system with deterministic SFN re- multiplexing. The figure shows that the main (national) feed is generated at the head end, and also that the feed with regional services are generated at the same location. This is however not a requirement. </p><p id="p0031" num="0031"> It is further not required that a satellite system is used as the distribution system between the main head end and the SFN regions. Other types of distribution systems may be used, and is comprised in the claimed scope of protection. </p><p id="p0032" num="0032"> For timing control, the multiplexers at the main head end are referenced with 1PPS signals from a common source. Each of these multiplexers contains several internal virtual SFN adapters, one for each addressed SFN region. For each virtual SFN adapter, a sequence of special marker packets is inserted into the outgoing multiplex. The interval between these marker packets corresponds to the duration of the system specific block in the transmitted SFN stream. </p><p id="p0033" num="0033">At each transmitter site in an SFN region, a re-multiplexer receives the different satellite feeds. Inserting the same timing information into the streams ensures that each re- multiplexer uses timing information to produce compliant, fully deterministic output streams that will be accepted by the SFN modulators. </p><p id="p0034" num="0034"> The inventive method comprises several steps to be performed at the main head end and at the sites where regional transmitters are located. </p><p id="p0035" num="0035"> The purpose of a virtual SFN adapter is to construct a template SFN transport stream for a given region. The most essential part of this process is to insert timing information, contained in Time Marker Packets (TMP packets), into the outgoing satellite stream. The inserted TMPs contain all timing information needed in the re-multiplexing process. They also act as a placeholder for the system specific block descriptor packet contents, since TMPs are also used as source for regeneration of block descriptor packets in the remote stream. For a DVB-T network, the block descriptor packets are represented by the MIP - the Megaframe Initialisation Packet. </p><p id="p0036" num="0036"> The bandwidth used for these TMPs are negligible, as there will only be one packet per transmission block per SFN region (modulation type). </p><p id="p0037" num="0037"> The virtual SFN adapter also generates the Program Specific Information (PSI) and content metadata to be used in the SFN regions. The tables are typically remapped to a 
<!-- EPO <DP n="5"/>-->
 set of custom Packet IDs (PIDs). In each SFN region, these components are remapped back to the normal PID values. PSI and content metadata are typically regenerated based on a service selection process. </p><p id="p0038" num="0038"> In Figure 1 , the virtual SFN adapters are depicted as internal modules in the main head end multiplexer. However, since the timing insertion tolerates rate change after TMP insertion, the adapters may well be located in an external multiplexer before the main multiplexer. </p><p id="p0039" num="0039"> As said, the inventive method comprises several steps to be performed at the main head end and at the end where regional transmitters are located. This involves use of multiplexers both at the main head-end and regional head-ends. </p><p id="p0040" num="0040"> The first step in the inventive method is receiving feeds from at least one source, e.g. national or regional. Each feed is then being multiplexed by multiplexers at the satellite head end being referenced by 1PPS signals. </p><p id="p0041" num="0041"> The second step is providing internal virtual SFN adapters for each multiplexer, where these adapters generate virtual SFN streams denoting the SFN block structure to be used at remote receiving SFN regions. </p><p id="p0042" num="0042"> The virtual SFN adapters may further generate Program Specific Information (PSI/SI) to be used in remote SFN regions. </p><p id="p0043" num="0043"> The next step is inserting Time Marker Packets (TMP) into said virtual SFN streams, where said TMPs comprise timing information measured relative to said 1PPS signals.</p><p id="p0044" num="0044">The TMPs have a frequency corresponding to the system specific block descriptor packet repetition rate, which e.g. corresponds to Mega-frame Initialisation Packet (MIP) in case of DVB-T networks. </p><p id="p0045" num="0045"> The TMPs may further comprise essential system specific block descriptor data to be used as source for regeneration of system specific block descriptor packets in streams generated at regional sites. This may include information to control transmitters. They also contain ideal time stamps relative to a common 1PPS signal and corresponding Program Clock Reference (PCR) stamps, and the Packet ID. </p><p id="p0046" num="0046"> The last step performed at the head end is applying modulation with rate adaption to the outgoing final multiplexed transport streams. </p><p id="p0047" num="0047"> At each regional SFN transmitter site there are deterministic re-multiplexers receiving one or more of said final multiplexed transport streams. In the example shown in Figure 1 these signals are routed through a Direct-to -Home broadcast satellite. One of the inputs of the re-multiplexers at each regional transmitter site is selected as a master that will control the build process of outgoing SFN blocks from the transmitter, and each re- multiplexer performs the multiplexing on Packet ID (PID) basis. 
<!-- EPO <DP n="6"/>-->
 Timing information is extracted from said information markers in the virtual SFN streams for producing compliant and fully deterministic output streams that will be accepted by modulators. </p><p id="p0048" num="0048"> The re-multiplexers will multiplex on a PID-by-PID basis, following strict rules. For example, there can be no non-deterministic internal data carousels for opportunistic playout of PSI or content metadata sections. </p><p id="p0049" num="0049"> Several parameters need to be configured in each multiplexer. This includes inputs to be enabled and bitrate for each input. The bitrate cannot be determined by measuring methods. It must be fixed in order to obtain correct deterministic operation. Thus the fixed bitrate to be used for each input is configured. </p><p id="p0050" num="0050"> Another parameter that must be configured is the master input that contains the TMPs denoting the required SFN block structure, and which will be used to regenerate the system specific block descriptor packets. </p><p id="p0051" num="0051"> Further, PID filtering and re-mapping rules must be configured for each input. This includes routing of the selected components to be forwarded in the regional SFN multiplex, and remapping and forwarding of the centrally generated PSI/SI tables. </p><p id="p0052" num="0052"> Said Time Marker Packet in the master input defines a time window relative to 1PPS which starts at Ti<sub>PPS</sub> and ends at Ti<sub>PPS</sub> + T BLOCK - 1, where T BLOCK is the duration of an SFN transmission block and where a set of re-mapping rules are applied. These rules will be further explained below with reference to Figure 4. </p><p id="p0053" num="0053"> Each remote re-multiplexer in the same SFN region needs to use identical configurations in order to produce identical output streams. </p><p id="p0054" num="0054"> The deterministic re-multiplexing according to the invention has several characteristics.</p><p id="p0055" num="0055">The main characteristics of the solution are deterministic placement of TS packets received from different input streams. This means that it is possible to multiplex services from one or more input sources without any fixed limit, and the resulting output packet sequence is fully predictable. </p><p id="p0056" num="0056"> Due to the change of TS bitrate when going from e.g. a satellite feed to a local SFN region, PCR re-stamping needs to be performed, i.e. deterministic PCR re-stamping of TS packets. The outgoing video packets in an SFN region will have PCR jitter that is within the maximum jitter permitted for the PCR, which is +/- 500 ns. </p><p id="p0057" num="0057"> Another characteristic is deterministic insertion of system specific block descriptor packets, where each such packet will be inserted with predictable frequency, to produce compliant streams for the particular SFN modulation type in use. 
<!-- EPO <DP n="7"/>-->
 Packets from inputs will be interleaved as smoothly as possible, keeping the introduced packet jitter at a minimum. </p><p id="p0058" num="0058"> Different SFN regions may use different modulation parameters, thereby leading to different bitrates and different block sizes. The solution according to the invention is able to handle multiple block sizes (modulation types). This means that all different SFN regions may still be fed by the same main multiplex (National Feed in figure 1). </p><p id="p0059" num="0059"> There is no need for any specific synchronisation between different source multiplexers; only a common 1PPS reference signal is needed at every location. </p><p id="p0060" num="0060"> The presented solution handles NULL packet insertion (i.e. rate adaptation) at any stage between the main head end and the remote SFN site. This is an important aspect since many operators use DVBS/S2 modulators configured with an independent output bit rate, and thereby performs NULL packet insertion and PCR re-stamping. </p><p id="p0061" num="0061"> A further aspect of the invention is that an in-band solution for remote control can be implemented. Configuration messages addressed to a set of re-multiplexers in a remote SFN region can be inserted into the satellite multiplex, making it easy to manage a set of re-multiplexers synchronously from a central location. </p><p id="p0062" num="0062"> Figure 2 shows the TMP insertion process, and this will now be explained in detail. A TMP is a special kind of block descriptor packet that contains information to be used in the re-multiplexing process. The frequency of these packets matches the corresponding block descriptor packet frequency in the remote SFN region. The PID value of a TMP packet can be configured. </p><p id="p0063" num="0063"> TMP packets contain both an ideal timestamp and a real timestamp, which indicates the actual position in the stream when a TMP packet leaves the multiplexer. The real time stamp is also translated to a PCR field that will be used to compensate for later rate adaptation or re-multiplexing of the stream. TMPs also contain system specific block descriptor contents and a time, T<sub>B</sub>_ <sub>TX</sub>, that tells the regional multiplexer when to transmit/output the first TS packet in the block, relative to 1PPS. </p><p id="p0064" num="0064"> The TMP packets allow a deterministic virtual "arrival" timestamp to be calculated for all TS packets in the same stream. These timestamps are used in the multiplexing process. Timestamps denoted with T<sub>&lt;IDE</sub>N<sub>TIFIER</sub>&gt; are measured in 27MHz cycles, relative to a 1PPS source. The maximum value for these timestamps is 26999999. </p><p id="p0065" num="0065"> Figure 3 shows details of the Time Marker Packet. T<sub>IPPS</sub> is the distance from the last 1PPS pulse to the ideal transmission time for a TMP packet. However, due to the multiplexing process it is not possible to send the packet exactly at that time. A delay, T<sub>TX DELAY</sub>, is introduced before the packet leaves the multiplexer. The sum of these values is named T<sub>TMP</sub> and the value indicates the distance from the 1PPS pulse to the start of the TMP packet transmission. 
<!-- EPO <DP n="8"/>-->
 A PCR value for each transmitted TMP packet is calculated. The PCR value is incremented with the number of cycles corresponding to the difference between the current and previous T<sub>TMP</sub> value, e.g. (Τ<sub>ΤΜΡ</sub>(Π) - T<sub>T</sub>Mp(n-l)). The absolute value of the PCR value is not important. The calculated PCR value is stored both in a separate field, PCR<sub>TMP</sub> and as a normal PCR field in the TS packet. Initially, these values are exactly the same. In case the transport stream is rate adjusted later on, the difference between PCR and PCR<sub>TMP</sub> indicates the packet displacement due to rate adaptation. </p><p id="p0066" num="0066"> T<sub>BLOCK</sub> is the mathematical, ideal duration of one SEN transmission block. N<sub>BLOCK</sub> is the corresponding fixed number of TS packets in one such block. </p><p id="p0067" num="0067">On the receive side, deterministic arrival time stamps, named VATS - Virtual Arrival</p><p id="p0068" num="0068">Time Stamps, can be calculated for any input that contains a stream of TMPs. Let 7 be a fixed value for the time difference between two TS packets in the multiplex. 7 is a deterministic value that can easily be calculated from the configured bitrate of the input transport stream. </p><p id="p0069" num="0069">For a packet P that is displaced M packets from the TMP, the Virtual Arrival Time Stamp becomes: </p><p id="p0070" num="0070"> TARRIVAL(M) = M * TINT + TMP + (PCR - PCRTMP) + TCORR </p><p id="p0071" num="0071"> If the stream is received with no changes since it was generated, the difference between the two PCR values will be 0. </p><p id="p0072" num="0072">T<sub>CORR</sub> is a constant that is configurable per input. It needs to be the same for all multiplexers in a region. It may be used to adjust the time offset between the inputs in case there are significant differences in propagation delay for the various inputs. The default value for TCO<sub>RR</sub> is 0. </p><p id="p0073" num="0073"> T<sub>ARRIVAL</sub>(M) is used for both re-multiplexing and PCR correction, as described below. Figure 4 shows an overview of the deterministic re-multiplexing process. One input, typically the main feed, is selected as the master for the re-multiplexing process. Time Marker Packets in this stream indicate the start of a new block to be re-multiplexed.</p><p id="p0074" num="0074">The TMP in the master input defines a time window (relative to 1PPS) which starts at T<sub>1PPS</sub> and ends at T<sub>1PPS</sub> + TBLOCK - 1 - The multiplexer output rate is locked to 1PPS and it is determined by the T<sub>BLOCK</sub> and</p><p id="p0075" num="0075">N<sub>BLOCK</sub> values, according to the current modulation scheme. For a packet at offset N in an outgoing SFN transmission block a time stamp for transmission of a packet Ττχ(Ν) is calculated: </p><p id="p0076" num="0076"> TTX(N) = TIPPS + (N * TBLOCK) /NBLOCK. </p><p id="p0077" num="0077">For every outgoing packet position the calculated transmit time Ττχ(Ν) is compared to virtual arrival time stamps for a set of incoming packets. The rules for re-multiplexing at each position are as follows: 
<!-- EPO <DP n="9"/>-->
 At start-up of the process, TS packets to be considered must have an arrival time within the start of said time window and a calculated time Τ<sub>Τ</sub>χ(Ν) . Once started, TS packets to be considered must have an arrival time that is less than Ττχ(Ν). </p><p id="p0078" num="0078"> The first packet to be inserted in a period is the system specific block descriptor packet. This packet is regenerated from the TMP packet. </p><p id="p0079" num="0079"> PID filtering/remapping rules are checked for each input to decide which packets that should be forwarded; </p><p id="p0080" num="0080"> If more than one packet has arrived that should be inserted into the output, the packet with the lowest time stamp is used; </p><p id="p0081" num="0081">If two packets have exactly the same arrival time, the packet with the highest priority input is used. </p><p id="p0082" num="0082"> In case of temporary buffer increase due to bursts in the incoming TS packet rate for a PID, the multiplexer may experience that a backlog of packets are building up. E.g. the difference between Τ<sub>Τ</sub>χ(Ν) and T<sub>ARRIVAL</sub>(M) increases temporarily. The multiplexer will accept a difference given by a time T <sub>BA</sub>C<sub>KL</sub>O<sub>G</sub>. If the difference exceeds T <sub>BA</sub>C<sub>KL</sub>O<sub>G</sub>, the TS packet is dropped. T<sub>BACKLOG</sub> is a global parameter that is common for all re-multiplexers in a region. </p><p id="p0083" num="0083"> If no packet satisfies the criteria to be multiplexed, then a NULL packet is inserted. The content of the NULL packet is predefined and must be the same for all regional multiplexers within the SFN region. </p><p id="p0084" num="0084"> The multiplexing method according to the invention is fully deterministic and will lead to exactly the same packet output sequence from independent re-multiplexers, even in case of temporary overflow situations. </p><p id="p0085" num="0085"> When PCR packets are to be inserted into an outgoing multiplex, the packet position will be shifted due to the change of bit rate. If the packets contain PCR fields, the re- multiplexer needs to perform PCR adjustment, i.e. a PCR re-stamping process. This process is straightforward as the arrival time stamps T<sub>ARRIVAL</sub>(M) and departure times T<sub>TX</sub>(N) are already calculated and used in the re-multiplexing process. Say that a specific packet contains PCR and that this packet was received at offset M from the </p><p id="p0086" num="0086">corresponding TMP in the incoming stream. If the packet is sent at position N in the output block, the new outgoing PCR value is calculated as follows: </p><p id="p0087" num="0087"> PCROU<sub>T</sub> = PCR<sub>IN</sub> + T<sub>TX</sub>(N) - T<sub>ARRIVAL</sub>(M) </p><p id="p0088" num="0088"> The PCR value is adjusted for the change in packet position. It should be noted that the expression (T<sub>TX</sub>(N) - T<sub>ARRIVAL</sub>(M)) must be treated modulo 27000000. 26999999 corresponds to -1, 26999998 corresponds to -2 and so on. </p><p id="p0089" num="0089"> E.g. if T<sub>TX</sub>(N) is 1 and T<sub>ARRIVAL</sub>(M) is 26999999, the correction factor will be 2. 
</p></description><claims mxw-id="PCLM44852574" ref-ucid="WO-2012116743-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="10"/>--></claim-statement><claim id="clm-0001" num="1"><claim-text>1. A method for deterministic re-multiplexing of transport streams in Single Frequency Networks (SFN), the method comprising the following steps performed at the main head end: </claim-text><claim-text> - receiving feeds from at least one source, each feed being multiplexed on </claim-text><claim-text> multiplexers being referenced by a common 1PPS signal; </claim-text><claim-text> providing internal virtual SFN adapters for each multiplexer, where these adapters generate virtual SFN streams denoting the system specific block structure to be used at remote receiving SFN regions; </claim-text><claim-text> inserting Time Marker Packets (TMP) into said virtual SFN streams, said TMPs comprises timing information measured relative to said 1PPS signals, where said TMPs have a frequency corresponding to the transmission block frequency of the SFN streams; </claim-text><claim-text> applying rate adaptation that matches the system specific modulation scheme to outgoing final multiplexed transport streams, </claim-text><claim-text> and where the following steps are performed at regional transmitter sites: </claim-text><claim-text> receiving at least one of said final multiplexed transport streams on inputs of deterministic re-multiplexers; </claim-text><claim-text> extracting the timing information from said information markers in the virtual SFN streams for producing compliant and fully deterministic output streams that will be accepted by the SFN modulators. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. A method according to claim 1, where the virtual SFN adapters further generate the Program Specific Information and content metadata to be used in remote SFN regions. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. A method according to claim 1, where the TMP further comprises: </claim-text><claim-text> System specific content that will be used as source for regeneration of system specific block descriptor packets, like MIP for DVB-T, at regional sites; </claim-text><claim-text> an ideal time stamp and a real time stamp indicating the real position in the stream; </claim-text><claim-text> corresponding PCR values that is used to detect and compensate for rate adaptation in the transmission chain; <!-- EPO <DP n="11"/>--> system specific block descriptor packet contents (e.g. MIP), and </claim-text><claim-text> transmission time for the first packet in the block, relative to 1PPS. </claim-text></claim><claim id="clm-0004" num="4"><claim-text> 4. A method according to claim 1, where one of the inputs of the re-multiplexers at each regional transmitter site is selected as the master that will control the build process of outgoing SFN blocks of the transmitter, and each re-multiplexer performs the </claim-text><claim-text>multiplexing on Packet ID (PID) basis. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. A method according to claim 1 and 4, where the following and identical parameters are configured in each re-multiplexer located in the same SFN region: </claim-text><claim-text> - the inputs to be enabled, and a fixed bitrate to be used for each input; </claim-text><claim-text> the master input containing the TMPs that will be used as main markers for the re-multiplexing process; </claim-text><claim-text> PID filtering and re-mapping rules applied to each input to decide which packets that should be forwarded in the regional SFN multiplex, and remapping and forwarding of centrally generalised PSI tables and content metadata. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. A method according to claim 5, where the Time Marker Packet in the master input defines a time window relative to 1PPS, which starts at Ti<sub>PPS</sub> and ends at Ti<sub>PPS</sub> + T<sub>BL</sub>OC<sub>K</sub> - 1, where T<sub>BLOCK</sub> is the duration of an SFN transmission block, and where the following re-mapping rules are applied: </claim-text><claim-text> TS packets to be considered must have an arrival time that is less than the calculated time T<sub>T</sub>x(N) ; </claim-text><claim-text> if there are no packets that satisfies the criteria to be multiplexed, then a NULL packet is inserted; </claim-text><claim-text> if there are more that one packet that should be inserted into the output, the packet with the lowest time stamp is used; </claim-text><claim-text> - if two packets have exactly the same arrival time, the packet with the highest priority input is used; </claim-text><claim-text> in case the difference between Τ<sub>Τ</sub>χ(Ν) and the VATS time stamp exceeds a configured value T<sub>BA</sub>C<sub>KL</sub>O<sub>G</sub>, the packet is dropped. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. System for deterministic re-multiplexing of transport streams in Single Frequency Networks, the system comprising means for performing the method according to claims 1-6. </claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
