<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2681885-A1" country="EP" doc-number="2681885" kind="A1" date="20140108" family-id="44033797" file-reference-id="276467" date-produced="20180823" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146586403" ucid="EP-2681885-A1"><document-id><country>EP</country><doc-number>2681885</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12752821-A" is-representative="NO"><document-id mxw-id="PAPP154848595" load-source="docdb" format="epo"><country>EP</country><doc-number>12752821</doc-number><kind>A</kind><date>20120224</date><lang>EN</lang></document-id><document-id mxw-id="PAPP175460653" load-source="docdb" format="original"><country>EP</country><doc-number>12752821.4</doc-number><date>20120224</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140549482" ucid="CN-201110047724-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201110047724</doc-number><kind>A</kind><date>20110228</date></document-id></priority-claim><priority-claim mxw-id="PPC140548213" ucid="CN-2012071559-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2012071559</doc-number><kind>W</kind><date>20120224</date></document-id></priority-claim></priority-claims><technical-data><classification-ipc><edition>7</edition><main-classification>H04L  12/56</main-classification></classification-ipc><classifications-ipcr><classification-ipcr mxw-id="PCL-2137529959" load-source="docdb">H04L  29/08        20060101AFI20141106BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-2137523165" load-source="docdb" scheme="CPC">H04L  67/1023      20130101 LI20141114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-2137524499" load-source="docdb" scheme="CPC">H04L  67/1004      20130101 FI20141114BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989632762" load-source="docdb" scheme="CPC">H04L  69/167       20130101 LI20131017BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989651724" load-source="docdb" scheme="CPC">H04L  61/251       20130101 LI20131214BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132363842" lang="DE" load-source="patent-office">LASTENAUSGLEICHSVERFAHREN UND -VORRICHTUNGEN</invention-title><invention-title mxw-id="PT132363843" lang="EN" load-source="patent-office">LOAD BALANCING METHODS AND DEVICES</invention-title><invention-title mxw-id="PT132363844" lang="FR" load-source="patent-office">PROCÉDÉS ET DISPOSITIFS D'ÉQUILIBRAGE DE CHARGE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919533387" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HANGZHOU H3C TECH CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR919507788" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HANGZHOU H3C TECHNOLOGIES CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR919007893" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Hangzhou H3C Technologies Co., Ltd.</last-name><iid>100994503</iid><address><street>Huawei Hangzhou Manufacturing Base 310 Liuhe Road, Zhijiang Hi-Tech Park Hangzhou Hi-Tech Industry Development Zone</street><city>Hangzhou, Zhejiang 310053</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919542539" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SUN KAI</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR919537160" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SUN, KAI</last-name></addressbook></inventor><inventor mxw-id="PPAR919010975" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SUN, KAI</last-name><address><street>Room 730 Oriental Electronic BLD. NO.2, Chuangye Road Shangdi Information Industry Base Haidian district</street><city>Beijing 100085</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR919525794" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>LIN TAO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR919525748" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>LIN, TAO</last-name></addressbook></inventor><inventor mxw-id="PPAR919008542" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>LIN, TAO</last-name><address><street>Room 730 Oriental Electronic BLD. NO.2, Chuangye Road Shangdi Information Industry Base Haidian district</street><city>Beijing 100085</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919011424" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Rees, Simon John Lewis</last-name><iid>100819336</iid><address><street>Haseltine Lake LLP Redcliff Quay 120 Redcliff Street</street><city>Bristol BS1 6HU</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2012071559-W"><document-id><country>CN</country><doc-number>2012071559</doc-number><kind>W</kind><date>20120224</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012116616-A1"><document-id><country>WO</country><doc-number>2012116616</doc-number><kind>A1</kind><date>20120907</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549838289" load-source="docdb">AL</country><country mxw-id="DS549838388" load-source="docdb">AT</country><country mxw-id="DS549837852" load-source="docdb">BE</country><country mxw-id="DS549851737" load-source="docdb">BG</country><country mxw-id="DS549770470" load-source="docdb">CH</country><country mxw-id="DS549837853" load-source="docdb">CY</country><country mxw-id="DS549838389" load-source="docdb">CZ</country><country mxw-id="DS549838294" load-source="docdb">DE</country><country mxw-id="DS549837858" load-source="docdb">DK</country><country mxw-id="DS549837859" load-source="docdb">EE</country><country mxw-id="DS549914712" load-source="docdb">ES</country><country mxw-id="DS549851742" load-source="docdb">FI</country><country mxw-id="DS549770471" load-source="docdb">FR</country><country mxw-id="DS549838295" load-source="docdb">GB</country><country mxw-id="DS549837860" load-source="docdb">GR</country><country mxw-id="DS549838296" load-source="docdb">HR</country><country mxw-id="DS549838394" load-source="docdb">HU</country><country mxw-id="DS549770472" load-source="docdb">IE</country><country mxw-id="DS549837861" load-source="docdb">IS</country><country mxw-id="DS549851743" load-source="docdb">IT</country><country mxw-id="DS549837866" load-source="docdb">LI</country><country mxw-id="DS549851744" load-source="docdb">LT</country><country mxw-id="DS549760544" load-source="docdb">LU</country><country mxw-id="DS549851745" load-source="docdb">LV</country><country mxw-id="DS549851750" load-source="docdb">MC</country><country mxw-id="DS549760549" load-source="docdb">MK</country><country mxw-id="DS549760550" load-source="docdb">MT</country><country mxw-id="DS549760551" load-source="docdb">NL</country><country mxw-id="DS549770481" load-source="docdb">NO</country><country mxw-id="DS549760552" load-source="docdb">PL</country><country mxw-id="DS549914713" load-source="docdb">PT</country><country mxw-id="DS549760171" load-source="docdb">RO</country><country mxw-id="DS549914714" load-source="docdb">RS</country><country mxw-id="DS549760557" load-source="docdb">SE</country><country mxw-id="DS549838297" load-source="docdb">SI</country><country mxw-id="DS549770482" load-source="docdb">SK</country><country mxw-id="DS549770483" load-source="docdb">SM</country><country mxw-id="DS549837867" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA99837337" ref-ucid="WO-2012116616-A1" lang="EN" load-source="patent-office"><p num="0000">A load balancing method by a load balancing device providing a load balancing service to a group of servers. A service access request message sent by a client terminal is received at the load balancing device, wherein a source Internet Protocol address of the request message is an Internet Protocol address of the client terminal of a first protocol version. A server is selected from the group of servers to send the request message. A determination is made as to whether the first protocol version is same as a second protocol version of an IP address of the selected server. If determination is affirmative, the request message is sent to the selected server. Otherwise, network address translation is performed to replace the source Internet Protocol address of the request message with an Internet Protocol address of the second protocol version configured on an interface between the load balancing device and the group of servers, and the request message is sent to the selected server.</p></abstract><abstract mxw-id="PA100333073" ref-ucid="WO-2012116616-A1" lang="EN" source="national office" load-source="docdb"><p>A load balancing method by a load balancing device providing a load balancing service to a group of servers. A service access request message sent by a client terminal is received at the load balancing device, wherein a source Internet Protocol address of the request message is an Internet Protocol address of the client terminal of a first protocol version. A server is selected from the group of servers to send the request message. A determination is made as to whether the first protocol version is same as a second protocol version of an IP address of the selected server. If determination is affirmative, the request message is sent to the selected server. Otherwise, network address translation is performed to replace the source Internet Protocol address of the request message with an Internet Protocol address of the second protocol version configured on an interface between the load balancing device and the group of servers, and the request message is sent to the selected server.</p></abstract><abstract mxw-id="PA99837338" ref-ucid="WO-2012116616-A1" lang="FR" load-source="patent-office"><p num="0000">L'invention porte sur un procédé d'équilibrage de charge par un dispositif d'équilibrage de charge fournissant un service d'équilibrage de charge à un groupe de serveurs. Un message de requête d'accès à un service, envoyé par un terminal client, est reçu au niveau du dispositif d'équilibrage de charge, une adresse de protocole Internet source du message de requête étant une adresse de protocole Internet du terminal client d'une première version de protocole. Un serveur est sélectionné dans le groupe de serveurs afin d'envoyer le message de requête. Une détermination est effectuée quant au fait que la première version de protocole est la même ou non qu'une seconde version de protocole d'une adresse IP du serveur sélectionné. Si la détermination est affirmative, le message de requête est envoyé au serveur sélectionné. Sinon, une traduction d'adresse réseau est effectuée pour remplacer l'adresse de protocole Internet source du message de requête par une adresse de protocole Internet de la seconde version de protocole configurée sur une interface entre le dispositif d'équilibrage de charge et le groupe de serveurs, et le message de requête est envoyé au serveur sélectionné.</p></abstract><abstract mxw-id="PA100333074" ref-ucid="WO-2012116616-A1" lang="FR" source="national office" load-source="docdb"><p>L'invention porte sur un procédé d'équilibrage de charge par un dispositif d'équilibrage de charge fournissant un service d'équilibrage de charge à un groupe de serveurs. Un message de requête d'accès à un service, envoyé par un terminal client, est reçu au niveau du dispositif d'équilibrage de charge, une adresse de protocole Internet source du message de requête étant une adresse de protocole Internet du terminal client d'une première version de protocole. Un serveur est sélectionné dans le groupe de serveurs afin d'envoyer le message de requête. Une détermination est effectuée quant au fait que la première version de protocole est la même ou non qu'une seconde version de protocole d'une adresse IP du serveur sélectionné. Si la détermination est affirmative, le message de requête est envoyé au serveur sélectionné. Sinon, une traduction d'adresse réseau est effectuée pour remplacer l'adresse de protocole Internet source du message de requête par une adresse de protocole Internet de la seconde version de protocole configurée sur une interface entre le dispositif d'équilibrage de charge et le groupe de serveurs, et le message de requête est envoyé au serveur sélectionné.</p></abstract><description mxw-id="PDES51233560" ref-ucid="WO-2012116616-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="2"/>--><p id="p0001" num="0001"> LOAD BALANCING METHODS AND DEVICES </p><p id="p0002" num="0002">Background </p><p id="p0003" num="0003"> With rapid development of the Internet and continuous increase of demand for network services, there has been a significant increase of network data traffic. For example, for data centres, large-scale enterprises and portal websites, data traffic is estimated to have reached 10 GB/s which leads to the risk of server overload. Since the growth in processor speed and memory access is generally slower than that of network bandwidth and application service, servers have become a network bottleneck, especially in stand- alone network models where multiple client terminals are connected to a single server. </p><p id="p0004" num="0004">On the other hand, network technologies based on Internet Protocol version four (IPv4) have been a success, but the shortage of IPv4 addresses limits future development of IP -based applications. For example, although 80% of Class A network addresses, 50% of Class B network addresses and 10% of Class C network addresses had been allocated by 1996, the demand for IP addresses continues to increase rapidly as mobile and broadband technologies develop. Next-generation Internet Protocol version six (IPv6) was first proposed in the 1990s to serve as an upgrade version of IPv4. IPv6 provides almost unlimited address space, where address length is increased from 32-bit to 128-bit to provide 340 undecillion addresses and 67 quadrillion addresses per square meter of the Earth's surface. </p><p id="p0005" num="0005">Brief Description of Drawings </p><p id="p0006" num="0006"> Non-limiting example(s) will now be described with reference to the accompanying drawings, in which: </p><p id="p0007" num="0007"> Fig. 1 is a block diagram of an example network environment for load balancing; Fig. 2 is a flowchart of an example load balancing method by a load balancing device in the example network environment in Fig. 1; </p><p id="p0008" num="0008"> Fig. 3 is a flowchart of example method for the server selection in Fig. 2; </p><p id="p0009" num="0009"> Fig. 4 is a flowchart of example method for the network address translation in</p><p id="p0010" num="0010">Fig. 2; </p><p id="p0011" num="0011"> Fig. 5 is a message flow diagram in an example network where a client terminal and a load balancing device each use an IPv6 address, and a server selected by a load balancing device uses an IPv4 address; 
<!-- EPO <DP n="3"/>-->
 Fig. 6 is a message flow diagram in an example network where a client terminal and a load balancing device each use an IPv4 address, and a server selected by a load balancing device uses an IPv6 address; and </p><p id="p0012" num="0012"> Fig. 7 is a block diagram of an example structure of the load balancing device in Fig. 1. </p><p id="p0013" num="0013">Detailed Description </p><p id="p0014" num="0014"> Fig. 1 shows an example network environment 100 for load balancing, in which a load balancing device 110 is deployed between plural servers 130 ("group of servers") and client terminals 140 over a network 150. </p><p id="p0015" num="0015">A data store 120at the load balancing device 110 stores information associated with load balancing, such as information associated with configured IP addresses 122, a persistence table 124 and message characteristics 126; see also Fig. 7. An interface 111 ("first interface") between the load balancing device 110 and the client terminals 140 facilitates communication between the load balancing device 110 and the client terminals 140 via network 150. An interface 112 ("second interface") between the load balancing device 110 and the group of servers 130 facilitates communication between the load balancing device 110 and the group of servers 130; see also Fig. 7. </p><p id="p0016" num="0016">A server 130 may be a web server, database server, application server, proxy server, gateway server, mail server, or file server etc. A client terminal 140 may be any suitable computing equipment, such as a desktop computer, laptop computer, tablet computer and mobile communications device etc. The network 150 may be a local area network (LAN) such as a company virtual private network (VPN), a metropolitan area network (MAN), or a wide area network (WAN) such as the Internet etc. </p><p id="p0017" num="0017">The load balancing device 110 provides a load balancing service to the group of servers 130. In one application, for example, the load balancing device 110 serves as a front- end virtual server to client terminals 140, which do not have any awareness of the back- end servers 130. Compared with a stand-alone network model where a single server supports multiple terminals, the load balancing model in Fig. 1 provides greater network reliability and scalability, and the number of back-end servers 130 may be increased or decrease without any awareness by the client terminals 140. 
<!-- EPO <DP n="4"/>-->
 The load balancing device 110 provides to the client terminals 140 a virtual service address for sending service access request messages. When a service access request message is received from a client terminal 130, the load balancing device 110 selects a server from the group of servers 130, and sends the request message to the selected server 130. After processing the request message, a service access response message is sent by the selected server 130 to the load balancing device 110. The response message is then forwarded by the load balancing device 110 to the client terminal 130. </p><p id="p0018" num="0018">The server 130 selected by the load balancing device 110 may use an Internet Protocol (IP) address of a protocol version that is same as or different to the protocol version of the client terminal 140, such as in the following examples: </p><p id="p0019" num="0019">(i) The client terminal 140 and load balancing device 110 use IPv4 addresses, and the server group 130 is an IPv6 server group, or a mixed IPv4 and IPv6 server group. </p><p id="p0020" num="0020">(ii) The client terminal 140 and load balancing device 110 use IPv6 addresses, and the server group 130 is an IPv4 server group, or a mixed IPv4 and IPv6 server group. </p><p id="p0021" num="0021">(iii) The load balancing device 110 has a dual protocol address (IPv4 or IPv6) for a particular service, and the server group 130 is an IPv4 server group, IPv6 server group, or a mixed IPv4 and IPv6 server group. The protocol version numbers four and six each identify an addressing type of the request message. In particular, an IPv4 address such as 224.1.1.1 is a 32-bit address, whereas an IPv6 address such as 2001 :0410:0: l ::45ff is a 128-bit address. The term "IPv4" refers to 32-bit addressing and the term "IPv6" refers to 128-bit addressing, or any variations thereof. </p><p id="p0022" num="0022">If the protocol version of the selected server's IP address is different to the protocol version of the client terminal's IP address, the load balancing device 110 performs network address translation on the request message from the client terminal 140 before sending the request message to the selected server 130. After network address translation, a source IP address of the request message is a load balancing address configured on the interface 112 between the load balancing device 110 and the group of 
<!-- EPO <DP n="5"/>-->
 servers 130. The interface 112 may be a single interface or multiple sub-interfaces for sending messages to, and receiving messages from, the group of servers 130. </p><p id="p0023" num="0023">The load balancing device 110 is able to provide load balancing services to an IPv4 server group, an IPv6 server group or a mixed IPv4 and IPv6 server group. For example, in the case of mixed IPv4 and IPv6 server group 130, the load balancing device 110 might only receive IPv4 request messages during a particular period. If the IPv4 request messages were simply directed to the IPv4 servers, the risk of the IPv4 server overloading might increase while the IPv6 servers remain idle. By contrast, according to the present disclosure, the server group 130 is no longer limited to a particular protocol version as the load balancing device 110 is able to support both versions. This provides greater flexibility for networking applications while the transition from IPv4 to IPv6 addressing type is still ongoing. The load balancing device 110 may be applicable to both layer-4 and layer-7 technologies. Layer-4 technology is used to distribute service load based on transport layer characteristics. For example, the load may be distributed according to streams or sessions, where all service messages in the same connection are sent to the same server. The layer-7 technology generally refers to load balancing based on HTTP service, which generally needs to identify transmission contents to determine the load sharing strategy. </p><p id="p0024" num="0024">An example load balancing method by the load balancing device 110 will now be explained in further detail with reference to Fig. 2, Fig. 3 and Fig. 4. </p><p id="p0025" num="0025">Load Balancing Addresses </p><p id="p0026" num="0026"> At block 210 in Fig. 2, one or more load balancing IP addresses 152 are configured on an interface 112 between the load balancing device 110 and the group of servers 130. The configured load balancing IP addresses include IPv4 addresses, IPv6 addresses or a mix of IPv4 and IPv6 addresses to correspond with the protocol version of the IP addresses of the servers 130. </p><p id="p0027" num="0027">For example, if the group of servers 130 is an IPv4 server group, the configured load balancing IP addresses are IPv4 addresses. If the group of servers 130 is an IPv6 server group, the configured load balancing addresses are IPv6 addresses. If the group 130 is 
<!-- EPO <DP n="6"/>-->
 a mixed IPv4 and IPv6 server group, both IPv4 and IPv6 addresses are configured to correspond to the IP version used by the servers. </p><p id="p0028" num="0028">The configuration process assigns the IPv4 and/or IPv6 addresses to the interface 112 to facilitate communication between the load balancing device 110 and the respective IPv4 and/or IPv6 servers 130. Any suitable methods for IP address configuration may be used, such as manual configuration, dynamic host configuration protocol (DHCP) and point-to-point protocol (PPP) etc. Service Access Request Message </p><p id="p0029" num="0029"> At block 220 in Fig. 2, the load balancing device 110 receives a service access request message from a client terminal 140. The source IP address of the request message is an IP address of the client terminal 140, and its destination IP address is a virtual service IP address of the load balancing device 110. The request message is received via the interface 111 between the load balancing device 110 and the client terminal 140. </p><p id="p0030" num="0030">The protocol version of the client terminal's 140 IP address corresponds to the protocol version of the virtual service access address of the load balancing device 110, as exemplified below: </p><p id="p0031" num="0031">(a) If the source IP address of the request message is an IPv4 address of the client terminal 140 and the destination address an IPv4 virtual service address of the load balancing device 110. </p><p id="p0032" num="0032"> (b) If the source IP address of the request message is an IPv6 address of the client terminal 140 and the destination address an IPv6 virtual service address of the load balancing device 110. </p><p id="p0033" num="0033">In one example, the load balancing device 110 has a dual-protocol address for the same service, in that request messages may be directed to either an IPv4 or an IPv6 virtual service address of the load balancing device 110. In this case, a request message from a client terminal's 140 IPv4 address is sent to the IPv4 virtual service address, while a request message from a client terminal's 140 IPv6 address is sent to the IPv6 virtual service address. </p><p id="p0034" num="0034">Selection of a Server </p><p id="p0035" num="0035"> At block 230 in Fig. 2, the load balancing device 110 selects a server from the group of servers 130 to send the service access request message. The selected server 130 uses 
<!-- EPO <DP n="7"/>-->
 an IP address, which may be of protocol version four or six ("second protocol version"). One example of the server selection process is shown in Fig. 3. </p><p id="p0036" num="0036">At block 232 in Fig. 3, the load balancing device 110 determines whether a persistence or continuity function is enabled at the load balancing device 110. In practice, the persistence function is useful for services where messages with a predetermined relationship should be sent to the same server 130 for processing. For example in a hypertext transfer protocol (HTTP) service, messages relating to the same service should be sent to the same server 130 to maintain continuity of the messages and reliability of the HTTP connection. </p><p id="p0037" num="0037">At block 234, if persistence function is disabled, the load balancing device 110 selects the server using a predetermined load balancing algorithm, which may be one of the following: </p><p id="p0038" num="0038"> round robin algorithm; </p><p id="p0039" num="0039"> hash algorithm, such as based on the client terminal's IP address etc.; </p><p id="p0040" num="0040"> least connection algorithm; </p><p id="p0041" num="0041"> server pressure algorithm; and </p><p id="p0042" num="0042"> weighting algorithm. </p><p id="p0043" num="0043">In one example, each server 130 is assigned a unique identifier, such as in the form of a sequence number etc., and the load balancing algorithm calculates an identifier of a server 130 selected for processing the request message. If persistence function is enabled, the load balancing device 110 selects the server based on information stored in a persistence table 124 in the data store 120. Each entry of the persistence table 124 includes an identifier of a server 130, and one or more characteristics of a request message previously processed by the server 130. The load balancing device 110 first matches one or more characteristics of the request message with one of the entries in the persistence table 124; see block 236. Depending on the requirements in practice, the characteristics in the persistence table entry may include one or more of the following: source IP address, destination IP address, source port number, and destination port number of the message. 
<!-- EPO <DP n="8"/>-->
 If a match is found at block 236, the load balancing device 110 determines a server identifier from the matching entry, and selects the server having the identifier to send the request message; see block 238. Otherwise, if there is no match, a predetermined load balancing algorithm is used to select the server 130 to which the message should be sent and a new entry is created in the persistence table; see block 239. The new entry includes one or more characteristics of the message and the identifier of the server selected using the predetermined load balancing algorithm. </p><p id="p0044" num="0044">Protocol Version </p><p id="p0045" num="0045"> At block 240 in Fig. 2, after selecting the server 130, the load balancing server 110 determines whether the protocol version of the IP address of the client terminal 140 ("first protocol version") is the same as the protocol version of the IP address of the selected server 130 ("second protocol version"). </p><p id="p0046" num="0046">If the first protocol version is the same as the second protocol version, the load balancing device 110 forwards the request message to the selected server 130; see block 270. In this case, if both the client terminal and the selected server 130 use IPv4 or IPv6 addressing, the request message is sent to the selected server 130. </p><p id="p0047" num="0047">Otherwise, if the first and second protocol versions are not the same, the load balancing device 110 selects, from the load balancing IP addresses configured at 210, a load balancing IP address of the second protocol version to correspond to the IP address of the selected server 130; see block 250. </p><p id="p0048" num="0048">In this case, if the client terminal uses an IPv6 address but the selected server 130 uses an IPv4 address, the selected IP address is an IPv4 load balancing address configured on the interface 112 between the load balancing device 110 and the group of servers 130. If the client terminal uses an IPv4 address but the selected server 130 uses IPv6, the selected IP address is an IPv6 load balancing address configured on the interface 112. 
<!-- EPO <DP n="9"/>-->
 Address Translation </p><p id="p0049" num="0049"> At block 260 in Fig. 2, the load balancing device 110 then performs network address translation on the request message. One example of network address translation will now be explained with reference to Fig. 4. </p><p id="p0050" num="0050">The load balancing device 110 performs source network address translation (SNAT) processing on the request message; see block 262. The source IP address of the request message is changed from the IP address of the client terminal to the load balancing IP address selected at block 250. A source port number of the request message may be replaced with a port number, which may be randomly allocated for example. </p><p id="p0051" num="0051">The load balancing device 110 performs destination network address translation (DNAT) processing on the request message; see block 264. The destination IP address of the request message is changed to the IP address of the selected server. If port numbers are also configured, a destination port number of the request message may also be changed to a configured port number. </p><p id="p0052" num="0052">The load balancing device 110 also stores one or more characteristics of the request message before and after network address translation in the data store 120; see block 266. The message characteristics 126 stored include the source IP address and the destination IP address of the request message. The characteristics relate to stream characteristics of the request message, such as the source port number and the destination port number of the request message before and after SNAT and DNAT may also be stored. Information of the corresponding transport protocol, such as transport control protocol (TCP), user datagram protocol (UDP) and raw IP etc. may also be stored. </p><p id="p0053" num="0053">If the selected server 130 uses an IPv4 address but the request message is sent by an IPv6 client terminal 140, the source IP address of the request message is converted from the IPv6 address of the client terminal 140 to an IPv4 load balancing address configured on the interface 112 between the load balancing device 110 and the servers 130. </p><p id="p0054" num="0054">On the other hand, if the selected server 130 uses an IPv6 address but the request message is sent by an IPv4 client terminal 140, the source IP address of the request message is converted from the client terminal's IPv4 address to an IPv6 load balancing 
<!-- EPO <DP n="10"/>-->
 address configured on the interface 112 between the load balancing device 110 and the servers 130. </p><p id="p0055" num="0055">After performing network address translation, the load balancing device 110 sends the request message to the selected server 130; see block 270 in Fig. 2. The request message is sent via the interface 112 between the load balancing device 110 and the group of servers 130. </p><p id="p0056" num="0056">Service Access Response Message </p><p id="p0057" num="0057">At block 280 in Fig. 2, after receiving and processing the request message, the selected server 130 returns a service access response message to the load balancing device 110. The service access response message is received via the interface 112 between the load balancing device 110 and the group of servers 130. The source IP address of the response message is the IP address of the selected server 130. The destination IP address of the response message is the IP address of the load balancing device 110, which is the same as the source IP address of the service access request message sent by the load balancing device 110. At block 290, the load balancing device 110 performs network address translation on the response message, after which the source IP address of response message is the virtual service address of the load balancing device 110 and its destination address the IP address of the client terminal 140 that sent the corresponding request message. In one example, the load balancing device 110 searches the message characteristics 126 before and after SNAT and DNAT in the data store 120, and modifies the characteristics of the response message based on the characteristics of the corresponding request message before SNAT and DNAT. After network address translation, the load balancing 110 sends the response message to the client terminal 140 via the interface 111 between the load balancing 110 and the client terminal 140. </p><p id="p0058" num="0058">Examples </p><p id="p0059" num="0059">In a first example 500 shown in Fig. 5, the client terminal 140 uses an IPv6 address, the load balancing device 110 uses an IPv6 virtual service address and the selected server 
<!-- EPO <DP n="11"/>-->
 130 uses an IPv4 address. The server group 130 may be an IPv4 server group or a mixed IPv4 and IPv6 server group. </p><p id="p0060" num="0060">At block 510, an IPv4 load balancing address is configured on the interface 112 between the load balancing device 110 and the servers 130. See also 210 in Fig. 2. </p><p id="p0061" num="0061">At block 520, the load balancing device 110 receives a service access request message from the client terminal 130. The source IP address of the message is the IPv6 address of the client terminal 130, and the destination address is a virtual service access IPv6 address of the load balancing device 110. See also 220 in Fig. 2. </p><p id="p0062" num="0062">At block 530, the load balancing device 110 selects a server from the server group 130 to process the request message. See also 230 in Fig. 2 and Fig.</p><p id="p0063" num="0063">3. In this example, the selected server 130 uses an IPv4 address. </p><p id="p0064" num="0064">At block 540, the load balancing device 110 determines that the protocol version of the client terminal's IPv6 address is different to that of the selected server's IPv4 address, and performs network address translation on the request message. The source IP address of the request message is changed to the IPv4 load balancing address configured at 510, and the destination IP address changed to the selected server's IPv4 address. Message characteristics 126 before and after SNAT and DNAT are stored in the data store 120; see also 270 in Fig. 2 and Fig. 4. The stored message characteristics may include source IP address, source port number, destination IP address, destination port number and transport protocol version number. </p><p id="p0065" num="0065">At block 550, the selected server 130 receives and processes the service access request message, after which a service access response message is sent to the load balancing device 110. The source IP address of the response message is the selected server's IPv4 address, and the destination IP address is the source IP address of request message, that is the IPv4 load balancing address configured at 
<!-- EPO <DP n="12"/>-->
 At block 560, the load balancing device 110 receives and performs network address translation on the response message. Based on the response message's the source IP address (selected server's IPv4 address), source port number, destination IP address, destination port number and information of transport protocol (such as its version number), the load balancing device 110 searchers for the corresponding client terminal's IPv6 address from the characteristics stored at 540. The destination IP address of the response message is then replaced with the client terminal's IPv6 address. At block 570, the response message is sent to the client terminal 130. The source address of the response message is the load balancing device's IPv6 virtual service address, and the destination address is the client terminal's IPv6 address. In a second example 600 shown in Fig. 6, the client terminal 140 uses an IPv4 address, the load balancing device 110 uses an IPv4 virtual service address and the selected server 130 uses an IPv6 address. The server group 130 may be an IPv6 server group or a mixed IPv4 and IPv6 server group. At block 610, an IPv6 load balancing address is configured on the interface 112 between the load balancing device 110 and the servers 130. See also 210 in Fig. 2. </p><p id="p0066" num="0066">At block 620, the load balancing device 110 receives a service access request message from the client terminal 130. The source IP address of the message is the IPv4 address of the client terminal 130, and the destination address is a virtual service access IPv4 address of the load balancing device 110. See also 220 in Fig. 2. At block 630, the load balancing device 110 selects a server from the server group 130 to process the request message. In this scenario, the selected server 130 is an IPv6 server. See also 230 in Fig. 2 and Fig. 3. </p><p id="p0067" num="0067">At block 630, the load balancing device 110 determines that the protocol version of the client terminal's IPv4 address is different to that of the selected server's IPv6 address, and performs network address translation on the request 
<!-- EPO <DP n="13"/>-->
 message. The source IP address of the request message is changed to the IPv6 load balancing address configured at 510 and the destination IP address to the selected server's IPv6 address. Message characteristics 126 before and after SNAT and DNAT are stored in the data store 120; see also 270 in Fig. 2 and Fig. 4. </p><p id="p0068" num="0068">At block 640, the selected server 130 receives and processes the service access request message, after which a service access response message is sent to the load balancing device 110. The source IP address of the response message is the selected server's IPv6 address, and the destination IP address is the source IP address of request message, that is the IPv6 load balancing address configured at 510. </p><p id="p0069" num="0069">At block 650, the load balancing device 110 receives and performs network address translation on the response message. Based on the response message's the source IP address (selected server's IPv6 address), source port number, destination IP address, destination port number and transport protocol version, the load balancing device 110 searches for the corresponding client terminal's IPv4 address from the characteristics stored at 540. The destination IP address of the response message is then replaced with the client terminal's</p><p id="p0070" num="0070">IPv4 address. </p><p id="p0071" num="0071">At block 660, the response message is sent to the client terminal 130. The source address of the response message is the load balancing device's IPv4 virtual service address, and the destination address is the client terminal's IPv4 address. </p><p id="p0072" num="0072">In a third example, the load balancing device 110 provides a dual-protocol address for the same service, in which both IPv4 and IPv6 virtual service addresses are provided. In this case, the load balancing device 110 are able to handle request messages from IPv4 and IPv6 client terminals 130. If the client terminal uses an IPv6 address but the selected server uses an IPv4 address, the load balancing device 110 performs the process exemplified with the second scenario in Fig. 5. If the client terminal uses an IPv4 address but the selected server uses an IPv6 address, the load balancing device 110 performs the process exemplified with the second scenario in Fig. 6. 
<!-- EPO <DP n="14"/>-->
 Load Balancing Device </p><p id="p0073" num="0073"> An example structure of the load balancing device 110 is shown in Fig. 7, in which the load balancing device 110 includes first interface 111 and second interface 112; a processor 116; and a data store 120 in communication with each other via a communication bus 114. </p><p id="p0074" num="0074">The first and second interfaces 111, 112 facilitate communication between the load balancing device 110 and the client terminals 140 and the group of servers 130, respectively. Each interface 111, 112 may be an I/O device or switching module etc., and comprises hardware and/or software components, such as an interface card (high density or low density), bus connections, encoders, decoders, modulators etc. </p><p id="p0075" num="0075">The term 'processor' is to be interpreted broadly to include a central processing unit (CPU), processing unit, application-specific integrated circuit (ASIC), logic unit, or programmable gate array etc. In one example (not shown in Fig. 7 for simplicity), the processor 116 may implement functional units, including a receiving unit, server selection unit, an address version matching unit, an address selection unit, an address translation unit and a sending unit etc., in which: </p><p id="p0076" num="0076">The receiving unit implemented by the processor 116 is to receive a service access request message from a client terminal via the first interface 111, the client terminal using an IP address of a first protocol version; see also block 220 in Fig. 2. </p><p id="p0077" num="0077">The server selection unit implemented by the processor 116 is to select a server from the group of servers 130, the selected server using an IP address of a second protocol version; see also block 230 in Fig. 2. If a persistence function is disabled, the server selection unit selects the server using a predetermined load balancing algorithm. Otherwise, if the persistence function is enabled, the server selection unit matches one or more characteristics of the request message with an entry in the persistence table 124 in the data store 120. If a match is found, the server selection unit selects the server identified by the matching entry. Otherwise, if a match is not found, the server selection unit selects a server using a predetermined load balancing algorithm and creates a new entry in the persistence table. See also blocks 232 to 239 in Fig. 3. 
<!-- EPO <DP n="15"/>-->
 The address version matching unit implemented by processor 116 is to determine whether the first protocol version is the same as the second protocol version; see also 240 in Fig. 2. </p><p id="p0078" num="0078">The address selection unit implemented by the processor 116 is to, if the determination is not affirmative, select an IP address of the second protocol version from IP addresses configured on the interface 112 between the load balancing device and the group of servers; see also block 250 in Fig. 2. The IP addresses 122 are stored in the data store 120. </p><p id="p0079" num="0079">The address translation unit implemented by the processor 116 is to perform network address translation on the request message; see block 260 in Fig. 2. In particular, the address translation unit 116 performs a source network address translation (SNAT) on the request message, after which the source address of the request message is the selected IP address of the second protocol version. The address translation unit 116 further performs destination network address translation (DNAT) on the request message, after which the destination address is changed to the selected server's IP address of the second protocol version. Message characteristics 126 before and after SNAT and DNAT are stored by the address translation unit in the data store 120. The characteristics may be a source IP address, a destination IP address, a source port number and a destination port number. </p><p id="p0080" num="0080">The sending unit implemented by the processor 116 is to send the request message to the selected server via the second interface 112; see also block 270 in Fig. 2. </p><p id="p0081" num="0081">The receiving unit implemented by the processor 116 is further to receive a service access response message from the selected server via the second interface 112; see also block 280 in Fig. 2. </p><p id="p0082" num="0082">The address translation unit implemented by the processor 116 is to perform network address translation on the received response message based on the message characteristics 124 before and after SNAT and DNAT previously stored in the data store 120. The source address of the response message is changed to the load balancing device's virtual service address, and the 
<!-- EPO <DP n="16"/>-->
 destination address to the IP address of the client terminal. See also block 290 in Fig. 2. </p><p id="p0083" num="0083">The sending unit implemented by the processor 116 is further to send the response message to the client terminal via the first interface 111; see also block</p><p id="p0084" num="0084">290 in Fig. 2. </p><p id="p0085" num="0085">The processes, methods and functional units may all be performed by a single processor 120 or split between several processors; reference in this disclosure or the claims to a 'processor' should thus be interpreted to mean One or more processors'. Similarly, the functionality of the first 111 and second 112 interfaces may be each split between several sub-interfaces, and therefore the term 'interface' in this disclosure should be interpreted to mean 'one or more interfaces'. Although the data store 120 is shown as an internal data store, the data store 120 may be external to, but accessible by, the load balancing device 110. The term 'data store' should also be interpreted broadly to mean 'one or more data stores'. </p><p id="p0086" num="0086">Further, the processes, methods and functional units described in this disclosure may be implemented in the form of a computer program product. The computer program product is stored in a computer-readable storage medium and comprises computer- readable instructions to cause the processor 116 of the load balancing device to implement the methods, processes and functional units recited in the examples of the present disclosure. The figures are only illustrations of an example, wherein the methods, processes and functional units in the figures are not necessarily essential for implementing the present disclosure. Those skilled in the art will understand that the functional units in the device in the example can be arranged in the device in the examples as described, or can be alternatively located in one or more devices different from that in the examples. The functional units in the examples described can be combined into one module or further divided into a plurality of sub-units. </p><p id="p0087" num="0087">Although the flowcharts described show a specific order of execution, the order of execution may differ from that which is depicted. For example, the order of execution of two or more blocks may be changed relative to the order shown. Also, two or more 
<!-- EPO <DP n="17"/>-->
 blocks shown in succession may be executed concurrently or with partial concurrence. All such variations are within the scope of the present disclosure. </p><p id="p0088" num="0088">It will be appreciated that numerous variations and/or modifications may be made to the examples without departing from the scope of the disclosure. The present examples are, therefore, to be considered in all respects as illustrative and not restrictive. 
</p></description><claims mxw-id="PCLM44852740" ref-ucid="WO-2012116616-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="18"/>-->Claims </claim-statement><claim id="clm-0001" num="1"><claim-text>1. A load balancing method by a load balancing device providing a load balancing service to a group of servers, the method comprising: </claim-text><claim-text> receiving a service access request message sent by a client terminal, wherein a source Internet Protocol address of the request message is an Internet Protocol address of the client terminal of a first protocol version; </claim-text><claim-text> selecting a server from the group of servers to send the request message; </claim-text><claim-text> determining whether the first protocol version is same as a second protocol version of an IP address of the selected server; and </claim-text><claim-text> if determination is affirmative, sending the request message to the selected server; but otherwise, performing network address translation to replace the source Internet Protocol address of the request message with an Internet Protocol address of the second protocol version configured on an interface between the load balancing device and the group of servers, and sending the request message to the selected server. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. The method according to claim 1, wherein: </claim-text><claim-text> the group of servers includes servers using Internet Protocol addresses of the first protocol version and second protocol version, and </claim-text><claim-text> the Internet Protocol address of the second protocol version configured on an interface between the load balancing device and the group of servers is selected from Internet Protocol addresses of the first protocol version and second protocol version configured on the interface between the load balancing device and the group of servers. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. The method according to claim 1, wherein performing network address translation further comprises: </claim-text><claim-text> replacing a destination Internet Protocol address of the request message with the Internet Protocol address of the selected server; and </claim-text><claim-text> storing one or more characteristics of the service access request message before and after network address translation of the source and destination Internet Protocol addresses of the request message, </claim-text><claim-text> wherein the one or more characteristics include one or more of: source Internet Protocol address, source port number, destination Internet Protocol address or destination port number. <!-- EPO <DP n="19"/>--> </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. The method according to claim 3, further comprising, after sending the request message to the selected server: </claim-text><claim-text> receiving a service access response message from the selected server; </claim-text><claim-text> replacing a destination Internet Protocol address of the response message with the Internet Protocol address of the client terminal; and </claim-text><claim-text> sending the response message to the client terminal. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. The method according to claim 4, wherein replacing the destination Internet Protocol address of the response message with the Internet Protocol address of the client terminal further comprises: </claim-text><claim-text> searching the stored characteristics for characteristics that correspond with characteristics of the response message, and </claim-text><claim-text> replacing the characteristics of the response message with the characteristics of the request message before the network address translation. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. The method according to claim 1, wherein selecting the server from the group of servers comprises: </claim-text><claim-text> matching characteristics of the service access request message with an entry of a persistence table; </claim-text><claim-text> if a match is found, selecting a server identified by the matching entry; </claim-text><claim-text> but otherwise, if a match is not found, selecting a server from the group of servers using a predetermined load balancing algorithm, and creating a new entry in the persistence table, wherein the new entry includes characteristics of the message and a server identifier of the selected server. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. The method according to claim 6, further comprising, before the load balancing device matching the characteristics of the service access request message with one or more entries of the persistence table: </claim-text><claim-text> determining whether a persistence function of the device is enabled; and if the determination is affirmative, matching the characteristics of the request message with one or more entries in the persistence table; but otherwise, selecting the server using a predetermined load balancing algorithm. <!-- EPO <DP n="20"/>--> </claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. A load balancing device for providing a load balancing service to a group of servers, the device comprising: </claim-text><claim-text> a first interface to facilitate communication between the load balancing device and a client terminal; </claim-text><claim-text> a second interface to facilitate communication between the load balancing device and the group of servers; </claim-text><claim-text> a processor to: </claim-text><claim-text> receive a service access request message from a client terminal via the first interface, wherein a source Internet Protocol address of the request message is an IP address of a first protocol version of the client terminal; </claim-text><claim-text> select a server from the group of servers to send the request message; determine whether the first protocol version is same as a second protocol version of an IP address of the selected server; </claim-text><claim-text> if the determination is affirmative, send the request message to the selected server via the second interface; but otherwise </claim-text><claim-text> if the determination is not affirmative, perform network address translation to replace the source Internet Protocol address of the request message with an Internet Protocol address of the second protocol version configured on the second interface; and send the request message to the selected server via the second interface. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. The load balancing device according to claim 8, wherein the processor is further to: </claim-text><claim-text> select the Internet Protocol address of the second protocol version configured on the second interface from Internet Protocol addresses of the first protocol version and the second protocol version configured on the second interface, </claim-text><claim-text> wherein the first and second protocol versions of the Internet Protocol addresses configured on the second interface correspond to first protocol version and second protocol version of the Internet Protocol addresses of the group of servers. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. The load balancing device according to claim 8, wherein the processor is further to: </claim-text><claim-text> receive a service access response message from the selected server via the second interface after the request message is sent to the selected server; </claim-text><claim-text> replace a destination Internet Protocol address of the response message with the</claim-text><claim-text>Internet Protocol address of the client terminal; and <!-- EPO <DP n="21"/>--> send the response message to the client terminal via the first interface. </claim-text></claim><claim id="clm-0011" num="11"><claim-text>11. The load balancing device according to claim 8, wherein the processor is further to: </claim-text><claim-text> replace a destination Internet Protocol address of the request message with the</claim-text><claim-text>Internet Protocol address of the selected server before the request message is sent to the selected server; and </claim-text><claim-text> store, in a data store, one or more characteristics of the service access request message before and after the network address translation of the source and destination Internet Protocol addresses of the request message, </claim-text><claim-text> wherein the one or more characteristics include one or more of: source Internet Protocol address, source port number, destination Internet Protocol address or destination port number. </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. The load balancing device according to claim 11, wherein the processor is further to, when replacing the destination Internet Protocol address of the response message with the Internet Protocol address of the client terminal: </claim-text><claim-text> search, in the data store, for characteristics that correspond with characteristics of the response message; and </claim-text><claim-text> replace the characteristics of the response message with the characteristics of the request message before the network address translation. </claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. The load balancing device according to claim 8, wherein the processor is further to: </claim-text><claim-text> match characteristics of the service access request message with one or more entries of a persistence table in a data store; </claim-text><claim-text> if a match is found, select a server identified by a server identifier in the matching entry; </claim-text><claim-text> but otherwise, if a match is not found, select a server from the group of servers using a predetermined load balancing algorithm, and create a new entry in the persistence table, wherein the new entry includes characteristics of the message and a server identifier of the selected server. </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. The load balancing device according to claim 13, wherein the processor is further to: <!-- EPO <DP n="22"/>--> before matching the characteristics of the service access request message with one or more entries of the persistence table, determine whether a persistence function of the device is enabled; and </claim-text><claim-text> if the determination is affirmative, match the characteristics of the request message with one or more entries in the persistence table; but otherwise, select the server using a predetermined load balancing algorithm. </claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. A computer program product for providing a load balancing service to a group of servers, the computer program product comprising computer readable storage medium storing machine readable instructions which are executable by a processor, the machine-readable instructions comprising instructions to the processor to: </claim-text><claim-text> receive a service access request message sent by a client terminal, wherein a source Internet Protocol address of the request message is an Internet Protocol address of the client terminal of a first protocol version; </claim-text><claim-text> select a server from the group of servers to send the request message; </claim-text><claim-text> determine whether the first protocol version is same as a second protocol version of an IP address of the selected server; and </claim-text><claim-text> if determination is affirmative, send the request message to the selected server; but otherwise, perform network address translation to replace the source Internet Protocol address of the request message with an Internet Protocol address of the second protocol version configured on an interface between the load balancing device and the group of servers, and send the request message to the selected server. </claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
