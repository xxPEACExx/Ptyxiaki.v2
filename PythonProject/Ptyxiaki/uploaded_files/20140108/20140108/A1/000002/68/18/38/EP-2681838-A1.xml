<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2681838-A1" country="EP" doc-number="2681838" kind="A1" date="20140108" family-id="46718511" file-reference-id="282113" date-produced="20180822" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146585666" ucid="EP-2681838-A1"><document-id><country>EP</country><doc-number>2681838</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12752536-A" is-representative="NO"><document-id mxw-id="PAPP154847858" load-source="docdb" format="epo"><country>EP</country><doc-number>12752536</doc-number><kind>A</kind><date>20120222</date><lang>EN</lang></document-id><document-id mxw-id="PAPP220439936" load-source="docdb" format="original"><country>EP</country><doc-number>12752536.8</doc-number><date>20120222</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140551068" ucid="US-201113036513-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201113036513</doc-number><kind>A</kind><date>20110228</date></document-id></priority-claim><priority-claim mxw-id="PPC140548374" ucid="US-2012025993-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>2012025993</doc-number><kind>W</kind><date>20120222</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989318753" load-source="docdb">H02P   6/00        20060101AFI20120920BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1773920324" load-source="docdb" scheme="CPC">H02P  29/67        20161101 LI20170807BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1773920325" load-source="docdb" scheme="CPC">H02P  21/16        20160201 LA20170807BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1773920326" load-source="docdb" scheme="CPC">H02P  21/14        20130101 LI20170807BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1773920327" load-source="docdb" scheme="CPC">H02P  21/0025      20130101 LI20170807BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989636775" load-source="docdb" scheme="CPC">H02P  27/085       20130101 LI20130101BHEP        </classification-cpc><classification-cpc mxw-id="PCL1989651702" load-source="docdb" scheme="CPC">H02P   6/085       20130101 FI20130101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132361631" lang="DE" load-source="patent-office">SYSTEME FÜR MASCHINEN MIT INNEREN PERMANENTMAGNETEN UND VERFAHREN ZUR STEUERUNG DER SYSTEME FÜR MASCHINEN MIT INNEREN PERMANENTMAGNETEN</invention-title><invention-title mxw-id="PT132361632" lang="EN" load-source="patent-office">INTERIOR PERMANENT MAGNET MACHINE SYSTEMS, AND METHODS FOR CONTROLLING INTERIOR PERMANENT MAGNET MACHINES</invention-title><invention-title mxw-id="PT132361633" lang="FR" load-source="patent-office">SYSTÈMES DE MACHINES À AIMANTS PERMANENTS INTÉRIEURS, ET PROCÉDÉS DE COMMANDE DESDITES MACHINES</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919538772" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>DEERE &amp; CO</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR919524465" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>DEERE &amp; COMPANY</last-name></addressbook></applicant><applicant mxw-id="PPAR919016937" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Deere &amp; Company</last-name><iid>101150216</iid><address><street>One John Deere Place</street><city>Moline, IL 61265</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919535857" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>WU LONG</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919529403" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>WU, LONG</last-name></addressbook></inventor><inventor mxw-id="PPAR919012422" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>WU, LONG</last-name><address><street>2824 37th Avenue South</street><city>Fargo ND 58104</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919518037" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>SHAW ROBERT</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR919529080" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>SHAW, ROBERT</last-name></addressbook></inventor><inventor mxw-id="PPAR919006748" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>SHAW, ROBERT</last-name><address><street>1622 42nd Avenue South</street><city>Moorhead MN 56560</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919008706" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Holst, Sönke</last-name><iid>101371590</iid><address><street>John Deere GmbH &amp; Co. KG Mannheim Regional Center Global Intellectual Property Services John-Deere-Strasse 70</street><city>68163 Mannheim</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="US-2012025993-W"><document-id><country>US</country><doc-number>2012025993</doc-number><kind>W</kind><date>20120222</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012118647-A1"><document-id><country>WO</country><doc-number>2012118647</doc-number><kind>A1</kind><date>20120907</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549751713" load-source="docdb">AL</country><country mxw-id="DS549911208" load-source="docdb">AT</country><country mxw-id="DS549751714" load-source="docdb">BE</country><country mxw-id="DS549822866" load-source="docdb">BG</country><country mxw-id="DS549827953" load-source="docdb">CH</country><country mxw-id="DS549754736" load-source="docdb">CY</country><country mxw-id="DS549911209" load-source="docdb">CZ</country><country mxw-id="DS549750597" load-source="docdb">DE</country><country mxw-id="DS549751715" load-source="docdb">DK</country><country mxw-id="DS549754749" load-source="docdb">EE</country><country mxw-id="DS549832076" load-source="docdb">ES</country><country mxw-id="DS549822867" load-source="docdb">FI</country><country mxw-id="DS549822868" load-source="docdb">FR</country><country mxw-id="DS549751716" load-source="docdb">GB</country><country mxw-id="DS549751721" load-source="docdb">GR</country><country mxw-id="DS549751722" load-source="docdb">HR</country><country mxw-id="DS549754750" load-source="docdb">HU</country><country mxw-id="DS549827966" load-source="docdb">IE</country><country mxw-id="DS549751723" load-source="docdb">IS</country><country mxw-id="DS549822869" load-source="docdb">IT</country><country mxw-id="DS549754751" load-source="docdb">LI</country><country mxw-id="DS549750598" load-source="docdb">LT</country><country mxw-id="DS549911210" load-source="docdb">LU</country><country mxw-id="DS549750599" load-source="docdb">LV</country><country mxw-id="DS549750600" load-source="docdb">MC</country><country mxw-id="DS549828421" load-source="docdb">MK</country><country mxw-id="DS549828430" load-source="docdb">MT</country><country mxw-id="DS549911211" load-source="docdb">NL</country><country mxw-id="DS549751724" load-source="docdb">NO</country><country mxw-id="DS549911212" load-source="docdb">PL</country><country mxw-id="DS549751729" load-source="docdb">PT</country><country mxw-id="DS549911213" load-source="docdb">RO</country><country mxw-id="DS549750605" load-source="docdb">RS</country><country mxw-id="DS549911214" load-source="docdb">SE</country><country mxw-id="DS549750606" load-source="docdb">SI</country><country mxw-id="DS549754752" load-source="docdb">SK</country><country mxw-id="DS549754765" load-source="docdb">SM</country><country mxw-id="DS549828431" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA99830438" ref-ucid="WO-2012118647-A1" lang="EN" load-source="patent-office"><p num="0000">Example embodiments disclose an Interior Permanent Magnet (IPM) machine system including an IPM machine including a nominal operating direct current (dc) bus voltage (310), and a controller (110) configured to detect an operating dc bus voltage (Vdc) of the IPM machine and to control the IPM machine based on the nominal operating dc bus voltage (310) and the detected operating dc bus voltage (Vdc).</p></abstract><abstract mxw-id="PA100327266" ref-ucid="WO-2012118647-A1" lang="EN" source="national office" load-source="docdb"><p>Example embodiments disclose an Interior Permanent Magnet (IPM) machine system including an IPM machine including a nominal operating direct current (dc) bus voltage (310), and a controller (110) configured to detect an operating dc bus voltage (Vdc) of the IPM machine and to control the IPM machine based on the nominal operating dc bus voltage (310) and the detected operating dc bus voltage (Vdc).</p></abstract><abstract mxw-id="PA99830439" ref-ucid="WO-2012118647-A1" lang="FR" load-source="patent-office"><p num="0000">Des modes de réalisation donnés en exemple concernent un système de machine à aimants permanents intérieurs (IPM) comprenant une machine IPM présentant une tension de service nominale de barre omnibus pour courant continu (cc) (310), et un contrôleur (110) conçu pour détecter une tension de service de bus cc (Vdc) de la machine IPM et commander la machine IPM sur la base de la tension de service nominale de bus cc (310) et de la tension de service détectée de bus (cc) (Vdc).</p></abstract><abstract mxw-id="PA100327267" ref-ucid="WO-2012118647-A1" lang="FR" source="national office" load-source="docdb"><p>Des modes de réalisation donnés en exemple concernent un système de machine à aimants permanents intérieurs (IPM) comprenant une machine IPM présentant une tension de service nominale de barre omnibus pour courant continu (cc) (310), et un contrôleur (110) conçu pour détecter une tension de service de bus cc (Vdc) de la machine IPM et commander la machine IPM sur la base de la tension de service nominale de bus cc (310) et de la tension de service détectée de bus (cc) (Vdc).</p></abstract><description mxw-id="PDES51232249" ref-ucid="WO-2012118647-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="2"/>--><p id="p0001" num="0001"> INTERIOR PERMANENT MAGNET MACHINE SYSTEMS AND METHODS FOR CONTROLLING INTERIOR PERMANENT MAGNET</p><p id="p0002" num="0002">MACHINES FIELD </p><p id="p0003" num="0003"> Example embodiments are related to electronic drive device systems and methods for controlling electronic drive devices such as Interior Permanent Magnet (IPM) motors or machines. BACKGROUND</p><p id="p0004" num="0004">IPM motor control has voltage limitations ranging from medium to high speeds. A specific direct current (dc) bus voltage level determines a series of best operating trajectories for a batch of rotor speeds. IPM characterization is normally performed only at the nominal dc bus voltage level. In other words, motor operating points, which generate direct and quadrature (d-q) current commands from a controller lookup table, are calibrated only at the nominal dc bus voltage level for a batch of rotor speeds. </p><p id="p0005" num="0005"> In real IPM machine applications, an operating dc bus voltage may fluctuate significantly, cycling through motoring and braking modes, especially with battery applications. The fluctuating operating dc bus voltage may impact current regulation at lower dc bus voltages. SUMMARY </p><p id="p0006" num="0006"> Example embodiments are directed to IPM machine systems and methods of controlling IPM machines. </p><p id="p0007" num="0007"> The inventors have discovered that if an operating dc bus voltage is boosted from motor regeneration such that it is higher than a nominal dc bus voltage, IPM motor control should utilize the boosted dc bus voltage in order to increase output torque, power and improve/ or efficiency. If the operating dc bus voltage is lower than the nominal dc bus voltage, motor operating points corresponding to the 
<!-- EPO <DP n="3"/>-->
 operating dc bus voltage are adjusted to ensure robust current control. </p><p id="p0008" num="0008"> Example embodiments utilize a dc bus voltage to determine a series of operating trajectories for a batch of rotor speeds. In other words, example embodiments efficiently operate an IPM motor with a varying dc bus voltage. In some example embodiments the IPM motor is operated while using only nominal voltage characterization data. </p><p id="p0009" num="0009"> An example embodiment discloses an IPM machine system including an IPM machine including a nominal operating direct current (dc) bus voltage, and a controller configured to detect an operating dc bus voltage of the IPM machine and to control the IPM machine based on the nominal operating dc bus voltage and the detected operating dc bus voltage. </p><p id="p0010" num="0010"> At least another example embodiment discloses a method of controlling an IPM machine. The method includes determining an operating dc bus voltage of the IPM machine and a nominal dc bus voltage of the IPM machine, subsequently determining a drive command based on the operating dc bus voltage of the IPM machine and the nominal dc bus voltage of the IPM machine, and outputting the determined drive command to the IPM machine. </p><p id="p0011" num="0011"> At least another example embodiment discloses an IPM machine system including an IPM machine and a controller configured to detect an operating dc bus voltage and operating rotor shaft speed of the IPM machine, determine a ratio of the detected operating dc bus voltage to the detected operating rotor shaft speed and control the IPM machine based on the determined ratio. </p><p id="p0012" num="0012">BRIEF DESCRIPTION OF THE DRAWINGS </p><p id="p0013" num="0013"> Example embodiments will be more clearly understood from the following detailed description taken in conjunction with the accompanying drawings. FIGS. 1-5B represent non -limiting, example embodiments as described herein. </p><p id="p0014" num="0014"> FIG. 1 is a block diagram of an example embodiment of a 
<!-- EPO <DP n="4"/>-->
 system for controlling an electrical motor; </p><p id="p0015" num="0015"> FIG. 2 is a block diagram of an electronic data processing system consistent with FIG. 1; </p><p id="p0016" num="0016"> FIG. 3 illustrates an example embodiment of a calculation module shown in FIG. 1; </p><p id="p0017" num="0017"> FIG. 4 illustrates an example embodiment of a current generation manager shown in FIG. 1; and </p><p id="p0018" num="0018"> FIGS. 5A-5B illustrate a method of controlling an IPM machine according to an example embodiment. </p><p id="p0019" num="0019">DETAILED DESCRIPTION </p><p id="p0020" num="0020"> Various example embodiments will now be described more fully with reference to the accompanying drawings in which some example embodiments are illustrated. </p><p id="p0021" num="0021"> Accordingly, while example embodiments are capable of various modifications and alternative forms, embodiments thereof are shown by way of example in the drawings and will herein be described in detail. It should be understood, however, that there is no intent to limit example embodiments to the particular forms disclosed, but on the contrary, example embodiments are to cover all modifications, equivalents, and alternatives falling within the scope of the claims. Like numbers refer to like elements throughout the description of the figures. </p><p id="p0022" num="0022"> It will be understood that, although the terms first, second, etc. may be used herein to describe various elements, these elements should not be limited by these terms. These terms are only used to distinguish one element from another. For example, a first element could be termed a second element, and, similarly, a second element could be termed a first element, without departing from the scope of example embodiments. As used herein, the term "and/ or" includes any and all combinations of one or more of the associated listed items. </p><p id="p0023" num="0023"> It will be understood that when an element is referred to as being "connected" or "coupled" to another element, it can be directly 
<!-- EPO <DP n="5"/>-->
 connected or coupled to the other element or intervening elements may be present. In contrast, when an element is referred to as being "directly connected" or "directly coupled" to another element, there are no intervening elements present. Other words used to describe the relationship between elements should be interpreted in a like fashion (e.g., "between" versus "directly between," "adjacent" versus "directly adjacent," etc.). </p><p id="p0024" num="0024"> The terminology used herein is for the purpose of describing particular embodiments only and is not intended to be limiting of example embodiments. As used herein, the singular forms "a," "an" and "the" are intended to include the plural forms as well, unless the context clearly indicates otherwise. It will be further understood that the terms "comprises," "comprising," "includes" and/or "including," when used herein, specify the presence of stated features, integers, steps, operations, elements and/ or components, but do not preclude the presence or addition of one or more other features, integers, steps, operations, elements, components and/ or groups thereof. </p><p id="p0025" num="0025"> It should also be noted that in some alternative implementations, the functions /acts noted may occur out of the order noted in the figures. For example, two figures shown in succession may in fact be executed substantially concurrently or may sometimes be executed in the reverse order, depending upon the functionality/ acts involved. </p><p id="p0026" num="0026"> Unless otherwise defined, all terms (including technical and scientific terms) used herein have the same meaning as commonly understood by one of ordinary skill in the art to which example embodiments belong. It will be further understood that terms, e.g., those defined in commonly used dictionaries, should be interpreted as having a meaning that is consistent with their meaning in the context of the relevant art and will not be interpreted in an idealized or overly formal sense unless expressly so defined herein. </p><p id="p0027" num="0027"> Portions of example embodiments and corresponding detailed description are presented in terms of software, or algorithms and 
<!-- EPO <DP n="6"/>-->
 symbolic representations of operation on data bits within a computer memory. These descriptions and representations are the ones by which those of ordinary skill in the art effectively convey the substance of their work to others of ordinary skill in the art. An algorithm, as the term is used here, and as it is used generally, is conceived to be a self-consistent sequence of steps leading to a result. The steps are those requiring physical manipulations of physical quantities. Usually, though not necessarily, these quantities take the form of optical, electrical, or magnetic signals capable of being stored, transferred, combined, compared, and otherwise manipulated. It has proven convenient at times, principally for reasons of common usage, to refer to these signals as bits, values, elements, symbols, characters, terms, numbers, or the like. </p><p id="p0028" num="0028"> In the following description, illustrative embodiments will be described with reference to acts and symbolic representations of operations (e.g., in the form of flowcharts) that may be implemented as program modules or functional processes including routines, programs, objects, components, data structures, etc., that perform particular tasks or implement particular abstract data types and may be implemented using existing hardware. Such existing hardware may include one or more Central Processing Units (CPUs), digital signal processors (DSPs), application-specific-integrated-circuits, field programmable gate arrays (FPGAs) computers or the like. </p><p id="p0029" num="0029"> It should be borne in mind, however, that all of these and similar terms are to be associated with the appropriate physical quantities and are merely convenient labels applied to these quantities. Unless specifically stated otherwise, or as is apparent from the discussion, terms such as "processing" or "computing" or "calculating" or "determining" or "displaying" or the like, refer to the action and processes of a computer system, or similar electronic computing device, that manipulates and transforms data represented as physical, electronic quantities within the computer system's registers and memories into other data similarly represented as 
<!-- EPO <DP n="7"/>-->
 physical quantities within the computer system memories or registers or other such information storage, transmission or display devices. </p><p id="p0030" num="0030"> Note also that the software implemented aspects of example embodiments are typically encoded on some form of tangible (or recording) storage medium or implemented over some type of transmission medium. The tangible storage medium may be magnetic (e.g., a floppy disk or a hard drive) or optical (e.g., a compact disk read only memory, or "CD ROM"), and may be read only or random access. Similarly, the transmission medium may be twisted wire pairs, coaxial cable, optical fiber, or some other suitable transmission medium known to the art. Example embodiments are not limited by these aspects of any given implementation. </p><p id="p0031" num="0031"> In accordance with an example embodiment, FIG. 1 discloses a system for controlling an IP machine such as a motor 117 (e.g., an interior permanent magnet (IPM) motor) or another alternating current machine. The motor 117 has a nominal dc bus voltage (e.g., 320 Volts). The nominal voltage is a named voltage. For example, a nominal voltage of the motor 117 may be 320 Volts, but the motor may operate at a voltage above and below 320 Volts. In an example embodiment, the system, aside from the motor 117, may be referred to as an inverter or a motor controller. The system for controlling the motor 117 may also be referred to as an IPM machine system. </p><p id="p0032" num="0032"> The system includes electronic modules, software modules, or both. In an example embodiment, the motor controller includes an electronic data processing system 120 to support storing, processing or execution of software instructions of one or more software modules. The electronic data processing system 120 is indicated by the dashed lines in FIG. 1 and is shown in greater detail in FIG. 2. The electronic data processing system 120 may also be referred to as a controller for the motor 117. </p><p id="p0033" num="0033"> The data processing system 120 is coupled to an inverter circuit 188. The inverter circuit 188 includes a semiconductor drive circuit that drives or controls switching semiconductors (e.g., insulated gate 
<!-- EPO <DP n="8"/>-->
 bipolar transistors (IGBT) or other power transistors) to output control signals for the motor 117. In turn, the inverter circuit 188 is coupled to the motor 117. The motor 117 is associated with a sensor 115 (e.g., a position sensor, a resolver or encoder position sensor) that is associated with the motor shaft 126 or the rotor. The sensor 115 and the motor 117 are coupled to the data processing system 120 to provide feedback data (e.g., current feedback data, such as phase current values ia, ib and ic), raw position signals, among other possible feedback data or signals, for example. Other possible feedback data includes, but is not limited to, winding temperature readings, semiconductor temperature readings of the inverter circuit 188, three phase voltage data, or other thermal or performance information for the motor 117. </p><p id="p0034" num="0034"> In an example embodiment, a torque command generation module 105 is coupled to a d-q axis current generation manager 109 (e.g., d-q axis current generation look-up tables). The d-q axis current refers to the direct axis current and the quadrature axis current as applicable in the context of vector-controlled alternating current machines, such as the motor 117. The output of the d-q axis current generation manager 109 (d-q axis current commands iq_cmd and id_cmd) and the output of a current adjustment module 107 (e.g., d-q axis current adjustment module 107) are fed to a summer 119. In turn, one or more outputs (e.g., direct axis current data (id*) and quadrature axis current data (iq*)) of the summer 119 are provided or coupled to a current regulation controller 111. While the term current command is used, it should be understood that current command refers to a target current value. </p><p id="p0035" num="0035"> The current regulation controller 111 is capable of communicating with the pulse-width modulation (PWM) generation module 112 (e.g., space vector PWM generation module). The current regulation controller 111 receives respective adjusted d-q axis current commands (e.g., id* and iq*) and actual d-q axis currents (e.g., id and iq) and outputs corresponding d-q axis voltage commands (e.g., vd* 
<!-- EPO <DP n="9"/>-->
 and vq* commands) for input to the PWM generation module 112. </p><p id="p0036" num="0036"> In an example embodiment, the PWM generation module 112 converts the direct axis voltage and quadrature axis voltage data from two phase data representations into three phase representations (e.g., three phase voltage representations, such as va*, vb* and vc*) for control of the motor 117, for example. Outputs of the PWM generation module 112 are coupled to the inverter circuit 188. </p><p id="p0037" num="0037"> The inverter circuit 188 includes power electronics, such as switching semiconductors to generate, modify and control pulse-width modulated signals or other alternating current signals (e.g., pulse, square wave, sinusoidal, or other waveforms) applied to the motor 117. The PWM generation module 112 provides inputs to a driver stage within the inverter circuit 188. An output stage of the inverter circuit 188 provides a pulse-width modulated voltage waveform or other voltage signal for control of the motor 117. In an example embodiment, the inverter 188 is powered by a direct current (dc) voltage bus. </p><p id="p0038" num="0038"> The motor 117 is associated with the sensor 1 15 (e.g., a resolver, encoder, speed sensor, or another position sensor or speed sensors) that estimates at least one of an angular position of the motor shaft 126, a speed or velocity of the motor shaft 126, and a direction of rotation of the motor shaft 126. The sensor 115 may be mounted on or integral with the motor shaft 126. The output of the sensor 115 is capable of communication with the primary processing module 114 (e.g., position and speed processing module). In an example embodiment, the sensor 115 may be coupled to an analog- to- digital converter (not shown) that converts analog raw position data or velocity data to digital raw position or velocity data, respectively. In other example embodiments, the sensor 115 (e.g., digital position encoder) may provide a digital data output of raw position data or velocity data for the motor shaft 126 or rotor. </p><p id="p0039" num="0039"> A first output (e.g., position data Θ for the motor 117) of the primary processing module 114 is communicated to the phase 
<!-- EPO <DP n="10"/>-->
 converter 113 (e.g., three-phase to two-phase current Park transformation module) that converts respective three-phase digital representations of measured current into corresponding two-phase digital representations of measured current. A second output (e.g., speed data SD for the motor 117) of the primary processing module 114 is communicated to the calculation module 110 (e.g., adjusted voltage over speed ratio module). </p><p id="p0040" num="0040"> An input of a sensing circuit 124 is coupled to terminals of the motor 1 17 for sensing at least the measured three-phase currents and a voltage level of the direct current (dc) bus (e.g., high voltage dc bus which may provide dc power to the inverter circuit 188). An output of the sensing circuit 124 is coupled to an analog- to-digital converter 122 for digitizing the output of the sensing circuit 124. In turn, the digital output of the analog-to-digital converter 122 is coupled to the secondary processing module 116 (e.g., dc bus voltage and three phase current processing module). For example, the sensing circuit 124 is associated with the motor 117 for measuring three phase currents (e.g., current applied to the windings of the motor 117, back EMF (electromotive force) induced into the windings, or both). </p><p id="p0041" num="0041"> Certain outputs of the primary processing module 114 and the secondary processing module 116 feed the phase converter 113. For example, the phase converter 113 may apply a Park transformation or other conversion equations (e.g., certain conversion equations that are suitable are known to those of ordinary skill in the art) to convert the measured three-phase representations of current into two-phase representations of current based on the digital three-phase current data ia, ib and ic from the secondary processing module 116 and position data Θ from the sensor 115. The output of the phase converter 113 module (id, iq) is coupled to the current regulation controller 111. </p><p id="p0042" num="0042"> Other outputs of the primary processing module 114 and the secondary processing module 116 may be coupled to inputs of the calculation module 110 (e.g., adjusted voltage over-speed ratio 
<!-- EPO <DP n="11"/>-->
 calculation module). For example, the primary processing module 114 may provide the speed data SD (e.g., motor shaft 126 speed in revolutions per minute), whereas the secondary processing module 116 may provide a measured (detected) level of the operating dc bus voltage Vdc of the motor 117 (e.g., on the dc bus of a vehicle). The dc voltage level on the dc bus that supplies the inverter circuit 188 with electrical energy may fluctuate or vary because of various factors, including, but not limited to, ambient temperature, battery condition, battery charge state, battery resistance or reactance, fuel cell state (if applicable), motor load conditions, respective motor torque and corresponding operational speed, and vehicle electrical loads (e.g., electrically driven air-conditioning compressor). The calculation module 110 is connected as an intermediary between the secondary processing module 116 and the d-q axis current generation manager 109. The output of the calculation module 110 can adjust or impact the current commands iq_cmd and id_cmd generated by the d-q axis current generation manager 109 to compensate for fluctuation or variation in the dc bus voltage, among other things. </p><p id="p0043" num="0043"> The rotor magnet temperature estimation module 104, the current shaping module 106, and the terminal voltage feedback module 108 are coupled to or are capable of communicating with the d-q axis current adjustment module 107. In turn, the d-q axis current adjustment module 107 may communicate with the d-q axis current generation manager or the summer 119. </p><p id="p0044" num="0044"> The rotor magnet temperature estimation module 104 estimates or determines the temperature of the rotor permanent magnet or magnets. In an example embodiment, the rotor magnet temperature estimation module 104 may estimate the temperature of the rotor magnets from, one or more sensors located on the stator, in thermal communication with the stator, or secured to the housing of the motor 117. </p><p id="p0045" num="0045"> In another example embodiment, the rotor magnet temperature estimation module 104 may be replaced with a temperature detector 
<!-- EPO <DP n="12"/>-->
 (e.g., a thermistor and wireless transmitter like infrared thermal sensor) mounted on the rotor or the magnet, where the detector provides a signal (e.g., wireless signal) indicative of the temperature of the magnet or magnets. </p><p id="p0046" num="0046"> In an example embodiment, the method or system may operate in the following manner. The torque command generation module 105 receives an input control data message, such as a speed control data message, a voltage control data message, or a torque control data message, over a vehicle data bus 118. The torque command generation module 105 converts the received input control message into torque control command data T_cmd. </p><p id="p0047" num="0047"> The d-q axis current generation manager 109 selects or determines the direct axis current command and the quadrature axis current command associated with respective torque control command data and respective detected motor shaft 126 speed data SD. For example, the d-q axis current generation manager 109 selects or determines the direct axis current command and the quadrature axis current command by accessing one or more of the following: (1) a look-up table, database or other data structure that relates respective torque commands to corresponding direct and quadrature axes currents, (2) a set of quadratic equations or linear equations that relate respective torque commands to corresponding direct and quadrature axes currents, or (3) a set of rules (e.g., if-then rules) that relates respective torque commands to corresponding direct and quadrature axes currents. The sensor 115 on the motor 117 facilitates provision of the detected speed data SD for the motor shaft 126, where the primary processing module 114 may convert raw position data provided by the sensor 115 into speed data SD. </p><p id="p0048" num="0048"> The current adjustment module 107 (e.g., d-q axis current adjustment module) provides current adjustment data to adjust the direct axis current command id_cmd and the quadrature axis current command iq_cmd based on input data from the rotor magnet temperature estimation module 104, the current shaping module 106, 
<!-- EPO <DP n="13"/>-->
 and terminal voltage feedback module 108. </p><p id="p0049" num="0049"> The current shaping module 106 may determine a correction or preliminary adjustment of the quadrature axis (q-axis) current command and the direct axis (d-axis) current command based on one or more of the following factors: torque load on the motor 117 and speed of the motor 117, for example. The rotor magnet temperature estimation module 104 may generate a secondary adjustment of the q- axis current command and the d-axis current command based on an estimated change in rotor temperature, for example. The terminal voltage feedback module 108 may provide a third adjustment to d-axis and q-axis current based on controller voltage command versus voltage limit. The current adjustment module 107 may provide an aggregate current adjustment that considers one or more of the following adjustments: a preliminary adjustment, a secondary adjustment, and a third adjustment. </p><p id="p0050" num="0050"> In an example embodiment, the motor 117 may include an interior permanent magnet (IPM) machine or a synchronous IPM machine (IPMSM). </p><p id="p0051" num="0051"> The sensor 115 (e.g., shaft or rotor speed detector) may include one or more of the following: a direct current motor, an optical encoder, a magnetic field sensor (e.g., Hall Effect sensor), magneto- resistive sensor, and a resolver (e.g., a brushless resolver). In one configuration, the sensor 115 includes a position sensor, where raw position data and associated time data are processed to determine speed or velocity data for the motor shaft 126. In another configuration, the sensor 115 includes a speed sensor, or the combination of a speed sensor and an integrator to determine the position of the motor shaft. </p><p id="p0052" num="0052"> In yet another configuration, the sensor 115 includes an auxiliary, compact direct current generator that is coupled mechanically to the motor shaft 126 of the motor 117 to determine speed of the motor shaft 126, where the direct current generator produces an output voltage proportional to the rotational speed of the 
<!-- EPO <DP n="14"/>-->
 motor shaft 126. In still another configuration, the sensor 115 includes an optical encoder with an optical source that transmits a signal toward a rotating object coupled to the motor shaft 126 and receives a reflected or diffracted signal at an optical detector, where the frequency of received signal pulses (e.g., square waves) may be proportional to a speed of the motor shaft 126. In an additional configuration, the sensor 1 15 includes a resolver with a first winding and a second winding, where the first winding is fed with an alternating current, where the voltage induced in the second winding varies with the frequency of rotation of the rotor. </p><p id="p0053" num="0053"> In FIG. 2, the electronic data processing system 120 includes an electronic data processor 264, a data bus 262, a data storage device 260, and one or more data ports (268, 270, 272, 274 and 276). The data processor 264, the data storage device 260 and one or more data ports are coupled to the data bus 262 to support communications of data between or among the data processor 264, the data storage device 260 and one or more data ports. </p><p id="p0054" num="0054"> In an example embodiment, the data processor 264 may include an electronic data processor, a microprocessor, a microcontroller, a programmable logic array, a logic circuit, an arithmetic logic unit, an application specific integrated circuit, a digital signal processor, a proportional-integral-derivative (PID) controller, or another data processing device. </p><p id="p0055" num="0055"> The data storage device 260 may include any magnetic, electronic, or optical device for storing data. For example, the data storage device 260 may include an electronic data storage device, an electronic memory, non-volatile electronic random access memory, one or more electronic data registers, data latches, a magnetic disc drive, a hard disc drive, an optical disc drive, or the like. </p><p id="p0056" num="0056"> As shown in FIG. 2, the data ports include a first data port 268, a second data port 270, a third data port 272, a fourth data port 274 and a fifth data port 276, although any suitable number of data ports may be used. Each data port may include a transceiver and buffer 
<!-- EPO <DP n="15"/>-->
 memory, for example. In an example embodiment, each data port may include any serial or parallel input/ output port. </p><p id="p0057" num="0057"> In an example embodiment as illustrated in FIG. 2, the first data port 268 is coupled to the vehicle data bus 118. In turn, the vehicle data bus 118 is coupled to a controller 266. In one configuration, the second data port 270 may be coupled to the inverter circuit 188; the third data port 272 may be coupled to the sensor 115; the fourth data port 274 may be coupled to the analog-to-digital converter 122; and the fifth data port 276 may be coupled to the terminal voltage feedback module 108. The analog- to -digital converter 122 is coupled to the sensing circuit 124. </p><p id="p0058" num="0058"> In an example embodiment of the data processing system 120, the torque command generation module 105 is associated with or supported by the first data port 268 of the electronic data processing system 120. The first data port 268 may be coupled to a vehicle data bus 118, such as a controller area network (CAN) data bus. The vehicle data bus 118 may provide data bus messages with torque commands to the torque command generation module 105 via the first data port 268. The operator of a vehicle may generate the torque commands via a user interface, such as a throttle, a pedal, the controller 266, or other control device. </p><p id="p0059" num="0059"> In some example embodiments, the sensor 115 and the primary processing module 114 may be associated with or supported by a third data port 272 of the data processing system 120. </p><p id="p0060" num="0060">IPM Machine Control </p><p id="p0061" num="0061"> Steady state voltage equations for an IPM motor according example embodiments may be: </p><p id="p0062" num="0062">= r s i d, - co e L q i q (1) v<sub>g</sub> = r<sub>s</sub>i<sub>q</sub> + G)<sub>e</sub>L<sub>d</sub>i<sub>d</sub> + (Q<sub>e f</sub> (2) 
<!-- EPO <DP n="16"/>-->
 wherein Vd is the d-axis voltage, v<sub>q</sub> is the q-axis voltage, r<sub>s</sub> is the stator resistance, i<sub>d</sub> is the d-axis current, ¾ is the q-axis current, Ld is the d- axis inductance, L<sub>q</sub> is the q-axis inductance, ωe is the electrical frequency of the IPM and A/ is the strength of the permanent magnet on the rotor of the IPM. </p><p id="p0063" num="0063"> The stator resistance r<sub>s</sub> may be neglected because a voltage drop across a resistance item is much smaller than a voltage drop across an inductance item and a back EMF item (e.g., A/). If the stator resistance r<sub>s</sub> is neglected, equations (1) and (2) can be rewritten as follows: </p><p id="p0064" num="0064"><img id="imgf000016_0001" he="32" wi="139" file="imgf000016_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="yes"/></p><p id="p0065" num="0065">Therefore, equations (3) and (4) indicate ratios of an available terminal voltage over motor electrical frequency to determine the operating points for the current commands iq_cmd and id_cmd, assuming the strength of the permanent magnet A/ and the inductances L<sub>d</sub> and Lq are all constants. The electrical frequency can be converted from rotor shaft speed in rpm. The terminal voltage may be referred to as the alternating current (ac) voltage applied at a terminal of a machine such as the motor 117. For example, the dc bus voltage may be converted to the terminal voltage by the inverter switching circuit 188. </p><p id="p0066" num="0066"> Specifically, the voltage over speed ratio can be calculated by dividing the operating dc bus voltage over operating rotor shaft speed in rpm. </p><p id="p0067" num="0067"> For example, an operating trajectory calibrated at 5000 rpm at 325 V can be directly applied to 4615.4 rpm at 300 V or 5384.6 rpm 
<!-- EPO <DP n="17"/>-->
 at 350 V. Note that, the smaller the calculated ratio value, the more stringent the applied terminal voltage limitation. The terminal voltage limitation is a maximum available output ac voltage generated from a dc bus voltage for a machine terminal at high speed heavy load conditions. For a robust motor operation, a controller may require an additional voltage margin. For example, the voltage margin is based on the permanent magnet strength change due to ambient temperature change, fast dynamics of torque command and dc bus voltage. Thus, the voltage margin may be set according to these factors. </p><p id="p0068" num="0068"> As an example, the actual voltage limit may be 90-95% (e.g., 92%) of the terminal voltage limitation. </p><p id="p0069" num="0069"> However, the permanent magnet strength λ<sub>∫</sub> is a function of rotor speeds due to the varying machine iron losses and rotor magnet heating effects. The varying magnet strength λ<sub>∫</sub> will further cause variation in the d-q axis inductances L<sub>d</sub> and L<sub>q</sub>. Hence, while the combinations of operating dc bus voltage and operating rotor shaft speed yield the same ratio values, optimized operating points may still be different considering varying machine parameters such as back EMF strength and d-q axis inductances. </p><p id="p0070" num="0070"> To compensate for the varying magnet strength effects in example embodiments, a voltage compensation coefficient adjusts the calculated voltage over speed ratio values. At the nominal dc bus level, the voltage compensation coefficient can be adjusted to reflect a voltage margin, depending on an application's dynamic response specification. </p><p id="p0071" num="0071"> When the operating dc bus voltage is higher than the nominal dc bus voltage, the voltage compensation coefficient is set slightly higher considering weaker magnet strength for higher rotor speed. On the other hand, when the operating dc bus voltage is lower than nominal dc bus voltage, the voltage compensation coefficient shall be set slightly lower considering stronger magnet strength for lower operating rotor shaft speed. 
<!-- EPO <DP n="18"/>-->
 For the purposes of explanation, there are three sets of operating dc bus voltages and operating rotor shaft speeds: V<sub>1</sub> and rpm<sub>1</sub>, V<sub>2</sub> and rpm<sub>2</sub>, V<sub>3</sub> and rpm<sub>3</sub>, where V<sub>1</sub> &lt;V<sub>2</sub>&lt;V<sub>3</sub> and rpm<sub>1</sub> &lt;rpm<sub>2</sub>&lt;rpm<sub>3</sub>, such that the operating dc bus voltage to operating rotor shaft speed ratios are as follows: 
<img id="imgf000018_0001" he="15" wi="136" file="imgf000018_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="yes"/>
 </p><p id="p0072" num="0072">While only three sets of operating dc bus voltages and operating rotor shaft speeds are used for explanation purposes, it should be understood than any number of sets of operating dc bus voltages and operating rotor shaft speeds may be used. </p><p id="p0073" num="0073"> In general, the magnet strength λ<sub>∫</sub> gets smaller as speed goes up due to increased iron losses and magnet heating. Therefore, 
<img id="imgf000018_0003" he="13" wi="136" file="imgf000018_0003.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0074" num="0074">In other words, the terminal voltage limitation will be tightest when the operating dc bus voltage is at V<sub>1</sub> with the operating rotor shaft speed at rpm<sub>1</sub> and loosest when the operating dc bus voltage is at V<sub>3</sub> with the operating rotor shaft speed at rpm<sub>3</sub>. The terminal voltage is loosest at V<sub>1</sub> because the back EMF strength is strongest at rpm<sub>1</sub> and weakest at rpm<sub>3</sub>. To compensate for the varying magnet strength λ effects, a voltage compensation coefficient is included to adjust the calculated operating dc bus voltage to operating rotor shaft speed ratio values such that 
<img id="imgf000018_0002" he="14" wi="139" file="imgf000018_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="yes"/>
 
<!-- EPO <DP n="19"/>-->
 Assuming V∑ is the nominal dc bus voltage used in the motor characterization procedure, then the voltage compensation coefficient η<sub>2</sub> is varied to adjust voltage margin depending on application's dynamic response specification. The value of the voltage compensation coefficient η<sub>1</sub> is set less than the voltage compensation coefficient η<sub>2</sub> to reflect an increased magnet strength λ<sub>∫</sub> effect at a lower speed. Similarly, the value of the voltage compensation coefficient η<sub>3</sub> is set slightly larger than the voltage compensation coefficient η<sub>2</sub> for a decreased magnet strength λ<sub>∫</sub> at a higher speed. These selected values for the voltage compensation coefficients η<sub>1</sub>, η<sub>2</sub> and η<sub>3</sub> are based on machine design and are determined by the tuning procedure described below. </p><p id="p0075" num="0075"> Motor characterization procedure is a procedure used to determine d-axis and q-axis commands for a specific speed and torque command. The procedure is repeated at multiple torque commands and multiple speeds. A motor characterization procedure is described in Appl. No. XX/XXX,XXX, entitled "METHOD AND APPARATUS FOR CHARACTERIZING AN INTERIOR PERMANENT MAGNET," by the inventors of the subject application, filed on February 28, 2011, the entire contents of which are hereby incorporated by reference. </p><p id="p0076" num="0076"> For example, machine characterization may be performed under a nominal dc bus voltage level only, such as 320 V, and at a set of rotor shaft speeds. For a particular speed such as 5000 rpm, the voltage and speed combination together gives an operating dc bus voltage to operating rotor shaft speed ratio value of 320/5000. </p><p id="p0077" num="0077"> For the same ratio value, there are different voltages and shaft speed combinations like 280/4375, 390/6094, etc., when the operating dc bus voltage is not at the nominal dc bus voltage. If machine parameter variations such as magnet strength and d-q axis inductances are not considered, then all operating dc bus voltage and operating rotor shaft speed combinations producing the same ratio shall have exactly same operating condition in terms of voltage margin concern. 
<!-- EPO <DP n="20"/>-->
 In example embodiments, the voltage margin is a percentage of the nominal dc bus voltage such as 5% or 6%. For example, a maximum available ac voltage from the dc bus is the operating dc bus voltage divided by√2 in linear modulation range. Then the voltage margin may be within 5% or 6% of the nominal dc bus voltage divided by√2 . </p><p id="p0078" num="0078"> Unfortunately, machine parameters, especially the permanent magnet strength A/, vary with respect to rotor shaft speeds. For example, 280 V and 4375 rpm will have a tighter voltage margin than 320 V and 5000 rpm for the same torque or current commands due to the stronger magnet strength A<sub>/</sub> at 4375 rpm. Similarly, 390 V and 6094 rpm will have a looser voltage margin than 320 V &amp; 5000 rpm for the exactly torque or current commands due to the weaker magnet strength A<sub>/</sub> at 6094 rpm. In other words, as a strength of the permanent magnet increases, the back EMF voltage component increases. Therefore, the terminal ac voltage is higher and makes the voltage margin smaller. </p><p id="p0079" num="0079"> A two-dimensional voltage compensation coefficient lookup table is constructed based on the tuning of operating dc bus voltages and operating rotor shaft speed pairs that produce the same ratio to achieve the same voltage margin. The threshold voltage margin is determined at the nominal dc bus voltage and associated operating rotor shaft speeds for the same torque command. </p><p id="p0080" num="0080"> For example, the operating dc bus voltage may be adjusted to 280 V and the shaft speed may be adjusted to 4375 rpm. For a torque command for the operating dc bus voltages and operating rotor shaft speed pairs, the voltage compensation coefficient may be tuned, e.g., to 0.97, until the voltage margin is achieved. In other words, the voltage compensation coefficient is determined such that the adjusted ratio at 280 V and 4375 rpm operation condition associated with a torque command generates a set of d-q axis current commands that have the same voltage margin as the 320 V and 5000 rpm operation 
<!-- EPO <DP n="21"/>-->
 condition associated with the same torque command. The set voltage margin can 320 V divided by √2 and then multiplied by 5%. </p><p id="p0081" num="0081"> Similarly, the operating dc bus voltage may be adjusted to 390 V and the shaft speed may be adjusted to 6094 rpm. For the same torque command, the voltage compensation may be tuned, e.g., to 1.03, until the set voltage margin is achieved as well. </p><p id="p0082" num="0082"> The tuning procedure is repeated at different operating dc bus voltage levels such as 280, 290, 320,..., 380, 390 V to determine corresponding voltage compensation coefficients and put them into the two-dimensional voltage compensation coefficient lookup table. </p><p id="p0083" num="0083"> Thus, the voltage compensation coefficients become a two- dimensional lookup table ranging from minimum operating dc bus voltage to maximum operating dc bus voltage. The two-dimensional voltage compensation coefficient lookup table is shown as 310 in FIG. 3. </p><p id="p0084" num="0084"> FIG. 3 illustrates an example embodiment of a calculation module shown in FIG. 1. As shown, the calculation module 110 is configured to receive the detected operating dc bus voltage value Vdc and the speed data SD (in rpm). The calculation module 110 includes the two-dimensional voltage compensation coefficient lookup table (LUT) 310, a speed data processor 320, an adjusted ratio calculator 330 and a base torque LUT 340. </p><p id="p0085" num="0085"> The voltage compensation coefficient LUT 310 receives the detected operating dc bus voltage value Vdc and outputs a voltage compensation coefficient Vcoeff based on the detected operating dc bus voltage value Vdc. More specifically, the voltage compensation coefficient LUT 310 includes a list of operating dc bus voltages, each of which is associated with a voltage compensation coefficient. The voltage compensation coefficients are determined using the tuning procedure described above. When the voltage compensation coefficient LUT 310 receives the detected operating dc bus voltage value Vdc, the voltage compensation coefficient LUT 310 outputs the voltage compensation coefficient associated with the received detected 
<!-- EPO <DP n="22"/>-->
 operating dc bus voltage value Vdc as the voltage compensation coefficient Vcoeff. </p><p id="p0086" num="0086"> The voltage compensation coefficient Vcoeff is output from the voltage compensation coefficient LUT 310 to the adjusted ratio (adjusted detected operating dc bus voltage to the detected operating rotor shaft speed ratio) calculator 330. </p><p id="p0087" num="0087"> The SD processor 320 is configured to receive the speed data SD, determine the absolute value of the speed data SD and output the absolute value of the speed data Abs_SD to the adjusted ratio calculator 330. The SD processor 320 may include an SD limiter that is configured to determine whether the speed data SD exceeds or is below a threshold and, therefore, should not be considered. </p><p id="p0088" num="0088"> In addition to receiving the voltage compensation coefficient Vcoeff and the absolute value of the speed data Abs_SD, the adjusted ratio calculator 330 is configured to receive the detected operating dc bus voltage value Vdc. The adjusted ratio calculator 330 adjusts the detected operating dc bus voltage to the detected operating rotor shaft speed ratio as follows: Adj_ratio = (Vdc*Vcoeff)/Abs_SD (8) where Adj_ratio is the adjusted detected operating dc bus voltage to the detected operating rotor shaft speed ratio. The adjusted ratio Adj_ratio is output by the adjusted ratio calculator 330 to the d-q axis current generation manager 109 and the base torque LUT 340. </p><p id="p0089" num="0089"> The base torque LUT 340 determines a base torque value Base_Torq based on the adjusted ratio Adj_ratio and characterized base torque data associated with adjusted ratio values. </p><p id="p0090" num="0090"> From the motor characterization data, base torque values are respectively associated with discrete speed points with a nominal dc bus voltage level. In other words, the two-dimensional base torque LUT 340 is established from the motor characterization procedure. During the IPM motor characterization procedure, each rotor shaft 
<!-- EPO <DP n="23"/>-->
 speed has a maximum output torque which is defined as the base torque at that speed. Thus, the base torque may also be referred to a peak torque. </p><p id="p0091" num="0091"> The base torque LUT 340 outputs the associated base torque value as the base torque value Base_Torq to the d-q axis current generation manager 109. </p><p id="p0092" num="0092"> FIG. 4 illustrates an example embodiment of a current generation manager shown in FIG. 1. As shown, the d-q axis current generation manager 109 includes a torque processor 410, a sign determination unit 420, a q-axis current (iq) command LUT 430, a d- axis current (id) command LUT 440 and a multiplier 450. </p><p id="p0093" num="0093"> The sign determination unit 420 determines the positive or negative sign of the torque command data T_cmd and outputs a sign value T_cmd_sign to the multiplier 450. </p><p id="p0094" num="0094"> The torque processor 410 receives the base torque value</p><p id="p0095" num="0095">Base_Torq and the torque command data T_cmd. The torque command data T_cmd may be generated from a voltage (or speed) control proportional-integrator (PI) that regulates the dc bus voltage (or speed) or from a direct torque command in a torque control mode. The torque command data T_cmd may be in Nm. </p><p id="p0096" num="0096"> The torque processor 410 is configured to determine an absolute value of the torque command data T_cmd. The torque processor 410 is configured to convert the absolute value of the torque command data T_cmd into a percentage Torq_Perc of the base torque value Base_Torq. The torque processor 410 outputs the percentage Torq_Perc to the q-axis current (iq) command LUT 430 and the d-axis current (id) command LUT 440. </p><p id="p0097" num="0097"> The q-axis current (iq) command LUT 430 and the d-axis current (id) command LUT 440 are also configured to receive the adjusted ratio Adj_ratio. The q-axis current (iq) command LUT 430 and the d-axis current (id) command LUT 440 store q-axis and d-axis current commands, respectively, each of which is associated with a pair of adjustment ratio and torque percentage values. The development of 
<!-- EPO <DP n="24"/>-->
 the q-axis current (iq) command LUT 430 and the d-axis current (id) command LUT 440 are described in Appl. No. 13/036,286, entitled "METHOD AND APPARATUS FOR CHARACTERIZING AN INTERIOR PERMANENT MAGNET," by the inventors of the subject application, filed on February 28, 201 1, the following contents of which are hereby incorporated by reference in the next two paragraphs. </p><p id="p0098" num="0098">Torque control of IPM machines generally involves generating alternating current (AC or ac) control signals for controlling the IPM machine based on the requested torque. Typically the AC control signals are represented by a current vector having a peak current magnitude Is and current angle G. The current vector is often represented by a direct axis current id or Id component and quadrature axis current iq or Iq component of the current vector where: </p><p id="p0099" num="0099">Id = -Is cos G, and </p><p id="p0100" num="0100"> Iq = Is sin G. </p><p id="p0101" num="0101"> Id component is negative in IPM machine control while the sign of Iq component depends on the sign of the desired torque. </p><p id="p0102" num="0102">Generation of the ac control signals is constrained by operational constraints associate with the IPM machine. For example, the ac control signals, which power stator windings in the IPM machine, have current limits to prevent damage to the IPM machine such as from overheating, etc. The current limits are generally predicated by the design of the IPM machine and/ or power switch thermal rating in the corresponding controller, and are known a priori to any characterization procedure. </p><p id="p0103" num="0103">The d-axis current command LUT 440 is configured to output a d-axis current command id_cmd that is associated with the received 
<!-- EPO <DP n="25"/>-->
 torque percentage Torq_Perc and adjusted ratio Adj_ratio. As shown in FIG. 1 , the d-axis current command id_cmd is output to the summer 1 19. </p><p id="p0104" num="0104"> The q-axis current command LUT 430 is configured to output an initial q-axis current command that is associated with the received torque percentage Torq_Perc and adjusted ratio Adj_ratio. The initial q-axis current command is output to the multiplier 450 where the initial q-axis current command is multiplied with the sign of the torque command data T_cmd to generate the q-axis current command iq_cmd. As shown in FIG. I, the q-axis current command iq_cmd is output to the summer 119. </p><p id="p0105" num="0105"> FIGS. 5A-5B illustrate a method of controlling an IPM machine according to an example embodiment. The data processing system 120 is configured to implement the methods shown in FIGS. 5A-5B. </p><p id="p0106" num="0106"> At S530, the data processing system detects an operating dc bus voltage of the IPM machine (e.g., the motor 1 17). Based on the dc bus voltage, the data processing system is configured to determine a difference between the operating dc bus voltage and a nominal dc bus voltage of the electronic device. </p><p id="p0107" num="0107"> At S560, the data processing system subsequently determines current commands (drive command) based on the determined difference between an operating dc bus voltage of the IPM machine and a nominal dc bus voltage of the IPM machine. For example, as described above, the calculation module 1 10 and the d-q axis current generation manager 109 are configured to determine the d-axis and q- axis current commands id_cmd and iq_cmd. </p><p id="p0108" num="0108"> At S590, the current commands are output to the electronic device. For example, based on the d-axis and q-axis current commands id_cmd and iq_cmd, the motor 1 17 is driven by the data processing system 120. </p><p id="p0109" num="0109"> FIG. 5B illustrates an example embodiment of determining current commands at S560. At S562, the data processing system determines a voltage compensation coefficient based on the detected 
<!-- EPO <DP n="26"/>-->
 operating dc bus voltage. At S564, the data processing system adjusts a ratio of the detected operating dc bus voltage to a detected operating rotor shaft speed by multiplying the ratio by the voltage compensation coefficient. For example, as described with reference to FIG. 3, the adjusted ratio calculator 330 calculates the adjusted ratio adj_ratio based on the voltage coefficient Vcoeff and the operating dc bus voltage Vdc. </p><p id="p0110" num="0110"> At S566, the data processing system determines a base torque based on the adjusted ratio of the detected operating dc bus voltage to a detected operating rotor shaft speed. At S568, the data processing system determines a torque command as a percentage of the base torque. Based on the percentage and the adjusted ratio, the data processing system determines the current commands at S570. </p><p id="p0111" num="0111"> As described above, the inventors have discovered that if a dc bus voltage is boosted from motor regeneration such that it is higher than a nominal bus voltage, IPM motor control should utilize the boosted dc bus voltage in order to increase output torque, power and improve/ or efficiency. If the operating dc bus voltage is lower than the nominal dc bus voltage, motor operating points corresponding to the operating dc bus voltage are adjusted to ensure robust current control. </p><p id="p0112" num="0112"> Example embodiments utilize a dc bus voltage to determine a series of operating trajectories for a batch of rotor speeds. In other words, example embodiments efficiently operate an IPM motor with a varying dc bus voltage. In some example embodiments the IPM motor is operated while using only nominal voltage characterization data. </p><p id="p0113" num="0113"> Example embodiments being thus described, it will be obvious that the same may be varied in many ways. Such variations are not to be regarded as a departure from the spirit and scope of example embodiments, and all such modifications as would be obvious to one skilled in the art are intended to be included within the scope of the claims. 
</p></description><claims mxw-id="PCLM44851383" ref-ucid="WO-2012118647-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="27"/>--> CLAIMS What is claimed is: </claim-statement><claim id="clm-0001" num="1"><claim-text>1. An Interior Permanent Magnet (IPM) machine system comprising: an IPM machine including a nominal operating direct current</claim-text><claim-text>(dc) bus voltage; and </claim-text><claim-text> a controller configured to detect an operating dc bus voltage of the IPM machine and to control the IPM machine based the nominal operating dc bus voltage and the detected operating dc bus voltage. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. The IPM machine system of claim 1, wherein the controller is configured to detect an operating rotor shaft speed of the IPM machine, determine a ratio of the detected operating dc bus voltage to the detected operating rotor shaft speed and control the IPM machine based on the determined ratio. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. The IPM machine system of claim 2, wherein the controller is configured to control the IPM machine based on a compensation coefficient associated with the determined ratio. </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. The IPM machine system of claim 3, wherein the controller is configured to adjust the determined ratio by multiplying the compensation coefficient with the determined ratio, the adjusted ratio representing a variation of parameters of the IPM machine at different rotor shaft speeds. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. The IPM machine system of claim 2, wherein the controller is configured to generate a set of direct axis and quadrature axis current commands to control an output torque of the IPM machine based on the determined ratio. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. The IPM machine system of claim 5, wherein the controller includes, <!-- EPO <DP n="28"/>--> a first processing unit configured to detect the operating dc bus voltage and three phase currents of the IPM machine, </claim-text><claim-text> a second processing unit configured to detect an angular rotor shaft position of the IPM machine and an operating rotor shaft speed of the IPM machine, and </claim-text><claim-text> a calculation unit configured to determine a ratio of the detected operating dc bus voltage to the detected operating rotor shaft speed, the set of direct-axis and quadrature-axis current commands being based on the determined ratio. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. The IPM machine system of claim 6, wherein the controller includes, </claim-text><claim-text> two three-dimensional lookup tables configured to determine the set of direct-axis and quadrature-axis current commands based on the determined ratio. </claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. The IPM machine system of claim 6, wherein the controller includes, </claim-text><claim-text> a look-up table configured to store a plurality of compensation coefficients, each respectively associated with an operating dc bus voltage, the set of direct-axis and quadrature-axis current commands being based on the compensation coefficient associated with the determined ratio. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. The IPM machine system of claim 8, wherein the look-up table is a two-dimensional look-up table. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. The IPM machine system of claim 5, wherein the controller includes, </claim-text><claim-text> a first three-dimensional look-up table configured to determine the d-axis current command based on the determined ratio adjusted by the associated compensation coefficient and a torque command, and <!-- EPO <DP n="29"/>--> a second three-dimensional look-up table configured to determine the q-axis current command based on the determined ratio adjusted by the associated compensation coefficient and the torque command. </claim-text></claim><claim id="clm-0011" num="11"><claim-text>1 1. The IPM machine system of claim 10, wherein the torque command is a percentage of a base torque. </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. The IPM machine system of claim 11 , wherein the base torque is based on the determined ratio adjusted by the associated compensation coefficient. </claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. The IPM machine system of claim 12, wherein the controller includes, </claim-text><claim-text> a two-dimensional lookup table configured to store a plurality of base torques, each respectively associated with a ratio of an operating dc bus voltage to an operating rotor shaft speed. </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. A method of controlling an Interior Permanent Magnet (IPM) machine comprising: </claim-text><claim-text> determining an operating dc bus voltage of the IPM machine and a nominal dc bus voltage of the IPM machine; </claim-text><claim-text> subsequently determining a drive command based on the operating dc bus voltage of the IPM machine and the nominal dc bus voltage of the IPM machine; and </claim-text><claim-text> outputting the determined drive command to the IPM machine. </claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. The method of claim 14, wherein </claim-text><claim-text> the subsequent determining includes, </claim-text><claim-text> determining a set of direct- axis and quadrature-axis current commands based on the determined difference, and </claim-text><claim-text> wherein the outputting includes outputting the direct-axis and quadrature-axis current commands to the IPM machine. <!-- EPO <DP n="30"/>--> </claim-text></claim><claim id="clm-0016" num="16"><claim-text>16. The method of claim 14, wherein </claim-text><claim-text> the determining includes, </claim-text><claim-text> determining an operating rotor shaft speed of the IPM machine, and </claim-text><claim-text> the subsequent determining includes, </claim-text><claim-text> determining a ratio between the operating dc bus voltage and the operating rotor shaft speed, and </claim-text><claim-text> adjusting the determined ratio by multiplying an associated compensation coefficient with the determined ratio, and determining the drive command based on the adjusted ratio. </claim-text></claim><claim id="clm-0017" num="17"><claim-text>17. The method of claim 16, wherein the associated compensation coefficient is based on the operating dc bus voltage. </claim-text></claim><claim id="clm-0018" num="18"><claim-text>18. The method of claim 16, wherein the subsequent determining includes, </claim-text><claim-text> determining a base torque based on the adjusted ratio, receiving a true torque command value, </claim-text><claim-text> determining a percentage of the true torque command value compared to the base torque, and </claim-text><claim-text> determining the drive current commands based on the determined torque command percentage and adjusted ratio. </claim-text></claim><claim id="clm-0019" num="19"><claim-text>19. An Interior Permanent Magnet (IPM) machine system comprising: an IPM machine; and </claim-text><claim-text> a controller configured to detect an operating dc bus voltage and operating rotor shaft speed of the IPM machine, determine a ratio of the detected operating dc bus voltage to the detected operating rotor shaft speed and control the IPM machine based on the determined ratio. <!-- EPO <DP n="31"/>--> </claim-text></claim><claim id="clm-0020" num="20"><claim-text>20. The IPM machine system of claim 19, wherein the controller is configured to, </claim-text><claim-text> determine a base torque based on the determined ratio, receive a true torque command value, </claim-text><claim-text> determine a percentage of the true torque command value compared to the base torque, and </claim-text><claim-text> control the IPM machine based on the determined torque command percentage and determined ratio. </claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
