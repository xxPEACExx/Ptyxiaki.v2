<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2682916-A1" country="EP" doc-number="2682916" kind="A1" date="20140108" family-id="46513680" file-reference-id="214842" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146584836" ucid="EP-2682916-A1"><document-id><country>EP</country><doc-number>2682916</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-12305811-A" is-representative="YES"><document-id mxw-id="PAPP154847028" load-source="docdb" format="epo"><country>EP</country><doc-number>12305811</doc-number><kind>A</kind><date>20120706</date><lang>EN</lang></document-id><document-id mxw-id="PAPP175868161" load-source="docdb" format="original"><country>EP</country><doc-number>12305811.7</doc-number><date>20120706</date></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140550075" ucid="EP-12305811-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12305811</doc-number><kind>A</kind><date>20120706</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL1989322661" load-source="docdb">G06T   1/00        20060101AFI20120917BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL1991310655" load-source="docdb" scheme="CPC">G06T2201/0065      20130101 LA20140110BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991310969" load-source="docdb" scheme="CPC">G06T2201/0081      20130101 LA20140110BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991314841" load-source="docdb" scheme="CPC">G06T   1/0085      20130101 FI20140110BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132359141" lang="DE" load-source="patent-office">Verfahren zur Wasserzeichendecodierung</invention-title><invention-title mxw-id="PT132359142" lang="EN" load-source="patent-office">Method for watermark decoding</invention-title><invention-title mxw-id="PT132359143" lang="FR" load-source="patent-office">Procédé de décodage de filigrane</invention-title><citations><patent-citations><patcit mxw-id="PCIT242942455" load-source="docdb" ucid="US-20060280246-A1"><document-id format="epo"><country>US</country><doc-number>20060280246</doc-number><kind>A1</kind><date>20061214</date></document-id><sources><source name="SEA" category="X" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242942454" load-source="docdb" ucid="US-6785401-B2"><document-id format="epo"><country>US</country><doc-number>6785401</doc-number><kind>B2</kind><date>20040831</date></document-id><sources><source name="SEA" category="X" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242942456" load-source="docdb" ucid="WO-2007045680-A1"><document-id format="epo"><country>WO</country><doc-number>2007045680</doc-number><kind>A1</kind><date>20070426</date></document-id><sources><source name="SEA" category="Y" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>DELANNAY D ET AL:  "Generalized 2-D cyclic patterns for secret watermark generation", IMAGE PROCESSING, 2000. PROCEEDINGS. 2000 INTERNATIONAL CONFERENCE ON SEPTEMBER 10-13, 2000, IEEE, PISCATAWAY, NJ, USA, 10 September 2000 (2000-09-10), pages 77-79vol.2, XP031534396, ISBN: 978-0-7803-6297-0</text><sources><source mxw-id="PNPL45210535" load-source="docdb" name="SEA" category="X"/></sources></nplcit><nplcit><text>DELP E J ET AL:  "Temporal Synchronization in Video Watermarking", IEEE TRANSACTIONS ON SIGNAL PROCESSING, IEEE SERVICE CENTER, NEW YORK, NY, US, vol. 52, no. 10, 1 October 2004 (2004-10-01), pages 3007-3022, XP011119394, ISSN: 1053-587X, DOI: 10.1109/TSP.2004.833866</text><sources><source mxw-id="PNPL45210536" load-source="docdb" name="SEA" category="X"/></sources></nplcit><nplcit><text>LIN E T ET AL:  "Temporal synchronization in video watermarking: further studies", PROCEEDINGS OF SPIE, SPIE, US, vol. 5020, 21 January 2003 (2003-01-21), pages 493-504, XP009088624, ISSN: 0277-786X, DOI: 10.1117/12.477310</text><sources><source mxw-id="PNPL45210537" load-source="docdb" name="SEA" category="X"/></sources></nplcit><nplcit><text>MOBASSERI B G:  "Direct sequence watermarking of digital video using m-frames", IMAGE PROCESSING, 1998. ICIP 98. PROCEEDINGS. 1998 INTERNATIONAL CONFERENCE ON CHICAGO, IL, USA 4-7 OCT. 1998, LOS ALAMITOS, CA, USA,IEEE COMPUT. SOC, US, vol. 2, 4 October 1998 (1998-10-04), pages 399-403, XP010308533, DOI: 10.1109/ICIP.1998.723399 ISBN: 978-0-8186-8821-8</text><sources><source mxw-id="PNPL45210538" load-source="docdb" name="SEA" category="X"/></sources></nplcit><nplcit><text>None</text><sources><source mxw-id="PNPL45210539" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR919540528" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>THOMSON LICENSING</last-name><address><country>FR</country></address></addressbook></applicant><applicant mxw-id="PPAR919523177" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>THOMSON LICENSING</last-name></addressbook></applicant><applicant mxw-id="PPAR919006002" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Thomson Licensing</last-name><iid>101157220</iid><address><street>1-5, rue Jeanne d'Arc</street><city>92130 Issy-Les-Moulineaux</city><country>FR</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919537004" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>BAUDRY SEVERINE</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919503941" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>BAUDRY, SEVERINE</last-name></addressbook></inventor><inventor mxw-id="PPAR919017425" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>BAUDRY, SEVERINE</last-name><address><street>c/o Technicolor R&amp;D France 1 Avenue de Belle Fontaine CS17616</street><city>35576 Cesson-Sévigné</city><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919532333" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>CHUPEAU BERTRAND</last-name><address><country>FR</country></address></addressbook></inventor><inventor mxw-id="PPAR919539313" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>CHUPEAU, BERTRAND</last-name></addressbook></inventor><inventor mxw-id="PPAR919007549" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>CHUPEAU, BERTRAND</last-name><address><street>c/o Technicolor R&amp;D France 1 Avenue de Belle Fontaine CS17616</street><city>35576 Cesson-Sévigné</city><country>FR</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919014828" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huchet, Anne</last-name><suffix>et al</suffix><iid>101157206</iid><address><street>Technicolor 1-5 rue Jeanne d'Arc</street><city>92130 Issy-Les-Moulineaux</city><country>FR</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549907207" load-source="docdb">AL</country><country mxw-id="DS549741372" load-source="docdb">AT</country><country mxw-id="DS549739833" load-source="docdb">BE</country><country mxw-id="DS549738115" load-source="docdb">BG</country><country mxw-id="DS549777823" load-source="docdb">CH</country><country mxw-id="DS549739834" load-source="docdb">CY</country><country mxw-id="DS549741377" load-source="docdb">CZ</country><country mxw-id="DS549907209" load-source="docdb">DE</country><country mxw-id="DS549739835" load-source="docdb">DK</country><country mxw-id="DS549739836" load-source="docdb">EE</country><country mxw-id="DS549739012" load-source="docdb">ES</country><country mxw-id="DS549738116" load-source="docdb">FI</country><country mxw-id="DS549777824" load-source="docdb">FR</country><country mxw-id="DS549907210" load-source="docdb">GB</country><country mxw-id="DS549739841" load-source="docdb">GR</country><country mxw-id="DS549907211" load-source="docdb">HR</country><country mxw-id="DS549741378" load-source="docdb">HU</country><country mxw-id="DS549807491" load-source="docdb">IE</country><country mxw-id="DS549739842" load-source="docdb">IS</country><country mxw-id="DS549738117" load-source="docdb">IT</country><country mxw-id="DS549739843" load-source="docdb">LI</country><country mxw-id="DS549738118" load-source="docdb">LT</country><country mxw-id="DS549739117" load-source="docdb">LU</country><country mxw-id="DS549738119" load-source="docdb">LV</country><country mxw-id="DS549738120" load-source="docdb">MC</country><country mxw-id="DS549739118" load-source="docdb">MK</country><country mxw-id="DS549739119" load-source="docdb">MT</country><country mxw-id="DS549739013" load-source="docdb">NL</country><country mxw-id="DS549741025" load-source="docdb">NO</country><country mxw-id="DS549739014" load-source="docdb">PL</country><country mxw-id="DS549739120" load-source="docdb">PT</country><country mxw-id="DS549807492" load-source="docdb">RO</country><country mxw-id="DS549739189" load-source="docdb">RS</country><country mxw-id="DS549739015" load-source="docdb">SE</country><country mxw-id="DS549741379" load-source="docdb">SI</country><country mxw-id="DS549741026" load-source="docdb">SK</country><country mxw-id="DS549741027" load-source="docdb">SM</country><country mxw-id="DS549738121" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128673008" lang="EN" load-source="patent-office"><p id="pa01" num="0001">The invention relates to a method for decoding a watermark in a target video wherein a plurality of watermark decoding keys are associated with frame indices of a master video, the method comprising the steps of determining a frame index pair i,j wherein frame index i refers to a position of a frame in the master video and frame index j refers to a position of a frame in the target video; accessing a watermark decoding key Ki from the master frame index i; decoding watermark on frame j using the watermark decoding key Ki; computing a confidence score of a watermark decoding for the determined frame pair i,j; iterating previous step on i; matching a frame index in and a frame index j for which the confidence score of watermark decoding is maximum over the at least frame index i; and determining the watermark for the frame corresponding to frame index j in the target video by accessing key K<sub>i</sub> from frame index in from the matched frame index pair i<sub>n</sub>,<sub>j</sub>.</p><p id="pa02" num="0002">In a preferred embodiment, the method is recursively applied to successive potential frame pairs and confidence score is input as a posteriori information in a registering algorithm. According to another aspect, the invention also relates to a device for implementing the method.
<img id="iaf01" file="imgaf001.tif" wi="78" he="123" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128737153" lang="EN" source="EPO" load-source="docdb"><p>The invention relates to a method for decoding a watermark in a target video wherein a plurality of watermark decoding keys are associated with frame indices of a master video, the method comprising the steps of determining a frame index pair i,j wherein frame index i refers to a position of a frame in the master video and frame index j refers to a position of a frame in the target video; accessing a watermark decoding key Ki from the master frame index i; decoding watermark on frame j using the watermark decoding key Ki; computing a confidence score of a watermark decoding for the determined frame pair i,j; iterating previous step on i; matching a frame index in and a frame index j for which the confidence score of watermark decoding is maximum over the at least frame index i; and determining the watermark for the frame corresponding to frame index j in the target video by accessing key K i  from frame index in from the matched frame index pair i n , j .  In a preferred embodiment, the method is recursively applied to successive potential frame pairs and confidence score is input as a posteriori information in a registering algorithm. According to another aspect, the invention also relates to a device for implementing the method.</p></abstract><description mxw-id="PDES63958996" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><u>Field of the invention</u></heading><p id="p0001" num="0001">The invention relates to watermark decoding. More particularly the invention relates to a method for joint watermarking decoding and temporal registration of a target video with a master video.</p><heading id="h0002"><u>Back ground of the invention</u></heading><p id="p0002" num="0002">This section is intended to introduce the reader to various aspects of art, which may be related to various aspects of the present invention that are described and/or claimed below. This discussion is believed to be helpful in providing the reader with background information to facilitate a better understanding of the various aspects of the present invention. Accordingly, it should be understood that these statements are to be read in this light, and not as admissions of prior art.</p><p id="p0003" num="0003">Among many alternative copyrights management systems, watermarking techniques hide binary information into multimedia content in a robust and imperceptible manner. The embedded information can be used later during forensics analysis to identify the source of an illegal copy. Temporal registration of a watermarked video copy is, most of the time (i.e . in the variant where the watermark is modified from one frame to another), a mandatory pre-processing for subsequent watermark decoding. Temporal video registration consists in temporally aligning frames of two videos, called the target video and the master video (also called original video), (or of segment of videos) of a same content. Temporal registration is all the more necessary as the video has undergone frame-rate conversion, camcording, frame-grabbing, etc. A registration method must be accurate and robust to noise. Many temporal registration algorithms are known from the skilled in the art.</p><p id="p0004" num="0004">In a first class of temporal registration algorithms, a reference pattern is watermarked along with the watermark payload. The watermark detector will<!-- EPO <DP n="2"> --> then try every likely temporal transform and select the one which matches the reference pattern more closely. The drawback of these methods is that watermarking a reference pattern will either increase the watermark visibility (since a second registration watermark is inserted at top of the useful forensic one) or decrease the payload capacity (the "watermarking space" is used to transmit the registration information). Besides such methods are often based on exhaustive search, where every possible temporal transforms are tested and the temporal transform with largest confidence is elected, which raise the issues of huge time-consumption and high sensitivity to noise.</p><p id="p0005" num="0005">In another class of registration algorithms, temporal registration is based on the registration of temporal video fingerprints. The "fingerprint" of a video content is a set of features - automatically extracted from the video signal - which are compact, discriminant and robust to signal distortions. A temporal fingerprint is a particular kind of fingerprint capturing the evolution of the signal over time. However, computing and aligning temporal fingerprints of a target and a of master video is time and power consuming for a whole content, while in many cases only a temporal segment of such video is interesting (such as in video forensics, the temporal segment with the embedded watermark). The drawback of these methods based on analysis of similarity of fingerprints is that the fingerprints of the master video must be stored in a database. Depending on the methods used to compute fingerprints, the storage size needed may be quite high.</p><p id="p0006" num="0006">Thus known methods raise the issue of the efficiency of such registration methods before decoding a watermark. A method for accurate and robust registration adapted to watermark decoding without fingerprint or dedicated watermarks is therefore needed.</p><heading id="h0003"><u>Summary of the invention</u></heading><p id="p0007" num="0007">To this end, the invention relates to a method for decoding a watermark in a target video wherein a plurality of watermark decoding keys are respectively associated with frame indices of a master video, the method comprising, for at least a frame index j referring to a position of a frame in the target video, the steps, in a device, of:<!-- EPO <DP n="3"> -->
<ol><li>a) determining a frame index pair i,j wherein frame index i refers to a position of a frame in the master video;</li><li>b) accessing a watermark decoding key K<sub>i</sub> from the master frame index i;</li><li>c) decoding watermark on frame j in the target video using the watermark decoding key K<sub>i</sub>;</li><li>d) computing a confidence score that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j ;</li><li>e) iterating steps a) to d) for at least an index i in the master video;</li><li>f) matching a frame index in referring to a position of a frame in the master video and a frame index j referring to a position of a frame in the target video for which the confidence that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j is maximum over the at least frame index i;</li><li>g) and determining the watermark for frame at the position corresponding to frame index j in the target video by accessing key K<sub>i</sub> from frame index in from the matched frame index pair i<sub>n</sub>,j.</li></ol></p><p id="p0008" num="0008">Advantageously the method does not require information dedicated to registration such as temporal fingerprint or dedicated watermark for evaluating the video transform. Besides the registration step of the method is natively adapted to watermark decoding (no preliminary exhaustive registration, no overhead for storing "registering" fingerprints, no noise induce by synchronization watermark).</p><p id="p0009" num="0009">In a preferred embodiment, the method is recursively applied to successive potential frame pairs. The method thus comprises the steps of:
<ol><li>a) determining successive frame index pairs i,j wherein frame index i refers to a position of a frame in said master video and frame index j refers to a position of a frame in said target video;</li><li>b) accessing a watermark decoding key K<sub>i</sub> from the master frame index i;</li><li>c) decoding watermark on frame j in target video using the watermark decoding key K<sub>i</sub>;</li><li>d) computing a confidence score that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j;</li><li>e) iterating steps a) to d) for at least a different combination of an index i in the master video and an index j in the target video ;<!-- EPO <DP n="4"> --></li><li>f) registering successive frame index pairs i,j using the confidence score that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j resulting in a cumulated confidence score ;</li><li>g) matching a last frame index in referring to the master video and a frame index j<sub>k</sub> referring to the target video for which the cumulated confidence score is maximum over the at least frame index j and recursively matching the frame index i in the master video with the frame index j in the target video from the maximum cumulated confidence score;</li><li>h) and determining the watermark for each of the frame at a position corresponding to frame index j in the target video by accessing key K<sub>i</sub> from frame index i from the matched frame index pair i,j.</li></ol></p><p id="p0010" num="0010">According to a particular characteristic, confidence score of watermark decoding is a correlation score between the watermark on frame at the position corresponding to frame index j and a sequence determined by accessing key K<sub>i</sub> from frame index i referring to master video. According to another particular characteristic, confidence score of watermark decoding is an estimate of the a posteriori probability of decoding a watermark for the frame at the position corresponding to frame index j by accessing key K<sub>i</sub> from frame index i referring to master video.</p><p id="p0011" num="0011">According to an advantageous characteristic, the registering step further uses at least a determined constraint among which the increasing order of frames in the target and master video. Advantageously the method is less complex and more robust than a method based on an exhaustive search, thanks to the a priori information introduced by the determined constraint.</p><p id="p0012" num="0012">According to another advantageous characteristic, the registering step uses dynamic programming or Viterbi and further comprises computing a cumulated confidence score of watermark decoding for each frame i belonging the master video.</p><p id="p0013" num="0013">According to another aspect, the invention also relates to a device for decoding a watermark in a target video wherein a plurality of watermark decoding keys are associated with frame indices of a master video, the device comprising a processor being adapted to perform any variant of the method previously described.<!-- EPO <DP n="5"> --></p><heading id="h0004"><u>Brief description of the drawings</u></heading><p id="p0014" num="0014">Other characteristics and advantages of the invention will appear through the description of a non-limiting embodiment of the invention, which will be illustrated, with the help of the enclosed drawings.
<ul><li><figref idrefs="f0001"><b>Figure 1</b></figref> represents a preferred embodiment of a method according to the invention,</li><li><figref idrefs="f0002"><b>Figure 2</b></figref> illustrates the computation of the cumulated distance between frame index i of a master video and frame index j of a target video according to an embodiment of the invention,</li><li><figref idrefs="f0003"><b>Figure 3</b></figref> an exemplary decoding device according to a preferred embodiment of the invention.</li></ul></p><p id="p0015" num="0015">In the figure, the represented blocks are purely functional entities, which do not necessarily correspond to physically separate entities. These functional entities may be implemented as hardware, software, or a combination of software and hardware; furthermore, they may be implemented in one or more integrated circuits.</p><heading id="h0005"><u>Detailed description of preferred embodiments</u></heading><p id="p0016" num="0016">A salient idea of the invention is to perform a joint decoding and registering algorithm. In most known methods for decoding a watermark, the decoded watermark also comes along with a confidence score. On a correctly registered sequence, the score should be (reasonably) high. On the contrary, on an incorrectly registered sequence, this score will be very low; more precisely, it will be of the same order of magnitude as if the detection was performed on an non watermarked video. Hence, the decoding confidence score will indicate whether the target video has been correctly registered. For each frame pair wherein one frame belongs to the target video and the other frame belongs to a master video, the decoding confidence score will be input<!-- EPO <DP n="6"> --> as a posteriori information in a state-of-the art registration algorithm (for instance dynamic programming or Viterbi) to give the best registration estimate. In a refinement, the registration algorithm will introduce a priori constraints to yield a more robust registration estimate. Therefore the registration algorithm is intrinsically linked to the decoding algorithm. Advantageously, the registration performances fit well the watermarking algorithms since only frames bearing watermark information will be registered, saving computation time and memory. Registration will perform better on frames bearing many watermark bits, because the confidence score will be more accurate and will discriminate more precisely correctly registered frames from incorrectly registered frames.</p><p id="p0017" num="0017">As opposed to known registration methods, the method according to a preferred embodiment of the invention uses the watermark decoding score instead of the similarity between fingerprints to register the watermarked target video with the master video. In various embodiments of the watermark algorithm, a key defines, for each frame in the watermark video, parameters useful for the decoding. According to the watermarking algorithm, the parameters differ. The skilled in the art will appreciate that the decoding algorithm do not require knowledge of the frame in the master, but require information on the master video such as the frame index in the master video, the watermark algorithm, and the parameters associated to the determined frame index.</p><p id="p0018" num="0018">In a preferred embodiment, each frame i of the master video is watermarked with number of bits n<sub>i</sub>. In a variant, the number of watermarked bits per frame is variable. In a particular variant, some of the frames may also not be watermarked, thus the number of watermarked bits is reduced to zero for these frames. Thus, in the preferred embodiment wherein the watermark embedder modifies a block in a frame, the key may define localization of watermarked blocks or pixels in the frame or the modified DCT coefficient. The watermark embedder uses a watermarking key K<sub>i</sub> which may be different from one frame to the other. The skilled in the art knows that in practice, such keys may be derived as successive outputs of a pseudo-random generator which is initialized by a master key. As a consequence, the watermark bits on<!-- EPO <DP n="7"> --> a given frame i will be correctly decoded only if the correct key <i>K<sub>i</sub></i> is applied for the decoding. For each watermark bit index k, the watermark decoder will output an estimation of the bit value noted b̂<i><sub>k</sub></i> and an associated confidence score noted S<sub>k</sub>. For instance, S<sub>k</sub> may be given by an estimate of the a posteriori probability <maths id="math0001" num=""><math display="block"><msub><mi mathvariant="normal">S</mi><mrow><mi mathvariant="normal">k</mi><mo>=</mo></mrow></msub><mo>⁢</mo><mi>P</mi><mfenced separators=""><msub><mi>b</mi><mi>k</mi></msub><mo>=</mo><mover><msub><mi>b</mi><mi>k</mi></msub><mo>^</mo></mover><mo>/</mo><msub><mi>F</mi><mi>i</mi></msub></mfenced><mn>.</mn></math><img id="ib0001" file="imgb0001.tif" wi="40" he="8" img-content="math" img-format="tif"/></maths></p><p id="p0019" num="0019">In this case, S<sub>k</sub> will range from 0.5 for binary coding when each bit 0 or 1 is equally likely, to 1 when best confidence score is reached. A global confidence score S<sub>i</sub>(j) is computed for k watermarked bits of frame i in the master video decoded on frame j in the target video.</p><p id="p0020" num="0020">In a variant embodiment of watermarking, the watermark is embedded through a spreading sequence to get a better resistance to communication distortion. Thus, in the variant embodiment wherein the watermark embedder introduces a determined noise in the video, the key defines the seed used for the generation of a pseudo-random sequence of noise. In this variant, at the decoding stage, the confidence score S<sub>i</sub>(j) will be given by the correlation score.</p><p id="p0021" num="0021">Thus, in any variant of watermarking scheme and associated watermark detector, when the watermark detector is applied on the wrong frame, the output confidence scores will be very low, as if the detector were applied on a non-watermarked frame. In the variant where S<sub>i</sub>(j) is a posteriori probability, S<sub>i</sub>(j) ∼ 0.5. In the variant where S<sub>i</sub>(j) is a correlation score, S<sub>i</sub>(j) ∼0.</p><p id="p0022" num="0022">The detection score hence gives us information on whether a given frame in the target video is correctly registered with respect to the master video.</p><p id="p0023" num="0023">In a first embodiment, the confidence score is used independently on each frame pair. In a first step, potential frame pairs (i,j) are determined wherein a frame index i refers to the position of a frame in the master video and frame index j refers to the position of a frame in the target video. For determining such frame index pairs, a first raw anchor is used and a range around the anchor is determined. Such first raw anchor may be visually performed by a user, for instance frames corresponding to shot boundaries determine an anchor. In another embodiment, the anchor is automatically<!-- EPO <DP n="8"> --> determined through frame analysis for instance by extracting key frames in both target and master video. The first raw anchor may also be determined by the first frame of the video. The skilled in the art will appreciate that contrary to an exhaustive search, not all frame pair indices are determined as potential match frame pair indices. Only a set of indices comprised in a range around the anchor is selected as potential frame index for matching. A tradeoff is made between the width of the range and the precision of the anchor wherein a reduced range improves the efficiency of the algorithm in term of power computation but requires a more precise anchor. In a second step, watermark decoding is applied to potential frame pair (i,j) and a confidence score S<sub>i</sub>(j) is computed for the k watermark bits inserted on the determined frame i of the master video and potentially decoded in the frame j of the target video. The first and second step are repeated, sequentially or in parallel, for a plurality of frame pairs and a collection of frame indices and associated confidence scores are determined. In a third step, according to the confidence score S<sub>i</sub>(j), a frame index j is matched with a frame index i. In a variant, the match is performed for the frame pair for which the confidence score of watermark decoding for the frame pair i,j is maximum. In the variant where S<sub>i</sub>(j) is a posteriori probability, S<sub>i</sub>(j) ∼ 1. In the variant where S<sub>i</sub>(j) is a correlation score, S<sub>i</sub>(j) ∼1. In another variant, the match is performed when the confidence score of watermark decoding for the frame pair i,j is above a first threshold. In a last step, watermark decoding is performed on the matched frame index pairs using the frame at the position j in the target video and the parameters deduced from the decoding key K<sub>i</sub>.</p><p id="p0024" num="0024">However, if the target video has undergone noise, for instance if it has been compressed, edited, or transformed, registration performed independently on each watermarked frame on the confidence score basis may yield incorrect decoding. In a preferred embodiment, the registration is rendered more robust by considering a set of successive watermarked frames, and by searching for a global registration pattern which, firstly, gives a high overall confidence score, and secondly, corresponds to a likely temporal transformation of the video. In a variant, a pre-determined constraint on the temporal transform is input in the registration algorithm. Advantageously, the<!-- EPO <DP n="9"> --> determined constraint consists in that the frame indexes for the registered frames follow an increasing order.</p><p id="p0025" num="0025"><figref idrefs="f0001">Figure 1</figref> represents a preferred embodiment of the invention. In a first step S1, potential match frame index pairs (i,j) are determined wherein i denotes the frame index in the master video, and j denotes the frame index in the target video.</p><p id="p0026" num="0026">In a second step S2, watermark decoding is applied to the determined potential match frame index pairs (i,j) using potential decoding keys, and a confidence score S<sub>i</sub>(j) is computed for the watermark bits inserted on the determined frame i of the master video and potentially decoded in the frame j of the target video.</p><p id="p0027" num="0027">In a third step S3, the confidence scores S<sub>i</sub>(j) are input in a temporal registration algorithm. State-of-the-art algorithms like dynamic programming ( also known as dynamic time warping), Viterbi, or forward-backward, enable temporal registration by combining information coming from the data (a posteriori info) with predefined constraints on the acceptable temporal transform (a priori info). For instance, dynamic programming recursively computes a score, or distance, for each potential match pair (i, j). The algorithm aims at finding the match pairs with minimal distance (i.e. maximal score) by considering successive frame distances. <figref idrefs="f0002">Figure 2</figref> illustrates the computation of the cumulated distance between frame index i of the master video 200 and frame index j of a target video 210. In a variant, for each increasing index in frames of master and target video, the cumulated distance D(i,j) is computed as : <maths id="math0002" num=""><math display="block"><mi>D</mi><mfenced separators=""><mi>i</mi><mo>⁢</mo><mi>j</mi></mfenced><mo>=</mo><mi>d</mi><mfenced separators=""><mi>i</mi><mo>⁢</mo><mi>j</mi></mfenced><mo>+</mo><mi mathvariant="italic">MIN</mi><mfenced open="{" close="}" separators=""><mi>D</mi><mo>⁢</mo><mfenced separators=""><mi>i</mi><mo>-</mo><mn>1</mn><mo>,</mo><mi>j</mi><mo>-</mo><mn>1</mn></mfenced><mo>;</mo><mi>D</mi><mo>⁢</mo><mfenced separators=""><mi>i</mi><mo>-</mo><mn>1</mn><mo>,</mo><mi>j</mi></mfenced><mo>+</mo><msub><mi>p</mi><mi>d</mi></msub><mo>;</mo><mrow><mo>(</mo><mi>D</mi><mo>⁢</mo><mfenced separators=""><mi>i</mi><mo>,</mo><mi>j</mi><mo>-</mo><mn>1</mn></mfenced><mo>+</mo><msub><mi>p</mi><mi>c</mi></msub></mrow></mfenced></math><img id="ib0002" file="imgb0002.tif" wi="148" he="12" img-content="math" img-format="tif"/></maths><br/>
With
<ul><li>d(i,j) being the dissimilarity between master frame i and target frame j;</li><li>p<sub>d</sub> 230 the penalty for image deletion; and</li><li>p<sub>c</sub> 240 the penalty for image duplication.</li></ul><!-- EPO <DP n="10"> --></p><p id="p0028" num="0028">The penalties respectively depend on the probability in the temporal distortion model that a frame was deleted or inserted. D(i,j) is then recursively computed for all frame indices i in the master video.</p><p id="p0029" num="0029">In a fourth step S4, the best match for each master frame index ranging from n-1 to 0 is recursively determined starting from the best match for the last frame index i<sub>n</sub>. The best match for the last frame index i<sub>n</sub> is computed with: <maths id="math0003" num=""><math display="block"><mi mathvariant="normal">j</mi><mfenced><mi mathvariant="normal">n</mi></mfenced><mo>=</mo><munder><mi>ARGmin</mi><mi mathvariant="normal">j</mi></munder><mfenced separators=""><mi mathvariant="normal">D</mi><mfenced separators=""><msub><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></msub><mo>⁢</mo><mi mathvariant="normal">j</mi></mfenced></mfenced></math><img id="ib0003" file="imgb0003.tif" wi="51" he="12" img-content="math" img-format="tif"/></maths></p><p id="p0030" num="0030">Then recursively, the best match for each master frame index ranging from n-1 to 0 is determined by finding the antecessor match pair for each best match pair.</p><p id="p0031" num="0031">In known pre-processing registering algorithms, the a posteriori information d(i,j) is computed for instance as a distance between fingerprints of master frame i and target frame j. Then the watermark decoding algorithm is performed on the registered video. On the contrary, the confidence score obtained after decoding the watermark bits on target frame j with watermark key of master frame i is used as a posteriori information of a registration algorithm. As the confidence score should be higher if the match between frames i and j is correct, the distance between frames i and j is determined as being: <maths id="math0004" num=""><math display="block"><mi>d</mi><mfenced separators=""><mi>i</mi><mo>⁢</mo><mi>j</mi></mfenced><mo>=</mo><mo>-</mo><msub><mi>S</mi><mi>i</mi></msub><mfenced><mi>j</mi></mfenced></math><img id="ib0004" file="imgb0004.tif" wi="41" he="10" img-content="math" img-format="tif"/></maths></p><p id="p0032" num="0032">In a variant, any other known registration algorithms, like Viterbi or forward-backward are compatible with the invention and the watermark score S<sub>i</sub>(j) is input to such algorithm as a posteriori information.</p><p id="p0033" num="0033">In a last step S5, watermark decoding is performed on the matched frame index pairs using the frame at the position j in the target video and the parameters deduced from the decoding key K<sub>i</sub>.</p><p id="p0034" num="0034"><figref idrefs="f0003">Figure 3</figref> illustrates an exemplary decoding device according to a preferred embodiment of the present invention. The decoding device 300 comprises at least one processor 310 (hereinafter "processor") and memory<!-- EPO <DP n="11"> --> 320. The processor 310 is adapted to perform any embodiment of the invention and the memory 210 is adapted to store data such as cumulated confidence score. Advantageously, the memory do not need to store in a database huge amount of data such as the fingerprints from known registering methods. It should be understood that the decoding device 300 may further comprise internal connections, a communication interface for receiving target video to decode and a user interface.</p><p id="p0035" num="0035">The skilled person will also appreciate that as the decoding method can be implemented quite easily without the need for special equipment, it may be implemented by 'normal' user devices such as PCs, mobile phones, gateways in home networks and so on.</p><p id="p0036" num="0036">Naturally, the invention is not limited to the embodiments previously described. In particular, the invention is neither limited to the watermarking algorithm nor the watermark decoding algorithm. The invention is compatible with any registration algorithm using a posteriori information for the purpose of registration.</p></description><claims mxw-id="PCLM56982016" lang="EN" load-source="patent-office"><!-- EPO <DP n="12"> --><claim id="c-en-0001" num="0001"><claim-text>Method for decoding a watermark in a target video wherein a plurality of watermark decoding keys are respectively associated with frame indices of a master video, <b>characterized in that</b>, the method comprises, for at least a frame index j referring to a position of a frame in said target video, the steps, in a device (300) of:
<claim-text>a) determining (S1) a frame index pair i,j wherein frame index i refers to a position of a frame in said master video;</claim-text>
<claim-text>b) accessing a watermark decoding key K<sub>i</sub> from the master frame index i;</claim-text>
<claim-text>c) decoding watermark on frame j in said target video using said watermark decoding key K<sub>i</sub>;</claim-text>
<claim-text>d) computing (S2) a confidence score that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j ;</claim-text>
<claim-text>e) iterating steps a) to d) for at least an index i in the master video;</claim-text>
<claim-text>f) matching a frame index in referring to a position of a frame in said master video and a frame index j referring to a position of a frame in said target video for which the confidence that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j is maximum over the at least frame index i;</claim-text>
<claim-text>g) and determining (S5) the watermark for frame at the position corresponding to frame index j in said target video by accessing key K<sub>i</sub> from frame index in from the matched frame index pair i<sub>n</sub>,j.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>Method according to claim 1 <b>characterized in that</b> the method further comprises
<claim-text>a) determining (S1) successive frame index pairs i,j wherein frame index i refers to a position of a frame in said master video and frame index j refers to a position of a frame in said target video;</claim-text>
<claim-text>b) accessing a watermark decoding key K<sub>i</sub> from the master frame index i;</claim-text>
<claim-text>c) decoding watermark on frame j in target video using said watermark decoding key K<sub>i</sub>;</claim-text>
<claim-text>d) computing (S2) a confidence score that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j;<!-- EPO <DP n="13"> --></claim-text>
<claim-text>e) iterating steps a) to d) for at least a different combination of an index i in the master video and an index j in the target video ;</claim-text>
<claim-text>f) registering successive frame index pairs i,j using the confidence score that the watermark decoding key K<sub>i</sub> corresponds to the watermark on frame j resulting in a cumulated confidence score ;</claim-text>
<claim-text>g) matching (S4) a last frame index in referring to said master video and a frame index j<sub>k</sub> referring to said target video for which the cumulated confidence score is maximum over the at least frame index j and recursively matching said frame index i in said master video with said frame index j in said target video from said maximum cumulated confidence score;</claim-text>
<claim-text>h) and determining the watermark for each of said frame at a position corresponding to frame index j in said target video by accessing key K<sub>i</sub> from frame index i from the matched frame index pair i,j.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>Method according to claim 1 or 2 wherein confidence score of watermark decoding is a correlation score between the watermark on frame at the position corresponding to frame index j and a sequence determined by accessing key K<sub>i</sub> from frame index i referring to master video.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>Method according to claim 1 or 2 wherein confidence score of watermark decoding is an estimate of the a posteriori probability of decoding a watermark for said frame at the position corresponding to frame index j by accessing key K<sub>i</sub> from frame index i referring to master video.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>Method according to claim 2 wherein registering step further uses at least a determined constraint among which the increasing order of frames in the target and master video.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>Method according to claim 2 wherein registering step uses dynamic programming or Viterbi and further comprises computing a cumulated<!-- EPO <DP n="14"> --> confidence score of watermark decoding for each frame i belonging said master video.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>Device (300) for decoding a watermark in a target video wherein a plurality of watermark decoding keys are respectively associated with frame indices of a master video, said device comprising a processor (310) being adapted to perform method claim 1 to 6.</claim-text></claim></claims><drawings mxw-id="PDW16670411" load-source="patent-office"><!-- EPO <DP n="15"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="140" he="198" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="16"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="152" he="146" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="17"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="135" he="141" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="162" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="164" he="233" type="tif"/><doc-page id="srep0003" file="srep0003.tif" wi="164" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
