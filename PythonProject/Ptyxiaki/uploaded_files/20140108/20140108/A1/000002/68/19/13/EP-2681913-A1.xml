<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2681913-A1" country="EP" doc-number="2681913" kind="A1" date="20140108" family-id="45496239" file-reference-id="315080" date-produced="20180823" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146586375" ucid="EP-2681913-A1"><document-id><country>EP</country><doc-number>2681913</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-11808966-A" is-representative="NO"><document-id mxw-id="PAPP154848567" load-source="docdb" format="epo"><country>EP</country><doc-number>11808966</doc-number><kind>A</kind><date>20111216</date><lang>EN</lang></document-id><document-id mxw-id="PAPP172244769" load-source="docdb" format="original"><country>EP</country><doc-number>11808966.3</doc-number><date>20111216</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140553938" ucid="SE-2011051526-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>SE</country><doc-number>2011051526</doc-number><kind>W</kind><date>20111216</date></document-id></priority-claim><priority-claim mxw-id="PPC140557878" ucid="US-201161447862-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201161447862</doc-number><kind>P</kind><date>20110301</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2059332048" load-source="docdb">H04N  19/82        20140101ALI20150428BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2059333269" load-source="docdb">H04N  19/14        20140101ALI20150428BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2059335475" load-source="docdb">H04N  19/176       20140101AFI20150428BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2059336325" load-source="docdb">H04N  19/117       20140101ALI20150428BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2059340299" load-source="docdb">H04N  19/86        20140101ALI20150428BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1820254685" load-source="docdb" scheme="CPC">H04N  19/86        20141101 FI20170505BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1875772385" load-source="docdb" scheme="CPC">H04N  19/82        20141101 LI20161123BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1875772386" load-source="docdb" scheme="CPC">H04N  19/176       20130101 LI20161123BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1875772387" load-source="docdb" scheme="CPC">H04N  19/14        20141101 LI20161123BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1875772388" load-source="docdb" scheme="CPC">H04N  19/117       20141101 LI20161123BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132363758" lang="DE" load-source="patent-office">EENTSPERRUNGSFILTERUNGSSTEUERUNG</invention-title><invention-title mxw-id="PT132363759" lang="EN" load-source="patent-office">DEBLOCKING FILTERING CONTROL</invention-title><invention-title mxw-id="PT132363760" lang="FR" load-source="patent-office">COMMANDE DE FILTRAGE ANTIBLOCS</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR919546286" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ERICSSON TELEFON AB L M</last-name><address><country>SE</country></address></addressbook></applicant><applicant mxw-id="PPAR919541565" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>TELEFONAKTIEBOLAGET L M ERICSSON (PUBL)</last-name></addressbook></applicant><applicant mxw-id="PPAR919008315" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Telefonaktiebolaget L M Ericsson (PUBL)</last-name><iid>101131063</iid><address><city>164 83 Stockholm</city><country>SE</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919538931" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>NORKIN ANDREY</last-name><address><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919520007" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>NORKIN, ANDREY</last-name></addressbook></inventor><inventor mxw-id="PPAR919017481" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>NORKIN, ANDREY</last-name><address><street>Blomgatan 6</street><city>S-16960 Solna</city><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919534377" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>ANDERSSON KENNETH</last-name><address><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR919512574" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>ANDERSSON, KENNETH</last-name></addressbook></inventor><inventor mxw-id="PPAR919014205" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>ANDERSSON, KENNETH</last-name><address><street>Västra Trädgårdsvägen 52</street><city>S-802 63 Gävle</city><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR1071073968" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>SJÖBERG RICKARD</last-name><address><country>SE</country></address></addressbook></inventor><inventor mxw-id="PPAR1070517999" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>Sjöberg, Rickard</last-name></addressbook></inventor><inventor mxw-id="PPAR919015811" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>Sjöberg, Rickard</last-name><address><street>Robert Almströmsgatan 9A</street><city>S-113 36 Stockholm</city><country>SE</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919015087" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Ahlstrand, Mal-Sook Susanne Maria</last-name><iid>101317786</iid><address><street>Ericsson AB Patent Unit Kista Device Service &amp; Media Torshamnsgatan 21-23</street><city>164 80 Stockholm</city><country>SE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="SE-2011051526-W"><document-id><country>SE</country><doc-number>2011051526</doc-number><kind>W</kind><date>20111216</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2012118421-A1"><document-id><country>WO</country><doc-number>2012118421</doc-number><kind>A1</kind><date>20120907</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS549851377" load-source="docdb">AL</country><country mxw-id="DS549837391" load-source="docdb">AT</country><country mxw-id="DS549851382" load-source="docdb">BE</country><country mxw-id="DS549914578" load-source="docdb">BG</country><country mxw-id="DS549759836" load-source="docdb">CH</country><country mxw-id="DS549837829" load-source="docdb">CY</country><country mxw-id="DS549837392" load-source="docdb">CZ</country><country mxw-id="DS549851383" load-source="docdb">DE</country><country mxw-id="DS549837906" load-source="docdb">DK</country><country mxw-id="DS549837907" load-source="docdb">EE</country><country mxw-id="DS549760266" load-source="docdb">ES</country><country mxw-id="DS549914579" load-source="docdb">FI</country><country mxw-id="DS549914580" load-source="docdb">FR</country><country mxw-id="DS549851384" load-source="docdb">GB</country><country mxw-id="DS549837908" load-source="docdb">GR</country><country mxw-id="DS549851385" load-source="docdb">HR</country><country mxw-id="DS549837393" load-source="docdb">HU</country><country mxw-id="DS549759845" load-source="docdb">IE</country><country mxw-id="DS549837909" load-source="docdb">IS</country><country mxw-id="DS549914581" load-source="docdb">IT</country><country mxw-id="DS549837922" load-source="docdb">LI</country><country mxw-id="DS549770034" load-source="docdb">LT</country><country mxw-id="DS549837398" load-source="docdb">LU</country><country mxw-id="DS549770035" load-source="docdb">LV</country><country mxw-id="DS549770036" load-source="docdb">MC</country><country mxw-id="DS549837834" load-source="docdb">MK</country><country mxw-id="DS549837835" load-source="docdb">MT</country><country mxw-id="DS549837399" load-source="docdb">NL</country><country mxw-id="DS549760267" load-source="docdb">NO</country><country mxw-id="DS549759846" load-source="docdb">PL</country><country mxw-id="DS549770041" load-source="docdb">PT</country><country mxw-id="DS549837400" load-source="docdb">RO</country><country mxw-id="DS549770042" load-source="docdb">RS</country><country mxw-id="DS549759847" load-source="docdb">SE</country><country mxw-id="DS549914582" load-source="docdb">SI</country><country mxw-id="DS549760268" load-source="docdb">SK</country><country mxw-id="DS549759848" load-source="docdb">SM</country><country mxw-id="DS549837836" load-source="docdb">TR</country></ep-contracting-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA99831315" ref-ucid="WO-2012118421-A1" lang="EN" load-source="patent-office"><p num="0000">A first filter decision value is calculated for a block (10) of pixels (11, 13, 15, 17) in a video frame based on pixel values of pixels (11, 13, 15) in a first line (12) of pixels (11, 13, 15, 17) in the block (10). A second filter decision value is also calculated for the block (10) based on pixel values of pixels (21, 23, 25, 27) in a corresponding first line (22) of pixels (21, 23, 25, 27) in a neighboring block (20) in the video frame. The first filter decision value is used to determine how many pixels in a line (12) of pixels (11, 13, 15, 17) in the block (10) to filter relative to a block boundary (1) between the block (10) and the neighboring block (20). The second filter decision value is used to determine how many pixels in a corresponding line (22) of pixels (21, 23, 25, 27) in the neighboring block to filter relative to the block boundary (1).</p></abstract><abstract mxw-id="PA100328139" ref-ucid="WO-2012118421-A1" lang="EN" source="national office" load-source="docdb"><p>A first filter decision value is calculated for a block (10) of pixels (11, 13, 15, 17) in a video frame based on pixel values of pixels (11, 13, 15) in a first line (12) of pixels (11, 13, 15, 17) in the block (10). A second filter decision value is also calculated for the block (10) based on pixel values of pixels (21, 23, 25, 27) in a corresponding first line (22) of pixels (21, 23, 25, 27) in a neighboring block (20) in the video frame. The first filter decision value is used to determine how many pixels in a line (12) of pixels (11, 13, 15, 17) in the block (10) to filter relative to a block boundary (1) between the block (10) and the neighboring block (20). The second filter decision value is used to determine how many pixels in a corresponding line (22) of pixels (21, 23, 25, 27) in the neighboring block to filter relative to the block boundary (1).</p></abstract><abstract mxw-id="PA99831316" ref-ucid="WO-2012118421-A1" lang="FR" load-source="patent-office"><p num="0000">Selon l'invention, une première valeur de décision de filtre est calculée pour un bloc (10) de pixels (11, 13, 15, 17) dans une image vidéo sur la base de valeurs de pixel de pixels (11, 13, 15) présents dans une première ligne (12) de pixels (11, 13, 15, 17) dans le bloc (10). Une seconde valeur de décision de filtre est également calculée pour le bloc (10) sur la base de valeurs de pixel de pixels (21, 23, 25, 27) présents dans une première ligne correspondante (22) de pixels (21, 23, 25, 27) dans un bloc voisin (20) dans l'image vidéo. La première valeur de décision de filtre est utilisée pour déterminer combien de pixels dans une ligne (12) de pixels (11, 13, 15, 17) dans le bloc (10) doivent être filtrés relativement à une frontière de bloc (1) entre le bloc (10) et le bloc voisin (20). La seconde valeur de décision de filtre est utilisée pour déterminer combien de pixels dans une ligne correspondante (22) de pixels (21, 23, 25, 27) dans le bloc voisin doivent être filtrés relativement à la frontière de bloc (1).</p></abstract><abstract mxw-id="PA100328140" ref-ucid="WO-2012118421-A1" lang="FR" source="national office" load-source="docdb"><p>Selon l'invention, une première valeur de décision de filtre est calculée pour un bloc (10) de pixels (11, 13, 15, 17) dans une image vidéo sur la base de valeurs de pixel de pixels (11, 13, 15) présents dans une première ligne (12) de pixels (11, 13, 15, 17) dans le bloc (10). Une seconde valeur de décision de filtre est également calculée pour le bloc (10) sur la base de valeurs de pixel de pixels (21, 23, 25, 27) présents dans une première ligne correspondante (22) de pixels (21, 23, 25, 27) dans un bloc voisin (20) dans l'image vidéo. La première valeur de décision de filtre est utilisée pour déterminer combien de pixels dans une ligne (12) de pixels (11, 13, 15, 17) dans le bloc (10) doivent être filtrés relativement à une frontière de bloc (1) entre le bloc (10) et le bloc voisin (20). La seconde valeur de décision de filtre est utilisée pour déterminer combien de pixels dans une ligne correspondante (22) de pixels (21, 23, 25, 27) dans le bloc voisin doivent être filtrés relativement à la frontière de bloc (1).</p></abstract><description mxw-id="PDES51232525" ref-ucid="WO-2012118421-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="3"/>--><p id="p0001" num="0001"> DEBLOCKING FILTERING CONTROL </p><p id="p0002" num="0002">TECHNICAL FIELD </p><p id="p0003" num="0003"> The present embodiments generally relate to filtering control and in particular to controlling deblocking filtering over block boundaries in a video frame. </p><p id="p0004" num="0004">BACKGROUND </p><p id="p0005" num="0005"> Deblocking filters are used in the video coding standards in order to combat blocking artifacts. The blocking artifacts arise because the original video frames are split into blocks which are processed relatively independently. The blocking artifacts can, for instance, arise due to different intra predictions of the blocks, quantization effects and motion compensation. Two particular variants of deblocking are described below. </p><p id="p0006" num="0006">In state of the art video coding, such as H.264, there is a deblocking filter, also denoted loop filter, after prediction and residual reconstruction, but before storage of the reconstruction for later reference when encoding or decoding the subsequent frames. The deblocking filtering consists of several steps such as filter decisions, filtering operations, a clipping function and changes of pixel values. The decision to filter the border or not is made based on evaluation of several conditions. Filter decisions depend on macroblock (MB) type, motion vector (MV) difference between neighboring blocks, whether neighboring blocks have coded residuals and on the local structure of the current and/or neighboring blocks. </p><p id="p0007" num="0007">Then the amount of filtering for a pixel depends, among others, on the position of that pixel relative to the block border or boundary and on the quantization parameter (QP) value used for residual coding. </p><p id="p0008" num="0008">The filter decision is based on comparing three pixel differences with thresholds. The thresholds are adapted to the quantization parameter (QP). For instance, assume a vertical block boundary of a b e d I e f g h where a, b c and d denote the pixel values of the pixels of a row of pixels in the current block and e, f, g and h denote the corresponding pixel values of the pixels of a corresponding row of pixels in the neighboring block. If the following conditions are fulfilled the filter decision is positive, e.g. abs(d- e)&lt;thr1 , abs(c-d)&lt;thr2, and abs(e-f)&lt;thr2, where thrl and thr2 are adapted based on QP. 
<!-- EPO <DP n="4"/>-->
 There are two filtering modes in H.264. In the first filtering mode, referred to as normal filtering, filtering can be described with a delta value with which filtering changes the current value. The filtering for the pixels closest to the block boundary is d' = d + delta and e' = e - delta, where delta has been clipped off to a threshold ±thr3 to a value that is constrained by the QP. More filtering is thereby allowed for high QP than for low QP. Clipping can be described as delta_clipped = max(-thr3, min(thr3, delta)), where thr3 is controlling the filter strength. A larger value of thr3 means that the filtering is stronger which means that a stronger low-pass filtering effect will happen. The filter strength can be increased if any of the following two conditions also holds, e.g. abs(b-d)&lt;thr2 and abs(e-g)&lt;thr2. The filter strength is adapted by clipping the delta less, e.g. allow for more variation. </p><p id="p0009" num="0009">The second filtering mode, referred to as strong filtering, is applied for intra macroblock boundaries only, when the following condition is fulfilled abs(d-e)&lt; thr1/4. </p><p id="p0010" num="0010">For more information of deblocking filtering in H.264 reference is made to List et al., Adaptive Deblocking Filter, IEEE Transactions on Circuits and Systems for Video Technology, vol. 13, no. 7, July 2003. In the draft HEVC (High Efficiency Video Coding) specification "Test Model under Consideration", ITU- T SG16 WP3 document, JCTVC-B205, Chapter 6.5 ln-loop filter process, the deblocking filter works differently from H.264. The filtering is performed if at least one of the blocks on the side of the boundary is intra, or has non-zero coefficients, or the difference between the motion vector components of the blocks is greater or equal to one integer pixel. For example, when filtering the border between the blocks with a vertical block boundary of p3i p2i p1 i p0i | q0i q1 i q2i q3i with pji denoting the pixel value of pixel number j of row number / in the current block and qji denoting the pixel value of pixel number j of row number / in the neighboring block, i=0...7, j=0...3, then the following condition should also be satisfied: ci = |p2<sub>2</sub> - 2xp1<sub>2</sub> + p0<sub>2</sub>| + |q2<sub>2</sub> - 2xq1<sub>2</sub> + q0<sub>2</sub>| + |p2<sub>5</sub> - 2xp1<sub>5</sub> + p0<sub>5</sub>| + |q2<sub>5</sub> - 2xq1<sub>5</sub> + q0<sub>5</sub>|&lt; 
<!-- EPO <DP n="5"/>-->
 where β depends on QP. In the above mentioned HEVC specification, there is a table of β, where β increases with QP. If the conditions are fulfilled and filtering is done between the current block and the neighboring block, one of two types of filtering is performed, referred to as weak and strong filtering, respectively. The choice between the strong and the weak filtering is done separately for each line depending on the following conditions. For each line i=0...7, the strong filtering is performed if all the following conditions are true, otherwise, weak filtering is performed: d &lt; (β»2) </p><p id="p0011" num="0011"> (Ip3i - p0i| + |q0i - q3i|) &lt; $»3) </p><p id="p0012" num="0012">|p0i - q0i| &lt; ((5xtc + 1 )»1 ) where tc and β depend on QP and » denotes a right shift operator. </p><p id="p0013" num="0013">Weak filtering is performed based on the above conditions. The actual filtering works by computing an offset (Δ), adding it to the original pixel value and clip the sum to a filtered output pixel value in the range of 0-255: </p><p id="p0014" num="0014">Δ = Clip(-tc,tc, (13x(q0i - pOi) + 4x(q1 i - p1 i) - 5x(q2 - p2i)+16)»5)) </p><p id="p0015" num="0015">pOi = Clipo-255(pOi + Δ) </p><p id="p0016" num="0016">qOi = Clipo-255(qOi - Δ) </p><p id="p0017" num="0017">p1 i = Clipo-255(p1 i + A/2) </p><p id="p0018" num="0018">q1 i = Clip<sub>0</sub>-255(q1i - Δ/2) where the clip function Clip(A, B, x) is defined as Clip(A, B, x)=A if x&lt;A, Clip(A, B, x)=B if x&gt;B and Clip(A, B, x)=x if A≤x≤B and Clipo-25s(x) is defined as Clip(0, 255, x). Strong filtering mode is performed by the following set of operations: p0i=Clip<sub>0</sub>-255((p2i + 2xp1 i + 2xp0i +2xq0i + q1 i + 4)»3) 
<!-- EPO <DP n="6"/>-->
 q0i=Clip<sub>0</sub>-255((p1i + 2xp0i + 2xq0i + 2xq1i + q2 + 4)»3) </p><p id="p0019" num="0019">p1 i=Clipo-25<sub>5</sub>((p2i + p1 i + pOi + qOi +2)»2) </p><p id="p0020" num="0020">q1i=Clip<sub>0</sub>-255((p0i + qOi + q1i + q2i +2)»2) </p><p id="p0021" num="0021">p2i=Clip<sub>0</sub>-255((2xp3i + 3xp2i + p1i + pOi + qOi + 4)»3) </p><p id="p0022" num="0022">q2i=Clip<sub>0</sub>-255((p0i + qOi + q1i + 3xq2i + 2xq3i + 4)»3) </p><p id="p0023" num="0023">Deblocking filtering decisions according to HEVC can lead to inaccurate deblocking filtering over block boundaries for certain blocks. In particular neighboring blocks having different levels of local structures could be handled incorrectly in HEVC by filtering one of the blocks too much to thereby represses and filter away local structures in the block. </p><p id="p0024" num="0024">SUMMARY </p><p id="p0025" num="0025"> Hence, there is a need for an efficient deblocking filtering control that can be used to reduce blocking artifacts at block boundaries and that does not have the above mentioned drawbacks. </p><p id="p0026" num="0026">It is a general objective to provide an efficient deblocking filtering control. </p><p id="p0027" num="0027">It is a particular objective to provide asymmetric filtering decisions over a block boundary. An aspect of the embodiments relates to a method for filtering control applicable to a block of multiple pixels in a video frame, where each pixel has a respective pixel value. The method comprises calculating a first filter decision value for the block based at least on 
<img id="imgf000006_0001" he="6" wi="8" file="imgf000006_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2 ?l<sub>z</sub>- + pO<sub>j</sub> \ , wherein pOi denotes a pixel value of a pixel closest to, in a first line of pixels in the block, a block boundary to a neighboring block of multiple pixels in the video frame, p denotes a pixel value of a pixel next closest to, in the first line of pixels, the block boundary and p2<sub>t</sub> denotes a pixel value of a pixel second next closest to, in the first line of pixels, the block boundary. The method also comprises calculating a second filter decision value for the block based at least on
<img id="imgf000006_0002" he="6" wi="7" file="imgf000006_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2 l<sub>;</sub> + qO<sub>j</sub> | , wherein qO<sub>t</sub> denotes a pixel value of a pixel in the neighboring block closest to, in a corresponding first line of pixels in the neighboring block, the block boundary, q\<sub>t</sub> denotes a pixel value of a pixel of the neighboring block next closest to, in the corresponding first line of pixels, the block boundary and q2<sub>t</sub> denotes a pixel value of a pixel in the neighboring block second next closest to, in the corresponding first line of pixels, the block boundary. The first filter decision value is used to determine how many pixels in a line of 
<!-- EPO <DP n="7"/>-->
 pixels in the block to filter relative to the block boundary and the second filter decision value is correspondingly used to determine how many pixels in a corresponding line of pixels in the neighboring block to filter relative to the block boundary. Another aspect of the embodiments defines a filtering control device comprising a first decision value calculator configured to calculate a first filter decision value for a block of multiple pixels in a video frame based at least on
<img id="imgf000007_0001" he="6" wi="8" file="imgf000007_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2 ?l<sub>z</sub>- + pO<sub>j</sub> \ , wherein pO<sub>t</sub> denotes a pixel value of a pixel closest to, in a first line of pixels in the block, a block boundary to a neighboring block of multiple pixels in the video frame, p denotes a pixel value of a pixel next closest to, in the first line of pixels, the block boundary and p2<sub>t</sub> denotes a pixel value of a pixel second next closest to, in the first line of pixels, the block boundary. The filtering control device also comprises a second decision value calculator config ured to calculate a second fi lter decision val ue for the block based at least on - 2ql<sub>j</sub> + qO<sub>j</sub> | , wherein qO<sub>t</sub> denotes a pixel value of a pixel in the neighboring block closest to, in a corresponding first line of pixels in the neighboring block, the block boundary, q\<sub>t</sub> denotes a pixel value of a pixel of the neighboring block next closest to, in the corresponding first line of pixels, the block boundary and q2<sub>t</sub> denotes a pixel value of a pixel in the neighboring block second next closest to, in the corresponding first line of pixels, the block boundary. A first pixel determiner is configured to determine how many pixels in a line of pixels in the block to filter relative to the block boundary based on the first filter decision value calculated by the first decision value calculator. The filtering control device further comprises a second pixel determiner configured to determine how many pixels in a corresponding line of pixels in the neighboring block to filter relative to the block boundary based on the second filter decision value calculated by the second decision value calculator. </p><p id="p0028" num="0028">Further aspects of the embodiments relate to an encoder comprising a filtering control device as defined above and a decoder comprising a filtering control device as defined above. Yet another aspect defines a user equipment comprising a memory configured to store video frames and an encoder with a filtering control device as defined above to encode the video frames into encoded video frames, which are stored in the memory. A further aspect defines a user equipment comprising a memory configured to store encoded video frames and a decoder with a filtering control device as defined above to decode the encoded video frames into decoded video frames. A media player of the user equipment is configured to render the decoded video frames into video data displayable on a display. 
<!-- EPO <DP n="8"/>-->
 Yet another aspect relates to a computer program for filtering control of a block of multiple pixels in a video frame, where each pixel has a respective pixel value. The computer program comprises code means which when run on a computer causes the computer to calculate a first filter decision value for the block based at least on
<img id="imgf000008_0001" he="6" wi="8" file="imgf000008_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2 ?l<sub>z</sub>- + pO<sub>j</sub> \ , wherein pO<sub>t</sub> denotes a pixel value of a pixel closest to, in a first line of pixels in the block, a block boundary to a neighboring block of multiple pixels in the video frame, p denotes a pixel value of a pixel next closest to, in the first line of pixels, the block boundary and p2<sub>t</sub> denotes a pixel value of a pixel second next closest to, in the first line of pixels, the block boundary. The computer also comprises code means which causes the computer to calculate a second filter decision value for the block based at least on
<img id="imgf000008_0002" he="6" wi="7" file="imgf000008_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2 l<sub>;</sub> + qO<sub>j</sub> | , wherein qO<sub>t</sub> denotes a pixel value of a pixel in the neighboring block closest to, in a corresponding first line of pixels in the neighboring block, the block boundary, q\<sub>t</sub> denotes a pixel value of a pixel of the neighboring block next closest to, in the corresponding first line of pixels, the block boundary and ql<sub>t</sub> denotes a pixel value of a pixel in the neighboring block second next closest to, in the corresponding first line of pixels, the block boundary. The computer program comprises code means which causes the computer to determine how many pixels in a line of pixels in the block to filter relative to the block boundary based on the first filter decision value and determine how many pixels in a corresponding line of pixels in the neighboring block to filter relative to the block boundary based on the second filter decision value. </p><p id="p0029" num="0029">The embodiments achieve asymmetric deblocking decisions that control deblocking filtering to be adaptive to the structure on each side of a block boundary. The asymmetric decisions means that the amount of filtering applied to one side of the block boundary can differ from the amount of filtering applied to the other side of the block boundary, thus providing additional adaptation to the local structure. This improves the objective and subjective video quality. BRIEF DESCRIPTION OF THE DRAWINGS </p><p id="p0030" num="0030"> The invention, together with further objects and advantages thereof, may best be understood by making reference to the following description taken together with the accompanying drawings, in which: </p><p id="p0031" num="0031">Fig. 1 is a flow diagram of a method for filtering control according to an embodiment; </p><p id="p0032" num="0032">Figs. 2A and 2B illustrate two embodiments of neighboring blocks and a block boundary over which deblocking filtering can be applied; 
<!-- EPO <DP n="9"/>-->
 Fig. 3 is a flow diagram illustrating additional, optional steps of the method in Fig. 1 according to an embodiment; </p><p id="p0033" num="0033">Fig. 4 is a flow diagram illustrating an embodiment of the determining steps in Fig. 1 ; </p><p id="p0034" num="0034">Fig. 5 is a flow diagram illustrating additional, optional steps of the method in Fig. 1 according to another embodiment; </p><p id="p0035" num="0035">Fig. 6 is a flow diagram illustrating additional, optional steps of the method in Fig. 1 and an embodiment of the determining steps in Fig. 1 ; </p><p id="p0036" num="0036">Fig. 7 is a flow diagram illustrating an additional, optional step of the method in Fig. 1 according to an embodiment; Fig. 8 is a schematic block diagram of an embodiment of a filtering control device; Fig. 9 is a schematic block diagram of another embodiment of a filtering control device; Fig. 10 is a schematic block diagram of a further embodiment of a filtering control device; </p><p id="p0037" num="0037">Fig. 11 is a schematic block diagram of yet another embodiment of a filtering control device; </p><p id="p0038" num="0038">Fig. 12 is a schematic block diagram of a software implementation of a filtering control device in a computer according to an embodiment; </p><p id="p0039" num="0039">Fig. 13 is a schematic block diagram of an encoder according to an embodiment; Fig. 14 is a schematic block diagram of a decoder according to an embodiment; Fig. 15 is a schematic block diagram of a user equipment according to an embodiment; </p><p id="p0040" num="0040">Fig. 16 is a schematic block diagram of a user equipment according to another embodiment; and 
<!-- EPO <DP n="10"/>-->
 Fig. 17 is a schematic overview of a portion of a communication network comprising a network device according to an embodiment. </p><p id="p0041" num="0041">DETAILED DESCRIPTION </p><p id="p0042" num="0042">Throughout the drawings, the same reference numbers are used for similar or corresponding elements. </p><p id="p0043" num="0043">The embodiments generally relate to filtering control and controlling deblocking filtering over block boundaries in a video frame. The filtering control of the embodiments provides asymmetric deblocking decisions with regard to block boundaries by making independent filtering decisions for the blocks of pixels separated by a block boundary. This means that the deblocking filtering can handle neighboring blocks having different levels of local structures to thereby adapt the particular deblocking filtering at each block based on its local structures. </p><p id="p0044" num="0044">As is well-known in the art, a video frame is divided into non-overlapping blocks of pixels that are encoded and decoded according to the various available intra and inter coding modes. Generally, a video frame is divided into non-overlapping macroblocks of 16x16 pixels. Such a macroblock can in turn be divided into smaller blocks of different sizes, such as 4x4 or 8x8 pixels. However, also rectangular blocks are possible according to the embodiments, such as, 4x8, 8x4, 8x16 or 16x8. The embodiments can be applied to any such block of pixels, including macroblocks or even larger blocks of pixels. </p><p id="p0045" num="0045">In the emerging High Efficiency Video Coding (HEVC) standard, coding units (CU), prediction units (PU) and transform units (TU) are used. The prediction units are defined inside a coding unit and contain the intra or inter prediction modes. Transform units are defined inside a coding unit and the largest transform size is 32x32 pixels and the smallest size is 4x4 pixels. The CU size is currently varying from 64x64 pixels (largest) to 8x8 pixels (smallest). In this way, the largest CU can be split into smaller CUs with the "level of granularity" depending on the local characteristics of the frame. That means that the largest CU may be split into smaller CUs of different sizes. The embodiments can also be used in connection with such coding units, which are regarded as being encompassed by the expression "block of pixels" as used herein. </p><p id="p0046" num="0046">Each pixel in the block has a respective pixel value. Video frames generally have color values assigned to the pixels, where the color values are represented in a defined color formats. One of the 
<!-- EPO <DP n="11"/>-->
 common color formats uses one luminance component and two chrominance components for each pixel, although other formats exist, such as using red, green and blue components for each pixel. </p><p id="p0047" num="0047">Traditionally, luminance component filtering and chrominance component filtering are done separately, possibly employing different filtering decisions and different deblocking filters. It is, though, possible that the luminance filtering decisions are used in chroma filtering, like in H.264. The embodiments can be applied to filtering control for the luminance component, the chrominance component or both the luminance component and the chrominance component. In a particular embodiment, the embodiments are applied to control luminance or luma filtering. Filtering decisions, or parts of filtering decisions for one component, such as luma, can be then used when making the filtering decisions for other components, such as chroma. </p><p id="p0048" num="0048">Deblocking filtering is conducted over a boundary, edge or border between neighboring blocks. As a consequence, such boundaries can be vertical boundaries 1 , see Fig. 2A, between two neighboring blocks 10, 20 present side by side in the video frame. Alternatively, the boundaries are horizontal boundaries 1 , see Fig. 2B, between two neighboring block 10, 20, where one block 10 is positioned above the other block 20 in the video frame. In a particular embodiment, vertical boundaries are filtered first starting from the left-most boundary and proceeding through the boundaries towards the right-hand side in their geometrical order. Then, horizontal boundaries are filtered starting with the boundary on the top and proceeding through the boundaries towards the bottom in their geometrical order. The embodiments are, however, not limited to this particular filtering order and can actually be applied to any predefined filtering order. In a particular embodiment, the boundaries at the edge of the video frame are preferably not filtered and thereby excluded from the deblocking filtering. Fig. 1 is a flow diagram of a method for filtering control applicable to a block of multiple pixels in a video frame according to an embodiment. The method of Fig. 1 generally starts in step S1 where a first filter decision value is calculated for the block based at least on |^2<sub>;</sub> - 2pl<sub>j</sub> + pO<sub>j</sub> | , wherein pO<sub>t</sub> denotes a pixel value of a pixel 11 closest to, in a first line of pixels 1 1 , 13, 15, 17 in the block 10, a block boundary 1 to a neighboring block 20 of multiple pixels 21 , 23, 25, 27 in the video frame, pl<sub>j</sub> denotes a pixel value of a pixel 13 next closest to, in the first line 12 of pixels 11 , 13, 15, 17, the block boundary 1 and p2<sub>j</sub> denotes a pixel value of a pixel 15 second next closest to, in the first line 12 of pixels 11 ,</p><p id="p0049" num="0049">13, 15, 17, the block boundary 10. 
<!-- EPO <DP n="12"/>-->
 Step S2 correspondingly calculates a second filter decision value for the block based at least on - 2ql<sub>j</sub> + qO<sub>j</sub> \ , wherein qO<sub>j</sub> denotes a pixel value of a pixel 21 in the neighboring block 20 closest to, in a corresponding first line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20, the block boundary 1 , q\<sub>t</sub> denotes a pixel value of a pixel 23 of the neighboring block 20 next closest to, in the</p><p id="p0050" num="0050">5 corresponding first line 22 of pixels 21 , 23, 25, 27, the block boundary 1 and q2<sub>t</sub> denotes a pixel value of a pixel 25 in the neighboring block 20 second next closest to, in the corresponding first line 22 of pixels 21 , 23, 25, 27, the block boundary 1. </p><p id="p0051" num="0051">The first line 12 of pixels 1 1 , 13, 15, 17 in the block 10 and the corresponding first line 22 of pixels 21 , 10 23, 25, 27 in the neighboring block 20 belong to the same horizontal line of pixels, i.e. row of pixels, extending over a vertical boundary 1 , see Fig. 2A, or belong to the same vertical line of pixels, i.e. column of pixels, extending over a horizontal boundary 1 , see Fig. 2B. Hence, the first line 12 of pixels 1 1 , 13, 15, 17 and the corresponding first line 22 of pixels 21 , 23, 25, 27 are perpendicular to the block boundary 1 between the block 10 and the neighboring block 20. Furthermore, the first line 12 of pixels 15 1 1 , 1 3, 15, 17 in the block 1 0 and the corresponding first line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 have the same line number. For instance, if the block 10 and the neighboring block 20 each comprises N, such as eight, rows or columns of pixels, having row or column numbers i=0...N-1 then the first line 10 of pixels 1 1 , 13, 15, 17 has line number i in the block 10 and the corresponding first line 20 of pixels 21 , 23, 25, 27 also has line number i but in the neighboring block 20 20. Thus, first line 12 of pixels 1 1 , 13, 15, 17 in the block and the corresponding first line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 are opposing lines with regard to the block boundary 1. </p><p id="p0052" num="0052">According to the embodiments, "line of pixels" and "corresponding line of pixels" are employed to denote a "row of pixels" and a "corresponding row of pixels" in the case of a vertical block boundary as 25 in Fig. 2A and denote a "column of pixels" and a "corresponding column of pixels" in the case of a horizontal block boundary as in Fig. 2B. </p><p id="p0053" num="0053">The first line 12 of pixels 1 1 , 13, 15, 17 and the corresponding first line 22 of pixels 21 , 23, 25, 27 could be predefined lines in the block 10 and the neighboring block 20, respectively. Thus, the first line 12 of 30 pixels 1 1 , 13, 15, 17 and the corresponding line 22 of pixels 21 , 23, 25, 27 have a predefined and fixed line number i with regard to each block boundary 1 for which a filtering control is applied. Alternatively, the first line 12 of pixels 1 1 , 13, 15, 17 and the corresponding first line 22 of pixels 21 , 23, 25, 27 could 
<!-- EPO <DP n="13"/>-->
 represent a current line and a current corresponding line, respectively, which is further discussed herein. </p><p id="p0054" num="0054">The calculation of the first filter decision value in step S1 and the calculation of the second filter decision value in step S2 can be performed serially in any order, i.e. step S1 preceding step S2 or step S2 preceding step S1 , or at least partly in parallel. The results of these two steps S1 , S2 is, thus, a first filter decision value that is calculated based on pixel values in the block 10 and a second filter decision value that is calculated based on pixel values in the neighboring block 20 on the other side of the block boundary 1 relative to the block 10. More preferably, the calculation of the first decision value is performed only based on pixel values in the block 10 and therefore not based on any pixel values in the neighboring block 20. Correspondingly, the second filter decision value is preferably calculated based only on pixel values in the neighboring block 20 and not based on any pixel values in the block 10. The first filter decision value calculated in step S1 is then used in step S3 to determine how many pixels in a line 12 of pixels 11 , 13, 15, 17 in the block 10 to filter relative to the block boundary 1. The second filter decision value is correspondingly used in step S4 to determine how many pixels in a corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 to filter relative to the block boundary 1. Thus, separate filter decision values are calculated for each side or part of a row or column of pixels extending over the block boundary 1 and a respective filter decision is taken for each side or part based on the particular filter decision value calculated for that side or part. </p><p id="p0055" num="0055">This should be compared to the prior art where a single or a set of filter decision values is calculated for a line of pixels and the corresponding line of pixels and where this filter decision value or set of filter decision values is used to decide how many pixels to filter on both sides of the block boundary. Thus, in the prior art the same number of pixels is always filtered for the corresponding line of pixels in the neighboring block as is done for the matching line of pixels in the block. </p><p id="p0056" num="0056">The present embodiments instead enable an asymmetric filtering control and deblocking filtering by making a separate filter decision for the line 12 of pixels 1 1 , 13, 15, 17 in the block 10 and another, different filter decision for the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20. This means that based on the particular first and second filter decision values different or the same number of pixels in the line 12 of pixels 11 , 13, 15, 17 could be selected for deblocking filtering and 
<!-- EPO <DP n="14"/>-->
 modification as the number of pixels in the corresponding line 22 of pixels 21 , 23, 25, 27 that are selected for deblocking filtering and modification. </p><p id="p0057" num="0057">Generally, herein pX<sub>y</sub> denotes the pixel value of pixel number X relative to the block boundary 1 in a line of pixels having line number y in the block 10. Correspondingly, qX<sub>y</sub> denotes the pixel value of pixel number X relative to block boundary 1 in a corresponding line of pixels having line number y in the neighboring block 20. </p><p id="p0058" num="0058">Steps S3 and S4 can be performed serially in any order or indeed at least partly in parallel. </p><p id="p0059" num="0059">In a first embodiment, steps S1 and S2 could be performed once for a given block boundary 1 between the block 10 and the neighboring block 20 to thereby calculate a first filter decision value and a second filter decision value that applies to all lines 12 of pixels 1 1 , 13, 15, 17 in the block 10 and to all corresponding lines 22 of pixels 21 , 23, 25, 27 in the neighboring block 20, respectively. In such approach the same first number of pixels are preferably filtered and modified in each line 12 of pixels 11 , 13, 15, 17 in the block 10 with regard to the block boundary 1 , where this first number is determined based on the first filter decision value calculated in step S1. Correspondingly, the same second number of pixels are preferably filtered and modified in each corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 with regard to the block boundary 1 , where this second number is determined based on the second filter decision value calculated in step S2. </p><p id="p0060" num="0060">Alternatively, in a second embodiment the first filter decision value and the second filter decision value applies to a subset of the lines 12 of pixels 11 , 13, 15, 17 in the block 10 and to a corresponding subset of the corresponding lines 22 of pixels 21 , 23, 25, 27 in the neighboring block 20. For instance, a pair of filter decision values could be used for the first four lines 12 of pixels 11 , 13, 15, 17 in the block and the first four corresponding lines 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 and with another pair of filter decision values used for the remaining four lines 12 of pixels 11 , 13, 15, 17 in the block and the remaining four corresponding lines 22 of pixels 21 , 23, 25, 27 in the neighboring block 20. In a third embodiment the calculation in step S1 is performed for each line 12 of pixels 11 , 13, 15, 17 in the block 10 and a separate determination in step S3 is then performed for each such line 12 of pixels 1 1 , 13, 15, 17. In such a case, the calculation in step S2 is correspondingly performed for each 
<!-- EPO <DP n="15"/>-->
 corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 and a separate determination in step S4 is performed for each such corresponding line 22 of pixels 21 , 23, 25, 27. </p><p id="p0061" num="0061">Thus, in the third embodiment step S3 comprises determining how many pixels in the first line 12 of pixels 1 1 , 13, 15, 17 in the block 10 to filter relative to the block boundary 1 based on the first filter decision value calculated in step S1 . Step S4 comprises determining how many pixels in the corresponding first line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 to filter relative to the block boundary 1 based on the second filter decision value calculated in step S2. The following part describes how the third embodiment is applied separately for each line (row or column) crossing the block boundary 1. In this example the first filter decision value is defined as d<sub>pi</sub> : = a n d t h e s e c o n d f i l te r d e c i s i o n v a l u e i s d e f i n e d a s d<sub>qi</sub> =
<img id="imgf000015_0001" he="17" wi="32" file="imgf000015_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 The method then comprises: · Calculate d<sub>pi</sub> , calculate d<sub>qi</sub> for each line i crossing the block boundary. </p><p id="p0062" num="0062">• if dpi &lt; thr\ </p><p id="p0063" num="0063"> o do normal filtering of line i of current block 10, e.g. filter and modify two pixels from the block border or boundary; </p><p id="p0064" num="0064"> • else, i.e. if d<sub>pi</sub>≥ thr\ </p><p id="p0065" num="0065"> o do not filter the second pixel from the block border or boundary of line i of the current block 10 or do not filter any pixels at all on line i of the current block 10;</p><p id="p0066" num="0066">• if d<sub>qi</sub> &lt; thr2 </p><p id="p0067" num="0067"> o do normal filtering of line i of neighboring block 20, e.g. filter and modify two pixels from the block border or boundary 1 ; </p><p id="p0068" num="0068"> · else, i.e. if d<sub>qi</sub>≥ thr2 </p><p id="p0069" num="0069"> o do not filter the second pixel from the block border or boundary 1 of line i of the neighboring block 20 or do not filter any pixels at all on line i of the neighboring block 20. As is illustrated by the example above, the third embodiment of the method in Fig. 1 can calculate separate first and second filter decision values and therefore make separate determinations of how many pixels to filter for each row or column in the block 10 and the neighboring block 20 relative to the 
<!-- EPO <DP n="16"/>-->
 block boundary 1. Thus, in this third embodiment the first and second filter decision values are line- specific filter decision values, i.e. calculated for each line 12 of pixels 11 , 13, 15, 17 in the block 10 and for each corresponding line 22 of pixels 21, 23, 25, 27 in the neighboring block 20. In the first embodiment, block-specific filter decision values are used. Thus, in such a case a single first filter decision value could be calculated for the block 10 relative to the block boundary 1 and apply to all lines 12 of pixels 11, 13, 15, 17 in the block 10 with regard to the particular block boundary 1. Correspondingly a single second filter decision value is calculated for the neighboring block 20 relative to the block boundary 1 and applies to all corresponding lines 22 of pixels 21, 23, 25, 27 in the neighboring block 20 with regard to the particular block boundary 1. </p><p id="p0070" num="0070">A first example of this first embodiment involves calculating a first filter decision value as 
<img id="imgf000016_0001" he="6" wi="73" file="imgf000016_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 wherein p0<sub>2</sub> denotes the pixel value of the pixel closest to, in the first line of pixels, the block boundary 1 , p\ denotes the pixel value of the pixel next closest to, in the first line of pixels, the block boundary 1, p2 denotes the pixel value of the pixel second next closest to, in the first line of pixels, the block boundary 1, p0<sub>5</sub> denotes a pixel value of a pixel closest to, in a second line of pixels in the block 10, the block boundary 1, pl<sub>5</sub> denotes a pixel value of a pixel next closest to, in the second line of pixels, the block boundary 1 and p2<sub>5</sub> denotes a pixel value of a pixel second next closest to, in the second line of pixels, the block boundary 1. </p><p id="p0071" num="0071">The second filter decision value is then preferably calculated as \q2<sub>2</sub> -2ql<sub>2</sub> + q0<sub>2</sub>1 + \q2<sub>5</sub> - 2ql<sub>5</sub> + q0<sub>5</sub>1 , wherein q0<sub>2</sub> denotes the pixel value of the pixel in the neighboring block 20 closest to, in the corresponding first line of pixels, the block boundary 1, q\<sub>2</sub> denotes the pixel value of the pixel of the neighboring block 20 next closest to, in the corresponding first line of pixels, the block boundary 1, q2<sub>2</sub> denotes the pixel value of the pixel in the neighboring block 20 second next closest to, in the corresponding first line of pixels, the block boundary 1, q0<sub>5</sub> denotes a pixel value of a pixel in the neighboring block 20 closest to, in a corresponding second line of pixels in the neighboring block 20, the block boundary 1, ql<sub>5</sub> denotes a pixel value of a pixel of the neighboring block 20 next closest to, in the corresponding second line of pixels, the block boundary 1 and q2<sub>5</sub> denotes a pixel value of a pixel in the neighboring block 20 second next closest to, in the corresponding second line of pixels, the block boundary 1. 
<!-- EPO <DP n="17"/>-->
 The first filter decision value is then used for all lines 12 of pixels 1 1 , 13, 15, 17 in the block 10 when determining how many pixels to filter and the second filter decision value is used for all corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 when determining how many pixels to filter. In this first example of the first embodiment, the first line of pixels corresponds to line i=2 and the corresponding first line corresponds to corresponding line i=2 and the second line of pixels corresponds to line i=5 and the second corresponding line corresponds to corresponding line i=5. In this case the block 10 preferably comprises eight lines and the neighboring block 20 preferably also comprises eight lines, i.e. i=0-7. </p><p id="p0072" num="0072">The following part illustrates an implementation example of the first embodiment. In this implementation example the first filter decision value is defined as d<sub>p</sub> = \p2<sub>2</sub> - 2pl<sub>2</sub> + p <sub>2</sub> \ + \p2<sub>5</sub> - 2pl<sub>5</sub> + p0<sub>5</sub> \ and the second filter decision value is defined as d<sub>q</sub> = \q2<sub>2</sub> - 2q\ + q0<sub>2</sub>1 + \q2<sub>5</sub> - 2ql<sub>5</sub> + q0<sub>5</sub>1. · Calculate d<sub>p</sub> , calculate d<sub>q</sub> ; </p><p id="p0073" num="0073">• if d<sub>p</sub> &lt; thrl </p><p id="p0074" num="0074"> o do normal filtering of current block 10, e.g. filter and modify two pixels from the block border or boundary 1 ; </p><p id="p0075" num="0075"> • else, i.e. if d<sub>p</sub>≥ thrl </p><p id="p0076" num="0076"> o do not filter the second pixel from the block border or boundary 1 or do not filter any pixels at all; </p><p id="p0077" num="0077"> • if d<sub>q</sub> &lt; thr2 </p><p id="p0078" num="0078"> o do normal filtering of neighboring block 20, e.g. filter and modify two pixels from the block border or boundary 1 ; </p><p id="p0079" num="0079"> · else, i.e. if d<sub>q</sub>≥ thr2 </p><p id="p0080" num="0080"> o do not filter the second pixel from the block border or boundary 1 or do not filter any pixels at all. </p><p id="p0081" num="0081">In a second example of the first embodiment the first filter decision value is calculated as a block- specific filter decision value based on pixel values in line i=3 and line i=4 instead of line i=2 and line i=5. The corresponding lines i=3 and i=4 in the neighboring block 20 are preferably then used for calculating the second filter decision value. The first filter decision value could then be calculated as 
<!-- EPO <DP n="18"/>-->
 + p0<sub>4</sub> \ and the second filter decision value is calculated as 
<img id="imgf000018_0001" he="16" wi="58" file="imgf000018_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 q0<sub>4</sub>1 , wherein p0<sub>3</sub> denotes the pixel value of the pixel closest to, in the first line of pixels, the block boundary 1 , p\<sub>3</sub> denotes the pixel value of the pixel next closest to, in the first line of pixels, the block boundary 1, p2 denotes the pixel value of the pixel second next closest to, in the first line of pixels, the block boundary 1 , p0<sub>4</sub> denotes a pixel value of a pixel closest to, in a second line of pixels in the block 10, the block boundary 1 , pl<sub>4</sub> denotes a pixel value of a pixel next closest to, in the second line of pixels, the block boundary 1 and p2<sub>4</sub> denotes a pixel value of a pixel second next closest to, in the second line of pixels, the block boundary 1 and q0<sub>3</sub> denotes the pixel value of the pixel in the neighboring block 20 closest to, in the corresponding first line of pixels, the block boundary 1 , ql denotes the pixel value of the pixel of the neighboring block 20 next closest to, in the corresponding first line of pixels, the block boundary 1 , q2<sub>3</sub> denotes the pixel value of the pixel in the neighboring block 20 second next closest to, in the corresponding first line of pixels, the block boundary 1 , q0<sub>4</sub> denotes a pixel value of a pixel in the neighboring block 20 closest to, in a corresponding second line of pixels in the neighboring block 20, the block boundary 1 , ql<sub>4</sub> denotes a pixel value of a pixel of the neighboring block 20 next closest to, in the corresponding second line of pixels, the block boundary 1 and q2<sub>4</sub> denotes a pixel value of a pixel in the neighboring block 20 second next closest to, in the corresponding second line of pixels, the block boundary 1. </p><p id="p0082" num="0082">In the second embodiment a first filter decision value and a second filter decision value are calculated for a group of four lines of pixels and four corresponding lines of pixels. This second embodiment can be suitable if the block and the neighboring block each have a size of 4x4 pixels. In addition, the second embodiment could also be used for larger blocks of pixels, such as 8x8 pixels. In the latter case, a pair of filter decisions is calculated for the first four lines pixels and first four corresponding lines of pixels and another pair of filter decisions is calculated for the remaining four lines of pixels and the remaining four corresponding lines of pixels. </p><p id="p0083" num="0083">A fi rst examp le of the seco n d embodiment calculates the first filter decision value as </p><p id="p0084" num="0084"> - 2p\<sub>3</sub> + p0<sub>3</sub> \ a n d t h e s e co n d fi l te r d e c i s i o n v a l u e as 
<img id="imgf000018_0002" he="16" wi="46" file="imgf000018_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 2q\<sub>3</sub> + ¾r0<sub>3</sub>1. In such a case, the line of pixels and the corresponding line of pixels could run from line number i=0 to line number i=3. For larger blocks of pixels, such as i=0- 7 as shown in Figs. 2A and 2B, the first pair of a first filter decision value and a second filter decision 
<!-- EPO <DP n="19"/>-->
 val ue i s cal cu l ated as 
<img id="imgf000019_0001" he="6" wi="71" file="imgf000019_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 and 
<img id="imgf000019_0002" he="6" wi="44" file="imgf000019_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2q\<sub>3</sub> + q0<sub>3</sub> \ . This first pair of filter decision values is applicable to the first four lines of pixels and first four corresponding line of pixels, i.e. i=0-3. The second pair of a first filter decision value and a second filter decision value is then calculated as 
<img id="imgf000019_0003" he="6" wi="152" file="imgf000019_0003.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 The second pair of filter decision values is then applicable to the four last line of pixels and the four last corresponding line of pixels, i.e. i=4-7. </p><p id="p0085" num="0085">A second example of the second embodiment calculates the first filter decision value as and the second filter decision value as 
<img id="imgf000019_0004" he="16" wi="70" file="imgf000019_0004.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 In such a case, the line of pixels and the corresponding line of pixels could run from line number i=0 to line number i=3. For larger blocks of pixels, such as i=0- 7 as shown in Figs.2A and 2B, the first pair of a first filter decision value and a second filter decision val u e i s c al c u lated as 
<img id="imgf000019_0005" he="6" wi="70" file="imgf000019_0005.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 and 
<img id="imgf000019_0006" he="6" wi="68" file="imgf000019_0006.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 This first pair of filter decision values is applicable to the first four lines of pixels and first four corresponding line of pixels, i.e. i=0-3. The second pair of a first filter decision value and a second filter decision value is then calculated as</p><p id="p0086" num="0086">\p2<sub>5</sub> - 2pl<sub>5</sub>
<img id="imgf000019_0007" he="6" wi="93" file="imgf000019_0007.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 + \<sub>P</sub>2<sub>6</sub> - 2pl<sub>6</sub> + p0<sub>6</sub>1 and \q2<sub>5</sub> - 2ql<sub>5</sub> + \q2<sub>6</sub> - 2ql<sub>6</sub> + 0<sub>6</sub>|. The second pair of filter decision values is then applicable to the four last line of pixels and the four last corresponding line of pixels, i.e. i=4-7. </p><p id="p0087" num="0087">This concept of the second embodiment can be extended to the case where the first filter decision value is calculated based on the pixel values of pixels present in a subset of the lines of pixels in the block and the second filter decision value is calculated based on the pixel values of pixels present in a subset of the corresponding lines of pixels in the neighboring block. Thus, in this general concept of the second embodiment the first filter decision value could be calculated as 
<img id="imgf000019_0008" he="7" wi="32" file="imgf000019_0008.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 + p2j - 2p\j + pOj , wherein i, j represent different line numbers in the interval 0 to N-1, with N denoting the total number of lines of pixels in the block and the neighboring block and i≠j. The second filter decision value is then preferably calculated as </p><p id="p0088" num="0088"> + qOj . This concept can of course be extended with the subset
<img id="imgf000019_0009" he="8" wi="54" file="imgf000019_0009.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0089" num="0089">containing more than two of the lines of pixels or the corresponding lines of pixels. 
<!-- EPO <DP n="20"/>-->
 In related example of the first or third embodiment, the first filter decision value is calculated as </p><p id="p0090" num="0090">∞i and the second filter decision value is calculated 
<img id="imgf000020_0001" he="8" wi="75" file="imgf000020_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 </p><p id="p0091" num="0091">as
<img id="imgf000020_0002" he="7" wi="35" file="imgf000020_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 + mj q2j - 2q\j + qOj . w w j represent different line-specific weights. This concept can also be extended to the case with more than two lines of pixels and two corresponding lines of pixels. In a particular example, a line of pixels or corresponding line of pixels that is closer to the middle of the block or the neighboring block could then be assigned a comparatively higher weight as compared to a line or pixels or corresponding line of pixels that is closer to one of the edges of the block or the neighboring block. </p><p id="p0092" num="0092">In a fourth embodiment, a combination of block-specific and line-specific filter decision values is used to determine how many pixels to filter for the lines of pixels in the block and the corresponding lines of pixels in the neighboring block. Fig. 3 schematically illustrates such an embodiment. The method starts i n s t e p S 1 0 w h e r e a t h i r d f i l t e r d e c i s i o n v a l u e i s c a l c u l a t e d a s 
<img id="imgf000020_0003" he="6" wi="73" file="imgf000020_0003.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 wherein p0<sub>2</sub> denotes the pixel value of the pixel closest to, in a second line of pixels in the block 10, the block boundary 1 , p\ denotes the pixel value of the pixel next closest to, in the second line of pixels, the block boundary 1 , p2 denotes the pixel value of the pixel second next closest to, in the second line of pixels, the block boundary 1 , p0<sub>5</sub> denotes a pixel value of a pixel closest to, in a third line of pixels in the block 10, the block boundary 1 , pl<sub>5</sub> denotes a pixel value of a pixel next closest to, in the third line of pixels, the block boundary 1 and p2<sub>5</sub> denotes a pixel value of a pixel second next closest to, in the third line of pixels, the block boundary 1. The second line of pixels preferably corresponds to line number 2 in the block 10 and the third line of pixel preferably corresponds to line number 5 in the block 10, see Figs. 2A and 2B. The n e x t s tep S11 calculates a fourth filter decision value as \q2<sub>2</sub> - 2ql<sub>2</sub> + q0<sub>2</sub>1 + \q2<sub>5</sub> - 2ql<sub>5</sub> + q0<sub>5</sub>1 , wherein q0<sub>2</sub> denotes the pixel value of the pixel in the neighboring block 20 closest to, in a corresponding second line of pixels in the neighboring block 20, the block boundary 1 , q\<sub>2</sub> denotes the pixel value of the pixel of the neighboring block 20 next closest to, in the corresponding second line of pixels, the block boundary 1 , q2 denotes the pixel value of the pixel in the neighboring block 20 second next closest to, in the corresponding second line of pixels, the block boundary 1 , q0<sub>5</sub> denotes a pixel value of a pixel in the neighboring block 20 closest to, in a 
<!-- EPO <DP n="21"/>-->
 corresponding third line of pixels in the neighboring block 20, the block boundary 1 , ql<sub>5</sub> denotes a pixel value of a pixel of the neighboring block 20 next closest to, in the corresponding third line of pixels, the block boundary 20 and q2<sub>5</sub> denotes a pixel value of a pixel in the neighboring block 20 second next closest to, in the corresponding third line of pixels, the block boundary 1. The second corresponding line of pixels preferably corresponds to line number 2 in the neighboring block 20 and the third corresponding line of pixel preferably corresponds to line number 5 in the neighboring block 20, see Figs. 2A and 2B. </p><p id="p0093" num="0093">Steps S10 and S11 can be performed serially in any order or at least partly in parallel. </p><p id="p0094" num="0094">The next step S12 compares the third filter decision value calculated in step S10 with a third threshold value (T<sub>3</sub>). If the third filter decision value is below the third threshold value the method continues to steps S1 and then S3 of Fig. 1. Thus, in such a case a respective line-specific or first filter decision value is calculated for each line i in the block 10, where i preferably is from 0 to 7. This first filter decision value is then calculated as 
<img id="imgf000021_0001" he="6" wi="32" file="imgf000021_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 in step S1 of Fig. 1 . Step S3 of Fig. 1 determines how many pixels in the line i of pixels in the block 10 to filter relative to the block boundary 1 based on the first filter decision value calculated for the line i of pixels in step S1. This procedure is performed for each line of pixels in the block 10. Thus, with a block 10 as illustrated in Figs. 2A or 2B steps S1 and S3 will be performed eight times. The method then continues to step S13 of Fig. 3. Correspondingly, if the third filter decision value is not below the first threshold value in step S12 the method continues to step S13. </p><p id="p0095" num="0095">Step S13 compares the fourth filter decision value calculated in step S11 with a fourth threshold value (T<sub>4</sub>). If the fourth filter decision value is below the fourth threshold the method continues to steps S2 and S4 of Fig. 1. A respective line-specific or second filter decision value is calculated for each corresponding line i in the neighboring block 20 as | 2<sub>;</sub> - 2 l<sub>;</sub> + qO<sub>j</sub> | in step S2 of Fig. 1. Step S4 of</p><p id="p0096" num="0096">Fig. 3 determines how many pixels in the corresponding line i of pixels in the neighboring block 20 to filter relative to the block boundary 1 based on the second filter decision value calculated for the corresponding line i of pixels in step S2. This procedure is performed for each corresponding line of pixels in the neighboring block 20. The method then ends. Correspondingly, if the fourth filter decision value is not below the second threshold value in step S13 the method ends. 
<!-- EPO <DP n="22"/>-->
 The loop formed by steps S12, S1 and S3 can be performed sequentially in any order relative to the loop formed by steps S13, S2 and S4 or at least partly in parallel. </p><p id="p0097" num="0097">In an example of this fourth embodiment a combination of block-based and line-based asymmetric filter decisions is used. In this example the third filter decision value is calculated as dp =
<img id="imgf000022_0001" he="7" wi="71" file="imgf000022_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 and the fourth filter decision value is calculated as d<sub>q</sub> = \q2<sub>2</sub> - 2ql<sub>2</sub> + q <sub>2</sub> \ + \q2<sub>5</sub> - 2ql<sub>5</sub> + q0<sub>5</sub>1. The line-specific filter decision values, i.e. the first and second filter decision values, are calculated as d<sub>pi</sub><sup>■</sup>. = \p2<sub>l</sub> -2pl<sub>l</sub>
<img id="imgf000022_0002" he="7" wi="12" file="imgf000022_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 and d<sub>qi</sub> =
<img id="imgf000022_0003" he="7" wi="30" file="imgf000022_0003.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 for line and corresponding line number i, respectively. </p><p id="p0098" num="0098">• Calculate d<sub>p</sub>, calculate d<sub>q</sub>; </p><p id="p0099" num="0099">• if dp &lt; thrl </p><p id="p0100" num="0100"> o for each line i </p><p id="p0101" num="0101"><sup>■</sup> calculate d<sub>pi</sub> for line i " if d<sub>p</sub>i &lt; thrl </p><p id="p0102" num="0102"> • do normal filtering of line i in current block 10, e.g. two pixels from the block border or boundary 1 ; </p><p id="p0103" num="0103"><sup>■</sup> else, i.e. if d<sub>pi</sub>≥ thrl </p><p id="p0104" num="0104"> • do not filter the second pixel from the block border or boundary 1 of line i of current block 10 or do not filter any pixels at all on line i of current block 10; </p><p id="p0105" num="0105"> • else, i.e. if d<sub>p</sub>≥ thrl </p><p id="p0106" num="0106"> o do not filter the second pixel from the block border or boundary 1 or do not filter any pixels at all; </p><p id="p0107" num="0107"> · if d<sub>q</sub> &lt; thrl </p><p id="p0108" num="0108"> o for each line i </p><p id="p0109" num="0109"><sup>■</sup> calculate d<sub>qi</sub> for line i </p><p id="p0110" num="0110"><sup>■</sup> if d<sub>qi</sub> &lt; thr2 </p><p id="p0111" num="0111"> • do normal filtering of line i in neighboring block 20, e.g. two pixels from the block border or boundary 1 ; 
<!-- EPO <DP n="23"/>-->
 <sup>■</sup> else, i.e. if d<sub>qi</sub>≥ thrl </p><p id="p0112" num="0112"> do not filter the second pixel from the block border or boundary 1 of line i of neighboring block 20 or do not filter any pixels at all on line i of neighboring block 20; </p><p id="p0113" num="0113"> • else, i.e. if d<sub>q</sub>≥ thrl </p><p id="p0114" num="0114"> o do not filter the second pixel from the block border or boundary 1 or do not filter any pixels at all. </p><p id="p0115" num="0115">In the above disclosed example the same threshold value has been used when comparing the third filter decision value and the first filter decision values, i.e. thrl , and the same threshold value has been used when comparing the fourth filter decision value and the second filter decision values, i.e. thr2. In an alternative approach, a third threshold value is used for the third filter decision value, a first threshold value is used for the first filter decision values, a fourth threshold value is used for the fourth filter decision value and a second threshold value is used for the second threshold values. In a particular embodiment, the third and fourth threshold values are equal and the first and second threshold values are equal. </p><p id="p0116" num="0116">Fig. 4 is a flow diagram illustrating a particular embodiment of the determining steps S3 and S4 of Fig. 1. The method continues from step S2 in Fig. 1. A next step S20 compares the first filter decision value (dp) calculated in step S1 in Fig. 1 to a first threshold value (ΤΊ). If the first filter decision value is below the first threshold value the method continues from step S20 to step S21. Step S21 determines to filter two pixels in the line 12 of pixels 11 , 13, 15, 17 in the block 10 relative to the block boundary 1. These two pixels are preferably the pixel 11 closest to the block boundary 1 and the pixel 13 next closest to the block boundary 1 in the line 12 of pixels 11 , 13, 15, 17. However, if the first filter decision value is not below the first threshold in step S20 the method instead continues to step S22. A first embodiment of step S22 determines to filter one pixel in the line 12 of pixels 11 , 13, 15, 17 in the block 10 relative to the block boundary 1. This pixel 11 is preferably the pixel 11 closest to the block boundary 1 in the line 12 of pixels 11 , 13, 15, 17. A second embodiment of step S22 determines to filter no pixels in the line 12 of pixels 11 , 13, 15, 17 in the block 10 relative to the block boundary 1. </p><p id="p0117" num="0117">Steps S23 to S25 perform the corresponding determination for the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20. Thus, step S23 compares the second filter decision value (d<sub>q</sub>) calculated in step S2 in Fig. 1 with a second threshold value (T<sub>2</sub>). If the second filter decision value is 
<!-- EPO <DP n="24"/>-->
 below the second threshold value the method continues to step S24. Step S24 determines to filter two pixels in the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 relative to the block boundary 1. These two pixels 21 , 23 are preferably the pixel 21 closest to the block boundary 1 and the pixel 23 next closest to the block boundary 1 in the corresponding line 22 of pixels 21 , 23, 25, 27. If the second filter decision value is not below the second threshold the method instead continues to step S25 from step S23. A first embodiment of step S25 determines to filter one pixel in the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 relative to the block boundary 1. This pixel 21 is preferably the pixel 21 closest to the block boundary 1 in the corresponding line 22 of pixels 21 , 23, 25, 27. A second embodiment of step S25 determines to filter no pixels in the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block relative to the block boundary 1. </p><p id="p0118" num="0118">Steps S20, S21 and S22 can be performed prior to, following or at least in parallel to steps S23, S24 and S25. This concept can be extended by using more than one threshold value per filter decision value. For instance, if d<sub>p</sub>&lt;Ti two pixels are filtered in the line 12 of pixels 11 , 13, 15, 17, if Ti≤d<sub>p</sub>&lt;Ti' one pixel is filtered in the line 12 of pixels 11 , 13, 15, 17 and if d<sub>p</sub>≥Ti' no pixels are filtered in the line 12 of pixels 11 , 13, 15, 17. In this case Ti&lt;Ti'. Correspondingly, if d<sub>q</sub>&lt;T<sub>2</sub> two pixels are filtered in the corresponding line 22 of pixels 21 , 23, 25, 27, if T<sub>2</sub>&lt;dq&lt;T<sub>2</sub>' one pixel is filtered in the corresponding line 22 of pixels 21 , 23, 25, 27 and if d<sub>q</sub>&gt;T<sub>2</sub>' no pixels are filtered in the corresponding line 22 of pixels 21 , 23, 25, 27. In this case T<sub>2</sub>&lt;T<sub>2</sub>'. </p><p id="p0119" num="0119">Thus, in a general aspect the closer the first or second filter decision value is to zero the more filtering is to be applied to the particular line or corresponding line of pixels by filtering and possibly modifying more pixels in the line or corresponding line of pixels as compared to a larger first or second filter decision value. This means that a zero or low first or second filter decision value implies no or few structures but rather a fairly uniform area in the video frame. Correspondingly, a high first or second filter decision value generally reflects local structures in the area in the video frame, which local structures should not be repressed or filtered away. </p><p id="p0120" num="0120">This embodiment decreases the computational complexity in connection with deblocking filtering since the filtering of the second pixel from the block border may happen less frequently as compared to the prior art HEVC solution. 
<!-- EPO <DP n="25"/>-->
 The threshold values discussed in the foregoing and used to compare the different filter decision values are preferably dependent on the quantization parameter (QP) assigned to the block or to the neighboring block. Fig. 5 schematically illustrates such an approach. The method starts in step S30 where the first threshold value, to which the first filter decision value is compared (see step S20 in Fig. 4), is determined based on a quantization parameter associated with the block 10. Correspondingly, step S31 determines the second threshold value, to which the second threshold value is compared (see step S23 in Fig. 4), based on a quantization parameter associated with the neighboring block 20 and/or a quantization parameter associated with the block 10. For instance, Ti and T<sub>2</sub> are determined based on the parameter β, which is determined from the QP value of the block 10 or the neighboring block 20. In a particular embodiment, the parameter β is read from a table based on the QP value, see Table 1 below. </p><p id="p0121" num="0121">Table 1 - β and QP values </p><p id="p0122" num="0122"><img id="imgf000025_0001" he="51" wi="164" file="imgf000025_0001.tif" img-format="tif" img-content="table" orientation="portrait" inline="no"/></p><p id="p0123" num="0123">In particular embodiments Τι=Τ<sub>2</sub>=β/6 or Τι=Τ<sub>2</sub>=(β + β»1 )»3. As another variant of the embodiment, the thresholds can be read from separate tables, i.e. Ti=function(QP), T<sub>2</sub>=function(QP). Also the above mentioned third and fourth threshold values are preferably determined based on the quantization parameter associated with the block and the neighboring block, respectively. </p><p id="p0124" num="0124">Fig. 6 is a flow diagram illustrating how the filtering control of the embodiments can be used in connection with a filtering process. The method starts in step S40 where a first offset or delta value Δ </p><p id="p0125" num="0125"> 9 x (qO <sub>j</sub> - pO <sub>j</sub> )- 3 x (ql <sub>j</sub> - pl <sub>j</sub> ) </p><p id="p0126" num="0126"> is calculated based on — -— — — — , wherein »o ,· denotes a pixel value of a </p><p id="p0127" num="0127"> 16 </p><p id="p0128" num="0128"> pixel 1 1 closest to, in a line 12 of pixels 1 1 , 13, 15, 17, the block boundary 1 , p\j denotes a pixel value of a pixel 13 next closest to, in the line 12 of pixels 1 1 , 13, 15, 1 ), the block boundary 1 , qOj denotes a pixel value of a pixel 21 in the neighboring block 20 closest to, in the corresponding line 22 
<!-- EPO <DP n="26"/>-->
 of pixels 21 , 23, 25, 27, the block boundary 1 and q denotes a pixel value of a pixel 23 of the neighboring block 20 next closest to, in the corresponding line 22 of pixels 21 , 23, 25, 27, the block boundary 1. This first offset is used in step S41 to modify the pixel value of the pixel 1 1 closest to the block boundary 1 in the line 12 of pixels 1 1 , 13, 15, 17 by adding the first offset to the pixel value, i.e. pO j = pO j + A . Step S41 also modifies the pixel value of the pixel 21 closest to the block boundary</p><p id="p0129" num="0129">1 in the corresponding line 22 of pixels 21, 23, 25, 27 by subtracting the first offset from the pixel value, i.e. qO j = qO j - A . The method then continues to steps S1 and S2 of Fig. 1 where the first (d<sub>p</sub>) and second (d<sub>q</sub>) filter decision values are calculated. A next step S42 compares the first filter decision value to a first threshold value (Ti). This step S42 corresponds to step S20 in Fig. 4. If the first filter decision value is below the threshold the method continues to step S43. pO ,- + pl <sub>j</sub> - 2p\ <sub>j</sub> + 2A </p><p id="p0130" num="0130">Step S43 calculates a second offset or delta value based on— — , wherein p2j denotes a pixel value of a pixel 15 second next closest to, in the line 12 of pixels 11 , 13, 15, 17, the block boundary 1. The second offset is then used in step S44 to modify the pixel value of the pixel 13 next closest to the block boundary 1 in the line 12 of pixels 11 , 13, 15, 17 by adding the second offset to the pixel value, i.e. plj = plj + A<sub>p</sub> . The method then continues to step S45. The method also continues in Fig. 6 from step S42 to step S45 if the first threshold value is not below the first threshold. </p><p id="p0131" num="0131">Step S45 compares the second filter decision value with a second threshold (T<sub>2</sub>). This step S45 corresponds to step S23 of Fig. 4. If the second filter decision value is below the second threshold the meth od co nti n u es to step S46. Step S46 calc u l ates a th i rd offset A<sub>q</sub> based o n qO <sub>j</sub> + q2 <sub>j</sub> - 2q\ - 2 A </p><p id="p0132" num="0132"> — — , wherein q2j denotes a pixel value of a pixel 25 in the neighboring block </p><p id="p0133" num="0133">20 second next closest to, in the corresponding line 22 of pixels 21 , 23, 25, 27, the block boundary 1. The third offset is used in step S47 to modify the pixel value of the pixel 23 next closest to the block 
<!-- EPO <DP n="27"/>-->
 boundary 1 in the corresponding line 22 of pixels 21, 23, 25, 27 by adding the third offset to the pixel value, i.e. qlj = qlj + A<sub>q</sub>. </p><p id="p0134" num="0134">Steps S42, S43 and S44 can be performed serially in any order or at least partly in parallel with steps S45, S46 and S47. </p><p id="p0135" num="0135">In above, the first, second and third offsets are calculated based on particular equations of pixel values. </p><p id="p0136" num="0136"> 9x(qO<sub>j</sub>-pO<sub>j</sub>)-3x(ql<sub>j</sub>-pl<sub>j</sub>)</p><p id="p0137" num="0137">This means that the first offset is calculated as a function of — -— — — — , the </p><p id="p0138" num="0138"> 16 </p><p id="p0139" num="0139"> p <sub>j</sub> + pl<sub>j</sub> -2p\<sub>j</sub> + 2A </p><p id="p0140" num="0140">second offset is calculated as a function of — and the third offset is </p><p id="p0141" num="0141"> 4 </p><p id="p0142" num="0142"> qO / + ql / - 2ql <sub>]</sub> - 2 A </p><p id="p0143" num="0143">calculated as a function of — — . Different such functions are possible and can be used in steps S40, S43 and S46. Such functions could then be defined so that the calculations of the offsets are efficiently performed in hardware. In such a case, it is generally preferred not to have any divisions and/or define the functions so that the offsets will be an integer value. In an embodiment, (X+8)»4 is used as an integer-expression of X/16, where » denotes a right shift operation. Thus, in a particular embodiment step S40 calculates the first offset to be based on and preferably equal to i?x{qOj - p0j)-3x{qlj - plj)+s)»4. Corresponding integer representations of the second and third offsets could be ([(p<sup>0</sup>y + P<sup>2</sup>j + 1) » l)<sup>~</sup> P^j + Δ) » 1 and {[(qOj + q2j + 1) » l)- qlj - Δ) » 1. In an example the modified pixel values as a result of deblocking are calculated like in the following. In th i s examp l e , th e f i rst f ilter decision value is defined as dp =
<img id="imgf000027_0001" he="7" wi="71" file="imgf000027_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 and the second filter decision value is calculated as d<sub>q</sub> = \q2<sub>2</sub> - 2q\<sub>2</sub> + q <sub>2</sub> \ + \q2<sub>5</sub> - 2q\<sub>5</sub> + q0<sub>5</sub>1. . <sub>A</sub>_9x(^0-^0)-3x(^l-^l) </p><p id="p0144" num="0144"> 16 </p><p id="p0145" num="0145">• Po = Po + A </p><p id="p0146" num="0146">• qo =qo<sup>~</sup>A 
<!-- EPO <DP n="28"/>-->
 • if d<sub>p</sub> &lt; thrP </p><p id="p0147" num="0147"> p0 + p2 - 2p\ ; + 2A </p><p id="p0148" num="0148"> 4 </p><p id="p0149" num="0149"> o pi Pl + Ap </p><p id="p0150" num="0150"> • if d<sub>q</sub> &lt; thrQ </p><p id="p0151" num="0151"> q0 + q2 - 2ql - 2 A </p><p id="p0152" num="0152"> 4 </p><p id="p0153" num="0153"> o qi qi + A<sub>q</sub> </p><p id="p0154" num="0154">Exact formulas for computation of the example above in the programming language can look like in the text below. Here, the Clip3 function is clipping of the output values to the range between the two first function arguments. </p><p id="p0155" num="0155">Int xCalcDP(Pel* piSrc, Int iOffset) </p><p id="p0156" num="0156">{ </p><p id="p0157" num="0157"> return abs (piSrc [-iOffset*3] -2*piSrc [-iOffset*2] +piSrc [- iOffset] ) ; </p><p id="p0158" num="0158">} </p><p id="p0159" num="0159">Int xCalcDQ(Pel* piSrc, Int iOffset) </p><p id="p0160" num="0160">{ </p><p id="p0161" num="0161"> return abs (piSrc [ 0] -2*piSrc [ iOffset ] +piSrc [ iOffset*2 ] ) ; </p><p id="p0162" num="0162">} </p><p id="p0163" num="0163">Int i DP=xCalcDP (piTmpSrc+iSrcStep* ( iIdx*uiPelsInPart+iBlkIdx* DEBLOCK_SMALLEST_BLOCK+2) , iOffset ) +xCalcDP (piTmpSrc+iSrcStep* ( i Idx*uiPelsInPart+ iBl kldx* DEBLOCK_SMALLEST_BLOCK+ 5 ) , iOffset) ; </p><p id="p0164" num="0164">Int i DQ=xCalcDQ (piTmpSrc+iSrcStep* ( iIdx*uiPelsInPart+iBlkIdx* DEBLOCK_SMALLEST_BLOCK+2) , iOffset ) +xCalcDQ (piTmpSrc+iSrcStep* ( Idx*uiPelsInPart+ iBl kldx* DEBLOCK_SMALLEST_BLOCK+ 5 ) , iOffset) ; </p><p id="p0165" num="0165">Int iSideThreshold=iBeta/ 6; </p><p id="p0166" num="0166">Bool bFilterP= (iDP&lt;iSideThreshold) ; </p><p id="p0167" num="0167">Bool bFilterQ= (iDQ&lt;iSideThreshold) ; 
<!-- EPO <DP n="29"/>-->
delta= (9* (m4-m3) -3* (m5-m2 ) +8 ) »4 ; if (abs (delta) &lt;iThrCut) </p><p id="p0168" num="0168">{ </p><p id="p0169" num="0169"> Int tc2=tc»l; delta=Clip3 ( -tc, tc, delta); </p><p id="p0170" num="0170"> piSrc[-iOffset]=Clip( (m3+delta) ) ; </p><p id="p0171" num="0171"> piSrc[0]=Clip( (m4-delta) ) ; if (bFilterP) </p><p id="p0172" num="0172"> { </p><p id="p0173" num="0173"> Int deltal=Clip3 (-tc2, tc2, ( ( ( (ml+m3+l ) »1 ) -m2+delta) »1 ) ) ; piSrc [-iOffset*2] =Clip ( (m2+deltal) ) ; </p><p id="p0174" num="0174"> } </p><p id="p0175" num="0175"> if (bFilterQ) </p><p id="p0176" num="0176"> { </p><p id="p0177" num="0177"> Int delta2=Clip3 (-tc2, tc2, ( ( ( (m6+m4+ l ) »1 ) -m5-delta) »1 ) ) ; piSrc[iOffset]=Clip( (m5+delta2) ) ; </p><p id="p0178" num="0178"> } </p><p id="p0179" num="0179"> } </p><p id="p0180" num="0180">Fig. 7 is a flow diagram illustrating additional optional steps of the method in Fig. 1. The method continues from step S2 in Fig. 1. A next step S50 compares a sum of the first decision value and the second decision value with a threshold value (T). If the sum is not below the threshold value, the method ends. Thus, in such a case no filtering at all is applied to block 10 and neighboring block 20 with regard to the particular block boundary 1. The block 10 and the neighboring block 20 then comprises at lot of local structures, which should not be filtered away. However, if the sum is below the threshold value the method continues to steps S3 and S4 in Fig. 1 , where the determination of how many pixels to filter is performed based on the first filter decision value (step S3) or the second filter decision value (step S4). </p><p id="p0181" num="0181">This embodiment has an advantage that it does not require many additional computations as the values for the first and second filter decisions are also used for deciding whether to filter the block boundary at all. 
<!-- EPO <DP n="30"/>-->
 The embodiments disclosed herein achieve asymmetric deblocking decisions that control deblocking filtering to be adaptive to the structure on each side of a block boundary. The asymmetric decisions means that the amount of filtering applied to one side of the block boundary can differ from the amount of filtering applied to the other side of the block boundary, thus providing additional adaptation to the local structure. This improves the objective and subjective video quality. </p><p id="p0182" num="0182">Fig. 8 is a schematic block diagram of an embodiment of a filtering control device 100. The filtering control device 100 comprises a first decision value calculator 1 10 configured to calculate a first filter decision value for a block 10 in a video frame based at least on 
<img id="imgf000030_0001" he="6" wi="8" file="imgf000030_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2pl<sub>j</sub> + pO<sub>j</sub> \ . The filtering control device 100 also comprises a second decision value calculator 120 configured to calculate a second, different filter decision value for the block 10 based on
<img id="imgf000030_0002" he="6" wi="7" file="imgf000030_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2 l<sub>;</sub> + qO<sub>j</sub> | . </p><p id="p0183" num="0183">A first pixel determiner 130 or first pixel determining unit or processor is configured to determine how many pixels in a line 12 of pixels 1 1 , 13, 15, 17 in the block 10 to filter relative to a block boundary 1 based on the first filter decision value calculated by the first decision value calculator 1 10. A second pixel determiner 140 or second pixel determining unit or processor is provided in the filtering control device 100 to determine how many pixels in a corresponding line 22 of pixel 21 , 23, 25, 27 in a neighboring block 20 of the video frame to filter relative to the block boundary based on the second filter decision value calculated by the second decision value calculator 120. </p><p id="p0184" num="0184">In an embodiment, the first pixel determiner 130 is configured to determine how many pixels in the first line 12 of pixels 11 , 13, 15, 17 in the block 10 to filter relative to the block boundary 1 based on the first filter decision value calculated by the first decision value calculator 110 for the first line 12 of pixels 11 , 13, 15, 17. The second pixel determiner 140 correspondingly determines in this embodiment how many pixels in the corresponding first line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 to filter relative to the block boundary 1 based on the second filter decision value calculated by the second decision value calculator 120 for the corresponding first line 22 of pixels 21 , 23, 25, 27. </p><p id="p0185" num="0185">In another embodiment, the first decision value calculator 110 is configured to calculate the first filter decision value as \p2<sub>2</sub> - 2pl<sub>2</sub> + p <sub>2</sub> \ + \p2<sub>5</sub> - 2pl<sub>5</sub> + p0<sub>5</sub> \ and the second decision value c a l c u l ato r 1 20 i s c o n fi g u re d to c a l culate the second filter decision value as</p><p id="p0186" num="0186">\q2<sub>2</sub> - 2q\<sub>2</sub> + q0<sub>2</sub>1 + \q2<sub>5</sub> - 2q\<sub>5</sub> + q0<sub>5</sub> \ . 
<!-- EPO <DP n="31"/>-->
 In yet another embodiment, the first decision value calculator 110 is configured to calculate the first filter decision value of a first pair as 
<img id="imgf000031_0001" he="6" wi="71" file="imgf000031_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 and the second decision value calculator 120 is configured to calculate the second filter decision value of the first pair as 
<img id="imgf000031_0002" he="6" wi="44" file="imgf000031_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2q\<sub>3</sub> + ¾r0<sub>3</sub>1. The first filter decision value calculator 110 is also configured to calculate the first filter decision value of a second pair as |/?2<sub>4</sub> -2pl<sub>4</sub> +
<img id="imgf000031_0003" he="6" wi="47" file="imgf000031_0003.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 and the second filter decision value calculator 120 is also configured to calculate the second filter decision value of a the second pair as</p><p id="p0187" num="0187">\q2<sub>4</sub> - 2q\<sub>4</sub> + q0<sub>4</sub>1 +
<img id="imgf000031_0004" he="6" wi="21" file="imgf000031_0004.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 + q0<sub>7</sub>1. Fig.9 is a schematic block diagram of another embodiment of a filtering control device 100. The filtering control device 100 comprises, in this embodiment and in addition to the first decision value calculator 110, the second decision value calculator 120, the first pixel determiner 130 and the second pixel determiner 140, a third decision value calculator 150. The third decision value calculator 150 is then configured to calculate a third filter decision value as \p2<sub>2</sub> -2pl<sub>2</sub> +
<img id="imgf000031_0005" he="6" wi="48" file="imgf000031_0005.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 A fourth decision value calculator 160 is also implemented in the filtering control device 100 and configured to calculate a fourth filter decision value as \q2<sub>2</sub> -2q\<sub>2</sub> + q0<sub>2</sub>1 + \q2<sub>5</sub> - 2q\<sub>5</sub> + q0<sub>5</sub>1. </p><p id="p0188" num="0188">In this embodiment, the first filter decision value calculator 110 is configured to calculate the first filter decision value if the third filter decision value calculated by the third decision value calculator 150 is below a third threshold value. If the third decision value is below the third threshold, the first decision value calculator 110 calculates a first threshold value for each line i 12 of pixels 11, 13, 15, 17 in the block 10 as 
<img id="imgf000031_0006" he="6" wi="33" file="imgf000031_0006.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 The first pixel determiner 130 then determines, if the third filter decision value is below the third threshold value and for each line i 12 of pixels 11 , 13, 15, 17 in the block 10, how many pixels in the line i 12 of pixels 11 , 13, 15, 17 in the block 10 to filter relative to the block boundary 1 based on the first filter decision value calculated by the first decision value calculator 110 for the line i 12 of pixels 11, 13, 15, 17. </p><p id="p0189" num="0189">The second decision value calculator 120 is preferably responsive to a comparison between the fourth filter decision value and a fourth threshold value. Thus, if the fourth filter decision value calculated by the fourth decision value calculator 160 is below the fourth threshold the second decision value calculator 120 calculates a second filter decision value as
<img id="imgf000031_0007" he="6" wi="7" file="imgf000031_0007.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 - 2 l<sub>;</sub> + qO<sub>j</sub> | for each corresponding 
<!-- EPO <DP n="32"/>-->
 line i 22 of pixels 21 , 23, 25, 27 in the neighboring block 20. The second pixel determiner 240 is configured to determine, if the fourth filter decision value is below the fourth threshold value and for each corresponding line i 22 of pixels 21 , 23, 25, 27 in the neighboring block 20, how many pixels in the corresponding line i 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 to filter relative to the block boundary 1 based on the second filter decision value calculated for the corresponding line i 22 of pixels 21 , 23, 25, 27. </p><p id="p0190" num="0190">Fig. 10 is a schematic block diagram of a further embodiment of a filtering control device 100. In addition to the units 110-140 of the embodiment illustrated in Fig. 8, the filtering control device 100 comprises a first comparator 180 configured to compare the first filter decision value calculated by the first decision value calculator 110 to a first threshold value. A second comparator 182 is correspondingly configured to compare the second filter decision value calculated by the second decision value calculator 120 to a second threshold value. In this embodiment, the first pixel determiner 130 is configured to determine to filter two pixels in the line 12 of pixels 11 , 13, 15, 17 in the block 10 relative to the block boundary 1 if the first filter decision value is below the first threshold value as determined by the first comparator 180. However, if the first filter decision value is not below the first threshold value the first pixel determiner 130 is instead configured to determine to filter one pixel in the line 12 of pixels 11 , 13, 15, 17 in the block 10 relative to the block boundary 1. Alternatively, the first pixel determiner 130 is instead configured to determine to filter no pixels in the line 12 of pixels 11 , 13, 15, 17 in the block 10 relative to the block boundary 1. </p><p id="p0191" num="0191">The second pixel determiner 140 is configured to determine to filter two pixels in the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 relative to the block boundary 1 if the second filter decision value is below the second threshold value as determined by the second comparator 182. However, if the second filter decision value is not below the second threshold the second pixel determiner 140 is instead configured to determine to filter one pixel in the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 relative to the block boundary 1. Alternatively, the second pixel determiner 140 is instead configured to determine to filter no pixels in the corresponding line 22 of pixels 21 , 23, 25, 27 in the neighboring block 20 relative to the block boundary 1. </p><p id="p0192" num="0192">In an embodiment the filtering control device 100 of Fig. 10 comprises a first offset calculator 181 </p><p id="p0193" num="0193"> 9 x (qO <sub>j</sub> - pO <sub>j</sub> )- 3 x (ql <sub>j</sub> - pl <sub>j</sub> ) </p><p id="p0194" num="0194">configured to calculate a first offset based on— -— — — — . A first pixel modifier 
<!-- EPO <DP n="33"/>-->
190 of the filtering control device 100 is configured to modify the pixel value of the pixel 11 closest to the block boundary 1 in the line 12 of pixels 11 , 13, 15, 17 by adding the first offset to the pixel value of this pixel 1 1. A second pixel value modifier 192 is configured to modify the pixel value of the pixel 21 closest to the block boundary 1 in the corresponding line 12 of pixels 21 , 23, 25, 27 by subtracting the first offset from the pixel value of this pixel 21. </p><p id="p0195" num="0195">A second offset calculator 183 is preferably implemented in the filtering control device 100 to calculate a second offset if the first filter decision value is below the first threshold value as determined by the p <sub>j</sub> + pl <sub>j</sub> - 2p\ <sub>j</sub> + 2Δ first comparator 180. The second offset is then calculated based on — — . A third pixel modifier 194 is operated if the first filter decision value is below the first threshold value. In such a case, the third pixel modifier 194 is configured to modify the pixel value of the pixel 13 next closest to the block boundary 1 in the line 12 of pixels 11 , 13, 15, 17 by adding the second offset to the pixel value of this pixel 13. A th i rd offset c al c u l ato r 1 85 i s co nfi g u re d to c al c u l ate a th i rd offset b ase d o n qO / + ql / - 2ql <sub>]</sub> - 2 A </p><p id="p0196" num="0196"> — if the second filter decision value is below the second threshold value as</p><p id="p0197" num="0197">4 </p><p id="p0198" num="0198">determined by the second comparator 182. If the second filter decision value is below the second threshold value a fourth pixel modifier 196 of the filtering control device 100 is configured to modify the pixel value of the pixel 23 next closest to the block boundary 1 in the corresponding line 22 of pixels 21 , 23, 25, 27 by adding the third offset to the pixel value of this pixel 23. </p><p id="p0199" num="0199">The embodiments of the filtering control device 100 discussed in the foregoing in connection with Figs. 9 and 10 compares filter decision values to respective threshold values. In an embodiment, such threshold values are calculated by the filtering control device 100 for the particular block boundary 1. The filtering control device 100 then preferably comprises a threshold determiner 170 or threshold determining processor or unit configured to determine the first threshold value used by the first comparator 180 in Fig. 10 and the third threshold value used by the filtering control device 100 in Fig. 9 based on a quantization parameter associated with the block 10. Correspondingly, the threshold determiner 170 correspondingly preferably determines the second threshold value used by the second comparator 182 in Fig. 10 and the fourth threshold value used by the filtering control device 100 in Fig. 9 based on a quantization parameter associated with the neighboring block 20. 
<!-- EPO <DP n="34"/>-->
 Fig. 1 1 is schematic block diagram of yet another embodiment of a filtering control device 100. In addition to the units 1 10-140 of the embodiment illustrated in Fig. 8, the filtering control device 100 comprises in this embodiment a third comparator 184 configured to compare a sum of the first filter decision value and the second filter decision value to a threshold value. If the sum is equal to or 5 exceeds the threshold value the first and second pixel determiners 130, 140 will not determine any number of pixels to filter since no filtering is to be applied to the block 10 and the neighboring block 20 with regard to the particular block boundary 1. However, if the sum is below the threshold, the first and second pixel determiners 130, 140 are operated to determine the number of pixels to filter based on the first or second filter decision values, respectively. </p><p id="p0200" num="0200"> 10 </p><p id="p0201" num="0201"> The embodiments of the filtering control device 100 discussed in the foregoing and disclosed in Figs. 8- 11 can be combined. For instance, the third value calculator 150 and fourth value calculator 160 of Fig. 9 can be implemented in any of the embodiments disclosed in Figs. 10 or 1 1. Correspondingly, the third comparator 184 of Fig. 11 can be implemented in any of the embodiments disclosed in Figs. 9 or 15 10. </p><p id="p0202" num="0202">Although the respective units 110-196 disclosed in conjunction with Figs. 8-11 have been disclosed as physically separate units 110-196 in the filtering control device 100, and all may be special purpose circuits, such as ASICs (Application Specific Integrated Circuits), alternative embodiments of the 20 filtering control device 100 are possible where some or all of the units 110-196 are implemented as computer program modules running on a general purpose processor. Such an embodiment is disclosed in Fig. 12. </p><p id="p0203" num="0203">Fig. 12 schematically illustrates an embodiment of a computer 70 having a processing unit 72, such as 25 a DSP (Digital Signal Processor) or CPU (Central Processing Unit). The processing unit 72 can be a single unit or a plurality of units for performing different steps of the method described herein. The computer 70 also comprises an input/output (I/O) unit 71 for receiving recorded or generated video frames or encoded video frames and outputting encoded video frame or decoded video data. The I/O unit 71 has been illustrated as a single unit in Fig. 12 but can likewise be in the form of a separate input 30 unit and a separate output unit. </p><p id="p0204" num="0204">Furthermore, the computer 70 comprises at least one computer program product 73 in the form of a non-volatile memory, for instance an EEPROM (Electrically Erasable Programmable Read-Only Memory), a flash memory or a disk drive. The computer program product 73 comprises a computer 
<!-- EPO <DP n="35"/>-->
 program 74, which comprises code means which when run on or executed by the computer 70, such as by the processing unit 72, causes the computer 70 to perform the steps of the method described in the foregoing in connection with Fig. 1. Hence, in an embodiment the code means in the computer program 74 comprises a first decision value calculating (DVC) module 310 for calculating the first filter decision value for a block, a second pixel value calculating module 320 for calculating the second filter decision value for the block, a first pixel determining (PD) module 330 for determining how many pixels in the line 12 of pixels 1 1 , 13, 15, 17 to filter and a second pixel determining module 340 for determining how many pixels in the corresponding line 22 of pixels 21 , 23, 25, 27 to filter. These modules 310-340 essentially perform the steps of the flow diagram in Fig. 1 when run on the processing unit 72. Thus, when the different modules 310-340 are run on the processing unit 72 they correspond to the corresponding units 110-140 of Figs. 8-11. </p><p id="p0205" num="0205">The computer program 74 may additionally comprise a third decision value calculating module, a fourth decision value calculating module, a threshold determining module, a first comparing module, second comparing module, a third comparing module, a first offset calculating module, a second offset calculating module, a third offset calculating module, a first pixel modifying module, a second pixel modifying module, a third pixel modifying module and/or a fourth pixel modifying module to perform the operation of the corresponding units 150-196 in Figs. 9-11. The computer 70 of Fig. 12 can be a user equipment or be present in a user equipment. In such a case, the user equipment may additionally comprise or be connected to a display to display video data. </p><p id="p0206" num="0206">The filtering control device of Figs. 8-11 is preferably used in video coding. It functions and is therefore preferably implemented both in a video encoder and in a video decoder. The video decoder can be implemented preferably in hardware but also in software. The same holds for the video encoder. </p><p id="p0207" num="0207">Fig. 13 is a schematic block diagram of an encoder 40 for encoding a block of pixels in a video frame of a video sequence according to an embodiment. A current block of pixels is predicted by performing a motion estimation by a motion estimator 50 from an already provided block of pixels in the same frame or in a previous frame. The result of the motion estimation is a motion or displacement vector associated with the reference block, in the case of inter prediction. The motion vector is utilized by a motion compensator 50 for outputting an inter prediction of the block of pixels. 
<!-- EPO <DP n="36"/>-->
 An intra predictor 49 computes an intra prediction of the current block of pixels. The outputs from the motion estimator/compensator 50 and the intra predictor 49 are input in a selector 51 that either selects intra prediction or inter prediction for the current block of pixels. The output from the selector 51 is input to an error calculator in the form of an adder 41 that also receives the pixel values of the current block of pixels. The adder 41 calculates and outputs a residual error as the difference in pixel values between the block of pixels and its prediction. </p><p id="p0208" num="0208">The error is transformed in a transformer 42, such as by a discrete cosine transform, and quantized by a quantizer 43 followed by coding in an encoder 44, such as by entropy encoder. In inter coding, also the estimated motion vector is brought to the encoder 44 for generating the coded representation of the current block of pixels. </p><p id="p0209" num="0209">The transformed and quantized residual error for the current block of pixels is also provided to a inverse quantizer 45 and inverse transformer 46 to retrieve the original residual error. This error is added by an adder 47 to the block prediction output from the motion compensator 50 or the intra predictor 49 to create a reference block of pixels that can be used in the prediction and coding of a next block of pixels. This new reference block is first processed by a filtering control device 100 according to the embodiments in order to control any deblocking filtering that is applied to the reference block to combat any blocking artifact. The processed new reference block is then temporarily stored in a frame buffer 48, where it is available to the intra predictor 49 and the motion estimator/compensator 50. </p><p id="p0210" num="0210">Fig. 14 is a corresponding schematic block diagram of a decoder 60 comprising a filtering control device 100 according to the embodiments. The decoder 60 comprises a decoder 61 , such as entropy decoder, for decoding an encoded representation of a block of pixels to get a set of quantized and transformed residual errors. These residual errors are dequantized in an inverse quantizer 62 and inverse transformed by an inverse transformer 63 to get a set of residual errors. </p><p id="p0211" num="0211">These residual errors are added in an adder 64 to the pixel values of a reference block of pixels. The reference block is determined by a motion estimator/compensator 67 or intra predictor 66, depending on whether inter or intra prediction is performed. A selector 68 is thereby interconnected to the adder 64 and the motion estimator/compensator 67 and the intra predictor 66. The resulting decoded block of pixels output form the adder 64 is input to a filtering control device 100 according to the embodiments in order to control any deblocking filter that is applied to combat any blocking artifacts. The filtered block of pixels is output form 
<!-- EPO <DP n="37"/>-->
 the decoder 60 and is furthermore preferably temporarily provided to a frame buffer 65 and can be used as a reference block of pixels for a subsequent block of pixels to be decoded. The frame buffer 65 is thereby connected to the motion estimator/compensator 67 to make the stored blocks of pixels available to the motion estimator/compensator 67. </p><p id="p0212" num="0212"> 5 </p><p id="p0213" num="0213"> The output from the adder 64 is preferably also input to the intra predictor 66 to be used as an unfiltered reference block of pixels. </p><p id="p0214" num="0214">In the embodiments disclosed in Figs. 13 and 14 the filtering control device 100 controls deblocking filtering in 10 the form of so called in-loop filtering. In an alternative implementation at the decoder 60 the filtering control device 100 is arranged to perform so called post-processing filtering. In such a case, the filtering control device 100 operates on the output frames outside of the loop formed by the adder 64, the frame buffer 65, the intra predictor 66, the motion estimator/compensator 67 and the selector 68. No deblocking filtering and filtering control is then typically done at the encoder. </p><p id="p0215" num="0215"> 15 </p><p id="p0216" num="0216"> Fig. 15 is a schematic block diagram of a user equipment or media terminal 80 housing a decoder 60 with a filtering control device. The user equipment 80 can be any device having media decoding functions that operates on an encoded video stream of encoded video frames to thereby decode the video frames and make the video data available. Non-limiting examples of such devices include mobile telephones and other</p><p id="p0217" num="0217">20 portable media players, tablets, desktops, notebooks, personal video recorders, multimedia players, video streaming servers, set-top boxes, TVs, computers, decoders, game consoles, etc. The user equipment 80 comprises a memory 84 configured to store encoded video frames. These encoded video frames can have been generated by the user equipment 80 itself. Alternatively, the encoded video frames are generated by some other device and wirelessly transmitted or transmitted by wire to the user equipment 80. The user</p><p id="p0218" num="0218">25 equipment 80 then comprises a transceiver (transmitter and receiver) or input and output port 82 to achieve the data transfer. </p><p id="p0219" num="0219">The encoded video frames are brought from the memory 84 to a decoder 60, such as the decoder illustrated in Fig. 14. The decoder 60 comprises a filtering control device 100 according to embodiments. The decoder 30 60 then decodes the encoded video frames into decoded video frames. The decoded video frames are provided to a media player 86 that is configured to render the decoded video frames into video data that is displayable on a display or screen 88 of or connected to the user equipment 80. 
<!-- EPO <DP n="38"/>-->
 In Fig. 15, the user equipment 80 has been illustrated as comprising both the decoder 60 and the media player 86, with the decoder 60 implemented as a part of the media player 86. This should, however, merely be seen as an illustrative but non-limiting example of an implementation embodiment for the user equipment 80. Also distributed implementations are possible where the decoder 60 and the media player 86 are provided in two physically separated devices are possible and within the scope of user equipment 80 as used herein. The display 88 could also be provided as a separate device connected to the user equipment 80, where the actual data processing is taking place. </p><p id="p0220" num="0220">Fig. 16 illustrates another embodiment of a user equipment 80 that comprises en encoder, such as the encoder of Fig. 13, comprising a filtering control device according to the embodiments. The encoder 40 is then configured to encode video frames received by the I/O unit 82 and/or generated by the user equipment 80 itself. In the latter case, the user equipment 80 preferably comprises a media engine or recorder, such as in the form of or connected to a (video) camera. The user equipment 80 may optionally also comprise a media player 86, such as a media player 86 with a decoder and filtering control device according to the embodiments, and a display 88. </p><p id="p0221" num="0221">As illustrated in Fig. 17, the encoder 40 and/or decoder 60, such as illustrated in Figs. 13 and 14, may be implemented in a network device 30 being or belonging to a network node in a communication network 32 between a sending unit 34 and a receiving user equipment 36. Such a network device 30 may be a device for converting video according to one video coding standard to another video coding standard, for example, if it has been established that the receiving user equipment 36 is only capable of or prefers another video coding standard than the one sent from the sending unit 34. The network device 30 can be in the form of or comprised in a radio base station, a Node-B or any other network node in a communication network 32, such as a radio-based network. </p><p id="p0222" num="0222">The embodiments described above are to be understood as a few illustrative examples of the present invention. It will be understood by those skilled in the art that various modifications, combinations and changes may be made to the embodiments without departing from the scope of the present invention. I n particular, different part solutions in the different embodiments can be combined in other configurations, where technically possible. The scope of the present invention is, however, defined by the appended claims. 
</p></description><claims mxw-id="PCLM44851677" ref-ucid="WO-2012118421-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="39"/>--> CLAIMS </claim-statement><claim id="clm-0001" num="1"><claim-text> 1. A method for filtering control applicable to a block (10) of multiple pixels (11 , 13, 15, 17) in a video frame, each pixel (11 , 13, 15, 17) having a respective pixel value, said method comprising: </claim-text><claim-text> calculating (S1 ) a first filter decision value for said block (10) based at least on: <img id="imgf000039_0001" he="6" wi="32" file="imgf000039_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text>wherein pO<sub>j</sub> denotes a pixel value of a pixel (11) closest to, in a first line (12) of pixels (11 , 13, 15, 17) in said block (10), a block boundary (1) to a neighboring block (20) of multiple pixels (21 , 23, 25, 27) in said video frame, pl<sub>t</sub> denotes a pixel value of a pixel (13) next closest to, in said first line (12) of pixels</claim-text><claim-text>(11 , 13, 15, 17), said block boundary (1) and p2<sub>t</sub> denotes a pixel value of a pixel (15) second next closest to, in said first line (12) of pixels (11, 13, 15, 17), said block boundary (10); </claim-text><claim-text> calculating (S2) a second filter decision value for said block (20) based at least on: <img id="imgf000039_0002" he="6" wi="31" file="imgf000039_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text>wherein qO<sub>t</sub> denotes a pixel value of a pixel (21) in said neighboring block (20) closest to, in a corresponding first line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20), said block boundary (1), ql<sub>j</sub> denotes a pixel value of a pixel (23) of said neighboring block (20) next closest to, in said corresponding first line (22) of pixels (21 , 23, 25, 27), said block boundary (1) and q2<sub>t</sub> denotes a pixel value of a pixel (25) in said neighboring block (20) second next closest to, in said corresponding first line (22) of pixels (21, 23, 25, 27), said block boundary (1); </claim-text><claim-text> determining (S3) how many pixels in a line (12) of pixels (1 1 , 13, 15, 17) in said block (10) to filter relative to said block boundary (1) based on said first filter decision value; and </claim-text><claim-text> determining (S4) how many pixels in a corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter relative to said block boundary (1) based on said second filter decision value. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. The method according to claim 1 , wherein </claim-text><claim-text> determining (S3) how many pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter comprises determining (S3) how many pixels in said first line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter relative to said block boundary (1) based on said first filter decision value; and </claim-text><claim-text> determining (S4) how many pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter comprises determining (S4) how many pixels in said corresponding first line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter relative to said block boundary (1) based on said second filter decision value. <!-- EPO <DP n="40"/>--> </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. The method according to claim 1 , wherein </claim-text><claim-text> calculating (S1) said first filter decision value comprises calculating (S1) said first filter decision value as: <img id="imgf000040_0001" he="6" wi="71" file="imgf000040_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text>wherein p0<sub>2</sub> denotes said pixel value of said pixel closest to, in said first line of pixels, said block boundary (1 ), p\ denotes said pixel value of said pixel next closest to, in said first line of pixels, said block boundary (1 ), p2<sub>2</sub> denotes said pixel value of said pixel second next closest to, in said first line of pixels, said block boundary (1), ρθ<sub>5</sub> denotes a pixel value of a pixel closest to, in a second line of pixels in said block (10), said block boundary (1 ), pl<sub>5</sub> denotes a pixel value of a pixel next closest to, in said second line of pixels, said block boundary (1) and p2<sub>5</sub> denotes a pixel value of a pixel second next closest to, in said second line of pixels, said block boundary (1); and </claim-text><claim-text> calculating (S2) said second filter decision value comprises calculating (S2) said second filter decision value as: <img id="imgf000040_0002" he="6" wi="21" file="imgf000040_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> + q0<sub>2</sub>1 + \q2<sub>5</sub> - 2q\<sub>5</sub> + q0<sub>5</sub>1 </claim-text><claim-text>wherein q0<sub>2</sub> denotes said pixel value of said pixel in said neighboring block (20) closest to, in said corresponding first line of pixels, said block boundary (1), q\ denotes said pixel value of said pixel of said neighboring block (20) next closest to, in said corresponding first line of pixels, said block boundary (1), q2<sub>2</sub> denotes said pixel value of said pixel in said neighboring block (20) second next closest to, in said corresponding first line of pixels, said block boundary (1), q0<sub>5</sub> denotes a pixel value of a pixel in said neighboring block (20) closest to, in a corresponding second line of pixels in said neighboring block (20), said block boundary (1), q\<sub>5</sub> denotes a pixel value of a pixel of said neighboring block (20) next closest to, in said corresponding second line of pixels, said block boundary (1) and q2<sub>5</sub> denotes a pixel value of a pixel in said neighboring block (20) second next closest to, in said corresponding second line of pixels, said block boundary (1). </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. The method according to any of the claims 1 to 3, wherein </claim-text><claim-text> determining (S3) how many pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter comprises: </claim-text><claim-text> comparing (S20) said first filter decision value to a first threshold value; <!-- EPO <DP n="41"/>--> determining (S21) to filter two pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is below said first threshold value; and </claim-text><claim-text> determining (S22) to filter one pixel in said line (12) of pixels (11 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is equal to or exceeds said first threshold value; and </claim-text><claim-text> determining (S4) how many pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter comprises: </claim-text><claim-text> comparing (S23) said second filter decision value to a second threshold value; determining (S24) to filter two pixels in said corresponding line (22) of pixels (21 , 23, 25,</claim-text><claim-text>27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is below said second threshold value; and </claim-text><claim-text> determining (S25) to filter one pixel in said corresponding line (22) of pixels (21, 23, 25, 27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is equal to or exceeds said second threshold value. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. The method according to any of the claims 1 to 3, wherein </claim-text><claim-text> determining (S3) how many pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter comprises: </claim-text><claim-text> comparing (S20) said first filter decision value to a first threshold value; </claim-text><claim-text> determining (S21) to filter two pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is below said first threshold value; and </claim-text><claim-text> determining (S22) to filter no pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is equal to or exceeds said first threshold value; and </claim-text><claim-text> determining (S4) how many pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter comprises: </claim-text><claim-text> comparing (S23) said second filter decision value to a second threshold value; determining (S24) to filter two pixels in said corresponding line (22) of pixels (21 , 23 ,25,</claim-text><claim-text>27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is below said second threshold value; and <!-- EPO <DP n="42"/>--> determining (S25) to filter no pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is equal to or exceeds said second threshold value. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>5 6. The method according to any of the claims 3 to 5, further comprising: </claim-text><claim-text> determining (S30) said first threshold value based on a quantization parameter associated with said block (10); and </claim-text><claim-text> determining (S31) said second threshold value based on said quantization parameter associated with said neighboring block (20). </claim-text><claim-text> 10 </claim-text></claim><claim id="clm-0007" num="7"><claim-text> 7. The method according to any of the claims 3 to 6, further comprising: </claim-text><claim-text> 9 x (qO <sub>i</sub> - pO <sub>i</sub> )- 3 x (ql <sub>i</sub> - pl j ) </claim-text><claim-text> calculating (S40) a first offset Δ based on— -— — — — . wherein pO ,· </claim-text><claim-text> 16 </claim-text><claim-text> denotes a pixel value of a pixel (11) closest to, in said line (12) of pixels (1 1 , 13, 15, 17), said block boundary (1), p\j denotes a pixel value of a pixel (13) next closest to, in said line (12) of pixels (11 , </claim-text><claim-text>15 13, 15, 17), said block boundary (1), qOj denotes a pixel value of a pixel (21) in said neighboring block (20) closest to, in said corresponding line (22) of pixels (21 , 23, 25, 27), said block boundary (1) and ql<sub>j</sub> denotes a pixel value of a pixel (23) of said neighboring block (20) next closest to, in said corresponding line (22) of pixels (21, 23, 25, 27), said block boundary (1); </claim-text><claim-text> modifying (S41) said pixel value of said pixel (11) closest to said block boundary (1) in said line</claim-text><claim-text>20 (12) of pixels (1 1 , 13, 15, 17) by adding said first offset to said pixel value of said pixel (11 ) closest to said block boundary (1 ) in said line (12) of pixels (11 , 13, 15, 17); </claim-text><claim-text> modifying (S41) said pixel value of said pixel (21) in said neighboring block (20) closest to said block boundary (1) in said corresponding line (22) of pixels (21 , 23, 25, 27) by subtracting said first offset from said pixel value of said pixel (21) in said neighboring block (20) closest to said block</claim-text><claim-text>25 boundary (1) in said corresponding line (22) of pixels (21 , 23, 25, 27); </claim-text><claim-text> calculating (S43), if said first filter decision value is below said first threshold value, a second pO ,- + pl <sub>j</sub> - 2p\ <sub>j</sub> + 2Δ </claim-text><claim-text> offset based on — , wherein pl <sub>i</sub> denotes a pixel value of a pixel (15) </claim-text><claim-text> 4 </claim-text><claim-text> second next closest to, in said line (12) of pixels (11, 13, 15, 17), said block boundary (1); </claim-text><claim-text> modifying (S44), if said first filter decision value is below said first threshold, said pixel value of 30 said pixel (13) next closest to said block boundary (1) in said line (12) of pixels (11 , 13, 15, 17) by <!-- EPO <DP n="43"/>--> adding said second offset to said pixel value of said pixel (13) next closest to said block boundary (1) in said line (12) of pixels (11, 13, 15, 17); </claim-text><claim-text> calculating (S46), if said second filter decision value is below said second threshold value, a qO / + q2 / - 2ql <sub>]</sub> - 2 A </claim-text><claim-text>third offset based on— , wherein q2 ,· denotes a pixel value of a pixel (25) in </claim-text><claim-text> 4 </claim-text><claim-text>said neighboring block (20) second next closest to, in said corresponding line (22) of pixels (21, 23, 25,</claim-text><claim-text>27), said block boundary (1); and </claim-text><claim-text> modifying (S47), if said second filter decision value is below said second threshold, said pixel value of said pixel (23) in said neighboring block (20) next closest to said block boundary (1) in said corresponding line (22) of pixels (21 , 23, 25, 27) by adding said third offset to said pixel value of said pixel (23) in said neighboring block (20) next closest to said block boundary (1) in said corresponding line (22) of pixels (21 , 23, 25, 27). </claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. The method according to any of the claims 1 to 7, further comprising comparing (S50) a sum of said first filter decision value and said second filter decision value to a threshold value, wherein </claim-text><claim-text> determining (S3) how many pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter comprises determining (S3), if said sum of said first filter decision value and said second filter decision value is below said threshold value, how many pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter relative to said block boundary (1) based on said first filter decision value; and determining (S4) how many pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter comprises determining (S4), if said sum of said first filter decision value and said second filter decision value is below said threshold value, how many pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter relative to said block boundary (1) based on said second filter decision value. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. A filtering control device (100) comprising: </claim-text><claim-text> a first decision value calculator (110) configured to calculate a first filter decision value for a block (10) of multiple pixels (11 , 13, 15, 17) in a video frame based at least on: <img id="imgf000043_0001" he="6" wi="32" file="imgf000043_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text>wherein pO<sub>j</sub> denotes a pixel value of a pixel (11) closest to, in a first line (12) of pixels (11 , 13, 15, 17) in said block (10), a block boundary (1) to a neighboring block (20) of multiple pixels (21 , 23, 25, 27) in said video frame, pl<sub>t</sub> denotes a pixel value of a pixel (13) next closest to, in said first line (12) of pixels <!-- EPO <DP n="44"/>--> (11 , 13, 15, 17), said block boundary (1 ) and p2<sub>t</sub> denotes a pixel value of a pixel (15) second next closest to, in said first line (12) of pixels (11 , 13, 15, 17), said block boundary (10); </claim-text><claim-text> a second decision value calculator (120) configured to calculate a second filter decision value for said block (10) based at least on: <img id="imgf000044_0001" he="6" wi="99" file="imgf000044_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text> wherein qO<sub>t</sub> denotes a pixel value of a pixel (21) in said neighboring block (20) closest to, in a corresponding first line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20), said block boundary (1), q denotes a pixel value of a pixel (23) of said neighboring block (20) next closest to, in said corresponding first line (22) of pixels (21 , 23, 25, 27), said block boundary (1) and q2<sub>t</sub> denotes a</claim-text><claim-text>10 pixel value of a pixel (25) in said neighboring block (20) second next closest to, in said corresponding first line (22) of pixels (21 , 23, 25, 27), said block boundary (1); </claim-text><claim-text> a first pixel determiner (130) configured to determine how many pixels in a line (12) of pixels (11 ,</claim-text><claim-text>13, 15, 17) in said block (10) to filter relative to said block boundary (1) based on said first filter decision value calculated by said first decision value calculator (110); and </claim-text><claim-text>15 a second pixel determiner (140) configured to determine how many pixels in a corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter relative to said block boundary</claim-text><claim-text>(1) based on said second filter decision value calculated by said second decision value calculator</claim-text><claim-text>(120). </claim-text></claim><claim id="clm-0010" num="10"><claim-text>20 10. The device according to claim 9, wherein </claim-text><claim-text> said first pixel determiner (130) is configured to determine how many pixels in said first line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter relative to said block boundary (1) based on said first filter decision value calculated by said first decision value calculator (110); and </claim-text><claim-text> said second pixel determiner (140) is configured to determine how many pixels in said 25 corresponding first line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter relative to said block boundary (1) based on said second filter decision value calculated by said second decision value calculator (120). </claim-text></claim><claim id="clm-0011" num="11"><claim-text>11. The device according to claim 9, wherein </claim-text><claim-text>30 said first decision value calculator (110) is configured to calculate said first filter decision value as: <img id="imgf000044_0002" he="6" wi="46" file="imgf000044_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> - 2p + P0<sub>5</sub>1 <!-- EPO <DP n="45"/>--> wherein ρθ<sub>2</sub> denotes said pixel value of said pixel closest to, in said first line of pixels, said block boundary (1), p\<sub>2</sub> denotes said pixel value of said pixel next closest to, in said first line of pixels, said block boundary (1), p2<sub>2</sub> denotes said pixel value of said pixel second next closest to, in said first line of pixels, said block boundary (1), ρθ<sub>5</sub> denotes a pixel value of a pixel closest to, in a second line of pixels in said block (10), said block boundary (1 ), pl<sub>5</sub> denotes a pixel value of a pixel next closest to, in said second line of pixels, said block boundary (1) and p2<sub>5</sub> denotes a pixel value of a pixel second next closest to, in said second line of pixels, said block boundary (1); and </claim-text><claim-text> said second decision value calculator (120) is configured to calculate said second filter decision value as: </claim-text><claim-text> \q2<sub>2</sub> - 2ql<sub>2</sub> + q0<sub>2</sub>1 + \q2<sub>5</sub> - 2ql<sub>5</sub> + q0<sub>5</sub>1 </claim-text><claim-text>wherein q0<sub>2</sub> denotes said pixel value of said pixel in said neighboring block (20) closest to, in said corresponding first line of pixels, said block boundary (1), q\ denotes said pixel value of said pixel of said neighboring block (20) next closest to, in said corresponding first line of pixels, said block boundary (1), q2<sub>2</sub> denotes said pixel value of said pixel in said neighboring block (20) second next closest to, in said corresponding first line of pixels, said block boundary (1), q0<sub>5</sub> denotes a pixel value of a pixel in said neighboring block (20) closest to, in a corresponding second line of pixels in said neighboring block (20), said block boundary (1), q\<sub>5</sub> denotes a pixel value of a pixel of said neighboring block (20) next closest to, in said corresponding second line of pixels, said block boundary (1) and q2<sub>5</sub> denotes a pixel value of a pixel in said neighboring block (20) second next closest to, in said corresponding second line of pixels, said block boundary (1). </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. The device according to any of the claims 9 to 11 , further comprising: </claim-text><claim-text> a first comparator (180) configured to compare said first filter decision value calculated by said first decision value calculator (110) to a first threshold value; and </claim-text><claim-text> a second comparator (182) configured to compare said second filter decision value calculated by said second decision value calculator (120) to a second threshold value, wherein </claim-text><claim-text> said first pixel determiner (130) is configured to i) determine to filter two pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is below said first threshold value as determined by said first comparator (180) and ii) determine to filter one pixel in said line (12) of pixels (11 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is equal to or exceeds said first threshold value as determined by said first comparator (180); and <!-- EPO <DP n="46"/>--> said second pixel determiner (140) is configured to i) determine to filter two pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is below said second threshold value as determined by said second comparator (182) and ii) determine to filter one pixel in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is equal to or exceeds said second threshold value as determined by said second comparator (182). </claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. The device according to any of the claims 9 to 11 , further comprising: </claim-text><claim-text> a first comparator (180) configured to compare said first filter decision value calculated by said first decision value calculator (110) to a first threshold value; and </claim-text><claim-text> a second comparator (182) configured to compare said second filter decision value calculated by said second decision value calculator (120) to a second threshold value, wherein </claim-text><claim-text> said first pixel determiner (130) is configured to i) determine to filter two pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is below said first threshold value as determined by said first comparator (180) and ii) determine to filter no pixels in said line (12) of pixels (1 1 , 13, 15, 17) in said block (10) relative to said block boundary (1) if said first filter decision value is equal to or exceeds said first threshold value as determined by said first comparator (180); and </claim-text><claim-text> said second pixel determiner (140) is configured to i) determine to filter two pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is below said second threshold value as determined by said second comparator (182) and ii) determine to filter no pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) relative to said block boundary (1) if said second filter decision value is equal to or exceeds said second threshold value as determined by said second comparator (182). </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. The device according to any of the claims 1 1 to 13, further comprising a threshold determiner (170) configured to i) determine said first threshold value based on a quantization parameter associated with said block (10), and ii) determine said second threshold value based on a quantization parameter associated with said neighboring block (20). </claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. The device according to any of the claims 11 to 14, further comprising: <!-- EPO <DP n="47"/>--> a first offset calculator (181) configured to calculate a first offset Δ based on</claim-text><claim-text>9x(qO<sub>i</sub> -pO<sub>i</sub>)-3x(ql<sub>i</sub> -plj) </claim-text><claim-text> — -— — — — , wherein pO ,· denotes a pixel value of a pixel (11) closest to, in </claim-text><claim-text> 16 </claim-text><claim-text>said line (12) of pixels (11, 13, 15, 17), said block boundary (1), p\j denotes a pixel value of a pixel </claim-text><claim-text>(13) next closest to, in said line (12) of pixels (11, 13, 15, 17), said block boundary (1), qOj denotes a pixel value of a pixel (21) in said neighboring block (20) closest to, in said corresponding line (22) of pixels (21, 23, 25, 27), said block boundary (1) and q denotes a pixel value of a pixel (23) of said neighboring block (20) next closest to, in said corresponding line (22) of pixels (21, 23, 25, 27), said block boundary (1); </claim-text><claim-text> a first pixel modifier (190) configured to modify said pixel value of said pixel (11) closest to said block boundary (1) in said line (12) of pixels (11, 13, 15, 17) by adding said first offset calculated by said first offset calculator (181) to said pixel value of said pixel (11) closest to said block boundary (1) in said line (12) of pixels (11 , 13, 15, 17); </claim-text><claim-text> a second pixel modifier (192) configured to modify said pixel value of said pixel (21) in said neighboring block (20) closest to said block boundary (1) in said corresponding line (22) of pixels (21, 23, 25, 27) by subtracting said first offset calculated by said first offset calculator (181) from said pixel value of said pixel (21) in said neighboring block (20) closest to said block boundary (1) in said corresponding line (22) of pixels (21, 23, 25, 27); </claim-text><claim-text> a second offset calculator (183) configured to calculate, if said first filter decision value is below said first threshold value as determined by said first comparator (180), a second offset based on pO,- + plj -2p\j +2Δ </claim-text><claim-text>— . wherein p2<sub>i</sub> denotes a pixel value of a pixel (15) second next closest to, </claim-text><claim-text> 4 </claim-text><claim-text>in said line (12) of pixels (11 , 13, 15, 17), said block boundary (1 ); </claim-text><claim-text> a third pixel modifier (194) configured to modify, if said first filter decision value is below said first threshold as determined by said first comparator (180), said pixel value of said pixel (13) next closest to said block boundary (1) in said line (12) of pixels (11, 13, 15, 17) by adding said second offset calculated by said second offset calculator (183) to said pixel value of said pixel (13) next closest to said block boundary (1 ) in said line (12) of pixels (11 , 13, 15, 17); </claim-text><claim-text> a third offset calculator (185) configured to calculate, if said second filter decision value is below said second threshold value as determined by said second comparator (182), a third offset based on qO / + q2 / - 2q\ - 2 A </claim-text><claim-text> — , wherein q2 denotes a pixel value of a pixel (25) in said neighboring <!-- EPO <DP n="48"/>--> block (20) second next closest to, in said corresponding line (22) of pixels (21 , 23, 25, 27), said block boundary (1); and </claim-text><claim-text> a fourth pixel modifier (196) configured to modify, if said second filter decision value is below said second threshold as determined by said second comparator (182), said pixel value of said pixel 5 (23) in said neighboring block (20) next closest to said block boundary (1 ) in said corresponding line (22) of pixels (21 , 23, 25, 27) by adding said third offset calculated by said third offset calculator (185) to said pixel value of said pixel (23) in said neighboring block (20) next closest to said block boundary (1) in said corresponding line (22) of pixels (21 , 23, 25, 27). </claim-text></claim><claim id="clm-0016" num="16"><claim-text>10 16. The device according to any of the claims 9 to 15, further comprising a third comparator (184) configured to compare a sum of said first filter decision value and said second filter decision value to a threshold value, wherein </claim-text><claim-text> said first pixel determiner (130) is configured to determine, if said sum of said first filter decision value and said second filter decision value is below said threshold value as determined by said third 15 comparator (184), how many pixels in said line (12) of pixels (11 , 13, 15, 17) in said block (10) to filter relative to said block boundary (1) based on said first filter decision value calculated by said first decision value calculator (110); and </claim-text><claim-text> said second pixel determiner (140) is configured to determine, if said sum of said first filter decision value and said second filter decision value is below said threshold value as determined by 20 said third comparator (184), how many pixels in said corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter relative to said block boundary (1) based on said second filter decision value calculated by said second decision value calculator (120). </claim-text></claim><claim id="clm-0017" num="17"><claim-text>17. An encoder (40) comprising a filtering control device (100) according to any of the claims 9 to 16.</claim-text><claim-text>25 </claim-text></claim><claim id="clm-0018" num="18"><claim-text> 18. A user equipment (80) comprising: </claim-text><claim-text> a memory (84) configured to store video frames; and </claim-text><claim-text> an encoder (40) according to claim 17 configured to encode said video frames into encoded video frames, wherein said memory (84) is further configured to store said encoded video frames.</claim-text><claim-text>30 </claim-text></claim><claim id="clm-0019" num="19"><claim-text> 19. A decoder (60) comprising a filtering control device (100) according to any of the claims 9 to 16. </claim-text></claim><claim id="clm-0020" num="20"><claim-text>20. A user equipment (80) comprising: </claim-text><claim-text> a memory (84) configured to store encoded video frames; <!-- EPO <DP n="49"/>--> a decoder (60) according to claim 19 configured to decode said encoded video frames into decoded video frames; and </claim-text><claim-text> a media player (86) configured to render said decoded video frames into video data displayable on a display (88). </claim-text><claim-text> 5 </claim-text></claim><claim id="clm-0021" num="21"><claim-text> 21. A computer program (74) for filtering control of a block (10) of multiple pixels (11 , 13, 15, 17) in a video frame, each pixel (1 1 , 13, 15, 17) having a respective pixel value, said computer program (74) comprises code means which when run on a computer (70) causes the computer (70) to: </claim-text><claim-text> calculate a first filter decision value for said block (10) based at least on: <img id="imgf000049_0001" he="6" wi="101" file="imgf000049_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text> wherein pO<sub>j</sub> denotes a pixel value of a pixel (11) closest to, in a first line (12) of pixels (11 , 13, 15, 17) in said block (10), a block boundary (1) to a neighboring block (20) of multiple pixels (21 , 23, 25, 27) in said video frame, pl<sub>t</sub> denotes a pixel value of a pixel (13) next closest to, in said first line (12) of pixels</claim-text><claim-text>(11 , 13, 15, 17, 19), said block boundary (1) and p2<sub>t</sub> denotes a pixel value of a pixel (13) second next</claim-text><claim-text>15 closest to, in said first line (12) of pixels (11, 13, 15, 17), said block boundary (10); </claim-text><claim-text> calculate a second filter decision value for said block based at least on: <img id="imgf000049_0002" he="6" wi="31" file="imgf000049_0002.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/> </claim-text><claim-text> wherein qO<sub>t</sub> denotes a pixel value of a pixel (21) in said neighboring block (20) closest to, in a corresponding first line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20), said block 20 boundary (1), ql<sub>j</sub> denotes a pixel value of a pixel (23) of said neighboring block (20) next closest to, in said corresponding first line (22) of pixels (21 , 23, 25, 27), said block boundary (1) and q2<sub>t</sub> denotes a pixel value of a pixel (23) in said neighboring block (20) second next closest to, in said corresponding first line (22) of pixels (21, 23, 25, 27), said block boundary (1); </claim-text><claim-text> determine how many pixels in a line (12) of pixels (1 1 , 13, 15, 17) in said block (10) to filer 25 relative to said block boundary (1) based on said first filter decision value; and </claim-text><claim-text> determine how many pixels in a corresponding line (22) of pixels (21 , 23, 25, 27) in said neighboring block (20) to filter relative to said block boundary (1) based on said second filter decision value. </claim-text></claim><claim id="clm-0022" num="22"><claim-text>30 22. A computer program product (73) comprising computer readable code means and a computer program (74) according to claim 21 stored on said computer readable means. </claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
