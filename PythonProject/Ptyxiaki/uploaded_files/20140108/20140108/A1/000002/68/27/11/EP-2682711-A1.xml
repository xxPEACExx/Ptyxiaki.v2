<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2682711-A1" country="EP" doc-number="2682711" kind="A1" date="20140108" family-id="48699661" file-reference-id="315100" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="146585022" ucid="EP-2682711-A1"><document-id><country>EP</country><doc-number>2682711</doc-number><kind>A1</kind><date>20140108</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13174627-A" is-representative="YES"><document-id mxw-id="PAPP154847214" load-source="docdb" format="epo"><country>EP</country><doc-number>13174627</doc-number><kind>A</kind><date>20130702</date><lang>EN</lang></document-id><document-id mxw-id="PAPP177814795" load-source="docdb" format="original"><country>EP</country><doc-number>13174627.3</doc-number><date>20130702</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC140548081" ucid="JP-2012149595-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2012149595</doc-number><kind>A</kind><date>20120703</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-2040290104" load-source="docdb">G06T   7/00        20060101ALI20150629BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-2040297549" load-source="docdb">G01B  11/00        20060101AFI20150629BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1801309490" load-source="docdb" scheme="CPC">G06T   7/593       20170101 FI20170615BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1863145749" load-source="docdb" scheme="CPC">G01B  11/002       20130101 LI20161226BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1863149230" load-source="docdb" scheme="CPC">G06T2207/30164     20130101 LA20161226BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1863153565" load-source="docdb" scheme="CPC">G06T2207/10012     20130101 LA20161226BHEP        </classification-cpc><classification-cpc mxw-id="PCL1991313569" load-source="docdb" scheme="CPC">Y10S 901/46        20130101 LA20140102BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT132359699" lang="DE" load-source="patent-office">Vorrichtung und Verfahren zur dreidimensionaler Messung und Robotersystem mit dieser Vorrichtung</invention-title><invention-title mxw-id="PT132359700" lang="EN" load-source="patent-office">Apparatus and method for three-dimensional measurement and robot system comprising said apparatus</invention-title><invention-title mxw-id="PT132359701" lang="FR" load-source="patent-office">Appareil et méthode de mesure tridimensionnel et système robotique comprenant cet appareil</invention-title><citations><patent-citations><patcit mxw-id="PCIT242942882" load-source="docdb" ucid="JP-2005045328-A"><document-id format="epo"><country>JP</country><doc-number>2005045328</doc-number><kind>A</kind><date>20050217</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242942883" load-source="docdb" ucid="US-20060193509-A1"><document-id format="epo"><country>US</country><doc-number>20060193509</doc-number><kind>A1</kind><date>20060831</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242942884" load-source="docdb" ucid="US-20110001797-A1"><document-id format="epo"><country>US</country><doc-number>20110001797</doc-number><kind>A1</kind><date>20110106</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242942885" load-source="docdb" ucid="US-20110122228-A1"><document-id format="epo"><country>US</country><doc-number>20110122228</doc-number><kind>A1</kind><date>20110526</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT242942886" load-source="docdb" ucid="US-20120026295-A1"><document-id format="epo"><country>US</country><doc-number>20120026295</doc-number><kind>A1</kind><date>20120202</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit></patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR919534554" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>CANON KK</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR919521104" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>CANON KABUSHIKI KAISHA</last-name></addressbook></applicant><applicant mxw-id="PPAR919018566" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Canon Kabushiki Kaisha</last-name><iid>101093230</iid><address><street>30-2 Shimomaruko 3-chome Ohta-ku</street><city>Tokyo 146-8501</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR919546247" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SUZUKI HIDEAKI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919513800" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SUZUKI, HIDEAKI</last-name></addressbook></inventor><inventor mxw-id="PPAR919017530" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SUZUKI, HIDEAKI</last-name><address><street>c/o Canon Kabushiki Kaisha 30-2, Shimomaruko 3-chome, Ohta-ku,</street><city>Tokyo Tokyo 146-8501</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919525563" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>HAYASHI TADASHI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR919533302" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>HAYASHI, TADASHI</last-name></addressbook></inventor><inventor mxw-id="PPAR919014293" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>HAYASHI, TADASHI</last-name><address><street>c/o Canon Kabushiki Kaisha 30-2, Shimomaruko 3-chome, Ohta-ku,</street><city>Tokyo Tokyo 146-8501</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR919007956" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>TBK-Patent</last-name><iid>100061560</iid><address><street>Bavariaring 4-6</street><city>80336 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS549908107" load-source="docdb">AL</country><country mxw-id="DS549817136" load-source="docdb">AT</country><country mxw-id="DS549908109" load-source="docdb">BE</country><country mxw-id="DS549743743" load-source="docdb">BG</country><country mxw-id="DS549741595" load-source="docdb">CH</country><country mxw-id="DS549814514" load-source="docdb">CY</country><country mxw-id="DS549817137" load-source="docdb">CZ</country><country mxw-id="DS549908110" load-source="docdb">DE</country><country mxw-id="DS549814515" load-source="docdb">DK</country><country mxw-id="DS549814516" load-source="docdb">EE</country><country mxw-id="DS549814414" load-source="docdb">ES</country><country mxw-id="DS549743744" load-source="docdb">FI</country><country mxw-id="DS549743753" load-source="docdb">FR</country><country mxw-id="DS549908111" load-source="docdb">GB</country><country mxw-id="DS549814517" load-source="docdb">GR</country><country mxw-id="DS549908112" load-source="docdb">HR</country><country mxw-id="DS549817142" load-source="docdb">HU</country><country mxw-id="DS549741596" load-source="docdb">IE</country><country mxw-id="DS549908113" load-source="docdb">IS</country><country mxw-id="DS549743754" load-source="docdb">IT</country><country mxw-id="DS549814522" load-source="docdb">LI</country><country mxw-id="DS549743042" load-source="docdb">LT</country><country mxw-id="DS549817143" load-source="docdb">LU</country><country mxw-id="DS549743043" load-source="docdb">LV</country><country mxw-id="DS549743044" load-source="docdb">MC</country><country mxw-id="DS549813156" load-source="docdb">MK</country><country mxw-id="DS549813157" load-source="docdb">MT</country><country mxw-id="DS549743755" load-source="docdb">NL</country><country mxw-id="DS549814415" load-source="docdb">NO</country><country mxw-id="DS549741601" load-source="docdb">PL</country><country mxw-id="DS549813162" load-source="docdb">PT</country><country mxw-id="DS549743756" load-source="docdb">RO</country><country mxw-id="DS549813163" load-source="docdb">RS</country><country mxw-id="DS549743761" load-source="docdb">SE</country><country mxw-id="DS549813164" load-source="docdb">SI</country><country mxw-id="DS549814416" load-source="docdb">SK</country><country mxw-id="DS549741602" load-source="docdb">SM</country><country mxw-id="DS549743054" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA128673194" lang="EN" load-source="patent-office"><p id="pa01" num="0001">There are provided a three-dimensional measurement apparatus capable of speeding up image processing, and a robot system including the same. The three-dimensional measurement apparatus includes: a base camera 22 for capturing an image of a workpiece; a reference camera 23 for capturing an image of the workpiece from a view point different from the base camera 22; and a camera control unit 5 for calculating three-dimensional coordinates from a first image acquired by capturing the workpiece with the base camera 22 and preset virtual workpiece depth information, calculating the projection of a three-dimensional image of the workpiece to the reference camera 23 from the calculated three-dimensional coordinates and a posture parameter of the reference camera 23 relative to the base camera 22, setting a cropping range of the reference camera 23 based on the calculated projection, and measuring a three-dimensional position of the workpiece from the first image captured with the base camera 22 and a second image cropped in the cropping range of the reference camera 23.
<img id="iaf01" file="imgaf001.tif" wi="88" he="86" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA128737344" lang="EN" source="EPO" load-source="docdb"><p>There are provided a three-dimensional measurement apparatus capable of speeding up image processing, and a robot system including the same. The three-dimensional measurement apparatus includes: a base camera 22 for capturing an image of a workpiece; a reference camera 23 for capturing an image of the workpiece from a view point different from the base camera 22; and a camera control unit 5 for calculating three-dimensional coordinates from a first image acquired by capturing the workpiece with the base camera 22 and preset virtual workpiece depth information, calculating the projection of a three-dimensional image of the workpiece to the reference camera 23 from the calculated three-dimensional coordinates and a posture parameter of the reference camera 23 relative to the base camera 22, setting a cropping range of the reference camera 23 based on the calculated projection, and measuring a three-dimensional position of the workpiece from the first image captured with the base camera 22 and a second image cropped in the cropping range of the reference camera 23.</p></abstract><description mxw-id="PDES63959182" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">BACKGROUND OF THE INVENTION</heading><heading id="h0002">Field of the Invention</heading><p id="p0001" num="0001">The present invention relates to a three-dimensional measurement apparatus for capturing images of a workpiece from two or more view points to make a three-dimensional measurement or view the workpiece stereoscopically, and a robot system including the same.</p><heading id="h0003">Description of the Related Art</heading><p id="p0002" num="0002">Conventionally, a three-dimensional measurement apparatus has been widely used, which captures images with a plurality of cameras in making a three-dimensional measurement or stereoscopic viewing to acquire three-dimensional information in order to make a three-dimensional measurement from the three-dimensional information. As the three-dimensional measurement apparatus, for example, a stereo method is widely known, which extracts feature points from captured two images, respectively, and establishes correspondences among the extracted feature points to make a three-dimensional measurement by the principle of triangulation.</p><p id="p0003" num="0003">In the meantime, in the field of digital cameras using an image sensor such as CCD or CMOS, digital cameras having a partial cropping function for presetting a range of pixels to be read on the image sensor to read only necessary pixels have become common in recent years. The<!-- EPO <DP n="2"> --> partial cropping function can reduce the data volume to be handled, and hence has the advantage of being able to perform transfer of image data and image processing at a higher speed than the case of using all pixels.</p><p id="p0004" num="0004">However, the above-mentioned partial cropping function is required to preset the range of reading pixels on the image sensor. Therefore, for example, when objects are conveyed along a production line in such a state that the objects vary in position, there arises a problem of making it difficult to adapt the partial cropping function to the state.</p><p id="p0005" num="0005">On the other hand, as a method of cropping an area from a stereo image, there is proposed a three-dimensional measurement apparatus which, after acquiring a first image and a second image, finds a portion similar to the first image from the second image to set a cropping range from the similar portion (see Japanese Patent Application Laid-Open No. <patcit id="pcit0001" dnum="JP2005045328A"><text>2005-045328</text></patcit>).</p><p id="p0006" num="0006">However, since the three-dimensional measurement apparatus described in Japanese Patent Application Laid-Open No. <patcit id="pcit0002" dnum="JP2005045328A"><text>2005-045328</text></patcit> sets the portion similar to the first image as the cropping range of the second image after acquiring both of the first image and the second image from a camera, there is a problem that the time of transferring images from the camera cannot be reduced. In other words, the benefits of the partial cropping function in the above-mentioned digital camera cannot be derived.<!-- EPO <DP n="3"> --></p><p id="p0007" num="0007">Therefore, it is an object of the present invention to provide a three-dimensional measurement apparatus for reducing the amount of information to enable speeding up of image processing, and a robot system including the same.</p><heading id="h0004">SUMMARY OF THE INVENTION</heading><p id="p0008" num="0008">The present invention provides a three-dimensional measurement apparatus including: a first camera for capturing an image of a workpiece; a second camera for capturing an image of the workpiece from a view point different from the first camera; and a control unit for calculating three-dimensional coordinates from a first image acquired by capturing the workpiece with the first camera and preset virtual workpiece depth information, calculating a projection of a three-dimensional image of the workpiece to the second camera from the calculated three-dimensional coordinates and a posture parameter of the second camera relative to the first camera, setting a cropping range of the second camera based on the calculated projection, and measuring a three-dimensional position of the workpiece from the first image captured with the first camera and a second image cropped in the cropping range of the second camera.</p><p id="p0009" num="0009">The present invention also provides a three-dimensional measurement method including: a first image acquiring step for capturing a workpiece with a first<!-- EPO <DP n="4"> --> camera to acquire a first image; a three-dimensional coordinate calculating step for calculating three-dimensional coordinates from the first image acquired in the first image acquiring step and virtual workpiece depth information; a projection calculating step for calculating a projection of the three-dimensional coordinates to a second camera from a posture parameter of the second camera relative to the first camera and the three-dimensional coordinates; a cropping range setting step for setting a cropping range of a second image to be cropped from the second camera based on the projection calculated in the projection calculating step; a second image acquiring step for acquiring the second image in the cropping range set in the cropping range setting step; and a three-dimensional measurement step for making a three-dimensional measurement of the workpiece from the first image and the second image.</p><p id="p0010" num="0010">Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.</p><heading id="h0005">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p0011" num="0011"><figref idrefs="f0001">FIG. 1</figref> is a perspective view illustrating a schematic structure of a robot system according to an exemplary embodiment of the present invention.</p><p id="p0012" num="0012"><figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating the configuration of a control device in the robot system according to the exemplary embodiment.<!-- EPO <DP n="5"> --></p><p id="p0013" num="0013"><figref idrefs="f0003">FIG. 3</figref> is a block diagram illustrating the configuration of a camera control unit according to the exemplary embodiment.</p><p id="p0014" num="0014"><figref idrefs="f0004">FIG. 4</figref> is a flowchart of a three-dimensional measurement made by the camera control unit according to a first embodiment.</p><p id="p0015" num="0015"><figref idrefs="f0005">FIG. 5</figref> is a diagram illustrating the positional relationship between a cropping range in each of images, acquired with a base camera and a reference camera, and a projected point according to the first embodiment.</p><p id="p0016" num="0016"><figref idrefs="f0005">FIG. 6</figref> is a diagram illustrating image sensors of the base camera and the reference camera according to the first embodiment.</p><p id="p0017" num="0017"><figref idrefs="f0006">FIG. 7</figref> is a flowchart of a three-dimensional measurement made by a camera control unit according to a second embodiment.</p><p id="p0018" num="0018"><figref idrefs="f0007">FIG. 8</figref> is a diagram illustrating the positional relationship between a cropping range in each of images, acquired with the base camera and the reference camera, and a projected three-dimensional image according to the second embodiment.</p><p id="p0019" num="0019"><figref idrefs="f0007">FIG. 9</figref> is a diagram illustrating image sensors of the base camera and the reference camera according to the second embodiment.</p><heading id="h0006">DESCRIPTION OF THE EMBODIMENTS</heading><p id="p0020" num="0020">Exemplary embodiments of the present invention<!-- EPO <DP n="6"> --> will now be described in detail in accordance with the accompanying drawings.</p><p id="p0021" num="0021">&lt;First Embodiment&gt;</p><p id="p0022" num="0022">A robot system 1 according to a first embodiment of the present invention will be described below with reference to <figref idrefs="f0001 f0002 f0003 f0004 f0005">FIG. 1 to FIG. 6</figref>. First, a schematic structure of the robot system 1 will be described with reference to <figref idrefs="f0001 f0002 f0003">FIG. 1 to FIG. 3</figref>. <figref idrefs="f0001">FIG. 1</figref> is a perspective view illustrating the robot system 1 according to an exemplary embodiment of the present invention. <figref idrefs="f0002">FIG. 2</figref> is a block diagram illustrating the configuration of a control device 4 in the robot system 1 according to the exemplary embodiment. <figref idrefs="f0003">FIG. 3</figref> is a block diagram illustrating the configuration of a camera control unit 5 according to the exemplary embodiment.</p><p id="p0023" num="0023">As illustrated in <figref idrefs="f0001">FIG. 1</figref>, the robot system 1 according to the first embodiment includes a robot 2 for assembling a workpiece, a mounting base 3 on which the robot 2 assembles the workpiece, and the control device 4 for controlling the robot 2.</p><p id="p0024" num="0024">The robot 2 is a six-shaft multi-joint general-purpose robot including a robot arm 20, a hand 21 attached to the tip of the robot arm, a base camera 22 as a first camera, and a reference camera 23 as a second camera. In the embodiment, two cameras, i.e. the base camera 22 and the reference camera 23 are used, but a stereo camera unit which can obtain images at two viewpoints may be used.<!-- EPO <DP n="7"> --></p><p id="p0025" num="0025">The robot arm 20 is equipped with six actuators (not illustrated) for driving each joint to rotate about each joint axis. The six actuators are selectively driven, respectively, to move the hand 21 attached to the tip to any three-dimensional position. The hand 21 is equipped with a gripping portion 21a for gripping the workpiece and an actuator, not illustrated, for driving the gripping portion 21a. The gripping portion 21a is moved by the driving of the robot arm 20 to a position in which the actuator is so driven that the gripping portion 21a will grip the workpiece. A force sensor, not illustrated, is provided in the hand 21 to regulate a grip force when the workpiece is gripped. The hand 21 is detachably attached to the tip of the robot arm 20 in a manner to be changeable according to the shape of the workpiece to work on.</p><p id="p0026" num="0026">The base camera 22 is attached to the tip of the robot arm 20 to capture an image of the workpiece in order to acquire a first image of the workpiece. The reference camera 23 is attached adjacent to the base camera 22 at the tip of the robot arm 20 to capture an image of the workpiece from a view point different from the base camera 22 in order to acquire a second image of the workpiece.</p><p id="p0027" num="0027">The mounting base 3 is formed into a rectangular box shape, and provided with a planar placement section 30 with the workpiece placed on the top face thereof. A jig 31 used to assemble the workpiece is provided substantially in a central portion of the placement section 30. A<!-- EPO <DP n="8"> --> support 32 for immovably supporting the base end section of the robot arm 20, a part feeder 33, and a tool holder 34 are provided at the corners of the placement section 30, respectively. Four casters 35 ... for moving the mounting base 3 and four fixing brackets 36 ... for fixing the mounting base 3 to the floor are provided at the bottom of the mounting base 3 so that the mounting base 3 can be fixed after the mounting base 3 is moved to any position.</p><p id="p0028" num="0028">As illustrated in <figref idrefs="f0002">FIG. 2</figref>, the control device 4 is so configured that the robot arm 20, the hand 21, the base camera 22, and the reference camera 23 are connected through a bus to a computer main body having a calculating device 40 and a storing device 41. An input device 42, a teaching pendant 43, a display 44, a speaker 45, a recording medium reading device 46, a communication device 47, and the like are also connected to the computer main body through the bus. In <figref idrefs="f0002">FIG. 2</figref>, interfaces for these connections are not illustrated.</p><p id="p0029" num="0029">The calculating device 40 includes a CPU 40a, an image processing device 40b, and a sound processing device 40c. The CPU 40a includes a camera control unit 5 and a robot control unit 6. The camera control unit 5 measures a three-dimensional position of a workpiece according to various programs stored in the storing device 41 and the settings input from the input device 42.</p><p id="p0030" num="0030">As illustrated in <figref idrefs="f0003">FIG. 3</figref>, the camera control unit 5 includes a first image acquiring section 51, a three-dimensional<!-- EPO <DP n="9"> --> coordinate calculating section 52, a projection calculating section 53, a cropping range setting section 54, a second image acquiring section 55, and a three-dimensional measurement section 56. The first image acquiring section 51 captures a workpiece with the base camera 22 to acquire a first image of the workpiece. The three-dimensional coordinate calculating section 52 calculates three-dimensional coordinates from the first image acquired in the first image acquiring section 51 and preset virtual workpiece depth information. The virtual workpiece depth information may be set, for example, with reference to a focal distance at the time of capturing the workpiece with the base camera 22.</p><p id="p0031" num="0031">The projection calculating section 53 calculates the projection of a three-dimensional image of the workpiece onto the image sensor of the reference camera 23 from the camera parameters of the reference camera 23 and the base camera 22, and the three-dimensional coordinates calculated in the three-dimensional coordinate calculating section 52. Based on the projection calculated in the projection calculating section 53, the cropping range setting section 54 sets a cropping range of pixels on the image sensor of the reference camera 23. The second image acquiring section 55 captures an image of the workpiece in the cropping range on the image sensor of the reference camera 23 set in the cropping range setting section 54 to acquire a second image. The three-dimensional measurement<!-- EPO <DP n="10"> --> section 56 measures a three-dimensional position of the workpiece from the first image and the second image. The measurement of the three-dimensional position of the workpiece by the camera control unit 5 will be described in detail later.</p><p id="p0032" num="0032">Based on the three-dimensional position of the workpiece measured by the camera control unit 5, the various programs stored in the storing device 41, and the settings input from the input device 42, the robot control unit 6 controls the robot arm 20 and the hand 21. The description of the control of the robot arm 20 and the hand 21 performed by the robot control unit 6 will be omitted.</p><p id="p0033" num="0033">The image processing device 40b controls the display 44 in accordance with a drawing instruction from the CPU 40a to cause the display 44 to display a predetermined image on the screen. The sound processing device 40c generates a sound signal in accordance with a sound generation instruction from the CPU 40a to output the sound signal to the speaker 45.</p><p id="p0034" num="0034">The storing device 41 is connected to the CPU 40a through the bus, and includes a ROM 41a in which the various programs and data are stored, and a RAM 41b reserved as a working area of the CPU 40a. In the embodiment, the various programs for measuring the workpiece three-dimensionally are stored in the ROM 41a in addition to drive programs for the robot arm 20 and the hand 21. For example, a three-dimensional measurement<!-- EPO <DP n="11"> --> program for executing a first image acquiring step, a three-dimensional coordinate calculating step, a projection calculating step, a cropping range setting step, a second image acquiring step, and a three-dimensional measurement step to be described later is stored. When a worker enters virtual workpiece depth information and data, such as camera parameters of the base camera 22 and the reference camera 23, from the input device 42, these are also stored in the ROM 41a.</p><p id="p0035" num="0035">The input device 42 is composed of a keyboard 42a and a mouse 42b to enable input of information necessary to measure the three-dimensional position of the workpiece and other instructions. The recording medium reading device 46 is used to read a computer-readable recording medium 48 that has recorded, for example, the three-dimensional measurement program, and to store the three-dimensional measurement program in the ROM 41a. The communication device 47 is used to download the three-dimensional measurement program distributed from the Internet through the communication device 47 without using the recording medium 48 mentioned above.</p><p id="p0036" num="0036">Next, a method of measuring the three-dimensional position of the workpiece by the camera control unit 5 when the hand 21 in the robot system 1 structured as mentioned above grips the workpiece will be described along a flowchart illustrated in <figref idrefs="f0004">FIG. 4</figref> while referring to <figref idrefs="f0005">FIG. 5 and FIG. 6</figref>. <figref idrefs="f0004">FIG. 4</figref> is a flowchart of a three-dimensional<!-- EPO <DP n="12"> --> measurement by the camera control unit 5 according to the first embodiment. <figref idrefs="f0005">FIG. 5</figref> is a diagram illustrating the positional relationship between a cropping range in each of images, acquired with the base camera 22 and the reference camera 23, and a projected point according to the first embodiment. <figref idrefs="f0005">FIG. 6</figref> is a diagram illustrating image sensors of the base camera 22 and the reference camera 23 according to the first embodiment.</p><p id="p0037" num="0037">First, internal parameters of the base camera 22, internal parameters of the reference camera 23, and posture parameters of the cameras are predetermined and stored in the ROM 41a. The internal parameters are parameters required to calculate a projection from the coordinates of any three-dimensional point to a point on an image, which can be determined by a known camera calibration technique. In the embodiment, the following is used as the internal parameters.</p><p id="p0038" num="0038">If f denotes the focal length of a lens, c<sub>x</sub> denotes the X coordinate of the center of the optical axis of a camera in an image, c<sub>y</sub> denotes the Y coordinate of the center of the optical axis of the camera in the image, s<sub>x</sub> denotes the width of an image sensor per pixel, and s<sub>y</sub> denotes the height of the image sensor per pixel, the internal parameters of the base camera 22 can be expressed as (f<sub>L</sub>, c<sub>xL</sub>, c<sub>yL</sub>, s<sub>xL</sub>, s<sub>yL</sub>) . On the other hand, the internal parameters of the reference camera 23 can be expressed as (f<sub>R</sub>, c<sub>xR</sub>, c<sub>yR</sub>, s<sub>xR</sub>, s<sub>yR</sub>). Note that the subscript L indicates<!-- EPO <DP n="13"> --> the base camera 22 drawn on the left hand of the drawings, and the subscript R indicates the reference camera 23 drawn on the right side of the drawings.</p><p id="p0039" num="0039">The posture parameters represent relative postures of the base camera 22 and the reference camera 23, which can be determined by the known camera calibration technique. In the embodiment, the posture parameters of the base camera 22 and the reference camera 23 are represented by a rotation matrix R and a translation vector t.</p><p id="p0040" num="0040">Here, in <figref idrefs="f0005">FIG. 5</figref>, a base camera coordinate system C<sub>L</sub> and a reference camera coordinate system C<sub>R</sub> are coordinate systems, which are representative of the postures of the respective cameras and arranged to agree with the coordinate systems of images in X and Y directions with their origins at the lens principal point of each camera. The above-mentioned posture parameters represent the relative postures of the base camera coordinate system C<sub>L</sub> and the reference camera coordinate system C<sub>R</sub>. Reference numerals 201 and 202 illustrated in <figref idrefs="f0005">FIG. 5 and FIG. 6</figref> represent image sensor planes of the base camera 22 and the reference camera 23, respectively, to acquire images as a result of projecting any object (e.g. workpiece) onto the image sensor planes 201 and 202. Note that the lens principal point is reversed to the actual physical layout of the image sensors in <figref idrefs="f0005">FIG. 5</figref> for simplifying the description.<!-- EPO <DP n="14"> --></p><p id="p0041" num="0041">Next, as illustrated in <figref idrefs="f0004">FIG. 4</figref>, the robot system 1 is moved to the position of an image capturing posture to acquire the first image with the base camera 22 (step S01 : first image acquiring step). Then, image processing is performed on the first image to detect the workpiece in the image (step S02). For this detection, any of known various image processing techniques, such as pattern matching or binarization can be used. After that, based on the detection result of the first image of the workpiece in step S02, a reference camera cropping range 206 to be set in the reference camera 23 is calculated (step S03). The following will describe the cropping step S03 by dividing the step into sub-steps S11 to S14. First, a base camera cropping range 203 is calculated based on the result of extracting the target object in the first image (step S11). As the base camera cropping range 203, for example, the smallest rectangular area surrounding an image area of the target object extracted in the first image is calculated.</p><p id="p0042" num="0042">Next, a cropping reference point P<sub>L</sub> is set for the calculated base camera cropping range 203. Although it is preferred that the cropping reference point P<sub>L</sub> be substantially the center of the base camera cropping range 203, any point may be used as long as the point is uniquely determined for the base camera cropping range 203. In the embodiment, if the center of gravity of the base camera cropping range 203 is used as the cropping reference point P<sub>L</sub> and the image coordinates are denoted by P<sub>L</sub> (c<sub>L</sub>, r<sub>L</sub>), P<sub>L</sub><!-- EPO <DP n="15"> --> is expressed as follows. <maths id="math0001" num=""><math display="block"><mmultiscripts><msub><mi>P</mi><mi>L</mi></msub><mprescripts/><none/><mfenced><mi mathvariant="italic">CL</mi></mfenced></mmultiscripts><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><msub><mi>z</mi><mi>L</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>s</mi><mi mathvariant="italic">xL</mi></msub><mo>⁢</mo><mfenced separators=""><msub><mi>c</mi><mi>L</mi></msub><mo>-</mo><msub><mi>c</mi><mi mathvariant="italic">xL</mi></msub></mfenced></mtd></mtr><mtr><mtd><msub><mi>s</mi><mi mathvariant="italic">yL</mi></msub><mo>⁢</mo><mfenced separators=""><msub><mi>r</mi><mi>L</mi></msub><mo>-</mo><msub><mi>c</mi><mi mathvariant="italic">yL</mi></msub></mfenced></mtd></mtr><mtr><mtd><msub><mi>f</mi><mi>L</mi></msub></mtd></mtr></mtable></mfenced></math><img id="ib0001" file="imgb0001.tif" wi="56" he="24" img-content="math" img-format="tif"/></maths></p><p id="p0043" num="0043">Here, s<sub>xL</sub> and s<sub>yL</sub> denote the image sensor size as internal parameters of the base camera 22, and c<sub>xL</sub> and c<sub>yL</sub> denote the position of the center of the optical axis on the image coordinates. Further, f<sub>L</sub> denotes the focal distance of the base camera 22. In the embodiment, no lens distortion is taken into account for simplicity's sake, but a conversion equation that takes the known lens distortion into account may be used.</p><p id="p0044" num="0044">Next, a three-dimensional point P<sub>W</sub> of the workpiece is calculated by using the cropping reference point P<sub>L</sub> and virtual workpiece depth information (step S12: three-dimensional coordinate calculating step). Here, the depth information is information for defining the distance from the lens of the base camera 22 to an area to be measured, which is preset by a user and prestored in the ROM 41a. A workpiece distance at which the lens comes into focus may be set as the depth information. If a rough distance between the workpiece and the camera can be predefined, the distance may be determined from a design value. For example, for production equipment, it is often the case that the layout rules between the workpiece and the camera are predetermined according to the production process to be carried out. Therefore, the virtual<!-- EPO <DP n="16"> --> workpiece depth information can be easily set. In the embodiment, the distance d of the base camera coordinate system C<sub>L</sub> is defined, and z=d is set as the depth information and stored in the ROM 41a.</p><p id="p0045" num="0045">As illustrated in <figref idrefs="f0005">FIG. 5</figref>, the three-dimensional point P<sub>W</sub> of the workpiece is an intersection point of a line of sight 204, which connects the origin of the base camera coordinate system C<sub>L</sub> and the cropping reference point P<sub>L</sub>, with a plane 205 defined by the depth information z=d. Since the line of sight 204 is a straight line passing through the base camera coordinate system C<sub>L</sub> and the cropping reference point P<sub>L</sub>, the line of sight 204 is expressed as follows. <maths id="math0002" num=""><math display="block"><mi>P</mi><mo>=</mo><msup><mrow><mi>λ</mi><mo>•</mo></mrow><mfenced><mi mathvariant="italic">CL</mi></mfenced></msup><mo>⁢</mo><msub><mi>P</mi><mi mathvariant="italic">Li</mi></msub><mo>=</mo><mi>λ</mi><mo>⋅</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><msub><mi>z</mi><mi>L</mi></msub></mtd></mtr></mtable></mfenced></math><img id="ib0002" file="imgb0002.tif" wi="49" he="23" img-content="math" img-format="tif"/></maths></p><p id="p0046" num="0046">Further, if the coordinates of the three-dimensional point P<sub>W</sub> is denoted by P<sub>W</sub>=(x<sub>W</sub>, y<sub>W</sub>, z<sub>W</sub>), the three-dimensional point P<sub>W</sub> can be determined in the base camera coordinate system C<sub>L</sub> from zW=λ·fL=d as follows. <maths id="math0003" num=""><math display="block"><mmultiscripts><msub><mi>P</mi><mi>W</mi></msub><mprescripts/><none/><mfenced><mi mathvariant="italic">CL</mi></mfenced></mmultiscripts><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi>W</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi>W</mi></msub></mtd></mtr><mtr><mtd><msub><mi>z</mi><mi>W</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi>L</mi></msub><mo>⁢</mo><mi>d</mi><mo>/</mo><msub><mi>f</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi>L</mi></msub><mo>⁢</mo><mi>d</mi><mo>/</mo><msub><mi>f</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><mi>d</mi></mtd></mtr></mtable></mfenced></math><img id="ib0003" file="imgb0003.tif" wi="50" he="24" img-content="math" img-format="tif"/></maths></p><p id="p0047" num="0047">Next, a projected point P<sub>R</sub> of the three-dimensional point P<sub>W</sub> to the reference camera 23 is calculated (step S13: projection calculating step). First, the three-dimensional point P<sub>W</sub> described in the base camera<!-- EPO <DP n="17"> --> coordinate system C<sub>L</sub> is transformed to a reference camera coordinate system C<sub>R</sub>. Using the rotation matrix R and the translation vector t as the posture parameters, the coordinate transformation is performed as below. If the coordinates of the three-dimensional point P<sub>W</sub> expressed in the reference camera coordinate system C<sub>R</sub> is denoted by P<sub>W</sub>=(x'<sub>W</sub>, y'<sub>W</sub>, z'<sub>W</sub>), the three-dimensional point P<sub>W</sub> is expressed as follows. <maths id="math0004" num=""><math display="block"><mmultiscripts><msub><mi>P</mi><mi>W</mi></msub><mprescripts/><none/><mfenced><mi mathvariant="italic">CR</mi></mfenced></mmultiscripts><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi>W</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi>W</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">zʹ</mi><mi>W</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><msup><mi mathvariant="bold">R</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>•</mo><mfenced><mmultiscripts><mrow><msub><mi>P</mi><mi>W</mi></msub><mo>-</mo><mi mathvariant="bold">t</mi></mrow><mprescripts/><none/><mfenced><mi mathvariant="italic">CL</mi></mfenced></mmultiscripts></mfenced></math><img id="ib0004" file="imgb0004.tif" wi="61" he="23" img-content="math" img-format="tif"/></maths></p><p id="p0048" num="0048">Next, a projected point P<sub>R</sub> as a result of projecting, to the reference camera 23, the three-dimensional point P<sub>W</sub> expressed in the reference camera coordinate system C<sub>R</sub> is determined. Using the focal distance f<sub>R</sub> of the reference camera 23, P<sub>R</sub>=(x'<sub>R</sub>, y'<sub>R</sub>, z'<sub>R</sub>) is expressed as follows. <maths id="math0005" num=""><math display="block"><mmultiscripts><msub><mi>P</mi><mi>R</mi></msub><mprescripts/><none/><mfenced><mi mathvariant="italic">CR</mi></mfenced></mmultiscripts><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi>R</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi>R</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">zʹ</mi><mi>R</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi>W</mi></msub><mo>⁢</mo><msub><mi>f</mi><mi>R</mi></msub><mo>/</mo><msub><mi mathvariant="italic">zʹ</mi><mi>W</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi>W</mi></msub><mo>⁢</mo><msub><mi>f</mi><mi>R</mi></msub><mo>/</mo><msub><mi mathvariant="italic">zʹ</mi><mi>W</mi></msub></mtd></mtr><mtr><mtd><msub><mi>f</mi><mi>R</mi></msub></mtd></mtr></mtable></mfenced></math><img id="ib0005" file="imgb0005.tif" wi="52" he="24" img-content="math" img-format="tif"/></maths></p><p id="p0049" num="0049">Further, using the internal parameters of the reference camera 23, the image coordinates (c<sub>R</sub>, r<sub>R</sub>) of the projected point P<sub>R</sub> are expressed as follows. <maths id="math0006" num=""><math display="block"><mfenced><mtable><mtr><mtd><msub><mi>c</mi><mi>R</mi></msub></mtd></mtr><mtr><mtd><msub><mi>r</mi><mi>R</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi>R</mi></msub><mo>/</mo><msub><mi mathvariant="italic">s</mi><mi mathvariant="italic">xR</mi></msub><mo>+</mo><msub><mi mathvariant="italic">c</mi><mi mathvariant="italic">xR</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi>R</mi></msub><mo>/</mo><msub><mi mathvariant="italic">s</mi><mi mathvariant="italic">yR</mi></msub><mo>+</mo><msub><mi mathvariant="italic">c</mi><mi mathvariant="italic">yR</mi></msub></mtd></mtr></mtable></mfenced></math><img id="ib0006" file="imgb0006.tif" wi="42" he="17" img-content="math" img-format="tif"/></maths></p><p id="p0050" num="0050">According to above processing, the image<!-- EPO <DP n="18"> --> coordinates of the projected point P<sub>R</sub> as a result of projecting the three-dimensional point P<sub>W</sub> to the reference camera 23 can be calculated.</p><p id="p0051" num="0051">Next, a reference camera cropping range 206 to be set in the reference camera 23 is determined with reference to the image coordinates of the projected point P<sub>R</sub> (step S14: cropping range setting step). For example, as illustrated in <figref idrefs="f0005">FIG. 6</figref>, a rectangular area with the projected point P<sub>R</sub> as the center of gravity is set as the reference camera cropping range 206. Here, a cropping width w' and a cropping height h' of the reference camera cropping range 206 may be determined with reference to the width w and the height h of the base camera cropping range 203, or set as fixed values in advance.</p><p id="p0052" num="0052">The cropping range to be set in the reference camera 23 can be automatically calculated based on the cropping range set in the base camera 22 by executing the above processing steps S11 to S14. When the cropping range is set, a second image captured with the reference camera 23 in the cropping range is acquired (step S04: second image acquiring step), and the workpiece is extracted by performing image processing on the second image (step S05). Finally, a three-dimensional position of the workpiece is measured using the first image and the second image (step S06: three-dimensional measurement step). Since the measurement of the three-dimensional position of the workpiece in the three-dimensional measurement step can be<!-- EPO <DP n="19"> --> made by typical image processing, the description thereof will be omitted here.</p><p id="p0053" num="0053">As described above, the robot system 1 according to the first embodiment automatically calculates the reference camera cropping range to be set in the reference camera 23 based on the base camera cropping range set in the base camera 22 to measure the three-dimensional position based on the respective cropped images. Thus, the images to be calculated can be reduced, i.e., the amount of information and the amount of transmission can be reduced. This enables high-speed image processing for the three-dimensional measurement, and hence reduction in measurement time. As a result, the takt time (process working time) of the robot system 1 can be reduced.</p><p id="p0054" num="0054">&lt;Second Embodiment&gt;</p><p id="p0055" num="0055">Next, a robot system 1A according to a second embodiment of the present invention will be described with reference to <figref idrefs="f0006 f0007">FIG. 7 to FIG. 9</figref> while using <figref idrefs="f0001 f0002 f0003">FIG. 1 to FIG. 3</figref>. In the second embodiment, a method of measuring the three-dimensional position by the camera control unit is different from that in the first embodiment. Therefore, in the second embodiment, an emphasis is placed on a point different from the first embodiment, i.e. on the method of measuring the three-dimensional position by the camera control unit, and the same components as those in the first embodiment are given the same reference numerals to omit the description.<!-- EPO <DP n="20"> --></p><p id="p0056" num="0056">First, a schematic structure of the robot system 1A will be described by using <figref idrefs="f0001 f0002 f0003">FIG. 1 to FIG. 3</figref>. As illustrated in <figref idrefs="f0001 f0002 f0003">FIG. 1 to FIG. 3</figref>, the robot system 1A according to the second embodiment includes the robot 2, the mounting base 3, and a control device 4A for controlling the robot 2. The control device 4A includes a calculating device 40A and the storing device 41. The calculating device 40A includes a CPU 40aA, the image processing device 40b, and the sound processing device 40c. The CPU 40aA includes a camera control unit 5A and the robot control unit 6.</p><p id="p0057" num="0057">Next, a method of measuring the three-dimensional position of a workpiece by the camera control unit 5A when the hand 21 in the robot system 1A structured as mentioned above grips the workpiece will be described along a flowchart illustrated in <figref idrefs="f0006">FIG. 7</figref> while referring to <figref idrefs="f0007">FIG. 8 and FIG. 9</figref>. <figref idrefs="f0006">FIG. 7</figref> is a flowchart of a three-dimensional measurement by the camera control unit 5A according to the second embodiment. <figref idrefs="f0007">FIG. 8</figref> is a diagram illustrating the positional relationship between a cropping range in each of images, acquired with the base camera 22 and the reference camera 23, and a projected three-dimensional image according to the second embodiment. <figref idrefs="f0007">FIG. 9</figref> is a diagram illustrating image sensors of the base camera 22 and the reference camera 23 according to the second embodiment.</p><p id="p0058" num="0058">The following points are the same as the first embodiment: The internal parameters of the base camera 22<!-- EPO <DP n="21"> --> are expressed as (f<sub>L</sub>, c<sub>xL</sub>, c<sub>yL</sub>, s<sub>xL</sub>, s<sub>yL</sub>), the internal parameters of the reference camera 23 are expressed as (f<sub>R</sub>, c<sub>xR</sub>, c<sub>yR</sub>, s<sub>xR</sub>, s<sub>yR</sub>), and these are prestored in the ROM 41a.</p><p id="p0059" num="0059">In <figref idrefs="f0007">FIG. 8</figref>, the base camera coordinate system C<sub>L</sub> and the reference camera coordinate system C<sub>R</sub> are coordinate systems, which are representative of the postures of the base camera 22 and the reference camera 23, respectively, and arranged to agree with the coordinate systems of images in X and Y directions with their origins at the lens principal point of each camera. The above-mentioned posture parameters represent the relative postures of the base camera coordinate system C<sub>L</sub> and the reference camera coordinate system C<sub>R</sub>. Reference numerals 201 and 202 illustrated in <figref idrefs="f0007">FIG. 8 and FIG. 9</figref> represent image sensor planes of the base camera 22 and the reference camera 23, respectively, to acquire images as a result of projecting any object (e.g. workpiece) onto the image sensor planes 201 and 202. Note that the lens principal point is reversed to the actual physical layout of the image sensors in <figref idrefs="f0007">FIG. 8</figref> for simplifying the description.</p><p id="p0060" num="0060">Next, as illustrated in <figref idrefs="f0006">FIG. 7</figref>, the robot system 1 is moved to the position of an image capturing posture to acquire a first image with the base camera 22 (step S01: first image capturing step). Then, image processing is performed on the first image to detect the workpiece in the image (step S02). For this detection, any of known various image processing techniques, such as pattern matching or<!-- EPO <DP n="22"> --> binarization can be used. After that, based on the detection result of the first image of the workpiece in step S02, a reference camera cropping range 307 to be set in the reference camera 23 is calculated (step S03). The following will describe the cropping step S03 by dividing the step into sub-steps S21 to S24. First, a base camera cropping range 303 is calculated based on the result of extracting the target object in the first image (step S21). As the base camera cropping range 303, for example, the smallest rectangular area surrounding an image area of the target object extracted in the first image is calculated.</p><p id="p0061" num="0061">Next, the coordinates of vertices P<sub>Li</sub> (i=1, 2, 3, 4) are extracted with respect to the calculated base camera cropping range 303 to set the image coordinates to P<sub>L1</sub> (c<sub>Li</sub>, r<sub>Li</sub>). Next, a three-dimensional measurement target area (three-dimensional coordinates) where the workpiece can exist is determined using the vertices P<sub>Li</sub> of the base camera cropping range 303 set in the base camera 22 and virtual workpiece depth information (step S22: three-dimensional coordinate calculating step).</p><p id="p0062" num="0062">Here, the depth information is information for defining the distance from the lens of the base camera 22 to an area to be measured, which is preset by the user and prestored in the ROM 41a. Note that two points on the near side and far side from the origin of the base camera coordinate system C<sub>L</sub> may be set as the depth information to set the front end and rear end of the depth of field in a<!-- EPO <DP n="23"> --> range of focus areas from the base camera 22. If a distance range between the workpiece and the base camera 22 can be predefined, they may be determined from design values. In the embodiment, z=d<sub>1</sub> and z=d<sub>2</sub> as distances from the origin of the base camera coordinate system C<sub>L</sub> are set as the depth information and stored in the ROM 41a.</p><p id="p0063" num="0063">The three-dimensional measurement target area is an area surrounded by at least two planes obtained by light-of-sight curved surfaces (four view planes in the embodiment), defined by the base camera cropping range 303, and the depth information. As illustrated in <figref idrefs="f0007">FIG. 8</figref>, the three-dimensional measurement target area is represented as a trapezoidal square pyramid area. The coordinates of eight vertices (three-dimensional points) P<sub>Wi·j</sub> (i=1, 2, 3, 4, and j=1, 2) are determined as representative points of the three-dimensional measurement target area. Each of the three-dimensional points P<sub>Wi·j</sub> is an intersection point of the line of sight from the base camera coordinate system C<sub>L</sub> to the vertex P<sub>Li</sub> of the base camera cropping range 303 with each of planes 304 and 305. The three-dimensional point P<sub>Wi·j</sub> is calculated in step S22 below.</p><p id="p0064" num="0064">The vertex P<sub>Li</sub> (c<sub>Li</sub>, r<sub>Li</sub>) set by the image coordinates in step S21 is expressed in the base camera coordinate system C<sub>L</sub> as follows. <maths id="math0007" num=""><math display="block"><mmultiscripts><msub><mi>P</mi><mi mathvariant="italic">Li</mi></msub><mprescripts/><none/><mfenced><mi mathvariant="italic">CL</mi></mfenced></mmultiscripts><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi mathvariant="italic">Li</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi mathvariant="italic">Li</mi></msub></mtd></mtr><mtr><mtd><msub><mi>z</mi><mi mathvariant="italic">Li</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>s</mi><mi mathvariant="italic">xL</mi></msub><mo>⁢</mo><mfenced separators=""><msub><mi>c</mi><mi mathvariant="italic">Li</mi></msub><mo>-</mo><msub><mi>c</mi><mi mathvariant="italic">xL</mi></msub></mfenced></mtd></mtr><mtr><mtd><msub><mi>s</mi><mi mathvariant="italic">yL</mi></msub><mo>⁢</mo><mfenced separators=""><msub><mi>r</mi><mi mathvariant="italic">Li</mi></msub><mo>-</mo><msub><mi>c</mi><mi mathvariant="italic">yL</mi></msub></mfenced></mtd></mtr><mtr><mtd><msub><mi>f</mi><mi>L</mi></msub></mtd></mtr></mtable></mfenced><mo>,</mo><mfenced separators=""><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>4</mn></mfenced></math><img id="ib0007" file="imgb0007.tif" wi="72" he="24" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="24"> --></p><p id="p0065" num="0065">Here, s<sub>xL</sub> and s<sub>yL</sub> denote the image sensor size as internal parameters of the base camera 22, and c<sub>xL</sub> and c<sub>yL</sub> denote the position of the center of the optical axis on the image coordinates. Further, f<sub>L</sub> denotes the focal distance of the base camera 22. In the embodiment, no lens distortion is taken into account for simplicity's sake, but a conversion equation that takes the known lens distortion into account may be used.</p><p id="p0066" num="0066">The line of sight passing through the base camera coordinate system C<sub>L</sub> and the three-dimensional point P<sub>Wi·j</sub> is expressed in the following equation. <maths id="math0008" num=""><math display="block"><msub><mi>P</mi><mi>i</mi></msub><mo>=</mo><msup><mrow><mi>λ</mi><mo>•</mo></mrow><mfenced><mi mathvariant="italic">CL</mi></mfenced></msup><mo>⁢</mo><msub><mi>P</mi><mi mathvariant="italic">Li</mi></msub><mo>=</mo><mi>λ</mi><mo>•</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi mathvariant="italic">Li</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi mathvariant="italic">Li</mi></msub></mtd></mtr><mtr><mtd><msub><mi>z</mi><mi mathvariant="italic">Li</mi></msub></mtd></mtr></mtable></mfenced><mo>,</mo><mfenced separators=""><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mn>4</mn></mfenced></math><img id="ib0008" file="imgb0008.tif" wi="70" he="21" img-content="math" img-format="tif"/></maths></p><p id="p0067" num="0067">Further, the coordinates of the three-dimensional point P<sub>Wi·j</sub> is calculated as an intersection point of the line of sight with each of the planes having distances d<sub>1</sub> and d<sub>2</sub>.</p><p id="p0068" num="0068">If P<sub>Wi·j</sub> = (x<sub>Wi·j</sub>, y<sub>Wi·j</sub>, z<sub>Wi·j</sub>)<sup>T</sup>, the three-dimensional point P<sub>Wi·j</sub> can be calculated in the base camera coordinate system C<sub>L</sub> from z<sub>Wi·j</sub>=λ·f<sub>L</sub>=d<sub>j</sub> (i=1, 2, 3, 4, and j=1, 2) as follows. <maths id="math0009" num=""><math display="block"><msub><mmultiscripts><mi>P</mi><mprescripts/><none/><mfenced><mi mathvariant="italic">CL</mi></mfenced></mmultiscripts><mi mathvariant="italic">Wij</mi></msub><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr><mtr><mtd><msub><mi>z</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi>x</mi><mi mathvariant="italic">Li</mi></msub><mo>⁢</mo><msub><mi>d</mi><mi>j</mi></msub><mo>/</mo><msub><mi>f</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><msub><mi>y</mi><mi mathvariant="italic">Li</mi></msub><mo>⁢</mo><msub><mi>d</mi><mi>j</mi></msub><mo>/</mo><msub><mi>f</mi><mi>L</mi></msub></mtd></mtr><mtr><mtd><msub><mi>d</mi><mi>j</mi></msub></mtd></mtr></mtable></mfenced><mo>,</mo><mfenced separators=""><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mn>4</mn><mo>,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn></mfenced></math><img id="ib0009" file="imgb0009.tif" wi="84" he="25" img-content="math" img-format="tif"/></maths></p><p id="p0069" num="0069">Next, a projected point P<sub>Rij</sub> of the three-dimensional point P<sub>Wi·j</sub> to the reference camera 23 is<!-- EPO <DP n="25"> --> calculated (step S23: projection calculating step). First, the coordinates of P<sub>Wi·j</sub> described in the base camera coordinate system C<sub>L</sub> are transformed to the reference camera coordinate system C<sub>R</sub>. Using the rotation matrix R and the translation vector t as the posture parameters, the coordinate transformation is performed as below. If the coordinates of the three-dimensional point P<sub>Wi·j</sub> expressed in the reference camera coordinate system C<sub>R</sub> is denoted by P<sub>Wi·j</sub>=(x'<sub>Wi·j</sub>, y'<sub>Wi·j</sub>, z'<sub>Wi·j</sub>)<sup>T</sup>, the three-dimensional point P<sub>Wi·j</sub> is expressed as follows. <maths id="math0010" num=""><math display="block"><msub><mmultiscripts><mi>P</mi><mprescripts/><none/><mfenced><mi mathvariant="italic">CR</mi></mfenced></mmultiscripts><mi mathvariant="italic">Wij</mi></msub><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">zʹ</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><msup><mi mathvariant="bold">R</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>•</mo><mfenced separators=""><msub><mmultiscripts><mi>P</mi><mprescripts/><none/><mfenced><mi mathvariant="italic">CL</mi></mfenced></mmultiscripts><mi mathvariant="italic">Wij</mi></msub><mo>-</mo><mi mathvariant="bold">t</mi></mfenced><mo>,</mo><mfenced separators=""><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mn>4</mn><mo>,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn></mfenced></math><img id="ib0010" file="imgb0010.tif" wi="97" he="23" img-content="math" img-format="tif"/></maths></p><p id="p0070" num="0070">Next, a projected point P<sub>Rij</sub> as a result of projecting the three-dimensional point P<sub>Wi·j</sub> expressed in the reference camera coordinate system C<sub>R</sub> to the reference camera 23 is determined. Using the focal distance f<sub>R</sub> of the reference camera 23, P<sub>Ri·j</sub>=(x'<sub>Ri·j</sub>, y'<sub>Ri·j</sub>, z'<sub>Ri·j</sub>)<sup>T</sup> is expressed as follows. <maths id="math0011" num=""><math display="block"><msub><mmultiscripts><mi>P</mi><mprescripts/><none/><mfenced><mi mathvariant="italic">CR</mi></mfenced></mmultiscripts><mi mathvariant="italic">Rij</mi></msub><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi mathvariant="italic">Rij</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi mathvariant="italic">Rij</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">zʹ</mi><mi mathvariant="italic">Rij</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi mathvariant="italic">Wij</mi></msub><mo>⁢</mo><msub><mi>f</mi><mi>R</mi></msub><mo>/</mo><msub><mi mathvariant="italic">zʹ</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi mathvariant="italic">Wij</mi></msub><mo>⁢</mo><msub><mi>f</mi><mi>R</mi></msub><mo>/</mo><msub><mi mathvariant="italic">zʹ</mi><mi mathvariant="italic">Wij</mi></msub></mtd></mtr><mtr><mtd><msub><mi>f</mi><mi>R</mi></msub></mtd></mtr></mtable></mfenced><mo>,</mo><mfenced separators=""><mi>i</mi><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mn>4</mn><mo>,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn></mfenced></math><img id="ib0011" file="imgb0011.tif" wi="91" he="24" img-content="math" img-format="tif"/></maths></p><p id="p0071" num="0071">Further, using the internal parameters of the reference camera 23, the image coordinates (c<sub>Rij</sub>, r<sub>Rij</sub>) of the projected point P<sub>Rij</sub> are determined as follows.<!-- EPO <DP n="26"> --> <maths id="math0012" num=""><math display="block"><mfenced><mtable><mtr><mtd><msub><mi>c</mi><mi mathvariant="italic">Rij</mi></msub></mtd></mtr><mtr><mtd><msub><mi>r</mi><mi mathvariant="italic">Rij</mi></msub></mtd></mtr></mtable></mfenced><mo>=</mo><mfenced><mtable><mtr><mtd><msub><mi mathvariant="italic">xʹ</mi><mi mathvariant="italic">Rij</mi></msub><mo>/</mo><msub><mi mathvariant="italic">s</mi><mi mathvariant="italic">xR</mi></msub><mo>+</mo><msub><mi mathvariant="italic">c</mi><mi mathvariant="italic">xR</mi></msub></mtd></mtr><mtr><mtd><msub><mi mathvariant="italic">yʹ</mi><mi mathvariant="italic">Rij</mi></msub><mo>/</mo><msub><mi mathvariant="italic">s</mi><mi mathvariant="italic">yR</mi></msub><mo>+</mo><msub><mi mathvariant="italic">c</mi><mi mathvariant="italic">yR</mi></msub></mtd></mtr></mtable></mfenced><mo>,</mo><mfenced separators=""><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mn>4</mn><mo>,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn></mfenced></math><img id="ib0012" file="imgb0012.tif" wi="79" he="24" img-content="math" img-format="tif"/></maths></p><p id="p0072" num="0072">According to the above processing, the image coordinates of the projected point P<sub>Rij</sub> as a result of projecting the three-dimensional point P<sub>Wi·j</sub> of the three-dimensional measurement target area 306 to the reference camera 23 can be determined.</p><p id="p0073" num="0073">Next, a reference camera cropping range is determined to include all the projected points P<sub>Rij</sub> of the vertices of the three-dimensional measurement target area, and set in the reference camera 23 (step S24: cropping range setting step). For example, as illustrated in <figref idrefs="f0007">FIG. 9</figref>, the smallest rectangular area including the projected points P<sub>Rij</sub> and parallel to the image coordinates is used as the reference camera cropping range.</p><p id="p0074" num="0074">The reference camera cropping range 307 to be set in the reference camera 23 can be automatically calculated based on the base camera cropping range 303 set in the base camera 22 by executing the above processing steps S21 to S24. When the reference camera cropping range is set, a second image in the reference camera cropping range is next acquired (S04: second image acquiring step), and the workpiece is extracted by performing image processing on the second image (step S05). Finally, a three-dimensional position of the workpiece is measured using the first image and the second image (step S06: three-dimensional<!-- EPO <DP n="27"> --> measurement step). Since the measurement of the three-dimensional position of the workpiece in the three-dimensional measurement step can be made by typical image processing, the description thereof will be omitted here.</p><p id="p0075" num="0075">As described above, since the robot system 1A according to the second embodiment can determine the cropping range by calculating the coordinates of a small number of points alone, the cropping range can be determined at a high speed with a lower computational load than the technique for taking pixel-to-pixel correlation between the base camera 22 and the reference camera 23. Further, in the second embodiment, since the reference camera cropping range 307 is determined by taking into account the projection of the three-dimensional measurement target area 306, the object (workpiece) in the three-dimensional measurement target area 306 can be captured with the reference camera 23 in full measure.</p><p id="p0076" num="0076">While the embodiments of the present invention have been described, the present invention is not limited to the aforementioned embodiments. Further, the advantageous effects of the embodiments of the present invention are merely listed as most preferred effects derived from the present invention, and the effects of the present invention are not limited to those described in the embodiments of the present invention.</p><p id="p0077" num="0077">For example, in the first embodiment, the base camera cropping range 203 and the reference camera cropping<!-- EPO <DP n="28"> --> range 206 are cropped in the shape of a rectangle, but the present invention is not limited thereto. The base camera cropping range and the reference camera cropping range may be cropped in any two-dimensional shape other than the rectangle, such as a polygon, a circle, or an ellipse.</p><p id="p0078" num="0078">Further, in the first embodiment, the plane 205 that defines the depth information is set as the plane perpendicular to the z-axis direction of the base camera coordinate system C<sub>L</sub>, but the present invention is not limited thereto. For example, any inclination of the plane that defines the depth may be set. In this case, the depth information expressed as z=d can be set as ax+by+cz=d expanded to a typical plane equation.</p><p id="p0079" num="0079">In the second embodiment, the planes 304 and 305 that define the depth information are set as the planes perpendicular to the z direction of the base camera coordinate system C<sub>L</sub>, but the present invention is not limited thereto. For example, any inclination of the planes 304 and 305 that define the depth may be set. In this case, the depth information expressed as z=d<sub>j</sub> (j=1, 2) can be set as a<sub>i</sub>x+b<sub>i</sub>y+c<sub>i</sub>z=d<sub>i</sub> (i=1, 2) expanded to a typical plane equation.</p><p id="p0080" num="0080">Further, in the embodiments, the description has been made by using two cameras, i.e. the base camera 22 and the reference camera 23, but the present invention is not limited thereto. For example, a multi camera system composed of three or more cameras may be used. Even when<!-- EPO <DP n="29"> --> the number of reference cameras is two or more, the internal parameters and posture parameters can be determined for each camera to calculate a reference camera cropping range to be set in each reference camera based on the base camera cropping range set in one base camera.</p><p id="p0081" num="0081">According to the present invention, the projection of a three-dimensional image of a workpiece captured with a first camera is calculated, and an image of the workpiece is captured in a cropping range of a second camera set based on the calculated projection to make a three-dimensional measurement. This enables reduction in the amount of information and hence speeding up of image processing.</p><p id="p0082" num="0082">While the present invention has been described with reference to exemplary embodiments, it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.<br/>
There are provided a three-dimensional measurement apparatus capable of speeding up image processing, and a robot system including the same. The three-dimensional measurement apparatus includes: a base camera 22 for capturing an image of a workpiece; a reference camera 23 for capturing an image of the workpiece from a view point<!-- EPO <DP n="30"> --> different from the base camera 22; and a camera control unit 5 for calculating three-dimensional coordinates from a first image acquired by capturing the workpiece with the base camera 22 and preset virtual workpiece depth information, calculating the projection of a three-dimensional image of the workpiece to the reference camera 23 from the calculated three-dimensional coordinates and a posture parameter of the reference camera 23 relative to the base camera 22, setting a cropping range of the reference camera 23 based on the calculated projection, and measuring a three-dimensional position of the workpiece from the first image captured with the base camera 22 and a second image cropped in the cropping range of the reference camera 23.</p></description><claims mxw-id="PCLM56982208" lang="EN" load-source="patent-office"><!-- EPO <DP n="31"> --><claim id="c-en-0001" num="0001"><claim-text>A three-dimensional measurement apparatus comprising:
<claim-text>a first camera for capturing an image of a workpiece;</claim-text>
<claim-text>a second camera for capturing an image of the workpiece from a view point different from the first camera; and</claim-text>
<claim-text>a control unit for calculating three-dimensional coordinates from a first image acquired by capturing the workpiece with the first camera and preset virtual workpiece depth information, calculating a projection of the three-dimensional coordinates to the second camera from the calculated three-dimensional coordinates and a posture parameter of the second camera relative to the first camera, setting a cropping range of the second camera based on the calculated projection, and measuring a three-dimensional position of the workpiece from the first image captured with the first camera and a second image cropped in the cropping range of the second camera.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The three-dimensional measurement apparatus according to claim 1, wherein the control unit causes the second camera to capture the workpiece in the set cropping range in order to acquire the second image.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The three-dimensional measurement apparatus according to claim 1 or 2, wherein the control unit sets a reference point from the calculated projection and sets the cropping range to include an area preset from the set<!-- EPO <DP n="32"> --> reference point.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>A robot system comprising:
<claim-text>the three-dimensional measurement apparatus according to any one of claims 1 to 3 to make a three-dimensional measurement of the workpiece; and</claim-text>
<claim-text>a robot arm for gripping the workpiece based on the three-dimensional position of the workpiece measured by the three-dimensional measurement apparatus.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>A three-dimensional measurement method comprising:
<claim-text>a first image acquiring step for capturing a workpiece with a first camera to acquire a first image;</claim-text>
<claim-text>a three-dimensional coordinate calculating step for calculating three-dimensional coordinates from the first image acquired in the first image acquiring step and virtual workpiece depth information;</claim-text>
<claim-text>a projection calculating step for calculating a projection of the three-dimensional coordinates to a second camera from a posture parameter of the second camera relative to the first camera and the three-dimensional coordinates;</claim-text>
<claim-text>a cropping range setting step for setting a cropping range of a second image to be cropped from the second camera based on the projection calculated in the projection calculating step;</claim-text>
<claim-text>a second image acquiring step for acquiring the second image in the cropping range set in the cropping range setting step; and<!-- EPO <DP n="33"> --></claim-text>
<claim-text>a three-dimensional measurement step for making a three-dimensional measurement of the workpiece from the first image and the second image.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The three-dimensional measurement method according to claim 5, wherein in the second image acquiring step, the second camera is caused to capture the workpiece in the cropping range set in the cropping range setting step in order to acquire the second image.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>A three-dimensional measurement program for causing a computer to execute each step according to claim 5 or 6.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A computer-readable recording medium on which the three-dimensional measurement program according to claim 7 is recorded.</claim-text></claim></claims><drawings mxw-id="PDW16670596" load-source="patent-office"><!-- EPO <DP n="34"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="156" he="224" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="165" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="37"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="160" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="38"> --><figure id="f0005" num="5,6"><img id="if0005" file="imgf0005.tif" wi="160" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="39"> --><figure id="f0006" num="7"><img id="if0006" file="imgf0006.tif" wi="162" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="40"> --><figure id="f0007" num="8,9"><img id="if0007" file="imgf0007.tif" wi="162" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="155" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="158" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
