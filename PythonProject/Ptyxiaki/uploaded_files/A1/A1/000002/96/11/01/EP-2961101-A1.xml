<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961101-A1" country="EP" doc-number="2961101" kind="A1" date="20151230" family-id="48838005" file-reference-id="310471" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451580" ucid="EP-2961101-A1"><document-id><country>EP</country><doc-number>2961101</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13881926-A" is-representative="YES"><document-id mxw-id="PAPP193866128" load-source="docdb" format="epo"><country>EP</country><doc-number>13881926</doc-number><kind>A</kind><date>20131206</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193866129" load-source="patent-office" format="original"><country>EP</country><doc-number>13881926.3</doc-number><date>20131206</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162026976" ucid="CN-2013088774-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2013088774</doc-number><kind>W</kind><date>20131206</date></document-id></priority-claim><priority-claim mxw-id="PPC162029925" ucid="CN-201310119491-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201310119491</doc-number><kind>A</kind><date>20130408</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1967009555" load-source="docdb">H04L  12/775       20130101ALI20160217BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1967011586" load-source="docdb">H04L  12/24        20060101ALI20160217BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1967012607" load-source="docdb">H04L  12/703       20130101ALI20160217BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1967015725" load-source="docdb">H04L  12/26        20060101AFI20160217BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1718544893" load-source="docdb" scheme="CPC">H04Q2011/0081      20130101 LA20171221BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1718544894" load-source="docdb" scheme="CPC">H04Q  11/0067      20130101 LI20171221BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883379632" load-source="docdb" scheme="CPC">H04L  41/0695      20130101 LI20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883381018" load-source="docdb" scheme="CPC">H04L  45/586       20130101 LI20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883381597" load-source="docdb" scheme="CPC">H04L  41/0663      20130101 LI20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883381728" load-source="docdb" scheme="CPC">H04L  43/10        20130101 LA20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883382084" load-source="docdb" scheme="CPC">H04L  43/0811      20130101 LA20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883385045" load-source="docdb" scheme="CPC">H04L  41/0803      20130101 LI20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883385590" load-source="docdb" scheme="CPC">H04L  41/0806      20130101 LI20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1883385630" load-source="docdb" scheme="CPC">H04Q2011/0083      20130101 LA20161031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984018747" load-source="docdb" scheme="CPC">H04B  10/0795      20130101 FI20160114BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165546206" lang="DE" load-source="patent-office">VERFAHREN, SYSTEM UND OPTISCHER NETZWERKANSCHLUSS FÜR ETHERNET-LEISTUNGSERKENNUNG</invention-title><invention-title mxw-id="PT165546207" lang="EN" load-source="patent-office">METHOD, SYSTEM AND OPTICAL NETWORK TERMINAL FOR ETHERNET PERFORMANCE DETECTION</invention-title><invention-title mxw-id="PT165546208" lang="FR" load-source="patent-office">MÉTHODE, SYSTÈME ET TERMINAL DE RÉSEAU OPTIQUE POUR DÉTECTION DE PERFORMANCE ETHERNET</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103336158" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI TECH CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103335958" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI TECHNOLOGIES CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101646066" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Technologies Co., Ltd.</last-name><iid>100970540</iid><address><street>Huawei Administration Building Bantian</street><city>LONGGANG DISTRICT SHENZHEN, GUANGDONG 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103340892" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ZHANG HAIBO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103321638" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ZHANG, HAIBO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101647298" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ZHANG, HAIBO</last-name><address><street>Huawei Administration Building Bantian Longgang</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103325463" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>YUE JIANFEI</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103308471" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>YUE, JIANFEI</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651927" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>YUE, JIANFEI</last-name><address><street>Huawei Administration Building Bantian Longgang</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103309079" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>LIU HONGMING</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103344739" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>LIU, HONGMING</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651208" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>LIU, HONGMING</last-name><address><street>Huawei Administration Building Bantian Longgang</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101640392" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Epping - Hermann - Fischer</last-name><iid>101426474</iid><address><street>Patentanwaltsgesellschaft mbH Schloßschmidstraße 5</street><city>80639 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2013088774-W"><document-id><country>CN</country><doc-number>2013088774</doc-number><kind>W</kind><date>20131206</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014166274-A1"><document-id><country>WO</country><doc-number>2014166274</doc-number><kind>A1</kind><date>20141016</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660689492" load-source="docdb">AL</country><country mxw-id="DS660784019" load-source="docdb">AT</country><country mxw-id="DS660689494" load-source="docdb">BE</country><country mxw-id="DS660687619" load-source="docdb">BG</country><country mxw-id="DS660687883" load-source="docdb">CH</country><country mxw-id="DS660607720" load-source="docdb">CY</country><country mxw-id="DS660784020" load-source="docdb">CZ</country><country mxw-id="DS660689499" load-source="docdb">DE</country><country mxw-id="DS660607721" load-source="docdb">DK</country><country mxw-id="DS660607722" load-source="docdb">EE</country><country mxw-id="DS660611849" load-source="docdb">ES</country><country mxw-id="DS660687620" load-source="docdb">FI</country><country mxw-id="DS660687884" load-source="docdb">FR</country><country mxw-id="DS660689500" load-source="docdb">GB</country><country mxw-id="DS660607731" load-source="docdb">GR</country><country mxw-id="DS660689501" load-source="docdb">HR</country><country mxw-id="DS660784021" load-source="docdb">HU</country><country mxw-id="DS660695408" load-source="docdb">IE</country><country mxw-id="DS660607732" load-source="docdb">IS</country><country mxw-id="DS660687885" load-source="docdb">IT</country><country mxw-id="DS660607733" load-source="docdb">LI</country><country mxw-id="DS660687621" load-source="docdb">LT</country><country mxw-id="DS660612336" load-source="docdb">LU</country><country mxw-id="DS660687622" load-source="docdb">LV</country><country mxw-id="DS660687627" load-source="docdb">MC</country><country mxw-id="DS660612337" load-source="docdb">MK</country><country mxw-id="DS660612338" load-source="docdb">MT</country><country mxw-id="DS660607734" load-source="docdb">NL</country><country mxw-id="DS660689515" load-source="docdb">NO</country><country mxw-id="DS660607743" load-source="docdb">PL</country><country mxw-id="DS660687628" load-source="docdb">PT</country><country mxw-id="DS660784022" load-source="docdb">RO</country><country mxw-id="DS660687629" load-source="docdb">RS</country><country mxw-id="DS660607744" load-source="docdb">SE</country><country mxw-id="DS660687886" load-source="docdb">SI</country><country mxw-id="DS660689516" load-source="docdb">SK</country><country mxw-id="DS660607745" load-source="docdb">SM</country><country mxw-id="DS660612343" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479950" lang="EN" load-source="patent-office"><p id="pa01" num="0001">The present invention is applicable to the technical field of communications, and provides an Ethernet performance detection method and system and an optical network terminal. The method includes: receiving, by an ONT, a detection configuration instruction, and configuring a maintenance end point (MEP) according to the detection configuration instruction; configuring a performance detection path from the MEP to the VMEP according to states of the virtual maintenance end points (VMEP) configured on a main node and a backup node, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, the state of one virtual MEP is main, the state of the other virtual MEP is backup, and the main node and the backup node are access aggregation gateways; and transmitting a message to a node corresponding to the virtual MEP with the main state. When the node states of the main node and backup node are switched, the optical network terminal may automatically switch the performance detection path to the node corresponding to the virtual MEP, in order to continue to perform the network performance detection.<img id="iaf01" file="imgaf001.tif" wi="78" he="64" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759762" lang="EN" source="EPO" load-source="docdb"><p>The present invention is applicable to the technical field of communications, and provides an Ethernet performance detection method and system and an optical network terminal. The method includes: receiving, by an ONT, a detection configuration instruction, and configuring a maintenance end point (MEP) according to the detection configuration instruction; configuring a performance detection path from the MEP to the VMEP according to states of the virtual maintenance end points (VMEP) configured on a main node and a backup node, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, the state of one virtual MEP is main, the state of the other virtual MEP is backup, and the main node and the backup node are access aggregation gateways; and transmitting a message to a node corresponding to the virtual MEP with the main state. When the node states of the main node and backup node are switched, the optical network terminal may automatically switch the performance detection path to the node corresponding to the virtual MEP, in order to continue to perform the network performance detection.</p></abstract><description mxw-id="PDES98404651" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">The present application claims the priority of Chinese Application No. <patcit id="pcit0001" dnum="CN201310119491"><text>201310119491.7, filed in the Chinese Patent Office on April 8, 2013</text></patcit>, and entitled "METHOD, SYSTEM AND OPTICAL NETWORK TERMINAL OF ETHERNET PERFORMANCE DETECTION", the entire contents of which are herein incorporated by reference.</p><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0002" num="0002">The present invention belongs to communication field, and particularly, to a method and a system and an optical network terminal of Ethernet performance detection.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0003" num="0003">In an ITU-T Y.1731 protocol, Ethernet performance measurement is based on point-to-point measurement, no performance measurement solution under a network node redundancy scenario is provided, which results in that after an end node at one side of Y.1731 performance measurement is switched to a backup node due to failure, daily performance monitoring measurement will be interrupted, and the daily performance monitoring measurement may be restored only when detection is manually reestablished or when the failure of the node is restored and service is switched back.</p><p id="p0004" num="0004">In the prior art, when performance measurement under the network node redundancy scenario is performed, as shown in <figref idrefs="f0001">Fig. 1</figref>, three maintenance association end points (Maintenance association End Point, MEP): MEP1, MEP2, MEP3 are respectively configured on an optical network terminal (optical network terminal, ONT), an access aggregation gateways (access aggregation gateway, AGG)1 and an AGG2, the three MEP1, MEP2 and MEP3 belong to the same maintenance domain (Maintenance Domain, MD) and maintenance association<!-- EPO <DP n="2"> --> (Maintenance Association, MA), performance detection based on a main path is deployed, such as performance detection of the main path between the MEP1 and the MEP2; when the AGG1 is switched from a main node to a backup node, the AGG2 is upgraded from a backup node to a main node, the main path is switched to a path from the ONT to the AGG2, and the performance detection from the MEP1 to the MEP3 needs to be reconfigured.</p><p id="p0005" num="0005">In the prior art, during failure detection, since a backup path is impassable, so the MEP3 of the backup path will be overtime, which results in a fact that the MEP3 will report a continuity check (Continuity Check, CC) timeout alarm, the MEP1 will transmit a CCM carrying a remote defect indication (Remote Defect Indication, RDI), as a result, the MEP2 will report a RDI alarm, and an alarm will be raised on the entire network, but this alarm is unnecessary.</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0006" num="0006">Embodiments of the present invention provide an method and system of Ethernet performance detection, in order to solve a problem that under a network node redundancy condition, after main and backup states of a main node and a backup node are switched, an existing optical network terminal could not continue to perform Ethernet performance detection.</p><p id="p0007" num="0007">In the first aspect, an method of Ethernet performance detection is provided, including: receiving, by an optical network terminal ONT, a detection configuration instruction, and configuring a maintenance end point MEP according to the detection configuration instruction;<br/>
configuring, by the ONT, a performance detection path from the MEP to the VMEP according to states of the virtual maintenance end points (VMEP) configured on a main node and a backup node, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, the state of one virtual MEP is main, the state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices; and<br/>
<!-- EPO <DP n="3"> -->transmitting, by the ONT, a message to a node corresponding to the virtual MEP with the main state.</p><p id="p0008" num="0008">In the first possible implementation manner of the first aspect, a virtual router redundancy protocol (VRRP) or enhanced trunk (E-Trunk) is deployed between the main node and the backup node.</p><p id="p0009" num="0009">In combination with the first possible implementation manner of the first aspect, in the second possible implementation manner, the media access control (MAC) address of the virtual MEP is the virtual MAC address of the VRRP or the system ID of a link aggregation control protocol (LACP).</p><p id="p0010" num="0010">In combination with the first possible implementation manner of the first aspect, in the third possible implementation manner, the states of the VMEP is synchronously updated with the state of the VRRP, or the states of the VMEP is synchronously updated with the state of the E-Trunk.</p><p id="p0011" num="0011">In the second aspect, an optical network terminal is provided, including a maintenance end point (MEP) configuration unit, a detection path configuration unit and a message transmission unit, wherein:
<ul><li>the MEP configuration unit is configured to receive a detection configuration instruction and configure an MEP according to the detection configuration instruction;</li><li>the detection path configuration unit is configured to configure a performance detection path from the MEP to the VMEP according to states of the virtual maintenance end points (VMEP) configured on a main node and a backup node, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, the state of one virtual MEP is main, the state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices; and</li><li>the message transmission unit is configured to transmit a message to a node corresponding to the virtual MEP with the main state.</li></ul><!-- EPO <DP n="4"> --></p><p id="p0012" num="0012">In the third aspect, an Ethernet performance detection system is provided, including a main node, a backup node and an optical network terminal,<br/>
the optical network terminal includes a maintenance end point (MEP) configuration unit, a detection path configuration unit and a message transmission unit, wherein:
<ul><li>the MEP configuration unit is configured to receive a detection configuration instruction and configure an MEP according to the detection configuration instruction;</li><li>the detection path configuration unit is configured to configure a performance detection path from the MEP to the VMEP according to states of the virtual maintenance end points (VMEP) configured on a main node and a backup node, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, the state of one virtual MEP is main, the state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices; and</li><li>the message transmission unit is configured to transmit a message to a node corresponding to the virtual MEP with the main state.</li></ul></p><p id="p0013" num="0013">In the first possible implementation manner of the first aspect, a virtual router redundancy protocol (VRRP) or enhanced trunk (E-Trunk) is deployed between the main node and the backup node.</p><p id="p0014" num="0014">In combination with the first possible implementation manner of the first aspect, in the second possible implementation manner, the media access control (MAC) address of the virtual MEP is the virtual MAC address of the VRRP or the system ID of a link aggregation control protocol (LACP).</p><p id="p0015" num="0015">In combination with the first possible implementation manner of the first aspect, in the third possible implementation manner, the states of the VMEP is synchronously updated with the state of the VRRP; or the states of the VMEP is synchronously updated with the state of the E-Trunk.<!-- EPO <DP n="5"> --></p><p id="p0016" num="0016">In the embodiments of the present invention, the two virtual MEPs with an identical ID are deployed on the main node and backup node in a communication network, since the IDs of the two virtual MEPs are identical, the virtual MEPs will trace the main and backup states of the main node and backup node, namely, when the node is a main node, the virtual MEP deployed on the node becomes effective, when the node is a backup node, the virtual MEP deployed on the node becomes ineffective, and only the virtual MEP of the main node becomes effective, in this way, there is only one MEP seen from external performance, therefore, when the node states of the main node and backup node are switched, the virtual MEP deployed on the switched main node becomes effective, the optical network terminal may automatically switch the performance detection path to the node corresponding to the virtual MEP, in order to continue to perform the network performance detection without manually modifying the configuration of the performance detection path, thus saving the operation and maintenance costs of users. Wherein, the virtual MEP is a virtual MEP, the virtual MEP deployed on the main node will trace the main state of the VRRP or the E-Trunk protocol and changes itself as the effective virtual MEP, and the MEP of the standby node will not become effective, thus there is only one actually effective MEP seen from external performance.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0017" num="0017"><ul><li><figref idrefs="f0001">Fig. 1</figref> is a schematic diagram of a solution used for performing network performance measurement under a network node redundancy scenario provided in the prior art;</li><li><figref idrefs="f0002">Fig. 2</figref> is an implementation flowchart of an Ethernet performance detection method provided by embodiment 1 of the present invention;</li><li><figref idrefs="f0003">Fig. 3</figref> is a schematic diagram of a communication system under a VRRP scenario of the Ethernet performance detection method provided by embodiment 1 of the present invention;<!-- EPO <DP n="6"> --></li><li><figref idrefs="f0004">Fig. 4</figref> is a schematic diagram of a communication system under an E-Trunk scenario of the Ethernet performance detection method provided by embodiment 1 of the present invention;</li><li><figref idrefs="f0005">Fig. 5</figref> is a block diagram of a structure of an optical network terminal provided by embodiment 2 of the present invention;</li><li><figref idrefs="f0005">Fig. 6</figref> is a block diagram of a structure of an optical network terminal provided by embodiment 3 of the present invention;</li><li><figref idrefs="f0006">Fig. 7</figref> is a block diagram of a structure of an Ethernet performance detection system provided by embodiment 4 of the present invention.</li></ul></p><heading id="h0005"><b>DESCRIPTION OF THE EMBODIMENTS</b></heading><p id="p0018" num="0018">In order that the purposes, technical solutions and advantages of the present invention are clearer, a further detailed description of the present invention will be given below in combination with accompanying drawings and embodiments. It should be understood that, the specific embodiments described herein are merely used for explaining the present invention, rather than limiting the present invention.</p><p id="p0019" num="0019">In the embodiments of the present invention, two virtual MEPs with an identical ID are respectively deployed on a main node and a backup node in a communication network. Since the IDs of the two virtual MEPs are identical, only the virtual MEP of the main node becomes effective. In this way, there is only one MEP seen from external performance. Therefore, when node states of the main and backup nodes are switched, the virtual MEP deployed on a node which is switched to the bakcup node becomes effective. An optical network terminal may automatically switch a performance detection path to a node corresponding to the virtual MEP, in order to continue to perform network performance detection.</p><p id="p0020" num="0020">The implementation of the present invention will be described below in detail in combination with specific embodiments:<!-- EPO <DP n="7"> --></p><heading id="h0006">Embodiment 1</heading><p id="p0021" num="0021"><figref idrefs="f0002">Fig. 2</figref> shows an implementation flowchart of an method of Ethernet performance detection provided by embodiment 1 of the present invention. The method may be applied to a communication system as shown in <figref idrefs="f0003">Fig. 3</figref> or <figref idrefs="f0004">Fig. 4</figref>. <figref idrefs="f0003">Fig. 3</figref> shows a communication system under a scenario that a virtual router redundancy protocol (Virtual Router Redundancy Protocol, VRRP) is configured between the main node and the backup node. In <figref idrefs="f0003">Fig. 3</figref>, a personal computer PC of an user is accessed to an optical network terminal ONT through a residential gateway RGW, the ONT is aggregated to an optical line terminal OLT, the OLT is accessed to aggregation devices AGG1 and AGG2 in a dual-homing manner, and the AGG1 and the AGG2 negotiate main and backup roles through the VRRP protocol or enhanced trunk (Enhanced Trunk, E-Trunk). <figref idrefs="f0004">Fig. 4</figref> shows a communication system under a scenario that enhanced trunk (Enhanced Trunk, E-Trunk) is configured between the main node and the backup node. For convenience of illustration, only parts related to the embodiments of the present invention are shown in detail as follows:
<ul><li>in S201, the ONT receives an input detection configuration instruction, and configures an MEP according to the detection configuration instruction.</li></ul></p><p id="p0022" num="0022">In the embodiment, the ONT is accessed to the aggregation device AGG1 and aggregation device AGG2 in a dual-homing manner, and the VRRP or the E-Trunk is deployed between the AGG1 and the AGG2, wherein, it is assumed that the AGG1 is a main router initially and the AGG2 is a backup router initially, and the flow of the ONT will firstly pass by the AGG1 to arrive at a retail service provider (Retail Service Provider, RSP) network. It should be noted that, the main and backup states of the AGG1 and AGG2 depend upon the VRRP or the E-Trunk.</p><p id="p0023" num="0023">Before performing Ethernet performance detection, the MEP needs to be configured on the ONT firstly, the identifier ID of the MEP may be set as 1, and the MEP is marked as MEP1.</p><p id="p0024" num="0024">In S202, the ONT configures a performance detection path, according to states of the virtual maintenance end points (VMEP) configured on the main node and backup node, from the MEP<!-- EPO <DP n="8"> --> to the VMEP, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, respectively, the IDs of the two virtual MEPs are identical, at the same moment, a state of one virtual MEP is main, a state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices, for example, the AGG1 and AGG2 in <figref idrefs="f0004">Fig. 4</figref> and <figref idrefs="f0005">Fig. 5</figref>.</p><p id="p0025" num="0025">In the embodiment of the present invention, after the identifier ID of the MEP is configured to 1 on the ONT, the virtual MEPs (virtual MEP, VMEP) are respectively configured on the aggregation device AGG1 and aggregation device AGG2, IDs of the two virtual MEPs configured on the aggregation device AGG1 and the aggregation device AGG2 are identical. In the embodiment, the IDs of the two virtual MEPs are 2, thus being called VMEP2. In addition, at the same moment, a state of one virtual MEP is main, and a state of the other virtual MEP is backup.</p><p id="p0026" num="0026">Wherein, the main and backup states of the virtual MEP are synchronously updated with a state of the VRRP and will follow main and backup states of the VRRP, the state of the virtual MEP of the node with a main state in the VRRP is main, and the state of the virtual MEP of the node with a backup state in the VRRP is backup. The main and backup states of the virtual MEP are synchronously updated with a state of the E-Trunk and will follow main and backup states of the E-Trunk, the state of the virtual MEP of the node with a main state in the E-Trunk is main, and the state of the virtual MEP of the node with a backup state in the E-Trunk is backup.</p><p id="p0027" num="0027">Taking the E-Trunk as an example, two E-Trunk nodes are respectively called a local E-Trunk and an opposite E-Trunk, and variation relationship between a state of a virtual MEP deployed on the local E-Trunk and a state of a local E-Trunk is as shown in table 1:<!-- EPO <DP n="9"> -->
<tables id="tabl0001" num="0001"><table frame="all"><title>Table 1</title><tgroup cols="5"><colspec colnum="1" colname="col1" colwidth="24mm"/><colspec colnum="2" colname="col2" colwidth="33mm"/><colspec colnum="3" colname="col3" colwidth="32mm"/><colspec colnum="4" colname="col4" colwidth="27mm"/><colspec colnum="5" colname="col5" colwidth="23mm"/><thead><row><entry valign="top"><b>State of the</b></entry><entry valign="top"><b>Member</b></entry><entry valign="top"><b>State of the</b></entry><entry valign="top"><b>State of the</b></entry><entry valign="top"><b>State of</b></entry></row><row><entry valign="top">local E-Trunk</entry><entry valign="top">Eth-Trunk mode</entry><entry valign="top">opposite Eth-Trunk</entry><entry valign="top">local Eth-Trunk</entry><entry valign="top">local<b>VMEP 2</b></entry></row></thead><tbody><row><entry>-</entry><entry>Compulsory main</entry><entry>-</entry><entry>Main</entry><entry>Main</entry></row><row><entry>-</entry><entry>Compulsory backup</entry><entry>-</entry><entry>Backup</entry><entry>Backup</entry></row><row><entry>Main</entry><entry>Automatic</entry><entry>Backup</entry><entry>Main</entry><entry>Main</entry></row><row><entry>Backup</entry><entry>Automatic</entry><entry>Backup</entry><entry>Main</entry><entry>Main</entry></row><row><entry>Backup</entry><entry>Automatic</entry><entry>Main</entry><entry>Backup</entry><entry>Backup</entry></row></tbody></tgroup></table></tables>
wherein, in table 1, the first column is an initial state of the local E-Trunk, the second column and the third column are respectively input conditions, the fourth column and the fifth column are final states, for example, the initial state of the local E-Trunk is "backup", the current member E-Trunk is at an automatic mode, after a state of the opposite E-Trunk becomes backup, a state of the local E-Trunk becomes "main", and the virtual MEP deployed locally, namely VMEP2, also becomes "main".</p><p id="p0028" num="0028">At the initial state, since the state of the virtual MEP on the AGG1 is main, the virtual MEP on the AGG1 becomes effective, thus the performance detection path from the MEP1 to the VMEP2 is from the ONT to the main node AGG1.</p><p id="p0029" num="0029">When the main and backup states of the AGG1 and AGG2 are switched, the state of the virtual MEP on the AGG2 is main, the virtual MEP on the AGG2 becomes effective, thus the performance detection path from the MEP1 to the VMEP2 is from the ONT to the main node AGG2.</p><p id="p0030" num="0030">In addition, a media access control (Media Access Control, MAC) address of the virtual MEP may be a virtual MAC address of the VRRP, of course. The MAC address of the virtual MEP may also be a system ID of a link aggregate control protocol (Link Aggregate Control Protocol, LACP) (the system ID is an MAC address, and the system IDs of the main node and backup node are identical). In this case, MAC addresses of sources of messages transmitted by the virtual MEPs of the main node and backup node are identical.<!-- EPO <DP n="10"> --></p><p id="p0031" num="0031">In S203, the ONT transmits a message to a node corresponding to the virtual MEP with the main state.</p><p id="p0032" num="0032">In the embodiment of the present invention, at the initial state, the state of the virtual MEP on the AGG1 is main, the virtual MEP on the AGG1 becomes effective, thus the performance detection path from the MEP1 to the VMEP2 is from the ONT to the AGG1, and the ONT transmits the message to the main node AGG1 according to the path.</p><p id="p0033" num="0033">When the main and backup states of the main node and backup node are switched, the AGG2 becomes the main node, and the AGG1 becomes the backup node, thus the states of the VMEP on the AGG2 is correspondingly changed to be main, the states of the VMEP on the AGG1 is correspondingly changed to be backup, and the virtual MEP on the AGG2 becomes effective, thus the performance detection path from the MEP1 to the VMEP2 is from the ONT to the main node AGG2.</p><p id="p0034" num="0034">Wherein, it should be noted that, VRRP main and backup switch may occur between the main node and the backup node, and E-Trunk main and backup switch may also occur. The VRRP and the E-Trunk are both suitable for a main and backup dual-homing scenario and are protocols used for negotiating a main and backup. Compared with the E-Trunk, the deployment of the VRRP is more flexible, a heartbeat line is uncessary between the main node and the backup node , and the message may be transferred by a downlink ONT device.</p><p id="p0035" num="0035">In addition, it should be noted that, the performance detection in the embodiment is illustrated by taking packet loss and delay detection as examples, but is applicable to such failure detection as continuity check (Continuity Check, CC), loopback (LoopBack, LB), link trace (Link Trace, LT) and the like.</p><p id="p0036" num="0036">In the embodiment of the present invention, the two virtual MEPs with an identical ID are deployed on a main node and backup node in a communication network. Since the IDs of the two virtual MEPs are identical, and the virtual MEPs will trace the main and backup states of the<!-- EPO <DP n="11"> --> main node and backup node, only the virtual MEP of the main node becomes effective, in this way, there is only one MEP seen from external performance. Therefore, when the node states of the main node and backup node are switched, the virtual MEP deployed on the swithced main node becomes effective, the optical network terminal may automatically switch the performance detection path to the node corresponding to the virtual MEP, the network performance detection may be perform continually, without manually modifying the configuration of the performance detection path, thus the operation and maintenance costs of users may be saved.</p><heading id="h0007">Embodiment 2</heading><p id="p0037" num="0037"><figref idrefs="f0005">Fig. 5</figref> shows a block diagram of a structure of an optical network terminal provided by embodiment 2 of the present invention, the optical network terminal may form a system of Ethernet performance detection together with a main node and backup node, wherein the main node and the backup node are access aggregation devices, for convenience of illustration, only the parts related to the embodiment of the present invention are shown, and the optical network terminal 5 includes an MEP configuration unit 51, a detection path configuration unit 52 and a message transmission unit 53.</p><p id="p0038" num="0038">Wherein the MEP configuration unit 51 is configured to receive an input detection configuration instruction and configure a maintenance end point MEP according to the detection configuration instruction;<br/>
the detection path configuration unit 52 is configured to configure a performance detection path, according to states of the virtual maintenance end points (VMEP) configured on a main node and a backup node, from the MEP to the VMEP, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, a state of one virtual MEP is main, a state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices;<br/>
<!-- EPO <DP n="12"> -->the message transmission unit 53 is configured to transmit a message to a node corresponding to the virtual MEP with the main state.</p><p id="p0039" num="0039">It should be further noted that: a virtual router redundancy protocol VRRP or E-Trunk is deployed between the main node and the backup node;<br/>
a media access control MAC of the virtual MEP is a virtual MAC of the VRRP or a system ID of a link aggregation control protocol LACP;<br/>
the states of the VMEP is synchronously updated with a state of the VRRP or a state of the E-Trunk.</p><p id="p0040" num="0040">The optical network terminal provided by the embodiment may be used in the foregoing corresponding optical network terminal to perform the method of Ethernet performance detection, specific reference is made to related descriptions of the embodiment corresponding to <figref idrefs="f0002">Fig. 2</figref> of the above-mentioned optical network terminal for performing the method of Ethernet performance detection, and will not be repeated redundantly herein.</p><p id="p0041" num="0041">It should be noted that, in the above-mentioned embodiment of the optical network terminal, the division of the included units is only a logic function division, but is not limited to the above-mentioned division, as long as corresponding functions may be achieved; in addition, the specific titles of the functional units are merely for mutual distinguishment, rather than limiting the protection scope of the present invention.</p><heading id="h0008">Embodiment 3</heading><p id="p0042" num="0042"><figref idrefs="f0005">Fig. 6</figref> shows a block diagram of a structure of an optical network terminal provided by embodiment 3 of the present invention; the optical network terminal may form an system of Ethernet performance detection together with a main node and backup node, wherein the main node and the backup node are access aggregation devices, for convenience of illustration, only the parts related to the embodiment of the present invention are shown, and the optical network terminal 6 includes a receiver 61, a microprocessor 62 and a transmitter 63.<!-- EPO <DP n="13"> --></p><p id="p0043" num="0043">Wherein, the receiver 61 is configured to receive an input detection configuration instruction;<br/>
the microprocessor 62 is configured to configure a maintenance end point MEP according to the detection configuration instruction, configure a performance detection path, according to the states of the virtual maintenance end points (VMEP) configured on the main node and the backup node, from the MEP to the VMEP, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, a state of one virtual MEP is main, a state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices;<br/>
the transmitter 63 is configured to transmit a message to a node corresponding to the virtual MEP with the main state.</p><p id="p0044" num="0044">It should be further noted that: a virtual router redundancy protocol VRRP or E-Trunk is deployed between the main node and the backup node;<br/>
a media access control MAC of the virtual MEP is a virtual MAC of the VRRP or a system ID of a link aggregation control protocol LACP;<br/>
the states of the VMEP is synchronously updated with a state of the VRRP or a state of the E-Trunk.</p><p id="p0045" num="0045">The optical network terminal provided by the embodiment may be used in the foregoing corresponding optical network terminal to perform the method of Ethernet performance detection, specific reference is made to related descriptions of the embodiment corresponding to <figref idrefs="f0002">Fig. 2</figref> of the above-mentioned optical network terminal for performing the method of Ethernet performance detection, and will not be repeated redundantly herein.</p><heading id="h0009">Embodiment 4</heading><p id="p0046" num="0046"><figref idrefs="f0006">Fig. 7</figref> shows a block diagram of a structure of an system of Ethernet performance detection provided by embodiment 4 of the present invention. The system of Ethernet performance<!-- EPO <DP n="14"> --> detection includes a residential gateway RGW, an optical network terminal ONT, an optical line terminal OLT, aggregation devices AGG1 and AGG2. Wherein, a PC of an user is accessed to the optical network terminal ONT through the residential gateway RGW, the ONT is aggregated to the optical line terminal OLT, the OLT is accessed to the aggregation devices AGG1 and AGG2 in a dual-homing manner, and the AGG1 and the AGG2 negotiate main and backup roles through the VRRP protocol or E-Trunk.</p><p id="p0047" num="0047">Wherein, two virtual MEPs with an identical ID are deployed on the AGG1 and AGG2, since the IDs of the two virtual MEPs are identical, the virtual MEPs will trace the main and backup states of the AGG1 and AGG2, namely, when the AGG1 is a main node, the virtual MEP deployed on the AGG1 becomes effective, when the AGG1 is a backup node, the virtual MEP deployed on the AGG1 becomes ineffective, and only the virtual MEP deployed on the main node becomes effective, in this way, there is only one MEP seen from external performance. Therefore, when the node states of the AGG1 and AGG2 are switched, the virtual MEP deployed on the node which is switched to the main node becomes effective, the optical network terminal may automatically switch the performance detection path to the node corresponding to the virtual MEP, the network performance detection may be performed continually, without manually modifying the configuration of the performance detection path, thus the operation and maintenance costs of users may be saved.</p><p id="p0048" num="0048">The specific structure of the optical network terminal ONT is as shown in embodiment 2, and will not be repeat redundantly herein.</p><p id="p0049" num="0049">In addition, those of ordinary skill in the art may understand that all or a part of the steps of the methods in the above-mentioned embodiments may be implemented by a program instructing relevant hardware, the corresponding program may be stored in a computer readable storage medium, for example, the storage medium may be an ROM/RAM, a magnetic disk or optical disk, etc.<!-- EPO <DP n="15"> --></p><p id="p0050" num="0050">The foregoing descriptions are merely preferred embodiments of the present invention, rather than limiting the present invention, and any equivalent modifications or equivalent substitutions and improvements and the like, made within the spirit and principle of the present invention, are all encompassed in the protection scope of the present invention.</p></description><claims mxw-id="PCLM90459592" lang="EN" load-source="patent-office"><!-- EPO <DP n="16"> --><claim id="c-en-0001" num="0001"><claim-text>An method for detecting Ethernet performance, comprising:
<claim-text>receiving, by an optical network terminal ONT, a detection configuration instruction, and configuring a maintenance end point MEP according to the detection configuration instruction;</claim-text>
<claim-text>configuring, by the ONT, a performance detection path, according to states of a virtual maintenance end points VMEP configured on a main node and backup node, from the MEP to the VMEP, wherein the VMEP comprises two virtual MEPs configured on the main node and backup node, IDs of the two virtual MEPs are identical, at the same moment, a state of one virtual MEP is main, a state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices; and</claim-text>
<claim-text>transmitting, by the ONT, a message to a node corresponding to the virtual MEP with the main state.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein a virtual router redundancy protocol VRRP or enhanced trunk E-Trunk is deployed between the main node and the backup node.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 2, wherein a media access control MAC address of the virtual MEP is a virtual MAC address of the VRRP or a system ID of a link aggregate control protocol LACP.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to claim 2, wherein the state of the VMEP is synchronously updated with a state of the VRRP; or<br/>
the state of the VMEP is synchronously updated with a state of the E-Trunk.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>An optical network terminal, comprising a maintenance end point MEP configuration unit, a detection path configuration unit and a message transmission unit, wherein:<!-- EPO <DP n="17"> -->
<claim-text>the MEP configuration unit is configured to receive a detection configuration instruction and configure an MEP according to the detection configuration instruction;</claim-text>
<claim-text>the detection path configuration unit is configured to configure a performance detection path, according to states of the virtual maintenance end points VMEP configured on a main node and backup node, from the MEP to the VMEP, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, a state of one virtual MEP is main, a state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices; and</claim-text>
<claim-text>the message transmission unit is configured to transmit a message to a node corresponding to the virtual MEP with the main state.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>An Ethernet performance detection system, comprising a main node, a backup node and an optical network terminal,<br/>
the optical network terminal includes a maintenance end point (MEP) configuration unit, a detection path configuration unit and a message transmission unit, wherein:
<claim-text>the MEP configuration unit is configured to receive a detection configuration instruction and configure an MEP according to the detection configuration instruction;</claim-text>
<claim-text>the detection path configuration unit is configured to configure a performance detection path from the MEP to the VMEP according to states of the virtual maintenance end points (VMEP) configured on a main node and backup node, wherein the VMEP includes two virtual MEPs configured on the main node and backup node, the IDs of the two virtual MEPs are identical, at the same moment, the state of one virtual MEP is main, the state of the other virtual MEP is backup, and the main node and the backup node are access aggregation devices; and</claim-text>
<claim-text>the message transmission unit is configured to transmit a message to a node corresponding to the virtual MEP with the main state.</claim-text><!-- EPO <DP n="18"> --></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The Ethernet performance detection system according to claim 6, wherein a virtual router redundancy protocol VRRP or enhanced trunk E-Trunk is deployed between the main node and the backup node.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The Ethernet performance detection system according to claim 7, wherein a media access control (MAC) address of the virtual MEP is a virtual MAC address of the VRRP or a system ID of a link aggregate control protocol LACP.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The Ethernet performance detection system of claim 7, wherein the state of the VMEP is synchronously updated with a state of the VRRP; or the state of the VMEP is synchronously updated with a state of the E-Trunk.</claim-text></claim></claims><drawings mxw-id="PDW20422314" load-source="patent-office"><!-- EPO <DP n="19"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="151" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="20"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="157" he="136" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="21"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="152" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="22"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="153" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="23"> --><figure id="f0005" num="5,6"><img id="if0005" file="imgf0005.tif" wi="89" he="203" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="24"> --><figure id="f0006" num="7"><img id="if0006" file="imgf0006.tif" wi="158" he="70" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="163" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="163" he="233" type="tif"/><doc-page id="srep0003" file="srep0003.tif" wi="163" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
