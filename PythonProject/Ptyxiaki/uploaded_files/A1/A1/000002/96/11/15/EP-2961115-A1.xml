<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961115-A1" country="EP" doc-number="2961115" kind="A1" date="20151230" family-id="53513954" file-reference-id="318335" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451227" ucid="EP-2961115-A1"><document-id><country>EP</country><doc-number>2961115</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-15173003-A" is-representative="YES"><document-id mxw-id="PAPP193865422" load-source="docdb" format="epo"><country>EP</country><doc-number>15173003</doc-number><kind>A</kind><date>20150619</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193865423" load-source="patent-office" format="original"><country>EP</country><doc-number>15173003.3</doc-number><date>20150619</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162028779" ucid="CN-201410289737-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201410289737</doc-number><kind>A</kind><date>20140624</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1744169480" load-source="docdb">H04L  12/761       20130101ALI20171010BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1744169481" load-source="docdb">H04L  12/753       20130101ALI20171010BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1744169482" load-source="docdb">H04L  12/723       20130101ALN20171010BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1744169483" load-source="docdb">H04L  12/721       20130101AFI20171010BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1744169484" load-source="docdb">H04L  12/46        20060101ALN20171010BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1744169485" load-source="docdb">H04L  12/18        20060101ALI20171010BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1892462220" load-source="docdb" scheme="CPC">H04L  12/462       20130101 LI20160929BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1892465872" load-source="docdb" scheme="CPC">H04L2012/4629      20130101 LA20160929BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1892466204" load-source="docdb" scheme="CPC">H04L  45/48        20130101 LI20160929BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1892466249" load-source="docdb" scheme="CPC">H04L  45/66        20130101 LI20160929BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1892466330" load-source="docdb" scheme="CPC">H04L  45/50        20130101 LA20160929BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984696629" load-source="docdb" scheme="CPC">H04L  45/16        20130101 LI20151224BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984700700" load-source="docdb" scheme="CPC">H04L  12/4633      20130101 LI20151224BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984701759" load-source="docdb" scheme="CPC">H04L  45/74        20130101 LI20151224BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984702040" load-source="docdb" scheme="CPC">H04L  12/185       20130101 FI20151224BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984703648" load-source="docdb" scheme="CPC">H04L  49/201       20130101 LI20151224BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984704076" load-source="docdb" scheme="CPC">H04L  12/18        20130101 LI20151224BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165545147" lang="DE" load-source="patent-office">VERFAHREN, VORRICHTUNG UND SYSTEM ZUM SENDEN VON MULTICAST-PAKETEN ÜBER VIRTUELLES SCHICHT-2-NETZWERK</invention-title><invention-title mxw-id="PT165545148" lang="EN" load-source="patent-office">METHOD, DEVICE, AND SYSTEM FOR TRANSMITTING MULTICAST PACKET ACROSS LAYER 2 VIRTUAL NETWORK</invention-title><invention-title mxw-id="PT165545149" lang="FR" load-source="patent-office">PROCÉDÉ, DISPOSITIF ET SYSTÈME DE TRANSMISSION DE PAQUETS DE MULTIDIFFUSION SUR UN RÉSEAU VIRTUEL DE COUCHE 2</invention-title><citations><patent-citations><patcit mxw-id="PCIT381662121" load-source="docdb" ucid="US-20130201986-A1"><document-id format="epo"><country>US</country><doc-number>20130201986</doc-number><kind>A1</kind><date>20130808</date></document-id><sources><source name="SEA" category="XI" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>None</text><sources><source mxw-id="PNPL62141700" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR1103304465" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI TECH CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103342747" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI TECHNOLOGIES CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101646959" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Technologies Co., Ltd.</last-name><iid>100970540</iid><address><street>Huawei Administration Building Bantian</street><city>LONGGANG DISTRICT SHENZHEN, GUANGDONG 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103317873" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HAO WEIGUO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103325272" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HAO, WEIGUO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101649185" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>HAO, WEIGUO</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>518129, P.R. Shenzhen</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103304418" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>WU GUANGRUI</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103332003" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>Wu, Guangrui</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651942" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>Wu, Guangrui</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>518129, P.R. Shenzhen</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103313945" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>LI YIHONG</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103320334" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>LI, YIHONG</last-name></addressbook></inventor><inventor mxw-id="PPAR1101647927" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>LI, YIHONG</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>518129, P.R. Shenzhen</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103340782" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>ZHANG CHENGSONG</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103303365" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>Zhang, Chengsong</last-name></addressbook></inventor><inventor mxw-id="PPAR1101640881" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>Zhang, Chengsong</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>518129, P.R. Shenzhen</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101644740" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Lord, Michael</last-name><iid>100051442</iid><address><street>Gill Jennings &amp; Every LLP The Broadgate Tower 20 Primrose Street</street><city>London EC2A 2ES</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS660684202" load-source="docdb">AL</country><country mxw-id="DS660607142" load-source="docdb">AT</country><country mxw-id="DS660684220" load-source="docdb">BE</country><country mxw-id="DS660682215" load-source="docdb">BG</country><country mxw-id="DS660681755" load-source="docdb">CH</country><country mxw-id="DS660606849" load-source="docdb">CY</country><country mxw-id="DS660607143" load-source="docdb">CZ</country><country mxw-id="DS660681662" load-source="docdb">DE</country><country mxw-id="DS660684221" load-source="docdb">DK</country><country mxw-id="DS660606850" load-source="docdb">EE</country><country mxw-id="DS660604061" load-source="docdb">ES</country><country mxw-id="DS660682216" load-source="docdb">FI</country><country mxw-id="DS660682217" load-source="docdb">FR</country><country mxw-id="DS660681667" load-source="docdb">GB</country><country mxw-id="DS660684222" load-source="docdb">GR</country><country mxw-id="DS660684231" load-source="docdb">HR</country><country mxw-id="DS660606855" load-source="docdb">HU</country><country mxw-id="DS660681756" load-source="docdb">IE</country><country mxw-id="DS660684232" load-source="docdb">IS</country><country mxw-id="DS660682218" load-source="docdb">IT</country><country mxw-id="DS660606856" load-source="docdb">LI</country><country mxw-id="DS660681668" load-source="docdb">LT</country><country mxw-id="DS660607144" load-source="docdb">LU</country><country mxw-id="DS660681669" load-source="docdb">LV</country><country mxw-id="DS660681670" load-source="docdb">MC</country><country mxw-id="DS660782273" load-source="docdb">MK</country><country mxw-id="DS660782274" load-source="docdb">MT</country><country mxw-id="DS660604062" load-source="docdb">NL</country><country mxw-id="DS660682223" load-source="docdb">NO</country><country mxw-id="DS660604075" load-source="docdb">PL</country><country mxw-id="DS660682224" load-source="docdb">PT</country><country mxw-id="DS660604076" load-source="docdb">RO</country><country mxw-id="DS660682225" load-source="docdb">RS</country><country mxw-id="DS660604077" load-source="docdb">SE</country><country mxw-id="DS660681757" load-source="docdb">SI</country><country mxw-id="DS660782275" load-source="docdb">SK</country><country mxw-id="DS660782276" load-source="docdb">SM</country><country mxw-id="DS660606857" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479597" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A gateway receives an LSP that includes a network identifier of a Layer 2 virtual network and a multicast address and that is sent by each RB that is on the TRILL network; separately performs calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address; if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, sends a notification message including the network identifier and the multicast address that are in the matched combination to each RB; receives from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwards the multicast packet.
<img id="iaf01" file="imgaf001.tif" wi="128" he="79" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759409" lang="EN" source="EPO" load-source="docdb"><p>A gateway receives an LSP that includes a network identifier of a Layer 2 virtual network and a multicast address and that is sent by each RB that is on the TRILL network; separately performs calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address; if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, sends a notification message including the network identifier and the multicast address that are in the matched combination to each RB; receives from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwards the multicast packet.</p></abstract><description mxw-id="PDES98404298" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">The present invention relates to the computer network field, and in particular, to a method, device, and system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">The Transparent Interconnection of Lots of Links (TRILL) protocol, recommended by the Internet Engineering Task Force (IETF), is a routing protocol according to which calculation is performed based on a link state on a Layer 2 network, to resolve a deficiency in a Spanning Tree Protocol (STP) in a large data center. The data center may use TRILL to build a large Layer 2 network, to overcome shortcomings of a traditional Layer 2 network: a low bandwidth utilization and slow convergence.</p><p id="p0003" num="0003"><figref idrefs="f0001">FIG. 1</figref> is a schematic architectural diagram of a TRILL network in the prior art. As shown in <figref idrefs="f0001">FIG. 1</figref>, the TRILL network uses a two-layer structure, including multiple routing bridges (RB) having an access function, and multiple gateways having a forwarding function. On the TRILL network, a same TRILL physical network may be shared by different tenants (a tenant refers to a user using a system and computer computing resource). Each tenant uses at least one Layer 2 virtual network. Each Layer 2 virtual network is identified by a 12-bit virtual local area network identifier (VLAN ID) or a 24-bit fine grained label (FGL). Each Layer 2 virtual network may include multiple terminals. Different terminals on a same Layer 2 virtual network may access different routing bridges, and the different terminals can communicate with each other by using one or more routing bridges. A multicast packet may be forwarded between terminals of different Layer 2 virtual networks by using any gateway<!-- EPO <DP n="2"> --> that is on the TRILL network.</p><p id="p0004" num="0004">Generally, on a TRILL network, according to a Protocol Independent Multicast (PIM) protocol, each Layer 2 virtual network specifies a gateway that forwards a multicast packet for the Layer 2 virtual network, that is, only the gateway specified by the Layer 2 virtual network can copy and forward a multicast packet sent by each terminal that is on the Layer 2 virtual network. For example, in <figref idrefs="f0001">FIG. 1</figref>, assuming that terminal 1 and terminal 3 are on Layer 2 virtual network VLAN 10 (the VLAN 10 is not shown in <figref idrefs="f0001">FIG. 1</figref>) and a specified gateway of Layer 2 virtual network VLAN 10 is gateway 1, only gateway 1 can forward a multicast packet that is on the VLAN 10. In this case, if terminal 1 sends 1,000 groups of different multicast packets, the 1,000 groups of multicast packets can be copied and forwarded across Layer 2 virtual networks by using only gateway 1.</p><p id="p0005" num="0005">Due to the one-to-one correspondence between a gateway and a Layer 2 virtual network, all multicast packets on a Layer 2 virtual network are copied and forwarded by using a fixed gateway. Therefore, when a large number of multicast packets on a Layer 2 virtual network need to be forwarded, a specified gateway of the Layer 2 virtual network has a relatively heavy burden.</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0006" num="0006">The present invention provides a method, device, and system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network, to resolve a problem in the prior art that when a large number of multicast packets need to be forwarded on a Layer 2 virtual network, a gateway transmitting a multicast packet for the Layer 2 virtual network is overburdened.</p><p id="p0007" num="0007">According to a first aspect, the present invention provides a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network, including:
<ul><li>receiving, by a gateway, a link state packet LSP sent by each routing bridge RB, where each LSP includes: a network identifier of a Layer 2 virtual network and a multicast address;</li><li>separately performing, by the gateway, calculation on the network identifier<!-- EPO <DP n="3"> --> and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address;</li><li>if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, sending a notification message to each RB that is on the TRILL network, where the notification message includes the network identifier and the multicast address that are in the matched combination; and</li><li>receiving, by the gateway from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwarding the multicast packet.</li></ul></p><p id="p0008" num="0008">With reference to the first aspect, in a first possible implementation manner of the first aspect, the separately performing, by the gateway, calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address includes:
<ul><li>separately performing, by the gateway, data conversion on the network identifier and the multicast address that are in each LSP, and performing computation in combination with a total number of gateways that are on the TRILL network, to obtain the calculation result corresponding to each combination of the network identifier and the multicast address.</li></ul></p><p id="p0009" num="0009">With reference to the first possible implementation manner of the first aspect, in a second possible implementation manner of the first aspect,<br/>
the network identifier is a 12-bit virtual local area network identifier VLAN ID;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k; and<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m, and m=(VLAN ID&lt;&lt;32+Group Address)%k, where<br/>
<!-- EPO <DP n="4"> -->"&lt;&lt;" indicates right shifting, and "%" indicates performing a modulo operation.</p><p id="p0010" num="0010">With reference to the first possible implementation manner of the first aspect, in a third possible implementation manner of the first aspect,<br/>
the network identifier is a 24-bit fine grained label FGL;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k; and<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m, and m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k, where<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and "|" indicates an OR operation.</p><p id="p0011" num="0011">With reference to the second possible implementation manner of the first aspect or the third possible implementation manner of the first aspect, in a fourth possible implementation manner of the first aspect,<br/>
the information preconfigured on the gateway is a sequence number of the gateway; the sequence number is obtained by sorting, according to TRILL protocol system identifiers system IDs of the gateways that are on the TRILL network, all the gateways that are on the TRILL network according to a natural number sequence starting from 0 and ending at k-1; and<br/>
correspondingly, the if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, sending a notification message to each RB that is on the TRILL network includes:<br/>
if the gateway determines that the sequence number of the gateway is equal to a calculation result m corresponding to the combination of the network identifier and the multicast address, sending the notification message to each RB that is on the TRILL network.</p><p id="p0012" num="0012">With reference to any implementation manner from the first aspect to the fourth possible<!-- EPO <DP n="5"> --> implementation manner of the first aspect, in a fifth possible implementation manner of the first aspect, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address that are in the matched combination; and<br/>
correspondingly, the sending a notification message to each RB that is on the TRILL network includes:
<ul><li>notifying, by the gateway, the network identifier and the multicast address that are in the matched combination to each RB that is on the TRILL network by using the first LSP.</li></ul></p><p id="p0013" num="0013">With reference to any implementation manner from the first aspect to the fourth possible implementation manner of the first aspect, in a sixth possible implementation manner of the first aspect, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address that are in the matched combination and a correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root; and correspondingly, the sending a notification message to each RB that is on the TRILL network includes:
<ul><li>notifying, by the gateway by using the extended LSP, the network identifier and the multicast address that are in the matched combination and the correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root to each RB that is on the TRILL network.</li></ul></p><p id="p0014" num="0014">According to a second aspect, the present invention provides a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network, including:
<ul><li>separately sending, by a routing bridge, a link state packet LSP to each<!-- EPO <DP n="6"> --> gateway that is on the TRILL network, where the LSP includes: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway;</li><li>receiving, by the routing bridge, a notification message sent by a first gateway, where the first gateway is a gateway on the TRILL network and information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address; and</li><li>sending, by the routing bridge, a multicast packet corresponding to the multicast address to the first gateway.</li></ul></p><p id="p0015" num="0015">With reference to the second aspect, in a first possible implementation manner of the second aspect, if the first gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address; and<br/>
correspondingly, the receiving, by the routing bridge, a notification message sent by a first gateway, and sending, a multicast packet corresponding to the multicast address to the first gateway includes:
<ul><li>receiving, by the routing bridge, the first LSP sent by the first gateway;</li><li>disposing, according to the first LSP, the first gateway on a TRILL distribution tree corresponding to the network identifier and the multicast address; and</li><li>sending the multicast packet corresponding to the multicast address to the first gateway by using the TRILL distribution tree.</li></ul></p><p id="p0016" num="0016">With reference to the second aspect, in a second possible implementation manner of the second aspect, if the first gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address and a correspondence between the network identifier and the multicast address and the TRILL distribution tree root; and<br/>
correspondingly, the receiving, by the routing bridge, a notification message<!-- EPO <DP n="7"> --> sent by a first gateway, and sending a multicast packet corresponding to the multicast address to the first gateway includes:
<ul><li>receiving, by the routing bridge, the extended LSP sent by the first gateway;</li><li>generating a local multicast entry according to the extended LSP; and sending the multicast packet corresponding to the multicast address to the first gateway by using a TRILL distribution tree whose root is the first gateway according to the local multicast entry.</li></ul></p><p id="p0017" num="0017">According to a third aspect, the present invention provides a gateway, including:
<ul><li>a receiving module, configured to receive a link state packet LSP sent by each routing bridge RB, where each LSP includes: a network identifier of a Layer 2 virtual network and a multicast address;</li><li>a calculation module, configured to separately perform calculation on the network identifier and the multicast address that are in each LSP received by the receiving module, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address;</li><li>a sending module, configured to: if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, send a notification message to each RB that is on a TRILL network, where the notification message includes the network identifier and the multicast address that are in the matched combination;</li><li>a multicast packet receiving module, configured to receive, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination; and</li><li>a multicast packet forwarding module, configured to forward the multicast packet received by the multicast packet receiving module.</li></ul></p><p id="p0018" num="0018">In a first possible implementation manner of the third aspect, with reference to the third aspect, the calculation module is specifically configured to:
<ul><li>separately perform data conversion on the network identifier and the<!-- EPO <DP n="8"> --> multicast address that are in each LSP received by the receiving module, and perform computation in combination with a total number of gateways that are on the TRILL network, to obtain the calculation result corresponding to each combination of the network identifier and the multicast address.</li></ul></p><p id="p0019" num="0019">With reference to the first possible implementation manner of the third aspect, in a second possible implementation manner of the third aspect,<br/>
the network identifier is a 12-bit virtual local area network identifier VLAN ID;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m; and<br/>
the calculation module is specifically configured to obtain, according to a formula m=(VLAN ID&lt;&lt;32+Group Address)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, where<br/>
"&lt;&lt;" indicates right shifting, and "%" indicates performing a modulo operation.</p><p id="p0020" num="0020">With reference to the first possible implementation manner of the third aspect, in a third possible implementation manner of the third aspect,<br/>
the network identifier is a 24-bit fine grained label FGL;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m; and<br/>
the calculation module is specifically configured to obtain, according to a formula m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, where<br/>
<!-- EPO <DP n="9"> -->"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and "|" indicates an OR operation.</p><p id="p0021" num="0021">With reference to the second possible implementation manner of the third aspect or the third possible implementation manner of the third aspect, in a fourth possible implementation manner of the third aspect,<br/>
the information preconfigured on the gateway is a sequence number of the gateway; the sequence number is obtained by sorting, according to TRILL protocol system identifiers system IDs of the gateways that are on the TRILL network, all the gateways that are on the TRILL network according to a natural number sequence starting from 0 and ending at k-1; and<br/>
correspondingly, the sending module is specifically configured to:
<ul><li>if the gateway determines that the sequence number of the gateway is equal to a calculation result m corresponding to a combination of the network identifier and the multicast address, sending the notification message to each RB that is on the TRILL network.</li></ul></p><p id="p0022" num="0022">With reference to any implementation manner from the third aspect to the fourth possible implementation manner of the third aspect, in a fifth possible implementation manner of the third aspect, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address that are in the matched combination; and<br/>
correspondingly, the sending module is specifically configured to:
<ul><li>notify the network identifier and the multicast address that are in the matched combination to each RB that is on the TRILL network by using the first LSP.</li></ul></p><p id="p0023" num="0023">With reference to any implementation manner from the third aspect to the fourth possible implementation manner of the third aspect, in a sixth possible implementation manner of the third aspect, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the<!-- EPO <DP n="10"> --> multicast address, and the gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address that are in the matched combination and a correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root; and correspondingly, the sending module is specifically configured to:
<ul><li>notify, by using the extended LSP, the network identifier and the multicast address that are in the matched combination and the correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root to each RB that is on the TRILL network.</li></ul></p><p id="p0024" num="0024">According to a fourth aspect, the present invention provides a routing bridge, including:<br/>
a sending module, configured to separately send a link state packet LSP to each gateway that is on a TRILL network, where the LSP includes: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway;<br/>
a receiving module, configured to receive a notification message sent by a first gateway, where the first gateway is a gateway on the TRILL network and information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address;<br/>
and<br/>
a multicast packet sending module, configured to send a multicast packet corresponding to the multicast address to the first gateway.</p><p id="p0025" num="0025">With reference to the fourth aspect, in a first possible implementation manner of the fourth aspect, if the first gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address; and correspondingly, the receiving module is specifically configured to:
<ul><li>receive the first LSP sent by the first gateway;</li><li>the routing bridge further includes:<!-- EPO <DP n="11"> -->
<ul><li>a disposing module, configured to dispose, according to the first LSP, the first gateway on a TRILL distribution tree corresponding to the network identifier and the multicast address; and</li><li>the multicast packet sending module is specifically configured to:</li></ul></li><li>send the multicast packet corresponding to the multicast address to the first<br/>
gateway by using the TRILL distribution tree.</li></ul></p><p id="p0026" num="0026">With reference to the fourth aspect, in a second possible implementation manner of the fourth aspect, if the first gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address and a correspondence between the network identifier and the multicast address and the TRILL distribution tree root; and<br/>
correspondingly, the receiving module is specifically configured to:
<ul><li>receive the extended LSP sent by the first gateway;</li><li>the routing bridge further includes:</li><li>a generating module, configured to generate a local multicast entry according to the extended LSP; and</li><li>the multicast packet sending module is specifically configured to:
<ul><li>send the multicast packet corresponding to the multicast address to the first gateway by using a TRILL distribution tree whose root is the first gateway according to the local multicast entry.</li></ul></li></ul></p><p id="p0027" num="0027">According to a fifth aspect, the present invention provides a system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network, including: a terminal, the gateway according to any implementation manner from the third aspect to the sixth possible implementation manner of the third aspect, and the routing bridge according to any implementation manner from the fourth aspect to the second possible implementation manner of the fourth aspect.</p><p id="p0028" num="0028">According to a method, device, and system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network provided by the present invention, after receiving an LSP that includes a Layer 2 virtual network identifier and a multicast address and<!-- EPO <DP n="12"> --> that is sent by a routing bridge RB, a gateway separately performs calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address; if determining that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, the gateway sends a notification message to the RB, so that the RB sends a multicast packet corresponding to the multicast address to the gateway, and the gateway forwards the multicast packet. In this way, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0029" num="0029">To describe the technical solutions in the embodiments of the present invention or in the prior art more clearly, the following briefly introduces the accompanying drawings required for describing the embodiments or the prior art. Apparently, the accompanying drawings in the following description show merely some embodiments of the present invention, and a person of ordinary skill in the art may still derive other drawings from these accompanying drawings without creative efforts.
<ul><li><figref idrefs="f0001">FIG. 1</figref> is a schematic architectural diagram of a TRILL network in the prior art;</li><li><figref idrefs="f0002">FIG. 2</figref> is a flowchart of a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 3</figref> is a flowchart of a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to another embodiment of the present invention;</li><li><figref idrefs="f0004">FIG. 4</figref> is a flowchart of a method for transmitting a multicast packet across Layer 2<!-- EPO <DP n="13"> --> virtual networks on a TRILL network according to still another embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 5</figref> is a schematic structural diagram of a gateway according to an embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 6</figref> is a schematic structural diagram of a routing bridge according to an embodiment of the present invention;</li><li><figref idrefs="f0006">FIG. 6A</figref> is a schematic structural diagram of a routing bridge according to an embodiment of the present invention;</li><li><figref idrefs="f0006">FIG. 6B</figref> is a schematic structural diagram of a routing bridge according to an embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 6C</figref> is a schematic structural diagram of a routing bridge according to an embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 7</figref> is a schematic structural diagram of a system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to an embodiment of the present invention;</li><li><figref idrefs="f0008">FIG. 8</figref> is a schematic structural diagram of a gateway according to an embodiment of the present invention;</li><li><figref idrefs="f0008">FIG. 9</figref> is a schematic structural diagram of a routing bridge according to an embodiment of the present invention; and</li><li><figref idrefs="f0008">FIG. 10</figref> is a schematic structural diagram of a system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to an embodiment of the present invention.</li></ul></p><heading id="h0005"><b>DESCRIPTION OF EMBODIMENTS</b></heading><p id="p0030" num="0030">The following clearly describes the technical solutions in the embodiments of the present invention with reference to the accompanying drawings in the embodiments of the present invention. Apparently, the described embodiments are merely a part rather than all of the embodiments of the present invention. All other embodiments obtained by a person of ordinary skill in the art based on the embodiments of the present invention without creative<!-- EPO <DP n="14"> --> efforts shall fall within the protection scope of the present invention.</p><p id="p0031" num="0031"><figref idrefs="f0002">FIG. 2</figref> is a flowchart of a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to an embodiment of the present invention. As shown in <figref idrefs="f0002">FIG. 2</figref>, the method provided by the embodiment of the present invention may include the following steps:
<ul><li>201: A gateway receives a link state packet LSP sent by each routing bridge RB, where each LSP includes: a network identifier of a Layer 2 virtual network and a multicast address.</li></ul></p><p id="p0032" num="0032">It should be noted that in the embodiment of the present invention, the gateway is any gateway on the TRILL network, that is, each gateway on the TRILL network receives the LSP sent by each RB. Preferably, the gateway may be a router supporting a Layer 3 multicast function or a Layer 3 core switch.</p><p id="p0033" num="0033">The link state packet (LSP) may be specifically a TRILL link state protocol data unit (LSPDU).</p><p id="p0034" num="0034">The routing bridge is any switch that is on the TRILL network, has a Layer 2 access function, and can receive a multicast packet sent by a terminal (a multicast source) to which the switch is connected.</p><p id="p0035" num="0035">The network identifier of the Layer 2 virtual network may be indicated by a 12-bit VLAN ID, or may be indicated by a 24-bit FGL.</p><p id="p0036" num="0036">The multicast address is any of class D IP addresses ranging from 224.0.0.0 to 239.255.255.255, and is used to identify a multicast group. The multicast group is a set of terminals that receive a multicast packet.</p><p id="p0037" num="0037">Preferably, the LSP is formed by encapsulating the multicast address and the network identifier, where the multicast address is obtained by the RB according to an IGMP packet that is sent by the terminal and received from an Internet Group Management Protocol (IGMP) packet ingress port, and the network identifier is of the Layer 2 virtual network on which the terminal is located, and is obtained according to a port number of the ingress port and a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network. The IGMP packet includes the multicast address.</p><p id="p0038" num="0038">202: The gateway separately performs calculation on the network identifier and the<!-- EPO <DP n="15"> --> multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address.</p><p id="p0039" num="0039">Preferably, the gateway may separately perform data conversion on the network identifier and the multicast address that are in each LSP, and perform computation in combination with a total number of gateways that are on the TRILL network, to obtain the calculation result corresponding to each combination of the network identifier and the multicast address.</p><p id="p0040" num="0040">The network identifier may be a 12-bit VLAN ID, or may be a 24-bit FGL. Therefore, the calculation result corresponding to the combination of the network identifier and the multicast address may be obtained by using the following two manners according to different network identifiers:
<ol><li>(1) The network identifier is a 12-bit VLAN ID;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k; and<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m, and m=(VLAN ID&lt;&lt;32+Group Address)%k, where<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and m=(VLAN ID&lt;&lt;32+Group Address)%k indicates: first right shifting the 12-bit VLAN ID by 32 bits, then adding it to the multicast address, and finally, determining a remainder as a value of m after a result of addition is divided by k.</li><li>(2) The network identifier is a 24-bit FGL;</li></ol>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k; and<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m, and m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k, where<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and "|" indicates an OR operation, and<br/>
<!-- EPO <DP n="16"> -->m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k indicates: performing an OR operation on a remainder that is obtained after the 24-bit FGL is right shifted by k bits and then divided by 12, and the 24-bit FGL, dividing an OR operation result by k to acquire a first remainder; performing an OR operation on a remainder that is obtained after the multicast address is right shifted by k bits and then divided by 32, and the multicast address, dividing an OR operation result by k to acquire a second remainder; then adding the first remainder and the second remainder; finally, determining a remainder as a value of m after an addition result is divided by k.</p><p id="p0041" num="0041">The calculation result m corresponding to the combination of the network identifier and the multicast address is in any manner of expression of the foregoing manners (1) and (2), but is not limited to the two manners of expression.</p><p id="p0042" num="0042">Further, information preconfigured on the gateway is a sequence number of the gateway.</p><p id="p0043" num="0043">The sequence number is obtained by sorting, in an initialization phase of the TRILL network according to TRILL protocol system identifiers system IDs of the gateways that are on the TRILL network, all the gateways that are on the TRILL network according to a natural number sequence starting from 0 and ending at k-1.</p><p id="p0044" num="0044">The TRILL protocol system identifier is a natural number, used to identify a gateway on the TRILL network. The sorting may be sorting in descending order according to values of the TRILL protocol system identifiers, may be sorting in ascending order according to values of the TRILL protocol system identifiers, or may be random sorting, which is not limited by the embodiment of the present invention. For example, the TRILL network includes 4 gateways that are identified according to TRILL protocol system identifiers of the gateways are gateway 1, gateway 2, gateway 3, and gateway 4. After natural number sequence based number sorting is performed on the 4 gateways, numbers corresponding to gateway 1, gateway 2, gateway 3, and gateway 4 may be: 0, 1, 2, and 3.</p><p id="p0045" num="0045">If the sequence number of the gateway is equal to the calculation result m corresponding to the combination of the network identifier and the multicast address, it indicates that the gateway matches the network identifier and the multicast address, that is, the gateway can<!-- EPO <DP n="17"> --> forward a multicast packet that is corresponding to the multicast address and that is on a Layer 2 virtual network corresponding to the network identifier.</p><p id="p0046" num="0046">If the sequence number of the gateway is unequal to the calculation result m corresponding to the combination of the network identifier and the multicast address, it indicates that the gateway does not match the network identifier and the multicast address, that is, the gateway cannot forward a multicast packet that is corresponding to the multicast address and that is on a Layer 2 virtual network corresponding to the network identifier.</p><p id="p0047" num="0047">For example, on the foregoing TRILL network, if a calculation result of a combination of the VLAN 10 and a multicast address A is 2, the sequence number of gateway 3 matches the calculation result of the combination of the VLAN 10 and the multicast address A, that is, gateway 3 is a gateway forwarding a multicast packet that is corresponding to the multicast address A and that is on the VLAN 10.</p><p id="p0048" num="0048">203: If determining that information preconfigured on the gateway matches the calculation result corresponding to the combination of the network identifier and the multicast address, the gateway sends a notification message to each RB that is on the TRILL network, where the notification message includes the network identifier and the multicast address that are in the matched combination.</p><p id="p0049" num="0049">On a TRILL network, a routing bridge needs to first send a multicast packet to a TRILL distribution tree root according to a TRILL distribution tree corresponding to a network identifier and a multicast address, and send, from the TRILL distribution tree root and along the TRILL distribution tree, the multicast packet to a gateway that matches a calculation result of a combination of the network identifier and the multicast address, and the gateway copies and forwards the multicast packet. The TRILL distribution tree is a combination of shortest paths that are from the distribution tree root to another gateway and routing bridge and that are calculated by the routing bridge according to a shortest path first method.</p><p id="p0050" num="0050">For each TRILL distribution tree, for some paths (that is, branches of the distribution tree) having no potential receiver, a distribution tree pruning operation needs to be performed. In this case, if a gateway that matches a calculation result of a combination of the network identifier and the multicast address and that is on a branch of the distribution tree is pruned off,<!-- EPO <DP n="18"> --> the gateway in the matched combination cannot receive a multicast packet of a multicast group.</p><p id="p0051" num="0051">Therefore, to avoid that the gateway in the matched combination cannot receive the multicast packet, further, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address that are in the matched combination.</p><p id="p0052" num="0052">Correspondingly, the sending the notification message to each RB that is on the TRILL network includes:
<ul><li>notifying, by the gateway, the network identifier and the multicast address that are in the matched combination to each RB that is on the TRILL network by using the first LSP, so that each RB on the TRILL network disposes, according to the first LSP, the gateway on the TRILL distribution tree corresponding to the network identifier and the multicast address that are in the matched combination, and sends the multicast packet corresponding to the multicast address in the matched combination to the gateway by using the TRILL distribution tree.</li></ul></p><p id="p0053" num="0053">In addition, according to the TRILL protocol, at least one TRILL distribution tree root may be automatically selected from all the gateways that are on the TRILL network, and information about a selected TRILL distribution tree root is broadcast to all the gateways and routing bridges that are on the TRILL network. Before configuring a TRILL distribution tree corresponding to a network identifier and a multicast address, that is, before performing distribution tree calculation, a routing bridge needs to choose a distribution tree root from all selected distribution tree roots as a TRILL distribution tree root corresponding to the network identifier and the multicast address. In this case, if the gateway in the matched combination is a distribution tree root selected by the TRILL protocol, but the routing bridge does not choose the gateway as the TRILL distribution tree root corresponding to the network identifier and the multicast address, in a multicast packet forwarding process, a link detour occurs, wasting a link bandwidth resource. For example, as shown in <figref idrefs="f0001">FIG. 1</figref>, terminal 1 is on a VLAN 10, a<!-- EPO <DP n="19"> --> multicast address of a sent multicast packet is A, and a gateway matching a calculation result of a combination of the VLAN 10 and A is gateway 3. Gateways that may be selected by the TRILL protocol as a TRILL distribution tree root are: gateway 1, gateway 3, and gateway 4. Routing bridge 1 selects gateway 1 as a TRILL distribution tree root corresponding to the VLAN 10 and A. Therefore, after terminal 1 sends the multicast packet to routing bridge 1, the multicast packet goes along distribution tree 1 (gateway 1→ routing bridge 2→ gateway 3) to arrive at gateway 3, and gateway 3 copies and forwards the multicast packet. In this case, if routing bridge 1 is enabled to set gateway 3 as the TRILL distribution tree root, the multicast packet is directly sent, along distribution tree 2, to gateway 3, so that no detour occurs in multicast packet forwarding.</p><p id="p0054" num="0054">Therefore, to resolve a problem that a link detour occurs in multicast packet forwarding and therefore a link bandwidth resource is wasted, further, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address that are in the matched combination and a correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root.</p><p id="p0055" num="0055">Correspondingly, the sending the notification message to each RB that is on the TRILL network includes:
<ul><li>notifying, by the gateway by using the extended LSP, the network identifier and the multicast address that are in the matched combination and the correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root to each RB that is on the TRILL network, so that each RB on the TRILL network generates a local multicast entry according to the extended LSP, and sends the multicast packet corresponding to the multicast address in the matched combination to the gateway by using a TRILL distribution tree whose root is the gateway in the matched combination according to the local multicast entry.<!-- EPO <DP n="20"> --></li><li>204: The gateway receives, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwards the multicast packet.</li></ul></p><p id="p0056" num="0056">According to a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network provided by the embodiment of the present invention, after receiving an LSP that includes a Layer 2 virtual network identifier and a multicast address and that is sent by a routing bridge RB, a gateway separately performs calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address; when determining that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, the gateway sends a notification message to the RB, receives, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwards the multicast packet.</p><p id="p0057" num="0057">In this way, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced. For example, terminal 1 is on Layer 2 virtual network VLAN 10. If terminal 1 sends 1,000 groups of different multicast packets, where a multicast address corresponding to 200 groups of the different multicast packets is A, a multicast address corresponding to 300 groups of the different multicast packets is B, and a multicast address corresponding to 500 groups of the different multicast packets is C, and a gateway matching a calculation result of a combination of the VLAN 10 and A is gateway 1, a gateway matching a calculation result of a combination of the VLAN 10 and B is gateway 2, and a gateway matching a calculation result of a combination of the VLAN 10 and C is gateway 3, the multicast packets that are corresponding to multicast address A and that are in the 1,000 groups of data are forwarded by using gateway 1, the multicast packets that are corresponding to multicast address B and that<!-- EPO <DP n="21"> --> are in the 1,000 groups of multicast packets are forwarded by using gateway 2, and the multicast packets that are corresponding to multicast address C and that are in the 1,000 groups of data are forwarded by using gateway 3.</p><p id="p0058" num="0058"><figref idrefs="f0003">FIG. 3</figref> is a flowchart of a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to another embodiment of the present invention. As shown in <figref idrefs="f0003">FIG. 3</figref>, the method provided by the embodiment of the present invention may include the following steps:
<ul><li>301: A routing bridge separately sends an LSP to each gateway that is on the TRILL network, where the LSP includes: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway.</li></ul></p><p id="p0059" num="0059">The routing bridge RB is any switch that is on the TRILL network, has a Layer 2 access function, and can receive a multicast packet sent by a terminal (a multicast source) to which the switch is connected.</p><p id="p0060" num="0060">302: The routing bridge receives a notification message sent by a first gateway, where the first gateway is a gateway on the TRILL network and information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address.</p><p id="p0061" num="0061">303: The routing bridge sends a multicast packet corresponding to the multicast address to the first gateway, so that the first gateway forwards the multicast packet.</p><p id="p0062" num="0062">Preferably, to avoid that the first gateway cannot receive the multicast packet, when the first gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address.</p><p id="p0063" num="0063">Correspondingly, that the routing bridge receives a notification message sent by a first gateway, and sends a multicast packet corresponding to the multicast address to the first gateway includes:
<ul><li>receiving, by the RB, the first LSP that includes the network identifier and the multicast address and that is sent by the first gateway;<!-- EPO <DP n="22"> --></li><li>disposing, according to the first LSP, the first gateway on a TRILL distribution tree corresponding to the network identifier and the multicast address; and</li><li>sending the multicast packet corresponding to the multicast address to the first gateway by using the TRILL distribution tree.</li></ul></p><p id="p0064" num="0064">In this way, it is ensured that when a pruning operation is performed on the TRILL distribution tree, the first gateway located on a branch of the TRILL distribution tree is not cut off, so that the first gateway can successfully receive the multicast packet.</p><p id="p0065" num="0065">Preferably, to resolve a problem that a link detour occurs in multicast packet forwarding and therefore a link bandwidth resource is wasted, when the first gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address and a correspondence between the network identifier and the multicast address and the TRILL distribution tree root.</p><p id="p0066" num="0066">Correspondingly, that the routing bridge receives a notification message sent by a first gateway, and sends a multicast packet corresponding to the multicast address to the first gateway includes:
<ul><li>receiving, by the RB, the extended LSP that includes the network identifier and the multicast address and the correspondence between the network identifier and the multicast address and the TRILL distribution tree root and that is sent by the first gateway;</li><li>generating a local multicast entry according to the extended LSP; and sending the multicast packet corresponding to the multicast address to the first gateway by using a TRILL distribution tree whose root is the first gateway according to the local multicast entry.</li></ul></p><p id="p0067" num="0067">The local multicast entry includes related information about the TRILL distribution tree corresponding to the network identifier and the multicast address.</p><p id="p0068" num="0068">In this way, it is implemented that a routing bridge directly sends a multicast packet to a first gateway, thereby preventing a data link detour phenomenon from occurring and improving a link resource utilization rate.<!-- EPO <DP n="23"> --></p><p id="p0069" num="0069">Further, before sending the LSP to each gateway that is on the TRILL network, the method further includes:<br/>
receiving, by the RB from an IGMP packet ingress port, an IGMP packet sent by a terminal (that is, a multicast source);<br/>
obtaining a multicast address included in the IGMP packet and a network identifier of a Layer 2 virtual network on which the terminal is located; and<br/>
forming the LSP by encapsulating the multicast address and the network<br/>
identifier.<br/>
Preferably, the RB may determine, according to a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network, the network identifier of the Layer 2 virtual network on which the terminal is located. The correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network is preset by an administrator, which is not limited by the embodiment of the present invention. For example, Table 1 is a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network. For convenience of description, the network identifier of the Layer 2 virtual network is a 12-bit VLAN ID, or may be a 24-bit FGL, which is not limited by the present invention. As shown in Table 1, if the IGMP packet sent by the terminal is received from an ingress port with a port number being 50, it may be seen, according to a correspondence in Table 1, that the network identifier of the Layer 2 virtual network on which the terminal is located is VLAN 10:
<tables id="tabl0001" num="0001"><table frame="all"><title><b>Table 1</b></title><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="44mm"/><colspec colnum="2" colname="col2" colwidth="60mm"/><thead><row><entry align="center" valign="top"><b>Port Number of an Ingress</b></entry><entry align="center" valign="top"><b>Network Identifier of a Layer 2 Virtual</b></entry></row></thead><tbody><row><entry align="center">50</entry><entry align="center">VLAN 10</entry></row><row><entry align="center">60</entry><entry align="center">VLAN 11</entry></row><row><entry align="center">70</entry><entry align="center">VLAN 12</entry></row></tbody></tgroup></table></tables><!-- EPO <DP n="24"> --></p><p id="p0070" num="0070">According to a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network provided by the embodiment of the present invention, a routing bridge separately sends an LSP to each gateway that is on the TRILL network, where the LSP includes: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway; the routing bridge receives a notification message sent by a first gateway, and sends a multicast packet corresponding to the multicast address to the first gateway, so that the first gateway forwards the multicast packet. In this way, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0071" num="0071">The following describes in detail a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network provided by an embodiment of the present invention.</p><p id="p0072" num="0072"><figref idrefs="f0004">FIG. 4</figref> is a flowchart of a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to still another embodiment of the present invention. As shown in <figref idrefs="f0004">FIG. 4</figref>, the method provided by the embodiment of the present invention may include the following steps:
<ul><li>401: A terminal sends an IGMP packet to a routing bridge.</li></ul></p><p id="p0073" num="0073">The IGMP packet includes a multicast address.
<ul><li>402: The routing bridge acquires the IGMP packet from an IGMP packet ingress port, acquires a multicast address according to the IGMP packet, and acquires, according to a port number of the ingress port, a network identifier of a Layer 2 virtual network on which the terminal is located.</li></ul></p><p id="p0074" num="0074">Preferably, the routing bridge determines, according to a preset correspondence table of a<!-- EPO <DP n="25"> --> port number of an ingress port and a network identifier of a Layer 2 virtual network, and the port number of the IGMP packet ingress port, the network identifier of the Layer 2 virtual network on which the terminal is located. The correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network is preset by an administrator, which is not limited by the embodiment of the present invention.</p><p id="p0075" num="0075">403: The routing bridge sends an LSP including the network identifier and the multicast address to a gateway.</p><p id="p0076" num="0076">404: The gateway performs calculation on the network identifier and the multicast address that are in the LSP, to obtain a calculation result corresponding to a combination of the network identifier and the multicast address.</p><p id="p0077" num="0077">405: The gateway determines whether information preconfigured on the gateway matches the calculation result corresponding to the combination of the network identifier and the multicast address, where if the information preconfigured matches the calculation result, execute step 406.</p><p id="p0078" num="0078">406: The gateway sends a notification message to the RB.</p><p id="p0079" num="0079">407: The terminal sends a multicast packet to the routing bridge.</p><p id="p0080" num="0080">408: The routing bridge sends a multicast packet corresponding to the multicast address to the gateway.</p><p id="p0081" num="0081">For example, as shown in <figref idrefs="f0001">FIG. 1</figref>, it is assumed that terminal 1 is a multicast packet sender (that is, a multicast source). Terminal 1 sends an IGMP packet to routing bridge 1 (that is, a routing bridge). Routing bridge 1 acquires a multicast address included in the IGMP packet and a network identifier of a Layer 2 virtual network on which the terminal 1 is located. Routing bridge 1 notifies the multicast address and the network identifier of the Layer 2 virtual network to gateway 1, gateway 2, gateway 3, and gateway 4 that are on a TRILL network by using an LSP. Gateway 1, gateway 2, gateway 3, and gateway 4 separately determine whether gateway 1, gateway 2, gateway 3, and gateway 4 are a gateway matching a calculation result of a combination of the network identifier and the multicast address. Assuming that gateway 1 calculates that gateway 1 is the gateway matching the multicast address and the network identifier, gateway 1 sends a notification message to all routing<!-- EPO <DP n="26"> --> bridges (routing bridge 1 to routing bridge n) that are on the TRILL network, so that routing bridge 1 to routing bridge n separately forward a multicast packet that is corresponding to the multicast address and that is on the Layer 2 virtual network corresponding to the network identifier to gateway 1, and gateway 1 copies and forwards the multicast packet.</p><p id="p0082" num="0082">According to a method for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network provided by the embodiment of the present invention, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0083" num="0083"><figref idrefs="f0005">FIG. 5</figref> is a schematic structural diagram of a gateway 50 according to an embodiment of the present invention. As shown in <figref idrefs="f0005">FIG. 5</figref>, the gateway 50 includes a receiving module 501, a calculation module 502, a sending module 503, a multicast packet receiving module 504, and multicast packet forwarding module 505.</p><p id="p0084" num="0084">A receiving module 501 is configured to receive a link state packet (LSP) sent by each routing bridge RB.</p><p id="p0085" num="0085">Each LSP includes: a network identifier of a Layer 2 virtual network and a multicast address.</p><p id="p0086" num="0086">The LSP may be specifically a TRILL LSPDU.</p><p id="p0087" num="0087">The routing bridge is any switch that is on a TRILL network, has a Layer 2 access function, and can receive a multicast packet sent by a terminal (a multicast source) to which the switch is connected.</p><p id="p0088" num="0088">The network identifier of the Layer 2 virtual network may be indicated by a 12-bit VLAN ID, or may be indicated by a 24-bit FGL.</p><p id="p0089" num="0089">The multicast address is any of class D IP addresses ranging from 224.0.0.0 to 239.255.255.255, and is used to identify a multicast group. The multicast group is a set of terminals that receive a multicast packet.<!-- EPO <DP n="27"> --></p><p id="p0090" num="0090">Preferably, the LSP is formed by encapsulating the multicast address and the network identifier, where the multicast address is obtained by the RB according to an IGMP packet that is sent by the terminal and received from an IGMP packet ingress port, and the network identifier is of the Layer 2 virtual network on which the terminal is located, and is obtained according to a port number of the ingress port and a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network. The IGMP packet includes the multicast address.</p><p id="p0091" num="0091">A calculation module 502 is configured to separately perform calculation on the network identifier and the multicast address that are in each LSP received by the receiving module, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address.</p><p id="p0092" num="0092">A sending module 503 is configured to: if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, send a notification message to each RB that is on the TRILL network, where the notification message includes the network identifier and the multicast address that are in the matched combination.</p><p id="p0093" num="0093">A multicast packet receiving module 504 is configured to receive, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination.</p><p id="p0094" num="0094">A multicast packet forwarding module 505 is configured to forward the multicast packet received by the multicast packet receiving module 504.</p><p id="p0095" num="0095">Further, the calculation module 502 is specifically configured to:
<ul><li>separately perform data conversion on the network identifier and the multicast address that are in each LSP, and perform computation in combination with a total number of gateways that are on the TRILL network, to obtain the calculation result corresponding to each combination of the network identifier and the multicast address.</li></ul></p><p id="p0096" num="0096">The network identifier may be a 12-bit VLAN ID, or may be a 24-bit FGL. Therefore, the calculation module 502 is specifically configured to obtain, by calculating according to a calculation formula in the following (1) or (2), the calculation result corresponding to each<!-- EPO <DP n="28"> --> combination of the network identifier and the multicast address:
<ol><li>(1) The network identifier is a 12-bit VLAN ID;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m; and<br/>
the calculation module 502 obtains, according to a formula m=(VLAN ID&lt;&lt;32+Group Address)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, where<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and m=(VLAN ID&lt;&lt;32+Group Address)%k indicates: first right shifting the 12-bit VLAN ID by 32 bits, then adding it to the multicast address, and finally, determining a remainder as a value of m after a result of addition is divided by k.</li><li>(2) The network identifier is a 24-bit FGL;</li></ol>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m; and<br/>
the calculation module 502 obtains, according to a formula m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, where<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, "|" indicates an OR operation, and m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k indicates: performing an OR operation on a remainder that is obtained after the 24-bit FGL is right shifted by k bits and then divided by 12, and the 24-bit FGL, dividing an OR operation result by k to acquire a first remainder; performing an OR operation on a remainder that is obtained after the multicast address is right shifted by k bits and then divided by 32, and the<!-- EPO <DP n="29"> --> multicast address, dividing an OR operation result by k to acquire a second remainder; then adding the first remainder and the second remainder; finally, determining a remainder as a value of m after an addition result is divided by k.</p><p id="p0097" num="0097">The calculation result m corresponding to the combination of the network identifier and the multicast address is in any manner of expression of the foregoing manners (1) and (2), but is not limited to the two manners of expression.</p><p id="p0098" num="0098">The information preconfigured on the gateway is a sequence number of the gateway. The sequence number is obtained by sorting, in an initialization phase of the TRILL network according to TRILL protocol system identifiers system IDs of the gateways that are on the TRILL network, all the gateways that are on the TRILL network according to a natural number sequence starting from 0 and ending at k-1.</p><p id="p0099" num="0099">Correspondingly, the sending module 503 is specifically configured to:
<ul><li>if the sequence number of the gateway is equal to the calculation result m corresponding to the combination of the network identifier and the multicast address, send the notification message to each RB that is on the TRILL network.</li></ul></p><p id="p0100" num="0100">Further, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address that are in the matched combination.</p><p id="p0101" num="0101">Correspondingly, the sending module 503 is specifically configured to:
<ul><li>notify the network identifier and the multicast address that are in the matched combination to each RB that is on the TRILL network by using the first LSP, so that each RB on the TRILL network disposes, according to the first LSP, the gateway on the TRILL distribution tree corresponding to the network identifier and the multicast address that are in the matched combination, and sends the multicast packet corresponding to the multicast address in the matched combination to the gateway by using the TRILL distribution tree.</li></ul></p><p id="p0102" num="0102">Further, if the gateway determines that the information preconfigured on the gateway<!-- EPO <DP n="30"> --> matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address that are in the matched combination and a correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root.</p><p id="p0103" num="0103">Correspondingly, the sending module 503 is specifically configured to:
<ul><li>notify, by using the extended LSP, the network identifier and the multicast address that are in the matched combination and the correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root to each RB that is on the TRILL network, so that each RB on the TRILL network generates a local multicast entry according to the extended LSP, and sends the multicast packet corresponding to the multicast address in the matched combination to the gateway by using a TRILL distribution tree whose root is the gateway in the matched combination according to the local multicast entry.</li></ul></p><p id="p0104" num="0104">According to a gateway provided by the embodiment of the present invention, after receiving an LSP that includes a Layer 2 virtual network identifier and a multicast address and that is sent by a routing bridge RB, the gateway separately performs calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address; when determining that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, the gateway sends a notification message to the RB, receives, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwards the multicast packet. In this way, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large<!-- EPO <DP n="31"> --> number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0105" num="0105"><figref idrefs="f0005">FIG. 6</figref> is a schematic structural diagram of a routing bridge 60 according to an embodiment of the present invention. As shown in <figref idrefs="f0005">FIG. 6</figref>, the routing bridge 60 includes a sending module 601, a receiving module 602, and a multicast packet sending module 603.</p><p id="p0106" num="0106">A sending module 601 is configured to separately send a link state packet LSP to each gateway that is on a TRILL network.</p><p id="p0107" num="0107">The LSP includes: a network identifier of a Layer 2 virtual network and a multicast address. The LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured that is on the gateway.</p><p id="p0108" num="0108">A receiving module 602 is configured to receive a notification message sent by a first gateway, where the first gateway is a gateway on the TRILL network and information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address.</p><p id="p0109" num="0109">A 603 is configured to send a multicast packet corresponding to the multicast address to the first gateway, so that the first gateway forwards the multicast packet.</p><p id="p0110" num="0110">Further, if the first gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address.</p><p id="p0111" num="0111">Correspondingly, the receiving module 602 is specifically configured to:
<ul><li>receive the first LSP sent by the first gateway.</li></ul></p><p id="p0112" num="0112">As shown in <figref idrefs="f0006">FIG. 6A</figref>, the routing bridge 60 further includes:
<ul><li>a disposing module 604, configured to dispose, according to the first LSP, the first gateway on a TRILL distribution tree corresponding to the network identifier and the multicast address.</li></ul></p><p id="p0113" num="0113">The multicast packet sending module 603 is specifically configured to:
<ul><li>send the multicast packet corresponding to the multicast address to the first gateway by using the TRILL distribution tree.</li></ul></p><p id="p0114" num="0114">Further, if the first gateway is a TRILL distribution tree root, the notification message is<!-- EPO <DP n="32"> --> an extended LSP including the network identifier and the multicast address and a correspondence between the network identifier and the multicast address and the TRILL distribution tree root.</p><p id="p0115" num="0115">Correspondingly, the receiving module 602 is specifically configured to:
<ul><li>receive the extended LSP sent by the first gateway.</li></ul></p><p id="p0116" num="0116">As shown in <figref idrefs="f0006">FIG. 6B</figref>, the routing bridge 60 further includes:
<ul><li>a generating module 605, configured to generate a local multicast entry according to the extended LSP.</li></ul></p><p id="p0117" num="0117">The multicast packet sending module 603 is specifically configured to:
<ul><li>send the multicast packet corresponding to the multicast address to the first gateway by using a TRILL distribution tree whose root is the first gateway according to the local multicast entry.</li></ul></p><p id="p0118" num="0118">Further, as shown in <figref idrefs="f0007">FIG. 6C</figref>, the routing bridge 60 further includes:
<ul><li>an IGMP packet receiving module 606, configured to: before the sending module 601 sends the LSP to the gateway, receive, from an IGMP packet ingress port, an IGMP packet sent by a terminal;</li><li>an acquiring module 607, configured to obtain a multicast address included in the IGMP packet and a network identifier of a Layer 2 virtual network on which the terminal is located; and</li><li>a packet generating module 608, configured to form the LSP by encapsulating the multicast address and the network identifier.</li></ul></p><p id="p0119" num="0119">The acquiring module 607 is specifically configured to determine, according to a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network, and a port number of the IGMP packet ingress port, the network identifier of the Layer 2 virtual network on which the terminal is located. The correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network is preset by an administrator, which is not limited by the present invention. For example, Table 1 is a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network. For convenience of description, the network identifier of the Layer 2<!-- EPO <DP n="33"> --> virtual network is a 12-bit VLAN ID, or may be a 24-bit FGL, which is not limited by the present invention. As shown in Table 1, if the IGMP packet sent by the terminal is received from an ingress port with a port number being 50, it may be seen, according to a correspondence in Table 1, that the network identifier of the Layer 2 virtual network on which the terminal is located is VLAN 10.</p><p id="p0120" num="0120">According to a routing bridge provided by the embodiment of the present invention, the routing bridge separately sends an LSP to each gateway that is on a TRILL network, where the LSP includes: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway; the routing bridge receives a notification message sent by a first gateway, and sends a multicast packet corresponding to the multicast address to the first gateway, so that the first gateway forwards the multicast packet. In this way, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0121" num="0121"><figref idrefs="f0007">FIG. 7</figref> is a schematic structural diagram of a system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to an embodiment of the present invention. As shown in <figref idrefs="f0007">FIG. 7</figref>, the system includes: a terminal, a gateway 50, and a routing bridge 60.</p><p id="p0122" num="0122">The terminal is a multicast packet sender (that is, a multicast source). The gateway 50 has a same function as the foregoing gateway 50, and no details are described herein again. The routing bridge 60 has a same function as the foregoing routing bridge 60, and no details are described herein again.</p><p id="p0123" num="0123">According to a system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network provided by the embodiment of the present invention, a<!-- EPO <DP n="34"> --> terminal sends an IGMP packet to a routing bridge; the routing bridge acquires a multicast address included in the IGMP packet and a network identifier of a Layer 2 virtual network on which the terminal is located, and sends an LSP including the network identifier and the multicast address to a gateway that is on the TRILL network; the gateway performs calculation on the network identifier and the multicast address that are in the LSP, to obtain a calculation result corresponding to a combination of the network identifier and the multicast address; if determining that information preconfigured on the gateway matches the calculation result corresponding to the combination of the network identifier and the multicast address, the gateway sends a notification message to the RB that is on the TRILL network; the terminal sends a multicast packet to the routing bridge; and the routing bridge sends a multicast packet corresponding to the multicast address in the matched combination to the gateway that is in the matched combination, and the gateway forwards the multicast packet. A gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0124" num="0124">Referring to <figref idrefs="f0008">FIG. 8, FIG. 8</figref> is a schematic structural diagram of a gateway 80 according to an embodiment of the present invention. As shown in <figref idrefs="f0008">FIG. 8</figref>, the gateway 80 may include: a communications unit 801, a processor 802, and a memory 803. The communications unit 801, the processor 802, and the memory 803 are connected to and communicate with each other by using a communications bus 804.</p><p id="p0125" num="0125">The communications unit 801 is configured to perform data transmission between the communications unit 801 and an external network element.</p><p id="p0126" num="0126">The processor 802 may be a central processing unit (CPU).</p><p id="p0127" num="0127">The memory 803 may be a volatile memory, such as a random-access memory (RAM), may be a non-volatile memory, such as a read-only memory (ROM), a flash memory, a hard disk (HD), or a solid-state drive (SSD), or may be a combination of the foregoing kinds of<!-- EPO <DP n="35"> --> memories, and provides an instruction and data for the processor 802.</p><p id="p0128" num="0128">The communications unit 801 is configured to receive a link state packet LSP sent by each routing bridge RB.</p><p id="p0129" num="0129">Each LSP includes: a network identifier of a Layer 2 virtual network and a multicast address.</p><p id="p0130" num="0130">The LSP may be specifically a TRILL LSPDU.</p><p id="p0131" num="0131">The routing bridge is any switch that is on a TRILL network, has a Layer 2 access function, and can receive a multicast packet sent by a terminal (a multicast source) to which the switch is connected.</p><p id="p0132" num="0132">The network identifier of the Layer 2 virtual network may be indicated by a 12-bit VLAN ID, or may be indicated by a 24-bit FGL.</p><p id="p0133" num="0133">The multicast address is any of class D IP addresses ranging from 224.0.0.0 to 239.255.255.255, and is used to identify a multicast group. The multicast group is a set of terminals that receive a multicast packet.</p><p id="p0134" num="0134">Preferably, the LSP is formed by encapsulating the multicast address and the network identifier, where the multicast address is obtained by the RB according to an IGMP packet that is sent by the terminal and received from an IGMP packet ingress port, and the network identifier is of the Layer 2 virtual network on which the terminal is located, and is obtained according to a port number of the ingress port and a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network. The IGMP packet includes the multicast address.</p><p id="p0135" num="0135">The processor 802 is configured to separately perform calculation on the network identifier and the multicast address that are in each LSP received by the receiving module, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address.</p><p id="p0136" num="0136">The communications unit 801 is further configured to: if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, send a notification message to each RB that is on the TRILL network, where the notification message includes the<!-- EPO <DP n="36"> --> network identifier and the multicast address that are in the matched combination; and<br/>
receive, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forward the multicast packet.</p><p id="p0137" num="0137">Further, the processor 802 is specifically configured to:
<ul><li>separately perform data conversion on the network identifier and the multicast address that are in each LSP, and perform computation in combination with a total number of gateways that are on the TRILL network, to obtain the calculation result corresponding to each combination of the network identifier and the multicast address.</li></ul></p><p id="p0138" num="0138">The network identifier may be a 12-bit VLAN ID, or may be a 24-bit FGL. Therefore, the processor 802 is specifically configured to obtain, by calculating according to any calculation formula of the following (1) or (2), the calculation result corresponding to each combination of the network identifier and the multicast address:
<ol><li>(1) The network identifier is a 12-bit VLAN ID;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m; and the processor 802 obtains, according to a formula m=(VLAN ID&lt;&lt;32+Group Address)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, where<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and m=(VLAN ID&lt;&lt;32+Group Address)%k indicates: first right shifting the 12-bit VLAN ID by 32 bits, then adding it to the multicast address, and finally, determining a remainder as a value of m after a result of addition is divided by k.</li><li>(2) The network identifier is a 24-bit FGL;</li></ol>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network<!-- EPO <DP n="37"> --> identifier and the multicast address is m; and<br/>
the processor 802 obtains, according to a formula m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, where<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, "|" indicates an OR operation, and m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k indicates: performing an OR operation on a remainder that is obtained after the 24-bit FGL is right shifted by k bits and then divided by 12, and the 24-bit FGL, dividing an OR operation result by k to acquire a first remainder; performing an OR operation on a remainder that is obtained after the multicast address is right shifted by k bits and then divided by 32, and the multicast address, dividing an OR operation result by k to acquire a second remainder; then adding the first remainder and the second remainder; finally, determining a remainder as a value of m after an addition result is divided by k.</p><p id="p0139" num="0139">The calculation result m corresponding to the combination of the network identifier and the multicast address is in any manner of expression of the foregoing manners (1) and (2), but is not limited to the two manners of expression.</p><p id="p0140" num="0140">The information preconfigured on the gateway is a sequence number of the gateway. The sequence number is obtained by sorting, in an initialization phase of the TRILL network according to TRILL protocol system identifiers system IDs of the gateways that are on the TRILL network, all the gateways that are on the TRILL network according to a natural number sequence starting from 0 and ending at k-1.</p><p id="p0141" num="0141">Correspondingly, the communications unit 801 is specifically configured to:
<ul><li>if the sequence number of the gateway is equal to the calculation result m corresponding to the combination of the network identifier and the multicast address, send the notification message to each RB that is on the TRILL network.</li></ul></p><p id="p0142" num="0142">Further, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the<!-- EPO <DP n="38"> --> multicast address, and the gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address that are in the matched combination.</p><p id="p0143" num="0143">Correspondingly, the communications unit 801 is specifically configured to:
<ul><li>notify the network identifier and the multicast address that are in the matched combination to each RB that is on the TRILL network by using the first LSP, so that each RB on the TRILL network disposes, according to the first LSP, the gateway on the TRILL distribution tree corresponding to the network identifier and the multicast address that are in the matched combination, and sends the multicast packet corresponding to the multicast address in the matched combination to the gateway by using the TRILL distribution tree.</li></ul></p><p id="p0144" num="0144">Further, if the gateway determines that the information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, and the gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address that are in the matched combination and a correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root. Correspondingly, the communications unit 801 is specifically configured to:
<ul><li>notify, by using the extended LSP, the network identifier and the multicast address that are in the matched combination and the correspondence between the network identifier and the multicast address that are in the matched combination and the TRILL distribution tree root to each RB that is on the TRILL network, so that each RB on the TRILL network generates a local multicast entry according to the extended LSP, and sends the multicast packet corresponding to the multicast address in the matched combination to the gateway by using a TRILL distribution tree whose root is the gateway in the matched combination according to the local multicast entry.</li></ul></p><p id="p0145" num="0145">According to a gateway provided by the embodiment of the present invention, after receiving an LSP that includes a Layer 2 virtual network identifier and a multicast address and<!-- EPO <DP n="39"> --> that is sent by a routing bridge RB, the gateway 80 separately performs calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address; when determining that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, the gateway sends a notification message to the RB, receives, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwards the multicast packet. In this way, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0146" num="0146">Referring to <figref idrefs="f0008">FIG. 9, FIG. 9</figref> is a schematic structural diagram of a routing bridge 90 according to an embodiment of the present invention. As shown in <figref idrefs="f0008">FIG. 9</figref>, the routing bridge 90 may include: a communications unit 901, a processor 902, and a memory 903. The communications unit 901, the processor 902, and the memory 903 are connected to and communicate with each other by using a communications bus 904.</p><p id="p0147" num="0147">The communications unit 901 is configured to perform data transmission between the communications unit 901 and an external network element.</p><p id="p0148" num="0148">The processor 902 may be a central processing unit (CPU).</p><p id="p0149" num="0149">The memory 903 may be a volatile memory, such as a random-access memory (RAM), may be a non-volatile memory, such as a read-only memory (ROM), a flash memory, a hard disk (HD), or a solid-state drive (SSD), or may be a combination of the foregoing kinds of memories, and provides an instruction and data for the processor 902.</p><p id="p0150" num="0150">The communications unit 901 is configured to separately send a link state packet LSP to each gateway that is on a TRILL network, where the LSP includes: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway<!-- EPO <DP n="40"> --> to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway;<br/>
receive a notification message sent by a first gateway, where the first gateway is a gateway on the TRILL network and information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address; and<br/>
send a multicast packet corresponding to the multicast address to the first gateway, so that the first gateway forwards the multicast packet.</p><p id="p0151" num="0151">Further, if the first gateway is not a TRILL distribution tree root, the notification message is a first LSP including the network identifier and the multicast address that are in the matched combination.</p><p id="p0152" num="0152">Correspondingly, the communications unit 901 is specifically configured to:
<ul><li>receive the first LSP sent by the first gateway.</li></ul></p><p id="p0153" num="0153">The processor 902 is configured to dispose, according to the first LSP, the first gateway on a TRILL distribution tree corresponding to the network identifier and the multicast address.</p><p id="p0154" num="0154">The communications unit 901 is further configured to:<br/>
send the multicast packet corresponding to the multicast address to the first gateway by using the TRILL distribution tree.</p><p id="p0155" num="0155">Further, if the first gateway is a TRILL distribution tree root, the notification message is an extended LSP including the network identifier and the multicast address and a correspondence between the network identifier and the multicast address and the TRILL distribution tree root.</p><p id="p0156" num="0156">Correspondingly, the communications unit 901 is specifically configured to:
<ul><li>receive the extended LSP sent by the first gateway.</li></ul></p><p id="p0157" num="0157">The processor 902 is configured to generate a local multicast entry according to the extended LSP.</p><p id="p0158" num="0158">The communications unit 901 is further configured to:
<ul><li>send the multicast packet corresponding to the multicast address to the first<!-- EPO <DP n="41"> --> gateway by using a TRILL distribution tree whose root is the first gateway according to the local multicast entry.</li></ul></p><p id="p0159" num="0159">Further, the communications unit 901 is further configured to: before the communications unit 901 sends the LSP to the gateway, receive, from an IGMP packet ingress port, an IGMP packet sent by a terminal.</p><p id="p0160" num="0160">The processor 902 is further configured to obtain a multicast address included in the IGMP packet and a network identifier of a Layer 2 virtual network on which the terminal is located; and<br/>
form the LSP by encapsulating the multicast address and the network identifier.</p><p id="p0161" num="0161">The processor 902 is specifically configured to determine, according to a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network, and a port number of the IGMP packet ingress port, the network identifier of the Layer 2 virtual network on which the terminal is located. The correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network is preset by an administrator, which is not limited by the present invention. For example, Table 1 is a preset correspondence table of a port number of an ingress port and a network identifier of a Layer 2 virtual network. For convenience of description, the network identifier of the Layer 2 virtual network is a 12-bit VLAN ID, or may be a 24-bit FGL, which is not limited by the present invention. As shown in Table 1, if the IGMP packet sent by the terminal is received from an ingress port with a port number being 50, it may be seen, according to a correspondence in Table 1, that the network identifier of the Layer 2 virtual network on which the terminal is located is VLAN 10.</p><p id="p0162" num="0162">According to a routing bridge provided by the embodiment of the present invention, the routing bridge 90 separately sends an LSP to each gateway that is on a TRILL network, where the LSP includes: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway; the routing bridge 90 receives a notification<!-- EPO <DP n="42"> --> message sent by a first gateway, and sends a multicast packet corresponding to the multicast address to the first gateway, so that the first gateway forwards the multicast packet. In this way, a gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0163" num="0163"><figref idrefs="f0008">FIG. 10</figref> is a schematic structural diagram of a system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network according to an embodiment of the present invention. As shown in <figref idrefs="f0008">FIG. 10</figref>, the system includes: a terminal, a gateway 80, and a routing bridge 90.</p><p id="p0164" num="0164">The terminal is a multicast packet sender (that is, a multicast source). The gateway 80 has a same function as the foregoing gateway 80, and no details are described herein again. The routing bridge 90 has a same function as the foregoing routing bridge 90, and no details are described herein again.</p><p id="p0165" num="0165">According to a system for transmitting a multicast packet across Layer 2 virtual networks on a TRILL network provided by the embodiment of the present invention, a terminal sends an IGMP packet to a routing bridge; the routing bridge acquires a multicast address included in the IGMP packet and a network identifier of a Layer 2 virtual network on which the terminal is located, and sends an LSP including the network identifier and the multicast address to a gateway that is on the TRILL network; the gateway performs calculation on the network identifier and the multicast address that are in the LSP, to obtain a calculation result corresponding to a combination of the network identifier and the multicast address; if determining that information preconfigured on the gateway matches the calculation result corresponding to the combination of the network identifier and the multicast address, the gateway sends a notification message to the RB that is on the TRILL network; the terminal sends a multicast packet to the routing bridge; and the routing bridge sends a multicast packet corresponding to the multicast address in the matched combination to the<!-- EPO <DP n="43"> --> gateway that is in the matched combination, and the gateway forwards the multicast packet. A gateway that forwards a multicast packet is determined, among gateways, based on a Layer 2 virtual network identifier and a multicast group address. Different multicast packets sent from a same Layer 2 virtual network may have different multicast addresses, so that the different multicast packets on the same Layer 2 virtual network are not limited to be forwarded on a same gateway, and therefore when a large number of multicast packets on the Layer 2 virtual network need to be forwarded, a burden on a single gateway is reduced.</p><p id="p0166" num="0166">It may be clearly understood by a person skilled in the art that, for the purpose of convenient and brief description, for a detailed working process of the foregoing unit and system, reference may be made to a corresponding process in the foregoing method embodiments, and details are not described herein again.</p><p id="p0167" num="0167">In the several embodiments provided in the present application, it should be understood that the disclosed system, device, and method may be implemented in other manners. For example, the described device embodiment is merely exemplary. For example, the unit division is merely logical function division and may be other division in actual implementation. For example, a plurality of units or components may be combined or integrated into another system, or some features may be ignored or not performed. In addition, the displayed or discussed mutual couplings or direct couplings or communication connections may be implemented through some interfaces. The indirect couplings or communication connections between the apparatuses or units may be implemented in electronic, mechanical, or other forms.</p><p id="p0168" num="0168">The units described as separate parts may or may not be physically separate, and parts displayed as units may or may not be physical units, may be located in one position, or may be distributed on a plurality of network units. A part or all of the units may be selected according to actual needs to achieve the objectives of the solutions of the embodiments.</p><p id="p0169" num="0169">In addition, functional units in the embodiments of the present invention may be integrated into one processing unit, or each of the units may exist alone physically, or two or more units are integrated into one unit. The integrated unit may be implemented in a form of hardware, or may be implemented in a form of hardware in addition to a software functional<!-- EPO <DP n="44"> --> unit.</p><p id="p0170" num="0170">Finally, it should be noted that the foregoing embodiments are merely intended for describing the technical solutions of the present invention other than limiting the present invention. Although the present invention is described in detail with reference to the foregoing embodiments, persons of ordinary skill in the art should understand that they may still make modifications to the technical solutions described in the foregoing embodiments or make equivalent replacements to some technical features thereof, without departing from the scope of the technical solutions of the embodiments of the present invention.</p></description><claims mxw-id="PCLM90459228" lang="EN" load-source="patent-office"><!-- EPO <DP n="45"> --><claim id="c-en-0001" num="0001"><claim-text>A method for transmitting a multicast packet across Layer 2 virtual networks on a Transparent Interconnection of Lots of Links, TRILL, network, comprising:
<claim-text>receiving, by a gateway, a link state packet, LSP, sent by each routing bridge, RB, wherein each LSP comprises: a network identifier of a Layer 2 virtual network and a multicast address;</claim-text>
<claim-text>separately performing, by the gateway, calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address;</claim-text>
<claim-text>if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, sending a notification message to each RB that is on the TRILL network, wherein the notification message comprises the network identifier and the multicast address that are in the matched combination; and</claim-text>
<claim-text>receiving, by the gateway from at least one RB, a multicast packet corresponding to the multicast address in the matched combination, and forwarding the multicast packet.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein the separately performing, by the gateway, calculation on the network identifier and the multicast address that are in each LSP, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address comprises:
<claim-text>separately performing, by the gateway, data conversion on the network identifier and the multicast address that are in each LSP, and performing computation in combination with a total number of gateways that are on the TRILL network, to obtain the calculation result corresponding to each combination of the network identifier and the multicast address.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 2, wherein<br/>
the network identifier is a 12-bit virtual local area network identifier VLAN ID;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k; and<br/>
<!-- EPO <DP n="46"> -->the calculation result corresponding to the combination of the network identifier and the multicast address is m, and m=(VLAN ID&lt;&lt;32+Group Address)%k, wherein<br/>
"&lt;&lt;" indicates right shifting, and "%" indicates performing a modulo operation.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to claim 2, wherein:
<claim-text>the network identifier is a 24-bit fine grained label FGL;</claim-text>
<claim-text>the multicast address is a class D IP address Group Address;</claim-text>
<claim-text>the total number of gateways is an integer k; and</claim-text>
<claim-text>the calculation result corresponding to the combination of the network identifier and the multicast address is m, and m=((FGL&lt;&lt;k%12|FGL)%k+(GroupAddress&lt;&lt;k%32|Group Address)%k)%k, wherein<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and "|" indicates an OR operation.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to claim 3 or 4, wherein<br/>
the information preconfigured on the gateway is a sequence number of the gateway; the sequence number is obtained by sorting, according to TRILL protocol system identifiers system IDs of the gateways that are on the TRILL network, all the gateways that are on the TRILL network according to a natural number sequence starting from 0 and ending at k-1; and<br/>
correspondingly, the if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, sending a notification message to each RB that is on the TRILL network comprises:
<claim-text>if the gateway determines that the sequence number of the gateway is equal to a calculation result m corresponding to the combination of the network identifier and the multicast address, sending the notification message to each RB that is on the TRILL network.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A method for transmitting a multicast packet across Layer 2 virtual networks on a Transparent Interconnection of Lots of Links, TRILL, network, comprising:
<claim-text>separately sending, by a routing bridge, a link state packet, LSP, to each gateway that is on the TRILL network, wherein the LSP comprises: a network identifier of a Layer 2 virtual<!-- EPO <DP n="47"> --> network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway;</claim-text>
<claim-text>receiving, by the routing bridge, a notification message sent by a first gateway, wherein the first gateway is a gateway on the TRILL network and information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address; and</claim-text>
<claim-text>sending, by the routing bridge, a multicast packet corresponding to the multicast address to the first gateway.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method according to claim 6, wherein if the first gateway is not a TRILL distribution tree root, the notification message is a first LSP comprising the network identifier and the multicast address; and<br/>
correspondingly, the receiving, by the routing bridge, a notification message sent by a first gateway, and sending a multicast packet corresponding to the multicast address to the first gateway comprises:
<claim-text>receiving, by the routing bridge, the first LSP sent by the first gateway;</claim-text>
<claim-text>disposing, according to the first LSP, the first gateway on a TRILL distribution tree corresponding to the network identifier and the multicast address; and</claim-text>
<claim-text>sending the multicast packet corresponding to the multicast address to the first gateway by using the TRILL distribution tree.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method according to claim 6, wherein if the first gateway is a TRILL distribution tree root, the notification message is an extended LSP comprising the network identifier and the multicast address and a correspondence between the network identifier and the multicast address and the TRILL distribution tree root; and<br/>
correspondingly, the receiving, by the routing bridge, a notification message sent by a first gateway, and sending a multicast packet corresponding to the multicast address to the first gateway comprises:
<claim-text>receiving, by the routing bridge, the extended LSP sent by the first gateway;</claim-text>
<claim-text>generating a local multicast entry according to the extended LSP; and<!-- EPO <DP n="48"> --></claim-text>
<claim-text>sending the multicast packet corresponding to the multicast address to the first gateway by using a TRILL distribution tree whose root is the first gateway according to the local multicast entry.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>A gateway, comprising:
<claim-text>a receiving module, configured to receive a link state packet, LSP, sent by each routing bridge, RB, wherein each LSP comprises: a network identifier of a Layer 2 virtual network and a multicast address;</claim-text>
<claim-text>a calculation module, configured to separately perform calculation on the network identifier and the multicast address that are in each LSP received by the receiving module, to obtain a calculation result corresponding to each combination of the network identifier and the multicast address;</claim-text>
<claim-text>a sending module, configured to: if the gateway determines that information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address, send a notification message to each RB that is on a Transparent Interconnection of Lots of Links, TRILL, network, wherein the notification message comprises the network identifier and the multicast address that are in the matched combination;</claim-text>
<claim-text>a multicast packet receiving module, configured to receive, from at least one RB, a multicast packet corresponding to the multicast address in the matched combination; and</claim-text>
<claim-text>a multicast packet forwarding module, configured to forward the multicast packet received by the multicast packet receiving module.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The gateway according to claim 9, wherein the calculation module is specifically configured to:
<claim-text>separately perform data conversion on the network identifier and the multicast address that are in each LSP received by the receiving module, and performing computation in combination with a total number of gateways that are on the TRILL network, to obtain the calculation result corresponding to each combination of the network identifier and the multicast address.</claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The gateway according to claim 10, wherein<br/>
<!-- EPO <DP n="49"> -->the network identifier is a 12-bit virtual local area network identifier VLAN ID;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m; and<br/>
the calculation module is specifically configured to obtain, according to a formula m=(VLAN ID&lt;&lt;32+Group Address)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, wherein<br/>
"&lt;&lt;" indicates right shifting, and "%" indicates performing a modulo operation.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The gateway according to claim 10, wherein<br/>
the network identifier is a 24-bit fine grained label FGL;<br/>
the multicast address is a class D IP address Group Address;<br/>
the total number of gateways is an integer k;<br/>
the calculation result corresponding to the combination of the network identifier and the multicast address is m; and<br/>
the calculation module is specifically configured to obtain, according to a formula m=((FGL&lt;&lt;k%12|FGL)%k+(Group Address&lt;&lt;k%32|Group Address)%k)%k, the calculation result corresponding to each combination of the network identifier and the multicast address, wherein<br/>
"&lt;&lt;" indicates right shifting, "%" indicates performing a modulo operation, and "|" indicates an OR operation.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The gateway according to claim 11 or 12, wherein the information preconfigured on the gateway is a sequence number of the gateway; the sequence number is obtained by sorting, according to TRILL protocol system identifiers system IDs of the gateways that are on the TRILL network, all the gateways that are on the TRILL network according to a natural number sequence starting from 0 and ending at k-1; and<br/>
correspondingly, the sending module is specifically configured to:
<claim-text>if the gateway determines that the sequence number of the gateway is equal to a calculation result m corresponding to a combination of the network identifier and the<!-- EPO <DP n="50"> --> multicast address, send the notification message to each RB that is on the TRILL network.</claim-text></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A routing bridge, comprising:
<claim-text>a sending module, configured to separately send a link state packet, LSP, to each gateway that is on a Transparent Interconnection of Lots of Links, TRILL, network, wherein the LSP comprises: a network identifier of a Layer 2 virtual network and a multicast address, and the LSP is used to enable each gateway to perform calculation on the network identifier and the multicast address that are in the LSP and to match a calculation result with information preconfigured on the gateway;</claim-text>
<claim-text>a receiving module, configured to receive a notification message sent by a first gateway, wherein the first gateway is a gateway on the TRILL network and information preconfigured on the gateway matches a calculation result corresponding to a combination of the network identifier and the multicast address; and</claim-text>
<claim-text>a multicast packet sending module, configured to send a multicast packet corresponding to the multicast address to the first gateway.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The routing bridge according to claim 14, wherein:
<claim-text>if the first gateway is not a TRILL distribution tree root, the notification message is a first LSP comprising the network identifier and the multicast address; and</claim-text>
<claim-text>correspondingly, the receiving module is specifically configured to receive the first LSP sent by the first gateway; the routing bridge further comprises: a disposing module, configured to dispose, according to the first LSP, the first gateway on a TRILL distribution tree corresponding to the network identifier and the multicast address; and the multicast packet sending module is specifically configured to send the multicast packet corresponding to the multicast address to the first gateway by using the TRILL distribution tree; or</claim-text>
<claim-text>if the first gateway is a TRILL distribution tree root, the notification message is an extended LSP comprising the network identifier and the multicast address and a correspondence between the network identifier and the multicast address and the TRILL distribution tree root; and</claim-text>
<claim-text>correspondingly, the receiving module is specifically configured to receive the extended LSP sent by the first gateway; the routing bridge further comprises: a generating module,<!-- EPO <DP n="51"> --> configured to generate a local multicast entry according to the extended LSP; and the multicast packet sending module is specifically configured to send the multicast packet corresponding to the multicast address to the first gateway by using a TRILL distribution tree whose root is the first gateway according to the local multicast entry.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW20421964" load-source="patent-office"><!-- EPO <DP n="52"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="125" he="188" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="53"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="162" he="140" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="54"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="162" he="140" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="55"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="162" he="214" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="56"> --><figure id="f0005" num="5,6"><img id="if0005" file="imgf0005.tif" wi="84" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="57"> --><figure id="f0006" num="6A,6B"><img id="if0006" file="imgf0006.tif" wi="84" he="197" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="58"> --><figure id="f0007" num="6C,7"><img id="if0007" file="imgf0007.tif" wi="100" he="197" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="59"> --><figure id="f0008" num="8,9,10"><img id="if0008" file="imgf0008.tif" wi="135" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="159" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="159" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
