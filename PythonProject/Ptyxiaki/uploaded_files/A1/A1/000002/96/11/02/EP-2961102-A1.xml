<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961102-A1" country="EP" doc-number="2961102" kind="A1" date="20151230" family-id="48550098" file-reference-id="313851" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451579" ucid="EP-2961102-A1"><document-id><country>EP</country><doc-number>2961102</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14764035-A" is-representative="YES"><document-id mxw-id="PAPP193866126" load-source="patent-office" format="original"><country>EP</country><doc-number>14764035.3</doc-number><date>20140314</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193866127" load-source="docdb" format="epo"><country>EP</country><doc-number>14764035</doc-number><kind>A</kind><date>20140314</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162034975" ucid="CN-201310084117-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201310084117</doc-number><kind>A</kind><date>20130315</date></document-id></priority-claim><priority-claim mxw-id="PPC162036278" ucid="CN-2014073431-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2014073431</doc-number><kind>W</kind><date>20140314</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1967012776" load-source="docdb">H04L  12/26        20060101AFI20160215BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1723125558" load-source="docdb" scheme="CPC">H04L  43/026       20130101 LI20171211BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1723125559" load-source="docdb" scheme="CPC">H04L  43/022       20130101 LI20171211BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984697118" load-source="docdb" scheme="CPC">H04L  43/0864      20130101 LI20160108BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984697407" load-source="docdb" scheme="CPC">H04L  43/12        20130101 LI20160108BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984698439" load-source="docdb" scheme="CPC">H04L  43/0876      20130101 FI20160107BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984698778" load-source="docdb" scheme="CPC">H04L  47/115       20130101 LI20160107BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984700421" load-source="docdb" scheme="CPC">H04L  43/0829      20130101 LI20160108BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984704275" load-source="docdb" scheme="CPC">H04L  69/16        20130101 LI20160107BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165546203" lang="DE" load-source="patent-office">VERFAHREN UND VORRICHTUNG ZUR ÜBERWACHUNG EINER NETZWERKLEISTUNG</invention-title><invention-title mxw-id="PT165546204" lang="EN" load-source="patent-office">METHOD AND DEVICE FOR MONITORING NETWORK PERFORMANCE</invention-title><invention-title mxw-id="PT165546205" lang="FR" load-source="patent-office">MÉTHODE ET DISPOSITIF DE SURVEILLANCE DE PERFORMANCE DE RÉSEAU</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103326238" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI TECH CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103322300" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI TECHNOLOGIES CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101641122" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Technologies Co., Ltd.</last-name><iid>100970540</iid><address><street>Huawei Administration Building Bantian</street><city>LONGGANG DISTRICT SHENZHEN, GUANGDONG 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103315375" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>LI JIE</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103334258" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>LI, JIE</last-name></addressbook></inventor><inventor mxw-id="PPAR1101653141" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>LI, JIE</last-name><address><street>Huawei Administration Building Bantian Longgang</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103308555" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>YIN ZHIDONG</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103305085" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>YIN, ZHIDONG</last-name></addressbook></inventor><inventor mxw-id="PPAR1101647910" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>YIN, ZHIDONG</last-name><address><street>Huawei Administration Building Bantian Longgang</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103315122" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>XU MEI</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103343611" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>XU, Mei</last-name></addressbook></inventor><inventor mxw-id="PPAR1101649264" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>XU, Mei</last-name><address><street>Huawei Administration Building Bantian Longgang</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101652636" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Lord, Michael</last-name><iid>100051442</iid><address><street>Gill Jennings &amp; Every LLP The Broadgate Tower 20 Primrose Street</street><city>London EC2A 2ES</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2014073431-W"><document-id><country>CN</country><doc-number>2014073431</doc-number><kind>W</kind><date>20140314</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014139461-A1"><document-id><country>WO</country><doc-number>2014139461</doc-number><kind>A1</kind><date>20140918</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660784013" load-source="docdb">AL</country><country mxw-id="DS660687590" load-source="docdb">AT</country><country mxw-id="DS660607697" load-source="docdb">BE</country><country mxw-id="DS660612319" load-source="docdb">BG</country><country mxw-id="DS660611842" load-source="docdb">CH</country><country mxw-id="DS660607698" load-source="docdb">CY</country><country mxw-id="DS660689477" load-source="docdb">CZ</country><country mxw-id="DS660784015" load-source="docdb">DE</country><country mxw-id="DS660607707" load-source="docdb">DK</country><country mxw-id="DS660607708" load-source="docdb">EE</country><country mxw-id="DS660695400" load-source="docdb">ES</country><country mxw-id="DS660612320" load-source="docdb">FI</country><country mxw-id="DS660612321" load-source="docdb">FR</country><country mxw-id="DS660784016" load-source="docdb">GB</country><country mxw-id="DS660607709" load-source="docdb">GR</country><country mxw-id="DS660784017" load-source="docdb">HR</country><country mxw-id="DS660689478" load-source="docdb">HU</country><country mxw-id="DS660611847" load-source="docdb">IE</country><country mxw-id="DS660607710" load-source="docdb">IS</country><country mxw-id="DS660612322" load-source="docdb">IT</country><country mxw-id="DS660607719" load-source="docdb">LI</country><country mxw-id="DS660612327" load-source="docdb">LT</country><country mxw-id="DS660687603" load-source="docdb">LU</country><country mxw-id="DS660612328" load-source="docdb">LV</country><country mxw-id="DS660612329" load-source="docdb">MC</country><country mxw-id="DS660687604" load-source="docdb">MK</country><country mxw-id="DS660687605" load-source="docdb">MT</country><country mxw-id="DS660695401" load-source="docdb">NL</country><country mxw-id="DS660687876" load-source="docdb">NO</country><country mxw-id="DS660695402" load-source="docdb">PL</country><country mxw-id="DS660612330" load-source="docdb">PT</country><country mxw-id="DS660689491" load-source="docdb">RO</country><country mxw-id="DS660612335" load-source="docdb">RS</country><country mxw-id="DS660695407" load-source="docdb">SE</country><country mxw-id="DS660611848" load-source="docdb">SI</country><country mxw-id="DS660687877" load-source="docdb">SK</country><country mxw-id="DS660687878" load-source="docdb">SM</country><country mxw-id="DS660687606" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479949" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Embodiments of the present invention provide a network performance monitoring method and apparatus. A network performance monitoring apparatus records a time at which a first network device sends a first packet to a second network device, that is, a first time, records a time at which the first network device receives a response packet of the first packet, that is, a second time, and determines a round-trip delay between the first network device and the second network device according to the first time and the second time; within a preset time, the network performance monitoring apparatus collects statistics about a quantity of first packets that are sent by the first network device to the second network device, that is, a first count, and collects statistics about a quantity of retransmitted packets in the first packets, that is, a second count, and determines a packet loss rate from the first network device to the second network device according to the first count and the second count. The embodiments further provide a corresponding apparatus. The foregoing first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol. When network performance is measured, network load may be reduced by using the foregoing method.<img id="iaf01" file="imgaf001.tif" wi="78" he="99" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759761" lang="EN" source="EPO" load-source="docdb"><p>Embodiments of the present invention provide a network performance monitoring method and apparatus. A network performance monitoring apparatus records a time at which a first network device sends a first packet to a second network device, that is, a first time, records a time at which the first network device receives a response packet of the first packet, that is, a second time, and determines a round-trip delay between the first network device and the second network device according to the first time and the second time; within a preset time, the network performance monitoring apparatus collects statistics about a quantity of first packets that are sent by the first network device to the second network device, that is, a first count, and collects statistics about a quantity of retransmitted packets in the first packets, that is, a second count, and determines a packet loss rate from the first network device to the second network device according to the first count and the second count. The embodiments further provide a corresponding apparatus. The foregoing first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol. When network performance is measured, network load may be reduced by using the foregoing method.</p></abstract><description mxw-id="PDES98404650" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><p id="p0001" num="0001">This application claims priority to Chinese Patent Application No. <patcit id="pcit0001" dnum="CN201310084117"><text>201310084117.8, filed with the Chinese Patent Office on March 15, 2013</text></patcit> and entitled "NETWORK PERFORMANCE MONITORING METHOD AND APPARATUS", which is incorporated herein by reference in its entirety.</p><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0002" num="0002">Embodiments of the present invention relate to communications technologies, and in particular, to a network performance monitoring method and apparatus.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0003" num="0003">Traditional IP network performance monitoring uses a solution based on active measurement. The solution of active measurement is a test solution in an analog form, and a test packet is exchanged between node A and node B in a network to determine performance such as packet loss, a delay, and a jitter on a network path between node A and node B. Testing a delay is used as an example. Node A generates and sends a test packet to node B every a predetermined period, and node A records a sending time T1 of the test packet. After receiving the test packet, node B constructs a test packet that is to be used as a response packet, and sends the response packet to node A. After receiving the response packet, node A records a time T4 at which the response packet is received. A difference between T4 and T1 is calculated to obtain a round-trip delay between node A and node B. The solution of active measurement increases network load.</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0004" num="0004">Embodiments of the present invention provide a network performance<!-- EPO <DP n="2"> --> monitoring method and apparatus, which may reduce network load when network performance is measured.</p><p id="p0005" num="0005">According to a first aspect, an embodiment of the present invention provides a network performance monitoring method, and the method includes:
<ul><li>receiving, by a network performance monitoring apparatus, a second packet sent by a first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol;</li><li>recording, by the network performance monitoring apparatus, a first time, where the first time is a time at which the network performance monitoring apparatus receives the second packet;</li><li>receiving, by the network performance monitoring apparatus, a fourth packet sent by the first network device, where the fourth packet is a duplicate packet of a third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, a type of the third packet is the same as the type of the first packet, and a source transmit end of the third packet is the second network device;</li><li>when the network performance monitoring apparatus determines that the fourth packet is a response packet of the second packet, recording, by the network performance monitoring apparatus, a second time, where the second time is a time at which the network performance monitoring apparatus receives the fourth packet; and</li><li>determining, by the network performance monitoring apparatus, a round-trip delay between the first network device and the second network device according to the first time and the second time. The second packet is a duplicate packet of the first packet, the second packet is copied when the first network device sends the first packet to the second network device, a destination receive end of the first packet is the second network device, a type of the first packet includes a packet of a traffic flow transmitted by using a connection-oriented protocol and a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol;<!-- EPO <DP n="3"> --></li><li>recording, by the network performance monitoring apparatus, a first time, where the first time is a time at which the network performance monitoring apparatus receives the second packet;</li><li>receiving, by the network performance monitoring apparatus, a fourth packet sent by the first network device, where the fourth packet is a duplicate packet of the third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, and a type of the third packet is the same as the type of the first packet;</li><li>when the network performance monitoring apparatus determines that the fourth packet is a response packet of the second packet, recording, by the network performance monitoring apparatus, a second time, where the second time is a time at which the network performance monitoring apparatus receives the second packet; and</li><li>determining, by the network performance monitoring apparatus, a round-trip delay between the first network device and the second network device according to the first time and the second time.</li></ul></p><p id="p0006" num="0006">In a first possible implementation manner of the first aspect, if the network performance monitoring apparatus is disposed outside the first network device,<br/>
the receiving, by the network performance monitoring apparatus, the second packet sent by the first network device includes:
<ul><li>receiving, by the network performance monitoring apparatus, the second packet obtained by the first network device by copying the first packet in a mirroring manner; and</li><li>the receiving, by the network performance monitoring apparatus, the fourth packet sent by the first network device includes:
<ul><li>receiving, by the network performance monitoring apparatus, the fourth packet obtained by the first network device by copying the third packet in the mirroring manner.</li></ul></li></ul></p><p id="p0007" num="0007">In a second possible implementation manner of the first aspect, the first network device is an optical splitter.</p><p id="p0008" num="0008">With reference to the first aspect, or the first possible implementation manner of the first aspect, or the second possible implementation manner of the first aspect, in a third possible implementation manner of the first aspect, the connection-oriented protocol includes the Transmission Control Protocol (Transmission Control Protocol, TCP) or the Stream Control Transmission Protocol<!-- EPO <DP n="4"> --> (Stream Control Transmission Protocol, SCTP).</p><p id="p0009" num="0009">According to a second aspect, an embodiment of the present invention provides a network performance monitoring apparatus, and the apparatus includes:
<ul><li>a receiving module, configured to receive a second packet sent by a first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol;</li><li>a recording module, configured to record a first time, where the first time is a time at which the receiving module receives the second packet; where</li><li>the receiving module is further configured to receive a fourth packet sent by the first network device, where the fourth packet is a duplicate packet of a third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, a type of the third packet is the same as the type of the first packet, and a source transmit end of the third packet is the second network device; and</li><li>a determining module, configured to determine whether the fourth packet is a response packet of the second packet; where</li><li>the recording module is further configured to record a second time when the determining module determines that the fourth packet is the response packet of the second packet, where the second time is a time at which the receiving module receives the fourth packet; and</li><li>the determining module is further configured to determine a round-trip delay between the first network device and the second network device according to the first time and the second time that are recorded by the recording module.</li></ul></p><p id="p0010" num="0010">In a second possible implementation manner of the second aspect, the network performance monitoring apparatus is disposed outside the first network device;<br/>
the receiving module is specifically configured to receive the second packet obtained by the first network device by copying the first packet in a mirroring manner; and<br/>
<!-- EPO <DP n="5"> -->the receiving module is further specifically configured to receive the fourth packet obtained by the first network device by copying the third packet in the mirroring manner.</p><p id="p0011" num="0011">In a second possible implementation manner of the second aspect, the first network device is an optical splitter.</p><p id="p0012" num="0012">With reference to the second aspect, or the first possible implementation manner of the second aspect, or the second possible implementation manner of the second aspect, in a third possible implementation manner of the second aspect, the connection-oriented protocol includes TCP or SCTP.</p><p id="p0013" num="0013">In the foregoing technical solutions, a network performance monitoring apparatus disposed inside or outside a first network device records a first time when receiving a second packet sent by the first network device, records a second time when determining that a response packet of the second packet sent by the first network device is received, and determines a round-trip delay between the first network device and a second network device according to the first time and the second time. The second packet is copied when the first network device sends a first packet to the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, where the connection is used to transmit a traffic flow by using a connection-oriented protocol, and a destination receive end of the first packet is the second network device. The first packet and a third packet are packets of traffic flows that actually exist in a network or packets that are used to establish a connection, instead of packets of test flows that are extra added to the network. Therefore, when network performance is measured, the solutions provided in the embodiments may reduce network load.</p><p id="p0014" num="0014">According to a third aspect, an embodiment of the present invention provides a network performance monitoring method, and the method includes:
<ul><li>receiving, by a network performance monitoring apparatus within a preset time, a second packet sent by a first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, and a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol;</li><li>collecting, by the network performance monitoring apparatus, statistics<!-- EPO <DP n="6"> --> about a quantity of the second packets received within the preset time to obtain a first count;</li><li>collecting, by the network performance monitoring apparatus, statistics about a quantity of retransmitted packets in the second packets received within the preset time to obtain a second count; and</li><li>determining, by the network performance monitoring apparatus, a packet loss rate from the first network device to the second network device according to the first count and the second count.</li></ul></p><p id="p0015" num="0015">In a first possible implementation manner of the third aspect, the collecting, by the network performance monitoring apparatus, statistics about a quantity of the second packets received within the preset time to obtain a first count, and the collecting, by the network performance monitoring apparatus, statistics about a quantity of retransmitted packets in the second packets received within the preset time to obtain a second count include:
<ul><li>setting, by the network performance monitoring apparatus, a first counter and a second counter, where a value of the first counter is the first count, a value of the second counter is the second count, and initial values of the first counter and the second counter are respectively set to zero;</li><li>when the network performance monitoring apparatus receives the second packet, increasing the value of the first counter by 1, and searching, according to a sequence number and a traffic flow identifier that are carried by the second packet, information stored by the network performance monitoring apparatus to determine whether a matching item exists, where the stored information includes a correspondence between a sequence number and a traffic flow identifier;</li><li>if the matching item exists, determining, by the network performance monitoring apparatus, that the second packet is the retransmitted packet, and increasing the value of the second counter by 1; and</li><li>if the matching item does not exist, saving, by the network performance monitoring apparatus, a correspondence between the sequence number and the traffic flow identifier that are carried by the second packet.</li></ul></p><p id="p0016" num="0016">With reference to the third aspect or the first possible implementation manner of third aspect, in a second possible implementation manner of the third aspect, if the network performance monitoring apparatus is disposed outside the first network device, the receiving, by the network performance monitoring apparatus, the<!-- EPO <DP n="7"> --> second packet sent by the first network device includes:
<ul><li>receiving, by the network performance monitoring apparatus, the second packet obtained by the first network device by copying the first packet in a mirroring manner.</li></ul></p><p id="p0017" num="0017">With reference to the third aspect or the first possible implementation manner of the third aspect, in a third possible implementation manner of the third aspect, the first network device is an optical splitter.</p><p id="p0018" num="0018">With reference to the third aspect or any one of the first to the third possible implementation manners of the third aspect, in a fourth possible implementation manner of the third aspect, the connection-oriented protocol includes TCP or SCTP.</p><p id="p0019" num="0019">According to a fourth aspect, an embodiment of the present invention provides a network performance monitoring apparatus, and the apparatus includes:
<ul><li>a receiving module, configured to receive, within a preset time, a second packet sent by a first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, and a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol;</li><li>a statistics module, configured to collect statistics about a quantity of the second packets received by the receiving module within the preset time to obtain a first count; where</li><li>the statistics module is further configured to collect statistics about a quantity of retransmitted packets in the second packets received by the receiving module within the preset time to obtain a second count; and</li><li>a determining module, configured to determine a packet loss rate from the first network device to the second network device according to the first count and the second count that are counted by the statistics module.</li></ul></p><p id="p0020" num="0020">In a first possible implementation manner of the fourth aspect, the following is further included:
<ul><li>a first counter and a second counter, where a value of the first counter is the first count, a value of the second counter is the second count, and initial values of the first counter and the second counter are respectively set to zero; and</li><li>a storage module, configured to store a correspondence between a<!-- EPO <DP n="8"> --> sequence number and a traffic flow identifier that are carried by the second packet; where</li><li>the statistics module is specifically configured to, when the receiving module receives the second packet, increase the value of the first counter by 1, and search, according to the sequence number and the traffic flow identifier that are carried by the second packet, information stored by the storage module to determine whether a matching item exists, where the stored information includes a correspondence between a sequence number and a traffic flow identifier; if the matching item exists, determine that the second packet is the retransmitted packet, and increase the value of the second counter by 1; if the matching item does not exist, trigger the storage module to save the correspondence between the sequence number and the traffic flow identifier that are carried by the second packet. With reference to the fourth aspect or the first possible implementation manner of the fourth aspect, in a second possible implementation manner of the fourth aspect, the network performance monitoring apparatus is disposed outside the first network device; and the receiving module is specifically configured to receive the second packet obtained by the first network device by copying the first packet in a mirroring manner.</li></ul></p><p id="p0021" num="0021">With reference to the fourth aspect or the first possible implementation manner of the fourth aspect, in a third possible implementation manner of the fourth aspect, the first network device is an optical splitter.</p><p id="p0022" num="0022">With reference to the fourth aspect or any one of the first to the third possible implementation manners of the fourth aspect, in a fourth possible implementation manner of the fourth aspect, the connection-oriented protocol includes TCP or SCTP.</p><p id="p0023" num="0023">In the foregoing technical solutions, a network performance monitoring apparatus collects, within a preset time, statistics about a quantity of second packets sent by a first network device and a quantity of retransmitted packets in the second packets, to determine a packet loss rate from the first network device to a second network device. The second packet is copied when the first network device sends a first packet to a second network, the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol, and a destination receive end of the first packet is the second network device. The first packet is a packet of a traffic flow that actually exists in a network, instead of a packet of a test flow that is extra added to the network. Therefore, when network performance is measured, the<!-- EPO <DP n="9"> --> solutions provided in the embodiments may reduce network load.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0024" num="0024"><ul><li><figref idrefs="f0001">FIG. 1A</figref> is a flowchart of a network performance monitoring method according to an embodiment of the present invention;</li><li><figref idrefs="f0001">FIG. 1B</figref> is a schematic diagram of a network that executes the method shown in <figref idrefs="f0001">FIG. 1A</figref>;</li><li><figref idrefs="f0002">FIG. 1C</figref> is a schematic diagram of a network that executes the method shown in <figref idrefs="f0001">FIG. 1A</figref>;</li><li><figref idrefs="f0002">FIG. 2</figref> is a diagram of an application scenario according to an embodiment of the present invention;</li><li><figref idrefs="f0002">FIG. 3A</figref> is a schematic diagram of acquiring a traffic flow by an external network performance monitoring apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 3B</figref> is a schematic diagram of acquiring a traffic flow by another external network performance monitoring apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 4</figref> is a flowchart of a network performance monitoring method according to an embodiment of the present invention;</li><li><figref idrefs="f0004">FIG. 5</figref> is a schematic structural diagram of a network performance monitoring apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0004">FIG. 6</figref> is a schematic structural diagram of another network performance monitoring apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 7</figref> is a schematic structural diagram of another network performance monitoring apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 8</figref> is a schematic structural diagram of another network performance monitoring apparatus according to an embodiment of the present invention; and</li><li><figref idrefs="f0006">FIG. 9</figref> is a schematic structural diagram of another network performance monitoring apparatus according to an embodiment of the present invention.</li></ul></p><heading id="h0005"><b>DESCRIPTION OF EMBODIMENTS</b></heading><p id="p0025" num="0025">In technical solutions provided in embodiments of the present invention, a<!-- EPO <DP n="10"> --> round-trip delay and a packet loss rate of a network are determined by using a response mechanism and a retransmission mechanism that a connection-oriented protocol has. The connection-oriented protocol has the response mechanism and the retransmission mechanism, and is a reliable transmission protocol. In the embodiments of the present invention, when network performance is measured, no extra test flow is introduced into the network, and therefore, load on the network may be reduced. The technical solutions provided in the embodiments of the present invention are applicable to performance measurement of a network, such as an IP network, an IP radio access network (Radio Access Network, RAN for short), or a mobile bearer network. For example, in a mobile bearer network, packets on a signaling plane or a management plane are monitored, and these packets are packets transmitted by using a connection-oriented protocol. Signaling services are transmitted based on SCTP, and operation, administration and maintenance (operation, administration and maintenance, OAM for short) services are transmitted based on TCP, where both the SCTP protocol and the TCP protocol are connection-oriented protocols.</p><p id="p0026" num="0026"><figref idrefs="f0001">FIG. 1A</figref> is a flowchart of a network performance monitoring method according to an embodiment of the present invention. As shown in <figref idrefs="f0001">FIG. 1A</figref>, the method provided in this embodiment includes:
<ul><li>11. A network performance monitoring apparatus receives a second packet sent by a first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol.</li><li>12. The network performance monitoring apparatus records a first time, where the first time is a time at which the network performance monitoring apparatus receives the second packet.</li></ul></p><p id="p0027" num="0027">For example, the connection-oriented protocol includes TCP or SCTP. In an example in which the connection-oriented protocol is TCP, a packet of a traffic flow transmitted by using the connection-oriented protocol refers to a packet of a TCP traffic flow transmitted after TCP connection establishment is completed, and a packet<!-- EPO <DP n="11"> --> that is used to establish a connection refers to a control packet during a TCP connection establishment phase.</p><p id="p0028" num="0028">The second network device is the destination receive end of the first packet, and the first network device may be a source transmit end, or may not be the source transmit end of the first packet, that is, the first network device is an intermediate device that is located between the source transmit end of the first packet and the second network device. The network performance monitoring apparatus is disposed inside or outside the first network device. The foregoing first network device and the second network device may be adjacent devices or non-adjacent devices that meet the foregoing conditions.</p><p id="p0029" num="0029">When being disposed inside the first network device, the network performance monitoring apparatus may be a card that is inserted into the first network device. When being disposed outside the first network device, the network performance monitoring apparatus may be an external probe that is connected to the first network device.</p><p id="p0030" num="0030">When the first network device sends the first packet to the second network device, a duplicate packet of the first packet, that is, the second packet, is sent to the network performance monitoring apparatus. After receiving the second packet, the network performance monitoring apparatus records the time at which the second packet is received, that is, the first time. Optionally, in an example in which the second packet is a TCP packet, a sequence number (sequence number) and a traffic flow identifier that are carried by the second packet may further be recorded together with the time at which the second packet is received, so as to determine whether a packet received subsequently is a response packet of the second packet.</p><p id="p0031" num="0031">For example, as shown in <figref idrefs="f0001">FIG. 1B</figref>, the network performance monitoring apparatus is disposed outside the first network device, the first network device copies, in a mirroring manner, a packet sent to the second network device to the network performance monitoring apparatus, and the network performance monitoring apparatus receives the second packet obtained by the first network device by copying the first packet in the mirroring manner. For example, the mirroring manner includes a port mirroring manner and a traffic mirroring manner.</p><p id="p0032" num="0032">When the port mirroring manner is used, the first network device is connected to the network performance monitoring apparatus through a mirroring port, and the mirroring port copies, to the mirroring port, all packets transmitted on a<!-- EPO <DP n="12"> --> mirrored port. For example, a port that is on the first network device and connected to an upstream device of the first network device, or a port that is on the first network device and connected to an intermediate device may be set as the mirrored port. Therefore, when the first network device sends a packet to the second network device, the first network device copies the sent packet to the network performance monitoring apparatus by means of mirroring. The packet that is sent by the first network device to the second network device includes the first packet. When receiving the packet sent by the first network device, the network performance monitoring apparatus analyzes the packet sent by the first network device to determine whether the packet is the second packet. For example, the network performance monitoring apparatus may determine whether a protocol used by the packet is a connection-oriented protocol by analyzing a protocol field in the received packet; and determine whether a destination receive end of the packet is the second network device according to a destination IP address in the packet. If the network performance monitoring apparatus determines that the packet sent by the first network device is the second packet, a time at which the second packet is received is recorded.</p><p id="p0033" num="0033">When the traffic mirroring manner is used, the first network device is connected to the network performance monitoring apparatus through a mirroring port, and the mirroring port copies all packets of a pre-identified traffic flow on the first network device to the mirroring port. For example, a traffic flow may be identified by using a 5-tuple. Therefore, when the first network device sends a packet to the second network device, the first network device may mirror a specific packet, such as the first packet, to the network performance monitoring apparatus. When receiving a duplicate packet of the first packet, that is, the second packet, the network performance monitoring apparatus records a time at which the second packet is received.</p><p id="p0034" num="0034">For example, as shown in <figref idrefs="f0002">FIG. 1C</figref>, an optical splitter is disposed between a third network device and an upstream device of the third network device, the optical splitter is adjacent to the third network device, and the network performance monitoring apparatus is connected to the optical splitter; in this case, the optical splitter may be considered as the first network device. A round-trip delay between the optical splitter and the second network device may be considered as a round-trip delay between the third network device and the second network device. After receiving a packet that is sent by the upstream device of the third network device to the second network device, the optical splitter sends the packet to the second network device, and<!-- EPO <DP n="13"> --> simultaneously sends a duplicate packet of the packet to the network performance monitoring apparatus. The packet that is sent by the optical splitter to the second network device includes the first packet; similarly, the packet that is sent by the optical splitter to the network performance monitoring apparatus includes a duplicate packet of the first packet, that is, the second packet. After receiving the packet sent by the optical splitter, the network performance monitoring apparatus analyzes whether the packet is the second packet, and if yes, the network performance monitoring apparatus records a time at which the packet is received.</p><p id="p0035" num="0035">13. The network performance monitoring apparatus receives a fourth packet sent by the first network device, where the fourth packet is a duplicate packet of a third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, a type of the third packet is the same as the type of the first packet, and a source transmit end of the third packet is the second network device.</p><p id="p0036" num="0036">The type of the third packet is the same as the type of the first packet. If the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol, the third packet is also a packet of a traffic flow transmitted by using a connection-oriented protocol. If the first packet is a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol, the third packet is also a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol.</p><p id="p0037" num="0037">For example, as shown in <figref idrefs="f0001">FIG. 1B</figref>, in a port mirroring scenario, the first network device copies all received packets (including the third packet) that are sent by the second network device to the upstream device of the first network device to the network performance monitoring apparatus; in a traffic mirroring scenario, the first network device may copy a specific packet, such as the third packet, to the network performance monitoring apparatus.</p><p id="p0038" num="0038">For example, as shown in <figref idrefs="f0002">FIG. 1C</figref>, the optical splitter (that is, the first network device) copies all packets (including the third packet) that are sent by the second network device to the upstream device of the first network device to the network performance monitoring apparatus.
<ul><li>14. When the network performance monitoring apparatus determines that the fourth packet is a response packet of the second packet, the network performance<!-- EPO <DP n="14"> --> monitoring apparatus records a second time, where the second time is a time at which the network performance monitoring apparatus receives the fourth packet.</li></ul></p><p id="p0039" num="0039">For example, the network performance monitoring apparatus may determine whether the fourth packet is the response packet of the second packet by using the following method: An example in which the second packet and the fourth packet are TCP packets is used; optionally, the network performance monitoring apparatus may determine, according to the recorded traffic flow identifier and sequence number that are carried by the second packet, whether a traffic flow identifier carried by the received fourth packet and the traffic flow identifier carried by the second packet belong to a same TCP connection and the fourth packet and the second packet belong to counter flows, and if the traffic flow identifier carried by the received fourth packet and the traffic flow identifier carried by the second packet belong to the same TCP connection and the fourth packet and the second packet belong to counter flows, further determine whether there is a correspondence between an acknowledgement number (acknowledgement number) carried by the fourth packet and the sequence number (sequence number) carried by the second packet. If yes, it is determined that the fourth packet is the response packet of the second packet. For example, if a 5-tuple is used to identify a traffic flow, it is assumed that the recorded traffic flow identifier in the second packet is (source IP address = 1.1.1.1, destination IP address = 2.2.2.2, source port number = 1038, destination port number = 8080, and protocol number = TCP), and the recorded sequence number (sequence number) in the second packet = 400; the traffic flow identifier in the fourth packet is (source IP address = 2.2.2.2, destination IP address = 1.1.1.1, source port number = 8080, destination port number = 1038, and protocol number = TCP), and the acknowledgement number (acknowledgement number) in the fourth packet = 401; then, in TCP, the fourth packet is the response packet of the second packet.</p><p id="p0040" num="0040">After determining that the fourth packet is the response packet of the second packet, the network performance monitoring apparatus records the time at which the fourth packet is received, that is, the second time.
<ul><li>15. The network performance monitoring apparatus determines a round-trip delay between the first network device and the second network device according to the first time and the second time.</li></ul></p><p id="p0041" num="0041">The round-trip delay is also called a round-trip time (Round-Trip Time, RTT for short) between the first network device and the second network device. If the<!-- EPO <DP n="15"> --> first network device is an optical splitter, a round-trip delay between the optical splitter and the second network device is determined.</p><p id="p0042" num="0042">For example, the round-trip delay between the first network device and the second network device = the second time - the first time.</p><p id="p0043" num="0043">Optionally, the network performance monitoring apparatus may record a receiving time of a second packet received within a preset time and a receiving time of a response packet of the second packet, or may record, after a preset number of second packets are received, a time of a received second packet and a time at which a response packet of the second packet is received.</p><p id="p0044" num="0044">After receiving times of multiple second packets and receiving times of corresponding response packets are recorded by using the foregoing method, the network performance monitoring apparatus may calculate a round-trip delay between the first network device and the second network device for each second packet, and finally, average multiple round-trip delays to obtain an average round-trip delay between the first network device and the second network device.</p><p id="p0045" num="0045">For ease of understanding, the following gives a description by using an actual network architecture. Based on the network architecture shown in <figref idrefs="f0002">FIG. 2</figref>, a radio network controller (Radio Network Controller, RNC for short) may be used as a source transmit end of a packet of a TCP traffic flow, and correspondingly, a base station (NodeB) is a destination receive end. Similarly, the NodeB may also be used as a source transmit end of a packet of a TCP traffic flow, and correspondingly, the RNC is a destination receive end. All network devices between the NodeB and the RNC are forwarding devices of a packet of a TCP traffic flow.</p><p id="p0046" num="0046">For example, when the RNC is used as a source transmit end of a packet of a TCP traffic flow and the NodeB is used as a destination receive end of the packet of the TCP traffic flow, if a round-trip delay between a radio service gateway (Radio Service Gateway, RSG for short) and the NodeB needs to be monitored, the network performance monitoring apparatus provided in this embodiment may be disposed inside or outside the RSG.</p><p id="p0047" num="0047">If a round-trip delay between the RNC and the NodeB needs to be monitored, the network performance monitoring apparatus provided in this embodiment may be disposed inside or outside the RNC, and the network performance monitoring apparatus provided in this embodiment may also be disposed inside or outside the NodeB.<!-- EPO <DP n="16"> --></p><p id="p0048" num="0048">When the NodeB is used as a source transmit end of a packet of a TCP traffic flow and the RNC is used as a destination receive end of the packet of the TCP traffic flow, if a round-trip delay between the RSG and the RNC needs to be monitored, the network performance monitoring apparatus provided in this embodiment may be disposed inside or outside the RSG. The network performance monitoring apparatus provided in this embodiment may be a probe (probe).</p><p id="p0049" num="0049">When a network performance monitoring apparatus externally connected to an RSG monitors a round-trip delay between the RSG and a NodeB, as shown in <figref idrefs="f0002">FIG. 3A</figref>, for example, the RSG may enable a port mirroring function, and the RSG completely copies a transmitted packet to a specified mirroring port, where the mirroring port is connected to the mounted network performance monitoring apparatus (that is, a probe), and the mounted network performance monitoring apparatus receives, through the mirroring port, a packet transmitted by the RSG. In this case, the RSG is the first network device and the NodeB is the second network device. In addition, with reference to <figref idrefs="f0002">FIG. 2 and FIG. 3A</figref>, when a packet in a TCP traffic flow sent by the RNC to the NodeB passes the RSG, the RSG copies the packet of the traffic flow to the probe, that is, the network performance monitoring apparatus, and the network performance monitoring apparatus records a time T1 at which the duplicate packet is received; correspondingly, when a response packet that is of the TCP traffic flow and sent by the NodeB to the RNC passes the RSG, the RSG copies the response packet to the network performance monitoring apparatus, and the network performance monitoring apparatus records a time T4 at which a duplicate packet of the response packet is received. The network performance monitoring apparatus determines the round-trip delay between the RSG and the NodeB according to T4 and T1.</p><p id="p0050" num="0050">As shown in <figref idrefs="f0003">FIG. 3B</figref>, when the network performance monitoring apparatus externally connected to the RSG monitors the round-trip delay between the RSG and the NodeB, an optical splitter may be connected in an upstream direction of the RSG, where the optical splitter is separately connected to the network performance monitoring apparatus (that is, the probe) and the RNC, and the optical splitter needs to be adjacent to the RSG. The optical splitter sends, to the RSG and the network performance monitoring apparatus simultaneously, a packet of a downlink TCP traffic flow that is from the RNC, and may further send, to the network performance monitoring apparatus and the RNC at the same time, a packet of an uplink TCP traffic<!-- EPO <DP n="17"> --> flow sent by the RSG. In addition, with reference to <figref idrefs="f0002">FIG. 2</figref> and <figref idrefs="f0003">FIG. 3B</figref>, when receiving from the optical splitter a duplicate packet of a packet of a TCP traffic flow that is sent by the RNC to the NodeB, the network performance monitoring apparatus records a time T1 at which the duplicate packet is received. It may be considered by default that, the RSG also receives the packet of the TCP traffic flow at the time T1, and the RSG forwards the packet of the TCP traffic flow to the NodeB at the time T1. The NodeB receives the packet of the TCP traffic flow forwarded by a CSG at a time T2; after receiving the foregoing packet of the TCP traffic flow, the NodeB sends a response packet of the packet of the TCP traffic flow to the RNC at a time T3. The network performance monitoring apparatus records a time T4 at which a duplicate packet of the response packet of the packet of the TCP traffic flow is received from the optical splitter, and T4 may be used as a time at which the RSG receives the response packet of the packet of the TCP traffic flow. The network performance monitoring apparatus determines the round-trip delay between the RSG and the NodeB according to T4 and T1.</p><p id="p0051" num="0051">For example, when the network performance monitoring apparatus mounted on the exterior of the RSG monitors the round-trip delay between the RSG and the NodeB, an optical splitter may also be connected in a downstream direction of the RSG, where the optical splitter is further separately connected to the network performance monitoring apparatus and the CSG, and the optical splitter is adjacent to the RSG.</p><p id="p0052" num="0052">In the foregoing technical solution, a network performance monitoring apparatus disposed inside or outside a first network device records a first time when receiving a second packet sent by the first network device, records a second time when determining that a response packet of the second packet sent by the first network device is received, and determines a round-trip delay between the first network device and a second network device according to the first time and the second time. The second packet is copied when the first network device sends a first packet to the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, where the connection is used to transmit a traffic flow by using a connection-oriented protocol, and a destination receive end of the first packet is the second network device. The first packet and a third packet are packets of traffic flows or packets that are used to establish a connection that actually exist in a network,<!-- EPO <DP n="18"> --> instead of packets of test flows that are extra added to the network. Therefore, when network performance is measured, the solution provided in this embodiment may reduce network load.</p><p id="p0053" num="0053">In addition, in a solution of active measurement in the prior art, performance of an actual traffic flow in a network is estimated by using a test packet, and a path of the test packet may be inconsistent with a path of the actual traffic flow; therefore, measurement accuracy is relatively low. In this embodiment of the present invention, however, because the first packet and the third packet are packets of traffic flows or packets that are used to establish a connection that actually exist in a network, accuracy of network performance measurement may be improved.</p><p id="p0054" num="0054">Furthermore, in the solution of active measurement in the prior art, when network performance between two network devices is measured, in order to reduce burden of the two network devices in processing a test flow, a probe is generally mounted on each network device, and the test flow is sent between the two probes. In this embodiment of the present invention, however, a probe does not need to be disposed on a second network device side, and therefore a quantity of probes to be deployed may be reduced.</p><p id="p0055" num="0055"><figref idrefs="f0003">FIG. 4</figref> is a flowchart of a network performance monitoring method according to an embodiment of the present invention. This embodiment is used to monitor a packet loss rate from a first network device to a second network device in a network. An execution body of this embodiment, that is, a network performance monitoring apparatus, may be disposed inside the first network device, and may also be disposed outside the first network device. As shown in <figref idrefs="f0003">FIG. 4</figref>, the method provided in this embodiment includes:
<ul><li>41. The network performance monitoring apparatus receives, within a preset time, a second packet sent by the first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to the second network device, a destination receive end of the first packet is the second network device, and a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol.</li><li>42. The network performance monitoring apparatus collects statistics about a quantity of second packets received within the preset time to obtain a first count.</li></ul></p><p id="p0056" num="0056">For example, the connection-oriented protocol includes TCP or SCTP. In<!-- EPO <DP n="19"> --> an example in which the connection-oriented protocol is TCP, a packet of a traffic flow transmitted by using the connection-oriented protocol refers to a packet of a TCP traffic flow transmitted after TCP connection establishment is completed.</p><p id="p0057" num="0057">The second network device is the destination receive end of the first packet, and the first network device may be a source transmit end of the first packet, or may not be the source transmit end, that is, the first network device is an intermediate device that is located between the source transmit end of the first packet and the second network device. The network performance monitoring apparatus is disposed inside or outside the first network device. The foregoing first network device and the second network device may be adjacent devices or non-adjacent devices that meet the foregoing conditions.</p><p id="p0058" num="0058">When being disposed inside the first network device, the network performance monitoring apparatus may be a card that is inserted into the first network device. When being disposed outside the first network device, the network performance monitoring apparatus may be an external probe that is connected to the first network device.</p><p id="p0059" num="0059">When the first network device sends the first packet to the second network device, a duplicate packet of the first packet, that is, the second packet, is sent to the network performance monitoring apparatus.</p><p id="p0060" num="0060">The same as the embodiment corresponding to <figref idrefs="f0001">FIG. 1A</figref>, when the network performance monitoring apparatus is disposed outside the first network device, for example, referring to <figref idrefs="f0001">FIG. 1B</figref>, the first network device may copy the sent first packet to the network performance monitoring apparatus in a mirroring manner, and the network performance monitoring apparatus receives the second packet obtained by the first network device by copying the first packet in the mirroring manner. The mirroring manner includes a port mirroring manner and a traffic mirroring manner. For another example, referring to <figref idrefs="f0002">FIG. 1C</figref>, an optical splitter may be disposed between a third network device and an upstream device of the third network device, the optical splitter is adjacent to the third network device, and the network performance monitoring apparatus is connected to the optical splitter; in this case, the optical splitter may be considered as the first network device. Certainly, the optical splitter may also be disposed between the third network device and an intermediate device, and the optical splitter is adjacent to the third network device. For a specific technical solution about how a network performance monitoring apparatus receives a<!-- EPO <DP n="20"> --> duplicate packet in a mirroring manner or an optical splitter manner and determines whether the received duplicate packet is the second packet, refer to descriptions of embodiments corresponding to <figref idrefs="f0001">FIG. 1B</figref>, <figref idrefs="f0002">FIG. 1C</figref>, <figref idrefs="f0002">FIG. 3A</figref>, and <figref idrefs="f0003">FIG. 3B</figref>, and details are not described herein again.
<ul><li>43. The network performance monitoring apparatus collects statistics about a quantity of retransmitted packets in the second packets received within the preset time to obtain a second count.</li></ul></p><p id="p0061" num="0061">A packet of a TCP traffic flow is used as an example; in a traditional manner, after a sender sends a packet of a TCP traffic flow, a TCP timer is started, and if an acknowledgement message of the packet of the TCP traffic flow is still not received after the TCP timer expires, the packet of the TCP traffic flow is retransmitted. For fast retransmission, when the sender consecutively receives three repeated acknowledgement (ACK) packets, it is determined that a packet of a traffic flow is lost, and the lost packet of the TCP traffic flow is fast retransmitted. Therefore, the second packet received by the network performance monitoring apparatus includes a packet that is copied when the first network device sends a packet of a TCP traffic flow to the second network device for the first time, and further includes a packet that is copied when the first network device retransmits the packet of the TCP traffic flow to the second network device. In order to determine a packet loss rate within the preset time, the network performance monitoring apparatus needs to determine whether a second packet received within the preset time is a packet of a TCP traffic flow that is sent for the first time, or a retransmitted packet of the TCP traffic flow, and collect statistics about a quantity of retransmitted packets in the received second packets to obtain the second count.</p><p id="p0062" num="0062">For example, a method of collecting statistics about the first count and the second count by the network performance monitoring apparatus may be as follows:</p><p id="p0063" num="0063">The network performance monitoring apparatus sets a first counter and a second counter, where a value of the first counter is the first count, a value of the second counter is the second count, and initial values of the first counter and the second counter are respectively set to zero;<br/>
when the network performance monitoring apparatus receives the second packet, the value of the first counter is increased by 1, and information stored by the network performance monitoring apparatus is searched according to a sequence number and a traffic flow identifier that are carried by the second packet to determine<!-- EPO <DP n="21"> --> whether a matching item exists, where the stored information includes a correspondence between a sequence number and a traffic flow identifier;<br/>
if the matching item exists, the network performance monitoring apparatus determines that the second packet is a retransmitted packet, and the value of the second counter is increased by 1; and<br/>
if the matching item does not exist, the network performance monitoring apparatus saves a correspondence between the sequence number and the traffic flow identifier that are carried by the second packet.</p><p id="p0064" num="0064">For ease of understanding, for example, in the network performance monitoring apparatus, there is a database that stores the correspondence between a sequence number and a traffic flow identifier, and the database is empty during initialization. When receiving the 1st second packet, the network performance monitoring apparatus reads that a traffic flow identifier in the 1st second packet is (source IP address = 1.1.1.1, destination IP address = 2.2.2.2, source port number = 1038, destination port number = 8080, and protocol number = TCP), and a sequence number (sequence number) in the 1st second packet = 400, and searches the database for a matching item that is corresponding to the traffic flow identifier and the sequence number. Because the database is empty during initialization, no matching item is found, and the network performance monitoring apparatus saves the traffic flow identifier and the sequence number into the database; when the network performance monitoring apparatus receives the 2nd second packet, if a traffic flow identifier of the 2nd second packet is (source IP address = 1.1.1.1, destination IP address = 2.2.2.2, source port number = 1038, destination port number = 8080, and protocol number = TCP), and a sequence number (sequence number) in the 2nd second packet = 400, the network performance monitoring apparatus finds a matching item in the database by using the traffic flow identifier and the sequence number in the 2nd second packet, and therefore, it is determined that the 2nd second packet is the retransmitted packet.
<ul><li>44. The network performance monitoring apparatus determines a packet loss rate from the first network device to the second network device according to the first count and the second count.</li></ul></p><p id="p0065" num="0065">For example, it is assumed that within the preset time, the value of the first count is 100, and the value of the second count is 30; then, it is determined that the packet loss rate from the first network device to the second network device = 30 / 100<!-- EPO <DP n="22"> --> = 30%.</p><p id="p0066" num="0066">In the foregoing technical solution, a network performance monitoring apparatus collects, within a preset time, statistics about a quantity of second packets sent by a first network device and a quantity of retransmitted packets in the second packets, to determine a packet loss rate from the first network device to a second network device. The second packet is copied when the first network device sends a first packet to a second network, the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol, and a destination receive end of the first packet is the second network device. The first packet and a third packet are packets of traffic flows that actually exist in a network or packets that are used to establish a connection, instead of packets of test flows that are extra added to the network. Therefore, when network performance is measured, the solution provided in this embodiment may reduce network load.</p><p id="p0067" num="0067">In addition, in a solution of active measurement in the prior art, performance of an actual traffic flow in a network is estimated by using a test packet, and a path of the test packet may be inconsistent with a path of the actual traffic flow; therefore, measurement accuracy is relatively low. In this embodiment of the present invention, however, because the first packet and the third packet are packets of traffic flows that actually exist in a network or packets that are used to establish a connection, accuracy of network performance measurement may be improved.</p><p id="p0068" num="0068">Furthermore, in the solution of active measurement in the prior art, when performance of a network between two network devices is measured, in order to reduce burden of the two network devices in processing a test flow, a probe is generally mounted on the two network devices separately, and the test flow is sent between the two probes. In this embodiment of the present invention, however, a probe does not need to be disposed on a second network device side, and therefore a quantity of probes to be deployed may be reduced.</p><p id="p0069" num="0069"><figref idrefs="f0004">FIG. 5</figref> is a schematic structural diagram of a network performance monitoring apparatus according to an embodiment of the present invention. The apparatus provided in this embodiment is configured to monitor a round-trip delay between a first network device and a second network device, and the apparatus provided in this embodiment is disposed inside or outside the first network device. <figref idrefs="f0004">FIG. 5</figref> shows a case in which the apparatus is disposed outside the first network device. The first network device may be adjacent to the second network device, or<!-- EPO <DP n="23"> --> may not be adjacent to the second network device.</p><p id="p0070" num="0070">As shown in <figref idrefs="f0004">FIG. 5</figref>, the apparatus provided in this embodiment includes: a receiving module 51, a recording module 52, and a determining module 53; where:
<ul><li>the receiving module 51 is configured to receive a second packet sent by the first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to the second network device, a destination receive end of the first packet is the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol;</li><li>the recording module 52 is configured to record a first time, where the first time is a time at which the receiving module 51 receives the second packet;</li><li>the receiving module 51 is further configured to receive a fourth packet sent by the first network device, where the fourth packet is a duplicate packet of a third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, a type of the third packet is the same as the type of the first packet, and a source transmit end of the third packet is the second network device;</li><li>the determining module 53 is configured to determine whether the fourth packet is a response packet of the second packet;</li><li>the recording module 52 is further configured to record a second time when the determining module 53 determines that the fourth packet is the response packet of the second packet, where the second time is a time at which the receiving module 51 receives the fourth packet; and</li><li>the determining module 53 is further configured to determine the round-trip delay between the first network device and the second network device according to the first time and the second time that are recorded by the recording module 52.</li></ul></p><p id="p0071" num="0071">Optionally, the network performance monitoring apparatus is disposed outside the first network device; the receiving module 51 is specifically configured to receive the second packet obtained by the first network device by copying the first packet in a mirroring manner; and the receiving module 51 is further specifically configured to receive the fourth packet obtained by the first network device by<!-- EPO <DP n="24"> --> copying the third packet in the mirroring manner.</p><p id="p0072" num="0072">Optionally, the first network device is an optical splitter.</p><p id="p0073" num="0073">Optionally, the connection-oriented protocol includes TCP or SCTP.</p><p id="p0074" num="0074">The network performance monitoring apparatus in this embodiment of the present invention may execute the method executed by the network performance monitoring apparatus in the embodiment shown in <figref idrefs="f0001">FIG. 1A</figref> to achieve a same beneficial effect, and details are not described herein again.</p><p id="p0075" num="0075"><figref idrefs="f0004">FIG. 6</figref> is a schematic structural diagram of another network performance monitoring apparatus according to an embodiment of the present invention. The apparatus provided in this embodiment is configured to monitor a packet loss rate from a first network device to a second network device, and the apparatus provided in this embodiment is disposed inside or outside the first network device. <figref idrefs="f0004">FIG. 6</figref> shows a case in which the apparatus is disposed outside the first network device. The first network device may be adjacent to the second network device, or may not be adjacent to the second network device.</p><p id="p0076" num="0076">As shown in <figref idrefs="f0004">FIG. 6</figref>, the apparatus provided in this embodiment includes: a receiving module 61, a statistics module 62, and a determining module 63;<br/>
where:
<ul><li>the receiving module 61 is configured to receive, within a preset time, a second packet sent by the first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to the second network device, a destination receive end of the first packet is the second network device, and a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol;</li><li>the statistics module 62 is configured to collect statistics about a quantity of second packets received by the receiving module 61 within the preset time to obtain a first count;</li><li>the statistics module 62 is further configured to collect statistics about a quantity of retransmitted packets in the second packets received by the receiving module 61 within the preset time to obtain a second count; and</li><li>the determining module 63 is configured to determine the packet loss rate from the first network device to the second network device according to the first count and the second count that are counted by the statistics module 62.</li></ul></p><p id="p0077" num="0077">Optionally, on the basis of what shown in <figref idrefs="f0004">FIG. 6</figref>, as shown in <figref idrefs="f0005">FIG. 7</figref>, the<!-- EPO <DP n="25"> --> network performance monitoring apparatus may further include: a first counter 64, a second counter 65, and a storage module 66.</p><p id="p0078" num="0078">A value of the first counter 64 is the first count, a value of the second counter 65 is the second count, and initial values of the first counter 64 and the second counter 65 are respectively set to zero.</p><p id="p0079" num="0079">The storage module 66 is configured to save a correspondence between a sequence number and a traffic flow identifier that are carried by the second packet.</p><p id="p0080" num="0080">Correspondingly, the statistics module 62 is specifically configured to, when the receiving module 61 receives the second packet, increase the value of the first counter 64 by 1, and search, according to the sequence number and the traffic flow identifier that are carried by the second packet, information saved by the storage module 66 to determine whether a matching item exists, where the saved information includes a correspondence between a sequence number and a traffic flow identifier; if the matching item exists, determine that the second packet is the retransmitted packet, and increase the value of the second counter 65 by 1; if the matching item does not exist, trigger the storage module 66 to save the correspondence between the sequence number and the traffic flow identifier that are carried by the second packet.</p><p id="p0081" num="0081">Optionally, the network performance monitoring apparatus is disposed outside the first network device; and the receiving module 61 is specifically configured to receive the second packet obtained by the first network device by copying the first packet in a mirroring manner.</p><p id="p0082" num="0082">Optionally, the first network device is an optical splitter.</p><p id="p0083" num="0083">Optionally, the connection-oriented protocol includes TCP or SCTP.</p><p id="p0084" num="0084">The network performance monitoring apparatus in this embodiment of the present invention may execute the method executed by the network performance monitoring apparatus in the embodiment shown in <figref idrefs="f0003">FIG. 4</figref> to achieve a same beneficial effect, and details are not described herein again.</p><p id="p0085" num="0085"><figref idrefs="f0005">FIG. 8</figref> is a schematic structural diagram of a network performance monitoring apparatus according to an embodiment of the present invention. The apparatus 800 includes: a bus 840; and a processor 810, a memory 820, and an interface 830 that are connected to the bus 840.</p><p id="p0086" num="0086">The interface 830 is configured to receive a second packet sent by a first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a<!-- EPO <DP n="26"> --> second network device, a destination receive end of the first packet is the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol; and the interface 830 is further configured to receive a fourth packet sent by the first network device, where the fourth packet is a duplicate packet of a third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, a type of the third packet is the same as the type of the first packet, and a source transmit end of the third packet is the second network device.</p><p id="p0087" num="0087">The memory 820 is configured to store an instruction, and the processor 810 is configured to execute the instruction, where the instruction is used to record a first time, and the first time is a time at which the interface 830 receives the second packet; executing the instruction by the processor 810 is further used to record a second time when it is determined that the fourth packet is a response packet of the second packet, where the second time is a time at which the interface 830 receives the fourth packet; and the executing the instruction by the processor 810 is further used to determine a round-trip delay between the first network device and the second network device according to the first time and the second time.</p><p id="p0088" num="0088">In this embodiment of the present invention, optionally, the network performance monitoring apparatus is disposed outside the first network device; the interface 830 receives the second packet obtained by the first network device by copying the first packet in a mirroring manner; and the interface 830 receives the fourth packet obtained by the first network device by copying the third packet in the mirroring manner.</p><p id="p0089" num="0089">In this embodiment of the present invention, optionally, the first network device is an optical splitter.</p><p id="p0090" num="0090">In this embodiment of the present invention, optionally, the connection-oriented protocol includes TCP or SCTP.</p><p id="p0091" num="0091">The network performance monitoring apparatus in this embodiment of the present invention may execute the method executed by the network performance monitoring apparatus in the embodiment shown in <figref idrefs="f0001">FIG. 1A</figref> to achieve a same beneficial effect, and details are not described herein again.</p><p id="p0092" num="0092"><figref idrefs="f0006">FIG. 9</figref> is a schematic structural diagram of a network performance<!-- EPO <DP n="27"> --> monitoring apparatus according to an embodiment of the present invention. The apparatus 900 includes: a bus 940; and a processor 910, a memory 920, and an interface 930 that are connected to the bus 940.</p><p id="p0093" num="0093">The interface 930 is configured to receive, within a preset time, a second packet sent by a first network device, where the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, and a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol.</p><p id="p0094" num="0094">The memory 920 is configured to store an instruction, and the processor 910 is configured to execute the instruction, where the instruction is used to collect statistics about a quantity of second packets received within the preset time to obtain a first count; collect statistics about a quantity of retransmitted packets in the second packets received within the preset time to obtain a second count; and determine a packet loss rate from the first network device to the second network device according to the first count and the second count.</p><p id="p0095" num="0095">In this embodiment of the present invention, optionally, executing the instruction by the processor 910 to collect statistics about a quantity of second packets received within the preset time to obtain the first count, and collect statistics about a quantity of retransmitted packets in the second packets received within the preset time to obtain the second count includes: setting a first counter and a second counter, where a value of the first counter is the first count, a value of the second counter is the second count, and initial values of the first counter and the second counter are respectively set to zero; when the second packet is received, increasing the value of the first counter by 1, and searching, according to a sequence number and a traffic flow identifier that are carried by the second packet, information saved by the network performance monitoring apparatus to determine whether a matching item exists, where the saved information includes a correspondence between a sequence number and a traffic flow identifier; if the matching item exists, determining that the second packet is the retransmitted packet, and increasing the value of the second counter by 1; if the matching item does not exist, saving a correspondence between the sequence number and the traffic flow identifier that are carried by the second packet.</p><p id="p0096" num="0096">In this embodiment of the present invention, optionally, the network performance monitoring apparatus is disposed outside the first network device, and<!-- EPO <DP n="28"> --> the interface 930 receives the second packet obtained by the first network device by copying the first packet in a mirroring manner.</p><p id="p0097" num="0097">In this embodiment of the present invention, optionally, the first network device is an optical splitter.</p><p id="p0098" num="0098">In this embodiment of the present invention, optionally, the connection-oriented protocol includes TCP or SCTP.</p><p id="p0099" num="0099">The network performance monitoring apparatus in this embodiment of the present invention may execute the method executed by the network performance monitoring apparatus in the embodiment shown in <figref idrefs="f0003">FIG. 4</figref> to achieve a same beneficial effect, and details are not described herein again.</p><p id="p0100" num="0100">A person of ordinary skill in the art may understand that all or a part of the steps of the method embodiments may be implemented by a program instructing relevant hardware. The program may be stored in a computer readable storage medium. When the program runs, the steps of the method embodiments are performed. The foregoing storage medium includes: any medium that can store program code, such as a ROM, a RAM, a magnetic disk, or an optical disc.</p><p id="p0101" num="0101">Finally, it should be noted that the foregoing embodiments are merely intended for describing the technical solutions of the present invention, but not for limiting the present invention. Although the present invention is described in detail with reference to the foregoing embodiments, persons of ordinary skill in the art should understand that they may still make modifications to the technical solutions described in the foregoing embodiments or make equivalent replacements to some technical features thereof, without departing from the scope of the technical solutions of the embodiments of the present invention.</p></description><claims mxw-id="PCLM90459591" lang="EN" load-source="patent-office"><!-- EPO <DP n="29"> --><claim id="c-en-0001" num="0001"><claim-text>A network performance monitoring method, comprising:
<claim-text>receiving, by a network performance monitoring apparatus, a second packet sent by a first network device, wherein the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, and the connection is used to transmit a traffic flow by using a connection-oriented protocol;</claim-text>
<claim-text>recording, by the network performance monitoring apparatus, a first time, wherein the first time is a time at which the network performance monitoring apparatus receives the second packet;</claim-text>
<claim-text>receiving, by the network performance monitoring apparatus, a fourth packet sent by the first network device, wherein the fourth packet is a duplicate packet of a third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, a type of the third packet is the same as the type of the first packet, and a source transmit end of the third packet is the second network device;</claim-text>
<claim-text>when the network performance monitoring apparatus determines that the fourth packet is a response packet of the second packet, recording, by the network performance monitoring apparatus, a second time, wherein the second time is a time at which the network performance monitoring apparatus receives the fourth packet; and</claim-text>
<claim-text>determining, by the network performance monitoring apparatus, a round-trip delay between the first network device and the second network device according to the first time and the second time.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein if the network performance monitoring apparatus is disposed outside the first network device,<br/>
the receiving, by the network performance monitoring apparatus, the second packet sent by the first network device comprises:<!-- EPO <DP n="30"> -->
<claim-text>receiving, by the network performance monitoring apparatus, the second packet obtained by the first network device by copying the first packet in a mirroring manner; and</claim-text>
<claim-text>the receiving, by the network performance monitoring apparatus, the fourth packet sent by the first network device comprises:
<claim-text>receiving, by the network performance monitoring apparatus, the fourth packet obtained by the first network device by copying the third packet in the mirroring manner.</claim-text></claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 1, wherein the first network device is an optical splitter.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to any one of claims 1 to 3, wherein the connection-oriented protocol comprises the Transmission Control Protocol TCP or the Stream Control Transmission Protocol SCTP.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>A network performance monitoring method, comprising:
<claim-text>receiving, by a network performance monitoring apparatus within a preset time, a second packet sent by a first network device, wherein the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, and a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol;</claim-text>
<claim-text>collecting, by the network performance monitoring apparatus, statistics about a quantity of the second packets received within the preset time to obtain a first count;</claim-text>
<claim-text>collecting, by the network performance monitoring apparatus, statistics about a quantity of retransmitted packets in the second packets received within the preset time to obtain a second count; and</claim-text>
<claim-text>determining, by the network performance monitoring apparatus, a packet loss rate from the first network device to the second network device according to the first count and the second count.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method according to claim 5, wherein the collecting, by the network performance monitoring apparatus, statistics about a quantity of the second packets received within the preset time to obtain a first count, and the collecting, by the network performance monitoring apparatus, statistics about a quantity of retransmitted packets in the second packets received within the preset time to obtain a second count comprise:<!-- EPO <DP n="31"> -->
<claim-text>setting, by the network performance monitoring apparatus, a first counter and a second counter, wherein a value of the first counter is the first count, a value of the second counter is the second count, and initial values of the first counter and the second counter are respectively set to zero;</claim-text>
<claim-text>when the network performance monitoring apparatus receives the second packet, increasing the value of the first counter by 1, and searching, according to a sequence number and a traffic flow identifier that are carried by the second packet, information stored by the network performance monitoring apparatus to determine whether a matching item exists, wherein the stored information comprises a correspondence between a sequence number and a traffic flow identifier;</claim-text>
<claim-text>if the matching item exists, determining, by the network performance monitoring apparatus, that the second packet is the retransmitted packet, and increasing the value of the second counter by 1; and</claim-text>
<claim-text>if the matching item does not exist, saving, by the network performance monitoring apparatus, a correspondence between the sequence number and the traffic flow identifier that are carried by the second packet.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method according to claim 5 or 6, wherein if the network performance monitoring apparatus is disposed outside the first network device, the receiving, by the network performance monitoring apparatus, the second packet sent by the first network device comprises:
<claim-text>receiving, by the network performance monitoring apparatus, the second packet obtained by the first network device by copying the first packet in a mirroring manner.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method according to claim 5 or 6, wherein the first network device is an optical splitter.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method according to any one of claims 5 to 8, wherein the connection-oriented protocol comprises the Transmission Control Protocol TCP or the Stream Control Transmission Protocol SCTP.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A network performance monitoring apparatus, comprising:
<claim-text>a receiving module, configured to receive a second packet sent by a first network device, wherein the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol or a packet that is used to establish a connection, and the<!-- EPO <DP n="32"> --> connection is used to transmit a traffic flow by using a connection-oriented protocol;</claim-text>
<claim-text>a recording module, configured to record a first time, wherein the first time is a time at which the receiving module receives the second packet; wherein</claim-text>
<claim-text>the receiving module is further configured to receive a fourth packet sent by the first network device, wherein the fourth packet is a duplicate packet of a third packet, the fourth packet is copied when the first network device receives the third packet sent by the second network device, a type of the third packet is the same as the type of the first packet, and a source transmit end of the third packet is the second network device; and</claim-text>
<claim-text>a determining module, configured to determine whether the fourth packet is a response packet of the second packet; wherein</claim-text>
<claim-text>the recording module is further configured to record a second time when the determining module determines that the fourth packet is the response packet of the second packet, wherein the second time is a time at which the receiving module receives the fourth packet; and</claim-text>
<claim-text>the determining module is further configured to determine a round-trip delay between the first network device and the second network device according to the first time and the second time that are recorded by the recording module.</claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The network performance monitoring apparatus according to claim 10, wherein the network performance monitoring apparatus is disposed outside the first network device;<br/>
the receiving module is specifically configured to receive the second packet obtained by the first network device by copying the first packet in a mirroring manner; and<br/>
the receiving module is further specifically configured to receive the fourth packet obtained by the first network device by copying the third packet in the mirroring manner.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The network performance monitoring apparatus according to claim 11, wherein the first network device is an optical splitter.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The network performance monitoring apparatus according to any one of claims 10 to 12, wherein the connection-oriented protocol comprises the Transmission Control Protocol TCP or the Stream Control Transmission Protocol SCTP.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A network performance monitoring apparatus, comprising:
<claim-text>a receiving module, configured to receive, within a preset time, a second packet<!-- EPO <DP n="33"> --> sent by a first network device, wherein the second packet is a duplicate packet of a first packet, the second packet is copied when the first network device sends the first packet to a second network device, a destination receive end of the first packet is the second network device, and a type of the first packet is a packet of a traffic flow transmitted by using a connection-oriented protocol;</claim-text>
<claim-text>a statistics module, configured to collect statistics about a quantity of the second packets received by the receiving module within the preset time to obtain a first count; wherein</claim-text>
<claim-text>the statistics module is further configured to collect statistics about a quantity of retransmitted packets in the second packets received by the receiving module within the preset time to obtain a second count; and</claim-text>
<claim-text>a determining module, configured to determine a packet loss rate from the first network device to the second network device according to the first count and the second count that are counted by the statistics module.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The network performance monitoring apparatus according to claim 14, further comprising:
<claim-text>a first counter and a second counter, wherein a value of the first counter is the first count, a value of the second counter is the second count, and initial values of the first counter and the second counter are respectively set to zero; and</claim-text>
<claim-text>a storage module, configured to store a correspondence between a sequence number and a traffic flow identifier that are carried by the second packet; wherein</claim-text>
<claim-text>the statistics module is specifically configured to, when the receiving module receives the second packet, increase the value of the first counter by 1, and search, according to the sequence number and the traffic flow identifier that are carried by the second packet, information stored by the storage module to determine whether a matching item exists, wherein the stored information comprises a correspondence between a sequence number and a traffic flow identifier; if the matching item exists, determine that the second packet is the retransmitted packet, and increase the value of the second counter by 1; if the matching item does not exist, trigger the storage module to save the correspondence between the sequence number and the traffic flow identifier that are carried by the second packet.</claim-text></claim-text></claim><claim id="c-en-0016" num="0016"><claim-text>The network performance monitoring apparatus according to claim 14 or 15, wherein the network performance monitoring apparatus is disposed outside the first network device; and<br/>
<!-- EPO <DP n="34"> -->the receiving module is specifically configured to receive the second packet obtained by the first network device by copying the first packet in a mirroring manner.</claim-text></claim><claim id="c-en-0017" num="0017"><claim-text>The network performance monitoring apparatus according to claim 14 or 15, wherein the first network device is an optical splitter.</claim-text></claim><claim id="c-en-0018" num="0018"><claim-text>The network performance monitoring apparatus according to any one of claims 14 to 17, wherein the connection-oriented protocol comprises the Transmission Control Protocol TCP or the Stream Control Transmission Protocol SCTP.</claim-text></claim></claims><drawings mxw-id="PDW20422313" load-source="patent-office"><!-- EPO <DP n="35"> --><figure id="f0001" num="1A,1B"><img id="if0001" file="imgf0001.tif" wi="152" he="210" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0002" num="1C,2,3A"><img id="if0002" file="imgf0002.tif" wi="151" he="181" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="37"> --><figure id="f0003" num="3B,4"><img id="if0003" file="imgf0003.tif" wi="148" he="165" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="38"> --><figure id="f0004" num="5,6"><img id="if0004" file="imgf0004.tif" wi="122" he="179" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="39"> --><figure id="f0005" num="7,8"><img id="if0005" file="imgf0005.tif" wi="142" he="209" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="40"> --><figure id="f0006" num="9"><img id="if0006" file="imgf0006.tif" wi="112" he="73" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="230" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="163" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
