<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961111-A1" country="EP" doc-number="2961111" kind="A1" date="20151230" family-id="51391367" file-reference-id="318326" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451231" ucid="EP-2961111-A1"><document-id><country>EP</country><doc-number>2961111</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14754256-A" is-representative="YES"><document-id mxw-id="PAPP193865430" load-source="docdb" format="epo"><country>EP</country><doc-number>14754256</doc-number><kind>A</kind><date>20140221</date><lang>JA</lang></document-id><document-id mxw-id="PAPP193865431" load-source="patent-office" format="original"><country>EP</country><doc-number>14754256.7</doc-number><date>20140221</date><lang>JA</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162036576" ucid="JP-2013032587-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2013032587</doc-number><kind>A</kind><date>20130221</date></document-id></priority-claim><priority-claim mxw-id="PPC162031217" ucid="JP-2013034529-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2013034529</doc-number><kind>A</kind><date>20130225</date></document-id></priority-claim><priority-claim mxw-id="PPC162029373" ucid="JP-2014054190-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2014054190</doc-number><kind>W</kind><date>20140221</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1877534917" load-source="docdb">H04L  12/70        20130101AFI20161110BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1877534918" load-source="docdb">H04L  12/66        20060101ALI20161110BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1877534919" load-source="docdb">H04L  12/64        20060101ALI20161110BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1877534920" load-source="docdb">H04L  12/46        20060101ALI20161110BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1877534921" load-source="docdb">H04L  29/06        20060101ALI20161110BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1877534922" load-source="docdb">H04L  29/08        20060101ALI20161110BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1852721252" load-source="docdb" scheme="CPC">H04L  12/6418      20130101 LI20170201BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984018231" load-source="docdb" scheme="CPC">H04L  67/02        20130101 LI20160114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984022602" load-source="docdb" scheme="CPC">H04L  63/0236      20130101 LI20160114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984023747" load-source="docdb" scheme="CPC">H04L  63/0281      20130101 LI20160114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984025089" load-source="docdb" scheme="CPC">H04L  63/1416      20130101 FI20160114BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165545159" lang="DE" load-source="patent-office">NETZWERKÜBERWACHUNGSVORRICHTUNG, NETZWERKÜBERWACHUNGSVERFAHREN UND NETZWERKÜBERWACHUNGSPROGRAMM</invention-title><invention-title mxw-id="PT165545160" lang="EN" load-source="patent-office">NETWORK MONITORING DEVICE, NETWORK MONITORING METHOD, AND NETWORK MONITORING PROGRAM</invention-title><invention-title mxw-id="PT165545161" lang="FR" load-source="patent-office">DISPOSITIF DE SURVEILLANCE DE RÉSEAU, PROCÉDÉ DE SURVEILLANCE DE RÉSEAU ET PROGRAMME DE SURVEILLANCE DE RÉSEAU</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103340268" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>NIPPON TELEGRAPH &amp; TELEPHONE</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR1103327208" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>NIPPON TELEGRAPH AND TELEPHONE CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR1101647425" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Nippon Telegraph and Telephone Corporation</last-name><iid>101439525</iid><address><street>5-1, Otemachi 1-chome Chiyoda-ku</street><city>Tokyo 100-8116</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103337057" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>NAKATA KENSUKE</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1103316286" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>NAKATA, KENSUKE</last-name></addressbook></inventor><inventor mxw-id="PPAR1101649712" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>NAKATA, KENSUKE</last-name><address><street>c/o NTT Intellectual Property Center 9-11 Midori-cho 3-chome</street><city>Musashino-shi Tokyo 180-8585</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101649937" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>HOFFMANN EITLE</last-name><iid>100061036</iid><address><street>Patent- und Rechtsanwälte PartmbB Arabellastraße 30</street><city>81925 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2014054190-W"><document-id><country>JP</country><doc-number>2014054190</doc-number><kind>W</kind><date>20140221</date><lang>JA</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014129587-A1"><document-id><country>WO</country><doc-number>2014129587</doc-number><kind>A1</kind><date>20140828</date><lang>JA</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660681699" load-source="docdb">AL</country><country mxw-id="DS660606907" load-source="docdb">AT</country><country mxw-id="DS660681701" load-source="docdb">BE</country><country mxw-id="DS660681771" load-source="docdb">BG</country><country mxw-id="DS660604146" load-source="docdb">CH</country><country mxw-id="DS660684281" load-source="docdb">CY</country><country mxw-id="DS660606908" load-source="docdb">CZ</country><country mxw-id="DS660682261" load-source="docdb">DE</country><country mxw-id="DS660681702" load-source="docdb">DK</country><country mxw-id="DS660684282" load-source="docdb">EE</country><country mxw-id="DS660782293" load-source="docdb">ES</country><country mxw-id="DS660681772" load-source="docdb">FI</country><country mxw-id="DS660681773" load-source="docdb">FR</country><country mxw-id="DS660681719" load-source="docdb">GB</country><country mxw-id="DS660681720" load-source="docdb">GR</country><country mxw-id="DS660681721" load-source="docdb">HR</country><country mxw-id="DS660684291" load-source="docdb">HU</country><country mxw-id="DS660604159" load-source="docdb">IE</country><country mxw-id="DS660681722" load-source="docdb">IS</country><country mxw-id="DS660681774" load-source="docdb">IT</country><country mxw-id="DS660684292" load-source="docdb">LI</country><country mxw-id="DS660682262" load-source="docdb">LT</country><country mxw-id="DS660606909" load-source="docdb">LU</country><country mxw-id="DS660682267" load-source="docdb">LV</country><country mxw-id="DS660682268" load-source="docdb">MC</country><country mxw-id="DS660607169" load-source="docdb">MK</country><country mxw-id="DS660607170" load-source="docdb">MT</country><country mxw-id="DS660606910" load-source="docdb">NL</country><country mxw-id="DS660782294" load-source="docdb">NO</country><country mxw-id="DS660606923" load-source="docdb">PL</country><country mxw-id="DS660782295" load-source="docdb">PT</country><country mxw-id="DS660606924" load-source="docdb">RO</country><country mxw-id="DS660682270" load-source="docdb">RS</country><country mxw-id="DS660606925" load-source="docdb">SE</country><country mxw-id="DS660682275" load-source="docdb">SI</country><country mxw-id="DS660604160" load-source="docdb">SK</country><country mxw-id="DS660604161" load-source="docdb">SM</country><country mxw-id="DS660607171" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479601" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A network monitoring apparatus (100) includes a log collecting unit (151) and a log analyzing unit (152). The log collecting unit (151) collects log information related to passing packets from at least one of a FW (200) and a proxy server (300), which are included in a network, for packets transferred in the network. The log analyzing unit (152) extracts log information satisfying a predetermined condition in a predetermined time period by analyzing, over time, the log information collected by the log collecting unit (151).<img id="iaf01" file="imgaf001.tif" wi="78" he="90" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759413" lang="EN" source="EPO" load-source="docdb"><p>A network monitoring apparatus (100) includes a log collecting unit (151) and a log analyzing unit (152). The log collecting unit (151) collects log information related to passing packets from at least one of a FW (200) and a proxy server (300), which are included in a network, for packets transferred in the network. The log analyzing unit (152) extracts log information satisfying a predetermined condition in a predetermined time period by analyzing, over time, the log information collected by the log collecting unit (151).</p></abstract><description mxw-id="PDES98404302" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">Field</heading><p id="p0001" num="0001">The present invention relates to a technique for assisting in detection of cyber attacks from an external network, such as the Internet, and information leakage to the external network.</p><heading id="h0002">Background</heading><p id="p0002" num="0002">In recent years, unauthorized communication (cyber attacks), which attacks various services provided via networks and infrastructure, is evolving into those using diverse techniques day after day and its threat is increasing more and more. Known countermeasure techniques against such unauthorized communication include, for example, FireWalls (FWs), Intrusion Detection Systems (IDSs), and Intrusion Prevention Systems (IPSs). <figref idrefs="f0008">FIG. 8</figref> is a diagram illustrating an example of a countermeasure technique according to conventional art.</p><p id="p0003" num="0003">For example, as illustrated in <figref idrefs="f0008">FIG. 8</figref>, a FW, which serves as a packet filtering function of a network device, such as a router, or as a dedicated device, is arranged at a connection point between an internal network and an external network. Rules are set by a user of a terminal included in the internal network, for example, such that the FW: passes only packets of a service that the terminal included in the internal network provides to a terminal of the external network, and packets for the terminal of the internal network to use a service provided by the terminal of the external network; and discards any other packets.</p><p id="p0004" num="0004">Further, for example, an IDS/IPS is provided as a function of the network device, such as the router, or as a<!-- EPO <DP n="2"> --> dedicated device. As illustrated in <figref idrefs="f0008">FIG. 8</figref>, known types of the IDS/IPS include, for example: a signature type, which detects an attack by matching obtained packets with a predefined pattern of attacking packets; and an anomaly type, which detects abnormal traffic by using obtained packets, or various logs collected from the network device and statistical information to monitor the traffic and analyzing the monitored data.</p><p id="p0005" num="0005">In one example of the signature type, as illustrated in <figref idrefs="f0008">FIG. 8</figref>, packets are obtained at a point after passing the FW, whether or not any illegal bit string is included in the packets is determined, and if any illegal bit string is present therein, abnormality is detected. Further, for example, in the anomaly type, a normal state is defined for behaviors, such as addition of a resource and a communication quantity in a terminal of the internal network, and if there is deviation therefrom, abnormality is detected. In the above described techniques, if abnormality is detected, for example, as illustrated in <figref idrefs="f0008">FIG. 8</figref>, by an alert being output, a network administrator is notified of the abnormality.</p><heading id="h0003">Citation List</heading><heading id="h0004">Patent Literature</heading><p id="p0006" num="0006"><ul><li>Patent Literature 1: <patcit id="pcit0001" dnum="JP2008219149A"><text>Japanese Patent Application Publication No. 2008-219149</text></patcit></li><li>Patent Literature 2: <patcit id="pcit0002" dnum="JP2006115007A"><text>Japanese Patent Application Publication No. 2006-115007</text></patcit></li><li>Patent Literature 3: <patcit id="pcit0003" dnum="JP2005210601A"><text>Japanese Patent Application Publication No. 2005-210601</text></patcit></li></ul></p><heading id="h0005">Summary</heading><heading id="h0006">Technical Problem</heading><p id="p0007" num="0007">However, the above described conventional techniques had a certain limit as countermeasure techniques<!-- EPO <DP n="3"> --> against unauthorized communication. For example, the FW has had a certain limit as a countermeasure technique, as the FW determines possibility of passage, packet by packet, and is thus unable to recognize communication of an attacker just by singly looking at a log related to a packet that has passed upon success of an attack. Further, for example, since the IDS/IPS of the signature type is based on the predefined patterns, response to an unknown attack is delayed and it has had a certain limit as a countermeasure technique. Furthermore, for example, with the IDS/IPS of the anomaly type, erroneous detection will be frequent if a normal state is defined too strictly, and thus thorough detection of unauthorized communication will be difficult and it has had a certain limit as a countermeasure technique.</p><p id="p0008" num="0008">Therefore, techniques according to the present application have been made in view of the above described problems of the conventional art, and aims to provide a network monitoring apparatus, a network monitoring method, and a network monitoring program, which allow unauthorized communication to be detected highly accurately.</p><heading id="h0007">Solution to Problem</heading><p id="p0009" num="0009">To solve the problems described above and achieve the object, a network monitoring apparatus, which is provided in a network that includes a FireWall provided on at least one of a connection point with an external network and an internal segment dividing point and a proxy server for Web access and that transfers IP packets, and which detects communication suspected to be unauthorized, a network monitoring apparatus includes a log collecting unit that collects and stores log data from at least one of the FireWall and the proxy server; and a log analyzing unit that makes inquiry for log data to the log collecting unit,<!-- EPO <DP n="4"> --> analyzes, according to a set analysis condition, the log data, and outputs a result of the analysis, wherein the log data stored by the log collecting unit are information including at least one of: 5-tuples; transmitted sizes; received sizes; information extracted from http headers; and time stamps, and the information extracted from http headers includes at least one of: destination URLs; User-Agent; and request methods.</p><heading id="h0008">Advantageous Effects of Invention</heading><p id="p0010" num="0010">A network monitoring apparatus according to the present application allows unauthorized communication to be detected highly accurately.</p><heading id="h0009">Brief Description of Drawings</heading><p id="p0011" num="0011"><ul><li><figref idrefs="f0001">FIG. 1</figref> is a diagram illustrating an example of a configuration of a network including a network monitoring apparatus according to a first embodiment.</li><li><figref idrefs="f0002">FIG. 2</figref> is a diagram illustrating an example of a configuration of the network monitoring apparatus according to the first embodiment.</li><li><figref idrefs="f0003">FIG. 3</figref> is a diagram illustrating an example of a configuration of log information stored in a log DB according to the first embodiment.</li><li><figref idrefs="f0004">FIG. 4</figref> is a flow chart illustrating a sequence of processing by the network monitoring apparatus according to the first embodiment.</li><li><figref idrefs="f0005">FIG. 5</figref> is a diagram illustrating an example of a configuration of a system for detecting and defending against unauthorized access and hacking.</li><li><figref idrefs="f0006">FIG. 6</figref> is a block diagram illustrating a configuration of a detecting apparatus according to a second embodiment.</li><li><figref idrefs="f0007">FIG. 7</figref> is a diagram illustrating an example of a configuration of a network, to which the detecting apparatus according to the second embodiment is applied.<!-- EPO <DP n="5"> --></li><li><figref idrefs="f0008">FIG. 8</figref> is a diagram illustrating an example of a countermeasure technique according to conventional art. Description of Embodiments</li></ul></p><p id="p0012" num="0012">Hereinafter, with reference to the appended drawings, embodiments of a network monitoring apparatus, a network monitoring method, and a network monitoring program according to the present application will be described in detail. The network monitoring apparatus, the network monitoring method, and the network monitoring program according to the present application are not to be limited by the following embodiments.</p><heading id="h0010">(First Embodiment)</heading><heading id="h0011">[Configuration of Network Including Network Monitoring Apparatus According to First Embodiment]</heading><p id="p0013" num="0013">First, a configuration of a network including a network monitoring apparatus 100 according to a first embodiment will be described. <figref idrefs="f0001">FIG. 1</figref> is a diagram illustrating an example of the configuration of the network including the network monitoring apparatus 100 according to the first embodiment. For example, the network including the network monitoring apparatus according to the first embodiment is, as illustrated in <figref idrefs="f0001">FIG. 1</figref>, an intra-enterprise network (NW), and is connected to the Internet (referred to as, "external network", as appropriate).</p><p id="p0014" num="0014">The intra-enterprise NW includes, as illustrated in <figref idrefs="f0001">FIG. 1</figref>, the network monitoring apparatus 100, a FireWall (FW) 200, and a proxy server 300. Further, the intra-enterprise NW includes, as illustrated in <figref idrefs="f0001">FIG. 1</figref>, a user PC, a file server, a switch (SW)/router, an IDS/IPS, and the like. For example, in the intra-enterprise NW, the file server may be accessed by the user PC, or the Internet may be accessed by the user PC via the FW 200. Further, for example, in the intra-enterprise NW, the Internet may be<!-- EPO <DP n="6"> --> accessed by the user PC via the proxy server 300.</p><p id="p0015" num="0015">The FW 200 monitors packets in communication executed between the user PC and file server included in the intra-enterprise NW, and a terminal and a server on the Internet. Specifically, the FW 200 controls, based on a condition predefined by a user, transfer of packets between the Internet and the intra-enterprise NW. For example, the FW 200 determines, based on 5-tuple information of a packet (a destination Internet Protocol (IP) address, a source IP address, a destination port, a source port, and a protocol), whether or not the packet is related to unauthorized communication, and if it is determined to be of unauthorized communication, the FW 200 discards the packet. Further, the FW 200 controls connection between the user PC and file server included in the intra-enterprise NW, and the Internet, to be connection going through the proxy server 300. That is, the FW 200 controls the user PC and file server included in the intra-enterprise NW to be not directly connected to the Internet.</p><p id="p0016" num="0016">Further, the FW 200 monitors packets in communication executed between the user PC and the file server, which are included in the intra-enterprise NW. Specifically, the FW 200 controls, based on a condition predefined by a user, transfer of packets between the user PC and the file server. For example, the FW 200 determines, based on 5-tuple information of a packet, whether or not the packet is related to unauthorized communication, and if it is determined to be of unauthorized communication, the FW 200 discards the packet.</p><p id="p0017" num="0017">The FW 200 outputs various logs for packets passing itself. For example, the FW 200 outputs, in addition to 5-tuple information of a packet that has passed itself, and information on a passing time of the packet<!-- EPO <DP n="7"> --> (time stamp for the passage of the packet); information on a result of determination with respect to the packet (result of possibility of the passage), and the like. The above mentioned types of information are just an example, and the FW 200 may output other types of information depending on devices, as appropriate. Further, the FW 200 may output various logs and may also store the various logs.</p><p id="p0018" num="0018">The proxy server 300 represents the communication between the user PC and file server included in the intra-enterprise NW and the terminal and server included in the Internet. That is, when the user PC or file server included in the intra-enterprise NW accesses the Internet, the proxy server 300 substitutively executes the communication with the terminal or server to be accessed.</p><p id="p0019" num="0019">Further, the proxy server 300 holds (caches), for a certain time period, files once read in the communication with the terminal and server included in the Internet, and provides the cached files, if similar connection requests are made by the user PC or file server included in the intra-enterprise NW. Further, the proxy server 300 places, based on a destination Uniform Resource Locator (URL) of a packet or the like, restrictions on Web sites to be connected to on the Internet and on connection source user terminals.</p><p id="p0020" num="0020">The proxy server 300 stores a log of the packets in the communication that the proxy server 300 itself represented. For example, the proxy server 300 stores: information on a connect time of communication, a connection source user terminal, a connection result, transmitted and received packet sizes, an access method, an access destination URL; information on a time at which the communication was performed (a time stamp of the execution of the communication); and the like. The above mentioned<!-- EPO <DP n="8"> --> types of information are just an example, and the proxy server 300 may store other types of information depending on devices, as appropriate.</p><p id="p0021" num="0021">The network monitoring apparatus 100 monitors packets transferred in the intra-enterprise NW and detects unauthorized communication highly accurately. Specifically, the network monitoring apparatus 100 detects, as illustrated in <figref idrefs="f0001">FIG. 1</figref>, unauthorized communication by collecting information on the packets from the FW 200 and proxy server 300. For example, by collecting from the FW 200 and proxy server 300 and analyzing log information (referred to as "log data" as appropriate), the network monitoring apparatus 100 performs, as illustrated in <figref idrefs="f0001">FIG. 1</figref>, detection of: "1: Communication executed between an infected user PC infected with a virus or the like in the intra-enterprise NW and a malicious site on the Internet"; "2: Investigation on unauthorized communication inside the intra-enterprise NW"; "3: Communication between an attacker on the Internet and a server or the like included in the intra-enterprise NW and take-out of data by the attacker"; and the like.</p><heading id="h0012">[Configuration of Network Monitoring Apparatus According to First Embodiment]</heading><p id="p0022" num="0022">Next, a configuration of the network monitoring apparatus according to the first embodiment will be described. <figref idrefs="f0002">FIG. 2</figref> is a diagram illustrating an example of the configuration of the network monitoring apparatus 100 according to the first embodiment. As illustrated in <figref idrefs="f0002">FIG. 2</figref>, the network monitoring apparatus 100 is connected to the FW 200 and proxy server 300, and monitors communication in the intra-enterprise NW. In <figref idrefs="f0002">FIG. 2</figref>, one each of the FW 200 and proxy server 300 is illustrated, but practically, arbitrary numbers of the FWs 200 and proxy servers 300 are<!-- EPO <DP n="9"> --> connected to the network monitoring apparatus 100.</p><p id="p0023" num="0023">The network monitoring apparatus 100 has, as illustrated in <figref idrefs="f0002">FIG. 2</figref>, a communication control I/F unit 110, an input unit 120, a display unit 130, a storage unit 140, and a control unit 150. The network monitoring apparatus 100 collects log information from the FW 200 and proxy server 300 included in the intra-enterprise NW and monitors, based on the collected log information, communication in the intra-enterprise NW.</p><p id="p0024" num="0024">The communication control I/F unit 110 controls communication related to various types of information exchanged between the FW 200 and proxy server 300 included in the intra-enterprise NW and the control unit 150. For example, the communication control I/F unit 110 controls communication related to collection of logs from the FW 200 and proxy server 300. Further, the communication control I/F unit 110 controls exchange of various types of information between: the input unit 120 and display unit 130; and the control unit 150.</p><p id="p0025" num="0025">The input unit 120 is, for example, a key board, a mouse, and the like, and accepts input processing of various types of information by a user. In one example, the input unit 120 accepts input processing or the like of a condition or the like for analyzing log information. The condition for analyzing log information will be described later. The display unit 130 is, for example, a display or the like, and outputs a result of processing by displaying it to a user. In one example, the display unit 130 outputs log information corresponding to the condition for analyzing log information by displaying it. That is, the display unit 130 outputs log information related to unauthorized communication in the intra-enterprise NW by displaying it.<!-- EPO <DP n="10"> --></p><p id="p0026" num="0026">The storage unit 140 has, as illustrated in <figref idrefs="f0001">FIG. 1</figref>, a log DB 141, an analysis information DB 142, and an analysis result DB 143. The storage unit 140 is, for example: a storage device, such as a hard disk or an optical disk; or a semiconductor memory element, such as a Random Access Memory (RAM) or a Flash Memory, and stores various programs and the like executed by the network monitoring apparatus 100.</p><p id="p0027" num="0027">The log DB 141 stores therein a log or logs collected from at least one of the FW 200 and proxy server 300 by the control unit 150, which will be described later. Specifically, the log DB 141 stores therein log information, which has been collected from at least one of the FW 200 and proxy server 300 by the later described control unit 150 and which has been normalized. For example, the log DB 141 stores therein log information having information that has been normalized, the information including: 5-tuple information (destination IP addresses, source IP addresses, destination ports, source ports, and protocols); connect times of communication; connection results; transmitted and received packet sizes; information on access destination URLs; and time stamps, for packets passing the FW 200 or proxy server 300.</p><p id="p0028" num="0028"><figref idrefs="f0003">FIG. 3</figref> is a diagram illustrating an example of the log information stored in the log DB 141 according to the first embodiment. For example, the log DB 141 stores therein, as illustrated in <figref idrefs="f0003">FIG. 3</figref>, log information, in which pieces of information on respective packets have been arranged chronologically based on the time stamp information. That is, the log DB 141 stores therein, as illustrated in <figref idrefs="f0003">FIG. 3</figref>, log information, in which "Date/Time" is associated with destination IP addresses, source IP addresses, destination ports, source ports,<!-- EPO <DP n="11"> --> protocols, transmitted sizes, received sizes, destination URLs, user agents, request methods, and determination results.</p><p id="p0029" num="0029">The "Date/Time" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a time at which a packet passed the FW 200 or a time at which the proxy server 300 executed communication. Further, "Destination IP Address" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates an IP address of a terminal at a destination of the packet (the user PC in the intra-enterprise NW, the terminal on the Internet, or the like) or of a server (the file server in the intra-enterprise NW, the server on the Internet, or the like). Furthermore, "Source IP Address" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates an IP address of a terminal at a transmission source of the packet (the user PC in the intra-enterprise NW, the terminal on the Internet, or the like) or of the server (the file server in the intra-enterprise NW, the server on the Internet, or the like).</p><p id="p0030" num="0030">Moreover, the "Destination Port" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a port of the terminal to be the destination of the packet (the user PC in the intra-enterprise NW, the terminal on the Internet, or the like) or of the server (the file server in the intra-enterprise NW, the server on the Internet, or the like). Further, "Source Port" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a port of the terminal to be the transmission source of the packet (the user PC in the intra-enterprise NW, the terminal on the Internet, or the like) or of the server (the file server in the intra-enterprise NW, the server on the Internet, or the like). Furthermore, "Protocol" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a communication protocol used in transmission and reception of the packet.</p><p id="p0031" num="0031">Moreover, "Transmitted Size" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a size of the packet transmitted by the FW 200<!-- EPO <DP n="12"> --> or proxy server 300. Further, "Received Size" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a size of the packet received by the FW 200 or proxy server 300. Further, "Destination URL" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a URL of a site on the server (the file server in the intra-enterprise NW, the server on the Internet, or the like) accessed by the terminal (the user PC in the intra-enterprise NW, the terminal on the Internet, or the like).</p><p id="p0032" num="0032">Furthermore, "User Agent" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates information on a browser of the terminal (the user PC in the intra-enterprise NW, the terminal on the Internet, or the like) that accesses the site on the server (the file server in the intra-enterprise NW, the server on the Internet, or the like). For example, if a user requests browsing of a Web site, a series of headers are transmitted from a browser to a server hosting that site. The respective headers include detailed information for the server to determine an optimum method of providing the information requested to be browsed. This "User Agent" is the header for identifying an application requesting information to the server. For example, "User Agent" includes information on a browser of the terminal that has requested browsing of the Web site, a version of the browser, an OS, and the like.</p><p id="p0033" num="0033">Further, "Request Method" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a request transmitted from the terminal (the user PC in the intra-enterprise NW, the terminal on the Internet, or the like) to (the file server in the intra-enterprise NW, the server on the Internet, or the like). Examples of "Request Method" include: "GET" by which a browser requests a server to obtain a Web site; "HEAD" requesting only header information; "PUT" and "POST" requesting a server to upload a file.<!-- EPO <DP n="13"> --></p><p id="p0034" num="0034">Further, "Determination Result" illustrated in <figref idrefs="f0003">FIG. 3</figref> indicates a result of determination by the FW 200 or proxy server 300. For example, "Determination Result" includes a result of transfer control of a packet between a user PC and the Internet based on a condition predefined by a user. Further, "Determination Result" includes, for example, a result of connection restrictions on: a Web site of a connection destination on the Internet based on a destination URL or the like of the packet; and the user terminal of the connection source.</p><p id="p0035" num="0035">As described above, the log DB 141 stores therein the log information, which is collected by the later described control unit 150 and is as illustrated in <figref idrefs="f0003">FIG. 3</figref>. The log information illustrated in <figref idrefs="f0003">FIG. 3</figref> is just an example, and the embodiment is not to be limited thereto. That is, the log DB 141 is able to store therein other types of information as the log information. Further, not all of the information illustrated in <figref idrefs="f0003">FIG. 3</figref> is collected for all of the packets, and for example, logs depending on log output devices that output the logs are collected. In other words, depending on types of the log output devices, any of the information may not be collected.</p><p id="p0036" num="0036">Returning to <figref idrefs="f0002">FIG. 2</figref>, the analysis information DB 142 stores therein information used in analysis by the later described control unit 150. Specifically, the analysis information DB 142 stores therein various types of information for extracting log information satisfying a predetermined condition, from the log information stored in the log DB 141. For example, the analysis information DB 142 stores therein information that becomes a key when log information is extracted with information included in a header of a packet. In one example, the analysis information DB 142 stores therein information that becomes<!-- EPO <DP n="14"> --> a key when log information is extracted with a character string included in a user agent. For example, the analysis information DB 142 stores therein a predetermined character string for extracting log information in which a character string other than the predetermined character string is included in the user agent. The above described examples are just an example, and the information stored in the analysis information DB 142 is not limited thereto. That is, the analysis information DB 142 may store therein any information as long as the information is able to be used when log information satisfying a predetermined condition is extracted from the log information stored in the log DB 141.</p><p id="p0037" num="0037">The analysis result DB 143 stores therein a result of analysis by the later described control unit 150. Specifically, the analysis result DB 143 stores therein log information extracted, based on a predetermined condition, by the later described control unit 150, from the log information stored in the log DB 141. More specifically, the analysis result DB 143 stores therein log information satisfying a predetermined condition in a predetermined time period, the log information having been extracted by the log information stored in the log DB 141 being analyzed over time.</p><p id="p0038" num="0038">The control unit 150 has a log collecting unit 151, a log analyzing unit 152, and an output control unit 153. The control unit 150 is, for example: an electronic circuit, such as a Central Processing Unit (CPU) or a Micro Processing Unit (MPU); or an integrated circuit, such as an Application Specific Integrated Circuit (ASIC) or a Field Programmable Gate Array (FPGA), and executes overall control of the network monitoring apparatus 100.</p><p id="p0039" num="0039">The log collecting unit 151 collects, for packets<!-- EPO <DP n="15"> --> transferred in the intra-enterprise NW, a log or logs related to passing packets from at least one of the FW 200 and proxy server 300 included in the intra-enterprise NW. Specifically, the log collecting unit 151 collects 5-tuple information of packets from the FW 200 and information on passing times of the packets (time stamps of the passage of the packets), in addition to information on determination results with respect to the packets (whether or not they are of unauthorized communication) and the like. Further, the log collecting unit 151 stores: information on connect times of communication from the proxy server 300, connection source user terminals, connection results, transmitted and received sizes of packets, access methods, and access destination URLs; information on times at which the communication was performed (time stamps of the execution of the communication); and the like.</p><p id="p0040" num="0040">By normalizing the collected information, the log collecting unit 151 converts log files of different formats into log information of a unified common format. The log collecting unit 151 stores the normalized log information into the log DB 141. For example, the log collecting unit 151 stores log information resulting from normalization of the above described log information, into the log DB 141 (see <figref idrefs="f0003">FIG. 3</figref>). That is, the log collecting unit 151 stores, as the log information, into the log DB 141, log information including: destination IP addresses, source IP addresses, destination ports, source ports, protocols, transmitted and received packet sizes, packet destination URLs, user agents, request methods, results of determination by the FW 200 or proxy server 300; and time information, for the packets transferred in the intra-enterprise NW.</p><p id="p0041" num="0041">The log collecting unit 151 may select the log<!-- EPO <DP n="16"> --> information to be collected according to a condition of log information analysis by the later described log analyzing unit 152. For example, the log collecting unit 151 collects a log including a destination IP address, a source IP address, a destination port, a source port, a protocol, and time information (a time stamp), for a packet transferred in a network. Or, the log collecting unit 151 collects information including a destination IP address, a source IP address, a destination port, a source port, a protocol, transmitted and received packet sizes, and time information (a time stamp), for a packet transferred in the network. Or, the log collecting unit 151 collects, as the log information, information including a destination IP address, a source IP address, a destination port, a source port, a protocol, a packet destination URL, a user agent, a request method, and time information (a time stamp), for a packet transferred in the network. That is, by the selection of the log information to be collected, a configuration of the log information stored in the log DB 141 by the log collecting unit 151 is changed as appropriate.</p><p id="p0042" num="0042">The log analyzing unit 152 extracts, by analyzing, over time, the log information collected by the log collecting unit 151, log information satisfying a predetermined condition in a predetermined time period. Specifically, the log analyzing unit 152 extracts, based on the log information collected by the log collecting unit 151, log information with a connection count and intervals of communication in a predetermined time period satisfying a predetermined condition. For example, by using the destination IP addresses, the source IP addresses, the destination ports, the source ports, the protocols, and the time information of the log information collected by the<!-- EPO <DP n="17"> --> log collecting unit 151, the log analyzing unit 152 extracts, from the log information stored in the log DB 141, log information of communication with a connection count of "10 times" and continuously occurring at "30-second" time intervals for a predetermined time period. The log analyzing unit 152 then stores the extracted log information into the analysis result DB 143.</p><p id="p0043" num="0043">Further, the log analyzing unit 152 extracts, based on the log information collected by the log collecting unit 151, log information with transmitted and received sizes of packets in a predetermined time period satisfying the predetermined condition. For example, by using the destination IP addresses, the source IP addresses, the destination ports, the source ports, the protocols, the transmitted and received packet sizes, and the time information, which are of the log information collected by the log collecting unit 151, the log analyzing unit 152 extracts, from the log information stored in the log DB 141, log information of communication with transmitted and received packets sizes respectively greater than predetermined numbers of bytes and continuing for a predetermined time period. The log analyzing unit 152 stores the extracted log information into the analysis result DB 143.</p><p id="p0044" num="0044">Further, the log analyzing unit 152 extracts, based on the log information collected by the log collecting unit 151, log information with header information of original communication included in logs in a predetermined time period satisfying a predetermined condition. For example, by using the destination IP addresses, the source IP addresses, the destination ports, the source ports, the protocols, the packet destination URLs, the user agents, the request methods, and the time<!-- EPO <DP n="18"> --> information, which are of the log information collected by the log collecting unit 151, the log analyzing unit 152 extracts log information of communication with a character string included in the user agents being a character string not stored in the analysis information DB 142, the communication continuing for a predetermined time period. The log analyzing unit 152 then stores the extracted log information into the analysis result DB 143.</p><p id="p0045" num="0045">As described above, by analyzing, over time, the log information collected by the log collecting unit 151, the log analyzing unit 152 extracts log information satisfying a predetermined condition in a predetermined time period. The above described examples of extraction are just an example, and a condition for extracting the log information may be arbitrarily set by a user. For example, various conditions may be set for a plurality of pieces of information (for example, the respective pieces of information illustrated in <figref idrefs="f0003">FIG. 3</figref>) and log information of communication satisfying the set conditions and continuing for a predetermined time period may be extracted. Setting of these conditions may be input by a user via the input unit 120 when the log information is analyzed, or preset conditions may be read out by the log analyzing unit 152. By a user causing analysis to be performed by setting various conditions analogized to unauthorized communication, log information likely to be of unauthorized communication is able to be detected.</p><p id="p0046" num="0046">The output control unit 153 controls an analysis result, which has been analyzed by the log analyzing unit 152 and stored in the analysis result DB 143, to be output by being displayed on the display unit 130. That is, the output control unit 153 causes the log information extracted with the condition set by the user to be output<!-- EPO <DP n="19"> --> by being displayed. Therefore, by setting various conditions analogized to unauthorized communication, a user is able to check on the display unit 130 information likely to be of unauthorized communication.</p><heading id="h0013">[Sequence of Processing by Network Monitoring Apparatus According to First Embodiment]</heading><p id="p0047" num="0047">Next, a sequence of processing by the network monitoring apparatus 100 according to the first embodiment will be described by using <figref idrefs="f0004">FIG. 4. FIG. 4</figref> is a flow chart illustrating the sequence of the processing by the network monitoring apparatus 100 according to the first embodiment. As illustrated in <figref idrefs="f0004">FIG. 4</figref>, in the network monitoring apparatus 100 according to the first embodiment, the log collecting unit 151 collects log information from the FW 200 and proxy server 300 (Step S101), and normalizes and stores into the log DB 141, the collected log information (Step S102).</p><p id="p0048" num="0048">When the input unit 120 receives a condition of analysis from an operator (Step S103: Yes), the log analyzing unit 152 extracts log information according to the received condition of analysis (Step S104). Thereafter, the log analyzing unit 152 stores an analysis result, which is the extracted log information, into the analysis result DB 143 (Step S105). Until the log analyzing unit 152 receives a condition of analysis, the collection of log information continues to be executed (Step S103: No).</p><p id="p0049" num="0049">The output control unit 153 then outputs the analysis result stored in the analysis result DB 143 by display on the display unit 130 (Step S106).</p><heading id="h0014">[Effects of First Embodiment]</heading><p id="p0050" num="0050">As described above, according to the first embodiment, the log collecting unit 151 collects log information from at least one of the FW 200 and proxy server 300 included in<!-- EPO <DP n="20"> --> the intra-enterprise NW, for packets transferred in the enterprise network. The log analyzing unit 152 then extracts log information satisfying a predetermined condition in a predetermined time period by analyzing, over time, the log information collected by the log collecting unit 151. Therefore, by extracting log information based on change over time of log information satisfying a predetermined condition, the network monitoring apparatus 100 according to the first embodiment is able to detect a candidate for unauthorized communication that used to be overlooked before, and enables unauthorized communication to be efficiently identified.</p><p id="p0051" num="0051">For example, a FW of the conventional art determines possibility of passage packet by packet, and thus by just singly looking at logs for passed packets upon success of an attack, communication of an attacker is unable to be recognized, and response to unknown attacks that continue to evolve has sometimes been delayed. Further, for example, since an IDS/IPS of the signature type of the conventional art is based on predefined patterns, response to unknown attacks has sometimes been delayed, too. In contrast, by performing analysis over time on log information satisfying a predetermined condition, the network monitoring apparatus 100 according to this application is able to detect attacks and the like which used to be not detectable before, and enables unauthorized communication to be efficiently identified.</p><p id="p0052" num="0052">Further, for example, the network monitoring apparatus 100 according to this application is able to detect diverse unauthorized communication by flexibly changing the predetermined condition related to the plurality of pieces of log information stored in the FW 200 and proxy server 300.<!-- EPO <DP n="21"> --></p><p id="p0053" num="0053">Further, according to the first embodiment, the log collecting unit 151 collects, as the log information, information including destination IP addresses, source IP addresses, destination ports, source ports, protocols, and time stamps, for packets transferred in the intra-enterprise NW. The log analyzing unit 152 then extracts, based on the log information collected by the log collecting unit 151, log information of communication with a connection count and intervals thereof in a predetermined time period satisfying a predetermined condition. Therefore, the network monitoring apparatus 100 according to the first embodiment is able to detect unauthorized communication, such as communication continuously executed with a malicious site, and take-out of data by an attacker on the Internet, for example.</p><p id="p0054" num="0054">Further, according to the first embodiment, the log collecting unit 151 collects, as log information, information including destination IP addresses, source IP addresses, destination ports, source ports, protocols, transmitted and received packet sizes, and time stamps, for packets transferred in a network. Further, the log analyzing unit 152 extracts, based on the log information collected by the log collecting unit 151, log information with transmitted and received packet sizes satisfying a predetermined condition in a predetermined time period. Therefore, the network monitoring apparatus 100 according to the first embodiment is able to detect unauthorized communication, such as an attack to a file server in the intra-enterprise NW from an attacker on the Internet, for example.</p><p id="p0055" num="0055">Further, according to the first embodiment, the log collecting unit 151 collects, as log information, information including destination IP addresses, source IP<!-- EPO <DP n="22"> --> addresses, destination ports, source ports, protocols, packet destination URLs, user agents, request methods, and time stamps, for packets transferred in the intra-enterprise NW. The log analyzing unit 152 extracts, based on the log information collected by the log collecting unit 151, log information with header information of original communication included in logs in a predetermined time period satisfying a predetermined condition. Therefore, the network monitoring apparatus 100 according to the first embodiment is able to detect unauthorized communication including illegal HTTP header information, for example.</p><heading id="h0015">(Second Embodiment)</heading><p id="p0056" num="0056">Next, a detecting apparatus (corresponding to the network monitoring apparatus according to the first embodiment) according to a second embodiment will be described. The detecting apparatus according to the second embodiment is able to detect cyber attacks, which are difficult to be detected under the present circumstances, and to detect phenomena, such as communication with an attacker and information leakage after success of an attack.</p><p id="p0057" num="0057">Conventionally, it has been very general to connect an internal network, such as an intra-enterprise network, to an external network, such as the Internet, and to use various services run on the external network. Cyber attacks to various services provided via a network and infrastructure (social infrastructure) are evolving day after day to those that use diverse techniques and that are persistent, and their threat is increasing more and more.</p><p id="p0058" num="0058">An example of their threat is falsely accessing a server provided in an internal network from an external network and stealing confidential information. Another example is, not just simply accessing an internal network falsely from an external network, but also falsely<!-- EPO <DP n="23"> --> embedding malicious software in a personal computer (PC) connected to the internal network, that is, causing the PC to be infected with the malicious software, and collecting falsely and transmitting to outside information from a server in the internal network by using the infected software. Further, yet another example is disturbing normal operation of a server in an internal network by sending malicious packets from an external network to the internal network.</p><p id="p0059" num="0059">In order to defend an internal network against such threat, in addition to provision of a FireWall (FW) at a connection point between an external network and the internal network, an IDS/IPS is starting to be provided. The IDS/IPS is a system that detects phenomena suspected to be of hacking from outside, and executes necessary defensive measures, such as disconnection of communication, if such phenomena are detected.</p><p id="p0060" num="0060"><figref idrefs="f0005">FIG. 5</figref> is a diagram illustrating an example of a configuration of a system for detecting and defending against unauthorized access and hacking. An internal network 62 is connected to an external network 61. Both of these networks transfer IP packets, and as a protocol of an IP upper layer, Transmission Control Protocol (TCP) or User Datagram Protocol (UDP) is used.</p><p id="p0061" num="0061">Between the external network 61 and internal network 62, a FireWall 71 for preventing unauthorized communication by performing packet filtering is provided. The FireWall 71 executes, based on so-called 5-tuples included in packet headers, processing of packet filtering. The 5-tuple is a combination of five parameters, consisting of a source IP address, a destination IP address, and a protocol, which are included in a header of an IP packet, and a transmission source port number and a destination<!-- EPO <DP n="24"> --> port number, which are included in a header of a TCP packet or UDP packet. The FireWall 71 has a logging function and is able to provide, to an administrator, logs related to possibility of passage for packets, which attempted to pass therethrough.</p><p id="p0062" num="0062">In the internal network 62, servers 75 and 76 are provided for example, and an IDS/IPS 73, which is for detecting and defending against cyber attacks, such as unauthorized access and hacking, that have not been able to be stopped by the FireWall 71, is also provided. The IDS/IPS 73 sends an alarm to a network administrator 63, if unauthorized access, hacking, or the like is detected.</p><p id="p0063" num="0063">Detecting methods used for the IDS/IPS 73 in detecting unauthorized access and hacking are broadly classified into a signature type and an anomaly type. By a detecting method of the signature type, assuming that a bit string characterizing unauthorized access, hacking, or the like is known, packets passing a certain point in a network are examined, and if an illegal bit string is present therein, abnormality is detected. By the anomaly type: a normal state is defined with respect to a resource load, an amount of communication, user behaviors, and the like; various logs, statistical information, amounts of load, amounts of communication, and the like are monitored; and if a state of a network or a server connected thereto deviates from the normal state, abnormality is detected. The signature type is based on matching with a predefined pattern and is premised on the fact that the illegal bit string is known, and thus has a problem that response thereof to an unknown attack tends to be delayed. For the anomaly type, erroneous detection becomes frequent if the normal state is defined too strictly, and thus it has a problem that it is difficult to find unauthorized<!-- EPO <DP n="25"> --> communication thoroughly.</p><p id="p0064" num="0064">Techniques of cyber attacks are evolving and becoming diverse, and just with the technique of making the determination by looking at the logs from a FireWall or defending by the matching with signatures and pattern files with use of an IDS/IPS or the like, it is difficult to deal with the continuously evolving cyber attacks. Therefore, defense with a security appliance, such as a conventional FireWall or IDS/IPS, is not sufficient and a new technique for detecting cyber attacks without omission is necessary. Further, although a security appliance is also present, which detects abnormality when a traffic flow amount exceeds a threshold value or when deviation from a predefined pattern occurs, there is a problem that continuous communication between an infected terminal (a terminal in which malicious software has been embedded) on an internal network and an attacker on an external network side is not able to be detected.</p><p id="p0065" num="0065">Thus, the detecting apparatus according to the second embodiment solves the above described problems by detecting cyber attacks, which have evolved as described above and are difficult to be detected under the present circumstances, and detecting phenomena, such as communication with an attacker and information leakage after success of an attack.</p><p id="p0066" num="0066">Next, the detecting apparatus according to the second embodiment will be described with reference to the drawings. <figref idrefs="f0006">FIG. 6</figref> is a block diagram illustrating a configuration of the detecting apparatus according to the second embodiment.</p><p id="p0067" num="0067">A detecting apparatus 20 illustrated in <figref idrefs="f0006">FIG. 6</figref> is provided in an internal network where IP packets are transferred. The internal network is connected to the<!-- EPO <DP n="26"> --> Internet, which is an external network, via a FireWall 41, and a proxy server 44 for Web access is provided in the internal network. The proxy server 44 represents access to Web sites on the Internet from a terminal in the internal network and performs access restriction as necessary, and in particular, performs proxy response to and transfer control on messages, by Hypertext Transmission Protocol (http) or http secure (https). The detecting apparatus 20 according to the second embodiment is provided separately from a conventional security appliance, such as an IDS/IPS. The detecting apparatus 20 performs correlation analysis focused on a log time series by using logs from the FireWall 41 and proxy server 44, and extracts a false pattern from a result of that analysis, to thereby detect occurrence of a cyber attack or information leakage. The correlation analysis focused on the time series is preferably performed over a long time period. The detecting apparatus 20 uses, from the logs obtained from the FireWall 41 and proxy server 44, in particular, 5-tuples, transmitted sizes, received sizes, destination URLs, User-Agent, request methods, and time stamps. The transmitted sizes and received sizes are able to be obtained both from the log of the FireWall 41 and from http headers. The destination URLs, the User-Agent, and the request methods, are all obtained from the http headers or https headers. The time stamps are time information related to records of the logs in the devices, such as the FireWall 41 and proxy server 44, and indicate a time at which an event corresponding to a log occurred or a time at which a log was actually recorded, for example.</p><p id="p0068" num="0068">Roughly separating, this detecting apparatus 20 is, as illustrated in <figref idrefs="f0006">FIG. 6</figref>, formed of: a log collecting unit 21, which collects and stores log data from the<!-- EPO <DP n="27"> --> FireWall 41 and proxy server 44; and a log analyzing unit 22, which performs analysis on the log data stored by the log collecting unit 21.</p><p id="p0069" num="0069">The log collecting unit 21 includes: a collection executing unit 31, which collects the log data from the FireWall 41 and proxy server 44; a normalizing unit 32, which performs normalization of the log data to facilitate analysis; a log management storage unit 33, in which the normalized log data are stored; and a log extracting unit 34, which searches the log data in the log management storage unit 33 according to inquiry from the log analyzing unit 22, receives a response of a result of the search from the log management storage unit 33, and transfers it to the log analyzing unit 22. The log data collected by the collection executing unit 31 include, for example, in addition to 5-tuple information, which is destination IP addresses, source IP addresses, destination ports, source ports, and protocols; information on transmitted sizes, received sizes, destination URLs, User-Agent, request methods, and time stamps. Furthermore, the log data may include results of determination (called device determination results) of whether targeted packets or http messages have been passed or rejected as unauthorized in the FireWall 41 and proxy server 44, or information, such as a device ID of each of the FireWall 41 and proxy server 44. If formats of the log data output from the FireWall 41 and proxy server 44 are unified or the like, analysis is able to be performed easily without necessarily performing normalization processing, and thus the log data collected by the collection executing unit 31 may be directly stored in the log management storage unit 33 without the normalizing unit 32 being provided.</p><p id="p0070" num="0070">The log analyzing unit 22 includes: a log<!-- EPO <DP n="28"> --> obtaining unit 35, which obtains logs by making inquiry to the log extracting unit 34 of the log collecting unit 21; an analysis executing unit 36, which requests log data to the log obtaining unit 35, receives a response thereto, and performs analysis of the log data according to a set analysis condition; and an analysis result database (DB) 37, which stores therein results of the analysis output from the analysis executing unit 36. Further, in order to achieve flexible analysis and improvement in accuracy of the analysis, the log analyzing unit 22 may include: a storage unit 38 (referred to as "NW information 38" as appropriate), which stores therein network (NW) information; and a storage unit 39 (referred to as "analysis rule 39" as appropriate), which stores therein various analysis rules as analysis conditions. The network information is information on topology, an address, subnets, and the like of a network to be monitored, and is used in order to determine, when the log obtaining unit 35 obtains log data from the log collecting unit 21, which direction a direction of communication related to the log data is (whether it is communication directed from the internal network to the external network, in a direction opposite thereto, or communication closed within the internal network). The determined communication direction is transmitted, together with the log data, to the analysis executing unit 36.</p><p id="p0071" num="0071">In the detecting apparatus 20, the analysis executing unit 36 may be configured to be able to read, from the storage unit 39, a plurality of analysis rules for analyzing time-based correlation for a plurality of sets of log data, rather than a single set of log data. If a plurality of analysis rules are to be read, the analysis executing unit 36 uses, for the analysis, values of items<!-- EPO <DP n="29"> --> determined by the respective analysis rules, from the log data accumulated in the log collecting unit 21, and outputs a result of the analysis for each analysis rule. Furthermore, the analysis executing unit 36 identifies a candidate for unauthorized communication and outputs that candidate, from a combination pattern of the results of the analysis by the respective analysis rules.</p><p id="p0072" num="0072">Next, operations of this detecting apparatus 20 will be described.</p><p id="p0073" num="0073">Log data are transmitted at any time from the FireWall 41 and proxy server 44 in the internal network, the collection executing unit 31 collects these log data and transfers them to the normalizing unit 32 in the log collecting unit 21, and the normalizing unit 32 normalizes the log data and stores the normalized log data into the log management storage unit 33. In the log analyzing unit 22, the analysis executing unit 36 transmits a log data request to the log obtaining unit 35, the log obtaining unit 35 makes inquiry, based on the log data request, to the log extracting unit 34 in the log collecting unit 21, and the log extracting unit 34 searches, based on the inquiry, the log data in the log management storage unit 33. A result response for this search is transmitted from the log management storage unit 33 to the log extracting unit 34, and thereby, the log obtaining unit 35 obtains the log data from the log extracting unit 34. Next, the log obtaining unit 35 determines, based on the network information in the NW information 38, a communication direction of communication related to the obtained log data, and transmits the log data and a result of the determination of the communication direction, as a log data response, to the analysis executing unit 36. The analysis executing unit 36 then applies a single analysis rule or a<!-- EPO <DP n="30"> --> plurality of analysis rules read out from the analysis rule 39 to the log data, and extracts a candidate of unauthorized communication by time-based correlation analysis. In particular, if a plurality of analysis rules are applied, the analysis executing unit 36 detects unauthorized communication more accurately by analyzing an output frequency and a pattern of analysis results obtained by the plurality of analysis rules. The extracted candidate for unauthorized communication is accumulated in the analysis result DB 37.</p><p id="p0074" num="0074">In many internal networks within enterprises, protocols and port numbers of packets that are able to pass through FireWalls are restricted. Representative examples of few passable protocols/port numbers are http messages for Web access. Therefore, if an attacker intends to infect a terminal on an internal network with malicious software and steal data in the terminal or a server on the internal network by using that software, the attacker is likely to use http messages. The detecting apparatus 20 according to the second embodiment is able to detect http communication suspected to be unauthorized, by using, in addition to log data from the FireWall 41, log data from the proxy server 44 for Web access, and in particular, is able to detect communication between an infected terminal and an attacker and communication with the possibility of information leakage.</p><p id="p0075" num="0075">Since the detecting apparatus 20 according to the second embodiment is able to use those output from an existing device as the log data themselves to be used, the detecting apparatus 20 is able to be introduced into a network configuration without placing much influence thereon.</p><p id="p0076" num="0076">Hereinafter, examples of analysis rules, which<!-- EPO <DP n="31"> --> are able to be used in the detecting apparatus 20 according to the second embodiment, in particular, analysis rules, which are able to be used for detecting communication between an infected terminal and an attacker and communication with the possibility of information leakage, and which enable analysis of time-based correlation for log data, will be described.
<ol><li>(1) Noting the numbers of transmitted bytes of http connection, based on at least 5-tuple information and information on the numbers of transmitted bytes and time stamps, from the log data accumulated in the log collecting unit 21, by referring to time information of the time stamps, communication with a value of the number of transmitted bytes within a set time period, the value having a difference from a normal value, is regarded as communication suspected to be unauthorized.</li><li>(2) Noting the number of http connections, based on at least 5-tuple information and information on destination URLs and time stamps, from the log data accumulated in the log collecting unit 21, by referring to time information of the time stamps, communication with a connection count of a group of the same communication in a set time period, the connection count having a difference from a normal value, is regarded as communication suspected to be unauthorized.</li><li>(3) Noting connection that violates policy, assuming the policy has been set beforehand in an internal network, based on at least 5-tuple information, the above described device determination results, and information on time stamps, from the log data accumulated in the log collecting unit 21, by referring to time information of the time stamps, communication with an occurrence frequency of policy violation in connections of a group of the same<!-- EPO <DP n="32"> --> communication in a set time period, the occurrence frequency having a difference from a normal value, is regarded as communication suspected to be unauthorized.</li><li>(4) Noting a difference between the numbers of transmitted and received bytes of http connection, based on at least 5-tuple information and information on the numbers of transmitted bytes, the numbers of received bytes, and time stamps, from the log data accumulated in the log collecting unit 21, by referring to time information of the time stamps, communication with a value of a difference between the number of transmitted bytes and the number of received bytes in a set time period, the value having a difference from a normal value, is regarded as communication suspected to be unauthorized.</li><li>(5) Noting User-Agent from header information of http communication, based on at least 5-tuple information and information on User-Agent and time stamps, from the log data accumulated in the log collecting unit 21, by referring to time information of the time stamps, communication with a User-Agent in a set time period, the User-Agent being different from a normal value, is regarded as communication suspected to be unauthorized.</li><li>(6) Noting request methods and the numbers of transmitted and received bytes, from header information of http communication, based on at least 5-tuple information and information on the numbers of transmitted bytes, the numbers of received bytes, request methods, and time stamps, from the log data accumulated in the log collecting unit 21, by referring to time information of the time stamps, communication with a particular request method and a value of a difference between the numbers of transmitted and received bytes associated with that communication, the particular request method and the value being different<!-- EPO <DP n="33"> --> from normal values, is regarded as communication suspected to be unauthorized.</li><li>(7) Noting destination URLs, based on 5-tuple information and information on destination URLs and time stamps, from the log data accumulated in the log collecting unit 21, by referring to time information of the time stamps, communication having abnormality in destination URLs in a set time period is regarded as communication suspected to be unauthorized.</li></ol></p><p id="p0077" num="0077">For example, the detecting apparatus 20 according to the second embodiment may be configured as dedicated hardware, but may also be realized by using a general-purpose computer including a micro processor, a memory, and a communication interface and executing a computer program that executes functions of the detecting apparatus 20 on this computer. The same applies to the network monitoring apparatus 100 according to the first embodiment.</p><p id="p0078" num="0078"><figref idrefs="f0007">FIG. 7</figref> is a diagram illustrating an example of a configuration of a network, to which the detecting apparatus according to the second embodiment is applied. An intra-enterprise network 12, which is an internal network, is connected to the Internet 11, and the FireWall 41 is provided at a connection point between the intra-enterprise network 12 and the Internet 11. In the intra-enterprise network 12, a switch (SW)/router 42, which connects to the FireWall 41, is provided; and to the switch/router 42: an IDS/IPS 43; the proxy server 44; file servers 45 and 46; and user PCs 47 to 49, which are terminals, are provided. The above described detecting apparatus 20 is provided to receive log data from the FireWall 41 and proxy server 44. Although not illustrated in the drawings, in the intra-enterprise network 12, the network may be further divided into several segments, and<!-- EPO <DP n="34"> --> an internal FireWall may be provided at a segment dividing point. If log data of the internal FireWall are also provided to the detecting apparatus 20, communication suspected to be unauthorized, which has a start/end point in the intra-enterprise network 12, is able to be detected.</p><p id="p0079" num="0079">The Internet 11 is assumed to have a malicious site 51 present therein and to have an attacker 52 also present therein. Of the user PCs 47 to 49, the user PC 49 illustrated with a double lined frame is assumed to be an infected terminal embedded with malicious software. If an attacker attempts to steal information from the intra-enterprise network 12, in a typical example: first, as illustrated with "[1]", the user PC 49 performs communication with the malicious site 51 and is instructed to investigate the file servers 45 and 46; next, as illustrated with "[2]", the user PC 49 performs investigation activity inside and obtains information from the file servers 45 and 46; and lastly, as illustrated with "[3]", by the user PC 49, which is the infected terminal, performing communication with the attacker 52 and transmitting the illegally obtained data to the attacker 52, the data are taken out to the Internet 11 side. By using the detecting apparatus 20 according to the second embodiment and applying the above described analysis rules, at any of the stages illustrated with "[1]", "[2]", and "[3]" in the figure, based on log data from at least one of the FireWall 41 and internal FireWall and on log data from the proxy server 44, communication suspected to be unauthorized is able to be detected.</p><p id="p0080" num="0080">As described above, the detecting apparatus according to the second embodiment achieves an effect of being able to detect communication suspected to be unauthorized, in particular, of being able to detect<!-- EPO <DP n="35"> --> phenomena, such as communication with an attacker and information leakage after success of an attack, by using log data from devices generally provided in an existing network, the devices being a FireWall and a proxy server, and combining these log data.</p><heading id="h0016">(Third Embodiment)</heading><p id="p0081" num="0081">The first embodiment and second embodiment have been described above, but embodiments according to the present application are not limited to the first embodiment and second embodiment. That is, these embodiments may be implemented in various other modes, and various omissions therefrom, replacements therewith, and modifications thereof may be made.</p><p id="p0082" num="0082">For example, specific modes (for example, the mode in <figref idrefs="f0002">FIG. 2</figref>) of separation and integration of the respective devices are not limited only to those illustrated in the drawings, and all or a part thereof may be functionally or physically separated or integrated in arbitrary units depending on various loads and use situations. For example, the log DB 141 and the analysis result DB 143 may be integrated into one DB, and the log collecting unit 151 may be separated into a collecting unit that collects logs and a normalization processing unit that performs normalization processing. Further, the storage unit 140 may use a DB of an existing management system or an external DB. That is, a DB of an existing management system or an external DB may have the log DB 141, analysis information DB 142, and analysis result DB 143 included in the storage unit 140, and the control unit 150 may access the DB of the existing management system or external DB to execute reading and writing of information.</p><p id="p0083" num="0083">Further, the control unit 150 may be connected, as an external device of the network monitoring apparatus<!-- EPO <DP n="36"> --> 100, via a network, or by respectively including the log collecting unit 151 and the log analyzing unit 152 in separate devices and connecting these to a network for cooperation with each other, the above described functions of the network monitoring apparatus 100 may be realized.</p><p id="p0084" num="0084">In the above described first embodiment, the case where packets are exchanged between the Internet and the intra-enterprise NW, has been described as one example. However, the embodiments are not limited thereto, and may be applied to any environment as long as it is an environment where packets are exchanged among a plurality of networks, for example.</p><p id="p0085" num="0085">In the above described first embodiment, as illustrated in <figref idrefs="f0001">FIG. 1</figref>, a case where two FWs 200 and one proxy server 300 are included in the intra-enterprise NW has been described. However, the embodiments are not limited thereto, and the number of each device is modified arbitrarily according to networks. That is, the network monitoring apparatus 100 collects log information from each of any FWs 200 and proxy servers 300 arranged in a network to be monitored.</p><p id="p0086" num="0086">In the above described first embodiment, a case where log information is collected from each of the FW 200 and proxy server 300 has been described. However, the embodiments are not limited thereto, and log information may be collected from any one thereof, for example.</p><p id="p0087" num="0087">Like these embodiments and modifications thereof are included in the techniques disclosed by the present application, they are included in the invention stated in the patent claims and scope equivalent thereto.</p><heading id="h0017">Reference Signs List</heading><p id="p0088" num="0088"><dl id="dl0001" compact="compact"><dt>11</dt><dd>INTERNET</dd><dt>12</dt><dd>INTRA-ENTERPRISE NETWORK<!-- EPO <DP n="37"> --></dd><dt>20</dt><dd>DETECTING APPARATUS</dd><dt>21, 151</dt><dd>LOG COLLECTING UNIT</dd><dt>22, 152</dt><dd>LOG ANALYZING UNIT</dd><dt>31</dt><dd>COLLECTION EXECUTING UNIT</dd><dt>32</dt><dd>NORMALIZING UNIT</dd><dt>33</dt><dd>LOG MANAGEMENT STORAGE UNIT</dd><dt>34</dt><dd>LOG EXTRACTING UNIT</dd><dt>35</dt><dd>LOG OBTAINING UNIT</dd><dt>36</dt><dd>ANALYSIS EXECUTING UNIT</dd><dt>37, 143</dt><dd>ANALYSIS RESULT DATABASE (DB)</dd><dt>38</dt><dd>STORAGE UNIT STORING NETWORK (NW) INFORMATION</dd><dt>39</dt><dd>STORAGE UNIT STORING ANALYSIS RULE</dd><dt>41, 200</dt><dd>FIREWALL (FW)</dd><dt>42</dt><dd>SWITCH/ROUTER</dd><dt>43</dt><dd>IDS/IPS</dd><dt>44, 300</dt><dd>PROXY SERVER</dd><dt>45, 46</dt><dd>FILE SERVER</dd><dt>47 TO 49</dt><dd>USER PC</dd><dt>100</dt><dd>NETWORK MONITORING APPARATUS</dd><dt>141</dt><dd>LOG DB</dd><dt>142</dt><dd>ANALYSIS INFORMATION DB</dd><dt>153</dt><dd>OUTPUT CONTROL UNIT</dd></dl></p></description><claims mxw-id="PCLM90459233" lang="EN" load-source="patent-office"><!-- EPO <DP n="38"> --><claim id="c-en-0001" num="0001"><claim-text>A network monitoring apparatus, which is provided in a network that includes a FireWall provided on at least one of a connection point with an external network and an internal segment dividing point and a proxy server for Web access and that transfers IP packets, and which detects communication suspected to be unauthorized, the network monitoring apparatus comprising:
<claim-text>a log collecting unit that collects and stores log data from at least one of the FireWall and the proxy server; and</claim-text>
<claim-text>a log analyzing unit that makes inquiry for log data to the log collecting unit, analyzes, according to a set analysis condition, the log data, and outputs a result of the analysis, wherein</claim-text>
<claim-text>the log data stored by the log collecting unit are information including at least one of: 5-tuples; transmitted sizes; received sizes; information extracted from http headers; and time stamps, and</claim-text>
<claim-text>the information extracted from http headers includes at least one of: destination URLs; User-Agent; and request methods.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The network monitoring apparatus according to claim 1, wherein the log analyzing unit is able to set a plurality of analysis conditions for analyzing time-based correlation with respect to a plurality of sets of the log data, and executes analysis according to each analysis condition.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The network monitoring apparatus according to claim 2, wherein the log analyzing unit detects and outputs, from a combination pattern of results of the analysis with the respective analysis conditions, a candidate for<!-- EPO <DP n="39"> --> unauthorized communication.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The network monitoring apparatus according to any one of claims 1 to 3, wherein the log analyzing unit determines, based on information on a network to be monitored, a direction of communication to be a target of log data, and executes analysis based on the determined direction and the log data.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The network monitoring apparatus according to claim 3, wherein<br/>
the log collecting unit collects, as the log data, information including the 5-tuples and the time stamps, and<br/>
the log analyzing unit extracts, based on the log data collected by the log collecting unit, log data with a connection count and intervals of communication in a predetermined time period satisfying a predetermined condition.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The network monitoring apparatus according to claim 3, wherein<br/>
the log collecting unit collects, as the log data, information including the 5-tuples, the transmitted sizes, the received sizes, and the time stamps, and<br/>
the log analyzing unit extracts, based on the log data collected by the log collecting unit, log data with transmitted and receives sizes of IP packets in a predetermined time period satisfying a predetermined condition.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The network monitoring apparatus according to claim 3, wherein<br/>
the log collecting unit collects, as the log data,<!-- EPO <DP n="40"> --> information including the 5-tuples, the destination URLs, the User-Agent, the request methods, and the time stamps, and<br/>
the log analyzing unit extracts, based on the log data collected by the log collecting unit, log data with header information of original communication included in the log data in a predetermined time period satisfying a predetermined condition.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>A network monitoring method executed by a network monitoring apparatus, which is provided in a network that includes a FireWall provided on at least one of a connection point with an external network and an internal segment dividing point and a proxy server for Web access and that transfers IP packets, and which detects communication suspected to be unauthorized, the network monitoring method including:
<claim-text>a log collecting process of collecting and storing log data from at least one of the FireWall and the proxy server; and</claim-text>
<claim-text>a log analyzing process of making inquiry for log data with respect to the log collecting process, analyzing, according to a set analysis condition, the log data, and outputting a result of the analysis, wherein</claim-text>
<claim-text>the log data stored by the log collecting process are information including at least one of: 5-tuples; transmitted sizes; received sizes; information extracted from http headers; and time stamps, and</claim-text>
<claim-text>the information extracted from http headers includes at least one of: destination URLs; User-Agent; and request methods.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>A network monitoring program, which is provided in a<!-- EPO <DP n="41"> --> network that includes a FireWall provided on at least one of a connection point with an external network and an internal segment dividing point and a proxy server for Web access and that transfers IP packets, and which detects communication suspected to be unauthorized, the network monitoring program causing a computer to execute:
<claim-text>a log collecting step of collecting and storing log data from at least one of the FireWall and the proxy server; and</claim-text>
<claim-text>a log analyzing step of making inquiry for log data with respect to the log collecting step, analyzing, according to a set analysis condition, the log data, and outputting a result of the analysis, wherein</claim-text>
<claim-text>the log data stored by the log collecting step are information including at least one of: 5-tuples; transmitted sizes; received sizes; information extracted from http headers; and time stamps, and</claim-text>
<claim-text>the information extracted from http headers includes at least one of: destination URLs; User-Agent; and request methods.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW20421968" load-source="patent-office"><!-- EPO <DP n="42"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="165" he="186" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="43"> --><figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="192" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="44"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="124" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="45"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="139" he="187" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="46"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="165" he="136" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="47"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="165" he="231" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="48"> --><figure id="f0007" num="7"><img id="if0007" file="imgf0007.tif" wi="165" he="195" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="49"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="162" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="231" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
