<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961110-A1" country="EP" doc-number="2961110" kind="A1" date="20151230" family-id="52761442" file-reference-id="276484" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451571" ucid="EP-2961110-A1"><document-id><country>EP</country><doc-number>2961110</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14870658-A" is-representative="YES"><document-id mxw-id="PAPP193866110" load-source="docdb" format="epo"><country>EP</country><doc-number>14870658</doc-number><kind>A</kind><date>20140319</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193866111" load-source="patent-office" format="original"><country>EP</country><doc-number>14870658.3</doc-number><date>20140319</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162034403" ucid="CN-2014073715-W" linkage-type="A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2014073715</doc-number><kind>W</kind><date>20140319</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1946260817" load-source="docdb">H04L  29/06        20060101ALI20160420BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1946268657" load-source="docdb">H04L  29/12        20060101ALI20160420BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1946271681" load-source="docdb">H04L  12/66        20060101AFI20160420BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1848615813" load-source="docdb" scheme="CPC">H04L  12/6418      20130101 FI20151103BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1949002628" load-source="docdb" scheme="CPC">H04L  61/2517      20130101 LA20160419BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1949002629" load-source="docdb" scheme="CPC">H04L  61/251       20130101 LI20160419BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165546179" lang="DE" load-source="patent-office">PAKETÜBERTRAGUNGSVERFAHREN UND -VORRICHTUNG SOWIE SERVER</invention-title><invention-title mxw-id="PT165546180" lang="EN" load-source="patent-office">PACKET TRANSMISSION METHOD AND APPARATUS, AND SERVER</invention-title><invention-title mxw-id="PT165546181" lang="FR" load-source="patent-office">PROCÉDÉ, APPAREIL ET SERVEUR DE TRANSMISSION DE PAQUETS</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103316209" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI DEVICE CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103339268" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI DEVICE CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101640022" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Device Co., Ltd.</last-name><iid>101239330</iid><address><street>Building B2 Huawei Industrial Base Bantian Longgang District</street><city>Shenzhen, Guangdong 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103333541" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>MIAO JIAN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103306463" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>MIAO, JIAN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101649857" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>MIAO, JIAN</last-name><address><street>Building B2 Huawei Industrial Base Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103324616" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>ZHAO XUEWEN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103309500" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>ZHAO, XUEWEN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101650756" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>ZHAO, XUEWEN</last-name><address><street>Building B2 Huawei Industrial Base Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101653851" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Körber, Martin Hans</last-name><iid>101424958</iid><address><street>Mitscherlich PartmbB Patent- und Rechtsanwälte Sonnenstrasse 33</street><city>80331 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2014073715-W"><document-id><country>CN</country><doc-number>2014073715</doc-number><kind>W</kind><date>20140319</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2015139244-A1"><document-id><country>WO</country><doc-number>2015139244</doc-number><kind>A1</kind><date>20150924</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660689320" load-source="docdb">AL</country><country mxw-id="DS660687786" load-source="docdb">AT</country><country mxw-id="DS660687422" load-source="docdb">BE</country><country mxw-id="DS660607556" load-source="docdb">BG</country><country mxw-id="DS660783972" load-source="docdb">CH</country><country mxw-id="DS660687467" load-source="docdb">CY</country><country mxw-id="DS660687791" load-source="docdb">CZ</country><country mxw-id="DS660689322" load-source="docdb">DE</country><country mxw-id="DS660687468" load-source="docdb">DK</country><country mxw-id="DS660687469" load-source="docdb">EE</country><country mxw-id="DS660612244" load-source="docdb">ES</country><country mxw-id="DS660607557" load-source="docdb">FI</country><country mxw-id="DS660783973" load-source="docdb">FR</country><country mxw-id="DS660689339" load-source="docdb">GB</country><country mxw-id="DS660687470" load-source="docdb">GR</country><country mxw-id="DS660689340" load-source="docdb">HR</country><country mxw-id="DS660687792" load-source="docdb">HU</country><country mxw-id="DS660783974" load-source="docdb">IE</country><country mxw-id="DS660687479" load-source="docdb">IS</country><country mxw-id="DS660607558" load-source="docdb">IT</country><country mxw-id="DS660687480" load-source="docdb">LI</country><country mxw-id="DS660607567" load-source="docdb">LT</country><country mxw-id="DS660694770" load-source="docdb">LU</country><country mxw-id="DS660607568" load-source="docdb">LV</country><country mxw-id="DS660607569" load-source="docdb">MC</country><country mxw-id="DS660694775" load-source="docdb">MK</country><country mxw-id="DS660694776" load-source="docdb">MT</country><country mxw-id="DS660612245" load-source="docdb">NL</country><country mxw-id="DS660611786" load-source="docdb">NO</country><country mxw-id="DS660612246" load-source="docdb">PL</country><country mxw-id="DS660607570" load-source="docdb">PT</country><country mxw-id="DS660687793" load-source="docdb">RO</country><country mxw-id="DS660607575" load-source="docdb">RS</country><country mxw-id="DS660612255" load-source="docdb">SE</country><country mxw-id="DS660783975" load-source="docdb">SI</country><country mxw-id="DS660611791" load-source="docdb">SK</country><country mxw-id="DS660611792" load-source="docdb">SM</country><country mxw-id="DS660694777" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479941" lang="EN" load-source="patent-office"><p id="pa01" num="0001">The present invention discloses a packet transmission method and apparatus, and a server, and belongs to the field of Internet technologies. The method includes: receiving at least one first IPv4 packet sent by at least one user equipment, where each first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment; determining, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each first IPv4 packet; updating the source port of each first IPv4 packet with the corresponding output port; converting, according to a set algorithm, the IPv4 address carried in each first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet; and transmitting, to an IPv6 network, each first IPv6 packet by using the output port of each first IPv6 packet. According to the present invention, IPv4 addresses carried in received first IPv4 packets are converted into a same target IPv6 address, thereby reducing resource consumption during packet transmission, and improving packet transmission efficiency.<img id="iaf01" file="imgaf001.tif" wi="78" he="62" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759753" lang="EN" source="EPO" load-source="docdb"><p>The present invention discloses a packet transmission method and apparatus, and a server, and belongs to the field of Internet technologies. The method includes: receiving at least one first IPv4 packet sent by at least one user equipment, where each first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment; determining, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each first IPv4 packet; updating the source port of each first IPv4 packet with the corresponding output port; converting, according to a set algorithm, the IPv4 address carried in each first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet; and transmitting, to an IPv6 network, each first IPv6 packet by using the output port of each first IPv6 packet. According to the present invention, IPv4 addresses carried in received first IPv4 packets are converted into a same target IPv6 address, thereby reducing resource consumption during packet transmission, and improving packet transmission efficiency.</p></abstract><description mxw-id="PDES98404642" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">The present invention relates to the field of Internet technologies, and in particular, to a packet transmission method and apparatus, and a server.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">With the development of Internet technologies, IPv4 (Internet Protocol Version 4, Internet Protocol version 4) address resources are gradually exhausted while an IPv6 (Internet Protocol Version4, Internet Protocol version 6) technology gradually becomes mature. Currently, an operator provides a pure IPv6 access service for an access gateway device (for example, a home router) due to a lack of public IPv4 address resources; however, a user equipment (such as a personal computer or a smartphone) connected to the access gateway device needs to access an IPv4 site on the Internet. Therefore, packet transmission needs to be performed to implement IPv4 end-to-end communication that traverses a pure IPv6 network.</p><p id="p0003" num="0003">According to a related technology, during packet transmission, first, one 32-bit IPv4 address is allocated to each user equipment according to DHCP (Dynamic Host Configuration Protocol, Dynamic Host Configuration Protocol); further, IPv4 packets that carries the IPv4 addresses and sent by the user equipments are received; then, a global unicast IPv6 prefix is acquired from an IPv6 network side; and the IPv4 addresses are converted into different 128-bit IPv6 addresses according to the acquired global unicast IPv6 prefix, the IPv6 addresses obtained after the conversion are carried in IPv6 packets, and the IPv6 packets are sent to an IPv6 network. IPv6 packets returned by the IPv6 network are received; and the received IPv6 packets are converted into IPv4 packets, and the IPv4 packets are sent to the user equipment. Specifically, when the IPv4 addresses that are carried in the received IPv4 packets sent by the user equipments are converted into the IPv6 addresses, if a length of the global unicast IPv6 prefix is 96 bits, the 96-bit global unicast IPv6 prefix may be directly added before the 32-bit IPv4 address; and if the length of the global unicast IPv6 prefix is not 96 bits, the 32-bit IPv4 address may be converted into the 128-bit IPv6 address by means of operations such as u byte padding, suffix padding, and IPv4 address splitting and padding.</p><p id="p0004" num="0004">During implementation of the present invention, the inventor finds that the related technology has<!-- EPO <DP n="2"> --> at least the following problems:</p><p id="p0005" num="0005">According to the related technology, during packet transmission, because different user equipments have different IPv4 addresses, when conversion is performed on the addresses, conversion needs to be independently performed on each IPv4 address, and calculation for independently performing conversion on each IPv4 address is relatively complex; in addition, because operations such as u byte padding, suffix padding, and IPv4 address splitting and padding need to be performed when the length of the global unicast IPv6 prefix is not 96 bits, and these operations involve a relatively large amount of calculation, consumption during the packet transmission increases, thereby leading to low packet transmission efficiency.</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0006" num="0006">In order to resolve problems of related technologies, embodiments of the present invention provide a packet transmission method and apparatus, and a server. The technical solutions are as follows:</p><p id="p0007" num="0007">According to a first aspect, a packet transmission method is provided, where the method includes:
<ul><li>receiving at least one first IPv4 packet sent by at least one user equipment, where each of the first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment;</li><li>determining, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each of the first IPv4 packet;</li><li>updating the source port corresponding to each of the first IPv4 packet with the corresponding output port, and converting, according to a set algorithm, the IPv4 address carried in each of the first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each of the first IPv4 packet, where each of the first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and</li><li>transmitting, to an IPv6 network, each of the first IPv6 packet by using the output port of each of the first IPv6 packet.</li></ul></p><p id="p0008" num="0008">With reference to the first aspect, in a first possible implementation manner of the first aspect, before the receiving a first IPv4 packet sent by at least one user equipment, the method further includes:
<ul><li>starting a Dynamic Host Configuration Protocol DHCP service; and</li><li>allocating an IPv4 address to an accessed user equipment by using the DHCP service.</li></ul></p><p id="p0009" num="0009">With reference to the first aspect, in a second possible implementation manner of the first aspect, before the converting the IPv4 address carried in each of the first IPv4 packet into a same target global unicast<!-- EPO <DP n="3"> --> IPv6 address, the method further includes:
<ul><li>acquiring an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and</li><li>padding a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</li></ul></p><p id="p0010" num="0010">With reference to the first aspect, in a third possible implementation manner of the first aspect, after the transmitting, to an IPv6 network, each of the first IPv6 packet by using the output port of each of the IPv6 packet, the method further includes:
<ul><li>receiving a second IPv6 packet sent by the IPv6 network, where the second IPv6 packet carries the target global unicast IPv6 address and an output port;</li><li>determining, according to the correspondence between a source port of an IPv4 packet and an output port, a source port corresponding to the output port of the second IPv6 packet; and updating the output port of the second IPv6 packet with the corresponding source port, and updating the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet; and</li><li>sending, by using the source port corresponding to the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update.</li></ul></p><p id="p0011" num="0011">With reference to the first aspect, in a fourth possible implementation manner of the first aspect, the determining an output port corresponding to the source port of each of the first IPv4 packet includes:
<ul><li>determining, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each of the first IPv4 packet; or</li><li>randomly allocating a corresponding output port according to the source port of each of the first IPv4 packet, to obtain the output port corresponding to the source port of each of the first IPv4 packet.</li></ul></p><p id="p0012" num="0012">According to a second aspect, a packet transmission apparatus is provided, where the apparatus includes:
<ul><li>a first receiving module, configured to control a receiver to receive at least one first IPv4 packet sent by at least one user equipment, where each of the first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment;</li><li>a first determining module, configured to control a processor to determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each of the first IPv4 packet;<!-- EPO <DP n="4"> --></li><li>a first updating module, configured to control the processor to update the source port corresponding to each of the first IPv4 packet with the corresponding output port;</li><li>a conversion module, configured to control the processor to convert, according to a set algorithm, the IPv4 address carried in each of the first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each of the first IPv4 packet, where each of the first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and</li><li>a first sending module, configured to control a transmitter to transmit, to an IPv6 network, each of the first IPv6 packet by using the output port corresponding to each of the first IPv6 packet.</li></ul></p><p id="p0013" num="0013">With reference to the second aspect, in a first possible implementation manner of the second aspect, the apparatus further includes:
<ul><li>a starting module, configured to control the processor to start a Dynamic Host Configuration Protocol DHCP service; and</li><li>an allocation module, configured to control the processor to allocate an IPv4 address to an accessed user equipment by using the DHCP service.</li></ul></p><p id="p0014" num="0014">With reference to the second aspect, in a second possible implementation manner of the second aspect, the apparatus further includes:
<ul><li>an acquiring module, configured to control the processor to acquire an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and</li><li>a padding module, configured to control the processor to pad a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</li></ul></p><p id="p0015" num="0015">With reference to the second aspect, in a third possible implementation manner of the second aspect, the apparatus further includes:
<ul><li>a second receiving module, configured to control the receiver to receive a second IPv6 packet sent by the IPv6 network, where the second IPv6 packet carries the target global unicast IPv6 address and an output port;</li><li>a second determining module, configured to control the processor to determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to the output port of the second IPv6 packet;</li><li>a second updating module, configured to control the processor to update the output port of the second IPv6 packet with the corresponding source port, and update the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6<!-- EPO <DP n="5"> --> packet; and</li><li>a second sending module, configured to control the transmitter to send, by using the source port of the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update.</li></ul></p><p id="p0016" num="0016">With reference to the second aspect, in a fourth possible implementation manner of the second aspect, the first determining module is configured to control the processor to determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each of the first IPv4 packet; or randomly allocate a corresponding output port according to the source port of each of the first IPv4 packet, to obtain the output port corresponding to the source port of each of the first IPv4 packet.</p><p id="p0017" num="0017">According to a third aspect, a packet transmission server is provided, where the server includes: a processor, a transmitter, and a receiver, where:
<ul><li>the receiver is configured to receive at least one first IPv4 packet sent by at least one user equipment, where each of the first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment;</li><li>the processor is configured to: determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each of the first IPv4 packet; update the source port corresponding to each of the first IPv4 packet with the corresponding output port; and convert, according to a set algorithm, the IPv4 address carried in each of the first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each of the first IPv4 packet, where each of the first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and</li><li>the transmitter is configured to transmit, to an IPv6 network, each of the first IPv6 packet by using the output port of each of the first IPv6 packet.</li></ul></p><p id="p0018" num="0018">With reference to the third aspect, in a first possible implementation manner of the third aspect, the processor is further configured to: start a Dynamic Host Configuration Protocol DHCP service; and allocate an IPv4 address to an accessed user equipment by using the DHCP service.</p><p id="p0019" num="0019">With reference to the third aspect, in a second possible implementation manner of the third aspect, the processor is further configured to acquire an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and pad a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.<!-- EPO <DP n="6"> --></p><p id="p0020" num="0020">With reference to the third aspect, in a third possible implementation manner of the third aspect, the receiver is further configured to receive a second IPv6 packet sent by the IPv6 network, where the second IPv6 packet carries the target global unicast IPv6 address and an output port;<br/>
the transmitter is further configured to send, by using the source port of the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update; and<br/>
the processor is further configured to: determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to the output port of the second IPv6 packet; and update the output port of the second IPv6 packet with the corresponding source port, and update the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet.</p><p id="p0021" num="0021">With reference to the third aspect, in a fourth possible implementation manner of the third aspect, the processor is configured to: determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each of the first IPv4 packet; or randomly allocate a corresponding output port according to the source port of each of the first IPv4 packet, to obtain the output port corresponding to the source port of each first IPv4 packet.</p><p id="p0022" num="0022">The technical solutions provided by the embodiments of the present invention bring about the following beneficial effects:</p><p id="p0023" num="0023">A first IPv4 packet that is sent by a user equipment and carries an IPv4 address and a source port that are allocated to each user equipment is received; an output port corresponding to the source port of each first IPv4 packet is determined; further, the source port corresponding to each first IPv4 packet is updated with the corresponding output port; the IPv4 address carried in each first IPv4 packet is converted into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet; and each first IPv6 packet is transmitted to an IPv6 network by using the output port of each first IPv6 packet. Because IPv4 addresses carried in received IPv4 packets sent by user equipments are converted into a same target unicast IPv6 address, resource consumption during packet transmission is reduced and packet transmission efficiency is improved.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0024" num="0024">To describe the technical solutions in the embodiments of the present invention more clearly, the following briefly introduces the accompanying drawings required for describing the embodiments. Apparently,<!-- EPO <DP n="7"> --> the accompanying drawings in the following description show merely some embodiments of the present invention, and a person of ordinary skill in the art may still derive other drawings from these accompanying drawings without creative efforts.
<ul><li><figref idrefs="f0001">FIG. 1</figref> is a schematic diagram of a network topology principle of 464XLAT according to Embodiment 1 of the present invention;</li><li><figref idrefs="f0001">FIG. 2</figref> is a flowchart of a packet transmission method according to Embodiment 1 of the present invention;</li><li><figref idrefs="f0002">FIG. 3</figref> is a flowchart of a packet transmission method according to Embodiment 2 of the present invention;</li><li><figref idrefs="f0003">FIG. 4</figref> is a schematic diagram of a correspondence among an IPv4 address, a source port, and an output port according to Embodiment 2 of the present invention;</li><li><figref idrefs="f0003">FIG. 5</figref> is a schematic structural diagram of a first packet transmission apparatus according to Embodiment 3 of the present invention;</li><li><figref idrefs="f0004">FIG. 6</figref> is a schematic structural diagram of a second packet transmission apparatus according to Embodiment 3 of the present invention;</li><li><figref idrefs="f0005">FIG. 7</figref> is a schematic structural diagram of a third packet transmission apparatus according to Embodiment 3 of the present invention;</li><li><figref idrefs="f0006">FIG. 8</figref> is a schematic structural diagram of a fourth packet transmission apparatus according to Embodiment 3 of the present invention; and</li><li><figref idrefs="f0007">FIG. 9</figref> is a schematic diagram of an apparatus structure of a server according to Embodiment 4 of the present invention.</li></ul></p><heading id="h0005"><b>DESCRIPTION OF EMBODIMENTS</b></heading><p id="p0025" num="0025">To make the objectives, technical solutions, and advantages of the present invention clearer, the following further describes the embodiments of the present invention in detail with reference to the accompanying drawings.</p><p id="p0026" num="0026">In a scenario in which an operator provides a pure-IPv6 access service for an access gateway device due to a lack of public IPv4 address resources, a translation technology of IPv6 transition technologies generally needs to be used to translate a transmitting packet, so as to meet a requirement of a user equipment for accessing to an IPv4 site on the Internet.<!-- EPO <DP n="8"> --></p><p id="p0027" num="0027">As a translation technology that is relatively widely used among the IPv6 transition technologies, 464XLAT is mainly formed by two parts: a CLAT (Customer Side Translator, customer side translator) and a PLAT (Provider Side Translator, provider side translator), and a network topology principle of 464XLAT is shown in <figref idrefs="f0001">FIG. 1</figref>.</p><p id="p0028" num="0028">The CLAL is deployed on an access gateway device; translates an IPv4 address header that is carried in an IPv4 packet sent by a user equipment into an IPv6 address header by using an SIIT (Stateless IP/ICMP Translation Algorithm, stateless IP/IMCP translation algorithm), so as to obtain an IPv6 packet; and sends the IPv6 packet to an IPv6 network. The PLAT is deployed on a network element node that is on a network side and has a NAT (Network Address Translation, Network Address Translation) 64 function; translates the IPv6 address header carried in the IPv6 packet into the IPv4 address header, so as to obtain the IPv4 packet; and sends the IPv4 packet to an IPv4 network and eventually to an IPv4 site, so as to implement IPv4 end-to-end communication that traverses a pure IPv6 network.</p><heading id="h0006"><b>Embodiment 1</b></heading><p id="p0029" num="0029">This embodiment of the present invention provides a packet transmission method, and as shown in <figref idrefs="f0001">FIG. 2</figref>, a process of the method provided in this embodiment includes:</p><p id="p0030" num="0030">201: Receive at least one first IPv4 packet sent by at least one user equipment, where each first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment.</p><p id="p0031" num="0031">202: Determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each first IPv4 packet.</p><p id="p0032" num="0032">203: Update the source port corresponding to each first IPv4 packet with the corresponding output port, and convert, according to a set algorithm, the IPv4 address carried in each first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet, where each first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port.</p><p id="p0033" num="0033">204: Transmit, to an IPv6 network, each first IPv6 packet by using the output port of each first IPv6 packet.</p><p id="p0034" num="0034">As an exemplary embodiment, before the receiving a first IPv4 packet sent by at least one user equipment, the method further includes:
<ul><li>starting a Dynamic Host Configuration Protocol DHCP service; and</li><li>allocating an IPv4 address to an accessed user equipment by using the DHCP service.</li></ul><!-- EPO <DP n="9"> --></p><p id="p0035" num="0035">As an exemplary embodiment, before the converting the IPv4 address carried in each first IPv4 packet into a same target global unicast IPv6 address, the method further includes:
<ul><li>acquiring an IPv6 prefix of a global unicast IPv6 address from an IPv6 network server; and</li><li>padding a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</li></ul></p><p id="p0036" num="0036">As an exemplary embodiment, after the transmitting, to an IPv6 network, each IPv4 packet by using the output port of each IPv6 packet, the method further includes:
<ul><li>receiving a second IPv6 packet sent by the IPv6 network, where the second IPv6 packet carries the target global unicast IPv6 address and an output port;</li><li>determining, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to the output port of the second IPv6 packet; and updating the output port of the second IPv6 packet with the corresponding source port, and updating the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet; and</li><li>sending, by using the source port corresponding to the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update.</li></ul></p><p id="p0037" num="0037">As an exemplary embodiment, the determining an output port corresponding to the source port of each first IPv4 packet includes:
<ul><li>determining, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each first IPv4 packet; or</li><li>randomly allocating a corresponding output port according to the source port of each first IPv4 packet, to obtain the output port corresponding to the source port of each first IPv4 packet.</li></ul></p><p id="p0038" num="0038">According to the method provided in this embodiment of the present invention, a first IPv4 packet that is sent by a user equipment and carries an IPv4 address and a source port that are allocated to each user equipment is received; an output port corresponding to the source port of each first IPv4 packet is determined; further, the source port corresponding to each first IPv4 packet is updated with the corresponding output port; the IPv4 address carried in each first IPv4 packet is converted into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet; and each first IPv6 packet is transmitted to an IPv6 network by using the output port of each first IPv6 packet. Because IPv4 addresses carried in received IPv4 packets sent by user equipments are converted into a same target unicast IPv6 address, resource consumption during packet transmission is reduced and packet transmission efficiency is improved.<!-- EPO <DP n="10"> --></p><heading id="h0007"><b>Embodiment 2</b></heading><p id="p0039" num="0039">This embodiment of the present invention provides a packet transmission method, and for ease of understanding, the packet transmission method provided in this embodiment of the present invention is described in detail with reference to the content of the foregoing Embodiment 1. Referring to <figref idrefs="f0002">FIG. 3</figref>, a process of the method provided in this embodiment includes:
<ul><li>301: Allocate an IPv4 address to an accessed user equipment.</li></ul></p><p id="p0040" num="0040">The user equipment is a mobile phone, a computer, or the like, and the user equipment is not specifically limited in this embodiment. Because a communication mode in an application scenario of 464XLAT is IPv4 end-to-end communication that traverses a pure IPv6 network, in order to implement, in the scenario of 464XLAT, access to an IPv4 site on the Internet by the accessed user equipment, in the method provided in this embodiment, the IPv4 address needs to be allocated to the accessed user equipment.</p><p id="p0041" num="0041">The IPv4 address allocated to the accessed user equipment is a private IPv4 address. Different from a public IPv4 address, the private IPv4 address belongs to a non-registered address, and cannot be used on the Internet but can be used on an internal local area network.</p><p id="p0042" num="0042">A manner of allocating an IPv4 address for an accessed user equipment includes but is not limited to:
<ul><li>starting a DHCP (Dynamic Host Configuration Protocol, Dynamic Host Configuration Protocol) service, and allocating the IPv4 address to the accessed user equipment by using the DHCP service.</li></ul></p><p id="p0043" num="0043">DHCP is a network protocol for a local area network and involves two parts: one is a router end, and the other is a user equipment end. The router end is responsible for managing all IP network data, and responsible for processing a DHCP requirement of the user equipment end; the user equipment end is responsible for receiving IP network data allocated by the router end. In order to allocate the IPv4 address to an accessed user equipment, the router end needs to prestore an IPv4 address set, where the IPv4 address set is generally formed by consecutive IPv4 addresses. Specifically, a manner of allocating an IPv4 address to an accessed user equipment by using a DHCP service includes but is not limited to the following three manners:</p><heading id="h0008">A first manner: a manual allocation manner</heading><p id="p0044" num="0044">In the first manner, a network administrator may set fixed IPv4 addresses to some particular user equipments. Because the IPv4 addresses do not expire and can be used permanently, the IPv4 addresses are static addresses.</p><heading id="h0009">A second manner: an automatic allocation manner</heading><!-- EPO <DP n="11"> --><p id="p0045" num="0045">In the second manner, after a user equipment successfully rents an IPv4 address from the router end for the first time, the user equipment can use the address permanently.</p><heading id="h0010">A third manner: a dynamic allocation manner</heading><p id="p0046" num="0046">In the third manner, although a user equipment rents an IPv4 address from the router end for the first time, the user equipment cannot use the IPv4 address permanently, and as long as a lease expires, the user equipment has to release the occupied IPv4 address, so that another user equipment can use this IPv4 address.</p><p id="p0047" num="0047">302: Obtain a target global unicast IPv6 address.</p><p id="p0048" num="0048">Unicasting is a one-to-one communication mode between a server and a user equipment, and a switch and a router on a network forward data but do not replicate data. The global unicast IPv6 address is an IPv6 address with a start address as 001, and this type of IP address is unique globally. For example, if an email address is a global unicast IPv6 address, no matter in which country in the world, when the global unicast IPv6 address corresponding to the email address is acquired in an address bar of a browser, the email can be accessed.</p><p id="p0049" num="0049">A manner of obtaining a target global unicast IPv6 address includes but is not limited to the following steps:
<ul><li>Step 1: Acquire an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server.</li></ul></p><p id="p0050" num="0050">A manner of obtaining an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server includes but is not limited to the following manner: a router configures a correct dial parameter and sends a dial request to an IPv6 network side; after receiving the dial request sent by the router, the IPv6 network side sends an IPv6 prefix of the global unicast IPv6 address to the router; and the router receives the IPv6 prefix of the global unicast IPv6 address sent by the IPv6 network side, and takes the received IPv6 prefix of the global unicast IPv6 address sent by the IPv6 network side as an acquired IPv6 prefix of the global unicast IPv6 address. The dial parameter is a network parameter, a network connection type, or the like, and content of the dial parameter is not specifically limited in this embodiment.</p><p id="p0051" num="0051">Further, different IPv6 network sides have different IPv6 prefixes of global unicast IPv6 addresses, and therefore, when a router is connected to different IPv6 networks, IPv6 prefixes of the global unicast IPv6 addresses acquired from IPv6 network sides by the router are also different. Specifically, if a prefix of IPv6 network a has 32 bits and a prefix of IPv6 network b has 40 bits, when a router is connected to IPv6 network a, an IPv6 prefix of the global unicast IPv6 address acquired from IPv6 network a by the router is the 32-bit IPv6 prefix; and when the router is connected to IPv6 network b, an IPv6 prefix of the global unicast IPv6 address acquired from IPv6 network b by the router is the 40-bit IPv6 prefix.<!-- EPO <DP n="12"> --></p><p id="p0052" num="0052">Certainly, in addition to the foregoing IPv6 network side that affects acquisition of an IPv6 prefix of the global unicast IPv6 address by a router, a manner in which the router is connected to an IPv6 network also affects the acquisition, from the IPv6 network side, of the IPv6 prefix of the global unicast IPv6 address by the router. A manner in which a router is connected to a network includes but is not limited to: being connected to the IPv6 network by using manners, such as Ethernet, LTE (Long Term Evolution, Long Term Evolution), 3GPP (3rd Generation Partnership Project, 3rd Generation Partnership Project), 3GPP2 (3rd Generation Partnership Project 2, 3rd Generation Partnership Project 2), or Wi-Fi. When the router is connected to the IPv6 network in different manners, manners of acquiring prefixes of global unicast IPv6 addresses from the IPv6 network side by the router are different. For example, when the router is connected to the IPv6 network in an LTE manner, the router acquires the IPv6 prefix of the global unicast IPv6 address in a manner of PDN (Packet Data Network, packet data network) activation; and when the router is connected to the IPv6 network in an Ethernet manner, the router acquires the IPv6 prefix of the global unicast IPv6 address in a manner, such as SLAAC (Stateless Address Auto Configuration, stateless address auto Configuration) or DHCPv6.</p><p id="p0053" num="0053">Step 2: Pad a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</p><p id="p0054" num="0054">For step 2, a legal quantity of bits of a global unicast IPv6 address is 128; therefore, in order to obtain a legal global unicast IPv6 address, after the IPv6 prefix of the global unicast IPv6 address is acquired, the user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address is padded, so as to obtain the target global unicast IPv6 address. Specifically, when the user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address is padded, the following steps may be used:</p><p id="p0055" num="0055">First, a quantity of bits of the user-defined suffix that needs to be padded is determined according to a quantity of bits of the acquired IPv6 prefix of the global unicast IPv6 address. For ease of understanding, Table 1 is used as an example in the following for description.<!-- EPO <DP n="13"> -->
<tables id="tabl0001" num="0001"><img id="ib0001" file="imgb0001.tif" wi="153" he="69" img-content="table" img-format="tif"/></tables></p><p id="p0056" num="0056">In Table 1, Prefix represents the IPv6 prefix of the global unicast IPv6 address acquired from the network side, and Suffix represents the padded suffix, where the suffix is padded in a hexadecimal manner. It can be seen from Table 1 that, if the IPv6 prefix of the global unicast IPv6 address acquired from the IPv6 network side is Prefix=2014::/32, that is, a length of the IPv6 prefix of the global unicast IPv6 address acquired from the IPv6 network side is 32 bits, a 96-bit suffix following the acquired 32-bit IPv6 prefix of the global unicast IPv6 address needs to be padded, that is, the padded suffix is Suffix=1111:2222:3333:4444:5555:6666, thereby ensuring that an obtained IPv6 address of a global unicast IPv6 address is a legal IPv6 address; if the IPv6 prefix of the global unicast IPv6 address acquired from the IPv6 network side is Prefix=2014::/56, that is, a length of the IPv6 prefix of the global unicast IPv6 address acquired from the IPv6 network side is 56 bits, a 72-bit suffix following the acquired 56-bit IPv6 prefix of the global unicast IPv6 address needs to be padded, that is, the padded suffix is Suffix=11:2222:3333:4444:5555, thereby ensuring that an obtained global unicast IPv6 address is a legal IPv6 address.</p><p id="p0057" num="0057">Second, content of the user-defined suffix is determined. A manner of determining content of a user-defined suffix includes but is not limited to: performing determining according to a current network environment. During specific implementation, the content of the suffix following the acquired IPv6 prefix of the global unicast IPv6 address may be randomly filled in; any suffix is acceptable as long as it ensures that the obtained global unicast IPv6 address meets a networking requirement of a current network.</p><p id="p0058" num="0058">It should be noted that steps 301 and 302 are not executed every time a packet is transmitted; the foregoing steps 301 and 302 may be executed when a packet is transmitted for the first time, and when another packet is transmitted, the IPv4 address allocated to the accessed user equipment in the foregoing step 301 and the global unicast IPv6 address obtained in 302 may be directly used. Certainly, if the foregoing IPv4 address<!-- EPO <DP n="14"> --> allocated to the accessed user equipment and the obtained global unicast IPv6 address are updated, the foregoing steps 301 and 302 can be executed again, and a quantity of times steps 301 and 302 are executed is not limited in this embodiment.</p><p id="p0059" num="0059">303: Receive at least one first IPv4 packet sent by at least one user equipment.</p><p id="p0060" num="0060">At a moment, a user equipment needs to access an IPv4 site on the Internet due to a service requirement, in this case, the user equipment sends a first IPv4 packet to a router, so that the router may send, by means of subsequent steps and after receiving the first IPv4 packet sent by the user equipment, the IPv4 packet sent by the user equipment to the IPv4 site that is on the Internet and needs to be accessed.</p><p id="p0061" num="0061">Information carried in the first IPv4 packet includes but is not limited to a data length, a used protocol, a destination IP address, an IPv4 address and a source port that are allocated to each user equipment, and the like, and the information carried in the first IPv4 packet is not specifically limited in this embodiment.</p><p id="p0062" num="0062">It should be noted that information carried in first IPv4 packets sent by each user equipment is different, and a difference in the information carried in the first IPv4 packets leads to a difference in source ports that are applicable in a transmission process; therefore, the source ports carried in the first IPv4 packets sent by user equipments are different.</p><p id="p0063" num="0063">304: Determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to a source port of each first IPv4 packet.</p><p id="p0064" num="0064">In order to avoid an address mapping error in a return packet, in the method provided in this embodiment, after the at least one first IPv4 packet sent by the at least one user equipment is received, the output port corresponding to the source port of each first IPv4 packet needs to be determined.</p><p id="p0065" num="0065">Specifically, a manner of determining an output port corresponding to a source port of each first IPv4 packet includes but is not limited to the following two manners:</p><p id="p0066" num="0066">A first manner: Determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to a source port of each first IPv4 packet.</p><p id="p0067" num="0067">For the first manner, after the first IPv4 packet that carries a source port and sent by the at least one user equipment is received, the output port corresponding to the source port of each first IPv4 packet may be determined according to the preset correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet.</p><p id="p0068" num="0068">A second manner: Randomly allocate a corresponding output port according to a source port of each first IPv4 packet, to obtain an output port corresponding to the source port of each first IPv4 packet.<!-- EPO <DP n="15"> --></p><p id="p0069" num="0069">For the second manner, after the first IPv4 packet that carries a source port and sent by the at least one user equipment is received, the output port may be randomly allocated to the source port of each first IPv4 packet according to a usage condition of an output port, and further, the output port randomly allocated to the source port of each first IPv4 packet is used as the output port corresponding to the source port of each first IPv4 packet. Specifically, by using an example in which there are ten output ports and there are five received first IPv4 packets carrying source ports, if the current output ports are not in use, five output ports may be randomly selected from the ten output ports and be allocated to the five received first IPv4 packets, and further, each output port allocated to each first IPv4 packet is used as the output port corresponding to the source port of each first IPv4 packet; and if two of the current output ports are used, five output ports may be randomly selected from the remaining eight output ports and be allocated to the five received first IPv4 packets, and further, each output port allocated to each first IPv4 packet is used as the output port corresponding to the source port of each first IPv4 packet.</p><p id="p0070" num="0070">Further, because a source port of each first IPv4 packet is corresponding to one output port, and each first IPv4 packet carries an IPv4 address, by using the foregoing process of determining an output port corresponding to a source port of each first IPv4 packet, a correspondence between a source port and an output port that are of each first IPv4 packet may be obtained. Because the correspondence between a source port and an output port that are of each first IPv4 packet may continue to be used in a following packet transmission process, in the method provided in this embodiment, after the output port corresponding to the source port of each first IPv4 packet is determined, a step of storing a correspondence among an IPv4 address, a source port, and an output port that are of each first IPv4 packet is further executed. Specifically, a manner of storing a correspondence among an IPv4 address, a source port, and an output port that are of each first IPv4 packet includes but is not limited to: storing the correspondence among an IPv4 address, a source port, and an output port that are of each first IPv4 packet in a corresponding storage medium such as a memory or a flash memory.</p><p id="p0071" num="0071">Preferably, for ease of transmitting, in the following steps, a packet according to the obtained correspondence among an IPv4 address, a source port, and an output port that are of each IPv4 packet, when a corresponding output port is determined for a source port of each IPv4 packet, different port numbers may be set for a source port and an output port of each IPv4 packet.</p><p id="p0072" num="0072">For the foregoing process, for ease of understanding, the following describes in detail by using a specific example.</p><p id="p0073" num="0073"><figref idrefs="f0003">FIG. 4</figref> is a schematic diagram of a correspondence among an IPv4 address, a source port, and an output port, and user equipments sending first IPv4 packets are a mobile phone and a desktop computer. If a<!-- EPO <DP n="16"> --> first IPv4 packet sent by the mobile phone is first IPv4 packet 1, an IPv4 address carried in first IPv4 packet 1 is 192.168.1.200, a first IPv4 packet sent by the desktop computer is first IPv4 packet 2, and an IPv4 address carried in first IPv4 packet 2 is 192.168.1.100, when port numbers are set for source ports and output ports that are corresponding to the IPv4 addresses, a port number 2000 may be set for the source port corresponding to the IPv4 address 192.168.1.200 of the mobile phone, and a port number 10001 may be set for the corresponding output port; and a port number 1000 may be set for the source port corresponding to the IPv4 address 192.168.100 of the desktop computer, and a port number 10000 may be set for the corresponding output port.</p><p id="p0074" num="0074">Further, according to the correspondence among an IPv4 address, a source port, and an output port that are of each IPv4 packet, in an entire packet transmission process, not only may a corresponding output port be determined according to a source port of each first IPv4 packet, but also a source port of each first IPv4 packet may be determined according to an output port, so as to determine a corresponding IPv4 address.</p><p id="p0075" num="0075">For ease of understanding, the following gives descriptions still by using the example of the foregoing set correspondence among an IPv4 address, a corresponding source port number, and a corresponding output port number that are of the mobile phone.</p><p id="p0076" num="0076">If that the IPv4 address of the mobile phone is 192.168.1.200 is known, according to each obtained correspondence among an IPv4 address, a source port number, and an output port number, it may be determined that the source port number corresponding to the IPv4 address 192.168.1.200 of the mobile phone is 2000, and the corresponding output port number is 10001; if that the output port number is 10001 is known, according to the correspondence among an IPv4 address, a source port number, and an output port number that are of the mobile phone, it may be determined that the source port number corresponding to the output port number 10001 is 2000, and the corresponding IPv4 address is 192.168.1.200.</p><p id="p0077" num="0077">305: Update the source port corresponding to each first IPv4 packet with the corresponding output port, and convert, according to a set algorithm, the IPv4 address carried in each first IPv4 packet into the same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 address.</p><p id="p0078" num="0078">Because in the foregoing step 304, the output port corresponding to the source port of each first IPv4 packet is determined, in this step, based on the foregoing step 304, the source port corresponding to each first IPv4 packet is updated with the corresponding output port.</p><p id="p0079" num="0079">Further, in order to implement that the received first IPv4 packet of each user equipment is sent, across an IPv6 network, to the IPv4 site on the Internet, and that a resource consumed when the IPv4 address carried in the received first IPv4 packet of each user equipment is converted into an IPv6 address is reduced, in<!-- EPO <DP n="17"> --> an application scenario in this embodiment, the IPv4 address carried in each received first IPv4 packet is converted into the same target global unicast IPv6 address according to the set algorithm, so as to obtain the first IPv6 packet corresponding to each first IPv4 packet. A manner of setting an algorithm is not specifically limited in this embodiment, and any algorithm is acceptable as long as it can implement that during specific implementation, the IPv4 address carried in each first IPv4 packet is converted into the same target global unicast IPv6 address. Information carried in each first IPv6 packet includes but is not limited to an IPv6 address obtained after the conversion, an output port corresponding to a source port of a first IPv4 packet corresponding to a first IPv6 packet, and the like.</p><p id="p0080" num="0080">For the foregoing process, for ease of understanding, the following describes in detail by using a specific example.</p><p id="p0081" num="0081">For example, the target global unicast IPv6 address is 2014::1111:2222, and if there are two received first IPv4 packets, that is, first IPv4 packet 1 and first IPv4 packet 2 separately, where an IPv4 address carried in first IPv4 packet 1 is 192.168.1.100, and an IPv4 address carried in first IPv4 packet 2 is 192.168.1.200, received first IPv4 packet 1 and first IPv4 packet 2 may be converted into the same global unicast IPv6 address 2014::1111:2222.</p><p id="p0082" num="0082">306: Transmit, to an IPv6 network, each first IPv6 packet by using the output port of each first IPv6 packet.</p><p id="p0083" num="0083">In the foregoing step 305, each first IPv4 packet is converted into an IPv6 packet, and each first IPv6 packet carries an output port; therefore, in order to implement IPv4 end-to-end communication that traverses a pure IPv6 network, in this step, each first IPv6 packet is transmitted to the IPv6 network by using the output port of each first IPv6 packet.</p><p id="p0084" num="0084">Further, by using the foregoing packet transmission process, the first IPv4 packet sent by each user equipment is translated into the corresponding first IPv6 packet, and transmission is performed by using the IPv6 network, thereby implementing a process of sending an IPv4 packet, and for a specific process of receiving an IPv4 packet, reference may be made to the subsequent steps.</p><p id="p0085" num="0085">307: Receive a second IPv6 packet sent by the IPv6 network.</p><p id="p0086" num="0086">In order to implement IPv4 end-to-end communication that traverses a pure IPv6 network, after receiving each first IPv6 packet, the IPv6 network sends each received first IPv6 packet to a network node; and after translation on a network side, each first IPv6 packet is translated into a corresponding IPv4 packet, and then the IPv4 packet is sent to the IPv4 site on the Internet. After receiving the corresponding IPv4 packet that is translated from each first IPv6 packet, the IPv4 site on the Internet generates a return IPv4 packet according<!-- EPO <DP n="18"> --> to the corresponding IPv4 packet that is translated from each received first IPv6 packet, where the return IPv4 packet is transmitted to the foregoing network node by using an IPv4 network on the Internet, and then is translated on the network side to generate the corresponding second IPv6 packet. Information carried in the second IPv6 packet includes but is not limited to a target global unicast IPv6 address and an output port. The second IPv6 packet is sent, by using the IPv6 network, to an output port that sends the corresponding first IPv6 packet.</p><p id="p0087" num="0087">Further, after the second IPv6 packet is generated, the IPv6 network sends the generated second IPv6 packet to a location indicated by the address carried in the second IPv6 packet. Although addresses carried in all the second IPv6 packets are the same and are the target global unicast IPv6 address, the second IPv4 packets are received at different output ports because output ports carried in all the second IPv6 packets are different.</p><p id="p0088" num="0088">308: Determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to an output port of the second IPv6 packet; and update the output port of the second IPv6 packet with the corresponding source port, and update an IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet.</p><p id="p0089" num="0089">Because the correspondence among an IPv4 address, a source port, and an output port is prestored, after the output port receives the second IPv6 packet sent by the IPv6 network, the corresponding source port is determined according to the prestored correspondence between a source port of an IPv4 packet and an output port; and further, the output port of the second IPv6 packet is updated with the corresponding source port, and the IPv6 address carried in the second IPv6 packet is updated with the corresponding IPv4 address, so as to obtain the second IPv4 packet corresponding to the second IPv6 packet. Information carried in the second IPv4 packet includes but is not limited to the IPv4 address obtained after the conversion, and the like.</p><p id="p0090" num="0090">309: Send, by using the source port corresponding to the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update.</p><p id="p0091" num="0091">According to the prestored correspondence among an IPv4 address, a source port, and an output port, after the IPv6 address carried in the second IPv6 packet is updated with the corresponding IPv4 address to obtain the second IPv4 packet corresponding to the second IPv6 packet, the second IPv4 packet may be sent, by using the source port corresponding to the second IPv4 packet, to the user equipment corresponding to the IPv4 address obtained after the update, thereby implementing IPv4 end-to-end communication that traverses a pure IPv6 network.<!-- EPO <DP n="19"> --></p><p id="p0092" num="0092">It should be noted that because upgrade applications that carried by a router itself are developed based on a public IPv4, and in an existing scenario of 464XLAT, the router cannot be connected to the public IPv4, these applications on the router cannot be upgraded, which causes that these applications cannot work normally on the router, thereby affecting packet transmission. In order to resolve an upgrade problem of an application that carried by a router itself, in the method provided in this embodiment, a virtual IPv4 public address is further set for the router. The virtual IPv4 address may be converted into the target global unicast IPv6 address, and may access the IPv4 site on the Internet by means of the foregoing packet transmission process, so as to enable the application on the router to be upgraded normally. A method for setting a virtual IPv4 public address is not specifically limited in this embodiment, and any address is acceptable as long as it ensures, during specific implementation, that the generated virtual IPv4 public address is a legal address.</p><p id="p0093" num="0093">According to the method provided in this embodiment of the present invention, a first IPv4 packet that is sent by a user equipment and carries an IPv4 address and a source port that are allocated to each user equipment is received; an output port corresponding to the source port of each first IPv4 packet is determined; further, the source port corresponding to each first IPv4 packet is updated with the corresponding output port; the IPv4 address carried in each first IPv4 packet is converted into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet; and each first IPv6 packet is transmitted to an IPv6 network by using the output port of each first IPv6 packet. Because IPv4 addresses carried in received IPv4 packets sent by user equipments are converted into a same target unicast IPv6 address, resource consumption during packet transmission is reduced and packet transmission efficiency is improved.</p><heading id="h0011"><b>Embodiment 3</b></heading><p id="p0094" num="0094">Referring to <figref idrefs="f0003">FIG. 5</figref>, this embodiment of the present invention provides a packet transmission apparatus, where the apparatus includes:
<ul><li>a first receiving module 501, configured to control a receiver to receive at least one first IPv4 packet sent by at least one user equipment, where each first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment;</li><li>a first determining module 502, configured to control a processor to determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each first IPv4 packet;</li><li>a first updating module 503, configured to control the processor to update the source port corresponding to each first IPv4 packet with the corresponding output port;<!-- EPO <DP n="20"> --></li><li>a conversion module 504, configured to control the processor to convert, according to a set algorithm, the IPv4 address carried in each first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet, where each first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and</li><li>a first sending module 505, configured to control a transmitter to transmit, to an IPv6 network, each first IPv6 packet by using the output port corresponding to each first IPv6 packet.</li></ul></p><p id="p0095" num="0095">Referring to <figref idrefs="f0004">FIG. 6</figref>, the apparatus further includes:
<ul><li>a starting module 506, configured to control the processor to start a Dynamic Host Configuration Protocol DHCP service; and</li><li>an allocation module 507, configured to control the processor to allocate an IPv4 address to an accessed user equipment by using the DHCP service.</li></ul></p><p id="p0096" num="0096">Referring to <figref idrefs="f0005">FIG. 7</figref>, the apparatus further includes:
<ul><li>an acquiring module 508, configured to control the processor to acquire an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and</li><li>a padding module 509, configured to control the processor to pad a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</li></ul></p><p id="p0097" num="0097">Referring to <figref idrefs="f0006">FIG. 8</figref>, the apparatus further includes:
<ul><li>a second receiving module 510, configured to control the receiver to receive a second IPv6 packet sent by the IPv6 network, where the second IPv6 packet carries the target global unicast IPv6 address and an output port;</li><li>a second determining module 511, configured to control the processor to determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to the output port of the second IPv6 packet;</li><li>a second updating module 512, configured to control the processor to update the output port of the second IPv6 packet with the corresponding source port, and update the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet; and</li><li>a second sending module 513, configured to control the transmitter to send, by using the source port of the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update.</li></ul></p><p id="p0098" num="0098">As an exemplary embodiment, the first determining module 502 is configured to control the<!-- EPO <DP n="21"> --> processor to determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each first IPv4 packet; or randomly allocate a corresponding output port according to the source port of each first IPv4 packet, to obtain the output port corresponding to the source port of each first IPv4 packet.</p><p id="p0099" num="0099">In conclusion, according to the apparatus provided in this embodiment of the present invention, a first IPv4 packet that is sent by a user equipment and carries an IPv4 address and a source port that are allocated to each user equipment is received; an output port corresponding to the source port of each first IPv4 packet is determined; further, the source port corresponding to each first IPv4 packet is updated with the corresponding output port; the IPv4 address carried in each first IPv4 packet is converted into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet; and each first IPv6 packet is transmitted to an IPv6 network by using the output port of each first IPv6 packet. Because IPv4 addresses carried in received IPv4 packets sent by user equipments are converted into a same target unicast IPv6 address, resource consumption during packet transmission is reduced and packet transmission efficiency is improved.</p><heading id="h0012"><b>Embodiment 4</b></heading><p id="p0100" num="0100"><figref idrefs="f0007">FIG. 9</figref> is a schematic structural diagram of a server in one implementation manner, where the server includes: a processor 1001, a transmitter 902, and a receiver 903,the receiver 903 is configured to receive at least one first IPv4 packet sent by at least one user equipment, where each first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment;<br/>
the processor 901 is configured to: determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each first IPv4 packet; update the source port corresponding to each first IPv4 packet with the corresponding output port; and convert, according to a set algorithm, the IPv4 address carried in each first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet, where each first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and<br/>
the transmitter 902 is configured to transmit, to an IPv6 network, each first IPv6 packet by using the output port corresponding to each first IPv6 packet.</p><p id="p0101" num="0101">As an exemplary embodiment, the processor 901 is further configured to: start a Dynamic Host Configuration Protocol DHCP service; and allocate an IPv4 address to an accessed user equipment by using<!-- EPO <DP n="22"> --> the DHCP service.</p><p id="p0102" num="0102">As an exemplary embodiment, the processor 901 is further configured to: acquire an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and pad a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</p><p id="p0103" num="0103">As an exemplary embodiment, the receiver 903 is further configured to receive a second IPv6 packet sent by the IPv6 network, where the second IPv6 packet carries the target global unicast IPv6 address;<br/>
the transmitter 902 is further configured to send, by using the source port corresponding to the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update; and<br/>
the processor 901 is further configured to: determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to an output port of the second IPv6 packet; and update the output port of the second IPv6 packet with the corresponding source port, and update the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet.</p><p id="p0104" num="0104">As an exemplary embodiment, the processor 901 is configured to: determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each first IPv4 packet; or randomly allocate a corresponding output port according to the source port of each first IPv4 packet, to obtain the output port corresponding to the source port of each first IPv4 packet.</p><p id="p0105" num="0105">According to the server provided in this embodiment of the present invention, a first IPv4 packet that is sent by a user equipment and carries an IPv4 address and a source port that are allocated to each user equipment is received; an output port corresponding to the source port of each first IPv4 packet is determined; further, the source port corresponding to each first IPv4 packet is updated with the corresponding output port; the IPv4 address carried in each first IPv4 packet is converted into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each first IPv4 packet; and each first IPv6 packet is transmitted to an IPv6 network by using the output port of each first IPv6 packet. Because IPv4 addresses carried in received IPv4 packets sent by user equipments are converted into a same target unicast IPv6 address, resource consumption during packet transmission is reduced and packet transmission efficiency is improved.</p><p id="p0106" num="0106">It should be noted that during data transmission by a network side device and a terminal provided in the foregoing embodiments, description is given only using division of the foregoing functional modules. In practice, the functions may be allocated to different functional modules for implementation as required. That is,<!-- EPO <DP n="23"> --> internal structures of the network side device and the terminal are divided into different functional modules to implement all or part of the functions described above. In addition, the network side device, the terminal, and the data transmission system provided in the foregoing embodiments are based on the same inventive concept as the data transmission methods in the embodiments. For specific implementation processes of the foregoing embodiment, reference may be made to the method embodiments, and details are not described herein again.</p><p id="p0107" num="0107">The sequence numbers of the preceding embodiments of the present invention are only for ease of description, but do not denote the preference of the embodiments.</p><p id="p0108" num="0108">A person of ordinary skill in the art may understand that all or a part of the steps of the embodiments may be implemented by hardware or a program instructing related hardware. The program may be stored in a computer-readable storage medium. The storage medium may include: a read-only memory, a magnetic disk, or an optical disc.</p><p id="p0109" num="0109">The foregoing descriptions are merely exemplary embodiments of the present invention, but are not intended to limit the present invention. Any modification, equivalent replacement, and improvement made without departing from the spirit and principle of the present invention shall fall within the protection scope of the present invention.</p></description><claims mxw-id="PCLM90459583" lang="EN" load-source="patent-office"><!-- EPO <DP n="24"> --><claim id="c-en-0001" num="0001"><claim-text>A packet transmission method, wherein the method comprises:
<claim-text>receiving at least one first IPv4 packet sent by at least one user equipment, wherein each of the first IPv4 packet carries an IPv4 address and a source port that are allocated to a user equipment;</claim-text>
<claim-text>determining, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each of the first IPv4 packet;</claim-text>
<claim-text>updating the source port corresponding to each of the first IPv4 packet with the corresponding output port;</claim-text>
<claim-text>converting, according to a set algorithm, the IPv4 address carried in each of the first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each of the first IPv4 packet, wherein each of the first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and</claim-text>
<claim-text>transmitting, to an IPv6 network, each of the first IPv6 packet by using the output port of each of the first IPv6 packet.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, before the receiving a first IPv4 packet sent by at least one user equipment, further comprising:
<claim-text>starting a Dynamic Host Configuration Protocol DHCP service; and</claim-text>
<claim-text>allocating an IPv4 address to an accessed user equipment by using the DHCP service.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 1, before the converting the IPv4 address carried in each of the first IPv4 packet into a same target global unicast IPv6 address, further comprising:
<claim-text>acquiring an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and</claim-text>
<claim-text>padding a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to claim 1, after the transmitting, to an IPv6 network, each of the first IPv6 packet by using the output port of each of the first IPv6 packet, further comprising:
<claim-text>receiving a second IPv6 packet sent by the IPv6 network, wherein the second IPv6 packet carries the target global unicast IPv6 address and an output port;</claim-text>
<claim-text>determining, according to the correspondence between a source port of an IPv4 packet and an output port<!-- EPO <DP n="25"> --> of an IPv6 packet, a source port corresponding to the output port of the second IPv6 packet; and updating the output port of the second IPv6 packet with the corresponding source port, and updating the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet; and</claim-text>
<claim-text>sending, by using the source port of the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to claim 1, wherein the determining an output port corresponding to the source port of each of the first IPv4 packet comprises:
<claim-text>determining, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each of the first IPv4 packet; or</claim-text>
<claim-text>randomly allocating a corresponding output port according to the source port of each of the first IPv4 packet, to obtain the output port corresponding to the source port of each of the first IPv4 packet.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A packet transmission apparatus, wherein the apparatus comprises:
<claim-text>a first receiving module, configured to control a receiver to receive at least one first IPv4 packet sent by at least one user equipment, wherein each of the first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment;</claim-text>
<claim-text>a first determining module, configured to control a processor to determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each of the first IPv4 packet;</claim-text>
<claim-text>a first updating module, configured to control the processor to update the source port corresponding to each of the first IPv4 packet with the corresponding output port;</claim-text>
<claim-text>a conversion module, configured to control the processor to convert, according to a set algorithm, the IPv4 address carried in each of the first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each of the first IPv4 packet, wherein each of the first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and</claim-text>
<claim-text>a first sending module, configured to control a transmitter to transmit, to an IPv6 network, each of the first IPv6 packet by using the output port corresponding to each of the first IPv6 packet.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The apparatus according to claim 6, wherein the apparatus further comprises:
<claim-text>a starting module, configured to control the processor to start a Dynamic Host Configuration Protocol DHCP service; and</claim-text>
<claim-text>an allocation module, configured to control the processor to allocate an IPv4 address to an accessed user<!-- EPO <DP n="26"> --> equipment by using the DHCP service.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The apparatus according to claim 6, wherein the apparatus further comprises:
<claim-text>an acquiring module, configured to control the processor to acquire an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and</claim-text>
<claim-text>a padding module, configured to control the processor to pad a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The apparatus according to claim 6, wherein the apparatus further comprises:
<claim-text>a second receiving module, configured to control the receiver to receive a second IPv6 packet sent by the IPv6 network, wherein the second IPv6 packet carries the target global unicast IPv6 address and an output port;</claim-text>
<claim-text>a second determining module, configured to control the processor to determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to the output port of the second IPv6 packet;</claim-text>
<claim-text>a second updating module, configured to control the processor to update the output port of the second IPv6 packet with the corresponding source port, and update the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet; and</claim-text>
<claim-text>a second sending module, configured to control the transmitter to send, by using the source port of the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The apparatus according to claim 9, wherein the first determining module is configured to control the processor to determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each of the first IPv4 packet; or randomly allocate a corresponding output port according to the source port of each of the first IPv4 packet, to obtain the output port corresponding to the source port of each of the first IPv4 packet.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>A server, wherein the server comprises: a processor, a transmitter, and a receiver, wherein:
<claim-text>the receiver is configured to receive at least one first IPv4 packet sent by at least one user equipment, wherein each of the first IPv4 packet carries an IPv4 address and a source port that are allocated to each user equipment;</claim-text>
<claim-text>the processor is configured to: determine, according to a correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, an output port corresponding to the source port of each of the first<!-- EPO <DP n="27"> --> IPv4 packet; update the source port corresponding to each of the first IPv4 packet with the corresponding output port; and convert, according to a set algorithm, the IPv4 address carried in each of the first IPv4 packet into a same target global unicast IPv6 address, to obtain a first IPv6 packet corresponding to each of the first IPv4 packet, wherein each of the first IPv6 packet carries the IPv6 address obtained after the conversion and the output port corresponding to the source port; and</claim-text>
<claim-text>the transmitter is configured to transmit, to an IPv6 network, each of the first IPv6 packet by using the output port of each of the first IPv6 packet.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The server according to claim 11, wherein the processor is further configured to: start a Dynamic Host Configuration Protocol DHCP service; and allocate an IPv4 address to an accessed user equipment by using the DHCP service.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The server according to claim 11, wherein the processor is further configured to: acquire an IPv6 prefix of the global unicast IPv6 address from an IPv6 network server; and pad a user-defined suffix following the acquired IPv6 prefix of the global unicast IPv6 address, to obtain the target global unicast IPv6 address.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The server according to claim 11, wherein the receiver is further configured to receive a second IPv6 packet sent by the IPv6 network, wherein the second IPv6 packet carries the target global unicast IPv6 address and an output port;<br/>
the transmitter is further configured to send, by using the source port of the second IPv4 packet, the second IPv4 packet to a user equipment corresponding to the IPv4 address obtained after the update; and<br/>
the processor is further configured to: determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, a source port corresponding to the output port of the second IPv6 packet; and update the output port of the second IPv6 packet with the corresponding source port, and update the IPv6 address carried in the second IPv6 packet with a corresponding IPv4 address, to obtain a second IPv4 packet corresponding to the second IPv6 packet.</claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The server according to claim 11, wherein the processor is configured to: determine, according to the correspondence between a source port of an IPv4 packet and an output port of an IPv6 packet, the output port corresponding to the source port of each of the first IPv4 packet; or randomly allocate a corresponding output port according to the source port of each of the first IPv4 packet, to obtain output corresponding to the source port of each of the first IPv4 packet.</claim-text></claim></claims><drawings mxw-id="PDW20422305" load-source="patent-office"><!-- EPO <DP n="28"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="208" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="29"> --><figure id="f0002" num="3"><img id="if0002" file="imgf0002.tif" wi="165" he="197" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="30"> --><figure id="f0003" num="4,5"><img id="if0003" file="imgf0003.tif" wi="165" he="203" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0004" num="6"><img id="if0004" file="imgf0004.tif" wi="102" he="156" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0005" num="7"><img id="if0005" file="imgf0005.tif" wi="102" he="176" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0006" num="8"><img id="if0006" file="imgf0006.tif" wi="113" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0007" num="9"><img id="if0007" file="imgf0007.tif" wi="75" he="88" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="230" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="165" he="230" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
