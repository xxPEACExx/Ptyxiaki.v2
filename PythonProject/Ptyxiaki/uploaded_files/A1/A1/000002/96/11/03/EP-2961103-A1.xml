<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961103-A1" country="EP" doc-number="2961103" kind="A1" date="20151230" family-id="53513963" file-reference-id="312929" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451578" ucid="EP-2961103-A1"><document-id><country>EP</country><doc-number>2961103</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-15173346-A" is-representative="YES"><document-id mxw-id="PAPP193866124" load-source="docdb" format="epo"><country>EP</country><doc-number>15173346</doc-number><kind>A</kind><date>20150623</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193866125" load-source="patent-office" format="original"><country>EP</country><doc-number>15173346.6</doc-number><date>20150623</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162030857" ucid="CN-201410284262-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201410284262</doc-number><kind>A</kind><date>20140623</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1988520228" load-source="docdb">H04L  12/26        20060101AFI20151019BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988525935" load-source="docdb">H04L  12/715       20130101ALI20151019BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988526319" load-source="docdb">H04L  12/721       20130101ALI20151019BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1833755378" load-source="docdb" scheme="CPC">H04L  45/64        20130101 LI20170328BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833755379" load-source="docdb" scheme="CPC">H04L  45/42        20130101 LI20170328BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833755380" load-source="docdb" scheme="CPC">H04L  45/38        20130101 LA20170328BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833755381" load-source="docdb" scheme="CPC">H04L  43/10        20130101 LI20170328BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833755382" load-source="docdb" scheme="CPC">H04L  43/0852      20130101 LI20170328BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1833755383" load-source="docdb" scheme="CPC">H04L  43/00        20130101 LI20170328BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984701293" load-source="docdb" scheme="CPC">H04L  45/74        20130101 FI20151224BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984702463" load-source="docdb" scheme="CPC">H04L  47/286       20130101 LI20151224BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984702711" load-source="docdb" scheme="CPC">H04L  45/02        20130101 LI20151224BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165546200" lang="DE" load-source="patent-office">VERFAHREN, VORRICHTUNG UND SYSTEM ZUR BESTIMMUNG DER ÜBERTRAGUNGSSTRECKE VON PAKETEN</invention-title><invention-title mxw-id="PT165546201" lang="EN" load-source="patent-office">METHOD, APPARATUS AND SYSTEM FOR DETERMINING TRANSMISSION PATH OF PACKET</invention-title><invention-title mxw-id="PT165546202" lang="FR" load-source="patent-office">PROCÉDÉ, APPAREIL ET SYSTÈME DE DÉTERMINATION DE TRAJET DE TRANSMISSION DE PAQUET</invention-title><citations><patent-citations><patcit mxw-id="PCIT389722134" load-source="docdb" ucid="EP-2819356-A1"><document-id format="epo"><country>EP</country><doc-number>2819356</doc-number><kind>A1</kind><date>20141231</date></document-id><sources><source name="SEA" category="IP" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335739008" load-source="docdb" ucid="WO-2013184846-A1"><document-id format="epo"><country>WO</country><doc-number>2013184846</doc-number><kind>A1</kind><date>20131212</date></document-id><sources><source name="SEA" category="I" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>None</text><sources><source mxw-id="PNPL62805535" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR1103326318" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI TECH CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103311786" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI TECHNOLOGIES CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101642867" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Technologies Co., Ltd.</last-name><iid>100970540</iid><address><street>Huawei Administration Building Bantian</street><city>LONGGANG DISTRICT SHENZHEN, GUANGDONG 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103316322" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>LI YING</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103339505" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>LI, YING</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651716" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>LI, YING</last-name><address><street>Huawei Administration Building, Bantian, Longgang District</street><city>Shenzhen Guangdong 51812</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103318340" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>HUANG ZHENGQUAN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103312522" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>HUANG, ZHENGQUAN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101647159" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>HUANG, ZHENGQUAN</last-name><address><street>Huawei Administration Building, Bantian, Longgang District</street><city>Shenzhen Guangdong 51812</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101641961" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Thun, Clemens</last-name><suffix>et al</suffix><iid>101429838</iid><address><street>Mitscherlich PartmbB Patent- und Rechtsanwälte Sonnenstrasse 33</street><city>80331 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS660695373" load-source="docdb">AL</country><country mxw-id="DS660612312" load-source="docdb">AT</country><country mxw-id="DS660695383" load-source="docdb">BE</country><country mxw-id="DS660687579" load-source="docdb">BG</country><country mxw-id="DS660784010" load-source="docdb">CH</country><country mxw-id="DS660687867" load-source="docdb">CY</country><country mxw-id="DS660612313" load-source="docdb">CZ</country><country mxw-id="DS660689453" load-source="docdb">DE</country><country mxw-id="DS660695384" load-source="docdb">DK</country><country mxw-id="DS660687868" load-source="docdb">EE</country><country mxw-id="DS660607696" load-source="docdb">ES</country><country mxw-id="DS660687580" load-source="docdb">FI</country><country mxw-id="DS660687581" load-source="docdb">FR</country><country mxw-id="DS660689454" load-source="docdb">GB</country><country mxw-id="DS660695385" load-source="docdb">GR</country><country mxw-id="DS660695386" load-source="docdb">HR</country><country mxw-id="DS660687869" load-source="docdb">HU</country><country mxw-id="DS660784011" load-source="docdb">IE</country><country mxw-id="DS660695391" load-source="docdb">IS</country><country mxw-id="DS660687582" load-source="docdb">IT</country><country mxw-id="DS660687870" load-source="docdb">LI</country><country mxw-id="DS660689459" load-source="docdb">LT</country><country mxw-id="DS660612314" load-source="docdb">LU</country><country mxw-id="DS660689460" load-source="docdb">LV</country><country mxw-id="DS660689461" load-source="docdb">MC</country><country mxw-id="DS660611840" load-source="docdb">MK</country><country mxw-id="DS660611841" load-source="docdb">MT</country><country mxw-id="DS660695392" load-source="docdb">NL</country><country mxw-id="DS660687587" load-source="docdb">NO</country><country mxw-id="DS660695393" load-source="docdb">PL</country><country mxw-id="DS660687588" load-source="docdb">PT</country><country mxw-id="DS660695394" load-source="docdb">RO</country><country mxw-id="DS660687589" load-source="docdb">RS</country><country mxw-id="DS660695399" load-source="docdb">SE</country><country mxw-id="DS660784012" load-source="docdb">SI</country><country mxw-id="DS660689475" load-source="docdb">SK</country><country mxw-id="DS660689476" load-source="docdb">SM</country><country mxw-id="DS660687875" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479948" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Embodiments of the present invention provide a method, an apparatus and a system, which relate to the communications field, for determining a transmission path of a packet, and can solve a problem that a determined transmission path of a packet is not accurate enough and that the determining of the transmission path of the packet affects normal packet transmission due to occupation of a large amount of network bandwidth. The method includes: determining, by a network device, a packet; acquiring, by the network device, a characteristic of the packet and an attribute of the packet according to the packet; and sending, by the network device, the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.
<img id="iaf01" file="imgaf001.tif" wi="99" he="83" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759760" lang="EN" source="EPO" load-source="docdb"><p>Embodiments of the present invention provide a method, an apparatus and a system, which relate to the communications field, for determining a transmission path of a packet, and can solve a problem that a determined transmission path of a packet is not accurate enough and that the determining of the transmission path of the packet affects normal packet transmission due to occupation of a large amount of network bandwidth. The method includes: determining, by a network device, a packet; acquiring, by the network device, a characteristic of the packet and an attribute of the packet according to the packet; and sending, by the network device, the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</p></abstract><description mxw-id="PDES98404649" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">The present invention relates to the communications field, and in particular, to a method, apparatus and system for determining a transmission path of a packet.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">In a network, a transmission path of a packet in a service flow is generally determined by means of mutual negotiation by network devices in the network and routing by the network devices themselves. Therefore, a network administrator is unaware of an actual transmission path of the packet. In a process of monitoring a packet, when a device that transmits the packet is faulty, an actual transmission path of the packet needs to be determined first, and then a faulty transmission path or device can be located accurately.</p><p id="p0003" num="0003">Generally, a transmission path of a packet is usually determined by sending a simulated packet. Specifically, a source device may send a packet that carries Time To Live (English: Time To Live, TTL for short), that is, an Internet Control Message Protocol (English: Internet Control Message Protocol, ICMP for short) packet. After receiving the ICMP packet, a device on a transmission path subtracts 1 from the TTL in the ICMP packet. If the TTL in the ICMP packet is 0 after 1 is subtracted from the TTL, the device discards the ICMP packet and returns an ICMP Time Exceeded (English: Time Exceeded) message to the source device; or, if the TTL in the ICMP packet is not 0 after 1 is subtracted from the TTL, the device forwards the ICMP packet. After the source device receives the ICMP Time Exceeded message, the source device learns that the device which sends the ICMP Time Exceeded message exists on the transmission path of the packet. The source device may determine different devices on the transmission path of the packet by sending simulated packets that carry different TTL, and<!-- EPO <DP n="2"> --> further obtain the transmission path that includes the different devices and is of the packet. However, in the foregoing method for determining a transmission path of a packet, because an ICMP packet sent by the source device is a simulated packet, a case may occur in which a transmission path of the simulated packet is different from an actual transmission path of the packet, causing that the transmission path that is determined by the source device and is of the packet is not accurate enough. In addition, a large quantity of simulated packets sent by the source device occupy a large amount of network bandwidth, which affects normal packet transmission.</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0004" num="0004">The present invention provide a method, an apparatus and a system for determining a transmission path of a packet, which can solve a problem that a determined transmission path of a packet is not accurate enough and that the determining of the transmission path of the packet affects normal packet transmission due to occupation of a large amount of network bandwidth.</p><p id="p0005" num="0005">To fulfill the foregoing objective, the present invention uses the following technical solutions: According to a first aspect, the present invention provides a method for determining a transmission path of a packet, including:
<ul><li>determining, by a network device, a packet;</li><li>acquiring, by the network device, a characteristic of the packet and an attribute of the packet according to the packet; and</li><li>sending, by the network device, the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</li></ul></p><p id="p0006" num="0006">In a first possible implementation manner of the first aspect,<br/>
the network device is a layer-2 network device, the characteristic of the packet includes a layer-3 identifier of the packet, and the attribute of the packet includes<!-- EPO <DP n="3"> --> TTL of the packet and time of arrival of the packet at the layer-2 network device; or, the characteristic of the packet includes a layer-2 identifier of the packet, and the attribute of the packet includes TTL of the packet and time of arrival of the packet at the layer-2 network device.</p><p id="p0007" num="0007">With reference to the first aspect or the first possible implementation manner of the first aspect, in a second possible implementation manner of the first aspect,<br/>
the network device is a layer-3 network device, the characteristic of the packet includes a layer-3 identifier of the packet, and the attribute of the packet includes TTL of the packet.</p><p id="p0008" num="0008">With reference to the second possible implementation manner of the first aspect, in a third possible implementation manner of the first aspect, the network device is a gateway device, and the method further includes:
<ul><li>determining, by the gateway device, whether the packet includes a layer-2 identifier of the packet;</li><li>if the packet includes the layer-2 identifier of the packet, sending, by the gateway device to the control device, the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device, and removing the layer-2 identifier of the packet from the packet; and</li><li>if the packet does not include the layer-2 identifier of the packet, adding, by the gateway device, the layer-2 identifier of the packet into the packet, and sending, to the control device, the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device.</li></ul></p><p id="p0009" num="0009">With reference to the second possible implementation manner of the first aspect, in a fourth possible implementation manner of the first aspect, the network device is a gateway device, and the method further includes:
<ul><li>determining, by the gateway device, whether the packet includes a layer-2 identifier of the packet;<!-- EPO <DP n="4"> --></li><li>if the packet includes the layer-2 identifier of the packet, removing, by the gateway device, the layer-2 identifier of the packet from the packet, where a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet; or</li><li>if the packet does not include the layer-2 identifier of the packet, adding, by the gateway device, the layer-2 identifier of the packet into the packet, where a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet.</li></ul></p><p id="p0010" num="0010">With reference to the first aspect or any implementation manner of the first possible implementation manner to the fourth possible implementation manner of the first aspect, in a fifth possible implementation manner of the first aspect, before the network device determines the packet, the method further includes:
<ul><li>acquiring, by the network device, a description that is sent by the control device and is of the packet; and</li><li>the determining, by a network device, a packet includes:
<ul><li>comparing, by the network device, the description of the packet with a packet received by the network device; and</li><li>if the packet received by the network device matches the description of the packet, determining, by the network device, that the packet received by the network device is the packet.</li></ul></li></ul></p><p id="p0011" num="0011">With reference to the first aspect or any implementation manner of the first possible implementation manner to the fifth possible implementation manner of the first aspect, in a sixth possible implementation manner of the first aspect, the packet includes a color bit of the packet, where the color bit of the packet is used to indicate whether the packet is colored, and<br/>
the determining, by a network device, a packet includes:
<ul><li>determining, by the network device, a color bit of a packet received by the network device; and</li><li>if the color bit of the packet received by the network device indicates that the packet received by the network device is colored, determining, by the network<!-- EPO <DP n="5"> --> device, that the packet received by the network device is the packet.</li></ul></p><p id="p0012" num="0012">According to a second aspect, the present invention provides a method for determining a transmission path of a packet, including:
<ul><li>acquiring, by a control device, multiple entries that are sent by multiple network devices and are of a packet, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry; and</li><li>determining, by the control device, a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries.</li></ul></p><p id="p0013" num="0013">In a first possible implementation manner of the second aspect,<br/>
the multiple network devices include a layer-2 network device, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device; or, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-2 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device.</p><p id="p0014" num="0014">With reference to the first possible implementation manner of the second aspect, in a second possible implementation manner of the second aspect,<br/>
the multiple network devices include a layer-3 network device, a characteristic of the packet in an entry sent by the layer-3 network device includes the layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-3 network device includes TTL of a packet received by the layer-3 network<!-- EPO <DP n="6"> --> device.</p><p id="p0015" num="0015">With reference to the second possible implementation manner of the second aspect, in a third possible implementation manner of the second aspect, the determining, by the control device, a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries includes:
<ul><li>sorting, by the control device, the multiple entries according to the TTL of the packet and the time of arrival of the packet at the layer-2 network device; and</li><li>determining, by the control device, that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet.</li></ul></p><p id="p0016" num="0016">With reference to the second possible implementation manner of the second aspect, in a fourth possible implementation manner of the second aspect, the network device is a gateway device, and the method further includes:
<ul><li>acquiring, by the control device, the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device that are sent by the gateway device.</li></ul></p><p id="p0017" num="0017">With reference to the fourth possible implementation manner of the second aspect, in a fifth possible implementation manner of the second aspect,<br/>
the multiple entries include entries that have a same value of the layer-2 identifier of the packet and entries that have a same value of the layer-3 identifier of the packet, where the layer-2 identifier of the packet is mapped to the layer-3 identifier of the packet according to the mapping.</p><p id="p0018" num="0018">According to a third aspect, the present invention provides a network device, including:
<ul><li>a determining unit, configured to determine a packet;</li><li>an acquiring unit, configured to acquire a characteristic of the packet and an attribute of the packet according to the packet determined by the determining unit; and</li><li>a sending unit, configured to send the characteristic of the packet and the attribute<!-- EPO <DP n="7"> --> of the packet that are acquired by the acquiring unit, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</li></ul></p><p id="p0019" num="0019">In a first possible implementation manner of the third aspect,<br/>
the network device is a layer-2 network device, the characteristic that is acquired by the acquiring unit and is of the packet includes a layer-3 identifier of the packet, and the attribute that is acquired by the acquiring unit and is of the packet includes TTL of the packet and time of arrival of the packet at the layer-2 network device; or, the characteristic that is acquired by the acquiring unit and is of the packet includes a layer-2 identifier of the packet, and the attribute that is acquired by the acquiring unit and is of the packet includes TTL of the packet and time of arrival of the packet at the layer-2 network device.</p><p id="p0020" num="0020">With reference to the third aspect or the first possible implementation manner of the third aspect, in a second possible implementation manner of the third aspect,<br/>
the network device is a layer-3 network device, the characteristic that is acquired by the acquiring unit and is of the packet includes a layer-3 identifier of the packet, and the attribute that is acquired by the acquiring unit and is of the packet includes TTL of the packet.</p><p id="p0021" num="0021">With reference to the second possible implementation manner of the third aspect, in a third possible implementation manner of the third aspect, the network device is a gateway device, and the gateway device further includes a processing unit;<br/>
the determining unit is further configured to determine whether the packet includes a layer-2 identifier of the packet;<br/>
the sending unit is further configured to, if the determining unit determines that the packet includes the layer-2 identifier of the packet, send the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device to the control device, and the processing unit is configured to<!-- EPO <DP n="8"> --> remove the layer-2 identifier of the packet from the packet determined by the determining unit; and<br/>
the processing unit is further configured to, if the determining unit determines that the packet does not include the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, and the sending unit is further configured to send the layer-2 identifier of the packet, the layer-3 identifier of the packet, the mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and the IP address of the gateway device to the control device.</p><p id="p0022" num="0022">With reference to the second possible implementation manner of the third aspect, in a fourth possible implementation manner of the third aspect, the network device is a gateway device, and the gateway device further includes a processing unit;<br/>
the determining unit is further configured to determine whether the packet includes a layer-2 identifier of the packet; and<br/>
the processing unit is configured to: if the determining unit determines that the packet includes the layer-2 identifier of the packet, remove the layer-2 identifier of the packet from the packet, and if the determining unit determines that the packet does not include the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, where a value of the layer-2 identifier of the packet is<br/>
the same as a value of the layer-3 identifier of the packet.</p><p id="p0023" num="0023">With reference to the third aspect or any implementation manner of the first possible implementation manner to the fourth possible implementation manner of the third aspect, in a fifth possible implementation manner of the third aspect,<br/>
the acquiring unit is further configured to: before the determining unit determines the packet, acquire a description that is sent by the control device and is of the packet; and<br/>
the determining unit is specifically configured to: compare the description that is acquired by the acquiring unit and is of the packet with a received packet; and if the received packet matches the description of the packet, determine that the received packet is the packet.<!-- EPO <DP n="9"> --></p><p id="p0024" num="0024">With reference to the third aspect or any implementation manner of the first possible implementation manner to the fifth possible implementation manner of the third aspect, in a sixth possible implementation manner of the third aspect, the packet determined by the determining unit includes a color bit of the packet, where the color bit of the packet is used to indicate whether the packet is colored, and<br/>
the determining unit is specifically configured to determine a color bit of a received packet, and if the color bit of the received packet indicates that the<br/>
received packet is colored, determine that the received packet is the packet.</p><p id="p0025" num="0025">According to a fourth aspect, the present invention provides a control device, including:
<ul><li>an acquiring unit, configured to acquire multiple entries that are sent by multiple network devices and are of a packet, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry; and</li><li>a determining unit, configured to determine a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries acquired by the acquiring unit.</li></ul></p><p id="p0026" num="0026">In a first possible implementation manner of the fourth aspect,<br/>
the multiple network devices include a layer-2 network device, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device; or, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-2 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2<!-- EPO <DP n="10"> --> network device and time of arrival of the packet at the layer-2 network device. With reference to the first possible implementation manner of the fourth aspect, in a second possible implementation manner of the fourth aspect,<br/>
the multiple network devices include a layer-3 network device, a characteristic of the packet in an entry sent by the layer-3 network device includes the layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-3 network device includes TTL of a packet received by the layer-3 network device.</p><p id="p0027" num="0027">With reference to the second possible implementation manner of the fourth aspect, in a third possible implementation manner of the fourth aspect,<br/>
the determining unit is specifically configured to: sort the multiple entries according to the TTL of the packet and the time of arrival of the packet at the layer-2 network device; and determine that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet.</p><p id="p0028" num="0028">With reference to the second possible implementation manner of the fourth aspect, in a fourth possible implementation manner of the fourth aspect, the network device is a gateway device, and<br/>
the acquiring unit is further configured to acquire the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device that are sent by the gateway device.</p><p id="p0029" num="0029">With reference to the fourth possible implementation manner of the fourth aspect, in a fifth possible implementation manner of the fourth aspect,<br/>
the multiple entries acquired by the acquiring unit include entries that have a same value of the layer-2 identifier of the packet and entries that have a same value of the layer-3 identifier of the packet, where the layer-2 identifier of the packet is mapped to the layer-3 identifier of the packet according to the mapping.</p><p id="p0030" num="0030">According to a fifth aspect, the present invention provides a system for determining a transmission path of a packet, including:<!-- EPO <DP n="11"> -->
<ul><li>multiple network devices according to the third aspect and the control device according to the fourth aspect.</li></ul></p><p id="p0031" num="0031">The present invention provides a method, an apparatus, and a system for determining a transmission path of a packet, where a network device determines a packet, and the network device acquires a characteristic of the packet and an attribute of the packet according to the packet; the network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device; and the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device. According to this solution, because the network device may send, to the control device, the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device, the control device can determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission.</p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0032" num="0032"><ul><li><figref idrefs="f0001">FIG. 1</figref> is flowchart 1 of a method for determining a transmission path of a packet according to an embodiment of the present invention;</li><li><figref idrefs="f0001">FIG. 2</figref> is flowchart 2 of a method for determining a transmission path of a packet according to an embodiment of the present invention;</li><li><figref idrefs="f0002">FIG. 3</figref> is interaction diagram 1 of a method for determining a transmission path of a packet according to an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 4</figref> is flowchart 3 of a method for determining a transmission path of a packet according to<!-- EPO <DP n="12"> --> an embodiment of the present invention;</li><li><figref idrefs="f0004">FIG. 5</figref> is flowchart 4 of a method for determining a transmission path of a packet according to an embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 6</figref> is interaction diagram 2 of a method for determining a transmission path of a packet according to an embodiment of the present invention;</li><li><figref idrefs="f0006">FIG. 7</figref> is flowchart 5 of a method for determining a transmission path of a packet according to an embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 8</figref> is schematic structural diagram 1 of a network device according to an embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 9</figref> is schematic structural diagram 2 of a network device according to an embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 10</figref> is schematic structural diagram 1 of a control device according to an embodiment of the present invention;</li><li><figref idrefs="f0008">FIG. 11</figref> is schematic structural diagram 2 of a control device according to an embodiment of the present invention;</li><li><figref idrefs="f0008">FIG. 12</figref> is schematic structural diagram 3 of a network device according to an embodiment of the present invention;</li><li><figref idrefs="f0008">FIG. 13</figref> is schematic structural diagram 3 of a control device according to an embodiment of the present invention; and</li><li><figref idrefs="f0009">FIG. 14</figref> is a block diagram of a system for determining a transmission path of a packet according to an embodiment of the present invention.</li></ul></p><heading id="h0005"><b>DESCRIPTION OF EMBODIMENTS</b></heading><p id="p0033" num="0033">In a method for determining a transmission path of a packet provided by embodiments of the present invention, a control device and a network device in a network may determine a transmission path of a packet accurately in real time according to packets that actually flow through the network device, so as to obtain a transmission path of a service flow including multiple packets.</p><p id="p0034" num="0034">The following describes in detail, with reference to the accompanying drawings, a method, an<!-- EPO <DP n="13"> --> apparatus and a system for determining a transmission path of a packet provided by the embodiments of the present invention.</p><heading id="h0006"><b>Embodiment 1</b></heading><p id="p0035" num="0035">This embodiment of the present invention provides a method for determining a transmission path of a packet. As shown in <figref idrefs="f0001">FIG. 1</figref>, the method may include:
<ul><li>S101. A network device determines a packet.</li></ul></p><p id="p0036" num="0036">In the method for determining a transmission path of a packet provided in this embodiment of the present invention, if a control device needs to determine a transmission path of a packet in a network, the control device sends a description of the packet to a network device in a detection area manageable by the control device. The detection area manageable by the control device may be defined as an area covering all network devices reachable by routes of the control device. If the control device needs to determine transmission paths of multiple groups of packets in the network, the control device may send multiple descriptions to the network devices in the detection area manageable by the control device, and number each description. Alternatively, the step of sending the description of the packet by the control device may be omitted. In this scenario, the network device uses all received packets as packets whose transmission paths need to be determined. That is, in a subsequent step 102, the network device acquires a characteristic and an attribute of each packet of all received packets.</p><p id="p0037" num="0037">The control device provided in the embodiment of the present invention may be a network management device or a controller or the like. The network device provided in the embodiment of the present invention may be a network switch or a router or the like. Methods of determining a transmission path of a packet by all network devices in the network are similar. The embodiment of the present invention uses one network device of all network devices as an example to give an exemplary description.</p><p id="p0038" num="0038">After the network device in the network acquires a description that is sent by the control device and is of a packet, the network device may determine, according to the description of the packet, a packet matching the description of the packet in packets that actually flow<!-- EPO <DP n="14"> --> through the network device. The description of the packet may be used to uniquely identify a service flow that includes the packet. That is, descriptions of service flows received by the network device (one service flow includes multiple packets, that is, multiple packets in a same service flow have a same description) are different from each other.</p><p id="p0039" num="0039">Specifically, the description of the packet may include one or more of: a source Internet Protocol (English: Internet Protocol, IP for short) address of the packet, a destination IP address of the packet, a protocol port number of the packet, and a differentiated service code point (English: differentiated services code point, DSCP for short) of the packet.</p><p id="p0040" num="0040">The foregoing several types of descriptions of the packet are merely exemplary, and any description that can be used to uniquely identify a service flow falls within the protection scope of the present invention.</p><p id="p0041" num="0041">Optionally, the network device may use an access control list (English: access control list, ACL for short) to determine the packet matching the description of the packet. In the embodiment of the present invention, the description of the packet may be set as an ACL entry used to determine the packet matching the description of the packet.</p><p id="p0042" num="0042">S102. The network device acquires a characteristic of the packet and an attribute of the packet according to the packet.</p><p id="p0043" num="0043">After the network device determines the packet, the network device may acquire the characteristic of the packet and the attribute of the packet according to the packet. The characteristic of the packet refers to one or more fields that are capable of identifying the packet and are in the packet. On the transmission path of the packet, the one or more fields keep unchanged, or changes in a determinable manner, that is, the characteristic of the packet after the change corresponds to the characteristic of the packet before the change. For example, after network address translation (English: network address translation, NAT for short), the source IP address of the packet may change, but it may be determined by a NAT device that the source IP address before the change is corresponding to the source IP address after the change. The NAT device may send a correspondence between the IP address before the NAT and the IP address after the NAT to the control device, so that the control device determines that characteristics of the packet are corresponding to each other. The attribute of<!-- EPO <DP n="15"> --> the packet refers to an attribute that may be used to indicate the transmission path of the packet, such as TTL of the packet or time of arrival of the packet at the network device. The attribute of the packet keeps changing on the transmission path of the packet or changes on at least a part of the transmission path of the packet.</p><p id="p0044" num="0044">The network device provided in the embodiment of the present invention may be a layer-2 network device or a layer-3 network device. The layer-2 network device is a network device that works at a data link layer, such as a layer-2 network switch; and the layer-3 network device is a network device that works at a network layer, such as a router or a layer-3 network switch.</p><p id="p0045" num="0045">Specifically, when the network device is a layer-2 network device, the characteristic of the packet may include a layer-3 identifier of the packet, and the attribute of the packet may include TTL of the packet and time of arrival of the packet at the layer-2 network device; or, the characteristic of the packet may include a layer-2 identifier of the packet, and the attribute of the packet may include TTL of the packet and time of arrival of the packet at the layer-2 network device. The layer-3 identifier of the packet may be used to identify the packet, and the TTL of the packet may be used to represent the number of hops that the packet is forwarded.</p><p id="p0046" num="0046">The layer-3 identifier of the packet is an Identification (English: Identification) field in an IP header of the packet. Further, in a scenario in which the packet is fragmented, because Identification fields of several packets generated by the fragmentation are the same, a combination of the Identification field in the IP header and a Fragment Offset (English: Fragment Offset) field in the IP header, or a combination of the Identification field in the IP header, a Flag (English: Flags) field in the IP header, and the Fragment Offset field in the IP header, may be used as the layer-3 identifier of the packet.</p><p id="p0047" num="0047">In a possible implementation manner of the embodiment of the present invention, a layer-2 header of the packet is a common Ethernet header. If the layer-2 network device is a layer-3 network switch that works at the data link layer and is capable of parsing a layer-3 header of the packet, after the layer-2 network device determines the packet, the layer-2 network device may parse the layer-3 header of the packet to acquire the layer-3 identifier of the packet and<!-- EPO <DP n="16"> --> the TTL of the packet, use the layer-3 identifier of the packet as the characteristic of the packet, and use the TTL of the packet as the attribute of the packet. If the layer-2 network device is a layer-2 network switch and is incapable of parsing the layer-3 header of the packet, and the layer-3 identifier and an offset (English: offset) value of the TTL relative to the layer-2 header are preset in the layer-2 network device. After the layer-2 network device determines the packet, the layer-2 network device may read data in a fixed position after the layer-2 header according to the preset offset value after parsing the layer-2 header of the packet, use the data as the layer-3 identifier of the packet and the TTL of the packet, use the layer-3 identifier of the packet as the characteristic of the packet, and use the TTL of the packet as the attribute of the packet.</p><p id="p0048" num="0048">In another possible implementation manner of the embodiment of the present invention, the layer-2 header of the packet includes an extension field that is used as the layer-2 identifier of the packet. If the layer-2 network device is a layer-3 network switch that works at the data link layer and is capable of parsing a layer-2 header and a layer-3 header of the packet, after the layer-2 network device determines the packet, the layer-2 network device may parse the layer-2 header of the packet to acquire the layer-2 identifier of the packet, parse the layer-3 header of the packet to acquire the TTL of the packet, use the layer-2 identifier of the packet as the characteristic of the packet, and use the TTL of the packet as the attribute of the packet. If the layer-2 network device is a layer-2 network switch and is incapable of parsing the layer-3 header of the packet, an offset value of the TTL relative to the layer-2 header is preset in the layer-2 network device. After the layer-2 network device determines the packet, the layer-2 network device may acquire the layer-2 identifier of the packet after parsing the layer-2 header of the packet, read data in a fixed position after the layer-2 header according to the preset offset value, use the data as the TTL of the packet, use the layer-2 identifier of the packet as the characteristic of the packet, and use the TTL of the packet as the attribute of the packet.</p><p id="p0049" num="0049">Exemplarily, the length of an extension field in the layer-2 header of the packet is 4 bytes, of which the first 16 bits are used to represent a type declaration, and the other 16 bits are used to represent the layer-2 identifier of the packet.<!-- EPO <DP n="17"> --></p><p id="p0050" num="0050">Further, when the layer-2 header of the packet includes an extension field, a gateway device may add the layer-2 identifier of the packet into the extension field for the packet. For a specific process, reference may be made to descriptions about <figref idrefs="f0003">FIG. 4</figref> and <figref idrefs="f0004">FIG. 5</figref> in the following Embodiment 2.</p><p id="p0051" num="0051">Specifically, when the network device is a layer-3 network device, the characteristic of the packet may include a layer-3 identifier of the packet, and the attribute of the packet may include TTL of the packet. The layer-3 identifier of the packet is an Identification field in an IP header. Further, in a scenario in which the packet is fragmented, a combination of the Identification field in the IP header and a Fragment Offset field in the IP header, or a combination of the Identification field in the IP header, a Flags field in the IP header, and the Fragment Offset field in the IP header, may be used as the layer-3 identifier of the packet. The characteristic of the packet further includes a source IP address of the packet, or a source IP address of the packet and a destination IP address of the packet. If the description that is sent by the control device and is of the packet includes the source IP address or includes a combination of the source IP address and the destination IP address, a number of the description that is sent by the control device and is of the packet may be used to replace the source IP address or the combination of the source IP address and the destination IP address in the characteristic of the packet. That the characteristic of the packet includes the Identification field in the IP header is used as an example. If the description that is sent by the control device to the network device and is of a packet numbered 1 is a protocol port number of the packet, the characteristic of the packet includes the Identification field in the IP header of the packet and the source IP address of the packet; if the description that is sent by the control device to the network device and is of a packet numbered 2 is the source IP address of the packet and the destination IP address of the packet, the characteristic of the packet includes the Identification field in the IP header of the packet and a number, which is 2, of a description of the packet.</p><p id="p0052" num="0052">Further, the time of arrival that is in the attribute of the packet and is of the packet at the layer-2 network device may be specifically determined by the layer-2 network device according to time of reception of the packet by the layer-2 network device.<!-- EPO <DP n="18"> --></p><p id="p0053" num="0053">S103. The network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</p><p id="p0054" num="0054">After the network device acquires the characteristic of the packet and the attribute of the packet, the network device may send the characteristic of the packet, the attribute of the packet, and the attribute of the network device to the control device, so that the control device determines the transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</p><p id="p0055" num="0055">The attribute of the network device may include at least one of: an IP address of the network device, a media access control (English: media access control, MAC) address of the network device, and a serial number allocated by a network management device to the network device. Optionally, the attribute of the network device may further include at least one of: a port number used by the network device to receive the packet, and a port number used by the network device to send the packet.</p><p id="p0056" num="0056">The method used by other network devices in the network to determine a transmission path of a packet is similar to the foregoing method used by the network device to determine a transmission path of a packet, and is not further described here.</p><p id="p0057" num="0057">This embodiment of the present invention provides a method for determining a transmission path of a packet. As shown in <figref idrefs="f0001">FIG. 2</figref>, the method may include:
<ul><li>S201. A control device acquires multiple entries that are sent by multiple network devices and are of a packet, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry.</li></ul></p><p id="p0058" num="0058">In a detection area manageable by the control device, the control device may receive multiple entries that are sent by network devices in the area and are of multiple packets, where each packet corresponds to multiple entries. According to the characteristic of a packet in an entry,<!-- EPO <DP n="19"> --> the control device may determine a packet to which the entry belongs, that is, may determine, according to the characteristic of the packet, multiple entries that belong to one packet. In the multiple entries that belong to one packet, characteristics of the packet are the same or corresponding to each other. Methods used by the control device to determine transmission paths of all packets of the multiple packets are similar. The embodiment of the present invention uses one packet of multiple packets as an example to give an exemplary description. The control device acquires multiple entries of one packet from the received multiple entries of the multiple packets, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the corresponding entry.</p><p id="p0059" num="0059">Specifically, for the characteristic of the packet, the attribute of the packet, and the attribute of the network device, reference may be made to the related description in S101-S103, and no repeated description is given herein.</p><p id="p0060" num="0060">S202. The control device determines a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries.</p><p id="p0061" num="0061">After the control device acquires the multiple entries of the packet, the control device may determine the transmission path of the packet according to the multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries.</p><p id="p0062" num="0062">Specifically, the control device may sort the multiple entries according to TTL of the packet in the multiple entries and time of arrival of the packet at the layer-2 network device in the multiple entries, and determine that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet. For example, the control device may sort the multiple entries for a first time according to the TTL of the packet in the multiple entries, and then sort the multiple entries, which are obtained after the first time of sorting, for a second time according to the time of arrival of the packet at the layer-2 network device in<!-- EPO <DP n="20"> --> the multiple entries, and finally the control device determines that the attributes of the multiple network devices in the multiple entries sorted for the second time are the transmission path of the packet. The control device may also sort the multiple entries for a first time according to the time of arrival of the packet at the layer-2 network device in the multiple entries, and then sort the multiple entries, which are obtained after the first time of sorting, for a second time according to the TTL of the packet in the multiple entries, and finally the control device determines that the attributes of the multiple network devices in the multiple entries sorted for the second time are the transmission path of the packet. The layer-2 network device does not process a layer-3 header of the packet. Therefore, after the packet is forwarded by the layer-2 network device, the TTL of the packet is the same as the TTL of the packet received by the layer-2 network device. The TTL of the packet in the multiple entries received by the control device and sent by multiple layer-2 network devices may be the same. If multiple entries related to the packet are sorted according to only the TTL, only a sequence of layer-3 network devices that forward the packet can be determined. Therefore, the control device determines, according to the time of arrival of the packet at the layer-2 network device, a sequence of layer-2 network devices that forward the packet, and according to the TTL of the packet, determines the sequence of layer-3 network devices that forward the packet. If the TTL in an entry sent by the layer-2 network device is the same as that in an entry sent by the layer-3 network device, the control device places the entry that is sent by the layer-2 network device in front of the entry sent by the layer-3 network device.</p><p id="p0063" num="0063">In the method for determining a transmission path of a packet according to an embodiment of the present invention, because a packet that actually flows through a network device is used in determining a transmission path of the packet, in comparison with a conventional method in which a simulated packet is used to determine a transmission path of a packet (the transmission path of the packet may represent a transmission path of a service flow that includes the packet), it is not necessary to learn about a structure of the simulated packet before determining the transmission path of the packet; and it is avoided that simulated packets occupy a large amount of network bandwidth and network device resources; and an actual transmission path of the packet can be determined in real time, and a problem is<!-- EPO <DP n="21"> --> avoided that the determined transmission path of the packet is not accurate enough due to randomness of routing and forwarding of a network device, so that the transmission path of the packet can be determined conveniently and accurately in real time.</p><p id="p0064" num="0064">The embodiment of the present invention provides a method for determining a transmission path of a packet, where a network device determines a packet, and the network device acquires a characteristic of the packet and an attribute of the packet according to the packet; the network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device; and the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device. According to this solution, because the network device may send, to the control device, the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device, the control device can determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission.</p><heading id="h0007"><b>Embodiment 2</b></heading><p id="p0065" num="0065">This embodiment of the present invention provides a method for determining a transmission path of a packet. As shown in <figref idrefs="f0002">FIG. 3</figref>, the method may include:
<ul><li>S301. A control device sends a description of a packet to multiple network devices.</li></ul></p><p id="p0066" num="0066">In the method for determining a transmission path of a packet provided in this embodiment of the present invention, if a control device needs to determine a transmission path of a packet in a network, the control device sends a description of the packet to a network device in a<!-- EPO <DP n="22"> --> detection area manageable by the control device. The detection area manageable by the control device may be defined as an area covering all network devices reachable by routes of the control device. If the control device needs to determine transmission paths of multiple packets in the network, the control device may send multiple descriptions to the network devices in the detection area manageable by the control device, and number each description. Alternatively, the step of sending the description of the packet by the control device may be omitted. In this scenario, the network device uses all received packets as packets whose transmission paths need to be determined. That is, in a subsequent step 304, the network device acquires a characteristic and an attribute of each packet of all received packets.</p><p id="p0067" num="0067">The control device provided in the embodiment of the present invention may be a network management device or a controller or the like. The network device provided in the embodiment of the present invention may be a network switch or a router or the like.</p><p id="p0068" num="0068">The description of the packet may be used to uniquely identify a service flow that includes the packet. That is, descriptions of service flows received by the network device (one service flow includes multiple packets, that is, multiple packets in a same service flow have a same description) are different. The description of the packet may include one or more of: a source IP address of the packet, a destination IP address of the packet, a protocol port number of the packet, and a DSCP of the packet.</p><p id="p0069" num="0069">The several types of descriptions of the packet are merely exemplary, and any description that can be used to uniquely identify a service flow falls within the protection scope of the present invention.</p><p id="p0070" num="0070">Methods of determining a transmission path of a packet by all network devices in the network are similar. The embodiment of the present invention uses one network device of all network devices as an example to give an exemplary description.</p><p id="p0071" num="0071">S302. A network device compares the description of the packet with a packet received by the network device.</p><p id="p0072" num="0072">After the network device acquires the description that is sent by the control device and is of the packet, the network device may compare the description of the packet with a packet received by the network device, where the packet received by the network device includes a<!-- EPO <DP n="23"> --> description of the packet received by the network device. The network device compares the description of the packet with the description of the packet received by the network device. S303. If the packet received by the network device matches the description of the packet, the network device determines that the packet received by the network device is the packet.</p><p id="p0073" num="0073">If the packet received by the network device matches the description that is acquired by the network device and sent by the control device and is of the packet, the network device determines that the packet received by the network device is the packet.</p><p id="p0074" num="0074">For example, if the description that is sent by the control device and is of the packet is a source IP address of the packet and a destination IP address of the packet, the network device may compare the source IP address of the packet with a source IP address of the packet received by the network device, and compare the destination IP address of the packet with a destination IP address of the packet received by the network device. If the source IP address of the packet is the same as the source IP address of the packet received by the network device and the destination IP address of the packet is the same as the destination IP address of the packet received by the network device, the network device may determine that the packet received by the network device is the packet.</p><p id="p0075" num="0075">Optionally, the network device may use an ACL to determine the packet matching the description of the packet. In the embodiment of the present invention, the description of the packet may be set as an ACL entry, which is used to determine the packet matching the description of the packet.</p><p id="p0076" num="0076">S304. The network device acquires a characteristic of the packet and an attribute of the packet according to the packet.</p><p id="p0077" num="0077">Specifically, for a description about S304, reference may be made to the related description in S102 above, and no repeated description is given herein.</p><p id="p0078" num="0078">S305. The network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to the control device.</p><p id="p0079" num="0079">Specifically, for a description about S305, reference may be made to the related description in S103 above, and no repeated description is given herein.</p><p id="p0080" num="0080">When a packet flows through a network device, the network device may determine, according<!-- EPO <DP n="24"> --> to the method provided in S302-S305, a packet whose transmission path needs to be determined, acquire a characteristic of a packet and the attribute of the packet, and send the characteristic of the packet, the attribute of the packet, and the attribute of the network device to the control device. Finally, multiple network devices that the packet flows through send multiple characteristics of the packet, multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices to the control device. The multiple characteristics of the packet, the multiple attributes of the packet when the multiple network devices receive the packet, and the attributes of the multiple network devices form multiple entries of the packet. Specifically, the characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry.</p><p id="p0081" num="0081">S306. The control device acquires multiple entries that are sent by the multiple network devices and are of the packet.</p><p id="p0082" num="0082">The control device acquires multiple entries that are sent by multiple network devices and are of a packet, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the corresponding entry receives the packet, and an attribute of the network device that sends the corresponding entry. Specifically, for a description about S306, reference may be made to the related description in S201 above, and no repeated description is given herein.</p><p id="p0083" num="0083">S307. According to the multiple entries, the control device determines a transmission path of the packet.</p><p id="p0084" num="0084">After the control device acquires the multiple entries that are sent by multiple network devices and are of the packet, the control device may determine the transmission path of the packet according to the multiple attributes of the packet when the multiple network devices receive<!-- EPO <DP n="25"> --> the packet, and attributes of the multiple network devices in the multiple entries.</p><p id="p0085" num="0085">Specifically, for a description about S307, reference may be made to the related description in S202 above, and no repeated description is given herein.</p><p id="p0086" num="0086">Further, in S307, the determining, by the control device, a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries, may specifically include:
<ul><li>sorting, by the control device, the multiple entries according to the TTL of the packet in the multiple entries and the time of arrival of the packet at the layer-2 network device in the multiple entries, and determining that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet.</li></ul></p><p id="p0087" num="0087">For example, the following manner may be specifically used:
<ul><li>(1a) The control device sorts the multiple entries for a first time according to the TTL of the packet in the multiple entries.</li><li>(2a) According to the time of arrival of the packet at the layer-2 network device in the multiple entries, the control device sorts the multiple entries that are obtained after the first time of sorting for a second time.</li><li>(3a) The control device determines that the attributes of the multiple network devices in the multiple entries sorted for the second time are the transmission path of the packet.</li></ul></p><p id="p0088" num="0088">Alternatively, the following manner may be used:
<ul><li>(1b) According to the time of arrival of the packet at the layer-2 network device in the multiple entries, the control device sorts the multiple entries for a first time.</li><li>(2b) According to the TTL of the packet in the multiple entries, the control device sorts the multiple entries that are obtained after the first time of sorting for a second time.</li><li>(3b) The control device determines that the attributes of the multiple network devices in the multiple entries sorted for the second time are the transmission path<!-- EPO <DP n="26"> --> of the packet.</li></ul></p><p id="p0089" num="0089">Further, as shown in <figref idrefs="f0003">FIG. 4</figref>, when the network device is a gateway device, S302-S305 provided in the embodiment of the present invention are all executed by the gateway device, and after S303 and before S306, the method for determining a transmission path of a packet provided in the embodiment of the present invention may further include:
<ul><li>S308. A gateway device determines whether the packet includes a layer-2 identifier of the packet.</li><li>S309. If the packet includes the layer-2 identifier of the packet, the gateway device sends the layer-2 identifier of the packet, a layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device to the control device, and removes the layer-2 identifier of the packet from the packet.</li><li>S310. If the packet does not include the layer-2 identifier of the packet, the gateway device adds the layer-2 identifier of the packet into the packet, and sends the layer-2 identifier of the packet, a layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device to the control device.</li></ul></p><p id="p0090" num="0090">After the gateway device determines the packet, the gateway device may determine whether the packet includes a layer-2 identifier of the packet. If the packet includes the layer-2 identifier of the packet, the gateway device sends the layer-2 identifier of the packet, a layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device to the control device, and the gateway device removes the layer-2 identifier of the packet from the packet and forwards the packet. If the packet does not include the layer-2 identifier of the packet, the gateway device allocates a layer-2 identifier to the packet, adds the layer-2 identifier into the packet, and sends the layer-2 identifier of the packet, a layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device to the control device, and the gateway device forwards the packet, where the layer-2 identifier of the packet, which is added by the gateway device into the<!-- EPO <DP n="27"> --> packet, is mapped to the layer-3 identifier of the packet.</p><p id="p0091" num="0091">The foregoing solution is generally applied to a scenario in which the packet may possibly be fragmented, that is, the layer-3 identifier of the packet is a combination of the Identification field in the IP header and a Fragment Offset field in the IP header, or a combination of the Identification field in the IP header, a Flags field in the IP header, and the Fragment Offset field in the IP header. Therefore, the gateway allocates a dedicated layer-2 identifier to the packet, and sends the layer-2 identifier of the packet, the layer-3 identifier of the packet, and the mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet to the control device. If the foregoing solution is applied to a scenario in which the packet is not fragmented, the layer-3 identifier of the packet is the Identification field in the IP header. In this scenario, the gateway device may also allocate a dedicated layer-2 identifier to the packet and sends the layer-2 identifier of the packet, the layer-3 identifier of the packet, and the mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet to the control device. Alternatively, the gateway device may also copy the Identification field in the IP header into the layer-2 identifier of the packet. That is, a value of the layer-2 identifier of the packet is equal to a value of the layer-3 identifier of the packet. As shown in <figref idrefs="f0004">FIG. 5</figref>, when the network device is a gateway device, S302-S305 provided in the embodiment of the present invention are all executed by the gateway device, and S308-S310 may also be:
<ul><li>S308. A gateway device determines whether the packet includes a layer-2 identifier of the packet.</li><li>S309. If the packet includes the layer-2 identifier of the packet, the gateway device removes the layer-2 identifier of the packet from the packet, where a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet.</li><li>S310. If the packet does not include the layer-2 identifier of the packet, the gateway device adds the layer-2 identifier of the packet into the packet, where a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet.</li></ul></p><p id="p0092" num="0092">In the embodiment of the present invention, the sequence of execution of S304-S305 and S308-S310 is arbitrary. That is, in the embodiment of the present invention, S304-S305 may<!-- EPO <DP n="28"> --> be executed before S308-S310; or S308-S310 may be executed before S304-S305; or S304-S305 and S308-S310 may be executed simultaneously.</p><p id="p0093" num="0093">Corresponding to the method shown in <figref idrefs="f0003">FIG. 4</figref>, when the control device in S306 acquires multiple entries that are sent by multiple network devices and are of a packet, the control device may first determine, among the entries sent by all network devices in a detection area manageable by the control device, all entries in which the foregoing mapping is satisfied between the layer-2 identifier of the packet and the layer-3 identifier of the packet, that is, the all entries are multiple entries of a same packet, where the determining is performed according to the layer-2 identifier of the packet, the layer-3 identifier of the packet, the mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet that are sent by the gateway device. In this way, the control device acquires the multiple entries that is sent by the multiple network devices and is of the packet. Exemplarily, the layer-2 identifier of the packet, the layer-3 identifier of the packet, and the mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet that are sent by the gateway device, may be shown in Table 1.
<tables id="tabl0001" num="0001"><table frame="all"><title><b>Table 1</b></title><tgroup cols="3"><colspec colnum="1" colname="col1" colwidth="46mm"/><colspec colnum="2" colname="col2" colwidth="46mm"/><colspec colnum="3" colname="col3" colwidth="49mm"/><thead><row><entry align="center" valign="middle">Layer-3 identifier of the packet</entry><entry align="center" valign="middle">Layer-2 identifier of the packet</entry><entry align="center" valign="middle">IP address of the gateway device</entry></row></thead><tbody><row><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">e</entry><entry align="center" valign="middle">IP7</entry></row><row><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">h</entry><entry align="center" valign="middle">IP9</entry></row></tbody></tgroup></table></tables></p><p id="p0094" num="0094">From Table 1, it may be seen that all entries in which the identifier of the packet is "a", "e" or "h" are entries fed back by different network devices after the same packet passes through the different network devices.</p><p id="p0095" num="0095">Corresponding to the method shown in <figref idrefs="f0004">FIG. 5</figref>, when the control device in S306 acquires multiple entries are sent by multiple network devices and are of a packet, the control device may determine, among the entries sent by all network devices in a detection area manageable by the control device, all entries in which the identifier of the packet is the same, which are multiple entries of a same packet. In this way, the control device acquires the multiple entries<!-- EPO <DP n="29"> --> that are sent by the multiple network devices and are of the packet.</p><p id="p0096" num="0096">For example, it is assumed that a result of sorting multiple entries is shown in Table 2, where the entries are sorted according to the TTL of a packet in multiple entries and the time of arrival of the packet at the layer-2 network device in the multiple entries after the control device acquires the multiple entries that are sent by multiple network devices and are of the packet; characteristics of the multiple packets include source IP addresses of the multiple packets and identifiers of the multiple packets; and attributes of the multiple network devices are IP addresses of the multiple network devices. Therefore, the control device may acquire, according to Table 2, a sequence of arrival of the packet at the multiple network devices, and may determine the transmission path of the packet according to Table 2, where the transmission path of the packet may consist of IP addresses of the multiple network devices. Further, the attributes of the multiple network devices may include at least one of: IP addresses of the multiple network devices, MAC addresses of the multiple network devices, and serial numbers allocated by a network management device to the multiple network devices.</p><p id="p0097" num="0097">Optionally, the attributes of the multiple network devices may further include at least one of: port numbers used by the multiple network devices to receive the packet, and port numbers used by the multiple network devices to send the packet.</p><p id="p0098" num="0098">Exemplarily, for details about the attributes of the multiple network devices and the transmission path of the packet, reference may be made to Table 2 and Table 3.
<tables id="tabl0002" num="0002"><table frame="all"><title><b>Table 2</b></title><tgroup cols="5"><colspec colnum="1" colname="col1" colwidth="36mm"/><colspec colnum="2" colname="col2" colwidth="28mm"/><colspec colnum="3" colname="col3" colwidth="23mm"/><colspec colnum="4" colname="col4" colwidth="36mm"/><colspec colnum="5" colname="col5" colwidth="44mm"/><thead><row><entry align="center" valign="middle">Source IP address of the packet</entry><entry align="center" valign="middle">Identifier of the packet</entry><entry align="center" valign="middle">TTL of the packet</entry><entry align="center" valign="middle">IP address of the network device</entry><entry align="center" valign="middle">Time of arrival of the packet at the network device</entry></row></thead><tbody><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">i</entry><entry align="center" valign="middle">IP1</entry><entry align="center" valign="middle">t01</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">i</entry><entry align="center" valign="middle">IP2</entry><entry align="center" valign="middle">t02</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">i</entry><entry align="center" valign="middle">IP3</entry><entry align="center" valign="middle">t04</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">IP7</entry><entry align="center" valign="middle">t07</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">y</entry><entry align="center" valign="middle">IP8</entry><entry align="center" valign="middle">t10</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">z</entry><entry align="center" valign="middle">IP9</entry><entry align="center" valign="middle">t13</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">z</entry><entry align="center" valign="middle">IP4</entry><entry align="center" valign="middle">t14</entry></row><!-- EPO <DP n="30"> --><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">q</entry><entry align="center" valign="middle">IP5</entry><entry align="center" valign="middle">t17</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">r</entry><entry align="center" valign="middle">IP6</entry><entry align="center" valign="middle">t21</entry></row></tbody></tgroup></table></tables>
<tables id="tabl0003" num="0003"><table frame="all"><title><b>Table 3</b></title><tgroup cols="7"><colspec colnum="1" colname="col1" colwidth="23mm"/><colspec colnum="2" colname="col2" colwidth="18mm"/><colspec colnum="3" colname="col3" colwidth="15mm"/><colspec colnum="4" colname="col4" colwidth="23mm"/><colspec colnum="5" colname="col5" colwidth="34mm"/><colspec colnum="6" colname="col6" colwidth="27mm"/><colspec colnum="7" colname="col7" colwidth="29mm"/><thead><row><entry align="center" valign="middle">Source IP address of the packet</entry><entry align="center" valign="middle">Identifier of the packet</entry><entry align="center" valign="middle">TTL of the packet</entry><entry align="center" valign="middle">IP address of the network device</entry><entry align="center" valign="middle">Port number used by the network device to receive the packet</entry><entry align="center" valign="middle">Port number used by network device to send the packet</entry><entry align="center" valign="middle">Time of arrival of the packet at the network device</entry></row></thead><tbody><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">e</entry><entry align="center" valign="middle">i</entry><entry align="center" valign="middle">IP1</entry><entry align="center" valign="middle">Port 1</entry><entry align="center" valign="middle">Port 13</entry><entry align="center" valign="middle">t01</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">e</entry><entry align="center" valign="middle">i</entry><entry align="center" valign="middle">IP2</entry><entry align="center" valign="middle">Port 3</entry><entry align="center" valign="middle">Port 2</entry><entry align="center" valign="middle">t02</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">e</entry><entry align="center" valign="middle">i</entry><entry align="center" valign="middle">IP3</entry><entry align="center" valign="middle">Port 2</entry><entry align="center" valign="middle">Port 5</entry><entry align="center" valign="middle">t04</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">IP7</entry><entry align="center" valign="middle">Port 5</entry><entry align="center" valign="middle">Port 2</entry><entry align="center" valign="middle">t07</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">y</entry><entry align="center" valign="middle">IP8</entry><entry align="center" valign="middle">Port 3</entry><entry align="center" valign="middle">Port 13</entry><entry align="center" valign="middle">t10</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">a</entry><entry align="center" valign="middle">z</entry><entry align="center" valign="middle">IP9</entry><entry align="center" valign="middle">Port 1</entry><entry align="center" valign="middle">Port 4</entry><entry align="center" valign="middle">t13</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">h</entry><entry align="center" valign="middle">z</entry><entry align="center" valign="middle">IP4</entry><entry align="center" valign="middle">Port 11</entry><entry align="center" valign="middle">Port 7</entry><entry align="center" valign="middle">t14</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">h</entry><entry align="center" valign="middle">q</entry><entry align="center" valign="middle">IP5</entry><entry align="center" valign="middle">Port 2</entry><entry align="center" valign="middle">Port 21</entry><entry align="center" valign="middle">t17</entry></row><row><entry align="center" valign="middle">IP10</entry><entry align="center" valign="middle">h</entry><entry align="center" valign="middle">r</entry><entry align="center" valign="middle">IP6</entry><entry align="center" valign="middle">Port 9</entry><entry align="center" valign="middle">Port 13</entry><entry align="center" valign="middle">t21</entry></row></tbody></tgroup></table></tables></p><p id="p0099" num="0099">Refer to the related description in S102. As shown in Table 2, if all identifiers of the packet are the same, it indicates that the identifier that is sent by the layer-2 network device to the control device and is of the packet is a layer-3 identifier that is acquired by the layer-2 network device from a layer-3 header of the packet and is of the packet, or is a layer-3 identifier that is acquired by the layer-2 network device from a fixed position in a layer-2 header of the packet and is of the packet, or is a layer-2 identifier that is added by the gateway device into an extension field in the layer-2 header of the packet for the packet and is of the packet (a value of the layer-2 identifier of the packet, which is added by the gateway device is the same as a value of the layer-3 identifier of the packet), where the identifier "a" of the packet is the layer-2 identifier of the packet and the layer-3 identifier of the packet.</p><p id="p0100" num="0100">As shown in Table 3, if the identifiers of the packet are partially the same, it indicates that the identifier that is sent by the layer-2 network device to the control device and is of the packet is a layer-2 identifier that is acquired by the layer-2 network device from an extension field of a layer-2 header of the packet and is of the packet, or is a layer-2 identifier that is added by the<!-- EPO <DP n="31"> --> gateway device into the extension field of the layer-2 header of the packet for the packet and is of the packet (a value of the layer-2 identifier of the packet, which is added by the gateway device is different from a value of the layer-3 identifier of the packet), where the identifier "a" of the packet is the layer-3 identifier of the packet, and the identifier "e" of the packet and the identifier "h" of the packet are layer-2 identifiers of the packet. The identifier "e" of the packet and the identifier "h" of the packet are mapped to the identifier "a" of the packet. Further, the control device may use the attributes of network devices, which are sent by the network devices, as the transmission path of the packet. Specifically, the control device may use the IP addresses of the network devices, which are shown in Table 2, as the transmission path of the packet; and the control device may also use the IP addresses of the network devices, the port numbers used by the network devices to receive the packet, and the port numbers used by the network devices to send the packet, which are shown in Table 3, as the transmission path of the packet, which is not limited by the present invention.</p><p id="p0101" num="0101">Specially, the gateway device is a layer-3 network device. In the method for determining a transmission path of a packet provided in the embodiment of the present invention, in addition to the method that the gateway device needs to execute as it serves as a layer-3 network device, for example, S302-S305, the gateway device also needs to execute S308-S310 shown in <figref idrefs="f0003">FIG. 4</figref> or <figref idrefs="f0004">FIG. 5</figref>.</p><p id="p0102" num="0102">Further, in the method for determining a transmission path of a packet provided in the embodiment of the present invention, the packet may further include a color bit of the packet, where the color bit of the packet is used to indicate whether the packet is colored. Other network devices than network boundary devices (non-network-boundary devices) in the network devices may determine directly, according to the color bit of the packet, whether the packet is colored, so as to determine whether it is necessary to send the characteristic of the packet, the attribute of the packet, and the attribute of the network device to the control device, which avoids that a received packet is compared with the description of the packet to determine the packet, thereby saving device overheads significantly and improving efficiency in determining the transmission path of the packet. That the packet is colored indicates that the packet is a packet used to determine the transmission path, and that the packet is not<!-- EPO <DP n="32"> --> colored indicates that the packet is not a packet used to determine the transmission path.</p><p id="p0103" num="0103">The network boundary devices may include a network boundary device at a transmit end of the packet, and a network boundary device at a receive end of the packet, where the network boundary device at the transmit end of the packet is a network device that is directly connected to the transmit end of the packet, and the network boundary device at the receive end of the packet is a network device that is directly connected to the receive end of the packet. Non-network-boundary devices are other network devices among the network devices than the network boundary device at the transmit end of the packet and the network boundary device at the receive end of the packet.</p><p id="p0104" num="0104">As shown in <figref idrefs="f0005">FIG. 6</figref>, in this scenario, the method for a network device (non-network-boundary device) to determine the packet may include:
<ul><li>S601. The network device determines a color bit of a packet received by the network device.</li><li>S602. If the color bit of the packet received by the network device indicates that the packet received by the network device is colored, the network device determines that the packet received by the network device is the packet.</li></ul></p><p id="p0105" num="0105">According to indication of the color bit of the packet sent by the control device, the network device learns about a bit occupied by the color bit of the packet received by the network device, and thereby reads the color bit of the packet received by the network device. When the color bit of the packet received by the network device indicates that the packet received by the network device is colored, the network device may determine that the packet received by the network device is the packet, that is, the packet used to determine the transmission path. S603. The network device acquires a characteristic of the packet and an attribute of the packet according to the packet.</p><p id="p0106" num="0106">S604. The network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to the control device.</p><p id="p0107" num="0107">S605. The control device acquires multiple entries that are sent by multiple network devices and are of the packet.</p><p id="p0108" num="0108">S606. According to the multiple entries, the control device determines a transmission path of the packet.<!-- EPO <DP n="33"> --></p><p id="p0109" num="0109">After the control device acquires the multiple entries that are sent by multiple network devices and are of the packet, the control device may determine the transmission path of the packet according to the multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries.</p><p id="p0110" num="0110">Further, in the method for determining a transmission path of a packet provided in the embodiment of the present invention, other steps S603-S606 performed after the network device uses S601-S602 shown in <figref idrefs="f0005">FIG. 6</figref> to determine the packet are the same as other steps S304-S307 performed after the network device uses the method shown in <figref idrefs="f0002">FIG. 3</figref> to determine the packet. For details of other steps S603-S606 performed after the network device determines the packet, reference may be made to the description about S304-S307 in the foregoing embodiment, and no repeated description is given herein.</p><p id="p0111" num="0111">Further, in the method for determining a transmission path of a packet provided in the embodiment of the present invention, when the network device is a network boundary device, as shown in <figref idrefs="f0006">FIG. 7</figref>, before S601 shown in <figref idrefs="f0005">FIG. 6</figref>, the method may further include:
<ul><li>S607. The control device sends a description of a packet to multiple network devices.</li></ul></p><p id="p0112" num="0112">The network device may include a network boundary device. Specifically, for a description about S607, reference may be made to the description about S301, and no repeated description is given herein.</p><p id="p0113" num="0113">In the embodiment of the present invention, the control device sends the description of the packet to all network devices in a detection area manageable by the control device. However, in a scenario in which the packet includes a color bit of the packet, unless in a case in which the network boundary device determines that the packet received by the network boundary device is not colored, the network boundary device does not compare the packet received by the network boundary device with the description of the packet to determine whether the packet received by the network boundary device matches the description of the packet and to determine whether to color the packet received by the network boundary device.</p><p id="p0114" num="0114">As shown in <figref idrefs="f0006">FIG. 7</figref>, S602 shown in <figref idrefs="f0005">FIG. 6</figref> may include:
<ul><li>S6020. If the color bit of the packet received by the network boundary device indicates that the packet received by the network boundary device is not colored, the network boundary<!-- EPO <DP n="34"> --> device determines that the packet received by the network boundary device matches the description of the packet.</li><li>S6021. If the packet received by the network boundary device matches the description of the packet, the network boundary device sets a value of the color bit of the packet received by the network boundary device, so that the color bit of the packet received by the network boundary device is colored.</li><li>S6022. If the color bit of the packet received by the network boundary device indicates that the packet received by the network boundary device is colored, the network boundary device sets a value of the color bit of the packet received by the network boundary device, so that the color bit of the packet received by the network boundary device is not colored.</li></ul></p><p id="p0115" num="0115">It should be noted that, if the network device is a non-network-boundary device, the method shown in <figref idrefs="f0005">FIG. 6</figref> is performed; if the network device is a network boundary device, the method shown in <figref idrefs="f0006">FIG. 7</figref> is performed. Specifically, if the network boundary device is a network boundary device at a transmit end of the packet, the network boundary device may perform S6020-S6021; and if the network boundary device is a network boundary device at a receive end of the packet, the network boundary device may perform S6022. In the embodiment of the present invention, only a network boundary device can set the value of the color bit of the packet. Therefore, when the packet is transmitted from the transmit end of the packet to the network boundary device at the transmit end of the packet, the network boundary device at the transmit end of the packet sets the value of the color bit of the packet so that the packet is colored. Therefore, in a transmission process of the packet, according to the color bit of the packet, a non-network-boundary device may determine that the packet is a packet whose transmission path needs to be determined. Further, when the packet is transmitted to the network boundary device at the receive end of the packet, the network boundary device at the receive end of the packet sets the value of the color bit of the packet, so that the packet is not colored, thereby ensuring that the packet received by the receive end of the packet is the original packet sent by the transmit end of the packet.</p><p id="p0116" num="0116">Optionally, an idle bit in a packet header of the packet, for example, a specific bit in a service type field in the IP header of the packet or a specific bit in a Flags field in the IP header, may<!-- EPO <DP n="35"> --> be used as the color bit of the packet. The specific setting may be determined according to actual conditions, and is not limited by the present invention.</p><p id="p0117" num="0117">Exemplarily, it may be set that, when the value of the color bit of the packet is 0, the color bit of the packet indicates that the packet is not colored; and when the value of the color bit of the packet is 1, the color bit of the packet indicates that the packet is colored; or it may be set that, when the value of the color bit of the packet is 1, the color bit of the packet indicates that the packet is not colored; and when the value of the color bit of the packet is 0, the color bit of the packet indicates that the packet is colored. Specifically, the setting of the value of the color bit of the packet may be determined according to actual use requirements, and is not limited by the present invention.</p><p id="p0118" num="0118">Further, in S307 or S606, that is, after the control device determines the transmission path of the packet according to multiple entries, the control device may store the determined transmission path of the packet. In this way, when a fault occurs in a transmission process of the packet, the faulty transmission path or device of the packet can be located quickly and accurately according to the transmission path that is stored by the control device and is of the packet, so as to monitor the transmission process of the packet and thereby improve stability of the entire network.</p><p id="p0119" num="0119">In the method for determining a transmission path of a packet provided in the embodiment of the present invention, because a packet that actually flows through a network device is used in determining the transmission path of the packet, in comparison with a conventional method in which a simulated packet is used to determine a transmission path of a packet (the transmission path of the packet may represent a transmission path of a service flow that includes the packet), it is not necessary to learn about a structure of the simulated packet before determining the transmission path of the packet; and it is avoided that simulated packets occupy a large amount of network bandwidth and network device resources; and an actual transmission path of the packet can be determined in real time, and a problem is avoided that the determined transmission path of the packet is not accurate enough due to randomness of routing and forwarding of a network device, so that the transmission path of the packet can be determined conveniently and accurately in real time.<!-- EPO <DP n="36"> --></p><p id="p0120" num="0120">The embodiment of the present invention provides a method for determining a transmission path of a packet, where a network device determines a packet, and the network device acquires a characteristic of the packet and an attribute of the packet according to the packet; the network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device; and the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device. According to this solution, because the network device may send, to the control device, the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device, the control device can determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission.</p><heading id="h0008"><b>Embodiment 3</b></heading><p id="p0121" num="0121">As shown in <figref idrefs="f0007">FIG. 8</figref>, the embodiment of the present invention provides a network device 1, where the network device 1 may include:
<ul><li>a determining unit 10, configured to determine a packet; an acquiring unit 11, configured to acquire a characteristic of the packet and an attribute of the packet according to the packet determined by the determining unit 10; and a sending unit 12, configured to send the characteristic of the packet and the attribute of the packet that are acquired by the acquiring unit 11, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the<!-- EPO <DP n="37"> --> packet, and the attribute of the network device.</li></ul></p><p id="p0122" num="0122">Optionally, the network device 1 is a layer-2 network device, the characteristic that is acquired by the acquiring unit 11 and is of the packet includes a layer-3 identifier of the packet, and the attribute that is acquired by the acquiring unit 11 and is of the packet includes TTL of the packet and time of arrival of the packet at the layer-2 network device; or, the characteristic that is acquired by the acquiring unit 11 and is of the packet includes a layer-2 identifier of the packet, and the attribute that is acquired by the acquiring unit 11 and is of the packet includes TTL of the packet and time of arrival of the packet at the layer-2 network device.</p><p id="p0123" num="0123">Optionally, the network device 1 is a layer-3 network device, the characteristic that is acquired by the acquiring unit 11 and is of the packet includes a layer-3 identifier of the packet, and the attribute that is acquired by the acquiring unit 11 and is of the packet includes TTL of the packet.</p><p id="p0124" num="0124">Optionally, as shown in <figref idrefs="f0007">FIG. 9</figref>, the network device 1 is a gateway device, and the gateway device further includes a processing unit 13;<br/>
the determining unit 10 is further configured to determine whether the packet includes a layer-2 identifier of the packet; the sending unit 12 is further configured to: if the determining unit 10 determines that the packet includes the layer-2 identifier of the packet, send the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device to the control device, and the processing unit 13 is configured to remove the layer-2 identifier of the packet from the packet determined by the determining unit 10; and the processing unit 13 is further configured to: if the determining unit 10 determines that the packet does not include the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, and the sending unit 12 is further configured to send the layer-2 identifier of the packet, the layer-3 identifier of the packet, the mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and the IP address of the gateway device to the<!-- EPO <DP n="38"> --> control device.</p><p id="p0125" num="0125">Optionally, the network device 1 is a gateway device;<br/>
the determining unit 10 is further configured to determine whether the packet includes a layer-2 identifier of the packet; and the processing unit 13 is further configured to: if the determining unit 10 determines that the packet includes the layer-2 identifier of the packet, remove the layer-2 identifier of the packet from the packet, and if the determining unit 10 determines that the packet does not include the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, where a value of the layer-2 identifier of the packet is the same as a value<br/>
of the layer-3 identifier of the packet.</p><p id="p0126" num="0126">Optionally, the acquiring unit 11 is further configured to: before the determining unit 10 determines the packet, acquire a description that is sent by the control device and is of the packet; and<br/>
the determining unit 10 is specifically configured to: compare the description that is acquired by the acquiring unit 11 and is of the packet with a received packet; and if the received packet matches the description of the packet, determine that the<br/>
received packet is the packet.</p><p id="p0127" num="0127">Optionally, the packet determined by the determining unit 10 includes a color bit of the packet, where the color bit of the packet is used to indicate whether the packet is colored, and<br/>
the determining unit 10 is specifically configured to determine a color bit of a received packet, and if the color bit of the received packet indicates that the received packet is colored, determine that the received packet is the packet.</p><p id="p0128" num="0128">Optionally, when the network device 1 is a network boundary device,<br/>
the determining unit 10 is further configured to: if the color bit of the received packet indicates that the received packet is not colored, determine whether the received packet matches the description of the packet; and the processing unit 13 is further configured to: if the received packet matches the description of the packet, set a value of the color bit of the received packet so that the color bit of the received packet is colored.<!-- EPO <DP n="39"> --></p><p id="p0129" num="0129">Optionally, when the network device 1 is a network boundary device,<br/>
the determining unit 10 is further configured to: if the color bit of the received packet indicates that the received packet is colored, set the value of the color bit of<br/>
the received packet so that the color bit of the received packet is not colored. Optionally, the characteristic of the packet may further include a source IP address of the packet, or a source IP address of the packet and a destination IP address of the packet. Optionally, the description of the packet may include one or more of: a source IP address of the packet, a destination IP address of the packet, a protocol port number of the packet, and a DSCP of the packet.</p><p id="p0130" num="0130">Optionally, the attribute of the network device may include at least one of: an IP address of the network device, a MAC address of the network device, and a serial number allocated by a network management device to the network device.</p><p id="p0131" num="0131">Optionally, the attribute of the network device may further include at least one of: a port number used by the network device to receive the packet, and a port number used by the network device to send the packet.</p><p id="p0132" num="0132">The network device 1 provided in the embodiment of the present invention may be a network switch or a router or the like.</p><p id="p0133" num="0133">The embodiment of the present invention provides a network device, where the network device determines a packet, the network device acquires a characteristic of the packet and an attribute of the packet according to the packet, and the network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device; and the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device. According to this solution, because the network device may send, to the control device, the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device, the control device can determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the<!-- EPO <DP n="40"> --> network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission. As shown in <figref idrefs="f0007">FIG. 10</figref>, the embodiment of the present invention provides a control device 2, where the control device 2 may include:
<ul><li>an acquiring unit 20, configured to acquire multiple entries that are sent by multiple network devices and are of a packet, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry; and a determining unit 21, configured to determine a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the</li><li>multiple network devices in the multiple entries acquired by the acquiring unit 20.</li></ul></p><p id="p0134" num="0134">Optionally, the multiple network devices include a layer-2 network device, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device; or, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-2 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device.</p><p id="p0135" num="0135">Optionally, the multiple network devices include a layer-3 network device, a characteristic of the packet in an entry sent by the layer-3 network device includes the layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-3 network device includes TTL of the packet received by the layer-3 network device.<!-- EPO <DP n="41"> --></p><p id="p0136" num="0136">Optionally, the determining unit 21 is specifically configured to: sort the multiple entries according to the TTL of the packet and the time of arrival of the packet at the layer-2 network device; and determine that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet.</p><p id="p0137" num="0137">Optionally, the network device is a gateway device, and<br/>
the acquiring unit 20 is further configured to acquire the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device that are sent by the gateway device.</p><p id="p0138" num="0138">Optionally, the multiple entries acquired by the acquiring unit 20 include entries that have a same value of the layer-2 identifier of the packet and entries that have a same value of the layer-3 identifier of the packet, where the layer-2 identifier of the packet is mapped to the layer-3 identifier of the packet according to the mapping.</p><p id="p0139" num="0139">Optionally, as shown in <figref idrefs="f0008">FIG. 11</figref>, the control device may further include a sending unit 22, where<br/>
the sending unit 22 is further configured to: before the acquiring unit 20 acquires the multiple entries that are sent by the multiple network devices and are of the packet, send a description of the packet to the multiple network devices.</p><p id="p0140" num="0140">Optionally, the description of the packet may include one or more of: a source IP address of the packet, a destination IP address of the packet, a protocol port number of the packet, and a DSCP of the packet.</p><p id="p0141" num="0141">Optionally, the characteristic of the packet may further include a source IP address of the packet, or a source IP address of the packet and a destination IP address of the packet.</p><p id="p0142" num="0142">Optionally, the attributes of the multiple network devices may include at least one of: IP addresses of the multiple network devices, MAC addresses of the multiple network devices, and serial numbers allocated by a network management device to the multiple network devices.</p><p id="p0143" num="0143">Optionally, the attributes of the multiple network devices may further include at least one of: port numbers used by the multiple network devices to receive the packet, and port numbers<!-- EPO <DP n="42"> --> used by the multiple network devices to send the packet.</p><p id="p0144" num="0144">The control device 2 provided in the embodiment of the present invention may be a network management device or a controller or the like.</p><p id="p0145" num="0145">The embodiment of the present invention provides a control device, where the control device acquires multiple entries that are sent by multiple network devices and are of a packet, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry; and the control device determines a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries. According to this solution, because the control device can acquire the characteristic of the packet that is sent by the network device and actually flows through the network device, the attribute of the packet, and the attribute of the network device, and determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission.</p><heading id="h0009"><b>Embodiment 4</b></heading><p id="p0146" num="0146">As shown in <figref idrefs="f0008">FIG. 12</figref>, this embodiment of the present invention provides a network device, where the network device may include a processor 14, a system bus 16, and a communications interface 17.</p><p id="p0147" num="0147">The processor 14 may be a central processing unit (central processing unit, CPU for short), or<!-- EPO <DP n="43"> --> a network processor (English: network processor, NP for short).</p><p id="p0148" num="0148">If the processor 14 is a CPU, the network device further includes a memory 15, configured to store program code and transmit the program code to the processor 14, and the processor 14 executes the following instructions according to the program code. The memory 15 may include a volatile memory (English: volatile memory) such as a random access memory (English: random-access memory, RAM for short); or the memory 15 may also include a non-volatile memory (English: non-volatile memory) such as a read-only memory (English: read-only memory, ROM for short), a flash memory (English: flash memory), a hard disk drive (English: hard disk drive, HDD for short) or a solid-state drive (English: solid-state drive, SSD for short); and the memory 15 may also a combination of such types of memories. The processor 14, the memory 15 and the communications interface 17 are interconnected through a system bus 16 and communicate with each other.</p><p id="p0149" num="0149">The communications interface 17 may be implemented by an optical transceiver, an electrical transceiver, a radio transceiver, or any combination thereof. For example, the optical transceiver may be a small form-factor pluggable (English: small form-factor pluggable transceiver, SFP for short) transceiver (English: transceiver), an enhanced small form-factor pluggable (English: enhanced small form-factor pluggable, SFP+) transceiver or a 10 Gigabit small form-factor pluggable (English: 10 Gigabit small form-factor pluggable, XFP) transceiver. The electrical transceiver may be an Ethernet (English: Ethernet) network interface controller (English: network interface controller, NIC for short). The radio transceiver may be a wireless network interface controller (English: wireless network interface controller, WNIC for short).</p><p id="p0150" num="0150">When the network device runs, the processor 14 runs executable instructions of the network device to execute the method process shown in <figref idrefs="f0001">FIG. 1</figref> or any one of <figref idrefs="f0002 f0003 f0004 f0005 f0006">FIG. 3 to FIG. 7</figref>, specifically including:
<ul><li>the processor 14 is configured to determine a packet; and acquire a characteristic of the packet and an attribute of the packet according to the packet; and send the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device through the communications interface 17; and<!-- EPO <DP n="44"> --> the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device; and the memory 15 is configured to store the characteristic of the packet, the attribute of the packet, the attribute of the network device, and a program that controls the processor 14 to complete the foregoing process, so that the processor 14 completes the foregoing process by executing the program and invoking the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</li></ul></p><p id="p0151" num="0151">Optionally, the network device is a layer-2 network device, the characteristic that is acquired by the processor 14 and is of the packet includes a layer-3 identifier of the packet, and the attribute that is acquired by the processor 14 and is of the packet includes TTL of the packet and time of arrival of the packet at the layer-2 network device; or, the characteristic that is acquired by the processor 14 and is of the packet includes a layer-2 identifier of the packet, and the attribute that is acquired by the processor 14 and is of the packet includes TTL of the packet and time of arrival of the packet at the layer-2 network device.</p><p id="p0152" num="0152">Optionally, the network device is a layer-3 network device, the characteristic that is acquired by the processor 14 and is of the packet includes a layer-3 identifier of the packet, and the attribute that is acquired by the processor 14 and is of the packet includes TTL of the packet. Optionally, the network device is a gateway device;<br/>
the processor 14 is further configured to determine whether the packet includes a layer-2 identifier of the packet; and if the packet includes the layer-2 identifier of the packet, send the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and the IP address of the gateway device to the control device from the communications interface 17, and remove the layer-2 identifier of the packet from the packet; and<br/>
the processor 14 is further configured to: if the packet does not include the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, and send the layer-2 identifier of the packet, the layer-3 identifier of the packet, the<!-- EPO <DP n="45"> --> mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and the IP address of the gateway device to the control device from the communications interface 17.</p><p id="p0153" num="0153">Optionally, the network device is a gateway device; and<br/>
the processor 14 is further configured to: determine whether the packet includes a layer-2 identifier of the packet; and if the packet includes the layer-2 identifier of the packet, remove the layer-2 identifier of the packet from the packet, and if the packet does not include the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, where a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet.</p><p id="p0154" num="0154">Optionally, the processor 14 is further configured to: before determining the packet, acquire a description that is sent by the control device and is of the packet from the communications interface 17; and<br/>
the processor 14 is specifically configured to: compare the description of the packet with a received packet; and if the received packet matches the description of the packet, determine that the received packet is the packet.</p><p id="p0155" num="0155">Optionally, the packet determined by the processor 14 includes a color bit of the packet, where the color bit of the packet is used to indicate whether the packet is colored; and<br/>
the processor 14 is specifically configured to determine a color bit of a received packet, and if the color bit of the received packet indicates that the received packet is colored, determine that the received packet is the packet.</p><p id="p0156" num="0156">Optionally, when the network device is a network boundary device,<br/>
the processor 14 is further configured to: if the color bit of the received packet indicates that the received packet is not colored, determine whether the received packet matches the description of the packet; and if the received packet matches the description of the packet, set the value of the color bit of the received packet so that the color bit of the received packet is colored.</p><p id="p0157" num="0157">Optionally, when the network device is a network boundary device,<br/>
the processor 14 is further configured to: if the color bit of the received packet<!-- EPO <DP n="46"> --> indicates that the received packet is colored, set the value of the color bit of the<br/>
received packet so that the color bit of the received packet is not colored. Optionally, the characteristic of the packet may further include a source IP address of the packet, or a source IP address of the packet and a destination IP address of the packet. Optionally, the description of the packet may include one or more of: a source IP address of the packet, a destination IP address of the packet, a protocol port number of the packet, and a DSCP of the packet.</p><p id="p0158" num="0158">Optionally, the attribute of the network device may include at least one of: an IP address of the network device, a MAC address of the network device, and a serial number allocated by a network management device to the network device.</p><p id="p0159" num="0159">Optionally, the attribute of the network device may further include at least one of: a port number used by the network device to receive the packet, and a port number used by the network device to send the packet.</p><p id="p0160" num="0160">The network device provided in the embodiment of the present invention may be a network switch or a router or the like.</p><p id="p0161" num="0161">The embodiment of the present invention provides a network device, where the network device determines a packet, the network device acquires a characteristic of the packet and an attribute of the packet according to the packet, and the network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device; and the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device. According to this solution, because the network device may send, to the control device, the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device, the control device can determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet<!-- EPO <DP n="47"> --> affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission.</p><p id="p0162" num="0162">As shown in <figref idrefs="f0008">FIG. 13</figref>, the embodiment of the present invention provides a control device, where the control device may include a processor 23, a memory 24, a system bus 25, and a communications interface 26. The processor 23, the memory 24 and the communications interface 26 are interconnected through a system bus 25 and communicate with each other.</p><p id="p0163" num="0163">The processor 23 is a central processing unit.</p><p id="p0164" num="0164">The memory 24 may include a RAM, and may also include a non-volatile memory, for example, at least one disk memory.</p><p id="p0165" num="0165">When the control device runs, the processor 23 runs executable instructions of the control device to execute the method process shown in <figref idrefs="f0001">FIG. 2</figref> or any one of <figref idrefs="f0002 f0003 f0004 f0005 f0006">FIG. 3 to FIG. 7</figref>, specifically including:
<ul><li>the processor 23 is configured to acquire multiple entries that are sent by multiple network devices and are of a packet from the communications interface 26, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other,</li><li>and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry; and determine a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and</li><li>attributes of the multiple network devices in the multiple entries; and the memory 24 is configured to store the multiple entries and is configured to store a program that controls the processor 23 to complete the foregoing process, so that the processor 23 completes the foregoing process by executing the program and invoking the multiple entries.</li></ul></p><p id="p0166" num="0166">Optionally, the multiple network devices include a layer-2 network device, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-3 identifier of the<!-- EPO <DP n="48"> --> packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device; or, a characteristic of the packet in an entry sent by the layer-2 network device includes a layer-2 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device includes TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device.</p><p id="p0167" num="0167">Optionally, the multiple network devices include a layer-3 network device, a characteristic of the packet in an entry sent by the layer-3 network device includes the layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-3 network device includes TTL of a packet received by the layer-3 network device.</p><p id="p0168" num="0168">Optionally, the processor 23 is specifically configured to: sort the multiple entries according to the TTL of the packet and the time of arrival of the packet at the layer-2 network device; and determine that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet.</p><p id="p0169" num="0169">Optionally, the network device is a gateway device, and<br/>
the processor 23 is further configured to acquire the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device that are sent by the gateway device.</p><p id="p0170" num="0170">Optionally, the multiple entries acquired by the processor 23 include entries that have a same value of the layer-2 identifier of the packet and entries that have a same value of the layer-3 identifier of the packet, where the layer-2 identifier of the packet is mapped to the layer-3 identifier of the packet according to the mapping.</p><p id="p0171" num="0171">Optionally, the processor 23 is further configured to: before acquiring the multiple entries that are sent by the multiple network devices and are of the packet, send a description of the packet to the multiple network devices.</p><p id="p0172" num="0172">Optionally, the description of the packet may include one or more of: a source IP address of the packet, a destination IP address of the packet, a protocol port number of the packet, and a DSCP of the packet.<!-- EPO <DP n="49"> --></p><p id="p0173" num="0173">Optionally, the characteristic of the packet may further include a source IP address of the packet, or a source IP address of the packet and a destination IP address of the packet.</p><p id="p0174" num="0174">Optionally, the attributes of the multiple network devices may include at least one of: IP addresses of the multiple network devices, MAC addresses of the multiple network devices, and serial numbers allocated by a network management device to the multiple network devices.</p><p id="p0175" num="0175">Optionally, the attributes of the multiple network devices may further include at least one of: port numbers used by the multiple network devices to receive the packet, and port numbers used by the multiple network devices to send the packet.</p><p id="p0176" num="0176">The control device provided in the embodiment of the present invention may be a network management device or a controller or the like.</p><p id="p0177" num="0177">The embodiment of the present invention provides a control device, where the control device acquires multiple entries that are sent by multiple network devices and are of a packet, where characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries includes a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry, and the control device determines a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries. According to this solution, because the control device can acquire the characteristic of the packet that is sent by the network device and actually flows through the network device, the attribute of the packet, and the attribute of the network device, and determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the<!-- EPO <DP n="50"> --> transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission.</p><heading id="h0010"><b>Embodiment 5</b></heading><p id="p0178" num="0178">As shown in <figref idrefs="f0009">FIG. 14</figref>, this embodiment of the present invention provides a system for determining a transmission path of a packet. The system for determining a transmission path of a packet may include multiple network devices and the control device according to Embodiment 3; or the system for determining a transmission path of a packet may include multiple network devices and the control device according to Embodiment 4.</p><p id="p0179" num="0179">Specifically, for a detailed process used by the network devices and the control device to execute the method for determining a transmission path of a packet provided in the embodiments of the present invention so as to determine a transmission path of a packet, reference may be made to the related description in Embodiment 1 and Embodiment 2, and no repeated description is given herein.</p><p id="p0180" num="0180">For example, as shown in <figref idrefs="f0009">FIG. 14</figref>, it is assumed that the system for determining a transmission path of a packet includes a control device, and that a detection area manageable by the control device includes 7 network devices: network device 1, network device 2, network device 3, network device 4, network device 5, a network device 6, and network device 7. If there are two packets, packet A and packet B, packet A needs to be sent from packet transmitting end A to packet receiving end A, and packet B needs to be sent from packet transmitting end B to packet receiving end B, then in a process of transmitting the two packets, the method for determining a transmission path of a packet according to the embodiment of the present invention may be used to determine actual transmission paths of the two packets in a network.</p><p id="p0181" num="0181">Specifically, when packet A is sent from packet transmitting end A, and flows through network device 1, network device 2, network device 3, and network device 4 until it arrives at packet receiving end A, the corresponding network device 1, network device 2, network device 3, and network device 4 may separately execute the method for determining a transmission path of a packet according to the embodiment of the present invention, and send<!-- EPO <DP n="51"> --> a characteristic of the packet, an attribute of the packet, and an attribute of the network device to the control device, so that the control device may determine, according to the information sent by network device 1, network device 2, network device 3, and network device 4, that the transmission path of packet A is " packet transmitting end A-network device 1-network device 2-network device 3-network device 4-packet receiving end A". When the packet in packet B is sent from packet transmitting end B, and flows through network device 5, network device 6, network device 7, and network device 4 until it arrives at packet receiving end B, the corresponding network device 5, network device 6, network device 7, and network device 4 may separately execute the method for determining a transmission path of a packet according to the embodiment of the present invention, and send a characteristic of the packet, an attribute of the packet, and an attribute of the network device to the control device, so that the control device can determine, according to the information sent by network device 5, network device 6, network device 7, and network device 4, that the transmission path of packet B is "packet transmitting end B-network device 5-network device 6-network device 7-network device 4-packet receiving end B". By using the system for determining a transmission path of a packet, a transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission. In this way, when a fault occurs in the transmission process of the packet, a faulty transmission path or device of the packet can be located quickly and accurately, and further, the transmission process of the packet may be monitored, so as to improve stability of the entire network.</p><p id="p0182" num="0182">The embodiment of the present invention provides a system for determining a transmission path of a packet, where a network device that the packet flows through determines a packet, and the network device acquires a characteristic of the packet and an attribute of the packet according to the packet; the network device sends the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device; and the control device determines a transmission path of the packet according to multiple characteristics of the packet, multiple attributes of the packet when multiple network devices receive the packet, and attributes of the multiple network devices, where the characteristics, the attributes of the<!-- EPO <DP n="52"> --> packet, and the attributes of the network devices are sent by the multiple network devices that the packet flows through. According to this solution, because the network device may send, to the control device, the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device, the control device can determine a transmission path of the packet that actually flows through the network device, that is, an actual transmission path of the packet, according to the characteristic of the packet that actually flows through the network device, the attribute of the packet, and the attribute of the network device. Therefore, a problem that a determined transmission path of a packet is generally not accurate enough and that the determining of a transmission path of a packet affects normal packet transmission due to occupation of a large amount of network bandwidth is solved, the transmission path of the packet can be determined accurately, and the determining of a transmission path of a packet does not affect normal packet transmission.</p><p id="p0183" num="0183">It may be clearly understood by a person skilled in the art that, for the purpose of convenient and brief description, division of the foregoing function modules is taken as an example for illustration. In actual application, the foregoing functions can be allocated to different function modules and implemented according to a requirement, that is, an inner structure of an apparatus is divided into different function modules to implement all or part of the functions described above. For a detailed working process of the foregoing system, apparatus, and unit, reference may be made to a corresponding process in the foregoing method embodiments, and details are not described herein again.</p><p id="p0184" num="0184">In the several embodiments provided in the present application, it should be understood that the disclosed system, apparatus, and method may be implemented in other manners. For example, the described apparatus embodiment is merely exemplary. For example, the module or unit division is merely logical function division and may be other division in actual implementation. For example, a plurality of units or components may be combined or integrated into another system, or some features may be ignored or not performed. In addition, the displayed or discussed mutual couplings or direct couplings or communication connections may be indirect couplings or communication connections between the apparatuses or units through some interfaces.<!-- EPO <DP n="53"> --></p><p id="p0185" num="0185">The units described as separate parts may or may not be physically separate, and parts displayed as units may or may not be physical units, may be located in one position, or may be distributed on a plurality of network units. A part or all of the units may be selected according to actual needs to achieve the objectives of the solutions of the embodiments.</p><p id="p0186" num="0186">In addition, functional units in the embodiments of the present invention may be integrated into one processing unit, or each of the units may exist alone physically, or two or more units are integrated into one unit. The integrated unit may be implemented in the form of a software functional unit.</p><p id="p0187" num="0187">When the integrated unit is implemented in the form of a software functional unit and sold or used as an independent product, the integrated unit may be stored in a computer-readable storage medium. Based on such an understanding, a part or all of the technical solutions of the present invention may be implemented in a form of a software product. The software product is stored in a storage medium and includes several instructions for instructing a computer device (which may be a personal computer, a server, or a network device) or a processor to perform all or a part of the steps of the methods described in the embodiments of the present invention. The foregoing storage medium is a non-transitory (English: non-transitory) medium, including all kinds of media that can store program code, such as a flash memory, a removable hard disk, a read-only memory, a random access memory, a magnetic disk, or an optical disc.</p><p id="p0188" num="0188">The foregoing descriptions are merely specific implementation manners of the present invention, but are not intended to limit the protection scope of the present invention. Any variation or replacement readily figured out by a person skilled in the art within the technical scope disclosed in the present invention shall fall within the protection scope of the present invention. Therefore, the protection scope of the present invention shall be subject to the protection scope of the claims.</p></description><claims mxw-id="PCLM90459590" lang="EN" load-source="patent-office"><!-- EPO <DP n="54"> --><claim id="c-en-0001" num="0001"><claim-text>A method for determining a transmission path of a packet, comprising:
<claim-text>determining, by a network device, a packet;</claim-text>
<claim-text>acquiring, by the network device, a characteristic of the packet and an attribute of the packet according to the packet; and</claim-text>
<claim-text>sending, by the network device, the characteristic of the packet, the attribute of the packet, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein<br/>
the network device is a layer-2 network device, the characteristic of the packet comprises a layer-3 identifier of the packet, and the attribute of the packet comprises time to live, TTL, of the packet and time of arrival of the packet at the layer-2 network device; or, the characteristic of the packet comprises a layer-2 identifier of the packet, and the attribute of the packet comprises TTL of the packet and time of arrival of the packet at the layer-2 network device.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 1, wherein<br/>
the network device is a layer-3 network device, the characteristic of the packet comprises a layer-3 identifier of the packet, and the attribute of the packet comprises TTL of the packet.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to claim 3, wherein the network device is a gateway device, and the method further comprises:
<claim-text>determining, by the gateway device, whether the packet comprises a layer-2 identifier of the packet;</claim-text>
<claim-text>if the packet comprises the layer-2 identifier of the packet, sending, by the gateway device to the control device, the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device, and removing the layer-2 identifier of the packet from the packet; or<!-- EPO <DP n="55"> --></claim-text>
<claim-text>if the packet does not comprise the layer-2 identifier of the packet, adding, by the gateway device, the layer-2 identifier of the packet into the packet, and sending, to the control device, the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to claim 3, wherein the network device is a gateway device, and the method further comprises:
<claim-text>determining, by the gateway device, whether the packet comprises a layer-2 identifier of the packet;</claim-text>
<claim-text>if the packet comprises the layer-2 identifier of the packet, removing, by the gateway device, the layer-2 identifier of the packet from the packet, wherein a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet; or</claim-text>
<claim-text>if the packet does not comprise the layer-2 identifier of the packet, adding, by the gateway device, the layer-2 identifier of the packet into the packet, wherein a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A method for determining a transmission path of a packet, comprising:
<claim-text>acquiring, by a control device, multiple entries that are sent by multiple network devices and are of a packet, wherein characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries comprises a characteristic of the packet, an attribute of the packet that the packet has when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry; and</claim-text>
<claim-text>determining, by the control device, a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method according to claim 6, wherein<br/>
the multiple network devices comprise a layer-2 network device, a characteristic of the packet in an entry sent by the layer-2 network device comprises a layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device<!-- EPO <DP n="56"> --> comprises time to live, TTL, of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device; or, a characteristic of the packet in an entry sent by the layer-2 network device comprises a layer-2 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device comprises TTL of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device.</claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method according to claim 7, wherein<br/>
the multiple network devices comprise a layer-3 network device, a characteristic of the packet in an entry sent by the layer-3 network device comprises a layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-3 network device comprises TTL of the packet received by the layer-3 network device.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method according to claim 8, wherein the determining, by the control device, a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries comprises:
<claim-text>sorting, by the control device, the multiple entries according to the TTL of the packet and the time of arrival of the packet at the layer-2 network device; and</claim-text>
<claim-text>determining, by the control device, that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A network device, comprising:
<claim-text>a determining unit, configured to determine a packet;</claim-text>
<claim-text>an acquiring unit, configured to acquire a characteristic of the packet and an attribute of the packet according to the packet determined by the determining unit; and</claim-text>
<claim-text>a sending unit, configured to send the characteristic of the packet and the attribute of the packet that are acquired by the acquiring unit, and an attribute of the network device to a control device, so that the control device determines a transmission path of the packet according to the characteristic of the packet, the attribute of the packet, and the attribute of the network device.</claim-text></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The network device according to claim 10, wherein<br/>
<!-- EPO <DP n="57"> -->the network device is a layer-2 network device, the characteristic that is acquired by the acquiring unit and is of the packet comprises a layer-3 identifier of the packet, and the attribute that is acquired by the acquiring unit and is of the packet comprises time to live, TTL, of the packet and time of arrival of the packet at the layer-2 network device; or, the characteristic that is acquired by the acquiring unit and is of the packet comprises a layer-2 identifier of the packet, and the attribute that is acquired by the acquiring unit and is of the packet comprises TTL of the packet and time of arrival of the packet at the layer-2 network device.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The network device according to claim 10, wherein<br/>
the network device is a layer-3 network device, the characteristic that is acquired by the acquiring unit and is of the packet comprises a layer-3 identifier of the packet, and the attribute that is acquired by the acquiring unit and is of the packet comprises TTL of the packet.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The network device according to claim 12, wherein the network device is a gateway device, and the gateway device further comprises a processing unit;<br/>
the determining unit is further configured to determine whether the packet comprises a layer-2 identifier of the packet;<br/>
the sending unit is further configured to, if the determining unit determines that the packet comprises the layer-2 identifier of the packet, send the layer-2 identifier of the packet, the layer-3 identifier of the packet, a mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and an IP address of the gateway device to the control device, and the processing unit is configured to remove the layer-2 identifier of the packet from the packet determined by the determining unit; and<br/>
the processing unit is further configured to, if the determining unit determines that the packet does not comprise the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, and the sending unit is further configured to send the layer-2 identifier of the packet, the layer-3 identifier of the packet, the mapping between the layer-2 identifier of the packet and the layer-3 identifier of the packet, and the IP address of the gateway device to the control device.<!-- EPO <DP n="58"> --></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The network device according to claim 12, wherein the network device is a gateway device, and the gateway device further comprises a processing unit;<br/>
the determining unit is further configured to determine whether the packet comprises a layer-2 identifier of the packet; and<br/>
the processing unit is configured to: if the determining unit determines that the packet comprises the layer-2 identifier of the packet, remove the layer-2 identifier of the packet from the packet, and if the determining unit determines that the packet does not comprise the layer-2 identifier of the packet, add the layer-2 identifier of the packet into the packet, wherein a value of the layer-2 identifier of the packet is the same as a value of the layer-3 identifier of the packet.</claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>A control device, comprising:
<claim-text>an acquiring unit, configured to acquire multiple entries that are sent by multiple network devices and are of a packet, wherein characteristics of the packet in the multiple entries are the same or the characteristics of the packet in the multiple entries are corresponding to each other, and each entry of the multiple entries comprises a characteristic of the packet, an attribute of the packet when a network device that sends the entry receives the packet, and an attribute of the network device that sends the entry; and</claim-text>
<claim-text>a determining unit, configured to determine a transmission path of the packet according to multiple attributes of the packet when the multiple network devices receive the packet, and attributes of the multiple network devices in the multiple entries acquired by the acquiring unit.</claim-text></claim-text></claim><claim id="c-en-0016" num="0016"><claim-text>The control device according to claim 15, wherein<br/>
the multiple network devices comprise a layer-2 network device, a characteristic of the packet in an entry sent by the layer-2 network device comprises a layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device comprises time to live, TTL, of the packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device; or, a characteristic of the packet in an entry sent by the layer-2 network device comprises a layer-2 identifier of the packet, and an attribute of the packet in the entry sent by the layer-2 network device comprises TTL of the<!-- EPO <DP n="59"> --> packet received by the layer-2 network device and time of arrival of the packet at the layer-2 network device.</claim-text></claim><claim id="c-en-0017" num="0017"><claim-text>The control device according to claim 16, wherein<br/>
the multiple network devices comprise a layer-3 network device, a characteristic of the packet in an entry sent by the layer-3 network device comprises a layer-3 identifier of the packet, and an attribute of the packet in the entry sent by the layer-3 network device comprises TTL of the packet received by the layer-3 network device.</claim-text></claim><claim id="c-en-0018" num="0018"><claim-text>The control device according to claim 17, wherein<br/>
the determining unit is specifically configured to: sort the multiple entries according to the TTL of the packet and the time of arrival of the packet at the layer-2 network device; and determine that the attributes of the multiple network devices in the sorted multiple entries are the transmission path of the packet.</claim-text></claim></claims><drawings mxw-id="PDW20422312" load-source="patent-office"><!-- EPO <DP n="60"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="120" he="213" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="61"> --><figure id="f0002" num="3"><img id="if0002" file="imgf0002.tif" wi="144" he="181" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="62"> --><figure id="f0003" num="4"><img id="if0003" file="imgf0003.tif" wi="148" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="63"> --><figure id="f0004" num="5"><img id="if0004" file="imgf0004.tif" wi="148" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="64"> --><figure id="f0005" num="6"><img id="if0005" file="imgf0005.tif" wi="148" he="166" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="65"> --><figure id="f0006" num="7"><img id="if0006" file="imgf0006.tif" wi="165" he="229" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="66"> --><figure id="f0007" num="8,9,10"><img id="if0007" file="imgf0007.tif" wi="71" he="192" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="67"> --><figure id="f0008" num="11,12,13"><img id="if0008" file="imgf0008.tif" wi="98" he="192" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="68"> --><figure id="f0009" num="14"><img id="if0009" file="imgf0009.tif" wi="165" he="104" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="157" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="157" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
