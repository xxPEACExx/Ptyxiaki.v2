<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961117-A1" country="EP" doc-number="2961117" kind="A1" date="20151230" family-id="51853190" file-reference-id="317511" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451225" ucid="EP-2961117-A1"><document-id><country>EP</country><doc-number>2961117</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13884021-A" is-representative="YES"><document-id mxw-id="PAPP193865418" load-source="patent-office" format="original"><country>EP</country><doc-number>13884021.0</doc-number><date>20131227</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193865419" load-source="docdb" format="epo"><country>EP</country><doc-number>13884021</doc-number><kind>A</kind><date>20131227</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162026430" ucid="CN-2013090643-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2013090643</doc-number><kind>W</kind><date>20131227</date></document-id></priority-claim><priority-claim mxw-id="PPC162031207" ucid="CN-201310173273-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201310173273</doc-number><kind>A</kind><date>20130510</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1969298534" load-source="docdb">H04L  12/723       20130101AFI20160205BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1823303362" load-source="docdb" scheme="CPC">H04L  47/50        20130101 LI20170417BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984017052" load-source="docdb" scheme="CPC">H04L  45/50        20130101 FI20160114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984021567" load-source="docdb" scheme="CPC">H04L  45/507       20130101 LI20160114BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165545141" lang="DE" load-source="patent-office">VERFAHREN, KNOTENVORRICHTUNG UND SYSTEM ZUR HERSTELLUNG EINES LABEL-SWITCH-PFADS</invention-title><invention-title mxw-id="PT165545142" lang="EN" load-source="patent-office">METHOD, DEVICE AND SYSTEM FOR ESTABLISHING LABEL SWITCHED PATH</invention-title><invention-title mxw-id="PT165545143" lang="FR" load-source="patent-office">PROCÉDÉ, DISPOSITIF ET SYSTÈME D'ÉTABLISSEMENT D'UN CHEMIN COMMUTÉ PAR ÉTIQUETTE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103311602" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI TECH CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103343690" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI TECHNOLOGIES CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101653986" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Technologies Co., Ltd.</last-name><iid>100970540</iid><address><street>Huawei Administration Building Bantian</street><city>LONGGANG DISTRICT SHENZHEN, GUANGDONG 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103307433" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>LI ZHENBIN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103315129" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>LI, ZHENBIN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101653594" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>LI, ZHENBIN</last-name><address><street>Huawei Administration Building Bantian Longgang</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101648059" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Reinhard - Skuhra - Weise &amp; Partner GbR</last-name><iid>100060500</iid><address><street>Patentanwälte Behnisch Barth Charles Hassa Peckmann &amp; Partner mbB Friedrichstrasse 31</street><city>80801 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2013090643-W"><document-id><country>CN</country><doc-number>2013090643</doc-number><kind>W</kind><date>20131227</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014180153-A1"><document-id><country>WO</country><doc-number>2014180153</doc-number><kind>A1</kind><date>20141113</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660603993" load-source="docdb">AL</country><country mxw-id="DS660607133" load-source="docdb">AT</country><country mxw-id="DS660604011" load-source="docdb">BE</country><country mxw-id="DS660782261" load-source="docdb">BG</country><country mxw-id="DS660681733" load-source="docdb">CH</country><country mxw-id="DS660606823" load-source="docdb">CY</country><country mxw-id="DS660607134" load-source="docdb">CZ</country><country mxw-id="DS660604012" load-source="docdb">DE</country><country mxw-id="DS660606824" load-source="docdb">DK</country><country mxw-id="DS660606825" load-source="docdb">EE</country><country mxw-id="DS660684190" load-source="docdb">ES</country><country mxw-id="DS660782262" load-source="docdb">FI</country><country mxw-id="DS660682199" load-source="docdb">FR</country><country mxw-id="DS660604013" load-source="docdb">GB</country><country mxw-id="DS660606826" load-source="docdb">GR</country><country mxw-id="DS660604014" load-source="docdb">HR</country><country mxw-id="DS660607135" load-source="docdb">HU</country><country mxw-id="DS660681734" load-source="docdb">IE</country><country mxw-id="DS660606831" load-source="docdb">IS</country><country mxw-id="DS660682200" load-source="docdb">IT</country><country mxw-id="DS660606832" load-source="docdb">LI</country><country mxw-id="DS660782263" load-source="docdb">LT</country><country mxw-id="DS660681643" load-source="docdb">LU</country><country mxw-id="DS660782264" load-source="docdb">LV</country><country mxw-id="DS660782265" load-source="docdb">MC</country><country mxw-id="DS660681644" load-source="docdb">MK</country><country mxw-id="DS660681645" load-source="docdb">MT</country><country mxw-id="DS660684199" load-source="docdb">NL</country><country mxw-id="DS660682201" load-source="docdb">NO</country><country mxw-id="DS660681646" load-source="docdb">PL</country><country mxw-id="DS660681747" load-source="docdb">PT</country><country mxw-id="DS660684200" load-source="docdb">RO</country><country mxw-id="DS660681748" load-source="docdb">RS</country><country mxw-id="DS660681651" load-source="docdb">SE</country><country mxw-id="DS660604031" load-source="docdb">SI</country><country mxw-id="DS660682202" load-source="docdb">SK</country><country mxw-id="DS660681652" load-source="docdb">SM</country><country mxw-id="DS660606833" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479595" lang="EN" load-source="patent-office"><p id="pa01" num="0001">The present application discloses a method, a device and a system for establishing an LSP. The method includes: allocating, by a proxy node device, a label for a destination node device, generating a label mapping message carrying the label, an address of the destination node device and an address of the proxy node device, and sending the label mapping message to an upstream node device to initiate establishment of a first LSP from an entry node device to the proxy node device; stitching, by the proxy node device, the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device and the destination node device. According to technical solutions in embodiments of the present invention, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.<img id="iaf01" file="imgaf001.tif" wi="98" he="70" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759407" lang="EN" source="EPO" load-source="docdb"><p>The present application discloses a method, a device and a system for establishing an LSP. The method includes: allocating, by a proxy node device, a label for a destination node device, generating a label mapping message carrying the label, an address of the destination node device and an address of the proxy node device, and sending the label mapping message to an upstream node device to initiate establishment of a first LSP from an entry node device to the proxy node device; stitching, by the proxy node device, the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device and the destination node device. According to technical solutions in embodiments of the present invention, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.</p></abstract><description mxw-id="PDES98404296" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">Embodiments of the present invention relate to communications technologies and, in particular, to a method, a device and a system for establishing a label switched path (Label Switched Path, LSP).</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">As shown in <figref idrefs="f0001">FIG. 1</figref>, in a carrier's carrier (carrier's carrier) solution in the prior art, an internal gateway protocol (Internal Gateway Protocol, IGP) + a label distribution protocol (Label Distribution Protocol, LDP) are utilized between a customer equipment (Customer Edge, CE) of a backbone carrier and a provider edge equipment (Provider Edge, PE) of the backbone carrier. PEs inside the backbone carrier use a boarder gateway protocol (Border Gateway Protocol, BGP) to advertise a route and a label of a customer carrier. A PE equipment of a customer carrier, which is a customer carrier provider edge equipment (customer provider edge, C-PE) in <figref idrefs="f0001">FIG. 1</figref>, needs to establish a label switched path (Label Switch Path, LSP) from a C-PE2 of an upstream second customer carrier to a C-PE1 of a downstream first customer carrier in order to be able to provide its customer with a virtual private network (Virtual Private Network, VPN) service.</p><p id="p0003" num="0003">IGP + LDP protocols run in an internal network of the backbone carrier and run between a customer equipment CE1 and a PE1 equipment of the backbone carrier. On the PE1 equipment, both protocols belong to a virtual routing and forwarding (Virtual Routing and Forwarding, VRF). An LSP from the PE1 to the C-PE1 is established via the LDP. The PE1 learns a route to the C-PE1 via the IGP.<!-- EPO <DP n="2"> --></p><p id="p0004" num="0004">In a VRF instance on the PE1 equipment of the backbone carrier, the IGP route in the VRF instance is introduced into the BGP VPN, which uses the BGP to advertise a route (a route from the CE1 to the C-PE1) of the customer carrier to a PE2 equipment of a remote backbone carrier. When advertising a private network route, the BGP allocates a label for each route in a per-route per-label method and advertises a route together with the label allocated for the route to the PE2 equipment via the BGP. The PE1 takes a label of the route allocated by the CE1 for the PE1 via the LDP and the PE1 locally. A multi-protocol label switching (Multi-Protocol Label Switching, MPLS) is a technique used for fast packet switching and routing, it provides network traffic with capabilities such as targeting, routing, forwarding, switching and etc. In the MPLS, data transmission occurs on an LSP, reasonable establishment of the LSP can greatly reduce cooperation between different network layers when services are deployed, thereby improving a forwarding speed. Thus, how to establish the LSP reasonably is critical for a carrier to quickly provide services and lowers service deployment costs.</p><p id="p0005" num="0005">Seamless (Seamless) MPLS networking refers to a networking manner that all internet protocol (Internet Protocol, IP) devices managed by carriers, including access network devices, convergence network devices and backbone network devices, form a unified IP/MPLS control plane. Currently, in a solution of an IP radio access network (Radio Access Network, RAN) based on the seamless MPLS, when an access network integrates with the IP backbone network, the access network stitches (Stitch) with a border gateway protocol (Border Gateway Protocol, BGP) LSP established by the IP backbone network mainly via an LSP established by the label distribution protocol (Label Distribution Protocol, LDP), thereby completing an integration of the access network of the IP RAN with the IP backbone network. During this process, a node device in the access network needs to statically configure a route reaching a BGP LSP destination device in the IP backbone network; the static configuration of the route is complicated, which thereby increases difficulty of maintenance and management of node devices.<!-- EPO <DP n="3"> --></p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0006" num="0006">Embodiments of the present invention provide a method, a device and a system for establishing an LSP, which are used to solve problems of complicated configuration as well as difficult management and maintenance due to a need of static routing configuration when LSPs of different protocols are stitched in the prior art.</p><p id="p0007" num="0007">In a first aspect, a method for establishing an LSP is provided, and the method includes:
<ul><li>allocating, by a proxy node device, a label for a destination node device;</li><li>generating, by the proxy node device, a label mapping message, where the label mapping message carries the label, an address of the destination node device and an address of the proxy node device;</li><li>sending, by the proxy node device, the label mapping message to an upstream node device of the proxy node device to initiate establishment of a first LSP from an entry node device to the proxy node device; and</li><li>stitching, by the proxy node device, the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, wherein the second LSP is an LSP established between the proxy node device and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</li></ul></p><p id="p0008" num="0008">According to the first aspect, a first possible implementation mode of the first aspect is further provided. In the first possible implementation mode of the first aspect, before the allocating, by a proxy node device, a label for a destination node device, the method further includes:
<ul><li>receiving, a label request message sent by the upstream node, where the label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0009" num="0009">According to the first aspect or the first possible implementation mode of the first aspect, a second possible implementation mode of the first aspect is further provided. In the second possible implementation mode of the first aspect, the label mapping message further carries a topology identification (ID) to enable the first LSP to be established in a network<!-- EPO <DP n="4"> --> topology corresponding to the topology ID.</p><p id="p0010" num="0010">According to the first aspect or any one of the above possible implementation modes of the first aspect, a third possible implementation mode of the first aspect is further provided. In the third possible implementation mode of the first aspect, the label mapping message is a label distribution protocol LDP label mapping message, and the address of the destination node device and the address of the proxy node device are carried by extending a prefix forwarding equivalence class element (Prefix FEC Element) of the label mapping message.</p><p id="p0011" num="0011">According to the first aspect or any one of the above possible implementation modes of the first aspect, a fourth possible implementation mode of the first aspect is further provided. In the fourth possible implementation mode of the first aspect, the allocating, by a proxy node device, a label for a destination node device includes:
<ul><li>matching, by the proxy node device, a routing table according to the address of the destination node device, and allocating the label when a route reaching the destination node device is matched.</li></ul></p><p id="p0012" num="0012">In a second aspect, a method for establishing an LSP is provided, where the method includes:
<ul><li>receiving, by an intermediary node device, a first label mapping message sent by a downstream node device of the intermediary node device, where the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of the destination node device and an address of a proxy node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates establishment of a first LSP from an entry node device to the proxy node device;</li><li>allocating, by the intermediary node device, a second label for the destination node device; and</li><li>sending, by the intermediary node device, a second label mapping message to an upstream node device of the intermediary node device, where the second label mapping message carries the second label, the address of the destination node device and the address of the proxy node device.</li></ul><!-- EPO <DP n="5"> --></p><p id="p0013" num="0013">According to the second aspect, a first possible implementation mode of the second aspect is further provided. In the first possible implementation mode of the second aspect, the allocating, by the intermediary node device, a second label for the destination node device includes:
<ul><li>matching, by the intermediary node device, a routing table according to the address of the proxy node device, allocating the second label when a route reaching the proxy node device is matched, and establishing a label forwarding table corresponding to the second label, where the label forwarding table includes: the address of the proxy node device, the address of the destination node device, the first label and the second label.</li></ul></p><p id="p0014" num="0014">According to the second aspect or the first possible implementation mode of the second aspect, a second possible implementation mode of the second aspect is further provided, where before the intermediary node device receives the first label mapping message sent by the downstream node device of the intermediary node device, the method further includes:
<ul><li>receiving, a first label request message sent by the upstream node device of the intermediary node device, where the first label request message carries the address of the destination node device and the address of the proxy node device; and</li><li>sending, a second label request message to the downstream node device of the intermediary node device, where the second label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0015" num="0015">According to the second aspect or any one of the possible implementation modes of the second aspect described above, a third possible implementation mode of the second aspect is further provided. In the third possible implementation of the second aspect, the first label mapping message and the second label mapping message are label distribution protocol LDP label mapping messages, the address of the destination node device and the address of the proxy node device are carried by extending prefix forwarding equivalence class elements Prefix FEC Elements of the first label mapping message and the second label mapping message.</p><p id="p0016" num="0016">According to the second possible implementation mode of the second aspect or the third possible implementation mode of the second aspect, a fourth possible implementation<!-- EPO <DP n="6"> --> mode of the second aspect is further provided. In the fourth possible implementation mode of the second aspect, the first label request message and the second label request message are LDP label request messages, the address of the destination node device and the address of the proxy node device are carried by extending Prefix FEC Elements of the first label request message and the second label request message.</p><p id="p0017" num="0017">In a third aspect, a method for establishing an LSP is provided, where the method includes:
<ul><li>receiving, by an entry node device, a label mapping message sent by a downstream node device of the entry node device, where the label mapping message carries a label allocated by the downstream node device for a destination node device, an address of a proxy node device and an address of the destination node device, and the label mapping message is generated by the downstream node device after the proxy node device initiates establishment of an LSP from the entry node device to the proxy node device; and</li><li>establishing, by the entry node device, the LSP from the entry node device to the proxy node device according to the address of the proxy node device, and establishing a label forwarding table, where the label forwarding table includes: the label, the address of the proxy node device and the address of the destination node device.</li></ul></p><p id="p0018" num="0018">According to the third aspect, a first possible implementation mode of the third aspect is further provided. In the first possible implementation mode of the third aspect, before the entry node device receives the label mapping message sent by the downstream node device of the entry node device, the method further includes:
<ul><li>sending, by the entry node device, a label request message to the downstream node device, where the label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0019" num="0019">According to the third aspect or the first possible implementation mode of the third aspect, a second possible implementation mode of the third aspect is further provided. In the second possible implementation mode of the third aspect, the label mapping message is a label distribution protocol LDP label mapping message, the address of the destination node device and the address of the proxy node device are carried by extending a prefix forwarding equivalence class element Prefix FEC Element of the label mapping message.<!-- EPO <DP n="7"> --></p><p id="p0020" num="0020">According to the third aspect or any one of the possible implementation modes of the third aspect described above, a third possible implementation mode of the third aspect is further provided. In the third possible implementation mode of the third aspect, the label request message is an LDP label request message, and the address of the destination node device and the address of the proxy node device are carried by extending a Prefix FEC Element of the label request message.</p><p id="p0021" num="0021">According to the third aspect or any one of the possible implementation modes of the third aspect described above, a fourth possible implementation mode of the third aspect is further provided. In the fourth possible implementation mode of the third aspect, the label mapping message further carries a topology identification ID to enable the first LSP to be established in a network topology corresponding to the topology ID.</p><p id="p0022" num="0022">In a fourth aspect, a proxy node device for establishing an LSP is provided, where the proxy node device includes:
<ul><li>an allocating unit, configured to allocate a label for a destination node device;</li><li>a generating unit, configured to generate a label mapping message, where the label mapping message carries the label, an address of the destination node device and an address of the proxy node device;</li><li>a sending unit, configured to send the label mapping message to an upstream node device of the proxy node device to initiate establishment of a first LSP from an entry node device to the proxy node device; and</li><li>a stitching unit, configured to stitch the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</li></ul></p><p id="p0023" num="0023">According to the fourth aspect, a first possible implementation mode of the fourth aspect is further provided. In the first possible implementation mode of the fourth aspect, the proxy node device further includes:
<ul><li>a receiving unit, configured to receive a label request message sent by the upstream node before the generating unit allocates the label for the destination node device, where the label request message carries the address of the destination node device and the<!-- EPO <DP n="8"> --> address of the proxy node device.</li></ul></p><p id="p0024" num="0024">In a fifth aspect, an intermediary node device for establishing an LSP is provided, where the intermediary node device includes:
<ul><li>a first receiving unit, configured to receive a first label mapping message sent by a downstream node device of the intermediary node device, where the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of the destination node device and an address of a proxy node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates establishment of a first LSP from an entry node device to the proxy node device;</li><li>an allocating unit, configured to allocate a second label for the destination node device; and</li><li>a first sending unit, configured to send a second label mapping message to an upstream node device of the intermediary node device, where the second label mapping message carries the second label, the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0025" num="0025">According to the fifth aspect, a first possible implementation mode of the fifth aspect is further provided. In the first possible implementation mode of the fifth aspect, the intermediary node device further includes:
<ul><li>a second receiving unit, configured to receive a first label request message sent by the upstream node device of the intermediary node device before the first receiving unit receives the first label mapping message sent by the downstream node device of the intermediary node device, where the first label request message carries the address of the destination node device and the address of the proxy node device; and</li><li>a second sending unit, configured to send a second label request message to the downstream node device of the intermediary node device, where the second label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0026" num="0026">In a sixth aspect, an entry node device for establishing an LSP is provided, where the entry node device includes:<!-- EPO <DP n="9"> -->
<ul><li>a receiving unit, configured to receive a label mapping message sent by a downstream node device of the entry node device, where the label mapping message carries a label allocated by the downstream node device for a destination node device, an address of a proxy node device and an address of the destination node device, and the label mapping message is generated by the downstream node device after the proxy node device initiates establishment of an LSP from the entry node device to the proxy node device; and</li><li>an establishing unit, configured to establish the LSP from the entry node device to the proxy node device according to the address of the proxy node device, and establish a label forwarding table, where the label forwarding table includes the label, the address of the proxy node device and the address of the destination node device.</li></ul></p><p id="p0027" num="0027">According to the sixth aspect, a first possible implementation mode of the sixth aspect is further provided. In the first possible implementation mode of the sixth aspect, the entry node device further includes:
<ul><li>a sending unit, configured to send a label request message to the downstream node device before the receiving unit receives the label mapping message sent by the downstream node device of the entry node device, where the label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0028" num="0028">In a seventh aspect, a system for establishing an LSP is provided, where the system includes: a proxy node device, an intermediary node device and an entry node device, and where,<br/>
the proxy node device is configured to allocate a first label for a destination node device, send the first label mapping message to the intermediary node device to initiate establishment of a first LSP from the entry node device to the proxy node device, where the first label mapping message carries the first label, an address of the destination node device and an address of the proxy node device;<br/>
the intermediary node device is configured to receive the first label mapping message, and allocate a second label for the destination node device, and send a second label mapping message including the second label, the address of the destination node device and the address of the proxy node device to the entry node device;<br/>
the entry node device is configured to receive the second label mapping message,<!-- EPO <DP n="10"> --> and establish the first LSP according to the address of the proxy node device; and<br/>
the proxy node device is further configured to stitch the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</p><p id="p0029" num="0029">According to the seventh aspect, a first possible implementation mode of the seventh aspect is further provided. In the first possible implementation mode of the seventh aspect, the entry node device is further configured to send a first label request message to the intermediary node device before the proxy node device sends the first label mapping message to the intermediary node device, where the label request message carries the address of the destination node device and the address of the proxy node device;<br/>
the intermediary node device is further configured to receive the first label request message sent by the entry node device, and send a second label request message to the destination node device, where the second label request message carries the address of the proxy node device and the address of the destination node device; and<br/>
the proxy node device is further configured to receive the second label request message sent by the intermediary node device.</p><p id="p0030" num="0030">Through technical solutions in the embodiments of the present invention, a proxy node device allocates a label for a destination node device, and generates a label mapping message including the label to initiate establishment of an LSP from an entry node device to the proxy node device, where the label mapping message further includes an address of the destination node device and an address of the proxy node device, in this way, an intermediary node device between the proxy node device and the entry node device may establish the first LSP via the address of the proxy node device, the proxy node device stitches the first LSP with a second LSP to form the third LSP from the entry node device to the destination node device, during this process, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.<!-- EPO <DP n="11"> --></p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0031" num="0031">In order to make technical solutions of embodiments of the present invention more clearly, accompanying drawings used for description of the embodiments will be briefly described hereunder. Obviously, the described drawings are merely some embodiments of present invention. For persons skilled in the art, other drawings may be obtained based on these drawings without any creative efforts.
<ul><li><figref idrefs="f0001">FIG. 1</figref> is a flow chart of a first method for establishing an LSP provided by an embodiment of the present invention;</li><li><figref idrefs="f0001">FIG. 2</figref> is a schematic diagram of a Prefix FEC Element provided by an embodiment of the present invention;</li><li><figref idrefs="f0002">FIG. 3</figref> is a schematic diagram of another Prefix FEC Element provided by an embodiment of the present invention;</li><li><figref idrefs="f0002">FIG. 4</figref> is a flow chart of a second method for establishing an LSP provided by an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 5</figref> is a flow chart of a third method for establishing an LSP provided by an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 6</figref> is a schematic diagram of a TLV provided by an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 7</figref> is a flow chart of a method for detecting a third LSP provided by an embodiment of the present invention;</li><li><figref idrefs="f0004">FIG. 8</figref> is a schematic diagram of a network structure provided by an embodiment of the present invention;</li><li><figref idrefs="f0004">FIG. 9</figref> is a flow chart of a fourth method for establishing an LSP provided by an embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 10</figref> is a flow chart of a method for sending a label request message provided by an embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 11</figref> is a schematic structural diagram of a first proxy node device provided by an embodiment of the present invention;<!-- EPO <DP n="12"> --></li><li><figref idrefs="f0006">FIG. 12</figref> is a schematic structural diagram of a second proxy node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0006">FIG. 13</figref> is a schematic structural diagram of a first intermediary node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 14</figref> is a schematic structural diagram of a second intermediary node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0007">FIG. 15</figref> is a schematic structural diagram of a first entry node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0008">FIG. 16</figref> is a schematic structural diagram of a second entry node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0008">FIG. 17</figref> is a schematic structural diagram of a proxy node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0009">FIG. 18</figref> is a schematic structural diagram of an intermediary node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0009">FIG. 19</figref> is a schematic structural diagram of an entry node device provided by an embodiment of the present invention;</li><li><figref idrefs="f0010">FIG. 20</figref> is a schematic structural diagram of a system for establishing an LSP provided by an embodiment of the present invention.</li></ul></p><heading id="h0005"><b>DESCRIPTION OF EMBODIMENTS</b></heading><p id="p0032" num="0032">In order to make objectives, technical solutions, and advantages of embodiments of the present invention clearer, the technical solutions in embodiments of the present invention are hereinafter described clearly with reference to accompanying drawings in embodiments of the present invention. Obviously, the described embodiments are only a part of embodiments of the present invention, rather than all embodiments of the present invention. All other embodiments obtained by persons of ordinary skill in the art based on embodiments of the present invention without any creative efforts shall fall within the protection scope of the present invention.<!-- EPO <DP n="13"> --></p><p id="p0033" num="0033">Referring to <figref idrefs="f0001">FIG. 1</figref>, this embodiment provides a method for establishing an LSP, and the method includes the following contents.</p><p id="p0034" num="0034">101, a proxy node device allocates a first label for a destination node device.</p><p id="p0035" num="0035">102, the proxy node device generates a first label mapping message, where the first label mapping message carries the first label, an address of the destination node device and an address of the proxy node device.</p><p id="p0036" num="0036">103, the proxy node device sends the first label mapping message to an upstream node device of the proxy node device to initiate establishment of a first LSP from an entry node device to the proxy node device. When there is an intermediary node device on a path between the proxy node device and the entry node device, each of the intermediary node device allocates a second label for the destination node device, and sends a second label mapping message including the second label, the address of the destination node device and the address of the proxy node device to an upstream node device of the intermediary node device, so that the entry node device establishes the first LSP according to the address of the proxy node device.</p><p id="p0037" num="0037">104, the proxy node device stitches the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</p><p id="p0038" num="0038">Optionally, the first LSP may be established by using an LDP downstream unsolicited (Downstream Unsolicited, DU) label distributing mode. Correspondingly, the first label mapping message is an LDP label mapping message.</p><p id="p0039" num="0039">Optionally, the first LSP may be established through a downstream on demand (Downstream on Demand, DoD) label distributing mode. Before the proxy node device allocates the first label for the destination node device, the method further includes:
<ul><li>receiving a label request message sent by the upstream node, where the label request message carries the address of the destination node device and the address of the proxy node device. The label request message is used to request for establishment of the first LSP from the entry node device to the proxy node device. After receiving the label request message, the proxy node device generates the first label mapping message, and sends the first<!-- EPO <DP n="14"> --> label mapping message to the upstream node device of the proxy node device.</li></ul></p><p id="p0040" num="0040">Optionally, the address of the destination node device and the address of the proxy node device may be carried by extending a Prefix FEC Element of the first label mapping message. Referring to <figref idrefs="f0001">FIG. 2</figref> which is a schematic diagram of a newly extended Prefix FEC element, in which:
<ul><li>a prefix type (Prefix Type) is used to identify a type of the extended Prefix FEC Element, and a value thereof may be 3;</li><li>an address family (Address Family) is used to identify an address family type corresponding to the Prefix FEC Element;</li><li>a destination node device address (Destination Node Address) is used to identify the address of the destination node device carried by the Prefix FEC Element;</li><li>a prefix length (PreLen) is used to identify a length of the address of the destination node device carried by the Prefix FEC Element;</li><li>a proxy node address (Proxy Node Address) field is used to identify the address of the proxy node device carried by the Prefix FEC Element.</li></ul></p><p id="p0041" num="0041">Optionally, the second label mapping message carries the address of the destination node device and the address of the proxy node device by extending the Prefix FEC element via a mode as shown in <figref idrefs="f0001">FIG. 2</figref>.</p><p id="p0042" num="0042">Optionally, the first label mapping message further carries a topology ID to enable the first LSP to be established in a network topology corresponding to the topology ID. A multi-topology technology refers to virtualization of multiple logical topology networks in a physical topology network, and by carrying a topology ID in the first label mapping message, the first LSP is enabled to be established in a logical topology network corresponding to the topology ID. The first label mapping message may carry the topology ID by extending the Prefix FEC Element, a topology ID field is added based on the extension of the FEC Element as shown in <figref idrefs="f0001">FIG. 2</figref>, referring to <figref idrefs="f0002">FIG. 3</figref> for details, where:</p><p id="p0043" num="0043">A multi-topology (Multi-topology) ID (MT-Id) is used to identify a topology ID carried by the Prefix FEC Element.</p><p id="p0044" num="0044">Reserved (Reserved) is used to reserve for future extension.</p><p id="p0045" num="0045">Optionally, the second label mapping message carries the topology ID through an<!-- EPO <DP n="15"> --> extending mode as shown in <figref idrefs="f0002">FIG. 3</figref>.</p><p id="p0046" num="0046">Optionally, the second LSP may be a boarder gateway protocol (Boarder Gateway Protocol, BGP) LSP or a resource reservation protocol traffic engineering (Resource Reservation Protocol Traffic Engineering, RSVP TE) LSP.</p><p id="p0047" num="0047">Optionally, the proxy node device allocating the first label for the destination node device, includes:
<ul><li>the proxy node device matches a routing table according to the address of the destination node device, and allocates the first label when a matching route to the destination node device is found.</li></ul></p><p id="p0048" num="0048">Optionally, the proxy node device stitching the first LSP with a second LSP, includes: when the first LSP is established, after the proxy node device allocates the first label for the upstream node of the proxy node device, the proxy node device establishes a label forwarding table (Label Forwarding Information Base, LFIB) including the first label and the third label, where the third label corresponds to the second LSP, and the third label is allocated by a downstream node of the proxy node device for the destination node device when the second LSP is established. When receiving a packet with an entry label being the first label, the proxy node device replaces the label of the packet with the third label according to the label forwarding table, and then sends the packet to the destination node device via the second LSP.</p><p id="p0049" num="0049">Through technical solutions in embodiments of the present invention, the proxy node device generates the first label mapping message to initiate establishment of a first LSP from the entry node device to the proxy node device, where the first label mapping message includes an address of the destination node device and an address of the proxy node device, and in this way, an intermediary node device between the proxy node device and the entry node device may establish the first LSP via the address of the proxy node device; the proxy node device stitches the first LSP with a second LSP to form the third LSP from the entry node device to the destination node device, during this process, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs<!-- EPO <DP n="16"> --> of different protocols are stitched in the prior art.</p><p id="p0050" num="0050">Referring to <figref idrefs="f0002">FIG. 4</figref>, an embodiment of the present invention further provides a second method for establishing an LSP, and the method includes the following contents.</p><p id="p0051" num="0051">401, an intermediary node device receives a first label mapping message sent by a downstream node device of the intermediary node device, where the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of the destination node device and an address of a proxy node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates stabling a first LSP from an entry node device to the proxy node device.</p><p id="p0052" num="0052">402, the intermediary node device allocates a second label for the destination node device.</p><p id="p0053" num="0053">403, the intermediary node device sends a second label mapping message to an upstream node device of the intermediary node device, where the second label mapping message carries the second label, the address of the destination node device and the address of the proxy node device. The entry node device is triggered to establish the first LSP from the entry node device to the proxy node device, so that the proxy node device stitches the first LSP with a second LSP to form an end-to-end third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device and the destination node device.</p><p id="p0054" num="0054">Optionally, the intermediary node device allocating the second label for the destination node device, includes:
<ul><li>the intermediary node device matches a routing table according to the address of the proxy node device, allocates the second label when a matching route to the proxy node device is found, and establishes a label forwarding table corresponding to the second label, where the label forwarding table includes: the address of the proxy node device, the address of the destination node device, the first label and the second label.</li></ul></p><p id="p0055" num="0055">Optionally, the first LSP may be established by using an LDP DU mode. Correspondingly, the first label mapping message and the second label mapping message are LDP label mapping messages.</p><p id="p0056" num="0056">Optionally, before the intermediary node device receives the first label mapping<!-- EPO <DP n="17"> --> message sent by the downstream node device of the intermediary node, further includes:
<ul><li>receiving a first label request message sent by the upstream node device of the intermediary node device, where the first label request message carries the address of the destination node device and the address of the proxy node device;</li><li>sending, a second label request message to the downstream node device of the intermediary node device, where the second label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0057" num="0057">The first LSP may be established in a DoD mode. Correspondingly, the first label mapping message may be an LDP label mapping message.</p><p id="p0058" num="0058">Optionally, the address of the destination node device and the address of the proxy node device may be carried by extending a Prefix FEC Element of the first label mapping message, reference may be made to <figref idrefs="f0001">FIG. 2</figref> for a specific extending mode, which will not be repeated herein.</p><p id="p0059" num="0059">Optionally, the first label mapping message further carries a topology ID to enable the first LSP to be established in a network topology corresponding to the topology ID. The first label mapping message also carries the topology ID, which may be carried by extending the Prefix FEC Element, reference may be made to <figref idrefs="f0002">FIG. 3</figref> for a specific extending manner, which will not be repeated herein.</p><p id="p0060" num="0060">Optionally, the second LSP may be a BGP LSP or an RSVP TE LSP.</p><p id="p0061" num="0061">Optionally, the first label request message and the second label request message are LDP label request messages, the address of the destination node device and the address of the proxy node device are carried by extending Prefix FEC Elements of the first label mapping message and the second label request message, reference may be made to <figref idrefs="f0001">FIG. 2</figref> for a specific extending manner, which will not be repeated herein.</p><p id="p0062" num="0062">Through technical solutions in the embodiments of the present invention, the intermediary node device receives the first label mapping message carrying the address of the destination node device and the address of the proxy node device, and sends the second label mapping message including the address of the destination node device and the address of the proxy node device to an upstream node device of the intermediary node device, so as to trigger the entry node device to establish the first LSP according to the address of the proxy<!-- EPO <DP n="18"> --> node device, the proxy node device stitches the first LSP with a second LSP to form the third LSP from the entry node device to the destination node device, and during this process, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.</p><p id="p0063" num="0063">Referring to <figref idrefs="f0003">FIG. 5</figref>, an embodiment of the present invention provides a third method for establishing an LSP, and the method includes the following contents.</p><p id="p0064" num="0064">501, an entry node device receives a label mapping message sent by a downstream node device of the entry node device, where the label mapping message carries a label allocated by the downstream node device for a destination node device, an address of a proxy node device and an address of the destination node device, and the label mapping message is generated by the downstream node device after the proxy node device initiates establishing a first LSP from the entry node device to the proxy node device.</p><p id="p0065" num="0065">502, the entry node device establishes the first LSP from the entry node device to the proxy node device according to the address of the proxy node device, and establishes a label forwarding table, where the label forwarding table includes: the label, the address of the proxy node device and the address of the destination node device.</p><p id="p0066" num="0066">Optionally, the first LSP may be established by using an LDP DU mode. Correspondingly, the label mapping message is an LDP label mapping message.</p><p id="p0067" num="0067">Optionally, before the entry node device receives the label mapping message sent by the downstream node device of the entry node device, the method further includes:</p><p id="p0068" num="0068">The entry node device sends a label request message to the downstream node device, where the label request message carries the address of the destination node device and the address of the proxy node device.</p><p id="p0069" num="0069">The first LSP may be established in a DoD mode. Correspondingly, the label mapping message may be an LDP label mapping message. The label mapping message is the LDP label mapping message, the address of the destination node device and the address of the proxy node device may be carried by extending a prefix forwarding equivalence class element Prefix FEC Element of the label mapping message, reference may be made to <figref idrefs="f0001">FIG. 2</figref> for a<!-- EPO <DP n="19"> --> specific extending manner, which will not be repeated herein.</p><p id="p0070" num="0070">Optionally, the label mapping message further carries a topology identification ID to enable the first LSP to be established in a network topology corresponding to the topology ID. Reference may be made to <figref idrefs="f0002">FIG. 3</figref> for a specific extending manner, which will not be repeated herein.</p><p id="p0071" num="0071">Optionally, the label request message is an LDP label request message, and the address of the destination node device and the address of the proxy node device are carried by extending a Prefix FEC Element of the label request message. Reference may be made to <figref idrefs="f0001">FIG. 2</figref> for a specific extending manner, which will not be repeated herein.</p><p id="p0072" num="0072">Optionally, during a network plan, the address of the destination node device and the address of the proxy node device are configured on the entry node, before the entry node device initiates the label request message, the address of the destination node device and the address of the proxy node device which are configured are obtained, and then the label request message including the address of the proxy node device is generated.</p><p id="p0073" num="0073">Optionally, before initiating the label request message, the entry node device receives a notification message sent by the proxy node device via an interior gateway protocol (Interior Gateway Protocol, IGP), where the notification message carries the address of the proxy node device. The notification message may be an extension of an open shortest path first (Open Shortest Path First, OSPF) link state advertisement (Link State Advertisement, LSA) message, and specifically, the address of the proxy node device is carried by extending a type-length value (Type Length Value, TLV) in the LSA message. An example is given where the address of the proxy node device carried by the TLV is an IPv4 address, referring to <figref idrefs="f0003">FIG. 6</figref> for the extended TLV, in which:
<ul><li>a type (Type) field is used to identify that the LSA message carries the address of the proxy node device;</li><li>a length (Length) field is used to identify a data length of the TLV;</li><li>an IPv4 address (IPv4 address) filed is used to carry the address of the proxy node device.</li></ul></p><p id="p0074" num="0074">Optionally, the label forwarding table established by the entry node device further includes: a corresponding relationship between the first label and the address of the proxy<!-- EPO <DP n="20"> --> node device, a corresponding relationship between the label and the address of the destination node device. When a destination address of a packet received by the entry node device is the address of the destination node device, the packet is sent to the proxy node device via the first LSP according to the corresponding relationship between the label and the address of the destination node device in the label forwarding table, and the proxy node device then sends the packet to the destination node device according to the second LSP.</p><p id="p0075" num="0075">Optionally, the second LSP may be a BGP LSP or an RSVP TE LSP.</p><p id="p0076" num="0076">Optionally, the entry node device may also receive an indication message sent by the proxy node device, which includes an indicator of successful stitching the first LSP with the second LSP, where the indication message includes a type-length value (Type Length Value, TLV) of the indicator, the indicator TLV carries the indicator. When determining, through the indicator, that the first LSP and the second LSP are stitched successfully, the entry node device uses the third LSP to bear a service packet sent to the destination node device, and when determining, through the indicator, that the first LSP and the second LSP fail to be stitched, the entry node device prohibits using the third LSP to bear the service packet sent to the destination node device.</p><p id="p0077" num="0077">Through the indicator, a problem of loss of the service packet, which is caused by that the entry node device still continues to use the third LSP to bear a service packet sent to the destination network device when the first LSP and the second LSP fail to be stitched, may be avoided.</p><p id="p0078" num="0078">Optionally, referring to <figref idrefs="f0003">FIG. 7</figref>, after step 103, may also include:</p><p id="p0079" num="0079">701, the entry node device detects whether it is possible to reach the destination node device via the third LSP, if it is possible to reach the destination node device via the third LSP, then perform step 702; if it is impossible to reach the destination node device via the third LSP, then perform step 703.</p><p id="p0080" num="0080">702, the entry node device uses the third LSP to bear a service packet sent to the destination node device.</p><p id="p0081" num="0081">703, the entry node device prohibits the third LSP from bearing the service packet sent to the destination node device.</p><p id="p0082" num="0082">The detection of whether it is possible to reach the destination node device via the<!-- EPO <DP n="21"> --> third LSP may be performed when the first LSP and the second LSP are stitched for the first time, and may also be performed when a stitching state of the first LSP and the second LSP changes for the first time subsequently.</p><p id="p0083" num="0083">Optionally, the detection may be implemented through an LSP packet internet groper (Packet Internet Groper, Ping).</p><p id="p0084" num="0084">Through technical solutions in embodiments of the present invention, the entry node device receives the label mapping message carrying the address of the destination node device and the address of the proxy node device, and establishes the first LSP according to the address of the proxy node device, the proxy node device stitches the first LSP with a second LSP to form the third LSP from the entry node device to the destination node device; during this process, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.</p><p id="p0085" num="0085">In order to explain the method for establishing an LSP provided in the above embodiments more clearly, an example of the method for establishing an LSP is described in details with reference to contents of the above embodiments. Referring to <figref idrefs="f0004">FIG. 8</figref>, a proxy node device and a destination node device are located in an IP backbone network, an entry node device and an intermediary node device are located in an access network of an IP RAN, the proxy node may be a carrier switch (Carrier Switch, CX) device, the entry node and the intermediary node may be an augmented transition network (Augmented Transition Network, ATN) device, an address of the destination node device is 171.68.1.1, and an address of the proxy node device is 171.68.2.1. Referring to <figref idrefs="f0004">FIG. 9</figref>, a flow of the method for establishing an LSP is specifically as follow:</p><p id="p0086" num="0086">901, the proxy node device allocates a first label for the destination node device, and generates a first label mapping message including the first label.</p><p id="p0087" num="0087">The proxy node device allocates a first label L11 for the destination node device, generates a first label forwarding table according to the first label, where the first label forwarding table includes: an entry label and the address of the destination node device, where the entry label is the first label L11. The proxy node device establishes a second LSP<!-- EPO <DP n="22"> --> with the destination node device in advance, the second LSP may be a BGP LSP, the first label forwarding table also includes an exit label L01, the exit label L01 is an exit label corresponding to the second LSP and is allocated by a downstream node of the proxy node device for the destination node device when the second LSP is established.</p><p id="p0088" num="0088">The first label forwarding table is as shown in Table 1.
<tables id="tabl0001" num="0001"><table frame="all"><title><b>Table 1</b></title><tgroup cols="3"><colspec colnum="1" colname="col1" colwidth="53mm"/><colspec colnum="2" colname="col2" colwidth="20mm"/><colspec colnum="3" colname="col3" colwidth="18mm"/><thead><row><entry align="center" valign="top">Address of destination node device</entry><entry align="center" valign="top">Entry label</entry><entry align="center" valign="top">Exit label</entry></row></thead><tbody><row><entry align="center">171.68.1.1</entry><entry align="center">L11</entry><entry align="center">L01</entry></row></tbody></tgroup></table></tables></p><p id="p0089" num="0089">The first label mapping message also includes: the address of the destination node device and the address of the proxy node device.</p><p id="p0090" num="0090">For instance, in <figref idrefs="f0004">FIG. 8</figref>, the first label mapping message generated by the proxy node device is a label mapping message 1, where, the label mapping message 1 includes the first label L11, the address of the destination node device 171.68.1.1 and the address of the proxy node device 171.68.2.1.</p><p id="p0091" num="0091">902, the proxy node device sends the first label mapping message to the intermediary node device.</p><p id="p0092" num="0092">903, the intermediary node device receives the first label mapping message sent by the proxy node device.</p><p id="p0093" num="0093">904, the intermediary node device allocates a second label L21 for the destination node device, and continues to send a second label mapping message carrying the second label to the entry node device.</p><p id="p0094" num="0094">When allocating the second label for the destination node device, the intermediary node device allocates the second label for the destination node device via the address of the proxy node device, which specifically includes: using the address of the proxy node device to match a routing table, allocating the second label when a route reaching the proxy node device is matched, and establishing a second label forwarding table corresponding to the second label, where the second label forwarding table includes: the address of the proxy node<!-- EPO <DP n="23"> --> device, the address of the destination node device, an entry label, an exit label and a next hop, where, the entry label is the second label L21, the exit label is the first label L11, the next hop is the proxy node device. The second label forwarding table is as shown in Table 2.
<tables id="tabl0002" num="0002"><table frame="all"><title><b>Table 2</b></title><tgroup cols="4"><colspec colnum="1" colname="col1" colwidth="99mm"/><colspec colnum="2" colname="col2" colwidth="20mm"/><colspec colnum="3" colname="col3" colwidth="18mm"/><colspec colnum="4" colname="col4" colwidth="31mm"/><thead><row><entry align="center" valign="top">Address of destination node device and address of proxy node device</entry><entry align="center" valign="top">Entry label</entry><entry align="center" valign="top">Exit label</entry><entry align="center" valign="top">Next hop</entry></row></thead><tbody><row><entry align="center">171.68.1.1</entry><entry align="center">L21</entry><entry align="center">L11</entry><entry align="center">Proxy node device</entry></row><row><entry align="center">171.68.2.1</entry><entry align="center"/><entry align="center"/><entry align="center"/></row></tbody></tgroup></table></tables></p><p id="p0095" num="0095">The second label mapping message also carries the address of the destination node device and the address of the proxy node device, as shown in <figref idrefs="f0004">FIG. 8</figref>, the second label mapping message generated by the intermediary node device is a label mapping message 2, where, the label mapping message 2 includes the second label L21, the address of the destination node device 171.68.1.1 and the address of the proxy node device 171.68.2.1.</p><p id="p0096" num="0096">905, the entry node device receives the second label mapping message sent by the intermediary node device, and establishes a first LSP from the entry node device to the proxy node device.</p><p id="p0097" num="0097">The entry node device matches a routing table according to the address of the proxy node device carried by the second label mapping message, establishes a third label forwarding table when a route reaching the proxy node device is matched, where the third label forwarding table includes: a corresponding relationship between the second label and the address of the proxy node device and a corresponding relationship between the second label and the address of the destination node device, and specifically, the third label forwarding table includes: the second label L21, the address of the proxy node device, the address of the destination node device and a next hop. The third label forwarding table is as shown in Table 3.<!-- EPO <DP n="24"> -->
<tables id="tabl0003" num="0003"><table frame="all"><title><b>Table 3</b></title><tgroup cols="4"><colspec colnum="1" colname="col1" colwidth="84mm"/><colspec colnum="2" colname="col2" colwidth="24mm"/><colspec colnum="3" colname="col3" colwidth="18mm"/><colspec colnum="4" colname="col4" colwidth="41mm"/><thead><row><entry align="center" valign="top">Address of destination node device and address of proxy node device</entry><entry align="center" valign="top">Entry label</entry><entry align="center" valign="top">Exit label</entry><entry align="center" valign="top">Next hop</entry></row></thead><tbody><row><entry align="center">171.68.1.1</entry><entry align="center">NULL (invalid label)</entry><entry align="center">L21</entry><entry morerows="1" rowsep="1" align="center">Intermediary node device</entry></row><row><entry align="center">171.68.2.1</entry><entry align="center"/><entry align="center"/></row></tbody></tgroup></table></tables></p><p id="p0098" num="0098">After the entry node device establishes the third label forwarding table, establishment of the first LSP is then completed. Since the proxy node device has established the first label forwarding table, that is, the first LSP and the second LSP are stitched, a third LSP from the entry node device to the destination node device is established. When receiving a packet with a destination address being the address of the destination node device, the entry node device sends the packet to the proxy node device via the first LSP according to the corresponding relationship between the second label and the address of the destination node device in the third label forwarding table, and the proxy node device sends the packet to the destination node device via the second LSP according to the first label forwarding table. Consequently, it may be achieved that, the entry node device and the intermediary node device can still establish the third LSP from the entry node device to the destination node device without saving a routing table for reaching the destination node device.</p><p id="p0099" num="0099">The proxy node device stitching the first LSP with a second LSP, specifically is: when the first LSP is established, the proxy node device allocates a first label for an upstream node of the proxy node device and the proxy node device establishes the first label forwarding table and then the stitching of the first LSP and the second LSP is achieved; when receiving a packet with an entry label being the first label, the proxy node device replaces the first label of the packet with the exit label L01 according to the first label forwarding table, and then sends the packet to the destination node device via the second LSP. The entry node device and the intermediary node device do not need to pre-configure a static route reaching the destination node device, which helps to save memories of the entry node device and the intermediary node device, and reduce complexity of maintenance and management, and which helps to realize an integration of an access network of an IP RAN and an IP backbone<!-- EPO <DP n="25"> --> network.</p><p id="p0100" num="0100">Referring to <figref idrefs="f0005">FIG. 10</figref>, before step 901 further includes:</p><p id="p0101" num="0101">1001, the entry node device sends a first label request message to the intermediary node device, where the first label request message carries the address of the destination node device and the address of the proxy node device.</p><p id="p0102" num="0102">1002, the intermediary node device sends a second label request message to the proxy node device, where the second label request message carries the address of the destination node device and the address of the proxy node device, so as to enable the proxy node device to send the first label mapping message to the intermediary node device after receiving the second label request message. The address of the proxy node device included in the second label request message is used to indicate a request for establishing the first LSP reaching the proxy node device, the address of the destination node device is used to instruct the proxy node device to stitch the first LSP with the second LSP, thereby establishing the third LSP from the entry node device to the destination node device.</p><p id="p0103" num="0103">After receiving the first label request message, the intermediary node device matches a routing table according to the address of the proxy node device carried in the first label request message, and sends the second label request message to the proxy node device according to a matching route reaching the proxy node device.</p><p id="p0104" num="0104">Referring to <figref idrefs="f0005">FIG. 11</figref>, another embodiment of the present invention provides a proxy node device 1100, and the proxy node device 1100 is configured to perform a function performed by the proxy node device in the method for establishing an LSP as shown in <figref idrefs="f0001">FIG. 1</figref>. The proxy node device 1100 includes:
<ul><li>an allocating unit 1101, configured to allocate a first label for a destination node device;</li><li>a generating unit 1102, configured to generate a first label mapping message, where the first label mapping message carries the first label, an address of the destination node device and an address of the proxy node device 1100;</li><li>a sending unit 1103, configured to send the first label mapping message to an upstream node device of the proxy node device 1100 to initiate establishment of a first LSP from an entry node device to the proxy node device 1100; and<!-- EPO <DP n="26"> --></li><li>an stitching unit 1104, configured to stitch the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device 1100 and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</li></ul></p><p id="p0105" num="0105">Referring to <figref idrefs="f0006">FIG. 12</figref>, the proxy node device 1100 also includes:
<ul><li>a receiving unit 1105, configured to receive a label request message sent by the upstream node before allocating the first label for the destination node device, where the label request message carries the address of the destination node device and the address of the proxy node device 1100.</li></ul></p><p id="p0106" num="0106">Through the proxy node device 1100 provided by the embodiment of the present invention, the proxy node device 1100 generates the first label mapping message to initiate establishment of a first LSP from the entry node device to the proxy node device 1100, where the first label mapping message includes the address of the destination node device and the address of the proxy node device 1100, in this way, an intermediary node device between the proxy node device 1100 and the entry node device may establish the first LSP via the address of the proxy node device 1100, the proxy node device 1100 stitches the first LSP with a second LSP to form the third LSP from the entry node device to the destination node device, during this process, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.</p><p id="p0107" num="0107">Referring to <figref idrefs="f0006">FIG. 13</figref>, another embodiment of the present invention provides an intermediary node device 1300, the intermediary node device 1300 is configured to perform a function performed by the intermediary node device in the method for establishing an LSP as shown in <figref idrefs="f0002">FIG. 4</figref>, and the intermediary node device includes:
<ul><li>a first receiving unit 1301, configured to receive a first label mapping message sent by a downstream node device of the intermediary node device 1300, where the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of the destination node device and an address of a proxy<!-- EPO <DP n="27"> --> node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates establishment of a first LSP from an entry node device to the proxy node device;</li><li>an allocating unit 1302, configured to allocate a second label for the destination node device; and</li><li>a first sending unit 1303, configured to send a second label mapping message to an upstream node device of the intermediary node device 1300, where the second label mapping message carries the second label, the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0108" num="0108">Referring to <figref idrefs="f0007">FIG. 14</figref>, the intermediary node device 1300 also includes:
<ul><li>a second receiving unit 1304, configured to receive a first label request message sent by the upstream node device of the intermediary node device 1300 before receiving the first label mapping message sent by the downstream node device of the intermediary node device, where the first label request message carries the address of the destination node device and the address of the proxy node device; and</li><li>a second sending unit 1305, configured to send a second label request message to the downstream node device of the intermediary node device 1300, where the second label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0109" num="0109">According to the intermediary node device 1300 provided in the embodiment of the present invention, the intermediary node device 1300 receives the first label mapping message carrying the address of the destination node device and the address of the proxy node device, and sends the second label mapping message including the address of the destination node device and the address of the proxy node device to the upstream node device of the intermediary node device 1300, so as to trigger the entry node device to establish the first LSP according to the address of the proxy node device, the proxy node device stitches the first LSP with a second LSP to form the third LSP from the entry node device to the destination node device, during this process, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems in the prior art that configuration is complicated and management and maintenance<!-- EPO <DP n="28"> --> are difficult due to a need to configure the static route when LSPs of different protocols are stitched.</p><p id="p0110" num="0110">Referring to <figref idrefs="f0007">FIG. 15</figref>, another embodiment of the present invention provides an entry node device 1500, the entry device is configured to perform a function performed by the entry node device 1500 in the method for establishing an LSP provided in the above embodiments, and the entry node device 1500 includes:
<ul><li>a receiving unit 1501, configured to receive a first label mapping message sent by a downstream node device of the entry node device 1500, where the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of a proxy node device and an address of the destination node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates establishment of a first LSP from the entry node device 1500 to the proxy node device; and</li><li>a first establishing unit 1502, configured to establish the first LSP from the entry node device 1500 to the proxy node device according to the address of the proxy node device, and establish a label forwarding table, where the label forwarding table includes the label, the address of the proxy node device and the address of the destination node device.</li></ul></p><p id="p0111" num="0111">Referring to <figref idrefs="f0008">FIG. 16</figref>, the entry node device 1500 also includes:
<ul><li>a sending unit 1503, configured to send a label request message to the downstream node device before the label mapping message sent by the downstream node device of the entry node device is received, where the label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0112" num="0112">According to the entry node device 1500 provided in the embodiment of the present invention, the entry node device 1500 receives the first label mapping message carrying the address of the destination node device and the address of the proxy node device, and establishes the first LSP according to the address of the proxy node device, the proxy node device stitches the first LSP with a second LSP to form the third LSP from the entry node device 1500 to the destination node device, during this process, there is no need for the entry node device and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems in the prior art that configuration is<!-- EPO <DP n="29"> --> complicated and management and maintenance are difficult due to a need to configure the static route when LSPs of different protocols are stitched.</p><p id="p0113" num="0113">Another embodiment of the present invention provides a proxy node device 1700, referring to <figref idrefs="f0008">FIG. 17</figref>, the proxy node device 1700 includes: a memory 1701, a transmitter 1702, a receiver 1703, and a processor 1704 connected to the memory 1701, the transmitter 1702 and the receiver 1703 respectively, the memory 1701 is configured to store a set of program codes, and the processor 1704 is configured to invoke a program stored by the memory 1701 to perform the following operations:
<ul><li>allocating a first label for a destination node device, and generating a first label mapping message, where the first label mapping message carries the first label, an address of the destination node device and an address of the proxy node device 1700;</li><li>triggering the transmitter 1702 to send the first label mapping message to an upstream node device of the proxy node device 1700, and initiating establishing a first LSP from an entry node device to the proxy node device 1700;</li><li>stitching the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, where the second LSP is an LSP established between the proxy node device 1700 and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</li></ul></p><p id="p0114" num="0114">Optionally, the processor 1704 invokes a program stored by the memory 1701 to perform the following operations:
<ul><li>triggering the receiver 1703 to receive a label request message sent by the upstream node, where the label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0115" num="0115">Optionally, the label mapping message further carries a topology identification ID to enable the first LSP to be established in a network topology corresponding to the topology ID.</p><p id="p0116" num="0116">Optionally, the first label mapping message is a label distribution protocol LDP label mapping message, the address of the destination node device and the address of the proxy node device are carried by extending a prefix forwarding equivalence class element Prefix FEC Element of the first label mapping message.<!-- EPO <DP n="30"> --></p><p id="p0117" num="0117">Another embodiment of the present invention provides an intermediary node device 1800, referring to <figref idrefs="f0009">FIG. 18</figref>, the intermediary node device 1800 includes: a memory 1801, a transmitter 1802, a receiver 1803, and a processor 1804 connected to the memory 1801, the transmitter 1802 and the receiver 1803 respectively, the memory 1801 is configured to store a set of program codes, and the processor 1804 is configured to invoke a program in the memory 1801 to perform the following operations:
<ul><li>triggering the receiver 1803 to receive a first label mapping message sent by a downstream node device of the intermediary node device, where the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of the destination node device and an address of a proxy node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates establishment of a first LSP from an entry node device to the proxy node device;</li><li>allocating a second label for the destination node device; and</li><li>triggering the transmitter 1802 to send a second label mapping message to an upstream node device of the intermediary node device 1800, where the second label mapping message carries the second label, the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0118" num="0118">Optionally, the processor 1804 is also configured to invoke the program codes stored by the memory 1801 to perform the following operations:
<ul><li>triggering the receiver 1803 to receive a first label request message sent by the upstream node device of the intermediary node device 1800, where the first label request message carries the address of the destination node device and the address of the proxy node device;</li><li>sending a second label request message to the downstream node device of the intermediary node device 1800, where the second label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0119" num="0119">Another embodiment of the present invention provides an entry node device 1900, referring to <figref idrefs="f0009">FIG. 19</figref>, the entry node device 1900 includes: a memory 1901, a transmitter 1902, a receiver 1903, and a processor 1904 connected to the memory 1901, the transmitter 1902<!-- EPO <DP n="31"> --> and the receiver 1903 respectively, the memory 1901 is configured to store a set of program codes, and the processor 1904 is configured to invoke a program stored by the memory 1901 to perform the following operations:
<ul><li>triggering the receiver 1903 to receive a label mapping message sent by a downstream node device of the entry node device 1900, where the label mapping message carries a label allocated by the downstream node device for a destination node device, an address of a proxy node device and an address of the destination node device, and the label mapping message is generated by the downstream node device after the proxy node device initiates establishment of an LSP from the entry node device 1900 to the proxy node device;</li><li>establishing the LSP from the entry node device 1900 to the proxy node device according to the address of the proxy node device, and establishing a label forwarding table, where the label forwarding table includes the label, the address of the proxy node device and the address of the destination node device;</li><li>triggering the transmitter 1902 to send a label request message to the downstream node device, where the label request message carries the address of the destination node device and the address of the proxy node device.</li></ul></p><p id="p0120" num="0120">In summary, through an entry node device 1900 provided in the embodiment of the present invention, the entry node device 1900 receives the label mapping message carrying the address of the destination node device and the address of the proxy node device, and establishes the first LSP according to the address of the proxy node device, the proxy node device stitches the first LSP with a second LSP to form the third LSP from the entry node device 1900 to the destination node device, during this process, there is no need for the entry node device 1900 and the intermediate node device to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.</p><p id="p0121" num="0121">Referring to <figref idrefs="f0010">FIG. 20</figref>, another embodiment of the present invention provides a system 2000 for establishing an LSP, the system 2000 for establishing the LSP includes: a proxy node device 1700, an intermediary node device 1800 and an entry node device 1900:
<ul><li>the proxy node device 1700 is configured to allocate a first label for a destination<!-- EPO <DP n="32"> --> node device, and generate a first label mapping message including the first label, send the first label mapping message to the intermediary node device 1800 to initiate establishment of a first LSP from the entry node device 1900 to the proxy node device 1700, where the first label mapping message also includes an address of the destination node device and an address of the proxy node device 1700;</li><li>the intermediary node device 1800 is configured to receive the first label mapping message, and allocate a second label according to the address of the proxy node device 1700, and send a second label mapping message including the second label, the address of the destination node device and the address of the proxy node device 1700 to the entry node device 1900;</li><li>the entry node device 1900 is configured to receive the second label mapping message, and establish the first LSP according to the address of the proxy node device 1700;</li><li>the proxy node device 1700 is further configured to stitch the first LSP with a second LSP to form a third LSP from the entry node device 1900 to the destination node device, where the second LSP is an LSP established between the proxy node device 1700 and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</li></ul></p><p id="p0122" num="0122">The entry node device 1900 is further configured to send a first label request message to the intermediary node device 1800 before the proxy node device 1700 sends the first label mapping message to the intermediary node device 1800, where the label request message carries the address of the destination node device and the address of the proxy node device 1700;</p><p id="p0123" num="0123">The intermediary node device 1800 is further configured to receive the first label request message sent by the entry node device 1900, and send a second label request message to the destination node device, where the second label request message carries the address of the proxy node device 1700 and the address of the destination node device;</p><p id="p0124" num="0124">The proxy node device 1700 is further configured to receive the second label request message sent by the intermediary node device 1800.</p><p id="p0125" num="0125">In conclusion, in a system provided in this embodiment, the proxy node device 1700 allocates a first label for a destination node device, and generates a first label mapping<!-- EPO <DP n="33"> --> message including the first label to initiate establishment of a first LSP from the entry node device 1900 to the proxy node device 1700, where the first label mapping message also includes an address of the destination node device and an address of the proxy node device 1700, in this way, an intermediary node device 1800 between the proxy node device 1700 and the entry node device 1900 may establish the first LSP via the address of the proxy node device 1700, the proxy node device 1700 stitches the first LSP with a second LSP to form the third LSP from the entry node device 1900 to the destination node device, during this process, there is no need for the entry node device 1900 and the intermediate node device 1800 to pre-configure a static route reaching the destination node device, which solves problems of complicated configuration as well as difficult management and maintenance due to a need to configure the static route when LSPs of different protocols are stitched in the prior art.</p><p id="p0126" num="0126">It should be noted that, when implementing establishment of an LSP by a proxy node device, an intermediary node device and an entry node device provided in the above embodiments, division of the above functional modules is only an example for description, during a practical application, the above functions may be assigned to different function modules to be completed according to a need, that is, internal structures of the proxy node device, the intermediary node device and the entry node device are divided into different function modules so as to complete all or a part of functions described above. In addition, the proxy node device, the intermediary node device and the entry node device provided in the above embodiments as well as embodiments of a method for establishing an LSP belong to a same conception, for a specific implementation procedure thereof, reference may be made to the method embodiments, which will not be repeated herein.</p><p id="p0127" num="0127">The word of "first" in first LSP, first label, first label mapping table and first label request message as described in the embodiments of the present invention is only used as a name identification, and does not represent the first in order. This rule also applies to "second" and "third".</p><p id="p0128" num="0128">Persons of ordinary skill in the art may understand that, all or a part of steps of the foregoing method embodiments may be implemented by a program instructing relevant hardware. The foregoing program may be stored in a computer readable storage medium. When the program is executed, the steps of the foregoing method embodiments are performed.<!-- EPO <DP n="34"> --> The foregoing storage medium may be at least one of the following mediums: various mediums capable of storing program codes, such as a read-only memory (Read-Only Memory, short for ROM), an RAM, a magnetic disk, or an optical disc.</p><p id="p0129" num="0129">Finally, it should be noted that the foregoing embodiments are merely intended for describing technical solutions of the present invention rather than limiting the present invention. Although the present invention and beneficial effects the present invention brings out are described in detail with reference to the foregoing embodiments, persons of ordinary skill in the art should understand that they may still make modifications to the technical solutions described in the foregoing embodiments, or make equivalent replacements to some technical features therein; however, these modifications or replacements do not make the essence of corresponding technical solutions depart from the scope of claims of the present invention.</p></description><claims mxw-id="PCLM90459226" lang="EN" load-source="patent-office"><!-- EPO <DP n="35"> --><claim id="c-en-0001" num="0001"><claim-text>A method for establishing a label switched path LSP, wherein the method comprises:
<claim-text>allocating, by a proxy node device, a label for a destination node device;</claim-text>
<claim-text>generating, by the proxy node device, a label mapping message, wherein the label mapping message carries the label, an address of the destination node device and an address of the proxy node device;</claim-text>
<claim-text>sending, by the proxy node device, the label mapping message to an upstream node device of the proxy node device to initiate establishment a first LSP from an entry node device to the proxy node device; and</claim-text>
<claim-text>stitching, by the proxy node device, the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, wherein the second LSP is an LSP established between the proxy node device and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein before the allocating, by a proxy node device, a label for a destination node device, the method further comprises:
<claim-text>receiving a label request message sent by the upstream node, wherein the label request message carries the address of the destination node device and the address of the proxy node device.</claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 1 or 2, wherein the label mapping message further carries a topology identification ID to enable the first LSP to be established in a network topology corresponding to the topology ID.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to any one of claims 1 to 3, wherein the label mapping message is a label distribution protocol LDP label mapping message, the address of the destination node device and the address of the proxy node device are carried by extending a prefix forwarding equivalence class element Prefix FEC Element of the label mapping message.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to any one of claims 1 to 4, wherein the allocating, by a proxy node device, a label for a destination node device comprises:<!-- EPO <DP n="36"> -->
<claim-text>matching, by the proxy node device, a routing table according to the address of the destination node device, and allocating the label when a route reaching the destination node device is matched.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A method for establishing a label switched path LSP, wherein the method comprises:
<claim-text>receiving, by an intermediary node device, a first label mapping message sent by a downstream node device of the intermediary node device, wherein the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of the destination node device and an address of a proxy node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates establishment of a first LSP from an entry node device to the proxy node device;</claim-text>
<claim-text>allocating, by the intermediary node device, a second label for the destination node device; and</claim-text>
<claim-text>sending, by the intermediary node device, a second label mapping message to an upstream node device of the intermediary node device, wherein the second label mapping message carries the second label, the address of the destination node device and the address of the proxy node device.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method according to claim 6, wherein the allocating, by the intermediary node device, a second label for the destination node device comprises:
<claim-text>matching, by the intermediary node device, a routing table according to the address of the proxy node device, allocating the second label when a route reaching the proxy node device is matched, and establishing a label forwarding table corresponding to the second label, wherein the label forwarding table comprises: the address of the proxy node device, the address of the destination node device, the first label and the second label.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method according to claim 6 or 7, wherein before the receiving, by an intermediary node device, a first label mapping message sent by a downstream node device of the intermediary node device, the method further comprises:
<claim-text>receiving, a first label request message sent by the upstream node device of the intermediary node device, wherein the first label request message carries the address of the destination node device and the address of the proxy node device; and<!-- EPO <DP n="37"> --></claim-text>
<claim-text>sending, a second label request message to the downstream node device of the intermediary node device, wherein the second label request message carries the address of the destination node device and the address of the proxy node device.</claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method according to claims 6 to 8, wherein the first label mapping message and the second label mapping message are label distribution protocol LDP label mapping messages, the address of the destination node device and the address of the proxy node device are carried by extending prefix forwarding equivalence class elements Prefix FEC Element of the first label mapping message and the second label mapping message.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The method according to claim 8 or 9, wherein the first label request message and the second label request message are LDP label request messages, the address of the destination node device and the address of the proxy node device are carried by extending Prefix FEC Elements of the first label request message and the second label request message.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>A method for establishing a label switched path LSP, wherein the method comprises:
<claim-text>receiving, by an entry node device, a label mapping message sent by a downstream node device of the entry node device, wherein the label mapping message carries a label allocated by the downstream node device for a destination node device, an address of a proxy node device and an address of the destination node device, and the label mapping message is generated by the downstream node device after the proxy node device initiates establishment of an LSP from the entry node device to the proxy node device; and</claim-text>
<claim-text>establishing, by the entry node device, the LSP from the entry node device to the proxy node device according to the address of the proxy node device, and establishing a label forwarding table, wherein the label forwarding table comprises: the label, the address of the proxy node device and the address of the destination node device.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The method according to claim 11, wherein before the receiving, by an entry node device, a label mapping message sent by a downstream node device of the entry node device, the method further comprises:
<claim-text>sending, by the entry node device, a label request message to the downstream node device, wherein the label request message carries the address of the destination node device and the address of the proxy node device.</claim-text><!-- EPO <DP n="38"> --></claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The method according to claim 11 or 12, wherein the label mapping message is a label distribution protocol LDP label mapping message, the address of the destination node device and the address of the proxy node device are carried by extending a prefix forwarding equivalence class element Prefix FEC Element of the label mapping message.</claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>The method according to claims 11 to 13, wherein the label request message is an LDP label request message, the address of the destination node device and the address of the proxy node device are carried by extending a Prefix FEC Element of the label request message.</claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The method according to any one of claims 11 to 14, wherein the label mapping message further carries a topology identification ID to enable the first LSP to be established in a network topology corresponding to the topology ID.</claim-text></claim><claim id="c-en-0016" num="0016"><claim-text>A proxy node device for establishing a label switched path LSP, wherein the proxy node device comprises:
<claim-text>an allocating unit, configured to allocate a label for a destination node device;</claim-text>
<claim-text>a generating unit, configured to generate a label mapping message, wherein the label mapping message carries the label, an address of the destination node device and an address of the proxy node device;</claim-text>
<claim-text>a sending unit, configured to send the label mapping message to an upstream node device of the proxy node device to initiate establishment of a first LSP from an entry node device to the proxy node device; and</claim-text>
<claim-text>a stitching unit, configured to stitch the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, wherein the second LSP is an LSP established between the proxy node device and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</claim-text></claim-text></claim><claim id="c-en-0017" num="0017"><claim-text>The proxy node device according to claim 16, wherein the proxy node device further comprises:
<claim-text>a receiving unit, configured to receive a label request message sent by the upstream node before the generating unit allocates the label for the destination node device, wherein the label request message carries the address of the destination node device and the address of the proxy node device.</claim-text><!-- EPO <DP n="39"> --></claim-text></claim><claim id="c-en-0018" num="0018"><claim-text>An intermediary node device for establishing a label switched path LSP, wherein the intermediary node device comprises:
<claim-text>a first receiving unit, configured to receive a first label mapping message sent by a downstream node device of the intermediary node device, wherein the first label mapping message carries a first label allocated by the downstream node device for a destination node device, an address of the destination node device and an address of a proxy node device, and the first label mapping message is generated by the downstream node device after the proxy node device initiates establishment of a first LSP from an entry node device to the proxy node device;</claim-text>
<claim-text>an allocating unit, configured to allocate a second label for the destination node device; and</claim-text>
<claim-text>a first sending unit, configured to send a second label mapping message to an upstream node device of the intermediary node device, wherein the second label mapping message carries the second label, the address of the destination node device and the address of the proxy node device.</claim-text></claim-text></claim><claim id="c-en-0019" num="0019"><claim-text>The intermediary node device according to claim 18, wherein the intermediary node device further comprises:
<claim-text>a second receiving unit, configured to receive a first label request message sent by the upstream node device of the intermediary node device before the first receiving unit receives the first label mapping message sent by the downstream node device of the intermediary node device, wherein the first label request message carries the address of the destination node device and the address of the proxy node device; and</claim-text>
<claim-text>a second sending unit, configured to send a second label request message to the downstream node device of the intermediary node device, wherein the second label request message carries the address of the destination node device and the address of the proxy node device.</claim-text></claim-text></claim><claim id="c-en-0020" num="0020"><claim-text>An entry node device for establishing a label switched path LSP, wherein the entry node device comprises:
<claim-text>a receiving unit, configured to receive a label mapping message sent by a downstream node device of the entry node device, wherein the label mapping message carries a label<!-- EPO <DP n="40"> --> allocated by the downstream node device for a destination node device, an address of a proxy node device and an address of the destination node device, and the label mapping message is generated by the downstream node device after the proxy node device initiates establishment of an LSP from the entry node device to the proxy node device; and</claim-text>
<claim-text>an establishing unit, configured to establish the LSP from the entry node device to the proxy node device according to the address of the proxy node device, and establish a label forwarding table, wherein the label forwarding table comprises the label, the address of the proxy node device and the address of the destination node device.</claim-text></claim-text></claim><claim id="c-en-0021" num="0021"><claim-text>The entry node device according to claim 20, wherein the entry node device further comprises:
<claim-text>a sending unit, configured to send a label request message to the downstream node device before the receiving unit receives the label mapping message sent by the downstream node device of the entry node device, wherein the label request message carries the address of the destination node device and the address of the proxy node device.</claim-text></claim-text></claim><claim id="c-en-0022" num="0022"><claim-text>A system for establishing a label switched path LSP, wherein the system comprises: a proxy node device, an intermediary node device and an entry node device, wherein,<br/>
the proxy node device is configured to allocate a first label for a destination node device, send the first label mapping message to the intermediary node device to initiate establishment of a first LSP from the entry node device to the proxy node device, wherein the first label mapping message carries the first label, an address of the destination node device and an address of the proxy node device;<br/>
the intermediary node device is configured to receive the first label mapping message, and allocate a second label for the destination node device, and send a second label mapping message comprising the second label, the address of the destination node device and the address of the proxy node device to the entry node device;<br/>
the entry node device is configured to receive the second label mapping message, and establish the first LSP according to the address of the proxy node device; and<br/>
the proxy node device is further configured to stitch the first LSP with a second LSP to form a third LSP from the entry node device to the destination node device, wherein the<!-- EPO <DP n="41"> --> second LSP is an LSP established between the proxy node device and the destination node device, and the first LSP and the second LSP are LSPs of different protocol types.</claim-text></claim><claim id="c-en-0023" num="0023"><claim-text>The system according to claim 22, wherein,<br/>
the entry node device is further configured to send a first label request message to the intermediary node device before the proxy node device sends the first label mapping message to the intermediary node device, wherein the label request message carries the address of the destination node device and the address of the proxy node device;<br/>
the intermediary node device is further configured to receive the first label request message sent by the entry node device, and send a second label request message to the destination node device, wherein the second label request message carries the address of the proxy node device and the address of the destination node device; and<br/>
the proxy node device is further configured to receive the second label request message sent by the intermediary node device.</claim-text></claim></claims><drawings mxw-id="PDW20421962" load-source="patent-office"><!-- EPO <DP n="42"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="192" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="43"> --><figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="165" he="205" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="44"> --><figure id="f0003" num="5,6,7"><img id="if0003" file="imgf0003.tif" wi="165" he="206" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="45"> --><figure id="f0004" num="8,9"><img id="if0004" file="imgf0004.tif" wi="165" he="195" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="46"> --><figure id="f0005" num="10,11"><img id="if0005" file="imgf0005.tif" wi="165" he="200" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="47"> --><figure id="f0006" num="12,13"><img id="if0006" file="imgf0006.tif" wi="91" he="230" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="48"> --><figure id="f0007" num="14,15"><img id="if0007" file="imgf0007.tif" wi="89" he="223" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="49"> --><figure id="f0008" num="16,17"><img id="if0008" file="imgf0008.tif" wi="99" he="191" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="50"> --><figure id="f0009" num="18,19"><img id="if0009" file="imgf0009.tif" wi="104" he="188" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="51"> --><figure id="f0010" num="20"><img id="if0010" file="imgf0010.tif" wi="125" he="97" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="165" he="225" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
