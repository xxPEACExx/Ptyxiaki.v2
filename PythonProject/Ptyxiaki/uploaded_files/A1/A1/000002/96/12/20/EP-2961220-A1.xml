<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2961220-A1" country="EP" doc-number="2961220" kind="A1" date="20151230" family-id="51553617" file-reference-id="298577" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451122" ucid="EP-2961220-A1"><document-id><country>EP</country><doc-number>2961220</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14768358-A" is-representative="YES"><document-id mxw-id="PAPP193865212" load-source="patent-office" format="original"><country>EP</country><doc-number>14768358.5</doc-number><date>20140318</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193865213" load-source="docdb" format="epo"><country>EP</country><doc-number>14768358</doc-number><kind>A</kind><date>20140318</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162030148" ucid="CN-201310086370-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201310086370</doc-number><kind>A</kind><date>20130318</date></document-id></priority-claim><priority-claim mxw-id="PPC162035252" ucid="CN-2014073571-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2014073571</doc-number><kind>W</kind><date>20140318</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1969293793" load-source="docdb">H04W   4/00        20090101AFI20160211BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1969295785" load-source="docdb">H04W  36/14        20090101ALI20160211BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1699660132" load-source="docdb" scheme="CPC">H04W  76/10        20180201 LI20180203BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1699660133" load-source="docdb" scheme="CPC">H04W   4/80        20180201 LI20180203BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1889087747" load-source="docdb" scheme="CPC">H04W  36/0033      20130101 LI20161012BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1889090299" load-source="docdb" scheme="CPC">H04W  84/18        20130101 LA20161012BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1976516533" load-source="docdb" scheme="CPC">H04W  36/14        20130101 FI20160205BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1976517421" load-source="docdb" scheme="CPC">H04W  88/02        20130101 LA20160204BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165544832" lang="DE" load-source="patent-office">VERBINDUNGSVERMITTLUNGSVERFAHREN UND ENTSPRECHENDE VORRICHTUNG AUF BASIS EINER NAHFELDKOMMUNIKATION</invention-title><invention-title mxw-id="PT165544833" lang="EN" load-source="patent-office">CONNECTION SWITCHING METHOD AND CORRESPONDING DEVICE BASED ON NEAR FIELD COMMUNICATION</invention-title><invention-title mxw-id="PT165544834" lang="FR" load-source="patent-office">PROCÉDÉ DE TRANSFERT DE CONNEXION ET DISPOSITIF CORRESPONDANT BASÉ SUR UNE COMMUNICATION EN CHAMP PROCHE</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103315555" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>HUAWEI DEVICE CO LTD</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103320228" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>HUAWEI DEVICE CO., LTD.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101641034" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Huawei Device Co., Ltd.</last-name><iid>101160487</iid><address><street>Building B2 Huawei Industrial Base Bantian</street><city>Longgang District Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103309131" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ZHAO XIAONA</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103336637" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ZHAO, XIAONA</last-name></addressbook></inventor><inventor mxw-id="PPAR1101643878" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ZHAO, XIAONA</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103316877" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>JIN ZHIHAO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103312663" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>JIN, ZHIHAO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101649133" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>JIN, ZHIHAO</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103318981" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>LI GUOQING</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103322186" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>LI, GUOQING</last-name></addressbook></inventor><inventor mxw-id="PPAR1101648778" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>LI, GUOQING</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103305471" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>WANG MIAO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103320314" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>WANG, MIAO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651148" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>WANG, MIAO</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103316234" load-source="docdb" sequence="5" format="epo"><addressbook><last-name>CHANG XINMIAO</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103305696" load-source="docdb" sequence="5" format="intermediate"><addressbook><last-name>CHANG, XINMIAO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101647215" load-source="patent-office" sequence="5" format="original"><addressbook><last-name>CHANG, XINMIAO</last-name><address><street>Huawei Administration Building Bantian Longgang District</street><city>Shenzhen Guangdong 518129</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101646518" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Maiwald Patentanwalts GmbH</last-name><iid>100061181</iid><address><street>Elisenhof Elisenstrasse 3</street><city>80335 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2014073571-W"><document-id><country>CN</country><doc-number>2014073571</doc-number><kind>W</kind><date>20140318</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014146563-A1"><document-id><country>WO</country><doc-number>2014146563</doc-number><kind>A1</kind><date>20140925</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660781741" load-source="docdb">AL</country><country mxw-id="DS660680247" load-source="docdb">AT</country><country mxw-id="DS660781743" load-source="docdb">BE</country><country mxw-id="DS660604363" load-source="docdb">BG</country><country mxw-id="DS660604231" load-source="docdb">CH</country><country mxw-id="DS660680220" load-source="docdb">CY</country><country mxw-id="DS660680248" load-source="docdb">CZ</country><country mxw-id="DS660781744" load-source="docdb">DE</country><country mxw-id="DS660680221" load-source="docdb">DK</country><country mxw-id="DS660680222" load-source="docdb">EE</country><country mxw-id="DS660606347" load-source="docdb">ES</country><country mxw-id="DS660604364" load-source="docdb">FI</country><country mxw-id="DS660604365" load-source="docdb">FR</country><country mxw-id="DS660781745" load-source="docdb">GB</country><country mxw-id="DS660680227" load-source="docdb">GR</country><country mxw-id="DS660781746" load-source="docdb">HR</country><country mxw-id="DS660680249" load-source="docdb">HU</country><country mxw-id="DS660604232" load-source="docdb">IE</country><country mxw-id="DS660781747" load-source="docdb">IS</country><country mxw-id="DS660604366" load-source="docdb">IT</country><country mxw-id="DS660680228" load-source="docdb">LI</country><country mxw-id="DS660603380" load-source="docdb">LT</country><country mxw-id="DS660680250" load-source="docdb">LU</country><country mxw-id="DS660603381" load-source="docdb">LV</country><country mxw-id="DS660603382" load-source="docdb">MC</country><country mxw-id="DS660611762" load-source="docdb">MK</country><country mxw-id="DS660680163" load-source="docdb">MT</country><country mxw-id="DS660604383" load-source="docdb">NL</country><country mxw-id="DS660606348" load-source="docdb">NO</country><country mxw-id="DS660604384" load-source="docdb">PL</country><country mxw-id="DS660680164" load-source="docdb">PT</country><country mxw-id="DS660604385" load-source="docdb">RO</country><country mxw-id="DS660680165" load-source="docdb">RS</country><country mxw-id="DS660604386" load-source="docdb">SE</country><country mxw-id="DS660680166" load-source="docdb">SI</country><country mxw-id="DS660604233" load-source="docdb">SK</country><country mxw-id="DS660604234" load-source="docdb">SM</country><country mxw-id="DS660603384" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479492" lang="EN" load-source="patent-office"><p id="pa01" num="0001">Embodiments of the present invention disclose a connection handover method based on near field communication, and further disclose a connection handover apparatus. The method includes: acquiring, by a zeroth terminal, idle connection resource information of the zeroth terminal; receiving a request message that is sent by a first terminal and is used for initiating a connection handover process or used for notifying the zeroth terminal that a connection handover process needs to be performed; and determining, according to the request message, that the following determining needs to be performed: determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, if yes, sending a response message to the first terminal, so as to feed back connection configuration information of the zeroth terminal to the first terminal, and if not, skipping feeding back connection configuration information of the zeroth terminal to the first terminal. In the present invention, it can be ensured that a zeroth terminal has an idle connection resource when the zeroth terminal feeds back connection configuration information of the zeroth terminal; and when the zeroth terminal has no idle connection resource, a process, for example, in which a Bluetooth module and/or a Wi-Fi module of the zeroth terminal attempts to establish a connection, can be avoided, thereby improving communication efficiency.<img id="iaf01" file="imgaf001.tif" wi="160" he="82" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759304" lang="EN" source="EPO" load-source="docdb"><p>Embodiments of the present invention disclose a connection handover method based on near field communication, and further disclose a connection handover apparatus. The method includes: acquiring, by a zeroth terminal, idle connection resource information of the zeroth terminal; receiving a request message that is sent by a first terminal and is used for initiating a connection handover process or used for notifying the zeroth terminal that a connection handover process needs to be performed; and determining, according to the request message, that the following determining needs to be performed: determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, if yes, sending a response message to the first terminal, so as to feed back connection configuration information of the zeroth terminal to the first terminal, and if not, skipping feeding back connection configuration information of the zeroth terminal to the first terminal. In the present invention, it can be ensured that a zeroth terminal has an idle connection resource when the zeroth terminal feeds back connection configuration information of the zeroth terminal; and when the zeroth terminal has no idle connection resource, a process, for example, in which a Bluetooth module and/or a Wi-Fi module of the zeroth terminal attempts to establish a connection, can be avoided, thereby improving communication efficiency.</p></abstract><description mxw-id="PDES98404193" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>TECHNICAL FIELD</b></heading><p id="p0001" num="0001">The present invention relates to the field of communications technologies, and in particular, to a connection handover method based on near field communication and a corresponding apparatus.</p><heading id="h0002"><b>BACKGROUND</b></heading><p id="p0002" num="0002">Near field communication (NFC, Near Field Communication) is a short-range wireless connection technology, in which based on a radio frequency identification (RFID, Radio Frequency Identification) technology, electromagnetic induction is used to implement communication between electronic devices at a short distance. A user only needs a tap (Tap) or devices in close proximity to implement intuitive, secure, and noncontact information exchange, payment transactions, and the like.</p><p id="p0003" num="0003">A point-to-point (P2P) working mode is a major bidirectional interaction protocol defined in NFC standards. A major protocol used to establish a link at a data link layer between two NFC terminals in an interaction process in the working mode is the Logical Link Control Protocol (Logical Link Control Protocol, LLCP). With the development of the NFC standards, at present, a division manner is proposed, in which an NFC controller (NFC controller, NFCC) is fully responsible for work of the LLCP protocol, whereas a device host (Device Host, DH) is responsible for interaction of application layer data on the LLCP. A method in which a DH configures an NFCC is also specifically defined in NCI specifications.</p><p id="p0004" num="0004">For two NFC terminals, if the two NFC terminals have a matching carrier (that is, the two NFC terminals support at least one same type of carriers, for example, Bluetooth or Wi-Fi at the same time), by means of a simple tap, the two NFC terminals may exchange Bluetooth and/or Wi-Fi connection configuration information by means of NFC communication in a P2P working mode, so as to rapidly establish a Bluetooth or Wi-Fi connection between the terminals. Such a technology of exchanging connection configuration information by means of NFC communication and rapidly establishing a second type of connection (for example, a Bluetooth connection or Wi-Fi connection) is an NFC connection handover technology. In addition, In a case in which it is inconvenient for<!-- EPO <DP n="2"> --> two NFC terminals to directly tap each other or get into proximity to each other to implement a connection handover, the NFC Forum proposes, in Connection Handover 1.3 Draft, a method in which a mobile NFC terminal (for example, a mobile phone, or a tablet computer) serves as a handover medium to assist the two terminals in implementing a connection handover to establish a Bluetooth or Wi-Fi connection.</p><p id="p0005" num="0005">In the prior art, according to Connection Handover 1.3 Draft, for two NFC terminals, when one terminal (serving as a connection handover requester or a handover medium) initiates NFC communication to the other terminal to request a connection handover, unless the other terminal does not have a carrier matching that of the terminal or does not support any carrier, the other terminal feeds back connection configuration information of a corresponding (that is: a matching or supportable) carrier to the terminal, so as to trigger a processing process in which a Bluetooth and/or Wi-Fi module establishes a connection.</p><p id="p0006" num="0006">The prior art has the following problems: When the other terminal no longer has a connection resource that can be used for establishing a connection, the other terminal still feeds back connection configuration information of the other terminal to the terminal, and triggers the Bluetooth and/or Wi-Fi module to attempt to establish a wireless connection (in this case, even if the Bluetooth and/or Wi-Fi module is triggered, the two terminals still cannot successfully establish a connection), resulting in low communication efficiency; it cannot be ensured that a connection resource that can be used for establishing a connection exists when a connection handover selector feeds back connection configuration information of the connection handover selector; and user experience is poor.</p><heading id="h0003"><b>SUMMARY</b></heading><p id="p0007" num="0007">A technical problem to be solved by embodiments of the present invention is to provide a connection handover method based on near field communication, and a corresponding apparatus, so as to solve the following technical problems in the prior art: it cannot be ensured that a connection resource that can be used for establishing a connection exists when a connection handover selector feeds back connection configuration information of the connection handover selector; communication efficiency is low; and user experience is poor, where these problems are caused by the fact that an NFC terminal cannot properly control whether to feed back connection configuration information of the NFC terminal to another terminal.</p><p id="p0008" num="0008">To solve the foregoing technical problems, according to a first aspect, a connection handover method based on near field communication is provided, including:
<ul><li>acquiring, by a zeroth terminal, idle connection resource information of the zeroth<!-- EPO <DP n="3"> --> terminal;</li><li>receiving a request message sent by a first terminal, the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed; and</li><li>determining, according to the request message, that the following first determining needs to be performed:
<ul><li>determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, if yes, sending a response message to the first terminal, so as to feed back connection configuration information of the zeroth terminal to the first terminal, and if not, skipping feeding back connection configuration information of the zeroth terminal to the first terminal.</li></ul></li></ul></p><p id="p0009" num="0009">As a first possible implementation manner of the first aspect, the idle connection resource information of the zeroth terminal includes: the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources.</p><p id="p0010" num="0010">As a second possible implementation manner of the first aspect, when the first terminal is a handover medium:
<ul><li>the receiving a request message sent by a first terminal includes: receiving a first connection handover request used for initiating a connection handover process, so as to determine that the first determining needs to be performed; the sending a response message to the first terminal includes: sending a first connection handover medium message including the connection configuration information of the zeroth terminal, and the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</li></ul></p><p id="p0011" num="0011">As a third possible implementation manner of the first aspect, when the first terminal is a handover medium:
<ul><li>the receiving a request message sent by a first terminal includes: receiving a first device activation request used for initiating a device activation request, where the first device activation request carries a first action identifier, so that the zeroth terminal determines, according to the first action identifier, that a connection handover process needs to be performed, so as to determine that the first determining needs to be performed; and the sending a response message to the first terminal includes: sending a first device activation response, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process, where the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration<!-- EPO <DP n="4"> --> information, and/or Wi-Fi connection configuration information of the zeroth terminal.</li></ul></p><p id="p0012" num="0012">With reference to the second possible implementation manner of the first aspect, a fourth possible implementation manner of the first aspect is further provided, where:
<ul><li>the first connection handover request carries a first identifier used for identifying the first terminal; the first terminal is specifically a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection; and if it is determined that the zeroth terminal has an idle connection resource, the method further includes: reserving, by the zeroth terminal, a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal; and after the sending a first connection handover medium message and reserving a connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, the method further includes: receiving a second connection handover request sent by a third terminal, where the second connection handover request carries a second identifier used for identifying the third terminal; and determining, according to the second identifier and the first identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</li></ul></p><p id="p0013" num="0013">With reference to the fourth possible implementation manner of the first aspect, a fifth possible implementation manner of the first aspect is further provided, where the determining whether to feed back the connection configuration information of the zeroth terminal to the third terminal includes: when the third terminal and the first terminal are the same terminal, sending a second connection handover medium message to the third terminal, where the second connection handover medium message includes the connection configuration information of the zeroth terminal; and when the third terminal and the first terminal are not the same terminal, determining, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</p><p id="p0014" num="0014">With reference to the fifth possible implementation manner of the first aspect, a sixth possible implementation manner of the first aspect is further provided, where the determining, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether to feed back the connection configuration information of the zeroth terminal to the third terminal includes:
<ul><li>determining, according to the idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether the zeroth terminal has an idle connection resource, and in a case in which the zeroth terminal has no idle connection resource, if the third<!-- EPO <DP n="5"> --> terminal is a connection handover requester, sending a first connection handover selection message to the third terminal to indicate that a connection resource of the zeroth terminal is limited; and if the third terminal is a handover medium, sending a third connection handover medium message only including a message header and a message trailer to the third terminal; or</li><li>in a case in which the zeroth terminal has an idle connection resource, if the third terminal is a connection handover requester, sending a second connection handover selection message to the third terminal, where the second connection handover selection message includes the connection configuration information of the zeroth terminal; and if the third terminal is a handover medium, sending a fourth connection handover medium message to the third terminal, where the fourth connection handover medium message includes the connection configuration information of the zeroth terminal.</li></ul></p><p id="p0015" num="0015">With reference to the sixth possible implementation manner of the first aspect, a seventh possible implementation manner of the first aspect is further provided, where the first connection handover selection message includes: an error code used for representing that a connection resource of the zeroth terminal is limited and a cause value.</p><p id="p0016" num="0016">With reference to the third possible implementation manner of the first aspect, an eighth possible implementation manner of the first aspect is further provided, where the first device activation request further carries a third identifier used for identifying the first terminal; the first terminal is specifically a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection; if it is determined that the zeroth terminal has an idle connection resource, the method further includes: reserving, by the zeroth terminal, a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal; and after the sending a first device activation response and reserving a connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, the method further includes:
<ul><li>receiving a second device activation request sent by a third terminal, where the second device activation request carries a second action identifier and a fourth identifier, where the fourth identifier is used for identifying the third terminal; determining, according to the second action identifier, that a connection handover process needs to be performed; and determining, according to the fourth identifier and the third identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to send a second device activation response to the third terminal.</li></ul></p><p id="p0017" num="0017">With reference to the eighth possible implementation manner of the first aspect, a ninth possible implementation manner of the first aspect is further provided, where<br/>
<!-- EPO <DP n="6"> -->the determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource includes: determining, by a near field communication controller NFCC of the zeroth terminal according to the idle connection resource information of the zeroth terminal configured by a device host DH for the NFCC of the zeroth terminal, whether the zeroth terminal has an idle connection resource; the first terminal configures, by using a DH, the first action identifier and the third identifier for an NFCC of the first terminal, so as to send the first device activation request by using the NFCC of the first terminal; and the second action identifier and the fourth identifier in the second device activation request are configured by the third terminal for an NFCC of the third terminal by using a DH, and the NFCC of the third terminal sends the second device activation request.</p><p id="p0018" num="0018">With reference to the eighth or ninth possible implementation manner of the first aspect, a tenth possible implementation manner of the first aspect is further provided, where the determining whether to send a second device activation response to the third terminal includes:
<ul><li>if the third terminal and the first terminal are the same terminal, sending the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process; and if the third terminal and the first terminal are not the same terminal, performing determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, to determine whether the zeroth terminal has an idle connection resource, if yes, sending the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process, otherwise, skipping sending the second device activation response.</li></ul></p><p id="p0019" num="0019">With reference to the sixth, seventh or tenth possible implementation manner of the first aspect, an eleventh possible implementation manner of the first aspect is further provided, where when it is determined, by performing the determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, that the zeroth terminal has an idle connection resource, the method further includes: reserving a connection resource for the third terminal.</p><p id="p0020" num="0020">With reference to the first aspect or the first possible implementation manner of the first aspect, a twelfth possible implementation manner of the first aspect is further provided, where if the first terminal is a connection handover requester:
<ul><li>the request message is a third connection handover request used for initiating a connection handover process, and the response message is a third connection handover selection<!-- EPO <DP n="7"> --> message including the connection configuration information of the zeroth terminal; or,</li><li>the request message is a third device activation request carrying a third action identifier, so that the zeroth terminal determines, according to the third action identifier, that a connection handover process needs to be performed, where the third action identifier is configured by the first terminal by using a DH for an NFCC of the first terminal, so as to send the third device activation request by using the NFCC of the first terminal; the response message is a third device activation response, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process; and the determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource includes: determining, by an NFCC of the zeroth terminal according to the idle connection resource information of the zeroth terminal configured by a DH for the NFCC of the zeroth terminal, whether the zeroth terminal has an idle connection resource.</li></ul></p><p id="p0021" num="0021">According to a second aspect, a connection handover apparatus for near field communication is provided, including:
<ul><li>an acquiring unit, configured to acquire idle connection resource information of a zeroth terminal;</li><li>a first receiving unit, configured to receive a request message sent by a first terminal, where the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed;</li><li>a first determining unit, configured to determine, according to the request message, that a first judging unit needs to be triggered;</li><li>the first judging unit, configured to determine, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, and if yes, trigger a first sending unit, where if not, the connection handover apparatus does not feed back connection configuration information of the zeroth terminal to the first terminal; and</li><li>the first sending unit, configured to send a response message to the first terminal, so as to feed back the connection configuration information of the zeroth terminal to the first terminal.</li></ul></p><p id="p0022" num="0022">As a first possible implementation manner of the second aspect, the idle connection resource information of the zeroth terminal includes: the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources.</p><p id="p0023" num="0023">As a second possible implementation manner of the second aspect:
<ul><li>the first receiving unit is specifically configured to: when the first terminal is a handover medium, receive a first connection handover request that is sent by the first terminal and is used for<!-- EPO <DP n="8"> --> initiating a connection handover process; and the first sending unit is specifically configured to: when the first terminal is a handover medium, send a first connection handover medium message including the connection configuration information of the zeroth terminal to the first terminal, where the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</li></ul></p><p id="p0024" num="0024">As a third possible implementation manner of the second aspect, when the first terminal is a handover medium:
<ul><li>the first receiving unit is specifically configured to: when the first terminal is a handover medium, receive a first device activation request that is sent by the first terminal and is used for initiating a device activation request, where the first device activation request carries a first action identifier; the first determining unit is specifically configured to: when the first terminal is a handover medium, determine, according to the first action identifier, that a connection handover process needs to be performed, and trigger the first judging unit; and the first sending unit is specifically configured to: when the first terminal is a handover medium, send a first device activation response to the first terminal, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process, where the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</li></ul></p><p id="p0025" num="0025">With reference to the second possible implementation manner of the second aspect, a fourth possible implementation manner of the second aspect is further provided, where the first connection handover request carries a first identifier used for identifying the first terminal; and the apparatus further includes:
<ul><li>a first processing unit, configured to: in a case in which the first terminal is a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection, when the first judging unit judges that the zeroth terminal has an idle connection resource, reserve a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal; a second receiving unit, configured to: after the apparatus sends the first connection handover medium message and reserves the connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, receive a second connection handover request sent by a third terminal, where the second connection handover request carries a second identifier used for identifying the third terminal; a second determining unit, configured to determine, according to the second connection handover request, to<!-- EPO <DP n="9"> --> trigger a second processing unit; and the second processing unit, configured to determine, according to the second identifier and the first identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</li></ul></p><p id="p0026" num="0026">With reference to the fourth possible implementation manner of the second aspect, a fifth possible implementation manner of the second aspect is further provided, where the second processing unit includes:
<ul><li>a first judging module, configured to determine, according to the second identifier and the first identifier, whether the third terminal and the first terminal are the same terminal, and if yes, trigger a first sending module, otherwise, trigger a first processing module; the first sending module, configured to send a second connection handover medium message to the third terminal, where the second connection handover medium message includes the connection configuration information of the zeroth terminal; and the first processing module, configured to determine, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</li></ul></p><p id="p0027" num="0027">With reference to the fifth possible implementation manner of the second aspect, a sixth possible implementation manner of the second aspect is further provided, where the first processing module includes:
<ul><li>a first judging submodule, configured to determine, according to the idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether the zeroth terminal has an idle connection resource, and when it is determined that there is no idle connection resource, trigger a first sending submodule, otherwise, trigger a second sending submodule; the first sending submodule, configured to: when the third terminal is a connection handover requester, send a first connection handover selection message to the third terminal to indicate that a connection resource of the zeroth terminal is limited; and when the third terminal is a handover medium, send a third connection handover medium message only including a message header and a message trailer to the third terminal; and the second sending submodule, configured to: when the third terminal is a connection handover requester, send a second connection handover selection message to the third terminal, where the second connection handover selection message includes the connection configuration information of the zeroth terminal; and when the third terminal is a handover medium, send a fourth connection handover medium message to the third terminal, where the fourth connection handover medium message includes the connection configuration information of the zeroth terminal.</li></ul><!-- EPO <DP n="10"> --></p><p id="p0028" num="0028">With reference to the sixth possible implementation manner of the second aspect, a seventh possible implementation manner of the second aspect is further provided, where the first connection handover selection message includes: an error code used for representing that a connection resource of the zeroth terminal is limited and a cause value.</p><p id="p0029" num="0029">With reference to the third possible implementation manner of the second aspect, an eighth possible implementation manner of the second aspect is further provided, where the acquiring unit includes: a first configuring module, configured to configure the idle connection resource information of the zeroth terminal for a near field communication controller NFCC of the zeroth terminal by using a device host DH of the zeroth terminal, so that the first judging unit determines, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource.</p><p id="p0030" num="0030">With reference to the third or eighth possible implementation manner of the second aspect, a ninth possible implementation manner of the second aspect is further provided, where the first device activation request further carries a third identifier used for identifying the first terminal; and the apparatus further includes:
<ul><li>a third processing unit, configured to: in a case in which the first terminal is a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection, when the first judging unit judges that the zeroth terminal has an idle connection resource, reserve a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal; a third receiving unit, configured to: after the apparatus sends the first device activation response and reserves the connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, receive a second device activation request sent by a third terminal, where the second device activation request carries a second action identifier and a fourth identifier, and the fourth identifier is used for identifying the third terminal; a third determining unit, configured to determine, according to the second action identifier, that a connection handover process needs to be performed, so as to trigger a fourth processing unit; and the fourth processing unit, configured to determine, according to the fourth identifier and the third identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to send a second device activation response to the third terminal.</li></ul></p><p id="p0031" num="0031">With reference to the ninth possible implementation manner of the second aspect, a tenth possible implementation manner of the second aspect is further provided, where the fourth processing unit includes:
<ul><li>a second judging module, configured to determine, according to the fourth identifier and<!-- EPO <DP n="11"> --> the third identifier, whether the third terminal and the first terminal are the same terminal, and if yes, trigger a second sending module, otherwise, trigger a third judging module; the second sending module, configured to send the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process; and the third judging module, configured to perform determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, to determine whether the zeroth terminal has an idle connection resource, and if yes, trigger the second sending module; or otherwise, skip triggering the second sending module.</li></ul></p><p id="p0032" num="0032">With reference to the sixth, seventh or tenth possible implementation manner of the second aspect, an eleventh possible implementation manner of the second aspect is further provided, where the apparatus further includes: a fifth processing unit, configured to reserve a connection resource for the third terminal.</p><p id="p0033" num="0033">With reference to the second aspect or the first possible implementation manner of the second aspect, a twelfth possible implementation manner of the second aspect is further provided, where:
<ul><li>the first receiving unit is specifically configured to: when the first terminal is a connection handover requester, receive a third connection handover request that is sent by the first terminal and is used for initiating a connection handover process; and the first sending unit is specifically configured to: when the first terminal is a connection handover requester, send a third connection handover selection message including the connection configuration information of the zeroth terminal to the first terminal; or,</li><li>the acquiring unit includes: a second configuring module, configured to configure the idle connection resource information of the zeroth terminal for an NFCC of the zeroth terminal by using a DH of the zeroth terminal, so that the first judging unit judges whether the zeroth terminal has an idle connection resource; the first receiving unit is specifically configured to: when the first terminal is a connection handover requester, receive a third device activation request that is sent by the first terminal and carries a third action identifier, so that the first determining unit determines, according to the third action identifier, that a connection handover process needs to be performed; and the first sending unit is specifically configured to: when the first terminal is a connection handover requester, send a third device activation response to the first terminal, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process.</li></ul></p><p id="p0034" num="0034">According to a third aspect, a connection handover apparatus for near field<!-- EPO <DP n="12"> --> communication is provided, including:
<ul><li>a sending unit, configured to send a request message to a zeroth terminal, where the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed, where the request message carries a terminal identifier, and the terminal identifier is used for identifying a sender of the request message, so that the zeroth terminal identifies the sender of the request message according to the terminal identifier.</li></ul></p><p id="p0035" num="0035">As a first possible implementation manner of the third aspect, the request message is a connection handover request used for initiating a connection handover process; or the request message is a device activation request carrying an action identifier, so that the zeroth terminal determines, according to the action identifier, that a connection handover process needs to be performed.</p><p id="p0036" num="0036">With reference to the first possible implementation manner of the third aspect, a second possible implementation manner of the third aspect is further provided, where the apparatus further includes: a configuring unit, configured to configure the terminal identifier and the action identifier for an NFCC by using a DH, so that the sending unit sends the device activation request.</p><p id="p0037" num="0037">With reference to the first or second possible implementation manner of the third aspect, a third possible implementation manner of the third aspect is further provided, where the apparatus further includes: a receiving unit, configured to receive a response message sent by the zeroth terminal after the zeroth terminal receives the request message, where in a case in which the request message is the connection handover request, if the zeroth terminal has an idle connection resource, the response message includes connection configuration information of the zeroth terminal (for example, the response message may be a first connection handover selection message including an error code used for representing that a connection resource is limited and a cause value, or may also be a third connection handover medium message only including a message header and a message trailer), otherwise, the response message does not include connection configuration information of the zeroth terminal; and in a case in which the request message is the device activation request, when the zeroth terminal has an idle connection resource, the response message is a device activation response.</p><p id="p0038" num="0038">The implementation of the embodiments of the present invention has the following beneficial effects:
<ol><li>1) A zeroth terminal determines, according to an idle connection resource of the zeroth terminal, whether to feed back connection configuration information of the zeroth terminal to a first terminal, so as to ensure that the zeroth terminal has an idle connection resource when the zeroth<!-- EPO <DP n="13"> --> terminal feeds back the connection configuration information of the zeroth terminal to the first terminal. In a case in which the zeroth terminal has no idle connection resource before receiving a request message of the first terminal, the zeroth terminal may directly determine, according to current idle connection resource information of the zeroth terminal, not to feed back the connection configuration information of the zeroth terminal to the first terminal, so that processing of attempting to establish a connection by a Bluetooth module and/or a Wi-Fi module of the zeroth terminal is not triggered, thereby improving communication efficiency.</li><li>2) By performing an operation of reserving a connection resource, it is ensured that a zeroth terminal can successfully establish a connection with a first terminal (or with the second terminal with the assistance of the first terminal). For example, when the zeroth terminal has only one idle connection resource, before the zeroth terminal establishes a connection with the second terminal with the assistance of the first terminal, the only idle connection resource is reserved for the second terminal, thereby preventing another terminal from occupying the only idle connection resource.</li><li>3) In NFC communication, a zeroth terminal directly determines, according to idle connection resource information of the zeroth terminal, whether to perform a connection handover process. For example, when the zeroth terminal has no idle connection resource, the zeroth terminal may directly determine not to respond to a device activation request sent by a first terminal or a third terminal, so that subsequent processes such as LLCP activation and data exchange are not executed, that is, an NFC communication procedure is terminated in advance, and therefore, connection configuration information is not fed back, and a process, for example, in which a Bluetooth module and/or a Wi-Fi module of the zeroth terminal attempts to establish a connection is avoided, thereby greatly saving communication time, and improving communication efficiency.</li><li>4) User experience is improved.</li></ol></p><heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading><p id="p0039" num="0039">To describe the technical solutions in the embodiments of the present invention or in the prior art more clearly, the following briefly introduces the accompanying drawings required for describing the embodiments or the prior art. Apparently, the accompanying drawings in the following description show merely some embodiments of the present invention, and a person of ordinary skill in the art may still derive other drawings from these accompanying drawings without creative efforts.
<ul><li><figref idrefs="f0001">FIG. 1</figref> is a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention;<!-- EPO <DP n="14"> --></li><li><figref idrefs="f0001">FIG. 2A</figref> is a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention;</li><li><figref idrefs="f0002">FIG. 2B</figref> is a schematic view of a format of a connection handover request message according to an embodiment of the present invention;</li><li><figref idrefs="f0003">FIG. 3A</figref> and <figref idrefs="f0004">FIG. 3B</figref> are a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention;</li><li><figref idrefs="f0005">FIG. 4</figref> is a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention;</li><li><figref idrefs="f0006">FIG. 5A1</figref>, <figref idrefs="f0007">FIG. 5A2</figref>, <figref idrefs="f0008">FIG. 5B1</figref>, and <figref idrefs="f0009">FIG. 5B2</figref> are a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention;</li><li><figref idrefs="f0010">FIG. 6</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0011">FIG. 7</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0012">FIG. 8</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention;</li><li><figref idrefs="f0013">FIG. 9A</figref> is a schematic structural diagram of an NFC terminal according to an embodiment of the present invention;</li><li><figref idrefs="f0013">FIG. 9B</figref> is a schematic structural diagram of an NFC terminal according to an embodiment of the present invention;</li><li><figref idrefs="f0014">FIG. 10</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention; and</li><li><figref idrefs="f0014">FIG. 11</figref> is a schematic structural diagram of an NFC terminal according to an embodiment of the present invention.</li></ul></p><heading id="h0005"><b>DESCRIPTION OF EMBODIMENTS</b></heading><p id="p0040" num="0040">First, some of the technical terms involved in the present invention are explained as follows:
<ul><li>NFC working mode: a card emulation mode (an NFC terminal emulates a card that meets NFC standards, and is read by another NFC reading device), a point-to-point mode (two peer NFC devices perform bidirectional information interaction in a case in which NFC standards are met), and a card reader mode (an NFC terminal serves as a card reader to read information in another card that meets NFC standards).<!-- EPO <DP n="15"> --></li><li>NFC connection handover (NFC Connection Handover): an application technology based on NFC. For a terminal that supports NFC and supports Bluetooth and/or Wi-Fi, NFC may be used to exchange Bluetooth and/or Wi-Fi connection configuration information of the device to rapidly establish a Bluetooth connection or a Wi-Fi connection between terminals. Such a technology in which NFC is used to exchange configuration information and establish a second type of connection is an NFC connection handover.</li><li>Connection handover requester (Handover Requester): a terminal that initiates an NFC connection handover. In a procedure of a connection handover, a connection handover requester actively sends Bluetooth and/or Wi-Fi connection configuration information of the connection handover requester to a peer end, so that the peer end makes a selection and establishes a connection.</li><li>Connection handover selector (Handover Selector): a terminal that accepts a connection handover. In a procedure of a connection handover, after receiving connection configuration information sent by a connection handover requester, a connection handover selector may select one connection manner and establish a connection, or may send connection configuration information supported by the connection handover selector to the connection handover requester as a response.</li><li>Alternative carrier (Alternative Carrier): a wireless communication technology that can be used to perform data exchange between a connection handover requester and a connection handover selector.</li><li>NFC data exchange format record (NFC Data Exchange Format record, NDEF record): including a load described by a type, a certain length, and one optional identifier descriptor.</li><li>Device host (Device Host, DH): responsible for management of a running environment for an NFC device and a peripheral, where the management includes management of an NFC controller peripheral, for example, initialization, configuration, and power management. By using a mobile phone having an NFC function as an example, a DH refers to a CPU of the mobile phone, and needs power supplied by an NFC terminal.</li><li>NFC controller (NFC controller, NFCC): a logic entity responsible for transfer of data on an NFC radio frequency interface. By using a mobile phone having an NFC function as an example, an NFCC refers to an NFC chip on the mobile phone. An NFCC in the present invention may work by obtaining, in a passive communication mode, electrical power supplied by a POS device.</li><li>NFC control interface (NFC controller Interface, NCI): a logic interface between a DH and an NFCC. An NCI provides the DH with various interfaces for configuring the NFCC.</li><li>Logical link control protocol (Logical Link Control Protocol, LLCP): When two NFC<!-- EPO <DP n="16"> --> terminals work in a point-to-point mode, the protocol provides work such as establishment, activation, deactivation, and management of a data link, and provides support for data transmission at an application layer.</li></ul></p><p id="p0041" num="0041">The following clearly and completely describes the technical solutions in the embodiments of the present invention with reference to the accompanying drawings in the embodiments of the present invention. Apparently, the described embodiments are merely some but not all of the embodiments of the present invention. All other embodiments obtained by a person of ordinary skill in the art based on the embodiments of the present invention without creative efforts shall fall within the protection scope of the present invention.</p><p id="p0042" num="0042"><figref idrefs="f0001">FIG. 1</figref> is a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention. Referring to <figref idrefs="f0001">FIG. 1</figref>, the method includes:
<ul><li>100: A zeroth terminal acquires idle connection resource information of the zeroth terminal.</li></ul></p><p id="p0043" num="0043">Optionally, the idle connection resource information of the zeroth terminal includes: information about an unused and unreserved connection resource of the zeroth terminal.</p><p id="p0044" num="0044">Exemplarily, an NFC chip of the zeroth terminal acquires the idle connection resource information of the zeroth terminal (that is, information about an unused connection resource of the first zeroth terminal, and in this case, because an operation of reserving a connection resource has not been performed, an idle connection resource is an unused connection resource) from a Bluetooth module and/or a Wi-Fi module.</p><p id="p0045" num="0045">Optionally, the idle connection resource information of the zeroth terminal includes: the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources.</p><p id="p0046" num="0046">102: Receive a request message sent by a first terminal, where the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed. The first terminal may serve as a connection handover requester or a handover medium. A person skilled in the art should understand that the zeroth terminal may determine the identity of the first terminal according to carrier content in the request message, and the present invention is not limited thereto.</p><p id="p0047" num="0047">104: Determine, according to the request message, that the following first determining needs to be performed:
<ul><li>determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, if yes, sending a response message to<!-- EPO <DP n="17"> --> the first terminal, so as to feed back connection configuration information of the zeroth terminal to the first terminal, and if not, skipping feeding back connection configuration information of the zeroth terminal to the first terminal, where optionally, the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</li></ul></p><p id="p0048" num="0048">Optionally, when the first terminal is a handover medium, the request message is a connection handover request; the response message is a connection handover medium message including the connection configuration information of the zeroth terminal; and the skipping feeding back connection configuration information of the zeroth terminal to the first terminal includes: sending a connection handover medium message to the first terminal, where the message does not include the connection configuration information of the zeroth terminal. Alternatively, when the first terminal is a handover medium, the request message is a device activation request; the response message is a device activation response; and the skipping feeding back connection configuration information of the zeroth terminal to the first terminal includes: skipping sending the device activation response to the first terminal. For more detailed description, refer to the description in the embodiments shown in <figref idrefs="f0001">FIG. 2A</figref> and <figref idrefs="f0005">FIG. 4</figref>.</p><p id="p0049" num="0049">Optionally, when the first terminal is a connection handover requester, the request message is a third connection handover request used for initiating a connection handover process; the response message is a third connection handover selection message including the connection configuration information of the zeroth terminal; and the skipping feeding back connection configuration information of the zeroth terminal to the first terminal includes: sending a connection handover selection message to the first terminal, where the message includes an error code for representing that a connection resource of the zeroth terminal is limited and a cause value. Alternatively, when the first terminal is a connection handover requester, the request message is a third device activation request carrying a third action identifier, so that the zeroth terminal determines, according to the third action identifier, that a connection handover process needs to be performed; the response message is a third device activation response, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process; and the skipping feeding back connection configuration information of the zeroth terminal to the first terminal includes: skipping sending a device activation response to the first terminal. For the description of how to configure the third action identifier and the idle connection resource information of the zeroth terminal, refer to the description below of how to configure the first action identifier and the idle connection resource information of the zeroth terminal.<!-- EPO <DP n="18"> --></p><p id="p0050" num="0050">Optionally, in an implementation manner of this embodiment, if in 104, it is determined that the zeroth terminal has an idle connection resource, not only a response message is sent to the first terminal, an operation of reserving a connection resource is further executed, including:
<ul><li>if the first terminal is a connection handover requester, reserving a connection resource for the first terminal to update the idle connection resource information of the zeroth terminal; and if the first terminal is a handover medium configured to assist the zeroth terminal and the second terminal in establishing a connection, reserving a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal. Exemplarily, an objective of updating an idle connection resource of the zeroth terminal is to: before a connection is established (for example, a communication connection is established) between the zeroth terminal and the first terminal (or between the zeroth terminal and the second terminal with the assistance of the first terminal), and after the zeroth terminal receives the request message sent by a third terminal, determine, according to the idle connection resource information after the zeroth terminal reserves the connection resource, whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</li></ul></p><p id="p0051" num="0051">In the method provided in this embodiment, a zeroth terminal determines, according to an idle connection resource of the zeroth terminal, whether to feed back connection configuration information of the zeroth terminal to a first terminal, so as to ensure that the zeroth terminal has an idle connection resource when the zeroth terminal feeds back the connection configuration information of the zeroth terminal to the first terminal. In a case in which the zeroth terminal has no idle connection resource before receiving the request message, the zeroth terminal may directly determine not to feed back connection configuration information of the zeroth terminal to the first terminal, so that processing of attempting to establish a connection by a Bluetooth module and/or a Wi-Fi module of the zeroth terminal is not triggered, thereby improving communication efficiency; and user experience is improved. In addition, if an operation of reserving a connection resource is executed, it can be further ensured that a connection is successfully established between the zeroth terminal and the first terminal (or between the zeroth terminal and the second terminal with the assistance of the first terminal).</p><p id="p0052" num="0052">In a case in which a handover medium is used to assist two NFCs in performing a connection handover to establish a second connection, considering that it takes time for a user to leave one terminal to reach another terminal, or a user may actively select one carrier according to a condition, which also takes time, it is specified in Connection Handover 1.3 Draft that: after any terminal sends a connection handover medium message, it may be ensured that all carriers in a carrier list of the message are kept in a connectable state for at least 2 minutes. Within this period of<!-- EPO <DP n="19"> --> time, once a third terminal taps or gets into proximity to a zeroth terminal (the zeroth terminal is an object that the handover medium taps or gets into proximity for the first time) before a connection is established between the zeroth terminal and a second terminal, the third terminal acquires Bluetooth and/or Wi-Fi connection configuration information of the zeroth terminal. When the zeroth terminal currently has only one idle Bluetooth or Wi-Fi connection resource, this connection resource that was supposed to be reserved for the second terminal is occupied first by the third terminal that appears unexpectedly, resulting in a failure of a Bluetooth or Wi-Fi connection between the zeroth terminal and the second terminal. The foregoing problem can be solved based on some embodiments of the present invention, for example, the method embodiments and corresponding apparatus embodiments in the following.</p><p id="p0053" num="0053">For the foregoing technical problem, in an implementation manner of the embodiment shown in <figref idrefs="f0001">FIG. 1</figref>, in a case in which it is determined, according to the idle connection resource information of the zeroth terminal, that the zeroth terminal has an idle connection resource, in addition to the sending a response message to the first terminal, so as to feed back connection configuration information of the zeroth terminal to the first terminal and executing an operation of reserving a connection resource, the method further includes:
<ul><li>receiving, by the zeroth terminal, a request message sent by a third terminal (for example, receives a connection handover request or a device activation request sent by the third terminal) to determine that the following second determining needs to be performed:
<ul><li>determining, according to an idle connection resource after the zeroth terminal reserves the connection resource, whether the zeroth terminal has an idle connection resource (that is, the second determining), if yes, sending a response message to the third terminal to feed back the connection configuration information of the zeroth terminal to the third terminal, and if not, skipping feeding back the connection configuration information of the zeroth terminal to the third terminal.</li></ul></li></ul></p><p id="p0054" num="0054">For more detailed description of this implementation manner, refer to the embodiments shown in <figref idrefs="f0001 f0009">FIG. 2A to FIG. 5B2</figref>.</p><p id="p0055" num="0055"><figref idrefs="f0001">FIG. 2A</figref> is a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention. Referring to <figref idrefs="f0001">FIG. 2A</figref>, the method includes:
<ul><li>200: A zeroth terminal acquires idle connection resource information of the zeroth terminal. Specifically, refer to the foregoing description of step 100. In addition, a time sequence of executing steps 200 and 202 is not limited in this embodiment, for example, step 200 may be executed after step 202 and before step 204.<!-- EPO <DP n="20"> --></li><li>202: Receive a first connection handover request that is sent by a handover medium (in this case, a first terminal serves as the handover medium, and is configured to assist the zeroth terminal and a second terminal in establishing a connection) and used for initiating a connection handover process, so as to determine that a connection handover needs to be performed, and execute step 204, where the first connection handover request carries a first identifier used for identifying the handover medium.</li><li>204: Determine, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, if yes, send a first connection handover medium message to the handover medium to perform a connection handover process, and reserve a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal, where the first connection handover medium message includes connection configuration information of the zeroth terminal. (If there is no idle connection resource, for the processing manner, refer to the description in the embodiment shown in <figref idrefs="f0001">FIG. 1</figref>)</li></ul></p><p id="p0056" num="0056">Optionally, the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration information and/or Wi-Fi connection configuration information of the zeroth terminal, or certainly may also include connection configuration information of other connection technologies.</p><p id="p0057" num="0057">206: After step 204, and before a connection is established between the zeroth terminal and the second terminal, receive a second connection handover request sent by a third terminal, where the second connection handover request carries a second identifier used for identifying the third terminal.</p><p id="p0058" num="0058">Optionally, the identity of the third terminal includes: a handover medium or a connection handover requester. The zeroth terminal may determine the identity of the third terminal according to carrier content in the second connection handover request message.</p><p id="p0059" num="0059">208: Determine, according to the second identifier and the first identifier, whether the third terminal and the handover medium are the same terminal, so as to determine whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</p><p id="p0060" num="0060">Optionally, step 208 includes the following two scenarios:
<ul><li>Scenario 1: When the third terminal and the handover medium are the same terminal, send a second connection handover medium message including the connection configuration information of the zeroth terminal to the third terminal.</li><li>Scenario 2: When the third terminal and the handover medium are not the same terminal, determine, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether to feed back the connection configuration<!-- EPO <DP n="21"> --> information of the zeroth terminal to the third terminal.</li></ul></p><p id="p0061" num="0061">Further optionally, in scenario 2, it is determined, according to the idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether the zeroth terminal has an idle connection resource, which includes the following cases:
<ul><li>Case 1: When the zeroth terminal has no idle connection resource, if the third terminal is a connection handover requester, send a first connection handover selection message to the third terminal to indicate that a connection resource of the zeroth terminal is limited (for example, the first connection handover selection message includes an error code used for representing that a connection resource of the zeroth terminal is limited and a cause value); and if the third terminal is a handover medium, send a third connection handover medium message only including a message header and a message trailer to the third terminal, so as to notify the third terminal that the zeroth terminal has no idle connection resource that is usable.
<br/>
In the foregoing case 1, when it is determined that the zeroth terminal has no idle connection resource, a response message that does not include the connection configuration information of the zeroth terminal is directly fed back, so that a Bluetooth module and/or a Wi-Fi module is not triggered, and a process, for example, in which the Bluetooth module and/or the Wi-Fi module attempts to establish a connection is avoided, thereby improving communication efficiency.
</li><li>Case 2: In a case in which the zeroth terminal has an idle connection resource, if the third terminal is a connection handover requester, send a second connection handover selection message including the connection configuration information of the zeroth terminal to the third terminal; and if the third terminal is a handover medium, send a fourth connection handover medium message including the connection configuration information of the zeroth terminal to the third terminal. Optionally, in a case in which the zeroth terminal has an idle connection resource, reserve a connection resource for the third terminal, or, if the third terminal is a handover medium, use the method provided in this embodiment to reserve a connection resource for a fourth terminal that establishes a connection with the zeroth terminal by using the third terminal.</li></ul></p><p id="p0062" num="0062">In addition to the technical effect when the first terminal serves as a handover medium in the embodiment shown in <figref idrefs="f0001">FIG. 1</figref>, the method provided in this embodiment can further: reserve a connection resource for the second terminal to prevent a phenomenon in which a connection resource is undesirably occupied, so as to ensure that a connection is successfully established between the zeroth terminal and the second terminal; identify and distinguish the third terminal and a handover medium according to terminal identifiers (for example, the first identifier and the second identifier), so as to prevent connection resources from being repeatedly reserved for the second<!-- EPO <DP n="22"> --> terminal when the third terminal is the handover medium that sends the first connection handover request; and determine, according to the identity of the third terminal and idle connection resource information after the zeroth terminal reserves the connection resource for the second terminal, whether to further reserve a connection resource, so as to prevent a phenomenon in which a connection resource is undesirably occupied when a connection is established between the zeroth terminal and the third terminal (or a connection is established between the zeroth terminal and another terminal by using the third terminal).</p><p id="p0063" num="0063"><figref idrefs="f0003">FIG. 3A</figref> and <figref idrefs="f0004">FIG. 3B</figref> are a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention. The entire procedure includes processes of a first tap (Tap1) and a second tap (Tap2).</p><p id="p0064" num="0064"><figref idrefs="f0003">FIG. 3A</figref> shows the process of the first tap, in which a zeroth terminal and a handover medium perform communication in a P2P working mode, and the handover medium is configured to assist the zeroth terminal and a second terminal in establishing a connection, including:
<ul><li>Step 0: The zeroth terminal acquires the value of current idle connection resource information x, where x represents the number of currently idle Bluetooth connection resources (optionally, the value of the number y of currently idle Wi-Fi connection resources may also be acquired. In this embodiment, the description is provided by using an example in which a first terminal, a second terminal, and a third terminal all support a Bluetooth connection only, and a person skilled in the art should understand that this embodiment is also applicable to a scenario in which each terminal supports Bluetooth and/or Wi-Fi).<br/>
Optionally, step 0 may also be executed after step 1 and before step 2.</li><li>Step 1: The handover medium (in this case, the first terminal serves as the handover medium) sends a connection handover request message (where a carrier type is "Hm", indicating that the other party is a handover medium rather than a handover requester), where the connection handover request message includes identifier information ID_INFO of the handover medium.</li><li>Step 2: The zeroth terminal judges whether currently there is no idle connection resource, that is, whether x≤0.<br/>
2a. If yes, execute step 3 a and end the entire procedure.<br/>
2b. If not, execute step 3b and subsequent steps.</li><li>Step 3a: The zeroth terminal feeds back a connection handover medium message to the handover medium, where the connection handover medium message only has a message header MB field and a message trailer ME field.</li><li>Step 3b: The zeroth terminal feeds back a connection handover medium message to the handover medium, where the connection handover medium message includes Bluetooth connection<!-- EPO <DP n="23"> --> configuration information of the zeroth terminal.</li><li>Step 4: Subtract 1 from x, so as to reserve a connection resource between the zeroth terminal and the second terminal. The second terminal is an object that a handover medium is about to tap or is tapping.</li></ul></p><p id="p0065" num="0065">Subsequently, the zeroth terminal may prepare to establish a Bluetooth connection with the second terminal. Before a Bluetooth connection is established between the zeroth terminal and the second terminal, if the zeroth terminal receives a connection handover request sent by the third terminal, the processing procedure is shown in <figref idrefs="f0004">FIG. 3B</figref>, and includes:
<ul><li>Step 5: The third terminal sends a connection handover request to the zeroth terminal, where the connection handover request includes identifier information ID_INFO of the third terminal.</li><li>Step 6: The zeroth terminal judges whether the third terminal and the handover medium are the same terminal, that is, whether ID_INFO in step 1 and ID_INFO in step 5 are same.</li><li>6a. If yes, execute step 7b and step 8.</li><li>6b. If not, determine whether the zeroth terminal currently has no idle connection resource, that is, whether x≤0.</li><li>6b.i. If yes, execute step 7a and end the entire procedure.</li><li>6b.ii. If not, execute step 7b and step 8.</li><li>Step 7a: According to the identity of the third terminal, the zeroth terminal sends a connection handover selection message (when the third terminal serves as a connection handover requester) or a connection handover medium message (when the third terminal serves as a handover medium) to the third terminal. The connection handover selection message includes an error code 0x04 and a corresponding error cause to represent that a connection resource of the zeroth terminal is limited. The connection handover medium message only includes a message header MB field and a message trailer ME field but does not include any connection configuration information.</li><li>Step 7b: According to the identity of the third terminal, the zeroth terminal transmits a connection handover medium message or a connection handover selection message to the third terminal.</li></ul></p><p id="p0066" num="0066">When the third terminal and the handover medium are the same terminal, the zeroth terminal resends, to the other party, the connection handover medium message sent in step 3b (in this case, it is unnecessary to subtract 1 from x).</p><p id="p0067" num="0067">When the third terminal and the handover medium are not the same terminal, the zeroth terminal sends the connection handover selection message (when the third terminal serves as a connection handover requester) or the connection handover medium message (when the third<!-- EPO <DP n="24"> --> terminal serves as a handover medium) to the third terminal. The connection handover selection message and the connection handover medium message include Bluetooth connection configuration information of the zeroth terminal. When the third terminal and the handover medium are not the same terminal, 1 is subtracted from x to update the value of x.</p><p id="p0068" num="0068">Step 8: The third terminal and the zeroth terminal establish a Bluetooth connection.</p><p id="p0069" num="0069">In this embodiment, a zeroth terminal acquires the number x of idle Bluetooth connection resources of the zeroth terminal, and a connection resource for establishing a connection between the zeroth terminal and another device is reserved by controlling the value of x, so as to prevent a case in which, when the zeroth terminal has only one idle connection resource and the zeroth terminal has already fed back connection configuration information to a handover medium (the handover medium is configured to assist the zeroth terminal and a second terminal in establishing a connection), the only idle connection resource is occupied first by a third terminal, thereby ensuring that a connection is successfully established between the zeroth terminal and the second terminal, and enhancing user experience.</p><p id="p0070" num="0070">In addition, a zeroth terminal directly performs determining on an idle connection resource according to the value of x, and when the zeroth terminal has no idle connection resource, the zeroth terminal determines not to feed back the connection configuration information and does not trigger a Bluetooth module, thereby avoiding a process, for example, in which the Bluetooth module attempts to establish a wireless connection, and improving communication efficiency.</p><p id="p0071" num="0071">A first connection handover request message and a second connection handover request message (for ease of description, generally referred to as a connection handover request message) involved in the embodiments shown in <figref idrefs="f0001">FIG. 1 and FIG. 2A</figref> are exemplarily described below.</p><p id="p0072" num="0072">A terminal identifier ID_INFO (a first identifier and a second identifier are both terminal, identifiers) is a parameter newly added to an auxiliary data field pointed to by an auxiliary data pointer in an ac record(s) (ac record(s)), the auxiliary data field is located in a load of an NDEF record, the size of the parameter is 1 octet (octet), and the format definition of the parameter is shown in Table 1:
<tables id="tabl0001" num="0001"><table frame="all"><title><b>(Table 1: Format of ID_INFO)</b></title><tgroup cols="9"><colspec colnum="1" colname="col1" colwidth="9mm"/><colspec colnum="2" colname="col2" colwidth="9mm"/><colspec colnum="3" colname="col3" colwidth="9mm"/><colspec colnum="4" colname="col4" colwidth="9mm"/><colspec colnum="5" colname="col5" colwidth="9mm"/><colspec colnum="6" colname="col6" colwidth="9mm"/><colspec colnum="7" colname="col7" colwidth="9mm"/><colspec colnum="8" colname="col8" colwidth="9mm"/><colspec colnum="9" colname="col9" colwidth="94mm"/><thead><row><entry namest="col1" nameend="col8" align="center" valign="middle"><b>ID_INFO</b></entry><entry align="center" valign="middle"><b>Description</b></entry></row><row><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry><entry align="center" valign="middle">The first octet located in an auxiliary data field</entry></row></thead><tbody><row><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">Random numbers that can be maintained at least 2 minutes, used for representing terminal identifier information</entry></row></tbody></tgroup></table></tables></p><p id="p0073" num="0073">The position of the parameter ID_INFO in a connection handover request message is<!-- EPO <DP n="25"> --> shown in Table 2:
<tables id="tabl0002" num="0002"><img id="ib0001" file="imgb0001.tif" wi="160" he="44" img-content="table" img-format="tif"/></tables></p><p id="p0074" num="0074">For example, if the third terminal only supports a Bluetooth connection, the format of the connection handover request message of the third terminal is shown in <figref idrefs="f0002">FIG. 2B</figref>.</p><p id="p0075" num="0075">ID_INFO is placed in the second NDEF record pointed to by an attached data pointer (more specifically, ID_INFO is placed in the field Payload 1). Refer to the prior art for the detailed description of other fields, which are not limited and described in the present invention.</p><p id="p0076" num="0076">A first connection handover selection message involved in the embodiments shown in <figref idrefs="f0001">FIG. 1 and FIG. 2A</figref> is exemplarily described below. The format of the first connection handover selection message is shown in Table 3:
<tables id="tabl0003" num="0003"><img id="ib0002" file="imgb0002.tif" wi="160" he="44" img-content="table" img-format="tif"/></tables></p><p id="p0077" num="0077">The fields represented by the dotted boxes are omitted in some cases. For example, when a connection handover selector and a connection handover requester do not have matching carriers, a connection handover selection message that is fed back does not include the fields represented by two dotted boxes.</p><p id="p0078" num="0078">When the third terminal serves as a connection handover requester to tap or get into proximity to the zeroth terminal, if the zeroth terminal has no idle connection resource except a reserved connection resource, the zeroth terminal needs to feed back an error code and a cause to the third terminal, where the error code and the cause are defined as follows:<!-- EPO <DP n="26"> -->
<br/>
Error cause value:
<tables id="tabl0004" num="0004"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="31mm"/><colspec colnum="2" colname="col2" colwidth="71mm"/><thead><row><entry align="center" valign="middle"><b>Error cause value</b></entry><entry align="center" valign="middle"><b>Error data field content</b></entry></row></thead><tbody><row><entry align="center" valign="middle">0x04</entry><entry align="center" valign="middle">Bluetooth or Wi-Fi connection resource is limited</entry></row></tbody></tgroup></table></tables><br/>
Error data field content:
<tables id="tabl0005" num="0005"><table frame="all"><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="14mm"/><colspec colnum="2" colname="col2" colwidth="152mm"/><thead><row><entry align="center" valign="middle"><b>Value</b></entry><entry align="center" valign="middle"><b>Description</b></entry></row></thead><tbody><row><entry align="center" valign="middle">0x04</entry><entry align="center" valign="middle">An 8-bit unsigned integer used for representing a shortest time interval for resending a connection handover request to a peer terminal, and the value specifically depends on the time of keeping a connectable state of a carrier of a peer terminal as specified in Connection Handover 1.3 Draft.</entry></row></tbody></tgroup></table></tables></p><p id="p0079" num="0079"><figref idrefs="f0005">FIG. 4</figref> is a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention. Referring to <figref idrefs="f0005">FIG. 4</figref>, the method includes:
<ul><li>400: A zeroth terminal acquires idle connection resource information of the zeroth terminal. For details, refer to the description about 200 in the foregoing.</li></ul></p><p id="p0080" num="0080">Optionally, step 400 includes: a device host DH of the zeroth terminal configures the idle connection resource information of the zeroth terminal for a near field communication controller NFCC of the zeroth terminal, so that in step 404, the NFCC of the zeroth terminal determines, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource. Further optionally, the NFCC of the zeroth terminal updates the idle connection resource information of the zeroth terminal.</p><p id="p0081" num="0081">402: Receive a first device activation request that is sent by a handover medium (in this case, a first terminal serves as a handover medium, and is configured to assist the zeroth terminal and a second terminal in establishing a connection) and is used for initiating a device activation request, where the first device activation request carries a first action identifier and a third identifier that is used for identifying the handover medium, so that the zeroth terminal determines, according to the first action identifier, that a connection handover process needs to be performed, so as to determine to execute 404. Certainly, it may also be directly determined, according to the first action identifier, that 404 needs to be executed.</p><p id="p0082" num="0082">Optionally, the handover medium configures the first action identifier and the third identifier for an NFCC of the handover medium by using a DH, so as to send the first device activation request by using the NFCC of the handover medium.</p><p id="p0083" num="0083">404: Determine, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, and if yes, send a first device activation response to the handover medium (so as to perform a connection handover process with<!-- EPO <DP n="27"> --> the first terminal and feed back connection configuration information of the zeroth terminal to the first terminal in the connection handover process. The connection handover process in this case includes processes such as radio frequency interface activation, LLCP activation, and data exchange, and feedback of the connection configuration information is performed in the data exchange process), and reserve a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal. (If there is no idle connection resource, for the processing manner, refer to the description in the embodiment shown in <figref idrefs="f0001">FIG. 1</figref>)</p><p id="p0084" num="0084">406: After step 404, and before a connection is established between the zeroth terminal and the second terminal, receive a second device activation request sent by a third terminal, where the second device activation request carries a second action identifier and a fourth identifier that is used for identifying the third terminal.</p><p id="p0085" num="0085">Optionally, the identity of the third terminal includes: a handover medium or a connection handover requester.</p><p id="p0086" num="0086">Optionally, the third terminal configures the second action identifier and the fourth identifier for an NFCC of the third terminal by using a DH, so as to send the second device activation request by using the NFCC of the third terminal.</p><p id="p0087" num="0087">408: If it is determined, according to the second action identifier, that a connection handover process needs to be performed, determine to execute step 410.</p><p id="p0088" num="0088">410: Determine, according to the fourth identifier and the third identifier, whether the third terminal and the handover medium are the same terminal, so as to determine whether to send a second device activation response to the third terminal.</p><p id="p0089" num="0089">Optionally, step 410 includes two scenarios:
<ul><li>Scenario 1: The third terminal and the handover medium are the same terminal; in this case, send the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process.
<br/>
Optionally, the second device activation response is sent by using an NFCC of the zeroth terminal.
</li><li>Scenario 2: The third terminal and the handover medium are not the same terminal; in this case, perform determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, to determine whether the zeroth terminal has an idle connection resource, and if yes, send the second device activation response, otherwise, skip sending the second device activation response.</li></ul></p><p id="p0090" num="0090">Further optionally, in scenario 2, if an idle connection resource exists, the zeroth<!-- EPO <DP n="28"> --> terminal reserves a connection resource for the third terminal, or, when the third terminal is a handover medium, the zeroth terminal reserves a connection resource for a fourth terminal that establishes a connection with the zeroth terminal by using the third terminal, so as to avoid a possible problem that a resource is undesirably occupied.</p><p id="p0091" num="0091">In addition to the technical effect in the embodiment shown in <figref idrefs="f0001">FIG. 2A</figref>, the method provided in this embodiment can further directly determine, when a zeroth terminal has no idle connection resource, not to respond to a device activation request sent by a handover medium or a third terminal, so that subsequent processes such as LLCP activation and data exchange are not executed, that is, an NFC communication procedure is terminated in advance, and therefore, connection configuration information is fed back, and a process, for example, in which a Bluetooth module and/or a Wi-Fi module of the zeroth terminal attempts to establish a connection is avoided, thereby greatly saving communication time, and improving communication efficiency.</p><p id="p0092" num="0092"><figref idrefs="f0006">FIG. 5A1</figref>, <figref idrefs="f0007">FIG. 5A2</figref>, <figref idrefs="f0008">FIG. 5B1</figref>, and <figref idrefs="f0009">FIG. 5B2</figref> are a schematic flowchart of a connection handover method based on near field communication according to an embodiment of the present invention. The entire procedure includes processes of a first tap (Tap1) and a second tap (Tap2).</p><p id="p0093" num="0093">Referring to <figref idrefs="f0006">FIG. 5A1</figref> and <figref idrefs="f0007">FIG. 5A2</figref>, <figref idrefs="f0006">FIG. 5A1</figref> and <figref idrefs="f0007">FIG. 5A2</figref> are the process of the first tap, in which a zeroth terminal and a handover medium (which is configured to assist the zeroth terminal and a second terminal in establishing a connection) perform communication by using a P2P working mode, including (assuming that the zeroth terminal and a third terminal both support a Bluetooth module and a Wi-Fi module):
<ul><li>Step 0: A DH of the zeroth terminal acquires the values of current idle connection resource information x and y, where x represents the number of currently idle Bluetooth connection resources, and y represents the number of currently idle Wi-Fi connection resources.</li><li>Step 1: Parameter configuration process</li></ul></p><p id="p0094" num="0094">The DH of the zeroth terminal configures current idle Bluetooth connection resource information HO_BT_CONN_INFO and/or Wi-Fi connection resource information HO_WIFI_CONN_INFO for an NFCC of the zeroth terminal by using a CORE_SET_CONFIG_CMD command (operations of updating HO_BT_CONN_INFO and HO_WIFI_CONN_INFO may be executed at the NFCC). A DH of the handover medium configures terminal identifier ID_INFO information and action flag information ACT_FLAG for the NFCC of the handover medium by using a CORE_SET_CONFIG_CMD command.</p><p id="p0095" num="0095">For the zeroth terminal and the handover medium, after receiving configuration commands and performing configuration successfully, the NFCCs of the zeroth terminal and the handover medium feed back CORE_SET_CONFIG_RSP responses to the DHs, to indicate that the<!-- EPO <DP n="29"> --> configuration succeeds.</p><p id="p0096" num="0096">Optionally, step 0 and step 1 are performed after step 4a and before step 5.</p><p id="p0097" num="0097">Step 2: Radio frequency discovery process</p><p id="p0098" num="0098">The DH of the handover medium triggers, by using an RF_DISCOVER_CMD command, the NFCC to start a radio frequency discovery process. The NFCC feeds back a response RF_DISCOVER_RSP to the DH, to indicate that the radio frequency discovery process is being performed.</p><p id="p0099" num="0099">Step 3: The NFCC of the handover medium sends, to the zeroth terminal, a device activation request-ATR_REQ request, where the ATR_REQ request includes the ID_INFO information and ACT_FLAG information.</p><p id="p0100" num="0100">Step 4: After receiving the ATR_REQ request, the NFCC of the zeroth terminal determines, according to ACT_FLAG in the ATR_REQ request, whether the intention of the other party is a connection handover.</p><p id="p0101" num="0101">4a. If yes, execute step 5 and continue with the procedure.</p><p id="p0102" num="0102">4b. If not, execute step 6, then go to step 8, and continue till the procedure of Tap1 ends.</p><p id="p0103" num="0103">For example, when the intention of the other party is to exchange a business card with the zeroth terminal, the zeroth terminal directly responds to the other party with ATR_RES and performs subsequent data exchange without needing to perform the following operation of subtraction by 1 in step 7.</p><p id="p0104" num="0104">Step 5: The NFCC of the zeroth terminal determines, according to a current idle connection resource of the zeroth terminal, whether there is no idle connection resource (that is, judges whether x≤0 and y≤0).</p><p id="p0105" num="0105">Optionally, the zeroth terminal may determine, according to the specification in the existing protocol, whether the zeroth terminal needs to feed back Bluetooth or Wi-Fi connection configuration information, so as to perform determining according to corresponding x or y.</p><p id="p0106" num="0106">5a. If yes, skip responding to the other party and end the entire procedure.</p><p id="p0107" num="0107">5b. If not, execute step 6 and continue.</p><p id="p0108" num="0108">Step 6:</p><p id="p0109" num="0109">The NFCC of the zeroth terminal feeds back a device activation response-ATR_RES response to the handover medium.</p><p id="p0110" num="0110">For the zeroth terminal, the NFCC notifies, by using RF_INTF_ACTIVATED_NTF, the DH that radio frequency interface activation is accomplished, where RF_INTF_ACTIVATED_NTF includes received ATR_REQ (including ID_INFO and ACT_FLAG).</p><p id="p0111" num="0111">For the handover medium, the NFCC notifies, by using RF_INTF_ACTIVATED_NTF,<!-- EPO <DP n="30"> --> the DH that radio frequency interface activation is accomplished, where RF_INTF_ACTIVATED_NT includes received ATR_RES.</p><p id="p0112" num="0112">Step 7: Correspondingly perform an operation of subtracting 1 from x or y.</p><p id="p0113" num="0113">Step 8: LLCP activation process.</p><p id="p0114" num="0114">Step 9: Data exchange process.</p><p id="p0115" num="0115">Step 10: LLCP deactivation process.</p><p id="p0116" num="0116">Step 11: Radio frequency interface deactivation process.</p><p id="p0117" num="0117">Subsequently, the zeroth terminal may prepare to establish a Bluetooth or Wi-Fi connection with the second terminal. Before a connection is established between the zeroth terminal and the second terminal, if the zeroth terminal receives a connection handover request sent by the third terminal, the processing process is shown in <figref idrefs="f0008">FIG. 5B1</figref> and <figref idrefs="f0009">FIG. 5B2</figref>, and includes:</p><p id="p0118" num="0118">Step 12: Parameter configuration process</p><p id="p0119" num="0119">A DH of the third terminal configures, by using CORE_SET_CONFIG_CMD, terminal identifier information ID_INFO and action flag information ACT_FLAG of the third terminal for an NFCC of the third terminal.</p><p id="p0120" num="0120">For the third terminal, after receiving the configuration command and performing configuration successfully, the NFCC of the third terminal feeds back a CORE_SET_CONFIG_RSP response to the DH, to indicate that configuration succeeds.</p><p id="p0121" num="0121">Step 13: Radio frequency discovery process</p><p id="p0122" num="0122">The DH of the third terminal triggers, by using an RF_DISCOVER_CMD command, the NFCC to start a radio frequency discovery process. The NFCC feeds back a response RF_DISCOVER_RSP to the DH, to indicate that the radio frequency discovery process is being performed.</p><p id="p0123" num="0123">Step 14: The third terminal performs determination and sends, by using the NFCC to the zeroth terminal, an ATR_REQ request, where the ATR_REQ request includes the ID_INFO information and the ACT_FLAG information.</p><p id="p0124" num="0124">Step 15: After receiving the request by using the NFCC, the zeroth terminal determines, according to ACT_FLAG, whether the intention of the other party is a connection handover.</p><p id="p0125" num="0125">15a. If yes, execute step 16 and continue.</p><p id="p0126" num="0126">15b. If not, execute step 17, then go to step 19, and continue.</p><p id="p0127" num="0127">Step 16: The zeroth terminal judges whether the third terminal and the handover medium are the same terminal, that is, whether ID_INFO in step 1 and ID_INFO in step 12 are same.</p><p id="p0128" num="0128">16a. If yes, execute step 17, then go to step 19, and continue.</p><p id="p0129" num="0129">16b. If not, continue to determine whether the zeroth terminal currently (after a<!-- EPO <DP n="31"> --> connection resource is reserved for the second terminal) has no idle connection resource. When the third terminal serves as a handover medium, the zeroth terminal judges whether x≤0 and y≤0; and when the third terminal serves as a connection handover requester, the zeroth terminal may perform determining according to idle connection resource information of a carrier that is supported by both the zeroth terminal and the third terminal.</p><p id="p0130" num="0130">16b.i. If yes, skip responding to the other party and end the procedure of Tap2.</p><p id="p0131" num="0131">16b.ii. If not, execute step 17 and continue.</p><p id="p0132" num="0132">Step 17:</p><p id="p0133" num="0133">The zeroth terminal feeds back a device activation response-ATR_RES response to the third terminal by using the NFCC.</p><p id="p0134" num="0134">For the zeroth terminal, the NFCC notifies, by using RF_INTF_ACTIVATED_NTF, the DH that radio frequency interface activation is accomplished, where RF_INTF_ACTIVATED_NTF includes received ATR_REQ (including ID_INFO and ACT_FLAG).</p><p id="p0135" num="0135">For the third terminal, the NFCC notifies, by using RF_INTF_ACTIVATED_NTF, the DH that radio frequency interface activation is accomplished, where RF_INTF_ACTIVATED_NTF includes received ATR_RES.</p><p id="p0136" num="0136">Step 18 to step 22 are the same as step 7 to step 11 in <figref idrefs="f0006">FIG. 5A1</figref> and <figref idrefs="f0007">FIG. 5A2</figref>.</p><p id="p0137" num="0137">In addition to the technical effect in the embodiment shown in <figref idrefs="f0003">FIG. 3A</figref> and <figref idrefs="f0004">FIG. 3B</figref>, the method provided in this embodiment can further terminate an NFC communication procedure in advance (the principle is the same as that in the embodiment shown in <figref idrefs="f0005">FIG. 4</figref>) by controlling the value of x and/or y when a zeroth terminal has no idle connection resource, thereby preventing a process in which a Bluetooth module and/or a Wi-Fi module attempts to establish a wireless connection, greatly saving communication time, and improving communication efficiency.</p><p id="p0138" num="0138">In <figref idrefs="f0001 f0009">FIG. 2A to FIG. 5B2</figref>, a case in which a first terminal serves as the terminal medium is described, and a person skilled in the art should understand that In a case in which the first terminal serves as a connection handover requester, the processing idea provided in the foregoing embodiments is also applicable and corresponding technical effects can be achieved, and the case is not described herein again.</p><p id="p0139" num="0139">Some parameters and messages in the embodiments shown in <figref idrefs="f0001">FIG. 1</figref>, <figref idrefs="f0005">FIG. 4</figref>, <figref idrefs="f0006">FIG. 5A1</figref>, <figref idrefs="f0007">FIG. 5A2</figref>, <figref idrefs="f0008">FIG. 5B1</figref>, and <figref idrefs="f0009">FIG. 5B2</figref> are exemplarily described below.</p><p id="p0140" num="0140">The parameters added in the embodiments shown in <figref idrefs="f0001">FIG. 1</figref>, <figref idrefs="f0005">FIG. 4</figref>, <figref idrefs="f0006">FIG. 5A1</figref>, <figref idrefs="f0007">FIG. 5A2</figref>, <figref idrefs="f0008">FIG. 5B1</figref>, and <figref idrefs="f0009">FIG. 5B2</figref> include: current idle connection resource information HO_BT_CONN_INFO (Bluetooth connection resource information) and/or HO_WIFI_CONN_INFO (Wi-Fi connection resource information), terminal identifier (for example,<!-- EPO <DP n="32"> --> first identifier, second identifier) information ID_INFO, and action identifier (for example, first action identifier) information ACT_FLAG. HO_BT_CONN_INFO and/or HO_WIFI_CONN_INFO only needs to be transmitted between a DH and an NFCC of a zeroth terminal, whereas ID_INFO and ACT_FLAG need to be configured by the DH for the NFCC and then transferred to a peer terminal by using a device activation request ATR_REQ. Examples of extension manners of the parameters are as follows:
<br/>
1: An extension manner of HO_BT_CONN_INFO and HO_WIFI_CONN_INFO:
<br/>
Select 0x83 from reserved fields 0x83-0x9F in Other Parameters (other parameters) in the command CORE_SET_CONFIG_CMD used to set the configuration parameters, to extend HO_BT_CONN_INFO, and select 0x84 to extend HO_WIFI_CONN_INFO. The specific extension manner of the two parameters and the meanings of the values are shown in Table 4 to Table 7:
<tables id="tabl0006" num="0006"><table frame="all"><title><b>(Table 4: Configuration parameter tag)</b></title><tgroup cols="2"><colspec colnum="1" colname="col1" colwidth="43mm"/><colspec colnum="2" colname="col2" colwidth="20mm"/><thead><row><entry align="center" valign="middle"><b>Parameter name</b></entry><entry align="center" valign="middle"><b>Tag</b></entry></row><row><entry namest="col1" nameend="col2" align="center" valign="middle"><b>Other Parameters (other parameters)</b></entry></row></thead><tbody><row><entry align="center" valign="middle">HO_BT_CONN_INFO</entry><entry align="center" valign="middle">0x83</entry></row><row><entry align="center" valign="middle">HO_WIFI_CONN_INFO</entry><entry align="center" valign="middle">0x84</entry></row></tbody></tgroup></table></tables>
<tables id="tabl0007" num="0007"><table frame="all"><title><b>(Table 5: Discovery configuration parameter)</b></title><tgroup cols="4"><colspec colnum="1" colname="col1" colwidth="39mm"/><colspec colnum="2" colname="col2" colwidth="16mm"/><colspec colnum="3" colname="col3" colwidth="31mm"/><colspec colnum="4" colname="col4" colwidth="80mm"/><thead><row><entry align="center" valign="middle"><b>ID</b></entry><entry align="center" valign="middle"><b>Length</b></entry><entry align="center" valign="middle"><b>Value</b></entry><entry align="center" valign="middle"><b>Description</b></entry></row></thead><tbody><row><entry align="center" valign="middle">HO_BT_CONN_INFO</entry><entry align="center" valign="middle">1 octet</entry><entry align="center" valign="middle">Refer to Table 6 for details</entry><entry align="center" valign="middle">For describing the maximum value of the number of currently idle Bluetooth connection resources</entry></row><row><entry align="center" valign="middle">HO_WIFI_CONN_INFO</entry><entry align="center" valign="middle">1 octet</entry><entry align="center" valign="middle">Refer to Table 7 for details</entry><entry align="center" valign="middle">For describing the maximum value of the number of currently idle Wi-Fi connection resources</entry></row></tbody></tgroup></table></tables>
<tables id="tabl0008" num="0008"><table frame="all"><title><b>(Table 6: Values of HO_BT_CONN_INFO and meanings)</b></title><tgroup cols="9"><colspec colnum="1" colname="col1" colwidth="10mm"/><colspec colnum="2" colname="col2" colwidth="10mm"/><colspec colnum="3" colname="col3" colwidth="10mm"/><colspec colnum="4" colname="col4" colwidth="10mm"/><colspec colnum="5" colname="col5" colwidth="10mm"/><colspec colnum="6" colname="col6" colwidth="10mm"/><colspec colnum="7" colname="col7" colwidth="10mm"/><colspec colnum="8" colname="col8" colwidth="10mm"/><colspec colnum="9" colname="col9" colwidth="92mm"/><thead><row><entry namest="col1" nameend="col8" align="center" valign="middle"><b>HO_BT_CONN_INFO</b></entry><entry align="center" valign="middle"><b>Description</b></entry></row><row><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry><entry align="center" valign="middle"/></row></thead><tbody><row><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">RFU</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">The value represents the maximum value of the number of currently idle Bluetooth connection resources</entry></row></tbody></tgroup></table></tables><!-- EPO <DP n="33"> -->
<tables id="tabl0009" num="0009"><table frame="all"><title><b>(Table 7: Values HO_WIFI_CONN_INFO and meanings)</b></title><tgroup cols="9"><colspec colnum="1" colname="col1" colwidth="10mm"/><colspec colnum="2" colname="col2" colwidth="10mm"/><colspec colnum="3" colname="col3" colwidth="10mm"/><colspec colnum="4" colname="col4" colwidth="10mm"/><colspec colnum="5" colname="col5" colwidth="10mm"/><colspec colnum="6" colname="col6" colwidth="10mm"/><colspec colnum="7" colname="col7" colwidth="10mm"/><colspec colnum="8" colname="col8" colwidth="10mm"/><colspec colnum="9" colname="col9" colwidth="90mm"/><thead><row><entry namest="col1" nameend="col8" align="center" valign="middle"><b>HO_WIFI_CONN_INFO</b></entry><entry align="center" valign="middle"><b>Description</b></entry></row><row><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry><entry align="center" valign="middle"/></row></thead><tbody><row><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">RFU</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">The value represents the maximum value of the number of currently idle Wi-Fi connection resources</entry></row></tbody></tgroup></table></tables><br/>
2: Several extension manners of ID_INFO and ACT_FLAG are as follows:
<br/>
a) Reserved bits b7 and b6 of an NFC-DEP discovery parameter PN_ATR_REQ_CONFIG in a poll (Poll) mode are used to control the reserved bits b8 and b7 of PP<sub>I</sub> in ATR_REQ, so as to extend ID_INFO and ACT_FLAG. The extension manners of the two parameters are shown in Table 8 to Table 10.
<tables id="tabl0010" num="0010"><table frame="all"><title><b>(Table 8: Values of PN_ATR_REQ_CONFIG)</b></title><tgroup cols="10"><colspec colnum="1" colname="col1" colwidth="15mm"/><colspec colnum="2" colname="col2" colwidth="9mm"/><colspec colnum="3" colname="col3" colwidth="9mm"/><colspec colnum="4" colname="col4" colwidth="9mm"/><colspec colnum="5" colname="col5" colwidth="9mm"/><colspec colnum="6" colname="col6" colwidth="9mm"/><colspec colnum="7" colname="col7" colwidth="9mm"/><colspec colnum="8" colname="col8" colwidth="9mm"/><colspec colnum="9" colname="col9" colwidth="9mm"/><colspec colnum="10" colname="col10" colwidth="79mm"/><thead><row><entry valign="middle"/><entry namest="col2" nameend="col9" align="center" valign="middle"><b>Bit mask (bit mask</b>)</entry><entry morerows="1" align="center" valign="middle"><b>Description</b></entry></row><row><entry rowsep="0" align="center" valign="middle"/><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry></row></thead><tbody><row><entry morerows="3" align="center" valign="middle">Octet 0</entry><entry align="center" valign="middle">1</entry><entry align="center" valign="middle">1</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">If the value is set to 11b, it indicates that ID_INFO and ACT_FLAG may be used, otherwise, ID_INFO and ACT_FLAG are not used</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">0</entry><entry align="center" valign="middle"/><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">RFU</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">If the value is set to 1b, DID may be used, otherwise, DID is not used. Note: For the LLCP, the value needs to be set to 0b</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">The value corresponds to LR<sub>I</sub> defined in [DIGITAL]. Note: For the LLCP, the value needs to be set to 11b</entry></row></tbody></tgroup></table></tables>
<tables id="tabl0011" num="0011"><table frame="all"><title><b>(Table 9: PP<sub>I</sub> format)</b></title><tgroup cols="9"><colspec colnum="1" colname="col1" colwidth="9mm"/><colspec colnum="2" colname="col2" colwidth="9mm"/><colspec colnum="3" colname="col3" colwidth="9mm"/><colspec colnum="4" colname="col4" colwidth="9mm"/><colspec colnum="5" colname="col5" colwidth="9mm"/><colspec colnum="6" colname="col6" colwidth="9mm"/><colspec colnum="7" colname="col7" colwidth="9mm"/><colspec colnum="8" colname="col8" colwidth="9mm"/><colspec colnum="9" colname="col9" colwidth="94mm"/><thead><row><entry valign="middle"><b>b8</b></entry><entry valign="middle"><b>b7</b></entry><entry valign="middle"><b>b6</b></entry><entry valign="middle"><b>b5</b></entry><entry valign="middle"><b>b4</b></entry><entry valign="middle"><b>b3</b></entry><entry valign="middle"><b>b2</b></entry><entry valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>Meaning</b></entry></row></thead><tbody><row><entry align="center" valign="middle">1</entry><entry align="center" valign="middle">1</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">If the value is set to 11b, it indicates that a 2-byte INFO_MANAGE field exists in ATR_REQ, otherwise, the field does not exist. The brackets in [INFO_MANAGE] in Table 10 indicates that the field is optional</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">LR<sub>I</sub></entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">RFU</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle"/><entry align="center" valign="middle">If the value is set to 1, it indicates that a general byte (G<sub>I</sub>) may be obtained</entry></row><!-- EPO <DP n="34"> --><row><entry align="center"/><entry align="center"/><entry align="center"/><entry align="center"/><entry align="center"/><entry align="center"/><entry align="center"/><entry align="center">x</entry><entry align="center">If the value is set to 1, it indicates that NAD is used</entry></row></tbody></tgroup></table></tables>
<tables id="tabl0012" num="0012"><table frame="all"><title><b>(Table 10: Format of ATR_REQ)</b></title><tgroup cols="10"><colspec colnum="1" colname="col1" colwidth="13mm"/><colspec colnum="2" colname="col2" colwidth="13mm"/><colspec colnum="3" colname="col3" colwidth="19mm"/><colspec colnum="4" colname="col4" colwidth="11mm"/><colspec colnum="5" colname="col5" colwidth="10mm"/><colspec colnum="6" colname="col6" colwidth="15mm"/><colspec colnum="7" colname="col7" colwidth="15mm"/><colspec colnum="8" colname="col8" colwidth="19mm"/><colspec colnum="9" colname="col9" colwidth="23mm"/><colspec colnum="10" colname="col10" colwidth="32mm"/><thead><row><entry morerows="1" align="center" valign="middle"><b>Byte 1</b></entry><entry morerows="1" align="center" valign="middle"><b>Byte 2</b></entry><entry morerows="1" align="center" valign="middle"><b>Byte 3-12</b></entry><entry namest="col4" nameend="col5" morerows="1" align="center" valign="middle"><b>Byte 13 14</b></entry><entry morerows="1" align="center" valign="middle"><b>Byte 15</b></entry><entry morerows="1" align="center" valign="middle"><b>Byte 16</b></entry><entry namest="col8" nameend="col9" align="center" valign="middle"><b>[INFO_MANAGE]</b></entry><entry morerows="1" align="center" valign="middle"><b>Byte (byte)19-19+n</b></entry></row><row><entry align="center" valign="middle"><b>Byte17</b></entry><entry align="center" valign="middle"><b>Byte18</b></entry></row></thead><tbody><row><entry align="center" valign="middle">D4h</entry><entry align="center" valign="middle">00h</entry><entry align="center" valign="middle">NFCID3<sub>I</sub></entry><entry align="center" valign="middle">DID<sub>I</sub></entry><entry align="center" valign="middle">BS<sub>I</sub></entry><entry align="center" valign="middle">BR<sub>I</sub></entry><entry align="center" valign="middle">PP<sub>I</sub></entry><entry align="center" valign="middle">[ID_INFO]</entry><entry align="center" valign="middle">[ACT_FLAG]</entry><entry align="center" valign="middle">[G<sub>I</sub>0...G<sub>I</sub>n]</entry></row></tbody></tgroup></table></tables><br/>
b) One NFC-DEP discovery parameter PC_ATR_REQ_HO_MANAGE is added to CORE_SET_CONFIG_CMD in a Poll mode, so as to extend ID_INFO and ACT_FLAG in ATR_REQ. The specific extension manners of the two parameters are shown in Table 11 to Table 14.
<tables id="tabl0013" num="0013"><table frame="all"><title><b>(Table 11: Configuration parameter tag)</b></title><tgroup cols="9"><colspec colnum="1" colname="col1" colwidth="9mm"/><colspec colnum="2" colname="col2" colwidth="9mm"/><colspec colnum="3" colname="col3" colwidth="9mm"/><colspec colnum="4" colname="col4" colwidth="9mm"/><colspec colnum="5" colname="col5" colwidth="9mm"/><colspec colnum="6" colname="col6" colwidth="9mm"/><colspec colnum="7" colname="col7" colwidth="9mm"/><colspec colnum="8" colname="col8" colwidth="9mm"/><colspec colnum="9" colname="col9" colwidth="94mm"/><thead><row><entry namest="col1" nameend="col8" align="center" valign="middle"><b>ID_INFO</b></entry><entry morerows="1" align="center" valign="middle"><b>Description</b></entry></row><row><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry></row></thead><tbody><row><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">Random numbers that can be maintained at least 2 minutes, used for representing terminal identifier information</entry></row></tbody></tgroup></table></tables></p><p id="p0141" num="0141">The specific definition of PN_ATR_REQ_HO_MANAGE is as follows:
<tables id="tabl0014" num="0014"><table frame="all"><title><b>(Table 12: Discovery configuration parameter of NFC data exchange protocol in Poll mode)</b></title><tgroup cols="4"><colspec colnum="1" colname="col1" colwidth="47mm"/><colspec colnum="2" colname="col2" colwidth="16mm"/><colspec colnum="3" colname="col3" colwidth="27mm"/><colspec colnum="4" colname="col4" colwidth="76mm"/><thead><row><entry align="center" valign="middle"><b>ID</b></entry><entry align="center" valign="middle"><b>Length</b></entry><entry align="center" valign="middle"><b>Value</b></entry><entry align="center" valign="middle"><b>Description</b></entry></row></thead><tbody><row><entry align="center" valign="middle">PN_ATR_REQ_HOMANAGE</entry><entry align="center" valign="middle">1 octet</entry><entry align="center" valign="middle">Refer to Table 13 for details</entry><entry align="center" valign="middle">Configuration about a connection handover, used for a relevant parameter in ATR_REQ.</entry></row></tbody></tgroup></table></tables>
<tables id="tabl0015" num="0015"><table frame="all"><title><b>(Table 13: Values of PN_ATR_REQ_HO_MANAGE)</b></title><tgroup cols="10"><colspec colnum="1" colname="col1" colwidth="13mm"/><colspec colnum="2" colname="col2" colwidth="10mm"/><colspec colnum="3" colname="col3" colwidth="10mm"/><colspec colnum="4" colname="col4" colwidth="10mm"/><colspec colnum="5" colname="col5" colwidth="10mm"/><colspec colnum="6" colname="col6" colwidth="10mm"/><colspec colnum="7" colname="col7" colwidth="10mm"/><colspec colnum="8" colname="col8" colwidth="10mm"/><colspec colnum="9" colname="col9" colwidth="10mm"/><colspec colnum="10" colname="col10" colwidth="75mm"/><thead><row><entry align="center" valign="middle"/><entry namest="col2" nameend="col9" align="center" valign="middle"><b>Bit mask</b></entry><entry morerows="1" align="center" valign="middle"><b>Description</b></entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry></row></thead><tbody><row><entry morerows="1" align="center" valign="middle">Octet 0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">RFU</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle"/><entry align="center" valign="middle">If the value is set to 1b, terminal identifier information ID_INFO is used, otherwise, terminal identifier information ID INFO is not used. Note: The value needs to be set to 1 when the terminal needs to perform a connection handover</entry></row><!-- EPO <DP n="35"> --><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">If the value is set to 1b, action identifier information ACT_FLAG is used, otherwise, action identifier information ACT_FLAG is not used. Note: The value needs to be set to 1 when the terminal needs to perform a connection handover</entry></row></tbody></tgroup></table></tables></p><p id="p0142" num="0142">The positions of ID_INFO and ACT_FLAG in ATR_REQ are as follows:
<tables id="tabl0016" num="0016"><table frame="all"><title><b>(Table 14: Format of ATR_REQ)</b></title><tgroup cols="10"><colspec colnum="1" colname="col1" colwidth="14mm"/><colspec colnum="2" colname="col2" colwidth="14mm"/><colspec colnum="3" colname="col3" colwidth="19mm"/><colspec colnum="4" colname="col4" colwidth="15mm"/><colspec colnum="5" colname="col5" colwidth="15mm"/><colspec colnum="6" colname="col6" colwidth="15mm"/><colspec colnum="7" colname="col7" colwidth="15mm"/><colspec colnum="8" colname="col8" colwidth="17mm"/><colspec colnum="9" colname="col9" colwidth="21mm"/><colspec colnum="10" colname="col10" colwidth="24mm"/><thead><row><entry align="center" valign="middle"><b>Byte 1</b></entry><entry align="center" valign="middle"><b>Byte 2</b></entry><entry align="center" valign="middle"><b>Byte 3-12</b></entry><entry align="center" valign="middle"><b>Byte 13</b></entry><entry align="center" valign="middle"><b>Byte 14</b></entry><entry align="center" valign="middle"><b>Byte 15</b></entry><entry align="center" valign="middle"><b>Byte 16</b></entry><entry align="center" valign="middle"><b>Byte17</b></entry><entry align="center" valign="middle"><b>Byte18</b></entry><entry align="center" valign="middle"><b>Byte 19-19+n</b></entry></row></thead><tbody><row><entry align="center" valign="middle">D4h</entry><entry align="center" valign="middle">00h</entry><entry align="center" valign="middle">NFCID3<sub>I</sub></entry><entry align="center" valign="middle">DID<sub>I</sub></entry><entry align="center" valign="middle">BS<sub>I</sub></entry><entry align="center" valign="middle">BR<sub>I</sub></entry><entry align="center" valign="middle">PP<sub>I</sub></entry><entry align="center" valign="middle">ID_INFO</entry><entry align="center" valign="middle">ACT_FLAG</entry><entry align="center" valign="middle">[G<sub>I</sub>0...G<sub>I</sub>n]</entry></row></tbody></tgroup></table></tables></p><p id="p0143" num="0143">For the foregoing two extension manners a) and b), a same method may be used to define the values of ID_INFO and ACT_FLAG, which are specifically shown in Tables 15 and 16:
<tables id="tabl0017" num="0017"><table frame="all"><title><b>(Table 15: Values of ID_INFO and meanings)</b></title><tgroup cols="9"><colspec colnum="1" colname="col1" colwidth="9mm"/><colspec colnum="2" colname="col2" colwidth="9mm"/><colspec colnum="3" colname="col3" colwidth="9mm"/><colspec colnum="4" colname="col4" colwidth="9mm"/><colspec colnum="5" colname="col5" colwidth="9mm"/><colspec colnum="6" colname="col6" colwidth="9mm"/><colspec colnum="7" colname="col7" colwidth="9mm"/><colspec colnum="8" colname="col8" colwidth="9mm"/><colspec colnum="9" colname="col9" colwidth="94mm"/><thead><row><entry namest="col1" nameend="col8" align="center" valign="middle"><b>ID_INFO</b></entry><entry morerows="1" align="center" valign="middle"><b>Description</b></entry></row><row><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry></row></thead><tbody><row><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">Random numbers that can be maintained at least 2 minutes, used for representing terminal identifier information</entry></row></tbody></tgroup></table></tables>
<tables id="tabl0018" num="0018"><table frame="all"><title><b>(Table 16: Values of ACT_FLAG and meanings)</b></title><tgroup cols="9"><colspec colnum="1" colname="col1" colwidth="9mm"/><colspec colnum="2" colname="col2" colwidth="9mm"/><colspec colnum="3" colname="col3" colwidth="9mm"/><colspec colnum="4" colname="col4" colwidth="9mm"/><colspec colnum="5" colname="col5" colwidth="9mm"/><colspec colnum="6" colname="col6" colwidth="9mm"/><colspec colnum="7" colname="col7" colwidth="9mm"/><colspec colnum="8" colname="col8" colwidth="9mm"/><colspec colnum="9" colname="col9" colwidth="94mm"/><thead><row><entry namest="col1" nameend="col8" align="center" valign="middle"><b>ACT_FLAG</b></entry><entry morerows="1" align="center" valign="middle"><b>Description</b></entry></row><row><entry align="center" valign="middle"><b>b7</b></entry><entry align="center" valign="middle"><b>b6</b></entry><entry align="center" valign="middle"><b>b5</b></entry><entry align="center" valign="middle"><b>b4</b></entry><entry align="center" valign="middle"><b>b3</b></entry><entry align="center" valign="middle"><b>b2</b></entry><entry align="center" valign="middle"><b>b1</b></entry><entry align="center" valign="middle"><b>b0</b></entry></row></thead><tbody><row><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle">0</entry><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">RFU</entry></row><row><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle"/><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">x</entry><entry align="center" valign="middle">If the value is set to 11b, it represents an action intention of a connection handover, and all other values represent RFU</entry></row></tbody></tgroup></table></tables></p><p id="p0144" num="0144">When each table in the specification is described, mainly the differences or improvements in the present invention from the prior art are described, and reference may be made<!-- EPO <DP n="36"> --> to the prior art for the rest content, which is not limited in the present invention.</p><p id="p0145" num="0145"><figref idrefs="f0010">FIG. 6</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention. Referring to <figref idrefs="f0010">FIG. 6</figref>, a connection handover apparatus 60 includes (a dotted box indicates that a unit/module is optional; the same below):
<ul><li>an acquiring unit 61, configured to acquire idle connection resource information of a zeroth terminal,</li><li>where, for example, the acquiring unit 61 acquires the idle connection resource information of the zeroth terminal from a Bluetooth module and/or a Wi-Fi module; optionally, the idle connection resource information of the zeroth terminal includes: the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources;</li><li>a first receiving unit 62, configured to receive a request message sent by a first terminal, where the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed; optionally, the first terminal is a connection handover requester or a handover medium;</li><li>a first determining unit 63, configured to determine, according to the request message, that a first judging unit 64 needs to be triggered;</li><li>the first judging unit 64, configured to determine, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, and if yes, trigger a first sending unit 65; and</li><li>the first sending unit 65, configured to send a response message to the first terminal, so as to feed back connection configuration information of the zeroth terminal to the first terminal.</li></ul></p><p id="p0146" num="0146">Optionally, when the first terminal serves as a handover medium, the first receiving unit 62 receives a first connection handover request used for initiating a connection handover process. In this case, the first determining unit 63 determines that the first judging unit 64 needs to be triggered. The first sending unit 65 may send a first connection handover medium message including the connection configuration information of the zeroth terminal, where the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</p><p id="p0147" num="0147">Optionally, when the first terminal serves as a handover medium, the first receiving unit 62 receives a first device activation request used for initiating a device activation request, where the first device activation request carries a first action identifier. In this case, the first determining unit 63 determines, according to the first action identifier, that a connection handover process needs to be performed, so as to trigger the first judging unit 64. The first sending unit 65 may send a first device activation response, so as to perform a connection handover process with the first terminal<!-- EPO <DP n="37"> --> and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process.</p><p id="p0148" num="0148">Optionally, when the first terminal serves as a connection handover requester, the first receiving unit 62 receives a third connection handover request used for initiating a connection handover process. The first sending unit 65 sends a third connection handover selection message including the connection configuration information of the zeroth terminal (when the first judging unit 64 judges that the zeroth terminal has an idle connection resource), or sends a connection handover selection message representing that a connection resource of the zeroth terminal is limited (when the first judging unit 64 judges that the zeroth terminal has no idle connection resource).</p><p id="p0149" num="0149">Optionally, when the first terminal serves as a connection handover requester, the acquiring unit 61 includes: a second configuring module, configured to configure the idle connection resource information of the zeroth terminal for an NFCC of the zeroth terminal by using a DH of the zeroth terminal, so that the first judging unit 64 judges whether the zeroth terminal has an idle connection resource. The first receiving unit 62 receives a third device activation request carrying a third action identifier, so that the first determining unit 63 determines, according to the third action identifier, that a connection handover process needs to be performed. The first sending unit 65 sends a third device activation response (when the first judging unit 64 judges that the zeroth terminal has an idle connection resource), so as to perform a connection handover process with the first terminal and feed back connection configuration information of the zeroth terminal to the first terminal in the connection handover process, or, the first sending unit 65 does not send the third device activation response (when the first judging unit 64 judges that the zeroth terminal has no idle connection resource).</p><p id="p0150" num="0150">Optionally, in an implementation manner of this embodiment, the connection handover apparatus 60 further includes: a selective sending unit 67. If the first judging unit 64 determines, according to the idle connection resource information of the zeroth terminal, that the zeroth terminal has no idle connection resource, the connection handover apparatus 60 does not feed back the connection configuration information of the zeroth terminal to the first terminal. In this case, the selective sending unit 67 may be triggered, so that the selective sending unit 67 determines, according to the request message, whether to send a response message corresponding to the request message. For example, when the request message is a connection handover request and the first terminal serves as a handover medium, the selective sending unit 67 sends a connection handover medium message not including the connection configuration information of the zeroth terminal; when the request message is a connection handover request and the first terminal serves as a connection handover requester, the selective sending unit 67 sends a connection handover selection<!-- EPO <DP n="38"> --> message representing that a connection resource of the zeroth terminal is limited; when the request message is a device activation request, the selective sending unit 67 determines that it is unnecessary to respond to the device activation request, and does not send a device activation response.</p><p id="p0151" num="0151">Optionally, in an implementation manner of this embodiment, the apparatus 60 further includes:
<ul><li>a processing unit 66, configured to: in a case in which the first judging unit 64 judges that the zeroth terminal has an idle connection resource, reserve a connection resource to update the idle connection resource information of the zeroth terminal, including: if the first terminal is a connection handover requester, reserve a connection resource for the first terminal; and if the first terminal is a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection, reserve a connection resource for the second terminal.</li></ul></p><p id="p0152" num="0152">The connection handover apparatus 60 provided in this embodiment ensures that a zeroth terminal has an idle connection resource when the zeroth terminal feeds back connection configuration information of the zeroth terminal to the first terminal. In a case in which the zeroth terminal has no idle connection resource before receiving a request message of the first terminal, the zeroth terminal does not feed back connection configuration information of the zeroth terminal, thereby preventing a process in which a Bluetooth module and/or a Wi-Fi module of the zeroth terminal attempts to establish a connection, improving communication efficiency, and enhancing user experience. In addition, if the apparatus 60 includes the first processing module 66, an operation of reserving a connection resource may further be executed, so as to ensure that the zeroth terminal successfully establishes a connection with the first terminal (or with the second terminal with the assistance of the first terminal).</p><p id="p0153" num="0153"><figref idrefs="f0011">FIG. 7</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention. Referring to <figref idrefs="f0011">FIG. 7</figref>, a connection handover apparatus 70 includes an acquiring unit 61, a first receiving unit 62, a first determining unit 63, a first judging unit 64, and a first sending unit 65, and further includes a first processing unit 71, a second receiving unit 72, a second determining unit 73, and a second processing unit 74.</p><p id="p0154" num="0154">For the acquiring unit 61, refer to the description in the embodiment shown in <figref idrefs="f0010">FIG. 6</figref>.</p><p id="p0155" num="0155">The first receiving unit 62 receives a first connection handover request that is sent by a handover medium and is used for initiating a connection handover process (in this case, a first terminal serves as a handover medium, and is configured to assist the zeroth terminal and a second terminal in establishing a connection), where the first connection handover request carries a first identifier used for identifying the handover medium.<!-- EPO <DP n="39"> --></p><p id="p0156" num="0156">The first determining unit 63 determines to trigger the first judging unit 64 after the first receiving unit 62 receives the first connection handover request.</p><p id="p0157" num="0157">The first judging unit 64 determines, according to the idle connection resource information of the zeroth terminal, that the zeroth terminal has an idle connection resource, and triggers the first sending unit 65 and the first processing unit 71. (In a case in which the zeroth terminal has no idle connection resource, refer to the description in the embodiment shown in <figref idrefs="f0010">FIG. 6</figref>)</p><p id="p0158" num="0158">The first sending unit 65 sends a first connection handover medium message including connection configuration information of the zeroth terminal to the handover medium, where the connection configuration information of the zeroth terminal includes: Bluetooth connection configuration information and/or Wi-Fi connection configuration information of the zeroth terminal.</p><p id="p0159" num="0159">The first processing unit 71 is configured to reserve a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal.</p><p id="p0160" num="0160">The second receiving unit 72 is configured to: after the apparatus 70 sends the first connection handover medium message and reserves the connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, receive a second connection handover request sent by a third terminal, where the second connection handover request carries a second identifier used for identifying the third terminal.</p><p id="p0161" num="0161">The second determining unit 73 is configured to determine, according to the second connection handover request, to trigger the second processing unit 74.</p><p id="p0162" num="0162">The second processing unit 74 is configured to determine, according to the second identifier and the first identifier, whether the third terminal and the handover medium are the same terminal, so as to determine whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</p><p id="p0163" num="0163">Optionally, in an implementation manner of this embodiment, the second processing unit 74 includes:
<ul><li>a first judging module 741, configured to determine, according to the second identifier and the first identifier, whether the third terminal and the handover medium are the same terminal, and if yes, trigger a first sending module 742, otherwise, trigger a first processing module 743;</li><li>the first sending module 742, configured to send a second connection handover medium message including the connection configuration information of the zeroth terminal to the third terminal; and</li><li>the first processing module 743, configured to determine, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second<!-- EPO <DP n="40"> --> terminal, whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</li></ul></p><p id="p0164" num="0164">Further optionally, the first processing module 743 includes:
<ul><li>a first judging submodule, configured to determine, according to the idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether the zeroth terminal has an idle connection resource, and when it is determined that there is no idle connection resource, trigger a first sending submodule, otherwise, trigger a second sending submodule.</li><li>the first sending submodule, configured to: when the third terminal serves as a connection handover requester, send a first connection handover selection message to the third terminal to indicate that a connection resource of the zeroth terminal is limited; and when the third terminal serves as a handover medium, send a third connection handover medium message only including a message header and a message trailer to the third terminal, where, optionally, the first connection handover selection message includes an error code used for representing that a connection resource of the zeroth terminal is limited and a cause value; and</li><li>the second sending submodule, configured to: when the third terminal is a connection handover requester, send a second connection handover selection message including the connection configuration information of the zeroth terminal to the third terminal; and when the third terminal is a handover medium, send a fourth connection handover medium message including the connection configuration information of the zeroth terminal to the third terminal.</li></ul></p><p id="p0165" num="0165">Optionally, in an implementation manner of this embodiment, the connection handover apparatus 70 further includes:
<ul><li>a fifth processing unit 75, configured to reserve a connection resource for the third terminal. For example, when the third terminal is a connection handover requester, and the zeroth terminal still has an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, the fifth processing unit 75 is triggered. Certainly, the fifth processing unit 75 may further be configured to: when the third terminal is a handover medium, reserve a connection resource for a fourth terminal that establishes a connection with the zeroth terminal by using the third terminal.</li></ul></p><p id="p0166" num="0166">In addition to the technical effect when the first terminal serves as a handover medium in the embodiment shown in <figref idrefs="f0010">FIG. 6</figref>, the connection handover apparatus 70 provided in this embodiment can further: reserve a connection resource for the second terminal to prevent a phenomenon in which a connection resource is undesirably occupied, thereby ensuring that the zeroth terminal and the second terminal successfully establish a connection; identify the handover<!-- EPO <DP n="41"> --> medium and a third terminal to prevent a connection resource from being repeatedly reserved for the second terminal; and prevent a phenomenon in which a connection resource is undesirably occupied when the zeroth terminal establishes a connection with the third terminal (or establishes a connection with another terminal by using the third terminal), thereby improving communication efficiency.</p><p id="p0167" num="0167"><figref idrefs="f0012">FIG. 8</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention. Referring to <figref idrefs="f0012">FIG. 8</figref>, in addition to an acquiring unit 61, a first receiving unit 62, a first determining unit 63, a first judging unit 64, and a first sending unit 65, a connection handover apparatus 80 further includes a third processing unit 81, a third receiving unit 82, a third determining unit 83, and a fourth processing unit 84:</p><p id="p0168" num="0168">For the acquiring unit 61, refer to the description in the embodiment shown in <figref idrefs="f0010">FIG. 6</figref>.</p><p id="p0169" num="0169">Optionally, in an implementation manner of this embodiment, the acquiring unit 61 includes a first configuring module, configured to configure idle connection resource information of the zeroth terminal for a near field communication controller NFCC of the zeroth terminal by using a device host DH of the zeroth terminal, so that the first judging unit 64 determines, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource.</p><p id="p0170" num="0170">The first receiving unit 62 receives a first device activation request that is sent by a handover medium and is used for initiating a device activation request that is (in this case, a first terminal serves as a handover medium, and is configured to assist the zeroth terminal and a second terminal in establishing a connection), where the first device activation request carries a first action identifier and a third identifier that is used for identifying the handover medium.</p><p id="p0171" num="0171">The first determining unit 63 determines, according to the first action identifier, that a connection handover process needs to be performed, and triggers the first judging unit 64.</p><p id="p0172" num="0172">The first judging unit 64 determines, according to the idle connection resource information of the zeroth terminal, that the zeroth terminal has an idle connection resource, and triggers the first sending unit 65 and the third processing unit 81. (In a case in which the zeroth terminal has no idle connection resource, refer to the description in the embodiment shown in <figref idrefs="f0010">FIG. 6</figref>.)</p><p id="p0173" num="0173">The first sending unit 65 sends a first device activation response to the handover medium, so as to perform a connection handover process with the first terminal and feed back connection configuration information of the zeroth terminal to the first terminal in the connection handover process.</p><p id="p0174" num="0174">The third processing unit 81 is configured to reserve a connection resource for the<!-- EPO <DP n="42"> --> second terminal to update the idle connection resource information of the zeroth terminal.</p><p id="p0175" num="0175">The third receiving unit 82 is configured to: after the connection handover apparatus 80 sends the first device activation response and reserves the connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, receive a second device activation request sent by a third terminal, where the second device activation request carries a second action identifier and a fourth identifier that is used for identifying the third terminal.</p><p id="p0176" num="0176">The third determining unit 83 is configured to determine, according to the second action identifier, that a connection handover process needs to be performed, and trigger the fourth processing unit 84.</p><p id="p0177" num="0177">The fourth processing unit 84 is configured to determine, according to the fourth identifier and the third identifier, whether the third terminal and the handover medium are the same terminal, so as to determine whether to send a second device activation response to the third terminal.</p><p id="p0178" num="0178">Optionally, in an implementation manner of this embodiment, the fourth processing unit 84 includes:
<ul><li>a second judging module 841, configured to determine, according to the fourth identifier and the third identifier, whether the third terminal and the handover medium are the same terminal, and if yes, trigger a second sending module 842, otherwise, trigger a third judging module 843;</li><li>the second sending module 842, configured to send the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process; and</li><li>the third judging module 843, configured to perform determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, to determine whether the zeroth terminal has an idle connection resource, and if yes, trigger the second sending module 842, otherwise, skip triggering the second sending module 842.</li></ul></p><p id="p0179" num="0179">Optionally, in an implementation manner of this embodiment, the connection handover apparatus 80 further includes:
<ul><li>a fifth processing unit 85, configured to reserve a connection resource for the third terminal. For example, when the third terminal is a connection handover requester, and the zeroth terminal still has an idle connection resource after the zeroth terminal reserves a connection resource for the second terminal, the fifth processing unit 85 is triggered.</li></ul></p><p id="p0180" num="0180">In addition to the technical effect in the embodiment shown in <figref idrefs="f0011">FIG. 7</figref>, when a zeroth<!-- EPO <DP n="43"> --> terminal has no idle connection resource, the connection handover apparatus 80 provided in this embodiment can further directly determine not to respond to a device activation request sent by a handover medium or a third terminal, so that subsequent processes such as LLCP activation and data exchange are not executed, that is, an NFC communication procedure is terminated in advance, and a process, for example, in which Bluetooth and/or Wi-Fi of the zeroth terminal attempts to establish a wireless connection is avoided, thereby greatly saving communication time, and improving communication efficiency.</p><p id="p0181" num="0181">A person skilled in the art should understand that in the embodiments of the present invention, idle connection resource information of a zeroth terminal includes the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources, and may also include the number of idle connection resources of other connection technologies that can perform a connection handover in an NFC communication manner. Correspondingly, a communication terminal may further include other communications modules in addition to Bluetooth and/or W-Fi modules. If the embodiments of the present invention are used, other communications modules may also be effectively and properly triggered, thereby improving communication efficiency.</p><p id="p0182" num="0182"><figref idrefs="f0013">FIG. 9A</figref> is a schematic structural diagram of an NFC terminal according to an embodiment of the present invention. Referring to <figref idrefs="f0013">FIG. 9A</figref>, an NFC terminal 90 includes:
<ul><li>a processor 91, and a memory 92 and an NFCC 93 that are connected to the processor 91, where a corresponding program, application, data or instruction is stored in the memory 92 for invocation by the processor 91, the processor 91 and the NFCC 93 perform communication by using the NCI specification, and the NFCC 93 includes a receiver 931 and a transmitter 932 that are configured to perform message reception and transmission. Specifically:</li></ul></p><p id="p0183" num="0183">The processor 91 acquires idle connection resource information of the NFC terminal 90.</p><p id="p0184" num="0184">The NFCC 93 receives, by using the receiver 931, a request message sent by a first terminal, and triggers the processor 91 to determine, according to the request message, to perform a first determining, where the request message is used for initiating a connection handover process or used for notifying the NFC terminal 90 that a connection handover process needs to be performed, and the first determining is: determining, according to the idle connection resource information of the NFC terminal 90, whether the NFC terminal 90 has an idle connection resource.</p><p id="p0185" num="0185">The processor 91 performs the first determining, and if it is determined that the NFC terminal 90 has an idle connection resource, the processor 91 sends a response message to the first terminal by using the transmitter 932 of the NFCC 93, so as to feed back connection configuration information of the NFC terminal 90 to the first terminal, or if it is determined that the NFC terminal<!-- EPO <DP n="44"> --> 90 has no idle connection resource, the processor 91 determines not to feed back connection configuration information of the NFC terminal 90 to the first terminal.</p><p id="p0186" num="0186">Optionally, the idle connection resource information of the NFC terminal 90 includes: the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources.</p><p id="p0187" num="0187">Optionally, in an implementation manner of this embodiment, when the first terminal is a handover medium: the request message is a first connection handover request used for initiating a connection handover process, the response message is a first connection handover medium message including the connection configuration information of the NFC terminal 90, the connection configuration information of the NFC terminal 90 includes: Bluetooth connection configuration information and/or Wi-Fi connection configuration information of the NFC terminal 90.</p><p id="p0188" num="0188">Further optionally:
<ul><li>the first connection handover request carries a first identifier used for identifying the first terminal, the first terminal is a handover medium configured to assist the NFC terminal 90 and a second terminal in establishing a connection, and in this case, if the processor 91 judges that the NFC terminal 90 has an idle connection resource, the processor 91 further reserves a connection resource for the second terminal to update the idle connection resource information of the NFC terminal 90; and</li><li>after the transmitter 932 sends the first connection handover medium message and the processor 91 reserves the connection resource for the second terminal, and before the NFC terminal 90 establishes a connection with the second terminal, the following processing is executed:</li><li>receiving, by the NFCC 93 by using the receiver 931, a second connection handover request sent by a third terminal, and triggering the processor 91 to perform second determining, where the second connection handover request carries a second identifier used for identifying the third terminal, and the second determining is: determining, according to the second identifier and the first identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to feed back the connection configuration information of the NFC terminal 90 to the third terminal.</li></ul></p><p id="p0189" num="0189">The processor 91 may determine, in the following manner, whether to feed back the connection configuration information of the NFC terminal 90 to the third terminal:
<ul><li>when the third terminal and the first terminal are the same terminal, sending a second connection handover medium message including the connection configuration information of the NFC terminal 90 to the third terminal by using the transmitter 932 of the NFCC 93; and</li><li>when the third terminal and the first terminal are not the same terminal, determining,<!-- EPO <DP n="45"> --> according to an idle connection resource after the processor 91 reserves the connection resource for the second terminal, whether to feed back the connection configuration information of the NFC terminal 90 to the third terminal, including the following two scenarios:
<ul><li>Scenario 1: Determine, according to an idle connection resource after the processor 91 reserves the connection resource for the second terminal, whether the NFC terminal 90 has an idle connection resource. In a case in which the NFC terminal 90 has no idle connection resource, if the third terminal is a connection handover requester, send a first connection handover selection message to the third terminal by using the transmitter 932 of the NFCC 93 to indicate that a connection resource of the NFC terminal 90 is limited (for example, the first connection handover selection message includes an error code used for representing that a connection resource of the NFC terminal 90 is limited and a cause value). If the third terminal is a handover medium, send a third connection handover medium message only including a message header and a message trailer to the third terminal by using the transmitter 932 of the NFCC 93.</li><li>Scenario 2: In a case in which the NFC terminal 90 has an idle connection resource, if the third terminal is a connection handover requester, send a second connection handover selection message including the connection configuration information of the NFC terminal 90 to the third terminal by using the transmitter 932 of the NFCC 93; and if the third terminal is a handover medium, send a fourth connection handover medium message including the connection configuration information of the NFC terminal 90 to the third terminal by using the transmitter 932 of the NFCC 93.</li></ul></li></ul></p><p id="p0190" num="0190">Optionally, in an implementation manner of this embodiment, the processor 91 is further configured to reserve a connection resource for the third terminal (for example, when the third terminal is a connection handover requester).</p><p id="p0191" num="0191">A person skilled in the art should understand that, in the embodiment shown in <figref idrefs="f0013">FIG. 9A</figref>, the processor 91 implements a DH function of the NFC terminal 90.</p><p id="p0192" num="0192"><figref idrefs="f0013">FIG. 9B</figref> is a schematic structural diagram of an NFC terminal according to an embodiment of the present invention. Referring to <figref idrefs="f0013">FIG. 9B</figref>, an NFC terminal 90' includes:
<ul><li>a first processor 91', and a first memory 92' and an NFCC 93' that are connected to the first processor 91', where a corresponding program, application, data or instruction is stored in the first memory 92' for invocation by the first processor 91', the first processor 91' and the NFCC 93' perform communication by using the NCI specification, and the NFCC 93' includes a receiver 931', a transmitter 932', a second processor 933', and a second memory 934', and a corresponding program, application, data or instruction is stored in the second memory 934' for invocation by the second processor 933'. Specifically:<!-- EPO <DP n="46"> --></li><li>The second processor 933' acquires idle connection resource information of the NFC terminal 90'.</li></ul></p><p id="p0193" num="0193">The NFCC 93' receives, by using the receiver 931', a request message sent by a first terminal, and triggers the second processor 933' to determine, according to the request message, to perform a first determining, where the request message is used for initiating a connection handover process or used for notifying the NFC terminal 90' that a connection handover process needs to be performed, and the first determining is: determining, according to the idle connection resource information of the NFC terminal 90', whether the NFC terminal 90' has an idle connection resource.</p><p id="p0194" num="0194">The second processor 933' performs the first determining, and if it is determined that the NFC terminal 90' has an idle connection resource, the second processor 933' sends a response message to the first terminal by using the transmitter 932' so as to feed back connection configuration information of the NFC terminal 90' to the first terminal, or if it is determined that the NFC terminal 90' has no idle connection resource, the second processor 933' determines not to feed back connection configuration information of the NFC terminal 90' to the first terminal.</p><p id="p0195" num="0195">Optionally, in an implementation manner of this embodiment, the acquiring, by the second processor 933', the idle connection resource information of the NFC terminal 90' includes: acquiring, by the first processor 91', the idle connection resource information of the NFC terminal 90', and configuring the idle connection resource information of the NFC terminal 90' for the NFCC 93' according to the NCI specification. Specifically, for the configuration process, refer to the embodiment shown in <figref idrefs="f0006">FIG. 5A1</figref>, <figref idrefs="f0007">FIG. 5A2</figref>, <figref idrefs="f0008">FIG. 5B1</figref>, and <figref idrefs="f0009">FIG. 5B2</figref>.</p><p id="p0196" num="0196">Optionally, in an implementation manner of this embodiment, when the first terminal is a handover medium: the request message is a first device activation request used for initiating a device activation request, and the first device activation request carries a first action identifier, so that the NFC terminal 90' determines, according to the first action identifier, that a connection handover process needs to be performed, so as to determine that the first determining needs to be performed; and the response message is a first device activation response, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the NFC terminal 90' to the first terminal in the connection handover process, and the connection configuration information of the NFC terminal 90' includes: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the NFC terminal 90'.</p><p id="p0197" num="0197">Further optionally:
<ul><li>the first device activation request further carries a third identifier used for identifying the first terminal, the first terminal is a handover medium configured to assist the NFC terminal 90' and<!-- EPO <DP n="47"> --> a second terminal in establishing a connection, and in this case, if the second processor 933'judges that the NFC terminal 90' has an idle connection resource, the second processor 933' further reserves a connection resource for the second terminal to update the idle connection resource information of the NFC terminal 90'; and</li><li>after the first connection handover medium message is sent and the connection resource is reserved for the second terminal, and before a connection is established between the NFC terminal 90' and the second terminal, the following processing is further executed:
<ul><li>receiving, by the NFCC 93' by using the receiver 931', a second device activation request sent by a third terminal, and triggering the second processor 933' to perform second determining, where the second device activation request carries a second action identifier and a fourth identifier, the fourth identifier is used for identifying the third terminal, the second processor 933' determines, according to the second action identifier, to perform the second determining, and the second determining is: determining, according to the fourth identifier and the third identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to send a second device activation response to the third terminal by using the transmitter 932'.</li></ul></li></ul></p><p id="p0198" num="0198">If the third terminal and the first terminal are the same terminal, the second device activation response is sent, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the NFC terminal 90' to the third terminal in the connection handover process. If the third terminal and the first terminal are not the same terminal, determining is performed according to an idle connection resource after the second processor 933' reserves the connection resource for the second terminal, to determine whether the NFC terminal 90' has an idle connection resource, and if yes, the foregoing second device activation response is sent, otherwise, the foregoing second device activation response is not sent.</p><p id="p0199" num="0199">Optionally, in an implementation manner of this embodiment, the second processor 933' is further configured to reserve a connection resource for the third terminal (for example, when the third terminal is a connection handover requester).</p><p id="p0200" num="0200">Optionally, in the embodiment shown in <figref idrefs="f0013">FIG. 9B</figref>, the first processor 91' implements a DH function of the NFC terminal 90'.</p><p id="p0201" num="0201"><figref idrefs="f0014">FIG. 10</figref> is a schematic structural diagram of a connection handover apparatus according to an embodiment of the present invention. Referring to <figref idrefs="f0014">FIG. 10</figref>, a connection handover apparatus 100 includes:
<ul><li>a sending unit 101, configured to send a request message to a zeroth terminal, where the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed. The request message<!-- EPO <DP n="48"> --> includes a terminal identifier, and the terminal identifier is used for identifying a sender of the request message, so that the zeroth terminal identifies the sender of the request message according to the terminal identifier.</li></ul></p><p id="p0202" num="0202">Optionally, the request message is a connection handover request used for initiating a connection handover process; or, the request message is a device activation request carrying an action identifier, so that the zeroth terminal determines, according to the action identifier, that a connection handover process needs to be performed.</p><p id="p0203" num="0203">Optionally, in an implementation manner of this embodiment, the apparatus 100 further includes:
<ul><li>a configuring unit 102, configured to configure the terminal identifier and the action identifier for an NFCC by using a DH, so that the sending unit 101 sends the device activation request.</li></ul></p><p id="p0204" num="0204">Optionally, in an implementation manner of this embodiment, the apparatus 100 further includes:
<ul><li>a receiving unit 103, configured to receive a response message sent after the zeroth terminal receives the request message, where in a case in which the request message is the connection handover request, if the zeroth terminal has an idle connection resource, the response message includes connection configuration information of the zeroth terminal, otherwise, the response message does not include the connection configuration information; and in a case in which the request message is the device activation request, when the zeroth terminal has an idle connection resource, the response message is a device activation response.</li></ul></p><p id="p0205" num="0205">The apparatus 100 provided in this embodiment is configured to perform NFC communication with a zeroth terminal, and send a terminal identifier of the apparatus 100 to the zeroth terminal by using a connection handover request message or a device activation request message, so that the zeroth terminal identifies and distinguishes, according to the terminal identifier, a terminal that performs NFC communication with the zeroth terminal.</p><p id="p0206" num="0206"><figref idrefs="f0014">FIG. 11</figref> is a schematic structural diagram of an NFC terminal according to an embodiment of the present invention. Referring to <figref idrefs="f0014">FIG. 11</figref>, the NFC terminal 110 includes:
<ul><li>a processor 111, and a memory 112 and an NFCC 113 that are connected to the processor 111, where a corresponding program, application, data or signaling is stored in the memory 112 for invocation by the processor 111, the processor 111 and the NFCC 113 perform communication by using the NCI specification, and the NFCC 113 includes a transmitter 1131. Specifically:</li></ul></p><p id="p0207" num="0207">The processor 111 sends a request message to a zeroth terminal by using the transmitter<!-- EPO <DP n="49"> --> 1131, where the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed, where the request message includes a terminal identifier, and the terminal identifier is used for identifying a sender of the request message, so that the zeroth terminal identifies the sender of the request message according to the terminal identifier.</p><p id="p0208" num="0208">Optionally, the request message is a connection handover request used for initiating a connection handover process; or, the request message is a device activation request carrying an action identifier, so that the zeroth terminal determines, according to the action identifier, that a connection handover process needs to be performed.</p><p id="p0209" num="0209">Further optionally, the processor 111 configures the terminal identifier and the action identifier for the NFCC 113 according to the NCI specification, so as to send the device activation request by using the transmitter 1131 of the NFCC 113.</p><p id="p0210" num="0210">Optionally, the NFCC 113 further includes a receiver 1132, and the processor 111 receives, by using the receiver 1132 of the NFCC 113, a response message sent by the zeroth terminal after the zeroth terminal receives the request message, where:
<ul><li>in a case in which the request message is the connection handover request, if the zeroth terminal has an idle connection resource, the response message includes the connection configuration information of the zeroth terminal, otherwise, the response message does not include the connection configuration information of the zeroth terminal; and when the request message is the device activation request and the zeroth terminal has an idle connection resource, the response message is a device activation response.</li></ul></p><p id="p0211" num="0211">A person skilled in the art should understand that the processor 91 in <figref idrefs="f0013">FIG. 9A</figref> and the first processor 91' in <figref idrefs="f0013">FIG. 9B</figref> may be central processing units (Central Processing Unit, CPU), or may further be other general processors, digital signal processors (DSP), application-specific integrated circuits (ASIC), field-programmable gate arrays (FPGA) or other programmable logic devices, discrete gates or transistor logic devices, discrete hardware components, and the like. In addition, there may exist a terminal that has the functions of all the parts in the embodiments shown in <figref idrefs="f0013">FIG. 9A, FIG. 9B</figref>, and <figref idrefs="f0014">FIG. 11</figref>.</p><p id="p0212" num="0212">Refer to the description in the method embodiments for the detailed description of functions of the units, modules or components in the apparatus embodiments of the present invention, which are not described herein.</p><p id="p0213" num="0213">A person of ordinary skill in the art may understand that all or some of the processes of the methods in the embodiments may be implemented by a computer program instructing relevant hardware. The program may be stored in a computer readable storage medium. When the program<!-- EPO <DP n="50"> --> runs, the processes of the methods in the embodiments are performed. The storage medium may include: a magnetic disk, an optical disc, a read-only memory (Read-Only Memory, ROM), or a random access memory (Random Access Memory, RAM).</p><p id="p0214" num="0214">What is disclosed above is merely exemplary embodiments of the present invention, and certainly is not intended to limit the protection scope of the present invention. Any equivalent modification made in accordance with the claims of the present invention shall fall within the scope of the present invention.</p></description><claims mxw-id="PCLM90459121" lang="EN" load-source="patent-office"><!-- EPO <DP n="51"> --><claim id="c-en-0001" num="0001"><claim-text>A connection handover method based on near field communication, comprising:
<claim-text>acquiring, by a zeroth terminal, idle connection resource information of the zeroth terminal;</claim-text>
<claim-text>receiving a request message sent by a first terminal, wherein the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed; and</claim-text>
<claim-text>determining, according to the request message, that the following first determining needs to be performed:
<claim-text>determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, if yes, sending a response message to the first terminal, so as to feed back connection configuration information of the zeroth terminal to the first terminal, and if not, skipping feeding back connection configuration information of the zeroth terminal to the first terminal.</claim-text></claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, wherein the idle connection resource information of the zeroth terminal comprises: the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 1, wherein when the first terminal is a handover medium:
<claim-text>the receiving a request message sent by a first terminal comprises: receiving a first connection handover request used for initiating a connection handover process, so as to determine that the first determining needs to be performed; and</claim-text>
<claim-text>the sending a response message to the first terminal comprises: sending a first connection handover medium message comprising the connection configuration information of the zeroth terminal, wherein the connection configuration information of the zeroth terminal comprises: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to claim 1, wherein when the first terminal is a handover medium:
<claim-text>the receiving a request message sent by a first terminal comprises: receiving a first device activation request used for initiating a device activation request, wherein the first device activation request carries a first action identifier, so that the zeroth terminal determines, according to the first action identifier, that a connection handover process needs to be performed, so as to determine that the first determining needs to be performed; and</claim-text>
<claim-text>the sending a response message to the first terminal comprises: sending a first device<!-- EPO <DP n="52"> --> activation response, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process, wherein the connection configuration information of the zeroth terminal comprises: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to claim 3, wherein,<br/>
the first connection handover request carries a first identifier used for identifying the first terminal;<br/>
the first terminal is specifically a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection;<br/>
if it is determined that the zeroth terminal has an idle connection resource, the method further comprises: reserving, by the zeroth terminal, a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal; and<br/>
after the sending a first connection handover medium message and reserving a connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, the method further comprises:
<claim-text>receiving a second connection handover request sent by a third terminal, wherein the second connection handover request carries a second identifier used for identifying the third terminal; and</claim-text>
<claim-text>determining, according to the second identifier and the first identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method according to claim 5, wherein the determining whether to feed back the connection configuration information of the zeroth terminal to the third terminal comprises:
<claim-text>when the third terminal and the first terminal are the same terminal, sending a second connection handover medium message to the third terminal, wherein the second connection handover medium message comprises the connection configuration information of the zeroth terminal; and</claim-text>
<claim-text>when the third terminal and the first terminal are not the same terminal, determining, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method according to claim 6, wherein the determining, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether to feed back the connection configuration information of the zeroth terminal to the third terminal<!-- EPO <DP n="53"> --> comprises:
<claim-text>determining, according to the idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether the zeroth terminal has an idle connection resource, and in a case in which the zeroth terminal has no idle connection resource, if the third terminal is a connection handover requester, sending a first connection handover selection message to the third terminal to indicate that a connection resource of the zeroth terminal is limited; and if the third terminal is a handover medium, sending a third connection handover medium message only comprising a message header and a message trailer to the third terminal; or</claim-text>
<claim-text>in a case in which the zeroth terminal has an idle connection resource, if the third terminal is a connection handover requester, sending a second connection handover selection message to the third terminal, wherein the second connection handover selection message comprises the connection configuration information of the zeroth terminal; and if the third terminal is a handover medium, sending a fourth connection handover medium message to the third terminal, wherein the fourth connection handover medium message comprises the connection configuration information of the zeroth terminal.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method according to claim 7, wherein the first connection handover selection message comprises: an error code used for representing that a connection resource of the zeroth terminal is limited and a cause value.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method according to claim 4, wherein,<br/>
the first device activation request further carries a third identifier used for identifying the first terminal;<br/>
the first terminal is specifically a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection;<br/>
if it is determined that the zeroth terminal has an idle connection resource, the method further comprises: reserving, by the zeroth terminal, a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal; and<br/>
after the sending a first device activation response and reserving a connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, the method further comprises:
<claim-text>receiving a second device activation request sent by a third terminal, wherein the second device activation request carries a second action identifier and a fourth identifier, and the fourth identifier is used for identifying the third terminal;</claim-text>
<claim-text>determining, according to the second action identifier, that a connection handover process needs to be performed; and<!-- EPO <DP n="54"> --></claim-text>
<claim-text>determining, according to the fourth identifier and the third identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to send a second device activation response to the third terminal.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The method according to claim 9, wherein,<br/>
the determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource comprises: determining, by a near field communication controller NFCC of the zeroth terminal according to the idle connection resource information of the zeroth terminal configured by a device host DH for the NFCC of the zeroth terminal, whether the zeroth terminal has an idle connection resource;<br/>
the first terminal configures, by using a DH, the first action identifier and the third identifier for an NFCC of the first terminal, so as to send the first device activation request by using the NFCC of the first terminal; and<br/>
the second action identifier and the fourth identifier in the second device activation request are configured by the third terminal for an NFCC of the third terminal by using a DH, and the NFCC of the third terminal sends the second device activation request.</claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The method according to claim 9 or 10, wherein, the determining whether to send a second device activation response to the third terminal comprises:
<claim-text>if the third terminal and the first terminal are the same terminal, sending the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process; and</claim-text>
<claim-text>if the third terminal and the first terminal are not the same terminal, performing determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, to determine whether the zeroth terminal has an idle connection resource, if yes, sending the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process, otherwise, skipping sending the second device activation response.</claim-text></claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The method according to claim 7 or 8 or 11, wherein when it is determined, by performing the determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, that the zeroth terminal has an idle connection resource, the method further comprises:
<claim-text>reserving a connection resource for the third terminal.</claim-text></claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>The method according to claim 1 or 2, wherein if the first terminal is a connection<!-- EPO <DP n="55"> --> handover requester:
<claim-text>the request message is a third connection handover request used for initiating a connection handover process, and the response message is a third connection handover selection message comprising the connection configuration information of the zeroth terminal; or,</claim-text>
<claim-text>the request message is a third device activation request carrying a third action identifier, so that the zeroth terminal determines, according to the third action identifier, that a connection handover process needs to be performed, wherein the third action identifier is configured by the first terminal, by using a DH for an NFCC of the first terminal, so as to send the third device activation request by using the NFCC of the first terminal; the response message is a third device activation response, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process; and the determining, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource comprises: determining, by an NFCC of the zeroth terminal according to the idle connection resource information of the zeroth terminal configured by a DH for the NFCC of the zeroth terminal, whether the zeroth terminal has an idle connection resource.</claim-text></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>A connection handover apparatus for near field communication, comprising:
<claim-text>an acquiring unit, configured to acquire idle connection resource information of a zeroth terminal;</claim-text>
<claim-text>a first receiving unit, configured to receive a request message sent by a first terminal, wherein the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed;</claim-text>
<claim-text>a first determining unit, configured to determine, according to the request message, that a first judging unit needs to be triggered;</claim-text>
<claim-text>the first judging unit, configured to determine, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource, and if yes, trigger a first sending unit, wherein if not, the connection handover apparatus does not feed back connection configuration information of the zeroth terminal to the first terminal; and</claim-text>
<claim-text>the first sending unit, configured to send a response message to the first terminal, so as to feed back the connection configuration information of the zeroth terminal to the first terminal.</claim-text></claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>The apparatus according to claim 14, wherein the idle connection resource information of the zeroth terminal comprises: the number of idle Bluetooth connection resources, and/or, the number of idle Wi-Fi connection resources.</claim-text></claim><claim id="c-en-0016" num="0016"><claim-text>The apparatus according to claim 14, wherein:<!-- EPO <DP n="56"> -->
<claim-text>the first receiving unit is specifically configured to: when the first terminal is a handover medium, receive a first connection handover request that is sent by the first terminal and is used for initiating a connection handover process; and</claim-text>
<claim-text>the first sending unit is specifically configured to: when the first terminal is a handover medium, send a first connection handover medium message comprising the connection configuration information of the zeroth terminal to the first terminal, wherein the connection configuration information of the zeroth terminal comprises: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</claim-text></claim-text></claim><claim id="c-en-0017" num="0017"><claim-text>The apparatus according to claim 14, wherein:
<claim-text>the first receiving unit is specifically configured to: when the first terminal is a handover medium, receive a first device activation request that is sent by the first terminal and is used for initiating a device activation request, wherein the first device activation request carries a first action identifier;</claim-text>
<claim-text>the first determining unit is specifically configured to: when the first terminal is a handover medium, determine, according to the first action identifier, that a connection handover process needs to be performed, and trigger the first judging unit; and</claim-text>
<claim-text>the first sending unit is specifically configured to: when the first terminal is a handover medium, send a first device activation response to the first terminal, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process, wherein the connection configuration information of the zeroth terminal comprises: Bluetooth connection configuration information, and/or Wi-Fi connection configuration information of the zeroth terminal.</claim-text></claim-text></claim><claim id="c-en-0018" num="0018"><claim-text>The apparatus according to claim 16, wherein,<br/>
the first connection handover request carries a first identifier used for identifying the first terminal; and<br/>
the apparatus further comprises:
<claim-text>a first processing unit, configured to: in a case in which the first terminal is a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection, when the first judging unit judges that the zeroth terminal has an idle connection resource, reserve a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal;</claim-text>
<claim-text>a second receiving unit, configured to: after the apparatus sends the first connection handover medium message and reserves the connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, receive a second<!-- EPO <DP n="57"> --> connection handover request sent by a third terminal, wherein the second connection handover request carries a second identifier used for identifying the third terminal;</claim-text>
<claim-text>a second determining unit, configured to determine, according to the second connection handover request, to trigger a second processing unit; and</claim-text>
<claim-text>the second processing unit, configured to determine, according to the second identifier and the first identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</claim-text></claim-text></claim><claim id="c-en-0019" num="0019"><claim-text>The apparatus according to claim 18, wherein the second processing unit comprises:
<claim-text>a first judging module, configured to determine, according to the second identifier and the first identifier, whether the third terminal and the first terminal are the same terminal, and if yes, trigger a first sending module, otherwise, trigger a first processing module;</claim-text>
<claim-text>the first sending module, configured to send a second connection handover medium message to the third terminal, wherein the second connection handover medium message comprises the connection configuration information of the zeroth terminal; and</claim-text>
<claim-text>the first processing module, configured to determine, according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether to feed back the connection configuration information of the zeroth terminal to the third terminal.</claim-text></claim-text></claim><claim id="c-en-0020" num="0020"><claim-text>The apparatus according to claim 19, wherein the first processing module comprises:
<claim-text>a first judging submodule, configured to determine, according to the idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, whether the zeroth terminal has an idle connection resource, and when it is determined that there is no idle connection resource, trigger a first sending submodule, otherwise, trigger a second sending submodule;</claim-text>
<claim-text>the first sending submodule, configured to: when the third terminal is a connection handover requester, send a first connection handover selection message to the third terminal to indicate that a connection resource of the zeroth terminal is limited; and when the third terminal is a handover medium, send a third connection handover medium message only comprising a message header and a message trailer to the third terminal; and</claim-text>
<claim-text>the second sending submodule, configured to: when the third terminal is a connection handover requester, send a second connection handover selection message to the third terminal, wherein the second connection handover selection message comprises the connection configuration information of the zeroth terminal; or when the third terminal is a handover medium, send a fourth connection handover medium message to the third terminal, wherein the fourth connection<!-- EPO <DP n="58"> --> handover medium message comprises the connection configuration information of the zeroth terminal.</claim-text></claim-text></claim><claim id="c-en-0021" num="0021"><claim-text>The apparatus according to claim 20, wherein the first connection handover selection message comprises: an error code used for representing that a connection resource of the zeroth terminal is limited and a cause value.</claim-text></claim><claim id="c-en-0022" num="0022"><claim-text>The apparatus according to claim 17, wherein the acquiring unit comprises:
<claim-text>a first configuring module, configured to configure the idle connection resource information of the zeroth terminal for a near field communication controller NFCC of the zeroth terminal by using a device host DH of the zeroth terminal, so that the first judging unit determines, according to the idle connection resource information of the zeroth terminal, whether the zeroth terminal has an idle connection resource.</claim-text></claim-text></claim><claim id="c-en-0023" num="0023"><claim-text>The apparatus according to claim 17 or 22, wherein,<br/>
the first device activation request further carries a third identifier used for identifying the first terminal; and<br/>
the apparatus further comprises:
<claim-text>a third processing unit, configured to: in a case in which the first terminal is a handover medium configured to assist the zeroth terminal and a second terminal in establishing a connection, when the first judging unit judges that the zeroth terminal has an idle connection resource, reserve a connection resource for the second terminal to update the idle connection resource information of the zeroth terminal;</claim-text>
<claim-text>a third receiving unit, configured to: after the apparatus sends the first device activation response and reserves the connection resource for the second terminal, and before a connection is established between the zeroth terminal and the second terminal, receive a second device activation request sent by a third terminal, wherein the second device activation request carries a second action identifier and a fourth identifier, and the fourth identifier is used for identifying the third terminal;</claim-text>
<claim-text>a third determining unit, configured to determine, according to the second action identifier, that a connection handover process needs to be performed, so as to trigger a fourth processing unit; and</claim-text>
<claim-text>the fourth processing unit, configured to determine, according to the fourth identifier and the third identifier, whether the third terminal and the first terminal are the same terminal, so as to determine whether to send a second device activation response to the third terminal.</claim-text></claim-text></claim><claim id="c-en-0024" num="0024"><claim-text>The apparatus according to claim 23, wherein the fourth processing unit comprises:
<claim-text>a second judging module, configured to determine, according to the fourth identifier and the third identifier, whether the third terminal and the first terminal are the same terminal, and if yes, trigger a second sending module, otherwise, trigger a third judging module;<!-- EPO <DP n="59"> --></claim-text>
<claim-text>the second sending module, configured to send the second device activation response, so as to perform a connection handover process with the third terminal and feed back the connection configuration information of the zeroth terminal to the third terminal in the connection handover process; and</claim-text>
<claim-text>the third judging module, configured to perform determining according to an idle connection resource after the zeroth terminal reserves the connection resource for the second terminal, to determine whether the zeroth terminal has an idle connection resource, and if yes, trigger the second sending module, otherwise, skip triggering the second sending module.</claim-text></claim-text></claim><claim id="c-en-0025" num="0025"><claim-text>The apparatus according to claim 20 or 21 or 24, wherein the apparatus further comprises:
<claim-text>a fifth processing unit, configured to reserve a connection resource for the third terminal.</claim-text></claim-text></claim><claim id="c-en-0026" num="0026"><claim-text>The apparatus according to claim 14 or 15, wherein:
<claim-text>the first receiving unit is specifically configured to: when the first terminal is a connection handover requester, receive a third connection handover request that is sent by the first terminal and is used for initiating a connection handover process; and the first sending unit is specifically configured to: when the first terminal is a connection handover requester, send a third connection handover selection message comprising the connection configuration information of the zeroth terminal to the first terminal; or,</claim-text>
<claim-text>the acquiring unit comprises: a second configuring module, configured to configure the idle connection resource information of the zeroth terminal for an NFCC of the zeroth terminal by using a DH of the zeroth terminal, so that the first judging unit judges whether the zeroth terminal has an idle connection resource; the first receiving unit is specifically configured to: when the first terminal is a connection handover requester, receive a third device activation request that is sent by the first terminal and carries a third action identifier, so that the first determining unit determines, according to the third action identifier, that a connection handover process needs to be performed; and the first sending unit is specifically configured to: when the first terminal is a connection handover requester, send a third device activation response to the first terminal, so as to perform a connection handover process with the first terminal and feed back the connection configuration information of the zeroth terminal to the first terminal in the connection handover process.</claim-text></claim-text></claim><claim id="c-en-0027" num="0027"><claim-text>A connection handover apparatus for near field communication, comprising:
<claim-text>a sending unit, configured to send a request message to a zeroth terminal, wherein the request message is used for initiating a connection handover process, or used for notifying the zeroth terminal that a connection handover process needs to be performed, wherein the request message carries a terminal identifier, and the terminal identifier is used for identifying a sender of the request message, so that the zeroth terminal identifies the sender of the request message according to the<!-- EPO <DP n="60"> --> terminal identifier.</claim-text></claim-text></claim><claim id="c-en-0028" num="0028"><claim-text>The apparatus according to claim 27, wherein,<br/>
the request message is a connection handover request used for initiating a connection handover process; or<br/>
the request message is a device activation request carrying an action identifier, so that the zeroth terminal determines, according to the action identifier, that a connection handover process needs to be performed.</claim-text></claim><claim id="c-en-0029" num="0029"><claim-text>The apparatus according to claim 28, wherein the apparatus further comprises:
<claim-text>a configuring unit, configured to configure the terminal identifier and the action identifier for an NFCC by using a DH, so that the sending unit sends the device activation request.</claim-text></claim-text></claim><claim id="c-en-0030" num="0030"><claim-text>The apparatus according to claim 28 or 29, wherein, the apparatus further comprises:
<claim-text>a receiving unit, configured to receive a response message sent by the zeroth terminal after the zeroth terminal receives the request message, wherein:
<claim-text>in a case in which the request message is the connection handover request, if the zeroth terminal has an idle connection resource, the response message comprises connection configuration information of the zeroth terminal, otherwise, the response message does not comprise connection configuration information of the zeroth terminal; and</claim-text>
<claim-text>in a case in which the request message is the device activation request, when the zeroth terminal has an idle connection resource, the response message is a device activation response.</claim-text></claim-text></claim-text></claim></claims><drawings mxw-id="PDW20421859" load-source="patent-office"><!-- EPO <DP n="61"> --><figure id="f0001" num="1,2A"><img id="if0001" file="imgf0001.tif" wi="165" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="62"> --><figure id="f0002" num="2B"><img id="if0002" file="imgf0002.tif" wi="121" he="232" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="63"> --><figure id="f0003" num="3A"><img id="if0003" file="imgf0003.tif" wi="165" he="197" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="64"> --><figure id="f0004" num="3B"><img id="if0004" file="imgf0004.tif" wi="165" he="205" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="65"> --><figure id="f0005" num="4"><img id="if0005" file="imgf0005.tif" wi="165" he="179" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="66"> --><figure id="f0006" num="5A1"><img id="if0006" file="imgf0006.tif" wi="165" he="218" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="67"> --><figure id="f0007" num="5A2"><img id="if0007" file="imgf0007.tif" wi="165" he="218" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="68"> --><figure id="f0008" num="5B1"><img id="if0008" file="imgf0008.tif" wi="165" he="218" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="69"> --><figure id="f0009" num="5B2"><img id="if0009" file="imgf0009.tif" wi="165" he="218" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="70"> --><figure id="f0010" num="6"><img id="if0010" file="imgf0010.tif" wi="165" he="110" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="71"> --><figure id="f0011" num="7"><img id="if0011" file="imgf0011.tif" wi="165" he="146" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="72"> --><figure id="f0012" num="8"><img id="if0012" file="imgf0012.tif" wi="165" he="146" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="73"> --><figure id="f0013" num="9A,9B"><img id="if0013" file="imgf0013.tif" wi="165" he="192" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="74"> --><figure id="f0014" num="10,11"><img id="if0014" file="imgf0014.tif" wi="123" he="178" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="227" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="165" he="223" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
