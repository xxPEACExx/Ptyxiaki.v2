<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2960791-A1" country="EP" doc-number="2960791" kind="A1" date="20151230" family-id="51062691" file-reference-id="316857" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451486" ucid="EP-2960791-A1"><document-id><country>EP</country><doc-number>2960791</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14174838-A" is-representative="YES"><document-id mxw-id="PAPP193865940" load-source="docdb" format="epo"><country>EP</country><doc-number>14174838</doc-number><kind>A</kind><date>20140627</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193865941" load-source="patent-office" format="original"><country>EP</country><doc-number>14174838.4</doc-number><date>20140627</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162027574" ucid="EP-14174838-A" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>14174838</doc-number><kind>A</kind><date>20140627</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1988520238" load-source="docdb">G06F  11/30        20060101ALI20141128BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988520738" load-source="docdb">G06F   9/52        20060101AFI20141128BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988525050" load-source="docdb">G06F   1/32        20060101ALI20141128BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988526995" load-source="docdb">G06F   9/50        20060101ALI20141128BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1713523461" load-source="docdb" scheme="CPC">Y02D  10/22        20180101 LA20180103BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831578" load-source="docdb" scheme="CPC">G06F2201/865       20130101 LA20171201BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831579" load-source="docdb" scheme="CPC">G06F  11/3058      20130101 LI20171201BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831580" load-source="docdb" scheme="CPC">G06F  11/3055      20130101 LI20171201BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831581" load-source="docdb" scheme="CPC">G06F  11/302       20130101 LI20171201BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831582" load-source="docdb" scheme="CPC">G06F  11/3003      20130101 LI20171201BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984700686" load-source="docdb" scheme="CPC">G06F   1/3228      20130101 LI20151231BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984700707" load-source="docdb" scheme="CPC">G06F   1/26        20130101 FI20151231BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987785666" load-source="docdb" scheme="CPC">G06F  11/3006      20130101 LI20141031BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987798198" load-source="docdb" scheme="CPC">G06F   9/5094      20130101 LI20141031BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165545924" lang="DE" load-source="patent-office">Verfahren zur Ausführung einer Anwendung auf einem verteilten Computersystem, Ressourcenmanager und verteiltes Computersystem</invention-title><invention-title mxw-id="PT165545925" lang="EN" load-source="patent-office">Method of executing an application on a distributed computer system, a resource manager and a distributed computer system</invention-title><invention-title mxw-id="PT165545926" lang="FR" load-source="patent-office">Procédé d'exécution d'une application sur un système informatique distribué, un gestionnaire de ressources et un système informatique distribué</invention-title><citations><patent-citations><patcit mxw-id="PCIT335962082" load-source="docdb" ucid="CN-103268261-A"><document-id format="epo"><country>CN</country><doc-number>103268261</doc-number><kind>A</kind><date>20130828</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335962079" load-source="docdb" ucid="US-20090100437-A1"><document-id format="epo"><country>US</country><doc-number>20090100437</doc-number><kind>A1</kind><date>20090416</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335962080" load-source="docdb" ucid="US-20090106571-A1"><document-id format="epo"><country>US</country><doc-number>20090106571</doc-number><kind>A1</kind><date>20090423</date></document-id><sources><source name="SEA" category="I" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335962081" load-source="docdb" ucid="US-20120216205-A1"><document-id format="epo"><country>US</country><doc-number>20120216205</doc-number><kind>A1</kind><date>20120823</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>ELNOZAHY E N ET AL: "Energy-efficient server clusters", POWER-AWARE COMPUTER SYSTEMS : SECOND INTERNATIONAL WORKSHOP, PACS 2002, CAMBRIDGE, MA, USA, FEBRUARY 2, 2002 ; REV. PAPERS; [LECTURE NOTES IN COMPUTER SCIENCE ; 2325], SPRINGER, DE, vol. 2325, 1 January 2003 (2003-01-01), pages 179 - 196, XP002623104, ISBN: 978-3-540-01028-9</text><sources><source mxw-id="PNPL65515061" load-source="docdb" name="SEA" category="A"/></sources></nplcit><nplcit><text>JIAN LI ET AL: "The Thrifty Barrier: Energy-Aware Synchronization in Shared-Memory Multiprocessors", HIGH PERFORMANCE COMPUTER ARCHITECTURE, 2004. HPCA-10. PROCEEDINGS. 10 TH INTERNATIONAL SYMPOSIUM ON MADRID, SPAIN 14-18 FEB. 2004, PISCATAWAY, NJ, USA,IEEE, 14 February 2004 (2004-02-14), pages 14 - 14, XP010778825, ISBN: 978-0-7695-2053-7, DOI: 10.1109/HPCA.2004.10018</text><sources><source mxw-id="PNPL65515062" load-source="docdb" name="SEA" category="A"/></sources></nplcit><nplcit><text>NIKOLAS IOANNOU ET AL: "Phase-Based Application-Driven Hierarchical Power Management on the Single-chip Cloud Computer", PARALLEL ARCHITECTURES AND COMPILATION TECHNIQUES (PACT), 2011 INTERNATIONAL CONFERENCE ON, IEEE, 10 October 2011 (2011-10-10), pages 131 - 142, XP032083295, ISBN: 978-1-4577-1794-9, DOI: 10.1109/PACT.2011.19</text><sources><source mxw-id="PNPL65515063" load-source="docdb" name="SEA" category="A"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR1103321550" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>FUJITSU LTD</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR1103314333" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>FUJITSU LIMITED</last-name></addressbook></applicant><applicant mxw-id="PPAR1101641551" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>FUJITSU LIMITED</last-name><iid>100126510</iid><address><street>1-1, Kamikodanaka 4-chome, Nakahara-ku</street><city>Kawasaki-shi, Kanagawa 211-8588</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103304931" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>VAN DEN BERGHE SVEN</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR1103320796" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>VAN DEN BERGHE, SVEN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101643157" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>VAN DEN BERGHE, SVEN</last-name><address><street>12 Woodland Close</street><city>Marlow Bucks, SL7 3LE</city><country>GB</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101640088" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Stebbing, Timothy Charles</last-name><suffix>et al</suffix><iid>100028668</iid><address><street>Haseltine Lake LLP Lincoln House, 5th Floor 300 High Holborn</street><city>London WC1V 7JH</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS660685802" load-source="docdb">AL</country><country mxw-id="DS660690873" load-source="docdb">AT</country><country mxw-id="DS660685808" load-source="docdb">BE</country><country mxw-id="DS660606643" load-source="docdb">BG</country><country mxw-id="DS660610675" load-source="docdb">CH</country><country mxw-id="DS660688082" load-source="docdb">CY</country><country mxw-id="DS660690874" load-source="docdb">CZ</country><country mxw-id="DS660783550" load-source="docdb">DE</country><country mxw-id="DS660685809" load-source="docdb">DK</country><country mxw-id="DS660688087" load-source="docdb">EE</country><country mxw-id="DS660611185" load-source="docdb">ES</country><country mxw-id="DS660606644" load-source="docdb">FI</country><country mxw-id="DS660606645" load-source="docdb">FR</country><country mxw-id="DS660783551" load-source="docdb">GB</country><country mxw-id="DS660685810" load-source="docdb">GR</country><country mxw-id="DS660685815" load-source="docdb">HR</country><country mxw-id="DS660688088" load-source="docdb">HU</country><country mxw-id="DS660610676" load-source="docdb">IE</country><country mxw-id="DS660685816" load-source="docdb">IS</country><country mxw-id="DS660606646" load-source="docdb">IT</country><country mxw-id="DS660688089" load-source="docdb">LI</country><country mxw-id="DS660783552" load-source="docdb">LT</country><country mxw-id="DS660690879" load-source="docdb">LU</country><country mxw-id="DS660783553" load-source="docdb">LV</country><country mxw-id="DS660783554" load-source="docdb">MC</country><country mxw-id="DS660685305" load-source="docdb">MK</country><country mxw-id="DS660685306" load-source="docdb">MT</country><country mxw-id="DS660611186" load-source="docdb">NL</country><country mxw-id="DS660690880" load-source="docdb">NO</country><country mxw-id="DS660611191" load-source="docdb">PL</country><country mxw-id="DS660690881" load-source="docdb">PT</country><country mxw-id="DS660611192" load-source="docdb">RO</country><country mxw-id="DS660690882" load-source="docdb">RS</country><country mxw-id="DS660611193" load-source="docdb">SE</country><country mxw-id="DS660688090" load-source="docdb">SI</country><country mxw-id="DS660685311" load-source="docdb">SK</country><country mxw-id="DS660685312" load-source="docdb">SM</country><country mxw-id="DS660610677" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479856" lang="EN" load-source="patent-office"><p id="pa01" num="0001">In a distributed computer system, a Resource Manager (200) is provided for managing a plurality of computers (101) to execute an application. Each of the computers is operable in one of a plurality of power configurations, including a high-power configuration and one or more low-power configurations. The Resource Manager (200) exchanges messages with a Resource Manager Proxy (201) in each computer of the distributed computer system. Responsive to notifications from Resource Manager Proxies of changes in execution state of the application, the Resource Manager determines a power configuration applicable for the computer of that Resource Manager Proxy, or for a set of computers (including possibly all the computers) executing the application. The Resource Manager (200) informs the determined power configuration to the Resource Manager Proxy (201) which then decides whether to implement a change. This reduces the amount of energy used in, particularly, but not exclusively, high performance computing systems by enabling fine grained, responsive control of the power configuration of the individual computers in a HPC cluster taking into account the overall state of an application occupying multiple computers.
<img id="iaf01" file="imgaf001.tif" wi="78" he="86" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759668" lang="EN" source="EPO" load-source="docdb"><p>In a distributed computer system, a Resource Manager (200) is provided for managing a plurality of computers (101) to execute an application. Each of the computers is operable in one of a plurality of power configurations, including a high-power configuration and one or more low-power configurations. The Resource Manager (200) exchanges messages with a Resource Manager Proxy (201) in each computer of the distributed computer system. Responsive to notifications from Resource Manager Proxies of changes in execution state of the application, the Resource Manager determines a power configuration applicable for the computer of that Resource Manager Proxy, or for a set of computers (including possibly all the computers) executing the application. The Resource Manager (200) informs the determined power configuration to the Resource Manager Proxy (201) which then decides whether to implement a change. This reduces the amount of energy used in, particularly, but not exclusively, high performance computing systems by enabling fine grained, responsive control of the power configuration of the individual computers in a HPC cluster taking into account the overall state of an application occupying multiple computers.</p></abstract><description mxw-id="PDES98404557" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><u>Field of the Invention</u></heading><p id="p0001" num="0001">The present application relates to energy-aware resource management in a distributed computer system, such as a high-performance computer system (HPC system).</p><heading id="h0002"><u>Background of the Invention</u></heading><p id="p0002" num="0002">The invention addresses energy consumption in computer systems, for example the amount of energy consumed by programs running on large-scale computer clusters, particularly high performance computing (HPC) systems. HPC clusters consist of a large number of quasi-independent computers (nodes) that are coupled together and may be used to execute one large, monolithic application. Applications (or other jobs) are split into a number of communicating tasks; a Resource Manager allocates these tasks to computers and can also manage the power configuration of the computer hardware to reduce the energy consumed.</p><p id="p0003" num="0003">The Resource Manager is responsible for the efficient running of the HPC system, making sure that resources, including nodes and any other resources, deliver a service to requirements. The over-riding service requirement is generally to complete the application as fast as possible but, since the nodes may be high-end computers and use a lot of energy, a secondary requirement, whose importance is rising, is to use as little energy as possible. The compute nodes have a variety of mechanisms that can be used to reduce the energy consumption, but these usually come at the cost of computational performance. Thus, each node will in general have a plurality of possible operating modes or "power configurations" which differ in their respective performance and energy usage.</p><p id="p0004" num="0004">The programs executed in High Performance Computing (HPC) have a number of features that distinguish HPC from other forms of large-scale computing, such as web-scale computing. One of these is that a HPC program can be thought of as one<!-- EPO <DP n="2"> --> computation distributed across a large number of separate computers (in contrast, web-scale programs are, essentially, a large number of independent computations executed simultaneously on the separate computers). As any computation proceeds through the program phases or stages, the demands on the resources that it uses change. In other words, the demands on the hardware vary according to the current "state" of the application, by which is meant not only the stage of completion of the application but also the type of operation demanded at that time. Typically, execution of a program proceeds through initialisation and iteration phases, repeating the same sections of code many times in the same execution, the resource demands being similar or identical at each repetition.</p><p id="p0005" num="0005">In web-scale computing, as the computations execute essentially independently, the changes in resource demand also occur independently with an averaging effect that results in the resource use pattern over the whole set of computers becoming fairly static. HPC programs, on the other hand, will show coordinated patterns of resource use change as the program changes to the same state simultaneously across all the occupied computers.</p><p id="p0006" num="0006">These differing patterns of resource use change impact the best design of Resource Managers. For web-scale programs, resource management decisions can be made local to the computers. However, for HPC-style programs resource management must occur at the global level in addition to local-level management.</p><p id="p0007" num="0007">Increases in the capability of the microprocessors that form the core of the computers result in increased energy use. However, modern microprocessor designs also have the ability to reduce power consumption when the highest performance is not required. This is achieved through a variety of techniques, such as voltage and frequency scaling or turning off unused sections of a microprocessor. The energy reduction decisions are made implemented locally in each computer, responding to the observed conditions of the code currently operating on the computer. Different computers may be in different energy and performance configurations (power configurations).<!-- EPO <DP n="3"> --></p><p id="p0008" num="0008">Performance and energy management therefore happens at two levels in HPC systems: across a program spanning multiple computers and locally to each computer. These management decisions operate at different timescales. Local management is fast, responding to short time changes. Global management time scales are longer as they are determined by the time that it takes to communicate information from the individual computers to the centralised Resource Manager program, by the time taken to process the gathered data to make a management decision, and by the time taken to distribute that decision to the computers.</p><p id="p0009" num="0009">Changing power configurations takes time, and poor coordination of power configuration changes across computers can have adverse effects on the performance of a HPC program so it is often the case that local power management is turned off or operated very conservatively, ensuring acceptable performance but missing many opportunities for energy savings. On the other hand, centralised management will not be distributed quickly enough to exploit all energy saving opportunities.</p><p id="p0010" num="0010">When distributing an HPC application over the nodes, each portion of the application is decoupled as much as possible from the other portions, although some communication between the nodes is always necessary. Communication leads to the nodes having to coordinate their execution as they wait for the arrival of messages from other nodes. The degree of coordination varies with application and algorithm type, but there are usually many times during an application's execution where nodes will wait for the completion of computations on other nodes. A number of these waits for coordination require global communications (i.e. across all nodes allocated to the application) and so any delays to the execution by one node will cause the whole application to wait for the slowest node to catch up - referred to as a global coordination barrier or simply "global barrier".</p><p id="p0011" num="0011">To illustrate this, <figref idrefs="f0001">Figure 1</figref> shows execution phases of a simple program executing on four nodes A to D, with time represented by the length along the horizontal bars. The program has four phases, execute, wait, execute and wait. The wait dependencies are shown as arrows between the nodes. The first wait phase<!-- EPO <DP n="4"> --> models a local coordination barrier since the nodes only communicate in pairs that is, A with B and C with D. The second wait models a global barrier; every node waits on all the other nodes before completion. This is labelled "Global Wait" in the Figure to indicate that all nodes (in general) must wait here. A node which is in the waiting phase may be said to have "entered" the barrier at a certain timing represented by the start of the wait phase.</p><p id="p0012" num="0012">As there are imbalances in the loads and run times over the computers, individual computers will reach the barrier at different times with the result that some computers will wait at the global barrier for other computers to catch up. As the waiting computers are not calculating, they can be placed into a low energy power configuration, with no effect on performance, until all computers are at the global barrier. However, late arrivals at the global barrier should remain in a high power/fast performance power configuration, since the time taken to achieve the configuration changes will slow the program's performance. This decision cannot be made locally as each computer does not know where it is in the arrival queue; therefore the decision must be made centrally, but as fast as possible to save as much energy as possible.</p><p id="p0013" num="0013">The time scales at the centralised management area (Resource Manager) are much longer than the local time scales. This is due to the time taken to receive enough messages to make effective decisions and time to process the messages, more particularly the time taken to execute optimisation algorithms scaling with computer count and the time to access parts of data structures. As the number of computers in a cluster scales to 100,000 to 1,000,000, the time taken for any central management will become longer too.</p><p id="p0014" num="0014">The problem to solve is to make and distribute central decisions fast enough with large numbers of participating computers to exploit short-lived opportunities for energy savings during a computation.</p><p id="p0015" num="0015">Many Resource Managers expose the ability to set the energy saving mode of a job to the user of the HPC cluster. This capability is not well used since the users are<!-- EPO <DP n="5"> --> not motivated to save energy (by, for example, being charged for energy used in addition to other resources used). Also, the users will not want to reduce the execution performance of their applications (i.e. they twant to minimise the time to solution). Therefore, Resource Managers need to automatically apply energy saving modes where it can be guaranteed that performance will not be affected.</p><p id="p0016" num="0016">Similarly, the local operating systems have the ability to directly set the power configuration of their underlying hardware. This ability present in the hardware is exposed on most operating systems present on HPC clusters. Use of this capability is generally limited, i.e. it is usually turned off, since the locally determined changes to execution rate have unpredictable effects on the computation rate of a distributed application, which can accumulate across the computers to yield large overall delays in execution.</p><p id="p0017" num="0017">The state of the art in "energy-aware" Resource Managers is represented by US patent applications <patcit id="pcit0001" dnum="US20120216205A"><text>US 20120216205</text></patcit> and <patcit id="pcit0002" dnum="US20090100437A"><text>US 20090100437</text></patcit>. These describe a Resource Manager with a database of the performance characteristics of previously submitted jobs and a computational model of the effect of placing a cluster into energy saving mode on a job with the given performance characteristics. If the Resource Manager can identify a job as being the same as one previously submitted, it uses the recorded characteristics to compute the best energy configuration that does not impact performance.</p><p id="p0018" num="0018">A problem not addressed in the prior art is that the optimal configuration for energy efficiency changes during an application's execution, often with high frequency. Setting a single configuration for the duration of an application is always a compromise, losing some performance and not achieving highest energy efficiency.</p><p id="p0019" num="0019">It has been proposed to distribute responsibility for management through a hierarchy of resource managers (e.g. <patcit id="pcit0003" dnum="CN103268261"><text>CN103268261</text></patcit> and Argo, http://www.mcs.anl.gov/project/argo-exascale-operating-system). Distributing the computation and data collection load amongst a number of smaller components reduces the individual computation burden and so increases responsiveness.<!-- EPO <DP n="6"> --> However, as each of the sub-managers only receives data from a limited subset of computers, it cannot ensure the optimal behaviour of the whole system.</p><p id="p0020" num="0020">Therefore, it is desirable to provide energy-aware management of a distributed computer system which avoids the above problems.</p><heading id="h0003"><u>Summary of the Invention</u></heading><p id="p0021" num="0021">According to an embodiment of one aspect of the invention there is provided a method of executing an application on a distributed computer system, the distributed computer system including a Resource Manager and a plurality of computers to which the application is allocated and each operable in one of a plurality of power configurations, the method comprising:
<ul><li>providing a Resource Manager Proxy in each computer of the distributed computer system;</li><li>each Resource Manager Proxy notifying the Resource Manager of a change in execution state of the application in the computer in which said Resource Manager Proxy is provided;</li><li>the Resource Manager, in response to the notifying, determining a power configuration for at least one said computer;</li><li>the Resource Manager informing the power configuration to the Resource Manager Proxy of said at least one computer; and</li><li>the Resource Manager Proxy causing a change of power configuration of the computer based on the informing.</li></ul></p><p id="p0022" num="0022">Although Resource Managers as such are known in the art, the Resource Manager Proxy is newly-provided in the present invention. The Resource Manager Proxy is a kind of local agent for the Resource Manager, in each computer. The Resource Manager Proxy need not implement the power configuration directly but may for example communicate with the computer's own OS to effect the change.</p><p id="p0023" num="0023">The Resource Manager Proxy monitors code being executed by its own computer, in order to detect changes in execution state. Preferably, the notifying further comprises the Resource Manager Proxy identifying messages, generated from annotations in<!-- EPO <DP n="7"> --> code of the application allocated to the computer, indicative of the execution state (or changes thereof).</p><p id="p0024" num="0024">The Resource Manager informs the Resource Manager Proxy of the power configuration, for example, by making a recommendation of a new power configuration for the computer to use. In response, the Resource Manager Proxy may decide whether or not to change the power configuration of the computer by taking account of an existing power configuration of the computer. Thus, for example, if the power configuration recommended in the informing step is the same as the current configuration, no change is necessary.</p><p id="p0025" num="0025">The Resource Manager Proxy may confirm a change of power configuration of the computer, by sending a message to the Resource Manager. Alternatively, the Resource Manager Proxy may inform the Resource Manager if the recommended power configuration is not implemented for any reason.</p><p id="p0026" num="0026">Preferably the power configurations include at least one high-power and at least one low power configuration, and the determining further comprises the Resource Manager identifying that a plurality of the computers have entered a wait state, and determining a low-power configuration for those computers.</p><p id="p0027" num="0027">Here, the wait state may be a "global wait" (due to a global barrier) affecting all the computers to which the application is allocated. Alternatively it could be a "local wait" affecting some of the computers but not others.</p><p id="p0028" num="0028">In either case, the method may further comprise:
<ul><li>the Resource Manager monitoring which of the computers have entered the wait state;</li><li>the Resource Manager determining a transition time at which to prepare computers to leave the wait state;</li><li>the Resource Manager, prior to the transition time, informing a notifying Resource Manager Proxy of a low-power configuration; and after the transition time,<!-- EPO <DP n="8"> --> recommending a high-power configuration to the Resource Manager Proxy of each computer which has entered the wait state.</li></ul></p><p id="p0029" num="0029">The "transition time" here may depend on how many computers have already entered the wait state (or in other words, reached the barrier), and/or the time elapsed since the first computer to reach the barrier began waiting.</p><p id="p0030" num="0030">In any case, the method may further comprise, in the determining and informing steps, the Resource Manager first determining and informing a provisional recommendation of power configuration for at least one computer and subsequently updating the recommendation and informing the Resource Manager Proxy of the updated power configuration.</p><p id="p0031" num="0031">In some instances, the power configuration determined by the Resource Manager will apply to all the computers, in which case the above mentioned notifying step comprises broadcasting the power configuration to all the Resource Manager Proxies.</p><p id="p0032" num="0032">Furthermore, the Resource Manager may pre-emptively broadcast a power configuration to all the Resource Manager Proxies before the notifying step. In other words the Resource Manager need not wait to receive reports from the Resource Manager Proxies prior to providing a recommendation for a power configuration.</p><p id="p0033" num="0033">Preferably, the Resource Manager is provided by at least one computer separate from the computers to which the application is allocated.</p><p id="p0034" num="0034">The Resource Manager may be provided in distributed form with a plurality of Resource Managers each responsible for a respective subset of the computers to which the application is allocated and connected by a communications framework.</p><p id="p0035" num="0035">According to a second aspect of the present invention, there is provided a Resource Manager for managing a plurality of computers in a distributed computer system to execute an application, each of the computers operable in one of a plurality of power configurations, the Resource Manager comprising:<!-- EPO <DP n="9"> -->
<ul><li>a communications module for exchanging messages with a Resource Manager Proxy in each computer of the distributed computer system;</li><li>a state monitor responsive to notifications from Resource Manager Proxies of changes in execution state of the application, to determine a state of at least one said computer; and</li><li>a power configurer responsive to the state determined by the state monitor to determine a power configuration for at least one said computer;</li><li>the communications module arranged to inform the determined power configuration to the Resource Manager Proxy of said at least one computer.</li></ul></p><p id="p0036" num="0036">A third aspect of the present invention provides a high-performance computer system comprising a plurality of computers each equipped with a Resource Manager Proxy as defined above and a Resource Manager as described above.</p><p id="p0037" num="0037">According to a further aspect of the present invention, there is provided software comprising computer-readable code which, when executed by a computer of a distributed computer system, provides a Resource Manager Proxy comprising:
<ul><li>a code reader for reading indications, contained in program code allocated to the computer, of a change in execution state of the program code;</li><li>a communications module for forwarding the indications to a Resource Manager of the distributed computer system and receiving, from the Resource Manager, a power configuration recommendation for the computer;</li><li>a power manager for causing a change of power configuration of the computer based on the recommendation from the Resource Manager.</li></ul></p><p id="p0038" num="0038">It should be emphasised here that the "computer" is not only acting as the Resource Manager Proxy but also executes part of the application, namely the above mentioned "program code allocated to the computer".</p><p id="p0039" num="0039">A still further aspect relates to software for providing the above mentioned Resource Manager.<!-- EPO <DP n="10"> --></p><p id="p0040" num="0040">Such software may be stored on one or more non-transitive computer-readable recording media.</p><p id="p0041" num="0041">Thus, embodiments of the present invention provide a novel architecture for energy aware HPC resource managers. The design minimises loads on computational nodes, while guaranteeing fast enough responses to enable exploitation of short-lived states that can be exploited to save energy. The Resource Manager is preferably provided by a computer which is not itself one of the computational nodes. An alternative implementation is as a group of communicating resource manager peers, distributing load for responsiveness with corrections through background and backchannel communications.</p><p id="p0042" num="0042">Embodiments may reduce the amount of energy used in, particularly, but not exclusively, high performance computing systems by enabling fine grained, responsive control of the power configuration of the individual computers in a HPC cluster taking into account the overall state of an application occupying multiple computers. Such fine-grained control is not available in current systems due to an unresolved tension between knowledge of the global program state and fast local state changes, with the result that many energy saving opportunities are missed.</p><p id="p0043" num="0043">In this specification, a "power configuration" refers to one or more settings of a computer in a distributed computer system which implies both a certain performance level and a certain energy usage level. The "state" of a program, with respect to a given computer, refers to the part of the application code currently being executed by the computer under consideration, and the kind of operations (such as "compute", "wait" or "move data") instructed by that part of the code. The terms "node", "server", and "computer" are used interchangeably unless the context demands otherwise. Likewise, the terms "system" and "cluster" are equivalent. The terms "application", "program" and "job" are also interchangeable unless the context demands otherwise.</p><heading id="h0004"><u>Brief Description of the Drawings</u></heading><p id="p0044" num="0044">Reference is made, by way of example only, to the accompanying drawings in which:<!-- EPO <DP n="11"> -->
<ul><li><figref idrefs="f0001">Figure 1</figref> shows an execution timeline of an application apportioned among a plurality of nodes;</li><li><figref idrefs="f0001">Figure 2</figref> shows a computer system (HPC cluster) to which an embodiment of the present invention is applied;</li><li><figref idrefs="f0002">Figure 3</figref> shows functional blocks within one computer of the <figref idrefs="f0001">Figure 2</figref> system;</li><li><figref idrefs="f0003">Figure 4</figref> shows functional modules of a Resource Manager Proxy of the <figref idrefs="f0001">Figure 2</figref> system;</li><li><figref idrefs="f0003">Figure 5</figref> shows functional modules of a Resource Manager of the <figref idrefs="f0001">Figure 2</figref> system;</li><li><figref idrefs="f0004">Figure 6</figref> shows the process flow in a Resource Manager, in one method embodying the present invention;</li><li><figref idrefs="f0005">Figure 7</figref> shows a modified version of the process flow in <figref idrefs="f0004">Figure 6</figref>;</li><li><figref idrefs="f0006">Figure 8</figref> shows a process flow within a Resource Manager Proxy; and</li><li><figref idrefs="f0007">Figure 9</figref> shows another embodiment, in which the Resource Manager is distributed.</li></ul></p><heading id="h0005"><u>Detailed Description</u></heading><p id="p0045" num="0045">Embodiments of the present invention will now be described with reference to <figref idrefs="f0001 f0002 f0003 f0004 f0005 f0006 f0007">Figures 2 to 9</figref>.</p><p id="p0046" num="0046"><figref idrefs="f0001">Figure 2</figref> shows a distributed computer system 100 in one embodiment of the invention. A Resource Manager 200 controls the power configuration of a large number of computers 101 in a HPC cluster 100. The computers 101 constitute computational nodes (or "compute nodes") of an HPC program. Although <figref idrefs="f0001">Figure 2</figref> shows eight computers, high-end HPC clusters will run HPC programs that use resources from many thousands to hundreds of thousands of computers. Each of the computers is assumed to be operable in any one of a plurality of power configurations, including a highest-power, higher-performance configuration and one or more energy-saving, reduced performance modes.</p><p id="p0047" num="0047">Each computer runs three programs that are relevant to this invention; these programs are independent of each other. The programs are a Resource Manager Proxy 201, the local Operating System 103 and the local part of the HPC application 104.<!-- EPO <DP n="12"> --></p><p id="p0048" num="0048">In this embodiment, the Resource Manager 200 is executed on another computer that is part of the HPC cluster 100, but does not execute any portion of the application that it is managing. Thus, although the resource manager itself is a computer program that uses computer resources, separate resources are provided for this purpose to avoid interfering with the execution of the HPC program and slowing down the performance of the overall HPC application.</p><p id="p0049" num="0049">The Resource Manager Proxy 201 is a very lightweight program (in other words, very low in resource usage of its host computer) that represents the Resource Manager 200 on each local computer 101. That is, the Resource Manager Proxy is a local manager which assists the centralised Resource Manager. There is one Resource Manager Proxy per computer 101 taking part in the execution of the application. Its light weight means that interference with the local part of the HPC application will be small. The Resource Manager Proxy 201 is new in the present invention and methods are proposed whereby it can be kept lightweight.</p><p id="p0050" num="0050">The local Operating System is the interface to manage the power configuration of the computer hardware.</p><p id="p0051" num="0051">The local HPC program 104 is the part of the HPC application that executes on the computer. Note that the control flow of the local HPC program executes independently of the flow of all the other local HPC programs. Coordination of the HPC application is achieved through message passing between the local HPC programs.</p><p id="p0052" num="0052">The invention proposes an additional pattern of message passing; in <figref idrefs="f0001">Figure 2</figref>, these messages pass between the Resource Manager and each computer, for example as indicated at 105.</p><p id="p0053" num="0053"><figref idrefs="f0002">Figure 3</figref> shows a single computer from <figref idrefs="f0001">Figure 2</figref> in more detail. The same structure is applied to every computer that is executing part of the HPC application. All communication with the Resource Manager 200 is through the Resource Manager Proxy 201; this communication is bi-directional as indicated at 202. The Resource Manager Proxy sends the Resource Manager information about changes to the local<!-- EPO <DP n="13"> --> HPC program's state (see below) and receives suggestions from the Resource Manager for the best power configuration of the hardware (given the state of the local HPC program and the state of the overall HPC application). The Resource Manager Proxy interacts with the Local Operating System 203 to set the power configuration. Communication between the local HPC program and the Resource Manager proxy is one way - as shown by 204, the local HPC program sends only - and for example comprises short messages indicating a state change.</p><p id="p0054" num="0054">HPC programs using this invention are required to be able to report their state to their local Resource Manager Proxy, using function calls which are added to the HPC program for reporting purposes. These calls should indicate entry to and exit from sections of code that have characteristics that can be exploited for energy savings.</p><p id="p0055" num="0055">Examples of such code sections include:
<ul><li><sup>*</sup> Compute intensive sections, that should run at the maximum speed possible</li><li><sup>*</sup> Wait sections, for example waiting for communications to complete or a barrier to be reached where it may be possible to run at reduced power consumption</li><li><sup>*</sup> Local data movement sections (e.g. transferring data to disk) where it may be possible to run at reduced power consumption</li></ul></p><p id="p0056" num="0056">It will be apparent that each of the above kinds of section corresponds to a different program "state". The resource demands on a computer which currently is executing a compute-intensive section of code will be much greater than in a wait section for example, so these different states can be distinguished for the purpose of setting the power configuration of the computer.</p><p id="p0057" num="0057">These sections will require suitable mark up in the HPC application code, following the pattern of, say, the OpenMP API for shared memory multiprocessing programming. The purpose of this is to annotate the program code to identify distinct code parts corresponding to different program states such as execute, communicate, wait, etc. In the current state of programming technology, the mark-up would normally need to be performed by a human programmer, although an automated technique might also be<!-- EPO <DP n="14"> --> possible. An example of such annotated code follows, where the statements starting "#pragma amee" are those intended as messages for the Resource Manager:
<pre listing-type="program-listing"> #pragma amee neighbour_communicate
           std::vector&lt;MPI_Request&gt; reqs; MPI_Request r;
           /* Do all my sends and receives */
           if (rank+1&lt;size) {
                 MPI Isend(...;
                 MPI_Irecv(...;
           }
           if (rank-1&gt;=0} {
                 MPI_Isend{...
                 MPI_Irecv(...;
           }
 #pragma amee global_wait
           MPI_Waitall{...
 #pragma amee computing
 #pragma omp parallel for private(i)
           for (j=1 ;j&lt;ht-1 ;j++) { // this is MPI level
                 for (i=1 ;i&lt;wid-1 ;i++) {
                      dest{i,j} = physics(src,i,j);
                 }
           }
           std::swap(src,dest);</pre><!-- EPO <DP n="15"> --></p><p id="p0058" num="0058">Here, the annotations (notifications) intended for the Resource Manager Proxy are converted in a similar way to communication calls, using conventional techniques for analysing annotations and converting them to calls at compile time. Thus, the Resource Manager Proxy may receive a notification each time the program execution in the relevant computer reaches one of the statements exemplified above.</p><p id="p0059" num="0059">It should be noted that in the architecture of <figref idrefs="f0001">Figures 2</figref> and <figref idrefs="f0002">3</figref> the communication is local to the computer. This means that it is possible to exploit lightweight and fast communication methods supplied by the local operating system (for example, standard Unix Interprocess Communication (IPC) techniques such as message queues or shared memory segments) rather than the across cluster communication used for messaging within the HPC application.</p><p id="p0060" num="0060"><figref idrefs="f0003">Figure 4</figref> illustrates functional modules of a Resource Manager Proxy, including a code reader 207 for receiving the statements mentioned above which are indicative of a change in execution state of the application in the computer; a communications module 205 for notifying a Resource Manager 200 of the distributed computer system of the change in execution state and receiving, from the Resource Manager, a power configuration recommendation; and a power manager 209 for initiating a change of power configuration of the computer 101 based on the recommendation from the Resource Manager.</p><p id="p0061" num="0061">The Resource Manager Proxy 201 is a lightweight program, as it executes on the same computer as the local HPC program and should not compete for resource with that. The code reader 207 detects the above mentioned annotations as messages embedded in the program code, which indicate changes in the section of code currently being executed and thus, the execution state. The code reader may be programmed to react to messages generated as the result of such annotations, for example the above mentioned "#pragma amee" annotations, without having to decode or understand those messages. The communications module 205 relays these messages from the HPC program to the Resource Manager. Messages from the communications module will contain, in addition to the information content or "payload", an identification of the originating computer. The payload itself may simply reproduce the above mentioned<!-- EPO <DP n="16"> --> message generated from the annotation, or may provide it in some processed form. The communications module 205 also receives from the Resource Manager a request or recommendation for a power configuration change. Then, the power manager 209 implements the power change (if appropriate) by sending an instruction to the local operating system 203, which can be assumed to be ultimately responsible for power management of the computer. In this case (for example, the interaction between Resource Manager 200 and communications module 205), communication is across the computers in the HPC cluster. However, HPC clusters have efficient communications networks and standardised APls to access them and so the Resource Manager Proxy to Resource Manager communication can use these: an example is the Message Passing Interface API.</p><p id="p0062" num="0062">The Resource Manager Proxy 201 needs little intelligence, being mostly concerned with receiving and sending messages and implementing power configuration changes; however, it may perform some simple processing. For example, even though, as described below, the Resource Manager will attempt to respond quickly, it may be that the local program state has changed before the Resource Manager request is received. The Resource Manager Proxy may choose to ignore the requested power configuration if the current local HPC program state is incompatible with the requested power configuration.</p><p id="p0063" num="0063"><figref idrefs="f0003">Figure 5</figref> illustrates functional modules of a Resource Manager 200 which are of relevance to the present invention (it is not excluded that other functional modules are present, such as a scheduler for initially apportioning program code to each computer; however, this is outside the scope of the invention).</p><p id="p0064" num="0064">In the Resource Manager 200, a communications module 210 receives messages from all the computers allocated to the application, via the respective Resource Manager Proxies. For the purposes of the present explanation, the only communication between the Resource Manager 200 and computers 101 is via the Resource Manager Proxies 201. However, it would be possible for the Resource Manager to receive inputs from other sources too, since the Resource Manager will generally manage<!-- EPO <DP n="17"> --> other aspects of the HPC system in addition to the computers 101. For example, the Resource Manager may receive information on entry to and exit from library functions.</p><p id="p0065" num="0065">A state monitor 212 monitors these messages to assess the overall state of the HPC program and to detect opportunities for energy savings. The state monitor is aware of all the computers involved in the HPC cluster and can distinguish incoming messages based on the identifier of the originating computer. Based on the overall state as monitored by the state monitor 212, a power configurer 214 exploits an opportunity for saving energy by switching one or more of the computers to an energy-saving mode, and sends a message to the communications module 210 to instruct the Resource Manager Proxies accordingly. A message intended for a specific computer (as opposed to a broadcast message - see below) will include an identification of the destination computer, allowing the message to be routed over the message passing infrastructure. The communications module may receive a return message from the Resource Manager Proxies, such as a confirmation that the recommended power configuration has been adopted (or alternatively that it has been ignored - see above).</p><p id="p0066" num="0066">A variety of processing techniques can be used to detect these opportunities, including looking up a database of heuristic actions for the type of code being executed, and using data from previous iterations to estimate the likely program evolution and so compute the optimal strategy (by pattern matching, generic algorithms etc.). However, the number of messages and consequent processing required to derive a power configuration means that it may take a long time to compute the optimal new power configuration for the reporting computer. Preferably, therefore, the power configurer 214 makes a provisional recommendation based on incomplete processing of the information i.e. a power configuration that may be wrong or sub optimal. In parallel with this recommendation being communicated via the communications module 210, the power configurer 214 will compute the optimal power configuration and, at some point in the future may update its recommendation.</p><p id="p0067" num="0067">Before considering how to identify energy-saving opportunities, it may be observed that HPC applications generally have the following properties.<!-- EPO <DP n="18"> -->
<ol><li>(i) Applications are distributed over a large number of nodes which can be controlled (at least with respect to power settings) individually.</li><li>(ii) The nodes execute their respective portions of the application independently, but all non-trivial applications require communication between nodes and so have points where progress is dependent on partner nodes reaching a mutual coordination point (a barrier).</li><li>(iii) Applications typically consist of a number of initialisation and iteration phases, each initialisation phase being followed by an iteration phase. The initialisation phases may be relatively short in comparison with the total execution time.</li><li>(iv) The rate of progress through a computation can vary from node to node, due for example, to imbalances in the load on a node, interference from other code executing on the node and differing node capabilities. This results in some nodes waiting for other nodes at barriers.</li></ol></p><p id="p0068" num="0068">Thus, one energy-saving opportunity arises where nodes are waiting at a global barrier. A typical HPC application can be expected to have a plurality of similar global barriers owing to the repetition of iterative phases mentioned earlier. Computers reaching this barrier earliest will be instructed to move to a low power configuration, but at some point when almost all of the computers have reached the barrier, the optimal strategy is to leave the late arrivals in a high power configuration and to start to move the others to the high power configuration. The Resource Manager learns the optimal transition time (time elapsed from the first entry of any computer into the barrier) to do this changeover by watching many instances of the barrier within the same execution of the HPC program, which requires a lot of processing and so uses possibly out of date information.</p><p id="p0069" num="0069"><figref idrefs="f0004">Figure 6</figref> shows the flow of logic for the above case in the Resource Manager. The Resource Manager keeps a record of each computer's state, i.e. the stage of execution which it has reached. The Resource Manager waits for messages at step 300, and processing starts at 301 when a message is received from a Resource<!-- EPO <DP n="19"> --> Manager Proxy. The Resource Manager identifies the computer from which the message was received as the Nth computer to have reached the global barrier, and updates the recorded state for that computer. At step 302, the Resource Manager determines that the transition time has been reached in which to perform the changeover referred to above. Such determination can be based on the number N (that is, the count of how many computers have reached the barrier), the time elapsed at the barrier, or preferably both. The Resource Manager immediately checks the state of arrivals at this barrier and sets a reply to the Nth computer with the recommended power configuration (steps 302, 303, 304).</p><p id="p0070" num="0070">Processing then splits at step 305 into two concurrent threads. A first thread is a high-priority waiting for new messages, with the flow returning to step 300. A second thread involves, low priority further (background) processing of the message, which firstly may change the power configurations of previously reporting computers if necessary (step 306). A change to power configurations of previously reporting computers 1 to N-1 will be necessary if the current power state of those computers is different from the current recommendation as determined in step 307. The second thread further involves processing to update and optimise the Resource Manager's responses for this barrier in step 307, which may result (step 308) in setting a new value for the transition time from recommending low to recommending high power configurations at 305. This new value of the transition time would be applied to future instances of the same (or corresponding) barrier during the program execution.</p><p id="p0071" num="0071">The technical focus of this invention is to distribute optimal configurations that take account of the global situation to local computers fast enough so that they can act on them to save energy. The discussion above considered point to point "duplex" communications. However, once a change of recommended configuration has been made, it often applies to all the computers taking part in the computation. This means that it is optimal to reset previous configurations (e.g. step 306). It also means that it would be optimal to send this current recommended configuration to all computers to allow a configuration change to be applied locally before a communications step from proxy to Resource Manager, thus speeding up the response to a change of power configuration.<!-- EPO <DP n="20"> --></p><p id="p0072" num="0072"><figref idrefs="f0005">Figure 7</figref> shows this variant protocol, which now include a pre-emptive and post-emptive broadcast of recommended configurations, where a "broadcast" refers to a message sent to all Resource Manager Proxies, not only to one Resource Manager Proxy as discussed previously. A broadcast message would be received by a Resource Manager Proxy in the same way as a targeted, point-to-point message, but the Resource Manager Proxies would need to be prepared to receive such broadcasts at any time, not only when awaiting a response from a report to the Resource Manager.</p><p id="p0073" num="0073">In an initial step 400, the Resource Manager waits for incoming messages from computers. In step 401, a message arrives from the Nth computer to reach the subject state. The message is processed in high priority to determine the optimal configuration for this Nth computer (steps 402, 403, 404). Processing splits into a high priority thread that sets the optimal configuration of the Nth computer and then waits for further incoming messages. If there is a change in the recommended configuration for the subject state (stage of execution), the low priority thread broadcasts this change to all participating computers (see step 406, namely to those computers that have already reported that they are in the subject state and those that are yet to report). The Resource Manager then performs the processing in steps 407 and 408 to update the view of the global application state. It will be noted that steps 405 and 406 will not necessarily always occur, step 405 only being required if the Nth computer does not already know (through a broadcast message) the recommended power configuration, and step 406 only being necessary if the recommended power configuration changes.</p><p id="p0074" num="0074"><figref idrefs="f0006">Figure 8</figref> shows the control flow within a Resource Manager Proxy 201. At first, in step 500, the proxy waits for messages from either its local program (part of the HPC application) or from the Resource Manager. At step 501, a message from the local program indicates a local change of program state. In step 502, the proxy may already have received a recommendation for this state as part of the broadcast step 406. If so, in step 503 it applies that configuration to the local hardware. Once the recommendation has been applied, step 504 relays a message to the Resource Manager. The Resource Manager response recommendation may change from that<!-- EPO <DP n="21"> --> held by the proxy, if so the new configuration is applied to the local hardware in step 505; the response recommendation is also applied here for the case where it is a new recommendation. The Resource Manager Proxy then returns to the wait state (step 500).</p><p id="p0075" num="0075">In step 506, a message from the Resource Manager may apply to any of the possible program states. The proxy records the recommendation and if it applies to the current program state (step 507, Yes) applies it to the hardware in step 505, otherwise it returns to the wait state.</p><p id="p0076" num="0076">The messages passed between the Resource Manager and the Resource Manager Proxy need to uniquely identify the point in the code where the state change occurs. As already mentioned, HPC code is commonly iterative, repeating code sections frequently with different data, this means that the messages also need to identify which pass through the code applies. So the payload of a message passed either way, or broadcast, will contain at least two values: the code part identifier and the pass identifier. A code part may be defined as the section of the program between two of the annotations referred to earlier, or equivalently, the annotations themselves can form labels for the code parts.</p><p id="p0077" num="0077">A further embodiment of this invention replaces the single Resource Manager with a group of Resource Managers, each Resource Manager being responsible for a subset of the computers allocated to the application. The relationship between the Resource Managers is flat, all Resource Managers are peers and there is no hierarchy. Protocols and interactions between the Resource Managers and their proxies remain as described above, but there is additional communication between the component Resource Managers as they negotiate a global view of the application.</p><p id="p0078" num="0078">Resource Managers need to share information to obtain a view of the best actions to take when there are global operations in the application. For example, in optimising a global wait, all the Resource Managers should be aware of the total time that the application spends in a wait state, i.e. the length of time between the first computer entering the wait state, and the last exiting it. Since HPC applications are iterative with<!-- EPO <DP n="22"> --> regular patterns, a decision based on previous iterations will be fairly accurate. This means that distributed Resource Managers control their client computers with optimisations determined from data from previous iterations. In the background they can update their optimisations, ready for the next iteration of the particular state change. This can be done by background interactions between the Resource Managers.</p><p id="p0079" num="0079"><figref idrefs="f0007">Figure 9</figref> shows this embodiment. The computers 101 are the same as those in <figref idrefs="f0001">Figure 2</figref> with the same internal arrangements. They communicate to Resource Managers in the same manner, i.e. via their Resource Manager Proxy. Now there is more than one instance 200a, 200b, ... 200e of a Resource Manager and there is an intra-Resource Manager communications framework 220, which may simply be a software construct on top of the communications hardware which already exists, similar to the communications between the Resource Manager(s) and Resource Manager Proxies.</p><p id="p0080" num="0080">Distributed Resource Managers will have difficulty maintaining an accurate global count of computers in a particular state, so the technique used above of counting instances will be unsuitable. Instead the Resource Managers will need to make decisions based in the time spent in the target state. When the first computer allocated to a given Resource Manager enters a new state (such as reaching or leaving an instance of a global barrier), that Resource Manager broadcasts the fact to all other Resource Managers, and this can be used to create a global start time. Message traffic is reduced by otherwise transmitting consolidated reports of activity at regular intervals.</p><p id="p0081" num="0081">The advantage of this distributed peer-to-peer Resource Manager architecture arises from the distribution of load. Each Resource Manager deals with a proportion of the overall load, making the computation and the message processing burden lower - thus the Resource Managers can be more responsive. Additionally, the load on the communications network is reduced as there is no concentration of messages to and from all computers to a single processor.<!-- EPO <DP n="23"> --></p><p id="p0082" num="0082">The proportion of computers allocated to a Resource Manager can be decided in many ways. One way is to distribute the computers evenly to the Resource Managers, so that each Resource Manager deals with the same number of computers. It is also possible to distribute the computers to Resource Managers according to messaging load so that, on average each Resource Manager handles an equal number of messages.</p><p id="p0083" num="0083">To summarise the above, embodiments of the present invention provide a technique to actively manage an application to exploit very short-term opportunities for energy efficiency throughout execution. In a distributed computer system, a Resource Manager 200 is provided for managing a plurality of computers 101 to execute an application. Each of the computers is operable in one of a plurality of power configurations, including a high-power configuration and one or more low-power configurations. The Resource Manager 200 exchanges messages with a Resource Manager Proxy 201 in each computer of the distributed computer system. The application is annotated to report to the Resource Manager Proxy entry and exit to sections of code that affect energy use (code annotations for other purposes, such as exposing parallelism, are standard practice, but application to energy efficiency is new). The Resource Manager Proxy passes on these reports to the Resource Manager.</p><p id="p0084" num="0084">Responsive to notifications from Resource Manager Proxies of changes in execution state of the application, the Resource Manager determines a power configuration applicable for the computer of that Resource Manager Proxy, or for a set of computers (including possibly all the computers) executing the application. The Resource Manager 200 informs the determined power configuration to the Resource Manager Proxy 201 which then decides whether to implement a change. This reduces the amount of energy used in, particularly, but not exclusively, high performance computing systems by enabling fine grained, responsive control of the power configuration of the individual computers in a HPC cluster taking into account the overall state of an application occupying multiple computers.<!-- EPO <DP n="24"> --></p><p id="p0085" num="0085">The configurations sent to computers by the resource manager may be out of date (the emphasis is on replying quickly and correcting errors later). The Resource Manager can pre-emptively broadcast configurations, in addition to sending recommendations in response to the messages from the Resource Manager Proxies. The Resource Manager may be in a distributed form.</p><p id="p0086" num="0086">Various modifications are possible within the scope of the invention.</p><p id="p0087" num="0087">Although described in detail for the example of a global wait in which all computers enter a global barrier, the present invention can be applied also to local barriers involving only a subset of the computers in the distributed computer system. The present invention can also be applied to other state changes in execution of a program having an effect on resource demands, such as exiting a global or local barrier, entering or exiting a communications (IO) section of code, entering or exiting a compute section of code.</p><p id="p0088" num="0088">Another example would be to regularise the execution speed across the nodes executing an application. The Resource Manager can use the reports from the Proxies to determine which nodes are running faster than other nodes (from the timing of the reports of the end of a computation phase, or from their average time spent waiting fro other nodes in local waits) and slow the faster nodes to save energy, with the intention that the formerly faster nodes execute at similar speed to the slower nodes.</p><p id="p0089" num="0089">Alternatively, depending on the ratio of slow to fast nodes, the slow nodes could be placed into a higher power/execution rate mode so that the overall computation speeds up and the whole system uses less energy.</p><p id="p0090" num="0090">There are other bulk changes to program state that can be exploited in the same way as the global wait such as a large scale communications step where all the nodes send data to all the other nodes or a phase where all the nodes are writing data to disk.<!-- EPO <DP n="25"> --> Reference was made above to a plurality of power configurations of the computers. Although there may be many such configurations, at a minimum, only two are needed: a normal power configuration for computation and a low-power configuration.</p><p id="p0091" num="0091">It was assumed above that only the Resource Manager Proxy, under instruction from the Resource Manager, can change the power configuration of a computer. However, it would be possible to operate the computer's local power management system in conjunction with the Resource Manager Proxy, for example with a strategy of allowing local independence to switch to a high-power mode, whilst enforcing a decision by the Resource Manager to switch to a low-power mode.</p><p id="p0092" num="0092">The method steps referred to herein may be carried out in a different order from the order of definition and still produce favourable results.</p><p id="p0093" num="0093">The Resource Manager may be implemented in software, hardware, middleware, as an application specific integrated circuit (ASIC) or in any other form. The Resource Manager Proxy will normally be implemented in software.</p><heading id="h0006"><u>Industrial Applicability</u></heading><p id="p0094" num="0094">This invention allows the discovery and implementation of the most efficient configuration of the hardware for a particular application, one that achieves unchanged performance with the lowest power consumption, whilst the application is executing, thereby reducing energy consumption in high-performance computing without necessarily prolonging execution time.</p></description><claims mxw-id="PCLM90459496" lang="EN" load-source="patent-office"><!-- EPO <DP n="26"> --><claim id="c-en-0001" num="0001"><claim-text>A method of executing an application on a distributed computer system, the distributed computer system including a Resource Manager and a plurality of computers to which the application is allocated and each operable in one of a plurality of power configurations, the method comprising:
<claim-text>providing a Resource Manager Proxy in each computer of the distributed computer system;</claim-text>
<claim-text>each Resource Manager Proxy notifying the Resource Manager of a change in execution state of the application in the computer in which said Resource Manager Proxy is provided;</claim-text>
<claim-text>the Resource Manager, in response to the notifying, determining a power configuration for at least one said computer;</claim-text>
<claim-text>the Resource Manager informing the power configuration to the Resource Manager Proxy of said at least one computer; and</claim-text>
<claim-text>the Resource Manager Proxy causing a change of power configuration of the computer based on the informing.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1 wherein the notifying further comprises the Resource Manager Proxy identifying messages, generated from annotations in code of the application allocated to the computer, indicative of the execution state.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 1 or 2 further comprising the Resource Manager Proxy deciding whether or not to change the power configuration of the computer by taking account of an existing power configuration of the computer.</claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to any preceding claim further comprising the Resource Manager Proxy confirming a change of power configuration of the computer to the Resource Manager.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to any preceding claim wherein the power configurations include at least one high-power and at least one low power configuration, and the determining further comprises the Resource Manager identifying that a plurality of the<!-- EPO <DP n="27"> --> computers have entered a wait state, and determining for those computers a said low-power configuration.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>The method according to claim 5 wherein the wait state is a global wait affecting all the computers to which the application is allocated.</claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The method according to claim 5 or 6 further comprising:
<claim-text>the Resource Manager monitoring which of the computers have entered the wait state;</claim-text>
<claim-text>the Resource Manager determining a transition time at which to prepare computers to leave the wait state;</claim-text>
<claim-text>the Resource Manager, prior to the transition time, informing a notifying Resource Manager Proxy of a said low-power configuration; and after the transition time, informing the Resource Manager Proxy of each computer which has entered the wait state of a said high-power configuration.</claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The method according to any preceding claim further comprising, in the determining and informing steps, the Resource Manager first determining and informing a provisional recommendation of power configuration for at least one computer and subsequently updating the recommendation and informing the Resource Manager Proxy of the updated power configuration.</claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The method according to any of claims 1 to 4 wherein the power configuration determined by the Resource Manager applies to all the computers, the notifying comprising broadcasting the power configuration to all the Resource Manager Proxies.</claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>The method according to any preceding claim further comprising the Resource Manager pre-emptively broadcasting a power configuration to all the Resource Manager Proxies before said notifying.<!-- EPO <DP n="28"> --></claim-text></claim><claim id="c-en-0011" num="0011"><claim-text>The method according to any preceding claim wherein the Resource Manager is provided by at least one computer separate from the computers to which the application is allocated.</claim-text></claim><claim id="c-en-0012" num="0012"><claim-text>The method according to any preceding claim wherein the Resource Manager is in distributed form with a plurality of Resource Managers each responsible for a respective subset of the computers to which the application is allocated and connected by a communications framework.</claim-text></claim><claim id="c-en-0013" num="0013"><claim-text>A Resource Manager for managing a plurality of computers in a distributed computer system to execute an application, each of the computers operable in one of a plurality of power configurations, the Resource Manager comprising:
<claim-text>a communications module for exchanging messages with a Resource Manager Proxy in each computer of the distributed computer system;</claim-text>
<claim-text>a state monitor responsive to notifications from Resource Manager Proxies of changes in execution state of the application, to determine a state of at least one said computer; and</claim-text>
<claim-text>a power configurer responsive to the state determined by the state monitor to determine a power configuration for at least one said computer;</claim-text>
<claim-text>the communications module arranged to inform the determined power configuration to the Resource Manager Proxy of said at least one computer.</claim-text></claim-text></claim><claim id="c-en-0014" num="0014"><claim-text>Computer-readable code which, when executed by a computer of a distributed computer system, provides a Resource Manager Proxy comprising<br/>
a code reader for reading indications, contained in program code allocated to the computer, of a change in execution state of the program code;<br/>
a communications module for forwarding the indications to a Resource Manager of the distributed computer system and receiving, from the Resource Manager, a power configuration recommendation for the computer;<br/>
a power manager for causing a change of power configuration of the computer based on the recommendation from the Resource Manager.</claim-text></claim><claim id="c-en-0015" num="0015"><claim-text>A high performance computing system comprising:<!-- EPO <DP n="29"> -->
<claim-text>a plurality of interconnected computers each equipped with the Resource Manager Proxy according to claim 14; and</claim-text>
<claim-text>the Resource Manager according to claim 13.</claim-text></claim-text></claim></claims><amended-claims mxw-id="PCLM90459495" lang="EN" load-source="patent-office" amended-claim-type="EPC"><heading id="h0007">Amended claims in accordance with Rule 137(2) EPC.</heading><claim id="ac-en-0001" num="0001"><claim-text>A method of executing a single monolithic application on a high-performance computer system (100), the computer system including a Resource Manager (200) and a plurality of computers (101) coupled together to execute the application and each operable in one of a plurality of power configurations, the method comprising:
<claim-text>allocating a respective portion of the application to each of the computers (101), each portion including code sections corresponding to different application states including a compute-intensive state, a data transfer state, and a wait state for coordination with other computers (101);</claim-text>
<claim-text>providing a Resource Manager Proxy (201) in each computer (101) of the high-performance computer system (100);</claim-text>
<claim-text>the Resource Manager Proxies (201) notifying the Resource Manager (200) of changes of application states in the computers(101);</claim-text>
<claim-text>the Resource Manager (200) assessing an overall state of the application in response to the notifying and, based on the overall state, determining a power configuration for an individual computer (101) of the high-performance computer system (100);</claim-text>
<claim-text>the Resource Manager (200) informing the determined power configuration to the Resource Manager Proxy (201) of the computer (101); and</claim-text>
<claim-text>the Resource Manager Proxy (201) causing a change of power configuration of the computer (101) based on the informing.</claim-text></claim-text></claim><claim id="ac-en-0002" num="0002"><claim-text>The method according to claim 1 wherein the notifying further comprises the Resource Manager Proxy (201) identifying messages, generated from annotations in the code sections of the portion of the application allocated to the computer (101), indicative of the application state.</claim-text></claim><claim id="ac-en-0003" num="0003"><claim-text>The method according to claim 1 or 2 further comprising the Resource Manager Proxy (201) deciding whether or not to change the power configuration of the computer (101) by taking account of an existing power configuration of the computer.</claim-text></claim><claim id="ac-en-0004" num="0004"><claim-text>The method according to any preceding claim further comprising the Resource Manager Proxy (201) confirming a change of power configuration of the computer (101) to the Resource Manager (200).</claim-text></claim><claim id="ac-en-0005" num="0005"><claim-text>The method according to any preceding claim wherein the power configurations include at least one high-power and at least one low power configuration, and the determining further comprises the Resource Manager (200) identifying that the application state in a plurality of the computers (101) has entered a wait state, and determining for those computers a said low-power configuration.</claim-text></claim><claim id="ac-en-0006" num="0006"><claim-text>The method according to claim 5 wherein the wait state is a global wait affecting all the computers (101) to which portions of the application are allocated.</claim-text></claim><claim id="ac-en-0007" num="0007"><claim-text>The method according to claim 5 or 6 further comprising:
<claim-text>the Resource Manager (200) monitoring in which of the computers (101) the application state has entered the wait state;</claim-text>
<claim-text>the Resource Manager (200), based on said monitoring, determining a transition time at which to change over computers (101) from a low-power to a high-power configuration;</claim-text>
<claim-text>the Resource Manager (200), prior to the transition time, informing a notifying Resource Manager Proxy (201) of a said low-power configuration; and after the transition time, informing the Resource Manager Proxy (201) of each computer (101) of which the application state has entered the wait state of a said high-power configuration.</claim-text></claim-text></claim><claim id="ac-en-0008" num="0008"><claim-text>The method according to any preceding claim further comprising, in the determining and informing steps, the Resource Manager (200) first determining and informing a provisional recommendation of power configuration for at least one computer (101) and subsequently updating the recommendation and informing the Resource Manager Proxy (201) of the updated power configuration.</claim-text></claim><claim id="ac-en-0009" num="0009"><claim-text>The method according to any of claims 1 to 4 wherein the power configuration determined by the Resource Manager (200) applies to all the computers (101), the notifying comprising broadcasting the power configuration to all the Resource Manager Proxies (201).</claim-text></claim><claim id="ac-en-0010" num="0010"><claim-text>The method according to any preceding claim further comprising the Resource Manager (200) pre-emptively broadcasting a power configuration to all the Resource Manager Proxies (201) before said notifying.</claim-text></claim><claim id="ac-en-0011" num="0011"><claim-text>The method according to any preceding claim wherein the Resource Manager (200) is provided by at least one computer separate from the computers (101) to which portions of the application are allocated.</claim-text></claim><claim id="ac-en-0012" num="0012"><claim-text>The method according to any preceding claim wherein the Resource Manager (200) is in distributed form with a plurality of Resource Managers (200a - 200e) each responsible for a respective subset of the computers (101) to which portions of the application are allocated and connected by a communications framework (220).</claim-text></claim><claim id="ac-en-0013" num="0013"><claim-text>A Resource Manager (200) for managing a plurality of computers (101) in a high-performance computer system (100), the computers (101) being coupled together to execute a single monolithic application, each of the computers being allocated a respective portion of the application including code sections corresponding to different application states including a compute-intensive state, a data transfer state, and a wait state for coordination with other computers (101), and each of the computers operable in one of a plurality of power configurations, the Resource Manager (200) comprising:
<claim-text>a communications module (210) for exchanging messages with a Resource Manager Proxy (201) in each computer (101) of the high-performance computer system (100);</claim-text>
<claim-text>a state monitor (212) responsive to notifications from Resource Manager Proxies (201) to determine changes of application states in the computers (101) and assess an overall state of the application; and</claim-text>
<claim-text>a power configurer (214) responsive to the assessment by the state monitor (212) to determine a power configuration for an individual computer (101) of the high-performance computer system (100);</claim-text>
<claim-text>the communications module (210) arranged to inform the determined power configuration to the Resource Manager Proxy (201) of the computer (101).</claim-text></claim-text></claim><claim id="ac-en-0014" num="0014"><claim-text>A computer program product comprising computer-readable code which, when executed by a high-performance computer system (100), performs the method according to any of claims 1 to 12.</claim-text></claim><claim id="ac-en-0015" num="0015"><claim-text>A high-performance computing system (100) comprising:
<claim-text>the Resource Manager (200) according to claim 13; and</claim-text>
a plurality of computers (101) coupled together to execute a single monolithic application, each of the computers being allocated a respective portion of the application including code sections corresponding to different application states including a compute-intensive state, a data transfer state, and a wait state, and each of the computers operable in one of a plurality of power configurations,<br/>
wherein each of the computers (101) is equipped with a Resource Manager Proxy (201) comprising:
<claim-text>a code reader (207) for reading indications, contained in the code sections allocated to the computer (101), of a change in application state;</claim-text>
<claim-text>a communications module (205) for forwarding the indications to the Resource Manager (200) and receiving, from the Resource Manager, a power configuration recommendation for the computer (101);</claim-text>
<claim-text>a power manager (209) for causing a change of power configuration of the computer (101) based on the recommendation from the Resource Manager (200).</claim-text></claim-text></claim></amended-claims><drawings mxw-id="PDW20422220" load-source="patent-office"><!-- EPO <DP n="30"> --><figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="229" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> --><figure id="f0002" num="3"><img id="if0002" file="imgf0002.tif" wi="107" he="174" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> --><figure id="f0003" num="4,5"><img id="if0003" file="imgf0003.tif" wi="158" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="33"> --><figure id="f0004" num="6"><img id="if0004" file="imgf0004.tif" wi="165" he="183" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="34"> --><figure id="f0005" num="7"><img id="if0005" file="imgf0005.tif" wi="165" he="173" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="35"> --><figure id="f0006" num="8"><img id="if0006" file="imgf0006.tif" wi="165" he="180" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="36"> --><figure id="f0007" num="9"><img id="if0007" file="imgf0007.tif" wi="165" he="120" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="158" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="158" he="233" type="tif"/><doc-page id="srep0003" file="srep0003.tif" wi="158" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
