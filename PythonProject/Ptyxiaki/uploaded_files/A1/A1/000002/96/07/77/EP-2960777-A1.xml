<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2960777-A1" country="EP" doc-number="2960777" kind="A1" date="20151230" family-id="51368729" file-reference-id="238330" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451500" ucid="EP-2960777-A1"><document-id><country>EP</country><doc-number>2960777</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-13875479-A" is-representative="YES"><document-id mxw-id="PAPP193865968" load-source="patent-office" format="original"><country>EP</country><doc-number>13875479.1</doc-number><date>20131114</date><lang>ZH</lang></document-id><document-id mxw-id="PAPP193865969" load-source="docdb" format="epo"><country>EP</country><doc-number>13875479</doc-number><kind>A</kind><date>20131114</date><lang>ZH</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162027211" ucid="CN-2013087153-W" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>2013087153</doc-number><kind>W</kind><date>20131114</date></document-id></priority-claim><priority-claim mxw-id="PPC162036357" ucid="CN-201310057355-A" load-source="docdb"><document-id format="epo"><country>CN</country><doc-number>201310057355</doc-number><kind>A</kind><date>20130222</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1978001397" load-source="ipcr">G06F  11/16        20060101ALI20160115BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1978001398" load-source="ipcr">G06F  11/10        20060101ALI20160115BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1978001399" load-source="ipcr">G06F   3/06        20060101AFI20160115BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1984020775" load-source="docdb" scheme="CPC">G06F  11/1012      20130101 LI20160112BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984696652" load-source="docdb" scheme="CPC">G06F   3/0659      20130101 LI20151231BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984698866" load-source="docdb" scheme="CPC">G06F   3/0619      20130101 FI20151231BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984699076" load-source="docdb" scheme="CPC">G06F   3/065       20130101 LI20151231BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984702695" load-source="docdb" scheme="CPC">G06F  11/167       20130101 LI20160106BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984704935" load-source="docdb" scheme="CPC">G06F   3/0673      20130101 LI20151231BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165545966" lang="DE" load-source="patent-office">DATENSCHUTZVERFAHREN, VORRICHTUNG UND SYSTEM</invention-title><invention-title mxw-id="PT165545967" lang="EN" load-source="patent-office">DATA PROTECTION METHOD, APPARATUS AND DEVICE</invention-title><invention-title mxw-id="PT165545968" lang="FR" load-source="patent-office">MÉTHODE, APPAREIL ET DISPOSITIF DE PROTECTION DES DONNÉES</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103318704" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ZTE CORP</last-name><address><country>CN</country></address></addressbook></applicant><applicant mxw-id="PPAR1103328728" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ZTE CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR1101647660" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ZTE Corporation</last-name><iid>101115168</iid><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>Shenzhen, Guangdong 518057</city><country>CN</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103304251" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>XI ZHIJUN</last-name><address><country>CN</country></address></addressbook></inventor><inventor mxw-id="PPAR1103325124" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>XI, ZHIJUN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101647404" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>XI, ZHIJUN</last-name><address><street>ZTE Plaza Keji Road South Hi-Tech Industrial Park Nanshan District</street><city>SHENZHEN GUANGDONG PROVINCE 518057</city><country>CN</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101652752" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Novagraaf Technologies</last-name><iid>100061566</iid><address><street>Bâtiment O2 2, rue Sarah Bernhardt CS90017</street><city>92665 Asnières-sur-Seine cedex</city><country>FR</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="CN-2013087153-W"><document-id><country>CN</country><doc-number>2013087153</doc-number><kind>W</kind><date>20131114</date><lang>ZH</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014127650-A1"><document-id><country>WO</country><doc-number>2014127650</doc-number><kind>A1</kind><date>20140828</date><lang>ZH</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660611348" load-source="docdb">AL</country><country mxw-id="DS660691788" load-source="docdb">AT</country><country mxw-id="DS660610871" load-source="docdb">BE</country><country mxw-id="DS660783619" load-source="docdb">BG</country><country mxw-id="DS660606713" load-source="docdb">CH</country><country mxw-id="DS660610872" load-source="docdb">CY</country><country mxw-id="DS660691789" load-source="docdb">CZ</country><country mxw-id="DS660611350" load-source="docdb">DE</country><country mxw-id="DS660610873" load-source="docdb">DK</country><country mxw-id="DS660610874" load-source="docdb">EE</country><country mxw-id="DS660688199" load-source="docdb">ES</country><country mxw-id="DS660783620" load-source="docdb">FI</country><country mxw-id="DS660606714" load-source="docdb">FR</country><country mxw-id="DS660611359" load-source="docdb">GB</country><country mxw-id="DS660610879" load-source="docdb">GR</country><country mxw-id="DS660611360" load-source="docdb">HR</country><country mxw-id="DS660691790" load-source="docdb">HU</country><country mxw-id="DS660606715" load-source="docdb">IE</country><country mxw-id="DS660610880" load-source="docdb">IS</country><country mxw-id="DS660783621" load-source="docdb">IT</country><country mxw-id="DS660610881" load-source="docdb">LI</country><country mxw-id="DS660783622" load-source="docdb">LT</country><country mxw-id="DS660685496" load-source="docdb">LU</country><country mxw-id="DS660783623" load-source="docdb">LV</country><country mxw-id="DS660783624" load-source="docdb">MC</country><country mxw-id="DS660685497" load-source="docdb">MK</country><country mxw-id="DS660685498" load-source="docdb">MT</country><country mxw-id="DS660685507" load-source="docdb">NL</country><country mxw-id="DS660691795" load-source="docdb">NO</country><country mxw-id="DS660685508" load-source="docdb">PL</country><country mxw-id="DS660610882" load-source="docdb">PT</country><country mxw-id="DS660685989" load-source="docdb">RO</country><country mxw-id="DS660610887" load-source="docdb">RS</country><country mxw-id="DS660685509" load-source="docdb">SE</country><country mxw-id="DS660611362" load-source="docdb">SI</country><country mxw-id="DS660691796" load-source="docdb">SK</country><country mxw-id="DS660691797" load-source="docdb">SM</country><country mxw-id="DS660688200" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479870" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A method and device of data protection and a storage equipment. The method includes: when receiving from a host a writing command, carrying an address and data to be stored, writing the data to be stored into a first storage space, which corresponds to the address, in a storage unit, and writing protection data corresponding to the data to be stored into a second storage space, which corresponds to the address, in a protection unit; when receiving from the host a reading command, carrying the address, determining recovery data according to the data stored in the first storage space and the data stored in the second storage space; and taking the recovery data as response data for the reading command. The method achieves efficient data protection of a storage equipment.<img id="iaf01" file="imgaf001.tif" wi="157" he="89" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759682" lang="EN" source="EPO" load-source="docdb"><p>A method and device of data protection and a storage equipment. The method includes: when receiving from a host a writing command, carrying an address and data to be stored, writing the data to be stored into a first storage space, which corresponds to the address, in a storage unit, and writing protection data corresponding to the data to be stored into a second storage space, which corresponds to the address, in a protection unit; when receiving from the host a reading command, carrying the address, determining recovery data according to the data stored in the first storage space and the data stored in the second storage space; and taking the recovery data as response data for the reading command. The method achieves efficient data protection of a storage equipment.</p></abstract><description mxw-id="PDES98404571" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001"><b>Technical field</b></heading><p id="p0001" num="0001">The embodiments of the present invention relate to the information technologies field, and in particular to a method and device of data protection, storage equipment.</p><heading id="h0002"><b>Background</b></heading><p id="p0002" num="0002">In some special fields, some data and files are very important, and data loss or error may usually cause significant losses; however, the features of electronic products determine that there could be no completely reliable storage equipment, and no one method could guarantee that loss or error will not occur to all the data.</p><p id="p0003" num="0003">For the traditional data read-write of one or more storage units in a storage equipment, the storage units store data received from a host according to a write command of the host, and return corresponding storage data to the host according to a read command of the host. However, in practice, since this storage way is not completely reliable, loss or error may occur to data stored in the storage units. Conventional storage equipment protection needs to be supported by a special drive and an application software, and system operating efficiency is not high.</p><heading id="h0003"><b>Summary</b></heading><p id="p0004" num="0004">The embodiments of the present invention provide a method and device of data protection, a storage equipment, which can realize efficient data protection of a storage equipment.</p><p id="p0005" num="0005">According to one aspect of the embodiments of the present invention, a method of data protection is provided, including:
<ul><li>when receiving from a host a write command carrying an address and data to be stored, writing the data to be stored into a first storage space, which corresponds to the address, in a storage unit, and writing protection data corresponding to the data to be stored into a second storage space, which corresponds to the address, in a protection unit; when receiving from the host a read command carrying the address, determining<!-- EPO <DP n="2"> --> recovery data of the data to be stored according to the data stored in the first storage space and the data stored in the second storage space; and taking the recovery data as response data for the read command.</li></ul></p><p id="p0006" num="0006">In an example embodiment, the protection unit includes at least two protection sub-units, and the second storage space comprises respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units;<br/>
writing the protection data corresponding the data to be stored into the second storage space, which corresponds to the address, in the protection unit includes: respectively writing the protection data into respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units; and<br/>
determining the recovery data of the data to be stored according to the data stored in the first storage space and the data stored in the second storage space includes:<br/>
determining the recovery data according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space.</p><p id="p0007" num="0007">In an example embodiment, the method further includes: performing conversion processing on the data to be stored according to a data conversion mode to obtain the protection data.<br/>
determining the recovery data according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space includes: performing inverse conversion processing corresponding to the conversion processing on the data stored in a first storage sub-space of the second storage space according to the data conversion mode to obtain first inverse conversion processed data; judging whether the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space to obtain a first judgement result; when the first judgement result is that the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space, determining the data stored in the first storage space to be the recovery data; and when the first judgement result is that data stored in the first storage space is inconsistent with the inverse conversion processed data corresponding to the first storage sub-space, performing inverse conversion processing corresponding to the conversion processing on the data stored in a second<!-- EPO <DP n="3"> --> storage sub-space of the second storage space to obtain second inverse conversion processed data, and determining the recovery data according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data.</p><p id="p0008" num="0008">In an example embodiment, determining the recovery data according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data includes: judging whether the first inverse conversion processed data is consistent with the second inverse conversion processed data to obtain a second judgement result; when the second judgement result is that the first inverse conversion processed data is consistent with the second inverse conversion processed data, determining any one of the first inverse conversion processed data and the second inverse conversion processed data to be the recovery data; and when the second judgement result is that the first inverse conversion processed data is inconsistent with the second inverse conversion processed data, determining the data stored in the first storage space to be the recovery data.</p><p id="p0009" num="0009">In an example embodiment, the data conversion mode is configured by the host.</p><p id="p0010" num="0010">According to another aspect of the embodiments of the present invention, a device of data protection is further provided, including: a write component configured to, when receiving from a host a write command carrying an address and data to be stored, write the data to be stored into a first storage space, which corresponds to the address, in a storage unit, and write protection data corresponding to the data to be stored into a second storage space, which corresponds to the address, in a protection unit; a determination component configured to, when receiving from the host a read command carrying the address, determine recovery data of the data to be stored according to the data stored in the first storage space and the data stored in the second storage space; and a response component configured to take the recovery data as response data for the read command.</p><p id="p0011" num="0011">In an example embodiment, the protection unit includes at least two protection sub-units, and the second storage space includes respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units.<br/>
<!-- EPO <DP n="4"> -->the write component comprises: a write element configured to, when receiving from the host the write command carrying the address and the data to be stored, write the data to be stored into the first storage space, which corresponds to the address, in the storage unit, and respectively write the protection data into the respective storage sub-spaces, which corresponds to the address, in the at least two protection sub-units; and<br/>
the determination component includes: a determination element configured to, when receiving from the host the read command carrying the address, determine the recovery data according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space.</p><p id="p0012" num="0012">In an example embodiment, the device further includes: a conversion component configured to perform conversion processing on the data to be stored according to a data conversion mode to obtain the protection data; and</p><p id="p0013" num="0013">the determination element includes: a conversion sub-element configured to perform inverse conversion processing corresponding to the conversion processing on the data stored in a first storage sub-space of the second storage space according to the data conversion mode to obtain first inverse conversion processed data; a first judgement sub-element configured to judge whether the data stored in the first storage space is consistent with the inverse conversion processed corresponding to the first storage sub-space to obtain a first judgement result; a first determination sub-element configured to, when the first judgement result is that the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space, determine the data stored in the first storage space to be the recovery data; and a second determination sub-element configured to, when the first judgement result is that data stored in the first storage space is inconsistent with the inverse conversion processed data corresponding to the first storage sub-space, perform inverse conversion processing corresponding to the conversion processing on the data stored in a second storage sub-space of the second storage space to obtain the second inverse conversion processed data, and determine the recovery data according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data.<!-- EPO <DP n="5"> --></p><p id="p0014" num="0014">In an example embodiment, the second determination sub-element includes: a second judgement sub-element configured to judge whether the first inverse conversion processed is consistent with the second inverse conversion processed data to obtain a second judgement result; a third determination sub-element configured to, when the second judgement result is that the first inverse conversion processed data is consistent with the second inverse conversion processed data, determine any one of the first inverse conversion processed data and the second inverse conversion processed data to be the recovery data; and a fourth determination sub-element configured to, when the second judgement result is that the first inverse conversion processed data is inconsistent with the second inverse conversion processed data, determine the data stored in the first storage space to be the recovery data.</p><p id="p0015" num="0015">According to another aspect of the embodiments of the present invention, a storage equipment is provided, including a host, an interface control unit, a storage unit and a protection unit, wherein the interface control unit is respectively connected to the host, the storage unit and the protection unit, and the interface control unit comprises the data protection device mentioned above.</p><p id="p0016" num="0016">In the embodiments of the present invention, the protection data corresponding to the data to be stored is written into the protection unit, and when the corresponding read command is received, the recovery data of the data to be stored is determined according to the data stored in the protection unit and the storage unit, and is taken as the response data of the read command, thereby realizing efficient storage equipment data protection.</p><heading id="h0004"><b>Brief Description of the Drawings</b></heading><p id="p0017" num="0017">Drawings, provided for further understanding of the present invention and forming a part of the specification, are used to explain the present invention together with embodiments of the present invention rather than to limit the present invention. In the accompanying drawings:
<ul><li><figref idrefs="f0001">Fig. 1</figref> is a flowchart of a method of data protection according to an embodiment of the present invention;<!-- EPO <DP n="6"> --></li><li><figref idrefs="f0001">Fig. 2</figref> is a design structural schematic diagram of a conventional storage equipment;</li><li><figref idrefs="f0001">Fig. 3A</figref> is a design structural schematic diagram of a storage equipment having a real-time protection function;</li><li><figref idrefs="f0002">Fig. 3B</figref> is an implementation schematic diagram of an interface control unit in <figref idrefs="f0001">Fig. 3A</figref>;</li><li><figref idrefs="f0002">Fig. 4</figref> is a data writing flowchart diagram of a storage equipment having a real-time protection function;</li><li><figref idrefs="f0003">Fig. 5</figref> is a data reading flowchart diagram of a storage equipment having a real-time protection function; and</li><li><figref idrefs="f0004">Fig. 6</figref> is a flowchart diagram of data automatic recovery.</li></ul></p><heading id="h0005"><b>Detailed Description of the Embodiments</b></heading><p id="p0018" num="0018">In order to make the objects, technical solutions and advantages of the embodiments of the present invention more apparent, the embodiments of the present invention are described in detail herein below in conjunction with the accompanying drawings and specific embodiments. It needs to be noted that the embodiments of the present application and the features of the embodiments can be combined with each other if there is no conflict.</p><p id="p0019" num="0019"><figref idrefs="f0001">Fig. 1</figref> is a flowchart a method of data protection according to an embodiment of the present invention; as shown in <figref idrefs="f0001">Fig. 1</figref>, a data protection method is provided according to the embodiment of the present invention, and the method includes the following steps:
<ul><li>step 101, when a write command carrying an address and data to be stored is received from a host, the data to be stored is written into a first storage space, which corresponds to the address, in a storage unit, and protection data corresponding the data to be stored is written into a second storage space, which corresponds to the address, in a protection unit;</li><li>step 102, when a read command carrying the address is received from the host, recovery data of the data to be stored is determined according to the data stored in the first storage space and the data stored in the second storage space; and<!-- EPO <DP n="7"> --></li><li>step 103: the recovery data is taken as response data for the read command.</li></ul></p><p id="p0020" num="0020">It can be seen that the protection data corresponding to the data to be stored is written into the protection unit, and when the corresponding read command is received, the recovery data of the data to be stored is determined according to the data stored in the protection unit and the storage unit, and is taken as the response data of the read command, thereby realizing efficient storage equipment data protection.</p><p id="p0021" num="0021">The host may be composed of devices, such as CPU and PCI Master, which can actively initiate data operation.</p><p id="p0022" num="0022">The storage unit and the protection unit may be composed of various storage equipments, which may be various kinds of external storage equipments, for example, SDRAM, FLASH, EEPROM storage chip or flash card.</p><p id="p0023" num="0023">In an example embodiment, the protection data may include error detection and correction data of the data to be stored, and the recovery data of the data to be stored is determined according to the data stored in the first storage space and the data stored in the second storage space may include:
<ul><li>according to the error detection and correction data in the second storage space, error detection operation to the data stored in the first storage space to obtain an error detection result is performed;</li><li>when the error detection result is that an error occurs, the data stored in the first storage space is determined to be the recovery data; and</li><li>when the error detection result is that no error occurs, error correction processing on the data stored in the first storage space is performed, according to the error detection and correction data, to obtain error correction processed data and the error correction processed data is determined to be the recovery data.</li></ul></p><p id="p0024" num="0024">Alternatively, the protection data may also include two or more pieces of replica data of the data to be stored, and the recovery data of the data to be stored is determined according to the data stored in the first storage space and the data stored in the second storage space may include:
<ul><li>whether the data stored in the first storage space is consistent with the data stored in the second storage space corresponding to any one of the two or more pieces of replica data is judged; if they are consistent, the data stored in the first storage space is<!-- EPO <DP n="8"> --> determined to be the recovery data; otherwise, whether the pieces of data stored in the second storage space respectively corresponding to the two or more pieces of replica data are consistent is judged; if yes, the data stored in the second storage space corresponding to any one of the two or more pieces of replica data is determined to be the recovery data; otherwise, the data stored in the first storage space is determined to the recovery data.</li></ul></p><p id="p0025" num="0025">In the embodiments of the present invention, the protection unit may include at least two protection sub-units, and the second storage space may include respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units;<br/>
the protection data corresponding the data to be stored is written into the second storage space, which corresponds to the address, in the protection unit may include:
<ul><li>the protection data is respectively written into respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units; and</li><li>the recovery data of the data to be stored is determined according to the data stored in the first storage space and the data stored in the second storage space may include:
<ul><li>the recovery data is determined according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space.</li></ul></li></ul></p><p id="p0026" num="0026">In an example embodiment, the method may further include:
<ul><li>conversion processing is performed to the data to be stored according to a data conversion mode to obtain the protection data; and</li><li>the recovery data is determined according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space may include:
<ul><li>inverse conversion processing is performed corresponding to the conversion processing on the data stored in a first storage sub-space of the second storage space according to the data conversion mode to obtain first inverse conversion processed data;</li></ul></li></ul><!-- EPO <DP n="9"> -->
whether the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space is judged to obtain a first judgement result;<br/>
when the first judgement result is that the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space, the data stored in the first storage space is determined to be the recovery data; and<br/>
when the first judgement result is that data stored in the first storage space is inconsistent with the inverse conversion processed data corresponding to the first storage sub-space, the inverse conversion processing is performed corresponding to the conversion processing on the data stored in a second storage sub-space of the second storage space to obtain second inverse conversion processed data, and the recovery data is determined according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data.</p><p id="p0027" num="0027">The data conversion mode may include at least one of the followings: flipping data, performing processing through certain error correction algorithms, etc.</p><p id="p0028" num="0028">The recovery data is determined according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data may include:
<ul><li>whether the first inverse conversion processed data is consistent with the second inverse conversion processed data is judged to obtain a second judgement result;</li><li>when the second judgement result is that the first inverse conversion processed data is consistent with the second inverse conversion processed data, any one of the first inverse conversion processed data and the second inverse conversion processed data is determined to be the recovery data; and</li><li>when the second judgement result is that the first inverse conversion processed data is inconsistent with the second inverse conversion processed data, the data stored in the first storage space is determined to be the recovery data.</li></ul></p><p id="p0029" num="0029">Here, the at least two protection sub-units may be, for example, at least two storage read-write components. Since the possibility of an error occurring to the at<!-- EPO <DP n="10"> --> least two storage read-write components at the same time is very small, reliable data storage protection is realized.</p><p id="p0030" num="0030">In addition, the data conversion mode may be a pre-set default mode, or may be configured by the host, for example, the data conversion mode can be configured by the host carrying mode indication information in the write command.</p><p id="p0031" num="0031">In order to further illustrate the embodiments of the present invention clearly, example embodiments of the present invention are described below.</p><p id="p0032" num="0032"><figref idrefs="f0001">Fig. 2</figref> is a design structural schematic diagram of a conventional storage equipment; and as shown in <figref idrefs="f0001">Fig. 2</figref>, a host directly writes data into a storage space, corresponding to a certain address, of a storage unit, and reads the data from the storage space.</p><p id="p0033" num="0033"><figref idrefs="f0001">Fig. 3A</figref> is a design structural schematic diagram of a storage equipment having a real-time protection function according to an example embodiment, and <figref idrefs="f0002">Fig. 3B</figref> is an implementation schematic diagram of an interface control unit in <figref idrefs="f0001">Fig. 3A</figref>; and as shown in <figref idrefs="f0001">Fig. 3A</figref> and <figref idrefs="f0002">Fig. 3B</figref>, the interface control unit is respectively corrected to a host, a storage unit and a protection unit, and the interface control unit directly issues data to the storage unit, and writes converted data, obtained from a conversion unit, into the protection unit.</p><p id="p0034" num="0034">Corresponding to <figref idrefs="f0001">Fig. 3A</figref> and <figref idrefs="f0002">Fig. 3B</figref>, the data writing flowchart of a storage equipment having a real-time protection function according to an example embodiment is as shown in <figref idrefs="f0002">Fig.4</figref>, and the specific steps are as follows:
<ul><li>step 401, this processing flowchart starts;</li><li>step 402, a host issues a write command to an interface conversion unit;</li><li>step 403, the interface conversion unit directly sends an address carried in the write command to a storage equipment;</li><li>step 404, the interface conversion unit directly sends data carried in the write command to the storage equipment;</li><li>step 405, according to a data conversion mode of a default configuration of the interface conversion unit or the data conversion mode configured by the write command sent from the host, the interface conversion unit sends converted data to a protection unit; and<!-- EPO <DP n="11"> --></li><li>step 406, this flowchart ends.</li></ul></p><p id="p0035" num="0035"><figref idrefs="f0003">Fig. 5</figref> is a data reading flowchart diagram of a storage equipment having a real-time protection function according to an example embodiment; and as shown in <figref idrefs="f0003">Fig. 5</figref>, the specific steps of the data reading flowchart of the storage equipment having the real-time protection function are as follows:
<ul><li>step 501, this processing flowchart starts;</li><li>step 502, a host issues a data reading command to an interface conversion unit;</li><li>step 503, the interface conversion unit directly issues an address carried in the data reading command to a storage unit and a protection unit; and</li><li>step 504, according to the conversion mode adopted in the writing flowchart mentioned above, the interface conversion unit performs inverse conversion to the data read back from the protection unit to obtain the converted data, and compares the converted data with the data read back from the storage unit; if they are consistent, then the data read back from the storage unit is directly returned to the host, and the flowchart ends; and if they are inconsistent, then it is detected that an error occurs, and the data automatic repairing flowchart as shown in <figref idrefs="f0004">Fig. 6</figref> is proceeded to.</li></ul></p><p id="p0036" num="0036"><figref idrefs="f0004">Fig. 6</figref> is a data automatic repairing flowchart diagram according to an example embodiment of the present invention; and as shown in <figref idrefs="f0004">Fig. 6</figref>, the specific steps of the data automatic repairing flowchart are as follows:
<ul><li>step 601, this processing flowchart starts;</li><li>step 602, an interface conversion unit restores data in two conversion units (setting as conversion unit 1 and conversion unit 2) simultaneously to form data restored 1 and data restored 2;</li><li>step 603, the data restored 1 and the data restored 2 are compared; if they are inconsistent, then it is indicated that restored data formed by the interface conversion unit is wrong, and the data read back from a storage unit is directly returned to a host;</li><li>step 604, the data restored 1 and the data restored 2 are compared; if they are consistent, then it is confirmed that data restored is correct; and data of the storage unit is repaired according to the data restored, and the data restored 1 or the data restored 2 (i.e. "correct data" in the figure) is returned to the host; and</li><li>step 605, this flowchart ends.</li></ul><!-- EPO <DP n="12"> --></p><p id="p0037" num="0037">A device of data protection is further provided in the embodiments of the present invention, and the device includes:
<ul><li>a write component ,which is configured to, when receiving from a host a write command carrying an address and data to be stored, write the data to be stored into a first storage space, which corresponds to the address, in a storage unit and write protection data corresponding the data to be stored into a second storage space, which corresponds to the address, in a protection unit;</li><li>a determination component, which is configured to, when receiving from the host a read command carrying the address, determine recovery data of the data to be stored according to the data stored in the first storage space and the data stored in the second storage space; and</li><li>a response component, which is configured to take the recovery data as response data for the read command.</li></ul></p><p id="p0038" num="0038">It can be seen that the protection data corresponding to the data to be stored is written into the protection unit, and when the corresponding read command is received, the recovery data of the data to be stored is determined according to the data stored in the protection unit and the storage unit, and is taken as the response data of the read command, thereby realizing efficient storage equipment data protection.</p><p id="p0039" num="0039">The protection unit may include at least two protection sub-units, and the second storage space may comprise respective storage sub-spaces, which correspond to the address, of the at least two protection sub-units;<br/>
the write component may include:
<ul><li>a write element, which is configured to, when receiving from the host the write command carrying the address and the data to be stored, write the data to be stored into the first storage space, which corresponds to the address, in the storage unit, and respectively write the protection data into the respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units; and</li><li>the determination component may include:
<ul><li>a determination element, which is configured to, when receiving from the host the read command carrying the address, determine the recovery data according to the<!-- EPO <DP n="13"> --> data stored in the first storage space and the data stored in each storage sub-space of the second storage space.</li></ul></li></ul></p><p id="p0040" num="0040">In an example embodiment, the device may further include:
<ul><li>a conversion component, which is configured to perform conversion processing on the data to be stored according to a data conversion mode to obtain the protection data; and</li><li>the determination element may include:
<ul><li>a conversion sub-element, which is configured to perform inverse conversion processing corresponding to the conversion processing on the data stored in a first storage sub-space of the second storage space according to the data conversion mode to obtain first inverse conversion processed data;</li><li>a first judgement sub-element, which is configured to judge whether the data stored in the first storage space is consistent with inverse conversion processed data corresponding to the first storage sub-space to obtain a first judgement result;</li><li>a first determination sub-element, which is configured to, when the first judgement result is that the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space, determine the data stored in the first storage space to be the recovery data; and</li><li>a second determination sub-element, which is configured to, when the first judgement result is that data stored in the first storage space is inconsistent with the inverse conversion processed data corresponding to the first storage sub-space, perform inverse conversion processing corresponding to the conversion processing on the data stored in a second storage sub-space of the second storage space to obtain second inverse conversion processed data, and determine the recovery data according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data.</li></ul></li></ul></p><p id="p0041" num="0041">The second determination sub-element may include:
<ul><li>a second judgement sub-element, which is configured to judge whether the first inverse conversion processed data is consistent with the second inverse conversion processed data to obtain a second judgement result;<!-- EPO <DP n="14"> --></li><li>a third determination sub-element, which is configured to, when the second judgement result is that the first inverse conversion processed data is consistent with the second inverse conversion processed data, determine any one of the first inverse conversion processed data and the second inverse conversion processed data to be the recovery data; and</li><li>a fourth determination sub-element, which is configured to, when the second judgement result is that the first inverse conversion processed data is inconsistent with the second inverse conversion processed data, determine the data stored in the first storage space to be the recovery data.</li></ul></p><p id="p0042" num="0042">A storage equipment is further provided in the embodiments of the present invention. The storage equipment includes a host, an interface control unit, a storage unit and a protection unit, wherein the interface control unit is respectively connected to the host, the storage unit and the protection unit, and the interface control unit includes the data protection device mentioned above.</p><p id="p0043" num="0043">The interface control unit may be composed of a programmable logic device (PLD) or an ASIC chip.</p><p id="p0044" num="0044">Conventional storage equipment protection is generally implemented by the solution of combing software with hardware; on one hand, the cost is relatively high, and what is most critical is that the solution should be supported by special software, so that a particular requirement is proposed for the development of conventional products; and the above-mentioned storage equipment provided in the embodiments of the present invention is applicable to an embedded system or other small and medium-sized equipments, is simple to implement, has no particular requirements on driving and application software, and is completely implemented by hardware, and system operation efficiency thereof is very high.</p><p id="p0045" num="0045">What is described above is an implementation of the embodiments of the present invention. It is to be noted that the person skilled in the art may make several improvements and polishment without departing from the principle of the embodiments of the present invention, and these improvements and polishment should also be regarded as being within the scope of protection of the embodiments of the present invention.<!-- EPO <DP n="15"> --></p><heading id="h0006"><b>Industrial Applicability</b></heading><p id="p0046" num="0046">In the technical solution provided by the present invention, protection data corresponding to data to be stored is written into a protection unit, and when a corresponding read command is received, recovery data of the data to be stored is determined according to the data stored in the protection unit and a storage unit, and is taken as response data of the read command, thereby realizing efficient storage equipment data protection.</p></description><claims mxw-id="PCLM90459511" lang="EN" load-source="patent-office"><!-- EPO <DP n="16"> --><claim id="c-en-0001" num="0001"><claim-text>A method of data protection, <b>characterized by</b> comprising:
<claim-text>when receiving from a host a write command carrying an address and data to be stored, writing the data to be stored into a first storage space, which corresponds to the address, in a storage unit;</claim-text>
<claim-text>writing protection data corresponding the data to be stored into a second storage space, which corresponds to the address, in a protection unit;</claim-text>
<claim-text>when receiving from the host a read command carrying the address, determining recovery data of the data to be stored according to the data stored in the first storage space and the data stored in the second storage space; and</claim-text>
<claim-text>taking the recovery data as response data for the read command.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The method according to claim 1, <b>characterized in that</b> the protection unit comprises at least two protection sub-units, and the second storage space comprises respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units;<br/>
writing the protection data corresponding the data to be stored into the second storage space, which corresponds to the address, in the protection unit comprises:
<claim-text>respectively writing the protection data into the respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units; and</claim-text>
<claim-text>determining the recovery data of the data to be stored according to the data stored in the first storage space and the data stored in the second storage space comprises:
<claim-text>determining the recovery data according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space.</claim-text></claim-text></claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The method according to claim 2, <b>characterized in that</b> the method further comprises:<!-- EPO <DP n="17"> -->
<claim-text>performing conversion processing on the data to be stored according to a data conversion mode to obtain the protection data; and</claim-text>
<claim-text>determining the recovery data according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space comprises:
<claim-text>according to the data conversion mode, performing inverse conversion processing corresponding to the conversion processing on the data stored in a first storage sub-space of the second storage space to obtain first inverse conversion processed data;</claim-text>
<claim-text>judging whether the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space to obtain a first judgement result;</claim-text>
<claim-text>when the first judgement result is that the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space, determining the data stored in the first storage space to be the recovery data; and</claim-text>
<claim-text>when the first judgement result is that data stored in the first storage space is inconsistent with the inverse conversion processed data corresponding to the first storage sub-space, performing inverse conversion processing corresponding to the conversion processing on the data stored in a second storage sub-space of the second storage space to obtain second inverse conversion processed data, and determining the recovery data according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data.</claim-text></claim-text></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The method according to claim 3, <b>characterized in that</b> determining the recovery data according to the data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data comprises:
<claim-text>judging whether the first inverse conversion processed data is consistent with the second inverse conversion processed data to obtain a second judgement result;</claim-text>
<claim-text>when the second judgement result is that the first inverse conversion processed data is consistent with the second inverse conversion processed data,<!-- EPO <DP n="18"> --> determining any one of the first inverse conversion processed data and the second inverse conversion processed data to be the recovery data; and</claim-text>
<claim-text>when the second judgement result is that the first inverse conversion processed data is inconsistent with the second inverse conversion processed data, determining the data stored in the first storage space to be the recovery data.</claim-text></claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>The method according to claim 3, <b>characterized in that</b> the data conversion mode is configured by the host.</claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A device of data protection, <b>characterized by</b> comprising:
<claim-text>a write component configured to, when receiving from a host a write command, carrying an address and data to be stored write the data to be stored into a first storage space, which corresponds to the address, in a storage unit and write protection data corresponding the data to be stored into a second storage space, which corresponds to the address, in a protection unit;</claim-text>
<claim-text>a determination component configured to, when receiving from the host a read command carrying the address, determine recovery data of the data to be stored according to the data stored in the first storage space and the data stored in the second storage space; and</claim-text>
<claim-text>a response component configured to take the recovery data as response data for the read command.</claim-text></claim-text></claim><claim id="c-en-0007" num="0007"><claim-text>The device according to claim 6, <b>characterized in that</b> the protection unit comprises at least two protection sub-units, and the second storage space comprises respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units;<br/>
the write component comprises:
<claim-text>a write element configured to, when receiving from the host the write command carrying the address and the data to be stored, write the data to be stored into the first storage space, which corresponds to the address, in the storage unit, and<!-- EPO <DP n="19"> --> respectively write the protection data into the respective storage sub-spaces, which correspond to the address, in the at least two protection sub-units; and</claim-text>
<claim-text>the determination component comprises:
<claim-text>a determination element configured to, when receiving from the host the read command carrying the address, determine the recovery data according to the data stored in the first storage space and the data stored in each storage sub-space of the second storage space.</claim-text></claim-text></claim-text></claim><claim id="c-en-0008" num="0008"><claim-text>The device according to claim 7, <b>characterized in that</b> the device further comprises:
<claim-text>a conversion component configured to perform conversion processing on the data to be stored according to a data conversion mode to obtain the protection data; and</claim-text>
<claim-text>the determination element comprises:
<claim-text>a conversion sub-element configured to perform inverse conversion processing corresponding to the conversion processing on the data stored in a first storage sub-space of the second storage space according to the data conversion mode to obtain first inverse conversion processed data;</claim-text>
<claim-text>a first judgement sub-element configured to judge whether the data stored in the first storage space is consistent with inverse conversion processed data corresponding to the first storage sub-space to obtain a first judgement result;</claim-text>
<claim-text>a first determination sub-element configured to, when the first judgement result is that the data stored in the first storage space is consistent with the inverse conversion processed data corresponding to the first storage sub-space, determine the data stored in the first storage space to be the recovery data; and</claim-text>
<claim-text>a second determination sub-element configured to, when the first judgement result is that data stored in the first storage space is inconsistent with the inverse conversion processed data corresponding to the first storage sub-space, perform inverse conversion processing corresponding to the conversion processing on the data stored in a second storage sub-space of the second storage space to obtain second inverse conversion processed data, and determine the recovery data according to the<!-- EPO <DP n="20"> --> data stored in the first storage space, the first inverse conversion processed data and the second inverse conversion processed data.</claim-text></claim-text></claim-text></claim><claim id="c-en-0009" num="0009"><claim-text>The device according to claim 8, <b>characterized in that</b> the second determination sub-element comprises:
<claim-text>a second judgement sub-element configured to judge whether the first inverse conversion processed data is consistent with the second inverse conversion processed data to obtain a second judgement result;</claim-text>
<claim-text>a third determination sub-element configured to, when the second judgement result is that the first inverse conversion processed data is consistent with the second inverse conversion processed data, determine any one of the first inverse conversion processed data and the second inverse conversion processed data to be the recovery data; and</claim-text>
<claim-text>a fourth determination sub-element configured to, when the second judgement result is that the first inverse conversion processed data is inconsistent with the second inverse conversion processed data, determine the data stored in the first storage space to be the recovery data.</claim-text></claim-text></claim><claim id="c-en-0010" num="0010"><claim-text>A storage equipment, <b>characterized by</b> comprising: a host, an interface control unit, a storage unit and a protection unit, wherein the interface control unit is respectively connected to the host, the storage unit and the protection unit, and the interface control unit comprises the data protection device as claimed in any one of claims 6-9.</claim-text></claim></claims><drawings mxw-id="PDW20422234" load-source="patent-office"><!-- EPO <DP n="21"> --><figure id="f0001" num="1,2,3A"><img id="if0001" file="imgf0001.tif" wi="161" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="22"> --><figure id="f0002" num="3B,4"><img id="if0002" file="imgf0002.tif" wi="158" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="23"> --><figure id="f0003" num="5"><img id="if0003" file="imgf0003.tif" wi="151" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="24"> --><figure id="f0004" num="6"><img id="if0004" file="imgf0004.tif" wi="145" he="233" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="165" he="231" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="165" he="231" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
