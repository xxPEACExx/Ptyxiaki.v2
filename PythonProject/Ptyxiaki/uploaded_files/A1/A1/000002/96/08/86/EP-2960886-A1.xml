<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2960886-A1" country="EP" doc-number="2960886" kind="A1" date="20151230" family-id="47355839" file-reference-id="312929" date-produced="20180824" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160451445" ucid="EP-2960886-A1"><document-id><country>EP</country><doc-number>2960886</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-15175825-A" is-representative="NO"><document-id mxw-id="PAPP193865858" load-source="docdb" format="epo"><country>EP</country><doc-number>15175825</doc-number><kind>A</kind><date>20121129</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193865859" load-source="patent-office" format="original"><country>EP</country><doc-number>15175825.7</doc-number><date>20121129</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162029058" ucid="EP-12194786-A" linkage-type="3" load-source="docdb"><document-id format="epo"><country>EP</country><doc-number>12194786</doc-number><kind>A</kind><date>20121129</date></document-id></priority-claim><priority-claim mxw-id="PPC162029661" ucid="JP-2012169709-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2012169709</doc-number><kind>A</kind><date>20120731</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1988521556" load-source="docdb">G06K   9/00        20060101ALI20151124BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988527592" load-source="docdb">G08G   1/16        20060101AFI20151124BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1987765898" load-source="docdb" scheme="CPC">G06K   9/00805     20130101 LI20140130BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987784425" load-source="docdb" scheme="CPC">G08G   1/166       20130101 FI20140207BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165545801" lang="DE" load-source="patent-office">ERFASSUNGSSYSTEME FÜR SICH BEWEGENDE OBJEKTE, PROGRAMME ZUR ERKENNUNG SICH BEWEGENDER OBJEKTE UND VERFAHREN ZUM ERKENNEN VON SICH BEWEGENDEN OBJEKTEN</invention-title><invention-title mxw-id="PT165545802" lang="EN" load-source="patent-office">MOVING OBJECT RECOGNITION SYSTEMS, MOVING OBJECT RECOGNITION PROGRAMS, AND MOVING OBJECT RECOGNITION METHODS</invention-title><invention-title mxw-id="PT165545803" lang="FR" load-source="patent-office">SYSTÈMES, PROGRAMMES ET PROCÉDÉS DE RECONNAISSANCE D'OBJET MOBILE</invention-title><citations><patent-citations><patcit mxw-id="PCIT401663303" load-source="docdb" ucid="EP-2578464-A1"><document-id format="epo"><country>EP</country><doc-number>2578464</doc-number><kind>A1</kind><date>20130410</date></document-id><sources><source name="SEA" category="E" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335743456" load-source="docdb" ucid="JP-2011081613-A"><document-id format="epo"><country>JP</country><doc-number>2011081613</doc-number><kind>A</kind><date>20110421</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335740746" load-source="docdb" ucid="US-20060008120-A1"><document-id format="epo"><country>US</country><doc-number>20060008120</doc-number><kind>A1</kind><date>20060112</date></document-id><sources><source name="SEA" category="X" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335740216" load-source="docdb" ucid="US-20080243389-A1"><document-id format="epo"><country>US</country><doc-number>20080243389</doc-number><kind>A1</kind><date>20081002</date></document-id><sources><source name="SEA" category="X" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT401663302" load-source="docdb" ucid="US-20100027844-A1"><document-id format="epo"><country>US</country><doc-number>20100027844</doc-number><kind>A1</kind><date>20100204</date></document-id><sources><source name="SEA" category="AD" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335742499" load-source="docdb" ucid="US-20120133769-A1"><document-id format="epo"><country>US</country><doc-number>20120133769</doc-number><kind>A1</kind><date>20120531</date></document-id><sources><source name="SEA" category="A" created-by-npl="N"/></sources></patcit><patcit mxw-id="PCIT335743840" load-source="docdb" ucid="US-8184857-B2"><document-id format="epo"><country>US</country><doc-number>8184857</doc-number><kind>B2</kind><date>20120522</date></document-id><sources><source name="APP" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>B. D. LUCAS; T. KANADE: "An iterative image registration technique with an application to stereo vision", IJCAI, 1981, pages 674 - 679</text><sources><source mxw-id="PNPL75872329" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>J. SHI; C. TOMASI: "Good features to track", IEEE CVPR, 1994, pages 593 - 600</text><sources><source mxw-id="PNPL75872330" load-source="docdb" name="APP"/></sources></nplcit><nplcit><text>P. J. HUBER; E. M. RONCHETTI: "Robust Statistics", WILEY INTERSCIENCE</text><sources><source mxw-id="PNPL57906874" load-source="docdb" name="APP"/></sources></nplcit></non-patent-citations></citations></technical-data><related-documents><relation type="division"><child-doc ucid="EP-15175825-A"><document-id load-source="patent-office" format="epo"><country>EP</country><doc-number>15175825</doc-number><kind>A</kind><date>20121129</date></document-id><document-id load-source="patent-office" format="original"><country>EP</country><doc-number>15175825.7</doc-number><date>20121129</date></document-id></child-doc><parent-doc ucid="EP-12194786-A"><document-id load-source="patent-office" format="epo"><country>EP</country><doc-number>12194786</doc-number><kind>A</kind><date>20121129</date></document-id><document-id load-source="patent-office" format="original"><country>EP</country><doc-number>12194786.5</doc-number><date>20121129</date></document-id></parent-doc></relation></related-documents><parties><applicants><applicant mxw-id="PPAR1103320596" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>DENSO IT LAB INC</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR1103323628" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>DENSO IT LABORATORY, INC.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101644044" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Denso IT Laboratory, Inc.</last-name><iid>101299599</iid><address><street>Shibuya Cross Tower 28th Floor 2-15-1, Shibuya Shibuya-ku</street><city>Tokyo 150-0002</city><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR1103316087" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>DENSO CORP</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR1103313036" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>DENSO CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR1101651282" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>DENSO CORPORATION</last-name><iid>100109190</iid><address><street>1-1, Showa-Cho</street><city>Kariya City Aichi 448-8661</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103329644" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SATO IKURO</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1103312572" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SATO, IKURO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101639473" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SATO, IKURO</last-name><address><street>c/o Denso IT Laboratory, Inc. Shibuya cross tower 28th Floor 2-15-1, Shibuya, Shibuya-ku</street><city>Tokyo, 150-0002</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1103332973" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>TAMATSU YUKIMASA</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1103338778" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>TAMATSU, YUKIMASA</last-name></addressbook></inventor><inventor mxw-id="PPAR1101653816" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>TAMATSU, YUKIMASA</last-name><address><street>c/o Denso Corporation 1-1, Showa-cho KARIYA-CITY</street><city>Aichi, 448-8661</city><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1103335515" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>GOTO KUNIHIRO</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1103322221" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>GOTO, KUNIHIRO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101644863" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>GOTO, KUNIHIRO</last-name><address><street>c/o Denso Corporation 1-1, Showa-cho KARIYA-CITY</street><city>Aichi, 448-8661</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101640533" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Schwarz &amp; Partner</last-name><iid>101130944</iid><address><street>Patentanwälte Wipplingerstraße 30</street><city>1010 Wien</city><country>AT</country></address></addressbook></agent></agents></parties><international-convention-data><designated-states><ep-contracting-states><country mxw-id="DS660689828" load-source="docdb">AL</country><country mxw-id="DS660684937" load-source="docdb">AT</country><country mxw-id="DS660689829" load-source="docdb">BE</country><country mxw-id="DS660610259" load-source="docdb">BG</country><country mxw-id="DS660610108" load-source="docdb">CH</country><country mxw-id="DS660689830" load-source="docdb">CY</country><country mxw-id="DS660687320" load-source="docdb">CZ</country><country mxw-id="DS660684825" load-source="docdb">DE</country><country mxw-id="DS660689839" load-source="docdb">DK</country><country mxw-id="DS660689840" load-source="docdb">EE</country><country mxw-id="DS660606446" load-source="docdb">ES</country><country mxw-id="DS660610260" load-source="docdb">FI</country><country mxw-id="DS660610261" load-source="docdb">FR</country><country mxw-id="DS660684826" load-source="docdb">GB</country><country mxw-id="DS660689841" load-source="docdb">GR</country><country mxw-id="DS660684831" load-source="docdb">HR</country><country mxw-id="DS660687321" load-source="docdb">HU</country><country mxw-id="DS660610109" load-source="docdb">IE</country><country mxw-id="DS660689842" load-source="docdb">IS</country><country mxw-id="DS660610262" load-source="docdb">IT</country><country mxw-id="DS660689843" load-source="docdb">LI</country><country mxw-id="DS660684832" load-source="docdb">LT</country><country mxw-id="DS660684938" load-source="docdb">LU</country><country mxw-id="DS660610271" load-source="docdb">LV</country><country mxw-id="DS660684833" load-source="docdb">MC</country><country mxw-id="DS660684951" load-source="docdb">MK</country><country mxw-id="DS660684952" load-source="docdb">MT</country><country mxw-id="DS660606447" load-source="docdb">NL</country><country mxw-id="DS660783347" load-source="docdb">NO</country><country mxw-id="DS660606448" load-source="docdb">PL</country><country mxw-id="DS660610272" load-source="docdb">PT</country><country mxw-id="DS660687322" load-source="docdb">RO</country><country mxw-id="DS660610273" load-source="docdb">RS</country><country mxw-id="DS660606449" load-source="docdb">SE</country><country mxw-id="DS660610110" load-source="docdb">SI</country><country mxw-id="DS660783348" load-source="docdb">SK</country><country mxw-id="DS660783349" load-source="docdb">SM</country><country mxw-id="DS660684953" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data></bibliographic-data><abstract mxw-id="PA166479815" lang="EN" load-source="patent-office"><p id="pa01" num="0001">A moving object recognition system (100) that senses a danger of collision of a moving object, includes: a camera (10) installed in a vehicle, capturing continuous single-view images; a moving object detecting unit (20) configured to detect a moving object by extracting feature points from the captured images, generating optical flows of the extracted feature points, grouping a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and a collision risk calculating unit (40) configured to calculate a risk of the moving object colliding with the vehicle, such that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.
<img id="iaf01" file="imgaf001.tif" wi="94" he="62" img-content="drawing" img-format="tif"/></p></abstract><abstract mxw-id="PA166759627" lang="EN" source="EPO" load-source="docdb"><p>A moving object recognition system (100) that senses a danger of collision of a moving object, includes: a camera (10) installed in a vehicle, capturing continuous single-view images; a moving object detecting unit (20) configured to detect a moving object by extracting feature points from the captured images, generating optical flows of the extracted feature points, grouping a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and a collision risk calculating unit (40) configured to calculate a risk of the moving object colliding with the vehicle, such that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.</p></abstract><description mxw-id="PDES98404516" lang="EN" load-source="patent-office"><!-- EPO <DP n="1"> --><heading id="h0001">BACKGROUND OF THE INVENTION</heading><heading id="h0002">Field of the invention</heading><p id="p0001" num="0001">The present invention relates to moving object recognition systems, moving object recognition programs, and moving object recognition methods for recognizing moving objects by using single-view images.</p><heading id="h0003">Description of the Related Art</heading><p id="p0002" num="0002">There have been known moving object recognition systems that recognize moving objects existing near a vehicle, and then report to or alert the driver or automatically perform braking on the vehicle (hereinafter referred to simply as "reporting"). The distance from the vehicle to a moving object can be directly measured by using a distance sensor such as a millimeter-wave radar, or can be measured by performing image processing with a stereo camera. The moving direction of the moving object and the velocity of the moving object relative to the vehicle can be determined by arranging measured distances in chronological order and then analyzing those distances. As the moving direction of the moving object and the velocity of the moving object relative to the vehicle are determined, the probability (risk) of the moving object colliding with the vehicle can be calculated, and reporting can be performed in accordance with the risk.</p><p id="p0003" num="0003"><!-- EPO <DP n="2"> --> As simpler and less expensive moving object recognition systems, there also have been systems that recognize a moving body with a monocular camera that has only one line of an optical system and an imaging element. Such a system continuously captures images with a monocular camera, to obtain single-view images arranged in chronological order. The technique disclosed in <patcit id="pcit0001" dnum="US8184857B"><text>US 8,184,857</text></patcit> is known as a technique for detecting a moving object from such single-view images.</p><p id="p0004" num="0004">By the technique disclosed in <patcit id="pcit0002" dnum="US8184857B"><text>US 8,184,857</text></patcit>, feature points are extracted from each of single-view images arranged in chronological order, and the feature points are grouped by moving objects, based on the motion vectors (optical flows) of the extracted feature points. The grouping is performed based on variations in the convergence properties of the optical flows to a vanishing point and the external ratios. In this manner, accurate moving object detection can be performed, even if there is an inaccurately-calculated optical flow.</p><p id="p0005" num="0005">In an in-vehicle moving object recognition system, it is preferable to report only the risk of a moving object colliding with or rushing toward the vehicle to the driver, without reporting any moving object with no risk of collision to the driver. This is because reporting every moving object bothers the driver, and might adversely affect the driving.</p><p id="p0006" num="0006">In such an in-vehicle moving object recognition system, the reliability of a result of recognition processing does not always match an actual risk of collision. That is, the risk of collision might be zero, though the result of recognition processing shows a high level of reliability, and vice versa. Information that is useful to most drivers is<!-- EPO <DP n="3"> --> not the information about the reliability of recognition processing but the information about the risk of a recognized moving object colliding with his/her own vehicle.</p><heading id="h0004">SUMMARY OF THE INVENTION</heading><p id="p0007" num="0007">The present invention has been made in view of the above problems, and the object thereof is to provide a moving object recognition system that senses a danger of collision of a moving object by using a monocular camera, instead of a relatively expensive sensor such as a stereo camera or a distance sensor.</p><p id="p0008" num="0008">According to an aspect of the present invention, a moving object recognition system includes: a camera configured to capture a plurality of continuous single-view images, the camera being installed in a vehicle; a moving object detecting unit configured to detect a moving object from the images captured by the camera; a relative approach angle estimating unit configured to estimate a relative approach angle of the moving object detected by the moving object detecting unit with respect to the camera; and a collision risk calculating unit configured to calculate a risk of the moving object colliding with the vehicle, based on a relationship between the relative approach angle and a moving object direction from the camera toward the moving object.</p><p id="p0009" num="0009">With this structure, the risk of a moving object colliding with the vehicle can be obtained as information useful for the driver of the vehicle to drive safely. Also, the risk calculation is performed with a relatively inexpensive mechanism such as a monocular camera, instead of a relatively expensive mechanism such as a stereo camera. Accordingly, the costs can be lowered.<!-- EPO <DP n="4"> --></p><p id="p0010" num="0010">In the moving object recognition system, the collision risk calculating unit may make the risk higher as the difference between the relative approach angle and the moving object direction becomes smaller.</p><p id="p0011" num="0011">When the relative approach angle matches the moving object direction, the moving object is heading toward the vehicle in a relative manner. In view of this, the risk becomes higher, as the difference between the relative approach angle and the moving object direction becomes smaller. Accordingly, the risk of a moving object colliding with the vehicle can be accurately calculated by the above structure.</p><p id="p0012" num="0012">In the moving object recognition system, the collision risk calculating unit may set a danger zone based on the relative approach angle, and calculate the risk based on a probability of the moving object existing in the danger zone.</p><p id="p0013" num="0013">With this structure, the risk of a moving object colliding with the vehicle can be accurately calculated by using not only the relative approach angle of the moving object with respect to the vehicle, but also the danger zone that is set based on the relative approach angle.</p><p id="p0014" num="0014">In the moving object recognition system, the danger zone may be set in an X-Z plane where the camera is the point of origin, an optical axis direction of the camera is a Z direction, a vertical direction is a Y direction, and a horizontal direction is an X direction, and may be a region extending from the vehicle in a direction at the relative approach angle and having a width of the vehicle.<!-- EPO <DP n="5"> --></p><p id="p0015" num="0015">With this structure, the danger zone is designed to have a width equivalent to the width of the vehicle and extend from the vehicle in the direction at the relative approach angle. Accordingly, the risk of collision with any portion of the vehicle can be calculated.</p><p id="p0016" num="0016">In the moving object recognition system, the collision risk calculating unit may include: a distance estimating unit configured to estimate an upper limit value of a distance from the camera to the moving object in the Z direction; and a risk calculating unit configured to calculate the risk by determining a proportion of a line segment existing in the danger zone to a line segment of an XZ ray between the camera and the upper limit value, the XZ ray being a line segment formed by orthographically projecting a straight line onto the X-Z plane, the straight line passing through the camera and the moving object in the images located at a focal distance from the camera.</p><p id="p0017" num="0017">With this structure, an upper limit is set on the danger zone. Accordingly, even if the distance to a moving object cannot be determined, the probability of the moving object existing in the danger zone can be calculated by identifying the moving object direction.</p><p id="p0018" num="0018">In the moving object recognition system, the moving object detecting unit may include: an optical flow calculating unit configured to extract a plurality of feature points from the images, and calculate optical flows of the extracted feature points; and a grouping unit configured to group, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a<!-- EPO <DP n="6"> --> vanishing point as a plurality of feature points existing on the moving object, and the distance estimating unit may select a lowest feature point having the lowest height among the grouped feature points existing on the moving object, and estimate the upper limit value of the distance from the camera to the moving object in the Z direction by calculating a Z-coordinate of a ground surface point that is an intersection point between a straight line connecting the lowest feature point to the optical center and a ground surface on which the vehicle is running.</p><p id="p0019" num="0019">The assumption that the distances between feature points grouped as a moving object are sufficiently smaller than the distance from the camera is valid in a moving object recognition system that recognizes moving objects existing near the vehicle. Accordingly, the upper limit of the distance to a moving object can be accurately estimated by a simple calculation in this structure.</p><p id="p0020" num="0020">In the moving object recognition system, the collision risk calculating unit may include: a distance estimating unit configured to estimate a distance from the camera to the moving object in the Z direction; and a risk calculating unit configured to make the risk higher when a point at the estimated distance from the camera on an XZ ray exists in the danger zone than when the point does not exist in the danger zone, the XZ ray being a line segment formed by orthographically projecting a straight line onto the X-Z plane, the straight line passing through the camera and the moving object in the images located at a focal distance from the camera.</p><p id="p0021" num="0021">With this structure, the distance to a moving object is estimated. Accordingly, it is possible to determine whether the moving object exists in the danger zone, instead<!-- EPO <DP n="7"> --> of the probability of the moving object existing in the danger zone. If the moving object is determined to be in the danger zone, the risk is calculated to be high. The risk may be divided into a few levels in accordance with portions of the vehicle with which the moving object collides.</p><p id="p0022" num="0022">In the moving object recognition system, the moving object detecting unit may include: an optical flow calculating unit configured to extract a plurality of feature points from the images, and calculate optical flows of the extracted feature points; and a grouping unit configured to group, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point as a plurality of feature points existing on the moving object, and the distance estimating unit may calculate, based on the vanishing point, a time to collision of the moving object with the vehicle, and estimate, based on the time to collision and a velocity of the vehicle, the distance from the camera to the moving object in the Z direction.</p><p id="p0023" num="0023">A moving object that is dangerous to a running vehicle is a moving object that moves in a direction perpendicular to the traveling direction of the vehicle (for example, a moving object that goes by the vehicle is not so dangerous). The assumption that a moving object is translationally moving in a direction perpendicular to the vehicle (or the velocity component of the moving object in the direction of the optical axis of the camera is zero) is valid in a moving object recognition system that recognizes moving objects existing near the vehicle. Accordingly, the distance to a moving object can be accurately estimated by a simple calculation in this structure.</p><p id="p0024" num="0024"><!-- EPO <DP n="8"> --> In the moving object recognition system, the collision risk calculating unit may include: a distance estimating unit configured to determine a probability distribution of a distance from the camera to the moving object in the Z direction; and a risk calculating unit configured to calculate the risk, based on a value of the integral of a probability density function of the probability distribution within a distance range in which an XZ ray exists in the danger zone, the XZ ray being a line segment formed by orthographically projecting a straight line onto the X-Z plane, the straight line passing through the camera and the moving object in the images located at a focal distance from the camera.</p><p id="p0025" num="0025">With this structure, a distance is estimated not in the form of a single value, but in the form of a probability distribution. Accordingly, the risk can be accurately calculated in accordance with the proportion of the value of the integral of the probability density function of the probability distribution in the danger zone.</p><p id="p0026" num="0026">In the moving object recognition system, the moving object detecting unit may include: an optical flow calculating unit configured to extract a plurality of feature points from the images, and calculate optical flows of the extracted feature points; and a grouping unit configured to group, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point as a plurality of feature points existing on the moving object, and the distance estimating unit may calculate, based on the vanishing point, a time to collision of the moving object with the vehicle, and determine, based on the time to collision, the probability distribution of the distance in compliance with a predetermined normal distribution.<!-- EPO <DP n="9"> --></p><p id="p0027" num="0027">The assumption that a distance probability distribution is a normal distribution is valid in a moving object recognition system that recognizes moving objects existing near the vehicle. Accordingly, the probability distribution of the distance to a moving object can be accurately determined by a simple calculation in this structure.</p><p id="p0028" num="0028">In the moving object recognition system, the collision risk calculating unit may include: a distance estimating unit configured to estimate an upper limit value of a distance from the camera to the moving object in the Z direction, and determine a probability distribution of the distance from the camera to the moving object in the Z direction; and a risk calculating unit configured to calculate the risk, based on a proportion of a value of the integral of a probability density function of the probability distribution within a distance range in which an XZ ray exists in the danger zone to a value of the integral of a probability density function of the probability distribution within a distance range up to the upper limit value, the XZ ray being a line segment formed by orthographically projecting a straight line onto the X-Z plane, the straight line passing through the camera and the moving object in the images located at a focal distance from the camera.</p><p id="p0029" num="0029">With this structure, a distance is estimated not in the form of a single value, but in the form of a probability distribution. Furthermore, the portion above an estimated upper limit value is cut off from the probability distribution. Accordingly, the risk can be accurately calculated in accordance with the proportion of the value of the integral of the probability density function in the danger zone to the value of the integral of the probability density function in the remaining range.<!-- EPO <DP n="10"> --></p><p id="p0030" num="0030">In the moving object recognition system, the moving object detecting unit may include: an optical flow calculating unit configured to extract a plurality of feature points from the images, and calculate optical flows of the extracted feature points; and a grouping unit configured to group, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point as a plurality of feature points existing on the moving object, and the distance estimating unit may select a lowest feature point having the lowest height among the grouped feature points existing on the moving object, estimate the upper limit value of the distance from the camera to the moving object in the Z direction by calculating a Z-coordinate of a ground surface point that is an intersection point between a straight line connecting the lowest feature point to the optical center and a ground surface on which the vehicle is running, calculate, based on the vanishing point, a time to collision of the moving object with the vehicle, and determine, based on the time to collision, the probability distribution of the distance in compliance with a predetermined normal distribution.</p><p id="p0031" num="0031">The assumption that the distances between feature points grouped as a moving object are sufficiently smaller than the distance from the camera is valid in a moving object recognition system that recognizes moving objects existing near the vehicle. Accordingly, the upper limit of the distance to a moving object can be accurately estimated by a simple calculation in this structure. Also, the assumption that a distance probability distribution is a normal distribution is valid in a moving object recognition system that recognizes moving objects existing near the vehicle. Accordingly, the probability distribution of the distance to a moving object can be<!-- EPO <DP n="11"> --> accurately determined by a simple calculation in this structure.</p><p id="p0032" num="0032">In the moving object recognition system, the collision risk calculating unit may divide the danger zone into a plurality of levels, and set the levels in a stepwise fashion.</p><p id="p0033" num="0033">With this structure, the risk can be calculated in accordance with the influence of collision with each portion of the vehicle.</p><p id="p0034" num="0034">According to another aspect of the present invention, a moving object recognition system includes: a camera configured to capture a plurality of continuous single-view images, the camera being installed in a vehicle; a moving object detecting unit configured to detect a moving object by extracting a plurality of feature points from the images captured by the camera, generating optical flows of the extracted feature points, grouping, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and a collision risk calculating unit configured to calculate a risk of the moving object colliding with the vehicle, and is characterized in that the collision risk calculating unit calculates the risk in such a manner that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.</p><p id="p0035" num="0035">With this structure, the risk of a moving object colliding with the vehicle can also be obtained as information useful for the driver of the vehicle to drive safely. Here, the risk calculation is performed with a relatively inexpensive mechanism such as<!-- EPO <DP n="12"> --> a monocular camera, instead of a relatively expensive mechanism such as a stereo camera. Accordingly, the costs can be lowered. Furthermore, the risk can be calculated by a simple calculation based on the distance between the vanishing point and the moving object in images.</p><p id="p0036" num="0036">In the moving object recognition system, the collision risk calculating unit may calculate a risk of a representative point with the vehicle, the representative point being one of the feature points existing on the moving object or a point determined from the feature points existing on the moving object.</p><p id="p0037" num="0037">With this structure, an appropriate representative point can be identified as the position of a moving object.</p><p id="p0038" num="0038">The moving object recognition system may further including a reporting unit configured to report a danger to a driver of the vehicle in accordance with the risk calculated by the collision risk calculating unit.</p><p id="p0039" num="0039">With this structure, it is possible to alert the driver in accordance with the risk of a moving object colliding with the vehicle.</p><p id="p0040" num="0040">In the moving object recognition system, the collision risk calculating unit may correct the risk, based on a time to collision of the moving object with the vehicle.</p><p id="p0041" num="0041">With this structure, the risk can be more accurately calculated by using a time to collision as well.<!-- EPO <DP n="13"> --></p><p id="p0042" num="0042">According to an aspect of the present invention, a moving object recognition program causes a computer to function as: a moving object detecting unit configured to detect a moving object from a plurality of continuous single-view images captured by a camera installed in a vehicle; a relative approach angle estimating unit configured to estimate a relative approach angle of the moving object detected by the moving object detecting unit with respect to the camera; and a collision risk calculating unit configured to calculate a risk of the moving object colliding with the vehicle, based on a relationship between the relative approach angle and a moving object direction from the camera toward the moving object.</p><p id="p0043" num="0043">With this structure, the risk of a moving object colliding with the vehicle can also be obtained as information useful for the driver of the vehicle to drive safely. Here, the risk calculation is performed with a relatively inexpensive mechanism such as a monocular camera, instead of a relatively expensive mechanism such as a stereo camera. Accordingly, the costs can be lowered.</p><p id="p0044" num="0044">According to another aspect of the present invention, a moving object recognition program causes a computer to function as: a moving object detecting unit configured to detect a moving object by extracting a plurality of feature points from a plurality of continuous single-view images captured by a camera installed in a vehicle, generating optical flows of the extracted feature points, grouping, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and a collision risk calculating unit configured to calculate a risk of the<!-- EPO <DP n="14"> --> moving object colliding with the vehicle in such a manner that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.</p><p id="p0045" num="0045">With this structure, the risk of a moving object colliding with the vehicle can also be obtained as information useful for the driver of the vehicle to drive safely. Here, the risk calculation is performed with a relatively inexpensive mechanism such as a monocular camera, instead of a relatively expensive mechanism such as a stereo camera. Accordingly, the costs can be lowered. Furthermore, the risk can be calculated by a simple calculation based on the distance between the vanishing point and the moving object in images.</p><p id="p0046" num="0046">According to an aspect of the present invention, a moving object recognition method includes: capturing a plurality of continuous single-view images with a camera installed in a vehicle; detecting a moving object from the images captured by the camera; estimating a relative approach angle of the detected moving object with respect to the camera; and calculating a risk of the moving object colliding with the vehicle, based on a relationship between the relative approach angle and a moving object direction from the camera toward the moving object.</p><p id="p0047" num="0047">With this structure, the risk of a moving object colliding with the vehicle can also be obtained as information useful for the driver of the vehicle to drive safely. Here, the risk calculation is performed with a relatively inexpensive mechanism such as a monocular camera, instead of a relatively expensive mechanism such as a stereo<!-- EPO <DP n="15"> --> camera. Accordingly, the costs can be lowered.</p><p id="p0048" num="0048">According to another aspect of the present invention, a moving object recognition method includes: capturing a plurality of continuous single-view images with a camera installed in a vehicle; detecting a moving object by extracting a plurality of feature points from the images captured by the camera, generating optical flows of the extracted feature points, grouping, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and calculating a risk of the moving object colliding with the vehicle, and is characterized in that the risk is calculated in such a manner that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.</p><p id="p0049" num="0049">With this structure, the risk of a moving object colliding with the vehicle can also be obtained as information useful for the driver of the vehicle to drive safely. Here, the risk calculation is performed with a relatively inexpensive mechanism such as a monocular camera, instead of a relatively expensive mechanism such as a stereo camera. Accordingly, the costs can be lowered. Furthermore, the risk can be calculated by a simple calculation based on the distance between the vanishing point and the moving object in images.</p><p id="p0050" num="0050">According to the present invention, the risk of a moving object colliding with a vehicle can be calculated as information useful for the driver of the vehicle to drive safely. Also, the risk calculation can be performed with a relatively inexpensive<!-- EPO <DP n="16"> --> mechanism such as a monocular camera, instead of a relative expensive mechanism such as a stereo camera. Accordingly, the costs can be lowered.</p><p id="p0051" num="0051">These and other objects, features, aspects and advantages of the present invention will become more apparent from the following detailed description of the present invention when taken in conjunction with the accompanying drawings.</p><heading id="h0005">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p0052" num="0052"><ul><li><figref idrefs="f0001">Fig. 1</figref> is a block diagram showing the structure of a moving object recognition system according to an embodiment of the present invention;</li><li><figref idrefs="f0002">Fig. 2A</figref> is a diagram illustrating an example of a velocity relative to the ground for explaining a relative approach angle in the embodiment of the present invention;</li><li><figref idrefs="f0002">Fig. 2B</figref> is a diagram illustrating a relative approach angle in the embodiment of the present invention;</li><li><figref idrefs="f0003">Fig. 3</figref> is a diagram for explaining the definition of coordinates in the embodiment of the present invention;</li><li><figref idrefs="f0004">Fig. 4</figref> is a diagram for explaining combined optical flows in the embodiment of the present invention;</li><li><figref idrefs="f0005">Fig. 5</figref> is a diagram showing the distances over which points in a three-dimensional space translational-move in a unit time in the embodiment of the present invention;</li><li><figref idrefs="f0006">Fig. 6</figref> is a diagram for explaining a vanishing point in the embodiment of the present invention;</li><li><figref idrefs="f0007">Fig. 7A</figref> is a graph showing cost functions of robust estimation in the<!-- EPO <DP n="17"> --> embodiment of the present invention;</li><li><figref idrefs="f0007">Fig. 7B</figref> is a graph showing influence functions of robust estimation in the embodiment of the present invention;</li><li><figref idrefs="f0008">Fig. 8</figref> is a diagram showing an example image in which outliers easily occur in the embodiment of the present invention;</li><li><figref idrefs="f0009">Fig. 9A</figref> is a diagram for explaining the definition of a relative approach angle (where θ &lt; 0) in the embodiment of the present invention;</li><li><figref idrefs="f0009">Fig. 9B</figref> is a diagram for explaining the definition of a relative approach angle (where θ &gt; 0) in the embodiment of the present invention;</li><li><figref idrefs="f0010">Fig. 10</figref> is a diagram showing the relationship between a relative approach angle and a vanishing point in the embodiment of the present invention;</li><li><figref idrefs="f0011">Fig. 11</figref> is a diagram for explaining a ground surface point according to a first example of a distance estimation method in the embodiment of the present invention;</li><li><figref idrefs="f0012">Fig. 12</figref> is a diagram for explaining a calculation of the upper limit distance value according to the first example of a distance estimation method in the embodiment of the present invention;</li><li><figref idrefs="f0013">Fig. 13</figref> is a diagram for explaining a risk calculation based on an estimated upper limit distance value in the embodiment of the present invention;</li><li><figref idrefs="f0014">Fig. 14</figref> is a diagram for explaining a risk calculation based on an estimated distance value in the embodiment of the present invention;</li><li><figref idrefs="f0015">Fig. 15</figref> is a diagram for explaining a modification of the risk calculation based on an estimated distance value in the embodiment of the present invention;</li><li><figref idrefs="f0016">Fig. 16</figref> is a diagram for explaining a risk calculation based on a distance probability density function in the embodiment of the present invention;</li><li><figref idrefs="f0017">Fig. 17</figref> is a diagram for explaining a risk calculation based on an estimated<!-- EPO <DP n="18"> --> upper limit distance and an estimated distance distribution in the embodiment of the present invention; and</li><li><figref idrefs="f0018">Fig. 18</figref> is a table for explaining a risk calculation involving the TTC in the embodiment of the present invention.</li></ul></p><heading id="h0006">DETAILED DESCRIPTION OF EMBODIMENTS</heading><p id="p0053" num="0053">The following is a description of a moving object recognition system according to an embodiment of the present invention, with reference to the accompanying drawings. <figref idrefs="f0001">Fig. 1</figref> is a block diagram showing the structure of the moving object recognition system according to the embodiment of the present invention. The moving object recognition system 100 of this embodiment is a system that calculates the risk of a moving object colliding with its own vehicle, and reports the risk to the driver. The moving object recognition system 100 includes a camera 10, a moving object detecting unit 20, a relative approach angle estimating unit 30, a collision risk calculating unit 40, and a reporting unit 50. The structure formed with the moving object detecting unit 20, the relative approach angle estimating unit 30, and the collision risk calculating unit 40 is realized by a computer executing a moving object recognition program of the embodiment of the present invention. The moving object recognition program may be stored in a storage medium, be read out from the storage medium by a computer, and be executed by the computer.</p><p id="p0054" num="0054">First, the moving object recognition system 100 is briefly described. The camera 10 is mounted on the vehicle. While the vehicle is running, the camera 10 continuously captures images of the surroundings of the vehicle in regular cycles to<!-- EPO <DP n="19"> --> generate images, and outputs the images to the moving object detecting unit 20. Using the images sequentially input from the camera 10, the moving object detecting unit 20 detects the moving object from the images. Since the vehicle (or the camera 10) is moving, the positions of the objects that are stationary on the ground vary every second in the images. From such images, the moving object detecting unit 20 detects an object that is moving relative to the ground, as a moving object.</p><p id="p0055" num="0055">The relative approach angle estimating unit 30 estimates a relative approach angle of the relative moving direction of the detected moving object with respect to the vehicle. <figref idrefs="f0002">Figs. 2A and 2B</figref> are diagrams for explaining a relative approach angle in the embodiment of the present invention. As shown in <figref idrefs="f0002">Fig. 2A</figref>, a vehicle C is now running forward at a velocity v<sub>c</sub>, and a moving object O ahead of the vehicle C is moving at a velocity v<sub>o</sub> in a direction perpendicular to the traveling direction of the vehicle C. In this case, the relative approach angle θ is determined to be the angle of v<sub>o</sub>-v<sub>c</sub> with respect to the traveling direction of the vehicle C, as shown in <figref idrefs="f0002">Fig. 2B</figref>. Using the focal lengths of the images and the camera 10, the relative approach angle estimating unit 30 estimates the relative approach angle θ.</p><p id="p0056" num="0056">The collision risk calculating unit 40 estimates the distance from its own vehicle to the moving object detected by the moving object detecting unit 20. Based on the estimated distance and the relative approach angle detected by the relative approach angle estimating unit 30, the collision risk calculating unit 40 calculates the risk of collision. The reporting unit 50 reports to the driver, based on the risk calculated by the collision risk calculating unit 40. The details will be described below.<!-- EPO <DP n="20"> --></p><p id="p0057" num="0057">The camera 10 is mounted on the vehicle, and captures images of the surroundings of the vehicle. Particularly, the moving object recognition system 100 of this embodiment calculates and reports the risk of a moving object colliding with the vehicle, and therefore, the camera 10 is installed in the vehicle so as to capture images in the traveling direction of the vehicle. The camera 10 may be installed on the back side of the room mirror (the front side), for example, so as to capture images of the scenery ahead of the vehicle. Since the vehicle can move backward, the camera 10 may be installed near the license plate at the rear end, so as to capture images of the scenery behind the vehicle. The camera 10 is a monocular camera that has only one line of an optical system and an imaging element. The camera 10 continuously captures images in regular cycles (every 1/30 second, for example), and outputs image signals.</p><p id="p0058" num="0058">Based on a rigid object model that linearly moves and a pinhole camera model, the moving object detecting unit 20 groups (clusters) feature points of the same moving object in accordance with information about the coordinates and motion vectors (optical flows) of the feature points in the images (for details, see <patcit id="pcit0003" dnum="JP2011081613A"><text>JP 2011-81613 A</text></patcit>). Here, an optical flow is a trajectory formed by tracking the same image patch (a small region of 5 x 5 pixels, for example) in a video or the like. The moving object detecting unit 20 also performs an operation to remove components generated by rotational motion of the camera 10 from the optical flows. The moving object detecting unit 20 includes a combined optical flow calculating unit 21, a rotational motion and vanishing point estimating unit 22, a background point removing unit 23, and a grouping unit 24.</p><p id="p0059" num="0059"><!-- EPO <DP n="21"> --> First, the coordinates used in the following calculations are defined. <figref idrefs="f0003">Fig. 3</figref> is a diagram for explaining the definition of the coordinates in the embodiment of the present invention. When the road surface is flat, the optical axis of the camera 10 is assumed to be parallel to the road surface. The optical axis of the camera 10 is set as the Z-axis, the vertically downward direction is the Y-axis, and the X-axis is defined by the right-handed coordinate system. The point of origin (0, 0, 0) is the optical center of the camera 10. Although the optical axis of the camera 10 is assumed to be parallel to the road surface in this embodiment, generalization can be easily performed by introducing appropriate rotation matrixes even in a case where the optical axis of the camera 10 is not parallel to the road surface. In the case of a perspectively projected model, the image coordinates (x, y) are expressed as (x, y) = (fX/Z, fY/Z). Here, f represents the focal length of the camera 10, which is a known value.</p><p id="p0060" num="0060">The combined optical flow calculating unit 21 extracts common feature points from images obtained by the camera 10, and calculates the optical flow of each of the feature points (see <nplcit id="ncit0001" npl-type="s"><text>J. Shi and C. Tomasi, "Good features to track", IEEE CVPR, pp. 593-600, 1994</text></nplcit>). In this embodiment, the LK method is used as the algorithm for calculating optical flows (see <nplcit id="ncit0002" npl-type="s"><text>B. D. Lucas and T. Kanade, "An iterative image registration technique with an application to stereo vision," IJCAI, pp. 674-679, 1981</text></nplcit>).</p><p id="p0061" num="0061">In optical flow calculations, fewer outliers are preferable. An outlier generally means an unanticipated calculation result, and an outlier of an optical flow specifically means a trajectory that is wrongly tracked. The technique disclosed in <patcit id="pcit0004" dnum="US8184857B"><text>US 8,184,857</text></patcit> is robust over outliers of optical flows, but there are unusual cases where optical flows include the same vanishing point and external ratio within the margin of<!-- EPO <DP n="22"> --> error, though the vanishing point and the external ratio are outliers. In such cases, the outliers are detected, resulting in a risk miscalculation. This embodiment provides an outlier removing method that requires only a small amount of calculation.</p><p id="p0062" num="0062">To increase the accuracy of optical flows, combined optical flows formed by combining optical flows among a few adjacent frames are used in this embodiment, instead of the optical flows between two frames adjacent to each other. In this specification, an optical flow between two frames adjacent to each other, or the vector from a feature point in a certain frame toward the same (the corresponding) feature point in the next frame, is called a "single optical flow". An optical flow obtained by connecting two or more single optical flows, or the vector from a feature point in a certain frame to the same (the corresponding feature point in a frame that is one or a predetermined number of frames away from the certain frame, is called a "combined optical flow".</p><p id="p0063" num="0063"><figref idrefs="f0004">Fig. 4</figref> is a diagram for explaining a combined optical flow in the embodiment of the present invention. In <figref idrefs="f0004">Fig. 4</figref>, images continuously captured by the camera 10 are shown in chronological order from the top in the left column, single optical flows are shown in the center column, and combined optical flows each formed by combining three single optical flows are shown in the right column. The combined optical flow calculating unit 21 combines the single optical flows of the same (the corresponding) feature points among a few frames, to calculate a combined optical flow.</p><p id="p0064" num="0064">As shown in <figref idrefs="f0004">Fig. 4</figref>, a single optical flow is generated by connecting the same feature points between two adjacent frames, and a combined optical flow is generated<!-- EPO <DP n="23"> --> by connecting single optical flows. In the example illustrated in <figref idrefs="f0004">Fig. 4</figref>, each combined optical flow is generated by combining three (n = 3) optical flows.</p><p id="p0065" num="0065">The rotational motion and vanishing point estimating unit 22 estimates a vanishing point from combined optical flows. In general, when three-dimensional points translational-move at a constant velocity, extended lines of the trajectories of motions of the two-dimensional points formed by perspectively projecting those three-dimensional points characteristically intersect at one point. This point of intersection is the vanishing point. In this specification, the term "vanishing point" is used as the intersection point between extended lines of trajectories of points in an image plane. If there are two or more moving objects, a vanishing point is estimated for each of the moving objects.</p><p id="p0066" num="0066"><figref idrefs="f0005">Fig. 5</figref> is a diagram showing the distances over which points in a three-dimensional space (points on a moving object) translational-move in a unit time (the velocity of the points in the three-dimensional space). Where the velocity V is (ΔX, ΔY, ΔZ), x(t) = f(X + tΔX)/(Z + tΔZ) and y(t) = f(Y + tΔY)/(Z + tΔZ), which are the coordinates of an image perspectively projected at time t, converge to (fΔX/ΔZ, fΔY/ΔZ) at the limit of t → -∞ or t → ∞. Accordingly, the two-dimensional coordinates of the vanishing point are expressed as (fΔX/ΔZ, fΔY/ΔZ). Points that converge at t → -∞ are points moving away from the camera, and points that converge at t → ∞ are points moving toward the camera.</p><p id="p0067" num="0067"><figref idrefs="f0006">Fig. 6</figref> is a diagram for explaining the vanishing point. In the example illustrated in <figref idrefs="f0006">Fig. 6</figref>, extended lines of combined optical flows COF1 through COF6 of<!-- EPO <DP n="24"> --> feature points FP1 through FP6 intersect at one point, and this point is the vanishing point VP. The rotational motion and vanishing point estimating unit 22 extends the combined optical flows of respective feature points, and detect the point at which the combined optical flows intersect. The point is estimated to be the vanishing point. Since optical flows include outliers, the optical flows of moving objects, and the optical flows of background objects, it is appropriate to use robust estimation in estimating the vanishing point. Robust estimation is parameter estimation that is robust over outliers. In this embodiment, the M-estimation (see <nplcit id="ncit0003" npl-type="b"><text>P. J. Huber and E. M. Ronchetti, "Robust Statistics, 2nd Edition," Wiley Interscience</text></nplcit>) is used.</p><p id="p0068" num="0068">In a case where the above technique cannot be used due to a limited calculation capability or the like, the rotational motion and vanishing point estimating unit 22 may determine the vanishing point of combined optical flows by performing the simple operation described below. That is, the rotational motion and vanishing point estimating unit 22 records beforehand the position of the horizon in images captured by the camera 10, and the point at which the horizon and combined optical flows intersect is set as the vanishing point of the trajectory of the point. This method is based on the fact that the vanishing point of the trajectory of a moving object exists on the horizon when the moving object and the camera 10 are moving parallel to a flat ground surface. In a case where the tilt angles of combined optical flows are small (where combined optical flows are almost parallel to the horizon), however, errors in-combined optical flows greatly affect the value of the vanishing point. Therefore, if the range of the vanishing point value is too wide within the range of combined optical flow error, this point is eliminated from detection candidates in an exceptional operation.</p><p id="p0069" num="0069"><!-- EPO <DP n="25"> --> The rotational motion and vanishing point estimating unit 22 also estimates the components of optical flows generated by rotational motion of the camera 10, and removes the components from combined optical flows. Where v = (v<sub>x</sub>, v<sub>y</sub>) represents the optical flow of a three-dimensional point (X, Y, Z) perspectively projected by a camera that has a three-dimensional translational motion (V<sub>x</sub>, V<sub>y</sub>, V<sub>z</sub>) and a three-dimensional rotational motion Ω = (Ω<sub>x</sub>, Ω<sub>y</sub>, Ω<sub>z</sub>), this optical flow v is expressed by the following equations (1): <maths id="math0001" num="(1)"><math display="block"><mrow><mrow><mo>{</mo><mtable columnalign="left"><mtr><mtd><msub><mi>v</mi><mi>x</mi></msub><mo>=</mo><mi>x</mi><mo>⁢</mo><mfrac><mrow><msub><mi>V</mi><mi>z</mi></msub></mrow><mi>Z</mi></mfrac><mo>-</mo><mi>f</mi><mo>⁢</mo><mfrac><mrow><msub><mi>V</mi><mi>x</mi></msub></mrow><mi>Z</mi></mfrac><mo>+</mo><msubsup><mi>v</mi><mi>x</mi><mi>r</mi></msubsup><mfenced><mi mathvariant="normal">Ω</mi></mfenced></mtd></mtr><mtr><mtd><msub><mi>v</mi><mi>y</mi></msub><mo>=</mo><mi>y</mi><mo>⁢</mo><mfrac><mrow><msub><mi>V</mi><mi>z</mi></msub></mrow><mi>Z</mi></mfrac><mo>-</mo><mi>f</mi><mo>⁢</mo><mfrac><mrow><msub><mi>V</mi><mi>y</mi></msub></mrow><mi>Z</mi></mfrac><mo>+</mo><msubsup><mi>v</mi><mi>y</mi><mi>r</mi></msubsup><mfenced><mi mathvariant="normal">Ω</mi></mfenced></mtd></mtr></mtable></mrow></mrow></math><img id="ib0001" file="imgb0001.tif" wi="81" he="30" img-content="math" img-format="tif"/></maths></p><p id="p0070" num="0070">Here, x = fX/Z, y = fY/Z, and V<sub>x</sub><sup>r</sup> and v<sub>y</sub><sup>r</sup> are the components of the optical flow formed with the first-order term of the rotation of the camera 10. The components v<sub>y</sub><sup>r</sup> and v<sub>y</sub><sup>r</sup> are expressed by the following equations (2): <maths id="math0002" num="(2)"><math display="block"><mrow><mrow><mo>{</mo><mtable><mtr><mtd><msubsup><mi>v</mi><mi>x</mi><mi>r</mi></msubsup><mfenced><mi mathvariant="normal">Ω</mi></mfenced><mo>=</mo><mfrac><mi mathvariant="italic">xy</mi><mi>f</mi></mfrac><mo>⁢</mo><msub><mi mathvariant="normal">Ω</mi><mi>x</mi></msub><mo>-</mo><mfrac><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>f</mi><mn>2</mn></msup></mrow><mi>f</mi></mfrac><mo>⁢</mo><msub><mi mathvariant="normal">Ω</mi><mi>y</mi></msub><mo>+</mo><mi>y</mi><mo>⁢</mo><msub><mi mathvariant="normal">Ω</mi><mi>z</mi></msub></mtd></mtr><mtr><mtd><msubsup><mi>v</mi><mi>y</mi><mi>r</mi></msubsup><mfenced><mi mathvariant="normal">Ω</mi></mfenced><mo>=</mo><mfrac><mrow><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>f</mi><mn>2</mn></msup></mrow><mi>f</mi></mfrac><mo>⁢</mo><msub><mi mathvariant="normal">Ω</mi><mi>x</mi></msub><mo>-</mo><mfrac><mi mathvariant="italic">xy</mi><mi>f</mi></mfrac><mo>⁢</mo><msub><mi mathvariant="normal">Ω</mi><mi>y</mi></msub><mo>-</mo><mi>x</mi><mo>⁢</mo><msub><mi mathvariant="normal">Ω</mi><mi>z</mi></msub></mtd></mtr></mtable></mrow></mrow></math><img id="ib0002" file="imgb0002.tif" wi="103" he="33" img-content="math" img-format="tif"/></maths></p><p id="p0071" num="0071">According to the equations (2), p<sub>F</sub> = (x<sub>F</sub>, y<sub>F</sub>) = (fV<sub>x</sub>/V<sub>z</sub>, fV<sub>y</sub>/V<sub>z</sub>) is obtained. When the depth components Z and V<sub>z</sub> are eliminated, the following equations (3) are obtained: <maths id="math0003" num="(3)"><math display="block"><mrow><mtable columnalign="left"><mtr><mtd><mi>R</mi><mfenced separators=","><msub><mi>p</mi><mi>F</mi></msub><mo>⁢</mo><mi mathvariant="normal">Ω</mi></mfenced><mo>=</mo><msub><mi>u</mi><mi>x</mi></msub><mo>⁢</mo><mfenced separators=""><mi>y</mi><mo>-</mo><msub><mi>y</mi><mi>F</mi></msub></mfenced><mo>-</mo><msub><mi>u</mi><mi>y</mi></msub><mo>⁢</mo><mfenced separators=""><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>F</mi></msub></mfenced><mo>,</mo></mtd></mtr><mtr><mtd><msub><mi>u</mi><mi>x</mi></msub><mo>=</mo><msub><mi>v</mi><mi>x</mi></msub><mo>-</mo><msubsup><mi>v</mi><mi>x</mi><mi>r</mi></msubsup><mo>,</mo><mspace width="1em"/><msub><mi>u</mi><mi>y</mi></msub><mo>=</mo><msub><mi>v</mi><mi>y</mi></msub><mo>-</mo><msubsup><mi>v</mi><mi>y</mi><mi>r</mi></msubsup></mtd></mtr></mtable></mrow></math><img id="ib0003" file="imgb0003.tif" wi="101" he="18" img-content="math" img-format="tif"/></maths><!-- EPO <DP n="26"> --></p><p id="p0072" num="0072">Here, R(<sub>PF</sub>, Ω) is an error function in the parameter space, and is 0 in an ideal state. That is, the equations (3) mean that extended lines of the optical flows of still points minus rotational components intersect at one point in an image (or at the focus of expansion (FOE)).</p><p id="p0073" num="0073">Since outliers of optical flows and points on a moving object are normally considered to have large R values, the rotational motion and vanishing point estimating unit 22 in this embodiment uses the M-estimation expressed by the equation (4): <maths id="math0004" num="(4)"><math display="block"><mrow><mfenced separators=","><msub><mi>p</mi><mi>F</mi></msub><mo>⁢</mo><mi mathvariant="normal">Ω</mi></mfenced><mo>=</mo><munder><mi>arg min</mi><mrow><msub><mi mathvariant="italic">pʹ</mi><mi>F</mi></msub><mo>,</mo><mi mathvariant="normal">Ωʹ</mi></mrow></munder><mo>⁢</mo><mi>ρ</mi><mfenced separators=""><mi>R</mi><mfenced separators=","><msub><mi mathvariant="italic">pʹ</mi><mi>F</mi></msub><mo>⁢</mo><mi mathvariant="normal">Ωʹ</mi></mfenced></mfenced></mrow></math><img id="ib0004" file="imgb0004.tif" wi="93" he="12" img-content="math" img-format="tif"/></maths></p><p id="p0074" num="0074">Here, p(R) is a function that has 0 as the minimum value and is symmetrical to R = 0. The degree of robustness over outliers is characterized by an influence function ψ(R) = ∂ρ/∂R.</p><p id="p0075" num="0075"><figref idrefs="f0007">Fig. 7A</figref> is a graph showing cost functions of robust estimation, and <figref idrefs="f0007">Fig. 7B</figref> is a graph showing influence functions of robust estimation. In each of <figref idrefs="f0007">Figs. 7A and 7B</figref>, the dashed line indicates the L2-Norm, and the solid line indicates the Cauchy function. In this embodiment, the Cauchy influence function defined by <figref idrefs="f0007">Figs. 7A and 7B</figref> and the following equation (5) is used: <maths id="math0005" num="(5)"><math display="block"><mrow><msub><mi>ψ</mi><mi>C</mi></msub><mfenced><mi>R</mi></mfenced><mo>=</mo><mfrac><mi>R</mi><mrow><mn>1</mn><mo>+</mo><msup><mrow><mfenced separators=""><mi>R</mi><mo>/</mo><mi>C</mi></mfenced></mrow><mn>2</mn></msup></mrow></mfrac></mrow></math><img id="ib0005" file="imgb0005.tif" wi="68" he="14" img-content="math" img-format="tif"/></maths></p><p id="p0076" num="0076">The Cauchy influence function is not a monotonically increasing function where R &gt; 0, but starts decreasing at an extreme value. Accordingly, the influence on a solution of an input with a large error can be restrained to a small degree. The<!-- EPO <DP n="27"> --> constant C in the equation (5) is 2.385. This value is set so as to achieve an efficiency that is 95% of the least square of a Gaussian distribution having the mean value of 0.</p><p id="p0077" num="0077">The rotational motion and vanishing point estimating unit 22 uses iteratively reweighted least squares (IRLS) as the method of the M-estimation. According to this method, the cost function expressed by the equation (4) is transformed into the sum of squares of a weighted error, and a least square operation and a weight updating operation are alternately performed until the solution converges. This weight is expressed as ω = ψ(R)/R according to the influence function. The IRLS algorithm is as follows:
<ul><li>initialize k = 0; p<sub>F</sub><sup>(0)</sup>, Ω<sup>(0)</sup></li><li>repeat
<ul><li>1) k→k+1</li><li>2) calculate error R = R(p<sub>F</sub><sup>(k-1)</sup>, Ω<sup>(k-1)</sup>)</li><li>3) rescale error R → R/(1.48 mad(R))</li><li>4) update weight ω<sup>(k)</sup> = ψ<sub>c</sub>(R)/R</li><li>5) (p<sub>F</sub><sup>(k)</sup>, Ω<sup>(k)</sup>) = are min[ω<sup>(k)</sup>R(p'<sub>F</sub>, Ω')<sup>2</sup>]</li></ul></li></ul>
until convergence</p><p id="p0078" num="0078">The denominator 1.48 mad(R) in the rescaling in step 3) is set so as to be equal to the standard deviation when R follows the normal distribution. The median absolute deviation (mad) is used instead of the standard deviation, to restrain the scale variation due to the existence of outliers to a small degree. Since the error is expressed in the form of the product of the FOE coordinates and the rotation motion, a non-linear least square is obtained in step 4). In this embodiment, the rotational motion and<!-- EPO <DP n="28"> --> vanishing point estimating unit 22 obtains a solution by using the Newton's method. The rotational motion and vanishing point estimating unit 22 removes the detected components generated by the rotational motion from combined optical flows.</p><p id="p0079" num="0079">In a case where an extended straight line of a combined optical flow passes through a vanishing point in a background within an allowable range of error, the background point removing unit 23 removes the combined optical flow as an object that does not move relative to the background or to the ground surface. Since a moving object that moves relative to the ground surface has a vanishing point in a position that is not in the background, the background point removing unit 23 removes the feature points having vanishing points in the background and the combined optical flows of those feature points, so as to detect each moving object having feature points with a vanishing point not belonging to the background.</p><p id="p0080" num="0080">Next, the grouping unit 24 is described. Combined optical flows, which have been generated by the combined optical flow calculating unit 21, from which the components generated by rotational motion have been removed by the rotational motion and vanishing point estimating unit 22, and from which background points have been removed by the background point removing unit 23, include outliers and the optical flows of feature points on a correctly tracked moving object. Using the combined optical flows, the grouping unit 24 groups the feature points and the combined optical flows of the feature points, while removing the outliers.</p><p id="p0081" num="0081">The grouping unit 24 performs robust estimation of a vanishing point for the remaining feature points and the remaining combined optical flows. First, the<!-- EPO <DP n="29"> --> grouping unit 24 groups, as a provisional group, the feature points and the combined optical flows having straight lines that are extended therefrom and pass through the vanishing point within an allowable range of error. The grouping unit 24 removes outliers from the provisional group, and determines an ultimate group. The grouping unit 24 first detects and removes outliers, based on the linearity of each of the combined optical flows. The grouping unit 24 further detects and removes outliers, based on TTC similarities calculated from the combined optical flows. This will be sequentially described below in detail.</p><heading id="h0007">(Outlier Removal Based on Linearity)</heading><p id="p0082" num="0082">In a case where a feature point is correctly tracked, the trajectory of the feature point is a straight line, as long as the point is uniformly and linearly moving in a three-dimensional space. In general, when the position of a moving object is observed at sufficiently short time intervals, a uniform linear motion model is a suitable approximation. Therefore, determining whether single optical flows are linearly arranged is effective in removing outliers.</p><p id="p0083" num="0083"><figref idrefs="f0008">Fig. 8</figref> is a diagram showing an example image in which outliers easily occur. In a case where there are trees in an image, or where the image contains a large number of leaves and brunches having similar shapes, or where the image contains similar patterns, as shown in <figref idrefs="f0008">Fig. 8</figref>, points FP<sub>t1</sub>, FP<sub>t2</sub>, FP<sub>t3</sub>, and FP<sub>t4</sub>, which do not originally correspond to one another, are detected as corresponding feature points among frames. Such feature points and the optical flows connecting those feature points are outliers. If a combined optical flow COF of the feature points FP<sub>t1</sub>, FP<sub>t2</sub>, FP<sub>t3</sub>, and FP<sub>t4</sub>, which are detected as outliers, is determined, the difference between the combined optical flow<!-- EPO <DP n="30"> --> COF and each of the single optical flow is large, as shown in <figref idrefs="f0008">Fig. 8</figref>.</p><p id="p0084" num="0084">To detect and remove such outliers, the grouping unit 24 extracts the components perpendicular to a combined optical flow from each of the single optical flows, quantifies the degrees of linearity based on the extracted components, and compares the values with a threshold value, to detect outliers. Specifically, the grouping unit 24 determines whether each of the single optical flows constituting combined optical flows is linear in the following manner for each feature point.</p><p id="p0085" num="0085">The single optical flows constituting an n-combined optical flow are represented by (V<sub>x</sub>(i), V<sub>y</sub>(i)), i = 1, 2, ..., n, and the n-combined optical flow is represented by (V<sub>x</sub>(1 : n), V<sub>y</sub>(1 : n)). First, the grouping unit 24 calculates a unit vector perpendicular to the combined optical flow. Specifically, the unit vector is expressed as (V<sub>y</sub>(1 : n), -V<sub>x</sub>(1 : n))/sqrt(V<sub>x</sub>(1 : n)<sup>2</sup> + V<sub>y</sub>(1 : <sub>n</sub>)<sup>2</sup>).</p><p id="p0086" num="0086">The absolute value of the inner product of each of the single optical flows constituting the n-combined optical flow and the unit vector is then calculated, and the sum of n absolute values is obtained. The obtained sum is set as the indicator of linearity. The grouping unit 24 compares the linearity indicator with a predetermined threshold value, and excludes the feature points having higher linearity indicators than the threshold value and the combined optical flows of those feature points from the provisional group.</p><heading id="h0008">(Outlier Removal Based on TTC Similarity)</heading><p id="p0087" num="0087">Based on the combined optical flow of each feature point, the grouping unit 24<!-- EPO <DP n="31"> --> calculates the time to collision (TTC). The TTC is the time until a three-dimensional point reaches the image plane while the point is moving toward the camera. In the TTC calculation, the image plane has an infinite area. When the point is moving away from the camera, the TTC has a negative value.</p><p id="p0088" num="0088">Where u is a two-dimensional vector representing the combined optical flow, and u<sub>x</sub> and u<sub>y</sub> are the x component and the y component of the vector, the equation u<sup>2</sup> = u<sub>x</sub><sup>2</sup> + u<sub>y</sub><sup>2</sup> is satisfied, and u<sub>x</sub> is expressed by the following equation (6) using three-dimensional coordinates X and Z, and velocities ΔX and ΔZ: <maths id="math0006" num="(6)"><math display="block"><mrow><msub><mi>u</mi><mi>x</mi></msub><mo>=</mo><mi>x</mi><mfenced><mi>t</mi></mfenced><mo>-</mo><mi>x</mi><mo>⁢</mo><mfenced separators=""><mi>t</mi><mo>-</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>t</mi></mfenced><mo>=</mo><mi>f</mi><mo>⁢</mo><mfrac><mi>X</mi><mi>Z</mi></mfrac><mo>-</mo><mi>f</mi><mo>⁢</mo><mfrac><mrow><mi>X</mi><mo>-</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>X</mi></mrow><mrow><mi>Z</mi><mo>-</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>Z</mi></mrow></mfrac><mo>=</mo><mi>f</mi><mo>⁢</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>X</mi></mrow><mi>Z</mi></mfrac><mo>-</mo><mi>f</mi><mo>⁢</mo><mfrac><mrow><mi>X</mi><mo>⁢</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>Z</mi></mrow><mrow><msup><mi>Z</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mi>O</mi><mfenced><mfrac><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>X</mi><mo>⁢</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>Z</mi></mrow><mrow><msup><mi>Z</mi><mn>2</mn></msup></mrow></mfrac></mfenced></mrow></math><img id="ib0006" file="imgb0006.tif" wi="163" he="14" img-content="math" img-format="tif"/></maths></p><p id="p0089" num="0089">Here, f represents the focal length of the camera 10. Since the terms with the squares of velocities can be ignored, the following equation (7) is obtained: <maths id="math0007" num="(7)"><math display="block"><mrow><msub><mi>u</mi><mi>x</mi></msub><mo>≈</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>T</mi></mrow></mfrac><mo>⁢</mo><mfenced separators=""><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>∞</mi></msub></mfenced></mrow></math><img id="ib0007" file="imgb0007.tif" wi="65" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0090" num="0090">Here, the x-coordinate X<sub>∞</sub> of the vanishing point is a convergence position when it is infinitely going back in time (where the point is moving toward the camera). Therefore, the x-coordinate X<sub>∞</sub> of the vanishing point is expressed by the following equation (8): <maths id="math0008" num="(8)"><math display="block"><mrow><msub><mi>x</mi><mi>∞</mi></msub><mo>=</mo><munder><mi>lim</mi><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>t</mi><mo>→</mo><mi>∞</mi></mrow></munder><mo>⁢</mo><mi>f</mi><mo>⁢</mo><mfrac><mrow><mi>X</mi><mo>-</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>t</mi><mo>⁢</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>X</mi></mrow><mrow><mi>Z</mi><mo>-</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>t</mi><mo>⁢</mo><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>Z</mi></mrow></mfrac><mo>=</mo><mi>f</mi><mo>⁢</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>X</mi></mrow><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>Z</mi></mrow></mfrac></mrow></math><img id="ib0008" file="imgb0008.tif" wi="91" he="13" img-content="math" img-format="tif"/></maths></p><p id="p0091" num="0091">Where TTC is represented by ΔT, ΔT is determined by Z/(-ΔZ) (ΔZ &lt; 0, if the feature point is moving toward the camera). Since the y component u<sub>y</sub> of the optical<!-- EPO <DP n="32"> --> flow can be calculated in the same manner, the following equation (9) is obtained: <maths id="math0009" num="(9)"><math display="block"><mrow><msub><mi>u</mi><mi>y</mi></msub><mo>≈</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>T</mi></mrow></mfrac><mo>⁢</mo><mfenced separators=""><mi>y</mi><mo>-</mo><msub><mi>y</mi><mi>∞</mi></msub></mfenced></mrow></math><img id="ib0009" file="imgb0009.tif" wi="69" he="14" img-content="math" img-format="tif"/></maths></p><p id="p0092" num="0092">When the equation (7) and the equation (9) are simultaneously solved, the following equation (10) is obtained: <maths id="math0010" num="(10)"><math display="block"><mrow><mi mathvariant="normal">Δ</mi><mo>⁢</mo><mi>T</mi><mo>=</mo><mfrac><mrow><mi>u</mi><mo>⋅</mo><mfenced separators=""><mi>p</mi><mo>-</mo><msub><mi>p</mi><mi>∞</mi></msub></mfenced></mrow><mrow><msup><mi>u</mi><mn>2</mn></msup></mrow></mfrac></mrow></math><img id="ib0010" file="imgb0010.tif" wi="65" he="14" img-content="math" img-format="tif"/></maths></p><p id="p0093" num="0093">Here, p represents the coordinates of a feature point in the image, p<sub>∞</sub> represents the coordinates of the vanishing point of the trajectory of the point in the image, and "." is the inner product operator.</p><p id="p0094" num="0094">The grouping unit 24 calculates the time to collision ΔT<sub>n</sub> from the n-combined optical flow (V<sub>x</sub>(1 : n), V<sub>y</sub>(1 : n)) of each feature point, using the equation (10). The grouping unit 24 also calculates ΔT<sub>n-1</sub>, ΔT<sub>n-2</sub>, ... of the same feature point in the same manner as ΔT<sub>n</sub>. In a case where a feature point is correctly tracked, ΔT<sub>n</sub>, ΔT<sub>n-1</sub>, ... are equal to one another, as long as the point is uniformly and linearly moving in a three-dimensional space. In a case where a moving object is observed at sufficiently short time intervals, a uniform linear motion model is a suitable approximation, as described above. Therefore, it is safe to say that ΔT<sub>n</sub>, ΔT<sub>n-1</sub>, ... are similar to one another. If ΔT<sub>n</sub>, ΔT<sub>n-1</sub>, ... are not similar, the point has been wrongly tracked, and can be determined to be an outlier.</p><p id="p0095" num="0095">The grouping unit 24 determines the similarity among the times to collision ΔT<sub>n</sub>, ΔT<sub>n-1</sub>, ... for each of the feature points of n-combined optical flows, and compares the similarity with a predetermined threshold value. The grouping unit 24 excludes the<!-- EPO <DP n="33"> --> feature points having smaller values than the threshold value and the combined optical flows of those feature points from the provisional group. Specifically, the grouping unit 24 quantifies the differences in TTC as D<sub>j</sub> = |ΔT<sub>n-j</sub> - ΔT<sub>n</sub>| (j = 1, ..., n-1). If there is at least one "j" satisfying D<sub>j</sub> &gt; D<sub>th</sub>, the feature point(s) and the combined optical flow(s) of the feature point(s) are excluded from the group. Here, D<sub>th</sub> is the predetermined threshold value.</p><p id="p0096" num="0096">The grouping unit 24 groups combined optical flows by removing outliers according to the above described method based on linearity and the method based on the TTC similarity. The feature points of combined optical flows grouped together are feature points of one moving object. The grouping unit 24 detects a moving object by grouping feature points in the above manner. The grouping unit 24 may remove outliers by using only the method based on linearity or using only the method based on TTC similarity.</p><p id="p0097" num="0097">Next, the relative approach angle estimating unit 30 is described. The relative approach angle estimating unit 30 estimates the relative approach angle of a moving object detected by the moving object detecting unit 20 with respect to the vehicle. <figref idrefs="f0009">Figs. 9A and 9B</figref> are diagrams for explaining the definition of a relative approach angle. <figref idrefs="f0009">Fig. 9A</figref> illustrates a case where θ &lt; 0, and <figref idrefs="f0009">Fig. 9B</figref> illustrates a case where θ &gt; 0. As shown in <figref idrefs="f0009">Figs. 9A and 9B</figref>, when a three-dimensional point moves from P<sub>0</sub> to P<sub>1</sub>, the angle expressed by the following equation (11) is defined as the relative approach angle: <maths id="math0011" num="(11)"><math display="block"><mrow><mi>θ</mi><mo>=</mo><mi>arctan</mi><mfenced><mfrac><mrow><mfenced open="|" close="|" separators=""><msub><mi>P</mi><mn>0</mn></msub><mfenced><mi>X</mi></mfenced><mo>-</mo><msub><mi>P</mi><mn>1</mn></msub><mfenced><mi>X</mi></mfenced></mfenced></mrow><mrow><msub><mi>P</mi><mn>0</mn></msub><mfenced><mi>Z</mi></mfenced><mo>-</mo><msub><mi>P</mi><mn>1</mn></msub><mfenced><mi>Z</mi></mfenced></mrow></mfrac></mfenced></mrow></math><img id="ib0011" file="imgb0011.tif" wi="87" he="17" img-content="math" img-format="tif"/></maths></p><p id="p0098" num="0098">When there are points that share the same vanishing point within an allowable<!-- EPO <DP n="34"> --> range of error, the relative approach angles of those points can be estimated.</p><p id="p0099" num="0099"><figref idrefs="f0010">Fig. 10</figref> is a diagram showing the relationship between relative approach angles and a vanishing point. When three-dimensional points Pa and Pb on a moving object are in translational motion at the same velocity, the trajectories of those points after perspective projection have a vanishing point. Where the vector V from the optical center toward the vanishing point VP is (fΔX/ΔZ, fΔY/ΔZ, f), the vector V is a constant number of times (f/ΔZ times) larger than the velocity vectors of the points Pa and Pb, va = vb = (ΔX, ΔY, ΔZ). Therefore, where an image plane perpendicular to the Z direction is set at the distance equivalent to the focal length f from the optical center in the Z direction, the vector V from the optical center toward the vanishing point VP in the image is parallel to the velocity vectors va and vb of the three-dimensional points Pa and Pb on the moving object that are in translational motion at the same velocity. In view of this, the relative approach angle is expressed by the following equation (12): <maths id="math0012" num="(12)"><math display="block"><mrow><mi>θ</mi><mo>=</mo><mi>arctan</mi><mfenced><mfrac><mrow><mfenced open="|" close="|" separators=""><msub><mi>P</mi><mn>0</mn></msub><mfenced><mi>X</mi></mfenced><mo>-</mo><msub><mi>P</mi><mn>1</mn></msub><mfenced><mi>X</mi></mfenced></mfenced></mrow><mrow><msub><mi>P</mi><mn>0</mn></msub><mfenced><mi>Z</mi></mfenced><mo>-</mo><msub><mi>P</mi><mn>1</mn></msub><mfenced><mi>Z</mi></mfenced></mrow></mfrac></mfenced><mo>=</mo><mi>arctan</mi><mfenced><mfrac><mrow><mfenced open="|" close="|"><mi>ΔX</mi></mfenced></mrow><mrow><mo>-</mo><mi>ΔZ</mi></mrow></mfrac></mfenced><mo>=</mo><mi>s</mi><mo>*</mo><mi>arctan</mi><mfenced><mfrac><mrow><mfenced open="|" close="|"><msub><mi mathvariant="normal">x</mi><mi>∞</mi></msub></mfenced></mrow><mi>f</mi></mfrac></mfenced></mrow></math><img id="ib0012" file="imgb0012.tif" wi="140" he="15" img-content="math" img-format="tif"/></maths></p><p id="p0100" num="0100">Here, X<sub>∞</sub> is fΔX/ΔZ, and s is +1 when the two-dimensional points are moving away from the vanishing point (ΔZ &lt; 0), and s is -1 when the two-dimensional points are moving toward the vanishing point (ΔZ &gt; 0). According to the equation (12), the relative approach angle estimating unit 30 calculates an estimated value of the relative approach angle of a moving object detected by the moving object detecting unit 20 with respect to the vehicle.</p><p id="p0101" num="0101">Next, the collision risk calculating unit 40 is described. The collision risk calculating unit 40 calculates the risk of a moving object colliding with its own vehicle,<!-- EPO <DP n="35"> --> based on the relative approach angle, the TTC, and an estimated distance value. The collision risk calculating unit 40 includes a distance estimating unit 41 and a risk calculating unit 42. The distance estimating unit 41 estimates the Z-direction distance from its own vehicle to a moving object (hereinafter referred to simply as the "distance"). Based on the distance estimated by the distance estimating unit 41, the risk calculating unit 42 calculates the risk of the moving object colliding with its own vehicle.</p><p id="p0102" num="0102">The methods described below can be used by the distance estimating unit 41 to estimate the distance. The distance estimating unit 41 may estimate the distance by using one of the methods described below, or may estimate the distance by using two or more of the methods. The estimated distance is to be used by the risk calculating unit 42 to calculate a degree of risk. Therefore, the distance estimating unit 41 estimates the distance required by the method to be used by the risk calculating unit 42 to calculate a degree of risk. The following is a description of those estimation methods.</p><heading id="h0009">(First Example of Distance Estimation Method: Method of Calculating the Upper Limit of the Distance)</heading><p id="p0103" num="0103">In a first example, the distance estimating unit 41 estimates the upper limit of the distance to a moving object. <figref idrefs="f0011">Fig. 11</figref> is a diagram for explaining the ground surface point according to a first example of a distance estimation method. <figref idrefs="f0012">Fig. 12</figref> is a diagram for explaining the calculation of the upper limit value of the distance according to the first example of a distance estimation method. As shown in <figref idrefs="f0011">Fig. 11</figref>, the distance estimating unit 41 selects the feature point having the largest y-coordinate value among feature points grouped together (the selected feature point will be hereinafter referred to<!-- EPO <DP n="36"> --> as the "lowest feature point"), and calculates the coordinates of the intersection point (hereinafter referred to as the "ground surface point") GP between the straight line connecting the lowest feature point to the optical center and the ground surface G.</p><p id="p0104" num="0104">As shown in <figref idrefs="f0011">Fig. 11</figref>, as long as the feature points detected as points on the moving object are located above the ground surface, the Z-coordinate of the three-dimensional point indicated by the lowest feature point is smaller than the Z-coordinate of the ground surface point GP. If the distances between feature points among the feature points grouped together are sufficiently shorter than the distance from the camera 10, the Z-coordinate of the ground surface point GP can be regarded as the upper limit value of the Z-coordinates of the feature points. The Z-coordinate of the ground surface point GP, or the upper limit value D1 of the distance, is expressed as D1 = Hc*f/y_max, as shown in <figref idrefs="f0012">Fig. 12</figref>. Here, Hc represents the height of the camera 10 from the ground surface, y_max represents the y-coordinate of the lowest feature point, and f represents the focal length or the distance from the optical center of the camera 10 to the image plane IP. It should be noted that this method can be used only when y_max has a positive value. The distance estimating unit 41 calculates Hc*f/y_max as the upper limit value D1 of the distance.</p><heading id="h0010">(Second Example of Distance Estimation Method: Method of Directly Estimating the Distance)</heading><p id="p0105" num="0105">In a second example, the distance estimating unit 41 identifies a point representing a moving object, and directly estimates the distance by using the translational motion velocity of its own vehicle and the time to collision TTC of the representative point. The distance estimating unit 41 selects a representative point<!-- EPO <DP n="37"> --> from feature points grouped together as a moving object. The TTC of the feature point selected as the representative point has been determined by the moving object detecting unit 20, and therefore, is used herein. Where ΔT represents the TTC, the TTC is expressed as ΔT = Z/(-ΔZ). If the moving object is translationally moving in a direction perpendicular to the traveling direction of the vehicle, ΔZ is -V<sub>c</sub>. Here, V<sub>c</sub> represents the translational motion velocity of the vehicle, and the distance estimating unit 41 obtains the translational motion velocity V<sub>c</sub> through a mechanism (not shown). Based on Z = ΔTV<sub>c</sub>, the distance estimating unit 41 estimates the distance Z from its own vehicle to the moving object.</p><heading id="h0011">(Third Example of Distance Estimation Method: Method of Determining a Distance Probability Distribution)</heading><p id="p0106" num="0106">In a third example, the distance estimating unit 41 identifies a point representing a moving object, and determines a distance probability distribution by using the time to collision TTC of the representative point. The distance estimating unit 41 selects a representative point from feature points grouped together as a moving object. The TTC of the feature point selected as the representative point has been determined by the moving object detecting unit 20, and therefore, is used herein. In the third example, the distance estimating unit 41 provisionally determines the probability distribution of the velocity of a moving object in the Z direction. An object that moves at a different relative approach angle from the relative approach angle of background points has an angle that is not zero with respect to the direction of translational motion of the vehicle. It is empirically appropriate to determine a normal distribution with an average of 0 to be the probability distribution of the Z-direction velocity of such a moving object.<!-- EPO <DP n="38"> --></p><p id="p0107" num="0107">The distance estimating unit 41 stores beforehand the average -V of the Z-direction velocity ΔZ of the representative point of a moving object, and also stores a fixed value of 3 km/h, for example, as the standard deviation σ. The probability distribution of the Z-direction velocity ΔZ of the representative point of the moving object conforms to the normal distribution with the average -V and the standard deviation σ. Where ΔT represents the TTC, the distance to the representative point is expressed as Z = ΔT(-ΔZ). Accordingly, the probability distribution of the distance Z to the representative point conforms to a normal distribution with an average ΔT(-V) and a standard deviation ΔTσ. The distance estimating unit 41 determines the normal distribution with the average ΔT(-V) and the standard deviation ΔTσ to be the probability distribution of the distance Z to the representative point.</p><p id="p0108" num="0108">The risk calculating unit 42 defines a danger zone based on the relative approach angle θ estimated by the relative approach angle estimating unit 30, and then calculates the risk of a moving object colliding with its own vehicle. A danger zone is a region in the X-Z plane. In such a danger zone, when a point in the X-Z plane moves toward the vehicle at a certain relative approach angle, the point collides with the vehicle. However, the region occupied by its own vehicle in the X-Z plane is a non-danger zone. The risk calculating unit 42 calculates the risk by using a method compatible with the distance estimation method used by the distance estimating unit 41. The following is a description of risk calculations.</p><heading id="h0012">(First Example of Risk Calculation: Risk Calculation Based on an Estimated Upper Limit Value of the Distance)</heading><!-- EPO <DP n="39"> --><p id="p0109" num="0109"><figref idrefs="f0013">Fig. 13</figref> is a diagram for explaining a risk calculation based on an estimated value of the upper limit of the distance. A danger zone DZ extends in a direction tilted at the relative approach angle θ with respect to the traveling direction of the vehicle C (or the Z-axis direction), and has a width equivalent to the width of the vehicle C in a direction perpendicular to the tilted direction. The danger zone DZ is closer to the vehicle C than the estimated upper limit D1 of the distance. When there is a moving object on the right side of the vehicle C, the risk calculating unit 42 sets a danger zone that is tilted at the relative approach angle θ to the right. When there is a moving object on the left side of the vehicle C, the risk calculating unit 42 sets a danger zone that is tilted at the relative approach angle θ to the left. A ray formed on the X-Z plane by orthographically projecting a straight line passing through the optical center and a point in the image is called an XZ ray. In other words, an XZ ray is a straight line that has a tilt angle expressed as X/Z = x/f, and passes through the point of origin. In <figref idrefs="f0013">Fig. 13</figref>, an XZ ray (1) and an XZ ray (2) are shown.</p><p id="p0110" num="0110">The risk calculating unit 42 identifies a point representing the moving object, and calculates the risk of the representative point colliding with the vehicle C by using the XZ ray of the representative point and the danger zone DZ. Specifically, the risk calculating unit 42 calculates the proportion of the line segment existing in the danger zone DZ to the line segment of the XZ ray of the representative point between the point of origin and the upper limit value D1. The value of the calculated proportion is set as the risk. In the example illustrated in <figref idrefs="f0013">Fig. 13</figref>, the risk in the XZ ray (1) is expressed as L1/(L1 + L2), and the risk in the XZ ray (2) is 100% (the maximum) as the entire XZ ray (2) is in the danger zone DZ.</p><p id="p0111" num="0111"><!-- EPO <DP n="40"> --> As is apparent from <figref idrefs="f0013">Fig. 13</figref>, in this example, the risk becomes higher, as the difference between the direction at the relative approach angle θ and the direction of the positional vector of the representative point becomes smaller (or the degree of coincidence becomes higher) in the X-Z plane. In other words, the risk becomes higher, as the vanishing point and the representative point become closer to each other in the image.</p><p id="p0112" num="0112">The risk calculating unit 42 may turn the proportion into a discrete value by rounding or the like, and calculates the risk as a level among several different levels. In this case, the level of risk is higher where the proportion is higher.</p><heading id="h0013">(Second Example of Risk Calculation: Risk Calculation Based on an Estimated Distance Value)</heading><p id="p0113" num="0113"><figref idrefs="f0014">Fig. 14</figref> is a diagram for explaining a risk calculation based on an estimated distance value. The risk calculating unit 42 sets a danger zone DZ that extends in a direction tilted at the relative approach angle θ with respect to the traveling direction of the vehicle C (or the Z-axis direction), and has a width equivalent to the width of the vehicle C in a direction perpendicular to the tilted direction, as in the above described calculation example. When there is a moving object on the right side of the vehicle C, the risk calculating unit 42 sets a danger zone that is tilted at the relative approach angle θ to the right, as in the above described example. When there is a moving object on the left side of the vehicle C, the risk calculating unit 42 sets a danger zone that is tilted at the relative approach angle θ to the left, as in the above described example. In this example, however, the upper limit of the danger zone DZ is not to be set. Since the distance D2 to the representative point is estimated in this example, the intersection<!-- EPO <DP n="41"> --> point between the XZ ray of the representative point and the estimated distance value D2 is the (X, Z) coordinates of the representative point. Accordingly, the risk is determined from whether the (X, Z) coordinates of the representative point are in the danger zone DZ. That is, when the (X, Z) coordinates of the representative point are in the danger zone DZ, it is determined that there is a risk. When the (X, Z) coordinates of the representative point are not in the danger zone DZ, it is determined that there is no risk.</p><p id="p0114" num="0114">In <figref idrefs="f0014">Fig. 14</figref>, the intersection point between the XZ ray (1) and the estimated distance value D2 is outside the danger zone DZ. Therefore, as for the XZ ray (1), it is determined that there is no risk. The intersection point between the XZ ray (2) and the estimated distance value D2 is in the danger zone DZ. Therefore, as for the XZ ray (2), it is determined that there is a risk.</p><p id="p0115" num="0115"><figref idrefs="f0015">Fig. 15</figref> is a diagram for explaining a modification of this example. In this modification, a danger zone DZ is divided into levels in a stepwise fashion, as shown in <figref idrefs="f0015">Fig. 15</figref>. In this modification, a danger zone DZ1 includes a larger proportion of the front portion (including the front bumper) of the vehicle C, and has a high risk level. A danger zone DZ2 having an intermediate risk level is set outside the danger zone DZ1. A danger zone DZ3 having a relatively low risk level is set around the danger zone DZ2. The risk calculating unit 42 determines the risk level based on which danger zone includes the intersection point between the XZ ray and the estimated distance value D2, in the same manner as above. The dividing of the danger zone into a few levels may be applied to the first example and to the third and fourth examples described later.</p><p id="p0116" num="0116"><!-- EPO <DP n="42"> --> In this example, the risk calculation is performed so that the risk becomes higher as the difference between the direction at the relative approach angle θ and the direction of the positional vector of the representative point becomes smaller (or the degree of coincidence becomes higher) in the X-Z plane, or the risk becomes higher as the vanishing point and the representative point become closer to each other in the image, as in the above described example.</p><heading id="h0014">(Third Example of Risk Calculation: Risk Calculation Based on a Distance Probability Distribution)</heading><p id="p0117" num="0117"><figref idrefs="f0016">Fig. 16</figref> is a diagram for explaining a risk calculation based on a distance probability distribution. The risk calculating unit 42 calculates a boundary point BP (X<sub>BP</sub>, Z<sub>BP</sub>) existing exactly on the boundary between a danger zone DZ and a safety zone SZ on the XZ ray of a representative point. The risk calculating unit 42 divides the distance probability distribution estimated by the distance estimating unit 41 into two portions, with the Z-coordinate (Z<sub>BP</sub>) of the boundary point BP being the boundary. As a result, the value of the integral S1 of the probability density function of the probability distribution on the side of the danger zone DZ in the area of the entire probability distribution indicates the probability that the representative point is in the danger zone DZ, and the value of the integral S2 of the probability density function of the probability distribution on the side of the safety zone SZ in the area of the entire probability distribution indicates the probability that the representative point is in the safety zone SZ.</p><p id="p0118" num="0118">The risk calculating unit 42 determines the risk in the representative point to be the probability that the representative point is in the danger zone DZ. If the distance<!-- EPO <DP n="43"> --> distribution estimated by the distance estimating unit 41 is a normal distribution, an error function can be used to obtain the integral of the distance distribution. The risk calculating unit 42 may set the probability as the risk, or determine the risk from a discrete level.</p><p id="p0119" num="0119">In this example, the risk calculation is performed so that the risk becomes higher as the difference between the direction at the relative approach angle θ and the direction of the positional vector of the representative point becomes smaller (or the degree of coincidence becomes higher) in the X-Z plane, or the risk becomes higher as the vanishing point and the representative point become closer to each other in the image, as in the above described examples.</p><heading id="h0015">(Fourth Example of Risk Calculation: Risk Calculation Based on an Estimated Upper Limit of the Distance and an Estimated Distance Distribution)</heading><p id="p0120" num="0120"><figref idrefs="f0017">Fig. 17</figref> is a diagram for explaining a risk calculation based on an estimated upper limit of the distance and an estimated distance distribution. In a fourth example, the distance estimating unit 41 calculates the upper limit of the distance, and determines the distance probability distribution. The risk calculating unit 42 cuts the distance probability distribution determined by the distance estimating unit 41 at the estimated value D1 of the upper limit of the distance determined by the distance estimating unit 41, to form a single cutoff normal distribution. Using the distribution below the upper limit D1 of the distance, the risk calculating unit 42 calculates a boundary point BP (X<sub>BP</sub>, Z<sub>BP</sub>) existing exactly on the boundary between a danger zone DZ and a safety zone SZ on the XZ ray of the representative point in the same manner as in the third example. The risk calculating unit 42 divides the single cutoff normal distribution into two<!-- EPO <DP n="44"> --> portions, with the Z-coordinate (Z<sub>BP</sub>) of the boundary point BP being the boundary.</p><p id="p0121" num="0121">The value of the integral of the probability density function of the XZ ray of the representative point within the distance range up to the upper limit value D1 of the distance is the value of the integral of the single cutoff normal distribution, and is expressed as S1 + S2', which is normally not 100%. The value of the integral of the probability density function of the XZ ray of the representative point within the distance range in the danger zone DZ is S1 shown in <figref idrefs="f0017">Fig. 17</figref>. In this example, the proportion of S1 to S1 + S2' (S1/(S1 +S2')) is the risk in the representative point. In this example, the risk calculating unit 42 may calculate S1/(S1 + S2') as the risk, or determine the risk from a discrete level, as in the above described example.</p><p id="p0122" num="0122">In this example, the risk calculation is performed so that the risk becomes higher as the difference between the direction at the relative approach angle θ and the direction of the positional vector of the representative point becomes smaller (or the degree of coincidence becomes higher) in the X-Z plane, or the risk becomes higher as the vanishing point and the representative point become closer to each other in the image, as in the above described examples.</p><p id="p0123" num="0123">As described above, in any of the first through fourth examples of risk calculations, the risk is calculated in such a manner that the risk becomes higher as the difference between the direction at the relative approach angle θ and the direction of the positional vector of the representative point becomes smaller (or the degree of coincidence becomes higher) in the X-Z plane, or the risk becomes higher as the vanishing point and the representative point become closer to each other in the image.<!-- EPO <DP n="45"> --> There can be other such examples. The collision risk calculating unit 40 may calculate the risk as the difference in angle between the direction at the relative approach angle θ and the direction of the positional vector of the representative point, or the distance between the vanishing point and the representative point in the image.</p><heading id="h0016">(Modification of Risk Calculation)</heading><p id="p0124" num="0124">This modification can be applied to the above described first through fourth calculation examples. In this modification, the TTC is also used in calculating the risk in any of the above described first through fourth calculation examples. An object having a short TTC of course has a higher degree of risk than an object having a long TTC. Therefore, each risk calculated in the first through fourth calculation examples is corrected based on the length of the TTC, so that the risk becomes higher as the TTC becomes shorter.</p><p id="p0125" num="0125">Specifically, in a case where the risk is obtained from continuous values, the risk calculated in any of the first through fourth calculation examples is multiplied by a TTC level, which is the reciprocal of the TTC, for example. In this manner, the risk can be corrected. In a case where the risk is expressed as a discrete level, the value of the TTC is divided into three levels, as shown in <figref idrefs="f0018">Fig. 18</figref>, and the risk can be corrected by the combination of the risk level and the TTC level, for example.</p><p id="p0126" num="0126">As described above, the distance estimating unit 41 and/or the risk calculating unit 42 selects a representative point from feature points grouped as a moving object, and then estimates the distance and/or calculates the risk. However, the distance estimating unit 41 and/or the risk calculating unit 42 may identify two or more<!-- EPO <DP n="46"> --> representative points of one moving object, estimate the distances to the respective representative points and/or calculate the risks in the respective representative points, calculate the average of the calculated risks in the representative points, and set the average as the risk of the moving object colliding with the vehicle. Also, the representative point may not be one of the feature points grouped as the moving object, but may be a point determined based on the feature points, such as the midpoint, the gravity point, or the like among the feature points.</p><p id="p0127" num="0127">The reporting unit 50 reports a danger to the driver in accordance with the risk of collision calculated by the collision risk calculating unit 40. The moving object recognition system 100 includes a display such as a head-up display. The image captured by the camera 10 is displayed on the display in real time. A rectangular frame surrounding the feature points grouped by the moving object detecting unit 20 is superimposed on the image. At this point, the reporting unit 50 changes the color or the thickness of the rectangular frame in accordance with the risk. Also, the reporting unit 50 may report the danger of collision to the driver with sound. In this case, as the risk becomes higher, the sound level may be increased or the frequency of the sound may be increased to alert the driver.</p><p id="p0128" num="0128">An automatic braking system may be used together with the reporting unit 50, or instead of the reporting unit 50. The automatic braking system receives the information about the risk calculated by the collision risk calculating unit 40, and performs braking on the vehicle. With this automatic braking system, automatic braking can be performed on the vehicle in a dangerous situation. A storage device may also be used together with the reporting unit 50, or instead of the reporting unit 50.<!-- EPO <DP n="47"> --> The storage device stores the information about the risk calculated by the collision risk calculating unit 40, together with the positional information and the temporal information corresponding to the information about the risk. By referring to the record of the risk, the danger zone and time can be recognized, and the state of safe driving by the driver can be checked.</p><p id="p0129" num="0129">As described above, the moving object recognition system 100 of the embodiment of the present invention obtains continuous single-view images with a camera installed in the vehicle, and groups together the feature points in the images based on a vanishing point. In this manner, the moving object recognition system 100 detects a moving object. Based on the images, the moving object recognition system 100 estimates a relative approach angle, and calculates the risk of the moving object colliding with the vehicle by using the relative approach angle. The risk is an indicator with a physical meaning. As the risk is reported to the driver, the driver can instinctively recognize a dangerous situation, or can perform a control operation in accordance with the dangerous situation. Also, the moving object recognition system 100 of the embodiment of the present invention calculates the risk in such a manner that the risk becomes higher as the difference between the direction at the relative approach angle and the direction of the positional vector of the detected moving object becomes smaller. Accordingly, the risk of collision can be accurately calculated.</p><p id="p0130" num="0130">Furthermore, to calculate the risk of collision, neither a stereo camera nor a distance sensor is used, but a relatively inexpensive monocular camera is used. Accordingly, the costs can be lowered. The moving object recognition system 100 of the embodiment of the present invention may use a distance sensor, as well as the above<!-- EPO <DP n="48"> --> described structure. In this case, the moving object recognition system 100 compares the information about a moving object trajectory obtained by the distance sensor with the information about the relative approach angle, the time to collision, the estimated distance to the moving object, and the like obtained by the above described structure. By doing so, the moving object recognition system 100 can increase the reliability of the detection. In the case where the distance sensor is also used, the distance to the moving object is also obtained by the distance sensor, and is used to improve the accuracy of calculating the risk of collision of the moving object.</p><p id="p0131" num="0131">Also, in detecting a moving object, combined optical flows are generated, and outliers are removed. Accordingly, the accuracy of detecting a moving object can be increased.</p><p id="p0132" num="0132">The present invention has an effect to calculate the risk of a moving object colliding with the vehicle, and uses the calculated risk as the information useful for the driver of the vehicle to drive safely. The present invention is effectively applied to a moving object recognition system that recognizes a moving object by using single-view images, and the likes.</p><p id="p0133" num="0133">While the non-limiting example embodiments have been described in detail, the foregoing description is in all aspects illustrative and not restrictive. It will be understood that numerous other modifications and variations can be devised without departing from the scope of the invention.
<dl id="dl0001"><dt>100</dt><dd>moving object recognition system<!-- EPO <DP n="49"> --></dd><dt>10</dt><dd>camera</dd><dt>20</dt><dd>moving object detecting unit</dd><dt>21</dt><dd>combined optical flow calculating unit</dd><dt>22</dt><dd>rotational motion and vanishing point estimating unit</dd><dt>23</dt><dd>background point removing unit</dd><dt>24</dt><dd>grouping unit</dd><dt>30</dt><dd>relative approach angle estimating unit</dd><dt>40</dt><dd>collision risk calculating unit</dd><dt>41</dt><dd>distance estimating unit</dd><dt>42</dt><dd>risk calculating unit</dd><dt>50</dt><dd>reporting unit</dd></dl></p></description><claims mxw-id="PCLM90459452" lang="EN" load-source="patent-office"><!-- EPO <DP n="50"> --><claim id="c-en-0001" num="0001"><claim-text>A moving object recognition system <b>characterized by</b> including:
<claim-text>a camera (10) configured to capture a plurality of continuous single-view images, the camera (10) being installed in a vehicle;</claim-text>
<claim-text>a moving object detecting unit (20) configured to detect a moving object by extracting a plurality of feature points from the images captured by the camera (10), generating optical flows of the extracted feature points, grouping, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and</claim-text>
<claim-text>a collision risk calculating unit (40) configured to calculate a risk of the moving object colliding with the vehicle,</claim-text>
<claim-text>and <b>characterized in that</b> the collision risk calculating unit (40) calculates the risk in such a manner that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.</claim-text></claim-text></claim><claim id="c-en-0002" num="0002"><claim-text>The moving object recognition system of claim 1, <b>characterized in that</b> the collision risk calculating unit (40) calculates a risk of a representative point with the vehicle, the representative point being one of the feature points existing on the moving object or a point determined from the feature points existing on the moving object.</claim-text></claim><claim id="c-en-0003" num="0003"><claim-text>The moving object recognition system of claim 1 or 2, <b>characterized by</b> further including a reporting unit (50) configured to report a danger to a driver of the vehicle in accordance with the risk calculated by the collision risk calculating unit (40).<!-- EPO <DP n="51"> --></claim-text></claim><claim id="c-en-0004" num="0004"><claim-text>The moving object recognition system of one of claims 1 to 3, <b>characterized in that</b> the collision risk calculating unit (40) corrects the risk, based on a time to collision of the moving object with the vehicle.</claim-text></claim><claim id="c-en-0005" num="0005"><claim-text>A moving object recognition program <b>characterized by</b> causing a computer to function as:
<claim-text>a moving object detecting unit (20) configured to detect a moving object by extracting a plurality of feature points from a plurality of continuous single-view images captured by a camera (10) installed in a vehicle, generating optical flows of the extracted feature points, grouping, among the extracted feature points, a plurality of feature points having the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and</claim-text>
<claim-text>a collision risk calculating unit (40) configured to calculate a risk of the moving object colliding with the vehicle in such a manner that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.</claim-text></claim-text></claim><claim id="c-en-0006" num="0006"><claim-text>A moving object recognition method <b>characterized by</b> including:
<claim-text>capturing a plurality of continuous single-view images with a camera (10) installed in a vehicle;</claim-text>
<claim-text>detecting a moving object by extracting a plurality of feature points from the images captured by the camera (10), generating optical flows of the extracted feature points, grouping, among the extracted feature points, a plurality of feature points having<!-- EPO <DP n="52"> --> the optical flows extended therefrom and converging at a vanishing point, and detecting the grouped feature points as the moving object; and</claim-text>
<claim-text>calculating a risk of the moving object colliding with the vehicle,</claim-text>
<claim-text>and <b>characterized in that</b> the risk is calculated in such a manner that the risk of the moving object located at a short distance from the vanishing point in the images becomes higher than the risk of the moving object at a long distance from the vanishing point in the images.</claim-text></claim-text></claim></claims><drawings mxw-id="PDW20422179" load-source="patent-office"><!-- EPO <DP n="53"> --><figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="151" he="231" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="54"> --><figure id="f0002" num="2(a),2(b)"><img id="if0002" file="imgf0002.tif" wi="155" he="161" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="55"> --><figure id="f0003" num="3"><img id="if0003" file="imgf0003.tif" wi="139" he="178" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="56"> --><figure id="f0004" num="4"><img id="if0004" file="imgf0004.tif" wi="165" he="215" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="57"> --><figure id="f0005" num="5"><img id="if0005" file="imgf0005.tif" wi="157" he="128" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="58"> --><figure id="f0006" num="6"><img id="if0006" file="imgf0006.tif" wi="162" he="146" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="59"> --><figure id="f0007" num="7(a),7(b)"><img id="if0007" file="imgf0007.tif" wi="135" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="60"> --><figure id="f0008" num="8"><img id="if0008" file="imgf0008.tif" wi="165" he="189" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="61"> --><figure id="f0009" num="9(a),9(b)"><img id="if0009" file="imgf0009.tif" wi="146" he="222" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="62"> --><figure id="f0010" num="10"><img id="if0010" file="imgf0010.tif" wi="165" he="124" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="63"> --><figure id="f0011" num="11"><img id="if0011" file="imgf0011.tif" wi="126" he="213" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="64"> --><figure id="f0012" num="12"><img id="if0012" file="imgf0012.tif" wi="119" he="226" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="65"> --><figure id="f0013" num="13"><img id="if0013" file="imgf0013.tif" wi="162" he="172" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="66"> --><figure id="f0014" num="14"><img id="if0014" file="imgf0014.tif" wi="165" he="167" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="67"> --><figure id="f0015" num="15"><img id="if0015" file="imgf0015.tif" wi="165" he="184" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="68"> --><figure id="f0016" num="16"><img id="if0016" file="imgf0016.tif" wi="165" he="162" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="69"> --><figure id="f0017" num="17"><img id="if0017" file="imgf0017.tif" wi="165" he="162" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="70"> --><figure id="f0018" num="18"><img id="if0018" file="imgf0018.tif" wi="105" he="139" img-content="drawing" img-format="tif"/></figure></drawings><search-report-data><doc-page id="srep0001" file="srep0001.tif" wi="160" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="160" he="233" type="tif"/></search-report-data><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
