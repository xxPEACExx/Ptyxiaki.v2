<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2959637-A1" country="EP" doc-number="2959637" kind="A1" date="20151230" family-id="48048687" file-reference-id="318326" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160452539" ucid="EP-2959637-A1"><document-id><country>EP</country><doc-number>2959637</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14706674-A" is-representative="NO"><document-id mxw-id="PAPP193868046" load-source="docdb" format="epo"><country>EP</country><doc-number>14706674</doc-number><kind>A</kind><date>20140219</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193868047" load-source="patent-office" format="original"><country>EP</country><doc-number>14706674.0</doc-number><date>20140219</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162034728" ucid="GB-201302984-A" load-source="docdb"><document-id format="epo"><country>GB</country><doc-number>201302984</doc-number><kind>A</kind><date>20130220</date></document-id></priority-claim><priority-claim mxw-id="PPC162028631" ucid="GB-2014050487-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>GB</country><doc-number>2014050487</doc-number><kind>W</kind><date>20140219</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1988524571" load-source="docdb">H04L  12/26        20060101AFI20140909BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1984019555" load-source="docdb" scheme="CPC">H04L  69/22        20130101 LI20160114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984021980" load-source="docdb" scheme="CPC">H04L  43/0876      20130101 FI20160114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984022004" load-source="docdb" scheme="CPC">H04L  69/167       20130101 LI20160114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984024416" load-source="docdb" scheme="CPC">H04L  61/1511      20130101 LI20160115BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165549083" lang="DE" load-source="patent-office">VERFAHREN UND VORRICHTUNG ZUR VERKEHRSÜBERWACHUNG IN EINEM KOMMUNIKATIONSNETZ</invention-title><invention-title mxw-id="PT165549084" lang="EN" load-source="patent-office">A METHOD OF, AND APPARATUS FOR, MONITORING TRAFFIC IN A COMMUNICATIONS NETWORK</invention-title><invention-title mxw-id="PT165549085" lang="FR" load-source="patent-office">PROCÉDÉ ET APPAREIL DE SURVEILLANCE DU TRAFIC DANS UN RÉSEAU DE COMMUNICATIONS</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103338921" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>NOMINET UK</last-name><address><country>GB</country></address></addressbook></applicant><applicant mxw-id="PPAR1103332818" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>NOMINET UK</last-name></addressbook></applicant><applicant mxw-id="PPAR1101640605" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Nominet UK</last-name><iid>101476353</iid><address><street>Minerva House Edmund Halley Road Oxford Science Park</street><city>Oxford, Oxfordshire OX4 4DQ</city><country>GB</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103344565" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>BELLIS RAYMOND PETER</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR1103331382" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>BELLIS, Raymond Peter</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651799" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>BELLIS, Raymond Peter</last-name><address><street>Nominet UK Minerva House Edmund Halley Road Oxford Science Park</street><city>Oxford Oxfordshire OX4 4DQ</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR1103332555" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>ARENDS ROY BERNARD HERMAN</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR1103341674" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>ARENDS, Roy Bernard Herman</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651531" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>ARENDS, Roy Bernard Herman</last-name><address><street>Nominet UK Minerva House Edmund Halley Road Oxford Science Park</street><city>Oxford Oxfordshire OX4 4DQ</city><country>GB</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101649254" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Merryweather, Colin Henry</last-name><iid>100040497</iid><address><street>J A Kemp 14 South Square Gray's Inn</street><city>LONDON WC1R 5JJ</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="GB-2014050487-W"><document-id><country>GB</country><doc-number>2014050487</doc-number><kind>W</kind><date>20140219</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014128463-A1"><document-id><country>WO</country><doc-number>2014128463</doc-number><kind>A1</kind><date>20140828</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660709588" load-source="docdb">AL</country><country mxw-id="DS660725058" load-source="docdb">AT</country><country mxw-id="DS660709590" load-source="docdb">BE</country><country mxw-id="DS660624148" load-source="docdb">BG</country><country mxw-id="DS660788780" load-source="docdb">CH</country><country mxw-id="DS660703361" load-source="docdb">CY</country><country mxw-id="DS660725067" load-source="docdb">CZ</country><country mxw-id="DS660703236" load-source="docdb">DE</country><country mxw-id="DS660709595" load-source="docdb">DK</country><country mxw-id="DS660703362" load-source="docdb">EE</country><country mxw-id="DS660625595" load-source="docdb">ES</country><country mxw-id="DS660624149" load-source="docdb">FI</country><country mxw-id="DS660624150" load-source="docdb">FR</country><country mxw-id="DS660703237" load-source="docdb">GB</country><country mxw-id="DS660709596" load-source="docdb">GR</country><country mxw-id="DS660709597" load-source="docdb">HR</country><country mxw-id="DS660703367" load-source="docdb">HU</country><country mxw-id="DS660788781" load-source="docdb">IE</country><country mxw-id="DS660709598" load-source="docdb">IS</country><country mxw-id="DS660624155" load-source="docdb">IT</country><country mxw-id="DS660703368" load-source="docdb">LI</country><country mxw-id="DS660703238" load-source="docdb">LT</country><country mxw-id="DS660725068" load-source="docdb">LU</country><country mxw-id="DS660703263" load-source="docdb">LV</country><country mxw-id="DS660703264" load-source="docdb">MC</country><country mxw-id="DS660624945" load-source="docdb">MK</country><country mxw-id="DS660624946" load-source="docdb">MT</country><country mxw-id="DS660625596" load-source="docdb">NL</country><country mxw-id="DS660624156" load-source="docdb">NO</country><country mxw-id="DS660625597" load-source="docdb">PL</country><country mxw-id="DS660624157" load-source="docdb">PT</country><country mxw-id="DS660625598" load-source="docdb">RO</country><country mxw-id="DS660624158" load-source="docdb">RS</country><country mxw-id="DS660625611" load-source="docdb">SE</country><country mxw-id="DS660788782" load-source="docdb">SI</country><country mxw-id="DS660624951" load-source="docdb">SK</country><country mxw-id="DS660624952" load-source="docdb">SM</country><country mxw-id="DS660703369" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA139078467" ref-ucid="WO-2014128463-A1" lang="EN" load-source="patent-office"><p num="0000">For monitoring traffic in a communications network, network protocol requests sent over the network are obtained. The resulting network protocol responses sent over said network are also obtained. It is then determined which request corresponds to which response and each request and corresponding response pair is stored as a single request-response record. Preferably, the time of capture of the request in each record is stored. Moreover, a request lookup key may be created from specific attributes of the request. The requests and responses preferably adhere to the domain name system (DNS) protocol.</p></abstract><abstract mxw-id="PA139545022" ref-ucid="WO-2014128463-A1" lang="EN" source="national office" load-source="docdb"><p>For monitoring traffic in a communications network, network protocol requests sent over the network are obtained. The resulting network protocol responses sent over said network are also obtained. It is then determined which request corresponds to which response and each request and corresponding response pair is stored as a single request-response record. Preferably, the time of capture of the request in each record is stored. Moreover, a request lookup key may be created from specific attributes of the request. The requests and responses preferably adhere to the domain name system (DNS) protocol.</p></abstract><abstract mxw-id="PA139078468" ref-ucid="WO-2014128463-A1" lang="FR" load-source="patent-office"><p num="0000">L'invention a pour objet de surveiller le trafic dans un réseau de communications. A cet effet, des demandes de protocole de réseau envoyées sur le réseau sont obtenues. Les réponses de protocole de réseau résultantes, envoyées sur ledit réseau, sont également obtenues. La demande qui correspond à chaque réponse est ensuite déterminée, et chaque paire demande-réponse correspondante est mémorisée comme un enregistrement unique demande-réponse. De préférence, l'instant de la capture de la demande de chaque enregistrement est mémorisé. En outre, une clé de recherche de demande peut être créée à partir d'attributs particuliers de la demande. Les demandes et les réponses se conforment de préférence au protocole des systèmes de noms de domaine (DNS).</p></abstract><abstract mxw-id="PA139545023" ref-ucid="WO-2014128463-A1" lang="FR" source="national office" load-source="docdb"><p>L'invention a pour objet de surveiller le trafic dans un réseau de communications. A cet effet, des demandes de protocole de réseau envoyées sur le réseau sont obtenues. Les réponses de protocole de réseau résultantes, envoyées sur ledit réseau, sont également obtenues. La demande qui correspond à chaque réponse est ensuite déterminée, et chaque paire demande-réponse correspondante est mémorisée comme un enregistrement unique demande-réponse. De préférence, l'instant de la capture de la demande de chaque enregistrement est mémorisé. En outre, une clé de recherche de demande peut être créée à partir d'attributs particuliers de la demande. Les demandes et les réponses se conforment de préférence au protocole des systèmes de noms de domaine (DNS).</p></abstract><description mxw-id="PDES78477568" ref-ucid="WO-2014128463-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="2"/>--><p id="p0001" num="0001"> A METHOD OF, AND APPARATUS FOR, MONITORING TRAFFIC IN A COMMUNICATIONS NETWORK </p><p id="p0002" num="0002">The invention relates to a method of monitoring traffic in a communications network and an apparatus for monitoring traffic in a communications network. In a preferred embodiment of the invention, the method or apparatus monitors network protocol traffic (in the form of network packets) observed passing between computers connected via a communications network. Network packets are typically composed of many attributes, packed into data fields in a protocol-specific manner within a packet of data sent over a communications network. </p><p id="p0003" num="0003">In one example, the network packets comprise requests and corresponding responses adhering to the Domain Name System (DNS) protocol as specified in RFC 1034, RFC 1035, and subsequent documents that amended the core specification (e.g. RFC 2671). The DNS is a fundamental component of the Internet, designed as a database system that translates a computer's domain name into an IP address. DNS allows connection to another networked computer or remote service by interpreting the user-friendly domain name rather than its numerical IP address. For example, a "DNS Request", containing a domain name will be processed by a DNS Server and will return a "DNS Response" containing the IP address. At first sight, DNS seems a simple process, but due to mechanisms that deal with DNS server hierarchy, redundancy, error messages and caching, the system is rather more complicated. DNS Requests typically vary in length from 20 to 60 bytes, and DNS Responses may typically vary in length from 50 bytes through to 4096 bytes. </p><p id="p0004" num="0004">To successfully manage a practical DNS system it is desirable for the DNS operator to have access to systems that monitor DNS performance. DNS performance depends on the efficient running of the DNS Server as well as the frequency and type of DNS Requests coming from the Internet. With over 4 Billion IP addresses on the Internet, it is </p><p id="p0005" num="0005">theoretically possible for any of these IP address sources to impair the performance of the DNS server by sending erroneous DNS Requests to the server. Whilst it is often the case that such erroneous DNS Requests are the result of some accidental poorly performing 
<!-- EPO <DP n="3"/>-->
 Internet-connected computer, the nature of the Internet is such that there is an increasing number of "contrived" DNS Request events which are deliberately designed to attack the performance of the DNS server. To be able to monitor, isolate and mitigate against such deliberate attacks requires sophisticated monitoring of the DNS Requests and the associated DNS Responses. </p><p id="p0006" num="0006">The monitoring and analysis of network communications traffic, such as DNS requests and responses, serves many purposes, including (but not limited to): · Capacity planning </p><p id="p0007" num="0007"> Detection of non-compliant requests and/or responses </p><p id="p0008" num="0008"> Analysis of usage patterns </p><p id="p0009" num="0009">However, there are problems in providing tools for monitoring and analysing such communications, including: the sheer volume of data when there are literally billions of requests processed every day; the variable nature of the responses; and enabling the data to be efficiently interrogated. </p><p id="p0010" num="0010">The present invention seeks to alleviate, at least partially some or any of the above problems. </p><p id="p0011" num="0011">According to one aspect, the present invention provides a method of monitoring traffic, in a communications network, comprising: </p><p id="p0012" num="0012"> obtaining network protocol requests sent over said network; </p><p id="p0013" num="0013"> obtaining resulting network protocol responses sent over said network; </p><p id="p0014" num="0014"> determining which request corresponds to which response; and </p><p id="p0015" num="0015"> storing each request and corresponding response pair as a single request-response record. Other aspects of the invention provide a computer program and a computer program product corresponding to this method. </p><p id="p0016" num="0016">A further aspect of the invention provides an apparatus for monitoring traffic, in a communications network, comprising: 
<!-- EPO <DP n="4"/>-->
 an input configured to obtain network protocol requests sent over said network and resulting network protocol responses sent over said network; </p><p id="p0017" num="0017"> a processor configured to determine which request corresponds to which response; and </p><p id="p0018" num="0018"> a store arranged to store each request and corresponding response pair as a single request-response record. </p><p id="p0019" num="0019">Embodiments of the invention will now be described, by way of example only, with reference to the accompanying drawings in which: </p><p id="p0020" num="0020">Figure 1 is a schematic illustration of an apparatus for matching request-response pairs and storing the resulting information; </p><p id="p0021" num="0021"> Figure 2 is a schematic illustration of an apparatus for classifying and counting packets; Figure 3 shows the format of a table of records generated by the apparatus of Fig. 2; and Figure 4 is an alternative embodiment of the apparatus of Fig. 2. </p><p id="p0022" num="0022">An embodiment of the invention will now be described with reference to Fig. 1. A </p><p id="p0023" num="0023">Request Parser 10 receives copies of traffic being sent to a DNS Server 20 across a communications network, such as the internet, in this example from DNS Resolver 30. The Request Parser 10 incorporates a packet capture device (input) configured to receive all packets whose User Datagram Protocol (UDP) or Transmission Control Protocol (TCP) headers indicate that the packet is a DNS packet. Such packets will have a "source port" and/or "destination port" data field containing a value of 53 as defined by RFC 1035. </p><p id="p0024" num="0024">The Request Parser 10 parses the request into its individual attributes, as described in the relevant network communications protocol specifications (e.g. RFC 791 for IPv4, RFC 768 for UDP, RFCs 1034 and 1035 for DNS). These specifications describe what attributes a packet will contain and may also specify for some attributes all possible values that the attribute may have. Copies of certain attributes of the request, along with a timestamp (e.g. the time of capture), are stored as a single record in Record Store 40. Record Store 40 allocates a Unique Identifier (UID) to this record which is communicated to the Request Parser 10. 
<!-- EPO <DP n="5"/>-->
 Whilst it would be possible to store every attribute, in practice some attributes are of no operational importance and reducing the set of attributes to the minimum required can substantially reduce the storage requirements. The Request Parser 10 creates a Lookup Key containing the following attributes that are used to identify the corresponding response: </p><p id="p0025" num="0025">• IP protocol version (i.e. IPv4 or IPv6) </p><p id="p0026" num="0026"> Layer 4 protocol (i.e. UDP or TCP) </p><p id="p0027" num="0027">· Remote IP address </p><p id="p0028" num="0028"> Remote port number </p><p id="p0029" num="0029"> Local IP address </p><p id="p0030" num="0030"> Local port number </p><p id="p0031" num="0031"> DNS request ID </p><p id="p0032" num="0032">The packet's UID and timestamp are stored in UID Store 50 using the Lookup Key to index them. If more than one outstanding request matches the same Lookup Key then the result will be that a list of UIDs and capture times will be stored against that Lookup Key. This ensures that, in the event of two or more identical requests being captured without an intervening corresponding response being captured, each subsequent response can be correctly assigned to a request, chronologically, as described below. </p><p id="p0033" num="0033">A Response Parser 60 receives copies of traffic being sent from a DNS Server 20 across a communications network. The Response Parser 60 incorporates a packet capture device configured to receive all DNS packets in the same way as the Request Parser 10. </p><p id="p0034" num="0034">The Response Parser 60 parses the response into its individual attributes, according to the relevant network communications protocol specifications, in the same way as the Request Parser 10. </p><p id="p0035" num="0035">Instead of the Request Parser 10 and Response Parser 60 having separate packet capture devices (inputs) they may instead share a single packet capture device and determine 
<!-- EPO <DP n="6"/>-->
 whether a packet should be handled by the Request Parser 10 or Response Parser 60 by examining the value of the QR ("Query Response") bit in the DNS protocol header of each packet. The Response Parser 10 creates a Lookup Key using the same attributes as the Request Parser 60, such that for corresponding requests and responses the same Lookup Key value is obtained. </p><p id="p0036" num="0036">The Response Parser 60 queries UID Store 50 using this Lookup Key to obtain the UID and time of capture of the request matching that Lookup Key. In the event of the UID</p><p id="p0037" num="0037">Store 50 containing a list of multiple unmatched requests matching that Lookup Key, then the first (oldest time of capture) outstanding UID and time of capture are obtained. The record for a request (UID and time of capture) is deleted from the UID Store 50 after it has been matched with a response. Using the UID as the key, copies of certain attributes of the response are added to the request record in Record Store 40, along with information recording the elapsed time between the capture of the request and the subsequent capture of the corresponding response, to create a Request-Response record. As for the Request Parser 10, the choice of which attributes to store is a trade-off between operational requirements and data storage requirements. </p><p id="p0038" num="0038">Instead of adding the response attributes to the request record, an alternate implementation stores the response attributes as a separate record in a second table, where each entry in the request record table and corresponding entry in the response record table share a common key (i.e. the UID). For the purposes of this invention, a pair of records so linked shall be considered a single request-response record. </p><p id="p0039" num="0039">Periodically a Timeout Detector 70 scans every record in UID Store 50. If the difference between the current system time and the recorded timestamp is more than a pre-defined time limit, the system adds a flag to the request record in Record Store 40 to the effect that no response has been received (such records can then, if required, be considered as</p><p id="p0040" num="0040">Request-Response records in subsequent processing, even though they contain no response 
<!-- EPO <DP n="7"/>-->
 information), and deletes the record in UID Store 50. For the DNS protocol an appropriate value for the time limit is 5 seconds, with a scan period of 1 second. </p><p id="p0041" num="0041">Analysis of the network communications data will now be described with reference to Fig. 2. A Data Collector 100 is instructed to create time series data for a specified time period and with a specified sub-interval (e.g. the previous hour, with 1 minute resolution). The instruction might be the result of a specific enquiry initiated by an end user, or it may be an automatically scheduled operation. This may be described as "on-demand" or "polling" operation. </p><p id="p0042" num="0042">The Data Collector issues a query (for example, using the HTTP protocol) to a Query Interface 110 containing those time parameters, which in turn passes the time parameters to a Signature Generator 120. For the specified time period, the Signature Generator 120 retrieves all matching records from Record Store 40, in chronological order. </p><p id="p0043" num="0043">For each record, the values of particular predetermined attributes (e.g. Query Type, Response Code, IP Protocol Version etc.) are extracted and combined (without loss of information) into a 64-bit integer (hereafter "Signature") thereby collapsing those values into a 1 -dimensional representation of those values. This is achieved by recording the values in a fixed order within the signature, with each attribute occupying a specified set of bits. The predetermination of which attributes to use to form the signatures depends on the intrinsic variability of the attributes. Attributes with high intrinsic variability (such that they might be expected to be different on every packet, e.g. Remote Address, Remote Port or DNS Query ID) are less suited than attributes that typically only contain a small range of values, per the examples given above. The same set of attributes is consistently used for every record to form all signatures The Signature is stored in Signature Store 130, which counts how many times each distinct Signature is observed for each of the smallest sub-intervals of time specified. The use of a 64-bit integer as the "key" in this store is advantageous because it allows for optimal 
<!-- EPO <DP n="8"/>-->
 implementation of Signature Store 130 because comparison of integer values is a primitive operation within a CPU. Of course, other bit lengths are contemplated, while still representing every signature as a numerical value for ease of comparison. Although the signature generation algorithm allows for up to 2 different signatures, in practice the number of distinct signatures observed in short time intervals (e.g. minutes) is only in the region of a few hundred because many of the protocol attributes have a limited range of common values. At the end of processing data for each sub-interval of the specified time period, the Query Interface 110 retrieves all generated Signatures and counts thereof from Signature Store 130 and returns those values to the Data Collector 100 as the response to the </p><p id="p0044" num="0044">aforementioned query. Signature Store 130 is emptied in readiness for the next sub- interval. </p><p id="p0045" num="0045">On receipt of the signature count data for a sub-interval; the Data Collector 100 passes this data to the Signature Decomposer 140, which then decomposes the Signature back into its original component attributes, i.e. the signature values are decomposed back into a multidimensional representation of the attribute values seen during each measured time interval. </p><p id="p0046" num="0046">A record is created in Analysis Store 150 for each specified sub-interval and for each distinct Signature. Fig. 3 shows a table of such records; each row is one record </p><p id="p0047" num="0047">representing occurrences of a specific signature for a specific time sub-interval. Each record contains the time value representing the start of the sub-interval (tO, tl, t2... \ the original attribute values (the numerical value of each attribute), and the count of the number of times that particular combination of values (signature) was observed (f0, fl, f2... ). This representation may be efficiently sliced (such that attributes not currently of interest are ignored) or filtered, such that the frequency distribution only includes those DNS queries whose attributes match (or do not match) specified values. 
<!-- EPO <DP n="9"/>-->
 Once records for each sub-interval for the specified time period have been added to Analysis Store 150, the user can conduct multi-dimensional analysis of this information, for example using known analysis tools such as pivot tables. The invention can enable the efficient creation of time series data sets (i.e. number of occurrences per specified time interval, or "frequency distribution") of attributes of a network protocol request (or request / response pair) where each time series may be filtered by the contents of any other attribute or combination thereof. For example, the invention can be used to generate time series of: </p><p id="p0048" num="0048">The frequency of DNS requests for an "MX record" (which specifies the location of the mail server for a domain name) that resulted in an "NXDomain" response code (which indicates that the domain name to which the request related does not exist). </p><p id="p0049" num="0049">· The relative frequency distribution of all observed values of the "Query Type" attribute for all DNS queries sent with the "DNSSEC OK" flag that were transmitted using the UDP/IP protocol and that resulted in a truncated response. </p><p id="p0050" num="0050">The generated time series information can be displayed graphically. </p><p id="p0051" num="0051">An alternative embodiment is illustrated in Fig. 4, which is a modified version of Fig. 2 in which like parts are given like reference numerals; repeated description thereof will be omitted. In this alternative embodiment, the Signature Generator 120 runs autonomously and the Query Interface is replaced with a Data Exporter 160. The Record Store 40 forwards records to the Signature Generator 120 in real time and generates Signatures as described above and passes those Signatures to Signature Store 130 for counting. This may be described as "real-time" or "push" operation. </p><p id="p0052" num="0052">At a pre-determined interval (typically one minute) the Data Exporter 160 retrieves all generated Signatures and counts thereof from Signature Store 130 and then initiates an export of those values to the Data Collector 100. Signature Store 130 is emptied in readiness for the next sub-interval. 
<!-- EPO <DP n="10"/>-->
 On receipt of data from the Data Exporter 160, the Data Collector 100 then proceeds with signature decomposition by the Signature Decomposer 140 and storage in Analysis Store 150 as described above. </p><p id="p0053" num="0053">Although the embodiments of Figs. 2 and 4 are shown as using records from Record Store 40, this is not essential. For example, data can be delivered to the Signature Generator 120 directly from a communications network or indirectly via other apparatus not necessarily as illustrated in Fig. 1. Furthermore, the records received by the Signature Generator 120 are not limited to being derived from network communications based on requests and responses, but could be any time-based network communications data with associated attributes. Each set of attributes, having a particular timestamp (such as time of capture), obtained from a store of directly from a network, is referred to as a unit of data, and could be, but is not limited to being, a network data packet. </p><p id="p0054" num="0054">The embodiments described above store the count data in Analysis Store 150 for each signature for each specified time sub-interval (smallest time resolution, such as 1 second). However, to efficiently and rapidly produce time series of much longer time periods, an aggregator (not shown) is preferably provided which automatically periodically aggregates the data into progressively coarser time intervals (for example 10, 600, 3600 and 86400 seconds) and also stores the resulting information as tables. These tables have the same format as Fig. 3, with one row per (aggregated) time interval per signature, but with the count field being the sum of the counts for that signature from multiple shorter time intervals (e.g. from tO - t9). When further analysis is performed, the optimal resolution required to present the frequency distribution for any requested time period can </p><p id="p0055" num="0055">automatically be selected. </p><p id="p0056" num="0056">All of the features described above by reference to the Domain Name System (DNS) network communications protocol could equally be applied by a person skilled in the art, without departing from the scope of the invention, to alternative network communications protocols, such as Simple Network Management Protocol (SNMP, described in RFC 1441) and Remote Authentication Dial In User Service (RADIUS, described in RFC 2865). 
<!-- EPO <DP n="11"/>-->
 It is possible to implement each of the various items in Figs. 1, 2 and 4 as dedicated hardwired electronic circuits; however the various items do not have to be separate from each other, and some or all could be integrated onto a single electronic chip. Furthermore, the items can be embodied as a combination of hardware and software, and the software can be executed by any suitable general-purpose microprocessor, such that in one embodiment the apparatus can be a conventional personal computer (PC) or server, such as a standard desktop or laptop computer with an attached monitor, with connection to the desired communications network. Alternatively, the apparatus can be a dedicated device. </p><p id="p0057" num="0057">The invention can also be embodied as a computer program stored on any suitable computer-readable storage medium, such as a solid-state computer memory, a hard drive, or a removable disc-shaped medium in which information is stored magnetically, optically or magneto-optically. The computer program comprises computer-executable code that when executed on a computer system causes the computer system to perform a method embodying the invention. 
</p></description><claims mxw-id="PCLM70077844" ref-ucid="WO-2014128463-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="12"/>-->CLAIMS </claim-statement><claim id="clm-0001" num="1"><claim-text>1. A method of monitoring traffic, in a communications network, comprising: </claim-text><claim-text> obtaining network protocol requests sent over said network; </claim-text><claim-text> obtaining resulting network protocol responses sent over said network; </claim-text><claim-text> determining which request corresponds to which response; and </claim-text><claim-text> storing each request and corresponding response pair as a single request-response record. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. A method according to claim 1, further comprising, for each received request: storing predetermined attributes of the request as a record, and allocating a unique identifier to the record. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. A method according to claim 2, further comprising including the time of capture of the request in each record. </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. A method according to claim 2 or 3, comprising, for each request: creating a request lookup key from specific attributes of the request, and storing a list of the unique identifier and time of capture for each request, indexed by the lookup key. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. A method according to claim 4, comprising, for each response: </claim-text><claim-text> creating a response lookup key from specific attributes of the response, corresponding to attributes of the request used to create each request lookup key; </claim-text><claim-text> looking up a unique identifier in said list having a request lookup key </claim-text><claim-text>corresponding to the response lookup key; and </claim-text><claim-text> storing predetermined attributes of the response together with the stored predetermined attributes of the request with the corresponding unique identifier looked up in the list to create the request-response record. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. A method according to claim 5, wherein if multiple items are found in the list all with the same request lookup key corresponding to the response lookup key, then the item 
<!-- EPO <DP n="13"/>-->
 with the oldest time of capture is selected and the corresponding unique identifier is used to determine the request that corresponds to the response. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. A method according to claim 5 or 6, wherein after a unique identifier has been obtained from the list by using a response lookup key, that item is removed from the list. </claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. A method according to any one of claims 4, 5, 6 or 7, wherein, if more than a predetermined period of time has elapsed since an item was added to said list, then that item is removed from the list. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. A method according to any one of claims 5 to 8, wherein the step of storing predetermined attributes of the response to create the request-response record, comprises adding predetermined attributes of the response to the record already created from predetermined attributes of the request. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. A method according to any preceding claim, further comprising retrieving and outputting stored request-response records for analysis in response to a query. </claim-text></claim><claim id="clm-0011" num="11"><claim-text>11. A method according to any preceding claim wherein said method is computer- implemented. </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. A method according to any preceding claim, wherein the requests are DNS requests, and the responses are DNS responses. </claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. A computer program comprising computer-executable code that when executed on a computer system causes the computer system to perform a method according to any one of the preceding claims. </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. A computer program product, directly loadable into the internal memory of a digital computer, comprising software code portions for performing the method of any one of the preceding claims when said product is run on a computer. 
<!-- EPO <DP n="14"/>-->
</claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. An apparatus for monitoring traffic, in a communications network, comprising: an input configured to obtain network protocol requests sent over said network and resulting network protocol responses sent over said network; </claim-text><claim-text> a processor configured to determine which request corresponds to which response; and </claim-text><claim-text> a store arranged to store each request and corresponding response pair as a single request-response record. 
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
