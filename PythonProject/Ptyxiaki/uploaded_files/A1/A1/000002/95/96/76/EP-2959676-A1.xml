<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2959676-A1" country="EP" doc-number="2959676" kind="A1" date="20151230" family-id="50069343" file-reference-id="288065" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160452500" ucid="EP-2959676-A1"><document-id><country>EP</country><doc-number>2959676</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14703244-A" is-representative="NO"><document-id mxw-id="PAPP193867968" load-source="patent-office" format="original"><country>EP</country><doc-number>14703244.5</doc-number><date>20140127</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193867969" load-source="docdb" format="epo"><country>EP</country><doc-number>14703244</doc-number><kind>A</kind><date>20140127</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162029492" ucid="US-201361767553-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201361767553</doc-number><kind>P</kind><date>20130221</date></document-id></priority-claim><priority-claim mxw-id="PPC162030155" ucid="US-2014013218-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>2014013218</doc-number><kind>W</kind><date>20140127</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1987772322" load-source="docdb">H04N   5/445       20060101ALI20140909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988525274" load-source="docdb">H04N  21/81        20110101ALI20140909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988527629" load-source="docdb">H04N   5/272       20060101AFI20140909BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1865060825" load-source="docdb" scheme="CPC">G09G2340/12        20130101 LA20161220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1865060826" load-source="docdb" scheme="CPC">G09G2340/10        20130101 LA20161220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1865060827" load-source="docdb" scheme="CPC">G09G   5/10        20130101 LI20161220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1865060828" load-source="docdb" scheme="CPC">G09G2370/04        20130101 LA20161220BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987767958" load-source="docdb" scheme="CPC">H04N  21/4884      20130101 LA20140904BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987773079" load-source="docdb" scheme="CPC">H04N   5/445       20130101 LI20140902BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987779199" load-source="docdb" scheme="CPC">H04N   5/2723      20130101 FI20140902BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987782993" load-source="docdb" scheme="CPC">H04N  21/812       20130101 LI20140904BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987788645" load-source="docdb" scheme="CPC">H04N  21/431       20130101 LI20140904BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987790362" load-source="docdb" scheme="CPC">H04N  21/4622      20130101 LI20140904BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987799507" load-source="docdb" scheme="CPC">H04N  21/8146      20130101 LI20140904BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165548966" lang="DE" load-source="patent-office">SYSTEME UND VERFAHREN FÜR ERSCHEINUNGSBILD-MAPPING ZUM ZUSAMMENSTELLEN VON ÜBERLAGERUNGSGRAFIKEN</invention-title><invention-title mxw-id="PT165548967" lang="EN" load-source="patent-office">SYSTEMS AND METHODS FOR APPEARANCE MAPPING FOR COMPOSITING OVERLAY GRAPHICS</invention-title><invention-title mxw-id="PT165548968" lang="FR" load-source="patent-office">SYSTÈMES ET PROCÉDÉS PERMETTANT UN MAPPAGE DE L'APPARENCE POUR COMPOSER DES GRAPHIQUES DE RECOUVREMENT</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103337797" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>DOLBY LAB LICENSING CORP</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR1103335171" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>DOLBY LABORATORIES LICENSING CORPORATION</last-name></addressbook></applicant><applicant mxw-id="PPAR1101644114" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Dolby Laboratories Licensing Corporation</last-name><iid>101104164</iid><address><street>100 Potrero Avenue</street><city>San Francisco, CA 94103-4813</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103304370" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>KUNKEL TIMO</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103333308" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>KUNKEL, TIMO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101644102" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>KUNKEL, TIMO</last-name><address><street>c/o Dolby Laboratories Inc. 432 Lakeside Drive</street><city>Sunnyvale, California 94085</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103339708" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>XU NING</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103321530" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>XU, NING</last-name></addressbook></inventor><inventor mxw-id="PPAR1101648443" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>XU, NING</last-name><address><street>29 Canopy</street><city>Irvine, California 92603</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103304869" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>CHEN TAO</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103302884" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>CHEN, TAO</last-name></addressbook></inventor><inventor mxw-id="PPAR1101653697" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>CHEN, TAO</last-name><address><street>c/o Dolby Laboratories Inc. 432 Lakeside Drive</street><city>Sunnyvale, California 94085</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103303381" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>LEE BONGSUN</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103309645" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>LEE, BONGSUN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101639560" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>LEE, BONGSUN</last-name><address><street>10175 Parkwood Dr. 8</street><city>Cupertino, California 95014</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103310179" load-source="docdb" sequence="5" format="epo"><addressbook><last-name>HULYALKAR SAMIR N</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103340199" load-source="docdb" sequence="5" format="intermediate"><addressbook><last-name>HULYALKAR, SAMIR N.</last-name></addressbook></inventor><inventor mxw-id="PPAR1101645281" load-source="patent-office" sequence="5" format="original"><addressbook><last-name>HULYALKAR, SAMIR N.</last-name><address><street>c/o Dolby Laboratories Inc. 432 Lakeside Drive</street><city>Sunnyvale, California 94085</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101653399" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Dolby International AB Patent Group Europe</last-name><iid>101283339</iid><address><street>Apollo Building, 3E Herikerbergweg 1-35</street><city>1101 CN Amsterdam Zuidoost</city><country>NL</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="US-2014013218-W"><document-id><country>US</country><doc-number>2014013218</doc-number><kind>W</kind><date>20140127</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014130213-A1"><document-id><country>WO</country><doc-number>2014130213</doc-number><kind>A1</kind><date>20140828</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660624396" load-source="docdb">AL</country><country mxw-id="DS660702872" load-source="docdb">AT</country><country mxw-id="DS660624398" load-source="docdb">BE</country><country mxw-id="DS660788582" load-source="docdb">BG</country><country mxw-id="DS660623552" load-source="docdb">CH</country><country mxw-id="DS660723537" load-source="docdb">CY</country><country mxw-id="DS660702873" load-source="docdb">CZ</country><country mxw-id="DS660624403" load-source="docdb">DE</country><country mxw-id="DS660723538" load-source="docdb">DK</country><country mxw-id="DS660723543" load-source="docdb">EE</country><country mxw-id="DS660702819" load-source="docdb">ES</country><country mxw-id="DS660788583" load-source="docdb">FI</country><country mxw-id="DS660788584" load-source="docdb">FR</country><country mxw-id="DS660624404" load-source="docdb">GB</country><country mxw-id="DS660723544" load-source="docdb">GR</country><country mxw-id="DS660624405" load-source="docdb">HR</country><country mxw-id="DS660702874" load-source="docdb">HU</country><country mxw-id="DS660623553" load-source="docdb">IE</country><country mxw-id="DS660723545" load-source="docdb">IS</country><country mxw-id="DS660788585" load-source="docdb">IT</country><country mxw-id="DS660723546" load-source="docdb">LI</country><country mxw-id="DS660625018" load-source="docdb">LT</country><country mxw-id="DS660702879" load-source="docdb">LU</country><country mxw-id="DS660625031" load-source="docdb">LV</country><country mxw-id="DS660625032" load-source="docdb">MC</country><country mxw-id="DS660709011" load-source="docdb">MK</country><country mxw-id="DS660709012" load-source="docdb">MT</country><country mxw-id="DS660702880" load-source="docdb">NL</country><country mxw-id="DS660624406" load-source="docdb">NO</country><country mxw-id="DS660723551" load-source="docdb">PL</country><country mxw-id="DS660625034" load-source="docdb">PT</country><country mxw-id="DS660702881" load-source="docdb">RO</country><country mxw-id="DS660625043" load-source="docdb">RS</country><country mxw-id="DS660723552" load-source="docdb">SE</country><country mxw-id="DS660625044" load-source="docdb">SI</country><country mxw-id="DS660624411" load-source="docdb">SK</country><country mxw-id="DS660723553" load-source="docdb">SM</country><country mxw-id="DS660709013" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA139072773" ref-ucid="WO-2014130213-A1" lang="EN" load-source="patent-office"><p num="0000">Systems and methods for overlaying a second image/video data onto a first image/video data are described herein. The first image/video data may be intended to be rendered on a display with certain characteristics - e.g., HDR, EDR, VDR or UHD capabilities. The second image/video data may comprise graphics, closed captioning, text, advertisement - or any data that may be desired to be overlaid and/or composited onto the first image/video data. The second image/video data may be appearance mapped according to the image statistics and/or characteristics of the first image/video data. In addition, such appearance mapping may be made according to the characteristics of the display that the composite data is to be rendered. Such appearance mapping is desired to render a composite data that is visually pleasing to a viewer, rendered upon a desired display.</p></abstract><abstract mxw-id="PA139540422" ref-ucid="WO-2014130213-A1" lang="EN" source="national office" load-source="docdb"><p>Systems and methods for overlaying a second image/video data onto a first image/video data are described herein. The first image/video data may be intended to be rendered on a display with certain characteristics - e.g., HDR, EDR, VDR or UHD capabilities. The second image/video data may comprise graphics, closed captioning, text, advertisement - or any data that may be desired to be overlaid and/or composited onto the first image/video data. The second image/video data may be appearance mapped according to the image statistics and/or characteristics of the first image/video data. In addition, such appearance mapping may be made according to the characteristics of the display that the composite data is to be rendered. Such appearance mapping is desired to render a composite data that is visually pleasing to a viewer, rendered upon a desired display.</p></abstract><abstract mxw-id="PA139072774" ref-ucid="WO-2014130213-A1" lang="FR" load-source="patent-office"><p num="0000">La présente invention se rapporte à des systèmes et à des procédés permettant une superposition de secondes données d'image/de vidéo sur des premières données d'image/de vidéo. Les premières données d'image/de vidéo peuvent être destinées à être rendues sur un affichage avec certaines caractéristiques - par exemple, les capacités HDR, EDR, VDR ou UHD. Les secondes données d'image/de vidéo peuvent comprendre des graphiques, un sous-titrage invisible, un texte, une annonce publicitaire ou des données quelconques dont on souhaite qu'elles soient superposées et/ou composées sur les premières données d'image/de vidéo. L'apparence des secondes données d'image/de vidéo peuvent être mappées selon les statistiques de l'image et/ou les caractéristiques des premières données d'image/de vidéo. De plus, un tel mappage de l'apparence peut être réalisé selon les caractéristiques de l'affichage sur lequel les données composites doivent être rendues. Un tel mappage de l'apparence est souhaité pour rendre des données composites qui sont visuellement plaisantes pour un utilisateur, et rendues sur un affichage souhaité.</p></abstract><abstract mxw-id="PA139540423" ref-ucid="WO-2014130213-A1" lang="FR" source="national office" load-source="docdb"><p>La présente invention se rapporte à des systèmes et à des procédés permettant une superposition de secondes données d'image/de vidéo sur des premières données d'image/de vidéo. Les premières données d'image/de vidéo peuvent être destinées à être rendues sur un affichage avec certaines caractéristiques - par exemple, les capacités HDR, EDR, VDR ou UHD. Les secondes données d'image/de vidéo peuvent comprendre des graphiques, un sous-titrage invisible, un texte, une annonce publicitaire ou des données quelconques dont on souhaite qu'elles soient superposées et/ou composées sur les premières données d'image/de vidéo. L'apparence des secondes données d'image/de vidéo peuvent être mappées selon les statistiques de l'image et/ou les caractéristiques des premières données d'image/de vidéo. De plus, un tel mappage de l'apparence peut être réalisé selon les caractéristiques de l'affichage sur lequel les données composites doivent être rendues. Un tel mappage de l'apparence est souhaité pour rendre des données composites qui sont visuellement plaisantes pour un utilisateur, et rendues sur un affichage souhaité.</p></abstract><description mxw-id="PDES78476723" ref-ucid="WO-2014130213-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="3"/>--><p id="p0001" num="0001"> SYSTEMS AND METHODS FOR APPEARANCE MAPPING FOR COMPOSITING OVERLAY </p><p id="p0002" num="0002"> GRAPHICS</p><p id="p0003" num="0003">CROSS-REFERNCE TO RELATED APPLICATIONS </p><p id="p0004" num="0004"> [0001] This application claims priority to United States Provisional Patent Application No. 61/767,553, filed on 21 February 2013, which is hereby incorporated by reference in its entirety. This application is also related to United States Provisional Patent Application No. 61/767,522, filed on 21 February 2013, which is hereby incorporated by reference in its entirety. </p><p id="p0005" num="0005"> TECHNICAL FIELD </p><p id="p0006" num="0006"> [0002] The present invention relates to image processing and, more particularly, to methods and systems for mapping graphics and composite images onto image/video data.</p><p id="p0007" num="0007">BACKGROUND </p><p id="p0008" num="0008"> [0003] Dynamic range (DR) relates to a span of intensity (e.g., luminance, luma) in an image. The DR in real-world scenes is usually large. Different image and video applications for the capture, representation, and presentation of image and video signals may have different DR. For example, photographic negatives can have a relatively large dynamic range, while photographic prints, some currently existing (e.g., conventional) television (TV) sets, and computer monitors may have a smaller DR. </p><p id="p0009" num="0009"> [0004] DR also relates to a capability of the human psychovisual system (HVS) to perceive a range of intensity (e.g., luminance, luma) in an image, e.g., from darkest darks to brightest brights. In this sense, DR relates to a "scene-referred" intensity. DR may also relate to the ability of a display device to adequately or approximately render an intensity range of a particular breadth. In this sense, DR relates to a "display-referred" intensity. In another sense, DR may also refer to a "signal-referred" intensity - which may be to some extent theoretical. For example, a VDR signal may range up to 10,000 nits and HDR signals may range even higher. Most of the time, there are no grading displays for that range. Unless a particular sense is explicitly specified to have particular significance at any point in the description herein, it should be inferred that the term may be used in either sense, e.g. interchangeably. </p><p id="p0010" num="0010"> [0005] Rendering by conventional TV sets and computer monitors is often constrained to approximately three orders of magnitude of dynamic range - typifying a low dynamic range (LDR), also referred to as a standard dynamic range (SDR). In contrast to LDR images, high dynamic range (HDR) images contain essentially all of the dynamic range in an original scene. HDR can span some 14-15 orders of magnitude of dynamic range. HDR images can be represented by any bit depth, but typically 10-16 bits or more are used to reduce overly large step sizes. 
<!-- EPO <DP n="4"/>-->
 [0006] For a number of applications such as compression for distribution, encoding for HDR images may unnecessary and may in fact be somewhat computationally expensive or bandwidth consumptive. On the other hand, LDR images may simply not suffice either. Instead, such applications may advantageously use, create, store, transmit or render images that may be characterized by a visual dynamic range or variable dynamic range, VDR. VDR images, truncated in relation to HDR, encompass essentially all of the luminance and color that a typical HVS can simultaneously perceive (e.g., visually perceive at any given time). VDR spans about 5-6 orders of magnitude of dynamic range. Thus while narrower in relation to HDR, VDR nonetheless represents a wide DR breadth. Despite the DR differences between HDR and VDR images, the term EDR, as used herein, characterizes any image with an extended dynamic range compared to LDR. </p><p id="p0011" num="0011"> SUMMARY </p><p id="p0012" num="0012"> [0007] Several embodiments of display systems and methods of their manufacture and use are herein disclosed. </p><p id="p0013" num="0013"> [0008] Systems and methods for overlaying a second image/video data onto a first image/video data are described herein. The first image/video data may be intended to be rendered on a display with certain characteristics - e.g., HDR, EDR, VDR or ultra-high definition (UHD, e.g., 4K or 8K horizontal resolution) capabilities. The second image/video data may comprise graphics, closed captioning, text, advertisement - or any data that may be desired to be overlaid and/or composited onto the first image/video data. The second image/video data may be appearance mapped according to the image statistics and/or characteristics of the first image/video data. In addition, such appearance mapping may be made according to the characteristics of the display that the composite data is to be rendered. Such appearance mapping is desired to render a composite data that is visually pleasing to a viewer, rendered upon a desired display. </p><p id="p0014" num="0014"> [0009] In one embodiment, a method for overlaying a second image data over a first image data is disclosed - comprising: receiving a first image and a second image, the first image differing in dynamic range and size than the second image; receiving first metadata regarding the first image; receiving second metadata regarding the second image; </p><p id="p0015" num="0015">performing appearance mapping of the second image to determine an adjusted second image, said adjusted second image differing in dynamic range than the second image, according to the first metadata and the second metadata; and forming a composite image overlaying the adjusted second image onto at least a portion of the first image </p><p id="p0016" num="0016"> [00010] In another embodiment, a system for compositing a second image data onto a first image data is disclosed - comprising: a display management module, the display management module capable of receiving a first image; a compositor module, said compositor module capable of receiving a second image; wherein further said compositor module capable of receiving metadata regarding the first image and capable of performing 
<!-- EPO <DP n="5"/>-->
 appearance mapping the second image to form an appearance mapped second image in accordance with said metadata regarding the first image; and a mixing module, said mixing module capable of mixing the appearance mapped second image onto the first image to form a composite image, the composite image intended to be rendered upon a display. </p><p id="p0017" num="0017"> [00011] In another embodiment, systems and methods for dynamic advertising is disclosed in which an existing composite image - formed from a first image/video data with a second overlaid image/video data - may be mapped and/or converted into another composite image where all or a part of the second overlaid image/video data may be replaced by a third overlaid image/video data. </p><p id="p0018" num="0018"> [00012] Other features and advantages of the present system are presented below in the Detailed Description when read in connection with the drawings presented within this application. </p><p id="p0019" num="0019"> BRIEF DESCRIPTION OF THE DRAWINGS </p><p id="p0020" num="0020"> [00013] Exemplary embodiments are illustrated in referenced figures of the drawings. It is intended that the embodiments and figures disclosed herein are to be considered illustrative rather than restrictive. </p><p id="p0021" num="0021"> [00014] FIG. 1 shows one exemplary environment in which one embodiment of the present application may operate. </p><p id="p0022" num="0022"> [00015] FIGS. 2A and 2B show two examples of a rendered image comprising a EDR/VDR image data and an overlay of graphics and closed captioning, first without appearance mapping and then with appearance mapping applied, respectively. </p><p id="p0023" num="0023"> [00016] FIG. 3 shows image/video processing of three possible processing scenarios, an image, a scene and a movie, respectively. </p><p id="p0024" num="0024"> [00017] FIGS. 4 and 5 are two embodiments of a present system that may affect a visually pleasing composite image/video signal upon EDR/VDR-capable displays. </p><p id="p0025" num="0025"> [00018] FIG. 6 is one embodiment of a present system that may affect a visually pleasing composite image/video signal upon legacy displays. </p><p id="p0026" num="0026"> [00019] FIG. 7 depicts one exemplary embodiment of the module/routine for appearance mapping overlay/composite image/video data onto a first image/video data for subsequent rendering upon a display. </p><p id="p0027" num="0027"> [00020] FIG. 8 depicts one exemplary embodiment of the appearance mapping of with respect to dynamic range, minimum luminance, reflective white point and absolute maximum. 
<!-- EPO <DP n="6"/>-->
 [00021] FIGS. 9A, 9B, 9C and 9D depict one exemplary embodiment of the appearance mapping of with respect to color gamut. </p><p id="p0028" num="0028"> [00022] FIGS. 10A, 10B and IOC depict one exemplary embodiment of performing dynamic content replacement. </p><p id="p0029" num="0029"> [00023] FIG. 11 is another embodiment of dynamic content replacement. </p><p id="p0030" num="0030">DETAILED DESCRIPTION </p><p id="p0031" num="0031"> [00024] Throughout the following description, specific details are set forth in order to provide a more thorough understanding to persons skilled in the art. However, well known elements may not have been shown or described in detail to avoid unnecessarily obscuring the disclosure. Accordingly, the description and drawings are to be regarded in an illustrative, rather than a restrictive, sense. </p><p id="p0032" num="0032"> Introduction </p><p id="p0033" num="0033"> [00025] In a typical visual experience with current legacy consumer TVs, there is very little control over the appearance and mapping of the incoming video stream using standards such as Rec.709 and DCI Specs. This is particularly true of graphic or video overlays that may be desired to be integrated onto a first video stream, mixed and then rendered for viewing by an individual. In one embodiment of the present system, it may be desirable to provide suitable image processing and/or mixing of such overlays onto a first image/video data stream in such a manner as to provide appearance matching and/or an improved visual experience for a viewer of the composite image and/or video. </p><p id="p0034" num="0034"> [00026] FIG. 1 illustrates an environment (100) in which one embodiment of a system (104) made in accordance with the present application. In this environment (100), a present system 104 may receive a first data and/or metadata 102 (e.g., VDR, EDR, HDR or some other image and/or video data/metadata) to be rendered on a display 114. In addition, there may be another stream of external data/content 106 (e.g., from a potential plurality of sources - Internet, IP, other data sources, etc.). This other stream of data/content may represent graphics, images and/or video that is to be composited or otherwise mixed with the first data stream. It should be appreciated that streams 102 and 106 may also come to the system 104 from the same source and in the same manner. </p><p id="p0035" num="0035"> [00027] Data stream 102 may be input into a Display Management (DM) module 108 for image processing suitable for rendering onto display 114. Compositor 110 may be another image processing/video processing module that inputs the composite data stream (106) - as well as data and/or metadata from DM 108. Compositor 110 may format the composite data stream as GUI, Closed Captioning (CC), Picture In Picture (PIP) or any other possible format for the composite data to be mixed and/or composited with the first data stream. Metadata may also include metadata regarding the rendering characteristics of the 
<!-- EPO <DP n="7"/>-->
 display upon which the composite image may be rendered. Such metadata may include avg., min/mean/max luminance, reflective white, whitepoint, color gamut and any other known image rendering characteristic and/or specification. </p><p id="p0036" num="0036"> [00028] A viewer may have optional control input to the compositor 110 - e.g., via a remote control, laptop, tablet, smart phone or another suitable controller (116) - in order to input viewer desires or demands for such composite rendering. </p><p id="p0037" num="0037"> [00029] The composite image/video data and the first video stream (after whatever processing has been applied by DM 108) may be input to a mixing module 112. Mixing module 112 may suita bly overlay the composite image/video data onto the first data stream</p><p id="p0038" num="0038">- e.g., using any advanced image/video processing algorithm described herein and as known</p><p id="p0039" num="0039">- to provide a pleasant viewing experience. As described further herein, such a pleasant viewing experience may be enhanced by appearance matching the composite image/video data to the characteristics of the first image data and/or the characteristics of the display (114) on which the final composite image/video is to be rendered. </p><p id="p0040" num="0040"> [00030] It should be appreciated that - although the DM, compositor and the mixing modules may be resident in the display itself (as functional modules) - it is possible that DM, compositor and mixing modules may physically reside elsewhere and may be remote from each other. For example, it may be possible to place one or more of these modules in a set top box and have it be in communication with display (e.g., by any known wired or wireless configuration). In another embodiment, DM, compositor and/or mixer may be out of the physical room where the display resides. In other embodiments, it may be possible to place the functionality of any or all three of these modules into a single module. For example, a DM module may be constructed to include the functionality of typical DMs - as well as the functionality of the compositor and the mixer. </p><p id="p0041" num="0041"> [00031] In one embodiment, it may be desirable to have an image statistics calculating module for the calculation of various statistics known in image processing (as also described further herein). Such statistics (e.g., of the first image/video data, second overlay image/video data and the like) may be used further by the present system to aid in the appearance mapping of the second overlay image/video data onto the first image/video data. Any of the modules mentioned herein may incorporate the image statistics module, as is known in the art to do. </p><p id="p0042" num="0042"> [00032] In one embodiment, these modules may reside at an image/video front end supplier (e.g., cable operator, satellite operator and/or other media suppliers). Thus, it may be desirable to distinguish and/or note where the graphics overlay is injected into the content, -- e.g., generated at the content creation side (e.g., subtitle), the broadcasting company (e.g., logos), Set Top Box (e.g., Ul, TV guide, cc), TV itself (e.g. Ul), AV receiver (e.g., volume bar graphics overlay, or any signal switch/modifier/AV processor that may add graphics or modify the input video stream otherwise. At any such stage, the overlay and 
<!-- EPO <DP n="8"/>-->
 compositing may be dealt with differently. It may also be desirable to have the Ul and overlay injection points be aware of each other (i.e., pipeline-awareness). In such a case, it may be possible to avoid re-analyze and re-map Ul graphics already embedded into the video stream (e.g. broadcast logos are commonly embedded early in the stream). Beside of general Ul rendering, all this information may also be provided to the operating system of the playout device so that for example a web browser running on a smart TV can access it. </p><p id="p0043" num="0043"> [00033] As mentioned above, in one embodiment, the video stream may be a HDR,</p><p id="p0044" num="0044">EDR and/or VDR data/metadata stream and, as such, some portion of the video processing system may affect HDR, EDR and/or VDR image/video processing. Various systems, techniques and/or technologies involving HDR, EDR and VDR data and metadata processing may be found in the following co-owned patent applications: </p><p id="p0045" num="0045"> (1) United States Patent Application 20130027615 to Li, published January 31, 2013 and entitled "QUALITY ASSESSMENT OF HIGH DYNAMIC RANGE, VISUAL DYNAMIC RANGE AND WIDE COLOR GAMUT IMAGE AND VI DEO"; </p><p id="p0046" num="0046"> (2) United States Patent Application 20130004074 to Gish, published on January 3, 2013 and entitled "QUALITY ASSESSM ENT OF IMAGES WITH EXTENDED DYNAMIC RANGE"; </p><p id="p0047" num="0047"> (3) United States Patent Application 20120321273 to Messmer, published on December 20, 2012 and entitled "VIDEO DISPLAY CONTROL USING EMBEDDED METADATA"; </p><p id="p0048" num="0048"> (4) United States Patent Application 20120315011 to Messmer et al., published on December 13, 2012 and entitled "VIDEO DELIVERY AND CONTROL BY OVERWRITI NG VIDEO DATA"; </p><p id="p0049" num="0049"> (5) United States Patent Application 20120314944 to Ninan et al., published on December 13, 2012 and entitled "HIGH DYNAMIC RANGE, BACKWARDS- COMPATIBLE, DIGITAL CINEMA"; </p><p id="p0050" num="0050"> (6) United States Patent Application 20120314773 to Gish et al., published on December 13, 2012 and entitled "DRIFT-FREE, BACKWARDS COMPATIBLE, LAYERED VDR CODING"; </p><p id="p0051" num="0051"> (7) United States Patent Application 20120299817 to Atkins et al., published on November 29, 2012 and entitled "SYSTEMS AND METHODS OF IMAGE </p><p id="p0052" num="0052"> PROCESSING THAT ADJUST FOR VIEWER POSITION, SCREEN SIZE AND VIEWING DISTANCE"; </p><p id="p0053" num="0053"> (8) United States Patent Application 20120229495 to Longhurst, published on September 13, 2012 and entitled "INTERPOLATION OF COLOR GAMUT FOR DISPLAY ON TARGET DISPLAY"; 
<!-- EPO <DP n="9"/>-->
 (9) United States Patent Application 20120038782 to Messmer et al., published on February 16, 2012 and entitled "VD M ETADATA Tl M ESTAM P TO ENHANCE DATA COHERENCY AND POTENTIAL OF METADATA"; </p><p id="p0054" num="0054"> (10) United States Patent Application 20090322800 to Atkins, published on December 31, 2009 and entitled "METHOD AND APPARATUS IN VARIOUS </p><p id="p0055" num="0055"> EMBODIMENTS FOR HDR IMPLEMENTATION IN DISPLAY DEVICES"; </p><p id="p0056" num="0056"> (11) United States Patent Application 20130004074 to Gish, pu blished on January 3, 2013 and entitled "QUALITY ASSESSM ENT OF IMAGES WITH EXTENDED DYNAMIC RANGE"; </p><p id="p0057" num="0057"> (12) United States Patent Application 20100118957 to Demos, published on May 13, 2010 and entitled "VIDEO IMAGE COMPRESSION USING UNEQUAL WEIGHTS"; </p><p id="p0058" num="0058"> (13) United States Patent Application 20100014587 to Demos, published on January 21, 2010 and entitled "INTERPOLATION OF VI DEO COMPRESSION FRAMES"; </p><p id="p0059" num="0059"> (14) United States Patent Application 20080273809 to Demos, published on November 6, 2008 and entitled "METHOD AND SYSTEM FOR IMPROVI NG </p><p id="p0060" num="0060"> COMPRESSED IMAGE CHROMA INFORMATION"; </p><p id="p0061" num="0061"> (15) United States Patent Application 20070268967 to Demos, published on November 22, 2007 and entitled "INTERPOLATION OF VI DEO COMPRESSION FRAMES"; </p><p id="p0062" num="0062"> (16) United States Patent Application 20110103470 to Demos et al., published on May 5, 2011 and entitled "HIGH PRECISION ENCODING AND DECODING OF VIDEO IMAGES" </p><p id="p0063" num="0063"> - all of which are herein incorporated by reference in their entirety. </p><p id="p0064" num="0064"> [00034] In addition, Display Management subsystems may comprise a part of the system for providing a pleasing viewing experience for such composited image/video data on a first data stream. DM systems typically comprise a processor, computer readable storage and a set of computer readable instructions that are suitable to affect a wide array of image processing algorithms and techniques - e.g., luminance mapping, color gamut mapping, dynamic range mapping. </p><p id="p0065" num="0065"> [00035] DM systems are further described in the following co-owned US patent applications: </p><p id="p0066" num="0066"> (1) United States Patent Application 20120321273 to Messmer, published on December 20, 2012 and entitled "VIDEO DISPLAY CONTROL USING EMBEDDED METADATA"; 
<!-- EPO <DP n="10"/>-->
 (2) United States Patent Application 20120315011 to Messmer et al., published on December 13, 2012 and entitled "VIDEO DELIVERY AND CONTROL BY OVERWRITI NG VIDEO DATA"; </p><p id="p0067" num="0067"> (3) United States Patent Application 20120229495 to Longhurst, pu blished on September 13, 2012 and entitled "INTERPOLATION OF COLOR GAMUT FOR DISPLAY ON TARGET DISPLAY"; </p><p id="p0068" num="0068"> (4) United States Patent Application 20120200593 to Todd et al., published on August 9, 2012 and entitled "RESOLUTION MANAGEMENT FOR MULTI-VIEW DISPLAY TECHNOLOGIES"; </p><p id="p0069" num="0069"> (5) United States Patent Application 20120127324 Dickens et al., pu blished on May 24, 2012 and entitled "METHOD AND SYSTEM FOR DISPLAY </p><p id="p0070" num="0070"> CHARACTERIZATION OR CALIBRATION USING A CAMERA DEVICE"; </p><p id="p0071" num="0071"> (6) United States Patent Application 20120075435 to Hovanky et al., published on March 29, 2012 and entitled "METHOD AND SYSTEM FOR 3D DISPLAY CALIBRATION WITH FEEDBACK DETERMINED BY A CAMERA DEVICE"; </p><p id="p0072" num="0072"> (7) United States Patent Application 20120074851 to Erinjippurath, pu blished on March 29, 2012 and entitled "METHOD AND SYSTEM FOR DISPLAY CALIBRATION WITH FEEDBACK DETERMINED BY A CAMERA DEVICE"; </p><p id="p0073" num="0073"> (8) United States Patent Application 20110311147 to Pahalawatta et al., published on December 22, 2011 and entitled "QUALITY EVALUATION OF </p><p id="p0074" num="0074"> SEQUENCES OF IMAGES"; </p><p id="p0075" num="0075"> (9) United States Patent Application 20110194618 to Gish et al., published on August 11, 2011 and entitled "COMPATIBLE COMPRESSION OF HIGH DYNAMIC RANG E, VISUAL DYNAMIC RANGE, AND WIDE COLOR GAMUT VIDEO"; </p><p id="p0076" num="0076"> (10) United States Patent Application 20090086816 to Leontaris et al., published on April 2, 2009 and entitled "VIDEO COMPRESSION AND TRANSMISSION TECHNIQUES" </p><p id="p0077" num="0077"> - all of which are hereby incorporated by reference in their entirety. </p><p id="p0078" num="0078"> One Composite Image Example </p><p id="p0079" num="0079"> [00036] In one embodiment, to provide a pleasing visual experience, it may be desirable to mix the composite signal with the first image/video signal in accordance with the characteristics of the first signal and/or the characteristics of the display. For example, as video and display technology improves, there is a trend to moving towards displays that are capable of rendering VDR/EDR/HDR data. Such data -- and displays that are capable of rendering such data - provide suitable means to faithfully reproduce a movie/video in the 
<!-- EPO <DP n="11"/>-->
 way the director intended - i.e., to within the capabilities of the display hardware used to show and/or render the data. In one instance, higher luminance levels especially for highlights may be reproduced -- which was not typically possible with legacy approaches. </p><p id="p0080" num="0080"> [00037] Apart from the higher quality image/video data distributed to the display/TV, other image elements (not comprising necessarily the actual movie/video content) are other user interface elements - e.g., menus, cursors and other on screen display elements such as close captioning or Blu ay disc menus. However, the appearance rendering of those elements is typically not defined in EDR/VDR -- nor is typically with respect to legacy video. </p><p id="p0081" num="0081"> [00038] Thus, one embodiment of a present system affects a perceptually accurate rendering of user interface elements on a display device using the system and methods disclosed herein - to affect a colorimetricy, perceptual and aesthetically correct rendering of those before-mentioned user interface (Ul) elements and other image/video content. </p><p id="p0082" num="0082"> [00039] FIGS. 2A and 2B are two examples of a rendered image (200 and 200', respectively). In image 200, there is depicted an image comprising high dynamic range contrast -- e.g., portions of very high luminance (as seen by the light of the arc welder) in proximity to very dark portions (as seen in the shadows, e.g. where word "Text" is displayed). In addition, there are graphics and text elements overlaid that have been composited with the high dynamic range image (e.g. menu 202 and the captioning reading "Max. Codeword Closed Captioning Text"). </p><p id="p0083" num="0083"> [00040] There are many visual features to note in FIG. 2A. For example, it may be seen that the menu 202 exhibits luminance banding - i.e., a gradation of luminance, with high luminance at the top, with a tapering to darker luminance at the bottom. In addition, it may be seen that the Closed Captioning is sent to the display at maximum codeword intensity level which may lead to the text being displayed at the same luminance as, e.g., the welding torch flame. This may seem distracting or create discomfort to a viewer of the text due to the intense brightness, especially if there are also areas of lower luminance in the first image/video portions (e.g. around the word "Text"). </p><p id="p0084" num="0084"> [00041] Examining the legacy approach of FIG. 2A, white text rendered as full code word would tend to be too bright on an EDR/VDR TV. Instead, text on an EDR TV may be rendered with a reflective white level (e.g. 300cd/m<sup>2</sup>) and the prevailing white point (here CCT of 4000K). It may be noted that the above images appear as may be graded for 4000cd/m<sup>2</sup> max. Displayed on such a capa ble TV, the text in FIG. 2B would appear as reflective (or similar to "paper white") while the one in FIG. 2A would appear glowing. </p><p id="p0085" num="0085"> [00042] While the rendering of the white menu text with the maximum possible code value (e.g., slightly below EDR code value 4096 in 12-bit) may tend to cause text to be perceived as glowing, it might also create discomfort due to intense dynamic range difference between text and movie/film background. Instead of rendering with a preset code value, it may be possible to apply an absolute luminance level (e.g., 300 nits or based 
<!-- EPO <DP n="12"/>-->
 on results from VDR limits studies) as well as the whitepoint (e.g. averaged over scene, chapter or whole movie), as further defined by the EDR input and display device capabilities. In addition, the extent of the color gamut can be taken into account to adjust the chroma extent that is used by overlaid text and graphics (e.g. avoiding highly saturated green text on a black and white scene). </p><p id="p0086" num="0086"> [00043] These effects are also possible for rendering subtitles in DVD and Blu-ray. The subtitles in a lot of movies may be in color. In order to maintain consistency in brightness and colors, it may be desirable to map the overlaid su btitle images to the characteristics of content. This mapping may be affected with scene based parameters since the overlays may later be mapped down to the display capability with the content, where the mapping may be scene-adaptive. The pair of mapping up and down processes may tend to make the subtitles appear perceptually correct and consistent. </p><p id="p0087" num="0087"> [00044] By contrast, FIG. 2B shows a composite image 200' comprising the substantially the same high dynamic range image (i.e. the welder in a dark garage) and similar menu (202') and CC text. In this case, the menu 202' and CC text have been composited - according to the characteristics of the first HDR image (and possibly the characteristics of the display rendering it). It may be seen that the new composite image does not exhibit the wide luminance banding/gradation as seen in menu 202. In addition, the high luminance of the text and menu do not distract the viewer from details in the low luminance portions of the first HDR image. </p><p id="p0088" num="0088"> One Embodiment </p><p id="p0089" num="0089"> [00045] FIG. 3 is one embodiment of some image/video processing 300 that may comprise modules and/or processing affected by portions of a present system. FIG. 3 depicts three possible processing scenarios - an image, a scene (e.g., a collection of related images) and a movie (e.g., a collection of related scenes). In the case of the image 302, metadata may be computed and collected. For example, image statistics may be calculated - such as: average luminance, min/mean/max luminance, reflective white, color temperature and/or the whitepoint of the image. For scene 304, the similar statistics may be calculated - for each image within the scene and then computed for the scene itself. For a movie 306, the similar statistics may be calculated - for each image within a scene and then computed for a scene itself and then computed for the entire movie. In addition to image statistics or metadata that is static in nature, there may also be metadata that may characterize the temporal behavior of the changes of images within a scene, or changes of scenes within a movie. </p><p id="p0090" num="0090"> [00046] In addition to those image statistics mentioned, a color palette may be computed for each image, scene and/or movie - e.g., by analyzing a histogram, spatial pixel correlations or other image and/or scene intrinsic properties. The combination of image statistics and/or color palette may comprise a set of metadata (e.g. 302', 304' and 306', 
<!-- EPO <DP n="13"/>-->
 respectively). In addition, similar metadata may be gathered regarding the capabilities of the display - e.g., luminance (min, mean, max), color temperature, reflective white point, color gamut, primaries, etc. This metadata may then be used by some portion of the system - e.g. compositor, or DM (if that functionality has been incorporated into the DM itself). </p><p id="p0091" num="0091"> Embodiments involving EDR TV </p><p id="p0092" num="0092"> [00047] As previously mentioned, TV and/or displays are exhibiting more capability to render higher dynamic range image/video. EDR/VDR render-capable displays (e.g. Ultra High Definition (UHD) sets) are becoming more accepted by the consumer. As such FIGS. 4 and 5 are two embodiments of a present system that may affect a visually pleasing composite image/video signal to such sets. In FIG. 4, system 400 may start with a UHD EDR decoder 404 may accept a first EDR/VDR/HDR image/video data. At substantially the same time, display management module 406 may accept the overlay and/or other image data to be composited with the input image/video data. The EDR metadata may be computed and shared with the module 406 and module 406 may output processed image data to be composited which may tend to be more visually acceptable to a viewer. </p><p id="p0093" num="0093"> [00048] The first image data and the composite image data may be mixed or otherwise overlaid by a mixing module 408. The output of which may be input into a HDMI transmit module 410. Module 410 may accept as input: the EDR metadata, the composited image data (i.e., the first image data mixed with the composite image data) - as well as information regarding the capabilities of the display to display EDR image data. </p><p id="p0094" num="0094"> [00049] As seen in FIG. 2A, dotted line 402 may conceptually mark the line at which image and processing comes from outside the display set (e.g., the left hand side of line 402) and processing within the set itself and/or set top box (e.g., right hand side of line 402). As mentioned above, the present system is not necessarily limited to these lines of </p><p id="p0095" num="0095">demarcation - as processing may reside in many parts of this pipeline - without loss of the scope of the present application. This information may come from the EDID of the display. In one embodiment, the TV/display's EDID may inform a STB (or processing further up the chain of image processing) about whether the display is an EDR TV/display or Legacy TV/display. If the display is legacy, the STB (or the like) might want to process the EDR signals and render graphics overlay properly. If the display is EDR-capable, the EDID may be configured to feed information back to the STB (or further up) - which may help to process (e.g., perceptually map) the graphics overlays, while (at the same time) providing more accurate data about the display for a better appearance mapping processing within the TV itself. </p><p id="p0096" num="0096"> [00050] The composited signal may be received by HDMI receiver module 412 and may pass that signal through (with or without additional processing) to DM module 414. DM module may provide some additional processing to ensure that the image data is in line with the capabilities of display 416 for a pleasing visual experience for the viewer. 
<!-- EPO <DP n="14"/>-->
 [00051] FIG. 5 is yet another embodiment of a present system for processing image/video data on an EDR/VDR enabled display. Similarly numbered elements (e.g., 416 and 516) perform substantially similar functions in both FIGS. 4 and 5. However, in FIG. 5 is may be seen that a backchannel of information regarding the capabilities of the display is send further back in the image processing pipeline - e.g., to the display management module 506 (which is similar to the compositor module in FIG. 1). In this scenario, more of the compositing processing may take place closer to the front end/creator of the first image content. This may be desirable in the case of a content distributor to control more aspects of the overlay content - as will be discussed further herein with regards to advertising. </p><p id="p0097" num="0097"> Embodiment involving Legacy TV/Displays </p><p id="p0098" num="0098"> [00052] FIG. 6 is one embodiment in which the TV/display is a legacy - i.e., has no or very limited capability to display high dynamic range and/or wide color gamut image/video data. In this embodiment, system 600 may receive EDR/VDR image data at decoder 602. Metadata may be computed and sent to overlay mapper 606 which may also receive the overlay/composite image/video data. DM module 608 may receive the first image/video data, EDR metadata and the color gamut data (e.g., xvYCC or Rec 709) of the display - for further processing. An optional scaler 610 may be placed in the image processing pipeline. In one embodiment, a scaler may be used to generate content with native spatial resolution. For example, if the input to UHD EDR decoder 604 has UHD resolution and display 618 has only 1080p, the scaler may reduce the spatial resolution of the input signal to 1080p. </p><p id="p0099" num="0099"> [00053] The first image/video data may be mixed or otherwise composited with the composite image/video data at mixer module 612 - and thereafter sent to HDMI transceiver 614. Module 614 may receive the display capabilities from HDMI receiver module 616 (via EDID interface) and appropriate image processing may take place to be in accord with display 618 capabilities. </p><p id="p0100" num="0100"> [00054] In another embodiment, if a legacy device without EDR capabilities (e.g. PC, games console, VCR, etc.) may display picture-in-picture (PIP) content, it may be desirable that the dynamic range of that content be managed while being superimposed into the VDR image. This management/mapping information may for example be the min/max reflective white and white point from the DM process. In yet another embodiment, if the connected device is a Personal Computer, those values could also be communicated back to the PC (e.g. via HDMI back channel) to adjust the rendering of the graphics card before sending it to the display. </p><p id="p0101" num="0101"> One Processing Embodiment </p><p id="p0102" num="0102"> [00055] As with the various embodiments disclosed herein that may encompass a number of possible configurations for overlaying and/or compositing a second image/video data onto a first image/video data, FIG. 7 is one possible embodiment of a compositing processing module and/or routine. Such a processing module/routine (700) may reside 
<!-- EPO <DP n="15"/>-->
 within the compositor, the DM module, a combination of such modules - or, alternatively, any place where there is suitable processor and computer readable storage. </p><p id="p0103" num="0103"> [00056] Starting at 700, compositing module/routine may input metadata of overlay/composite image/video data (aka, a second image/video data) at 702. Such metadata may be computed and/or compiled as image statistics or color palette (e.g., as previously discussed) or any other known manner (e.g. streaming metadata with the second image/video data). At 704, module/routine may input metadata regarding the first image/video data (e.g., luminance, dynamic range, whitepoint, etc.). Such metadata may be computed and/or compiled as image statistics or color palette (e.g., as previously discussed) or any other known manner (e.g. streaming metadata with the first image/video data). At 706, module/routine may input metadata regarding the characteristics of the display upon which the composited image/video data (i.e. first image/video data together with the overlay/composite image/video data) is to be rendered. At 708, module/routine may perform an appearance mapping or otherwise compositing of the overlay/composite image/video data -- that provides a pleasing visual appearance - to form or otherwise create a composite image/video data. This mapping may take into consideration many possible heuristic rules and/or goals that are embedded into the module/routine that provides such a pleasing appearance. Alternatively, the module/routine may perform appearance mapping upon the first image/video data, if desired or appropriate. </p><p id="p0104" num="0104"> [00057] Such rule and/or goals may affect approximating good fits to luminance, dynamic range, color gamut, color appearance and the like, using various techniques. Some such methods and/or techniques for modifying display setting (e.g., dynamic range and implementing color appearance models) are further disclosed in co-owned US Patent Applications: </p><p id="p0105" num="0105"> (1) United States Patent Application 20120051635 to Kunkel et al., published on March 1, 2012 and entitled "LIGHT DETECTION, COLOR APPEARANCE MODELS, AND MODIFYING DYNAMIC RANGE FOR IMAGE DISPLAY"; </p><p id="p0106" num="0106"> (2) United States Patent Application 20110305391 to Kunkel et al., published on December 15, 2011 and entitled "IMAGE PROCESSING AND DISPLAYING </p><p id="p0107" num="0107"> METHODS FOR DEVICES THAT IMPLEMENT COLOR APPEARANCE MODELS"; </p><p id="p0108" num="0108"> (3) United States Patent Application 20120320014 to Longhurst et al., published on December 20, 2012 and entitled "SYSTEM AND METHOD FOR </p><p id="p0109" num="0109"> ADJUSTING DISPLAY BASED ON DETECTED ENVIRONMENT"; </p><p id="p0110" num="0110"> (4) United States Patent Application 20120026405 to Atkins et al., published on February 2, 2012 and entitled "SYSTEM AND M ETHOD OF CREATING OR </p><p id="p0111" num="0111"> APPROVING MULTIPLE VIDEO STREAMS"; 
<!-- EPO <DP n="16"/>-->
 (5) United States Patent Application Number 20100231603 to Kang, published September 16, 2010 and entitled "ARTIFACT MITIGATION METHOD AND APPARATUS FOR IMAGES GENERATED USING THREE DIMENSIONAL COLOR SYNTHESIS" </p><p id="p0112" num="0112"> - all of which are incorporated by reference in their entirety. </p><p id="p0113" num="0113"> [00058] Once such mapping are calculated and/or approximated, then the composite image may be formed and the resulting image/video data may be sent forward to the display at 710. This processing may continue indefinitely while there are images/video to be overlaid occur. </p><p id="p0114" num="0114"> Embodiment of HDR/EDR/VDR Processing </p><p id="p0115" num="0115"> [00059] FIG. 8 depicts one exemplary embodiment of the appearance mapping of overlay/composite image/data onto first image/video data for rendering onto a device with respect to dynamic range, minimum luminance, reflective white point and absolute maximum. All dynamic range bars shown in FIG. 8 are related to the reference dynamic range shown in 802 here reflecting the full VDR signal range 804. Each dynamic range bar is illustrated as ranging from a minimum to a maximum luminance. The middle intersection line within a dynamic range bar references a luminance value representing reflective white. </p><p id="p0116" num="0116"> [00060] FIG. 8 illustrates how scene-by-scene dynamic ranges may be mapped on a display comprising a dynamic range as expressed as 808. The input VDR signal 804 may potentially be mapped to the maximum dynamic range 808 of the physical display device. However, based on the actual dynamic range present in the input VDR scene, the display management (DM) module may allocate different dynamic range intervals and reflective white points to each scene on the primary displays, illustrated by Scene 1, 2 and 3 (810a, 810b and 810c, respectively). </p><p id="p0117" num="0117"> [00061] This mapping information may be sent to the compositor (or any module having processing similar to the compositor as previously mentioned). This compositor (or the like) may receive as input the overlay/composite content and map this content into DR ranges illustrated by 810a', 810b' and 810c', respectively. </p><p id="p0118" num="0118"> [00062] It should be noted that the dynamic range of the actual content on overlay/composite input image data (e.g. Ul, CC, text, etc.) may not use the full dynamic range of the display. Instead, the system selects a range that will tend to be a perceptual match in dynamic range and lightness as close as possible to the first image data and the capa bilities of the display. 
<!-- EPO <DP n="17"/>-->
 Embodiment of Chroma Mapping </p><p id="p0119" num="0119"> [00063] In addition to visually pleasing mapping with respect to dynamic range, it may also be desira ble to map and/or composite the image/video data to a visually pleasing color gamut. FIGS. 9A, 9B, 9C and 9D depict one exemplary embodiment of the mapping of overlay/composite image/video data onto a first image/video data for rendering onto a display device with respect to color gamut. FIG. 9A represents the color gamut (e.g., 902 as placed within the CIE xy Chromaticity Diagram 900) as may be present in the first image/video data stream. This image/video data may comprise a white point 906 which may lie anywhere on the blackbody curve 904 or anywhere else inside the chromaticity diagram. </p><p id="p0120" num="0120"> [00064] During DM processing (as depicted by FIG. 9B), the color gamut may shrink with respect to the full color gamut available in the first image/video data. This possibly smaller color gamut 908 may express the limitation of the physical display gamut - and it may also exhibit a different white point 910. </p><p id="p0121" num="0121"> [00065] FIG. 9C factors in the small gamut exhibited by the display and, during dynamic color mapping of the first image content (as may occur on an image-by-image, scene-by-scene basis). It may be seen that the overall chroma vector for a given image (C) and the outer range of the color gamut may change from image-to-image (as denoted by the various solid and dotted gamut circles). </p><p id="p0122" num="0122"> [00066] When the composite image (i.e., the first image/video data and the overlay data) is to be mapped onto the display, a further gamut mapping (as shown in FIG. 9D) may occur. As with FIG. 9C, various color gamuts (i.e., 914, 916, 918) may appear image-by- image - each with its own possible overall gamut vector C and white point WP, to fit within an overall gamut 912. In order to have the overlay/composited graphics perceptually match the actual gamut of the DM'd VD stream, it may be desirable to have the frame/scene gamut, chroma and/or whitepoint settings be substantially the same or at least similar between FIG. 9C and 9D. </p><p id="p0123" num="0123"> Possible Advertising Example/Embodiment </p><p id="p0124" num="0124"> [00067] As one possible application of the composite image processing mentioned herein, it may be possible and/or desirable to consider dynamic content replacement with images/scenes and/or movies. One exemplary case would be to place advertisements in existing content - or replace advertisements that are in existing content, with other advertisements. FIGS. 10A, 10B and IOC depict one embodiment of a dynamic content replacement that may be affected by the present systems and/or methods - in this case, the new content is advertisement. In other embodiments, besides advertising, any other content may be superimposed - e.g., weather information, stock market information, website and social media content, etc. Such information may also be dynamically inserted and/or updated as desired. In one embodiment, dynamic mapping may be the replacement 
<!-- EPO <DP n="18"/>-->
 of the first image/video data, or alternatively, a second, overlay image/video data - e.g., that may have already been composited with a first image/video data - with a third and/or different image/video data. Such replacement of one set of image/video data with another set of image/video data may be total replacement - or a replacing just a subset of the replaced image/video data. In one embodiment, a present system may comprise a dynamic mapping module that is capable of such replacement of one set of image/video data with another image/video data, as described herein. </p><p id="p0125" num="0125"> [00068] FIG. 10A depicts one exemplary image/scene (e.g., in this example, a scene of a road and an advertising billboard 1002). Billboard 1002 represents an area within this image/scene for an opportunity to overlay different advertisements - as desired by the content originators and/or owners. For example, it is possible to place "targeted" ads to a viewer/consumer (if such information regarding the viewers, their likes and dislikes may be known, guessed or statistically derived -e.g., by analyzing social media networks). In another example, it may be possible to update images over a longer period of time. One such example might be updating older movies, TV content or other such older/legacy content that had in its billboard a now-bankrupt/defunct company. To update the movie (and make it seem presently relevant), new bill board content may be added to that area, thus overwriting the old image data within the bill board. </p><p id="p0126" num="0126"> [00069] In FIG. 10A, it may be seen that the billboard content may be comprised of the actual pixel information 1004 representing the advertisement, and an alpha channel 1006 which may be combined by a bounding box 1008. This bounding box may define a region of performing image processing for the proper overlaying and/or compositing of advertisement upon the billboard. All pixels inside 1008 (as well as the actual size of it) may change from frame-to-frame. </p><p id="p0127" num="0127"> [00070] FIG. 10B shows the content of FIG. 10A with the difference of a swapped content (e.g., instead of 1002, it is possible to have 1010). It should be appreciated that the main scene frame may be kept substantially the same, while the advertisement (or other content) may be dynamically changed. For example, content 1002 may be su bstantially 1004 - and content 1010 may be substantially 1012. In one embodiment, the information displayed as 1002 or 101 may be provided to a compositor (e.g., 110, or the like) as external content 106. This may be in the full signal specification, as the original VD stream 102 or any possible subset of it (e.g., super- or sub-sampled, lower bit depth, or any other form of compression); although a luminance and/or color reference may be provided in order to composite 1008 into the first image/video data. </p><p id="p0128" num="0128"> [00071] FIG. IOC depicts another aspect of the processing for dynamic advertising - e.g., as one frame compared with a subsequent frame of a same scene (perhaps e.g., 10 frames later or the like). As may be seen in FIG. IOC, there may be an object (e.g., the lamppost) within the area of the billboard. In addition, there may be another part of the image that may interact with the image of billboard (e.g., puddle 1002' - which may reflect 
<!-- EPO <DP n="19"/>-->
 the image on the billboard). In this case, it would be desirable for the present system to maintain proper processing of these effects. For example, line 1012 may be considered in permanently in the foreground of the billboard image, without regard to the particular advertisement that may go onto the billboard. In addition, the present system may include a separate region into the bounding box structure 1008 - in order to properly composite new and/or different advertisements onto the billboard. </p><p id="p0129" num="0129"> [00072] Another embodiment may be to provide a texture that may then be mapped into place on the billboard by using a geometric transform module, such as -- e.g., a Graphics Processing Unit (GPU). </p><p id="p0130" num="0130"> [00073] In addition, for real time compositing into existing EDR video stream, the appearance/DM metadata in combination with alpha channels may be used to composite information into the video image. This may be used to aid in swapping advertisements on billboards appearing in movie footage. If the appearance parameters of the movie are known, the advertisement may be mapped without the viewer realizing that composition. With increasing computing power in play-out devices, this is feasible in the near future. </p><p id="p0131" num="0131"> Adding Additional Content to Existing Image/Video </p><p id="p0132" num="0132"> [00074] When restoring and/or reformatting legacy image/video content, It may be desirable to identify areas within such legacy content to add new, additional content. For example, it may be possible to can identify valuable advertising areas in legacy movies/TV shows. In one embodiment, a geometric mapping function for VDR-graded movies may be employed to help perform this compositing. A pixel/vertex shader program (e.g., as often used in computer graphics/games) may also be employed to aid in the compositing of new content into such VDR streams, as discussed below. </p><p id="p0133" num="0133"> [00075] FIG. 11 is one embodiment (1100) of a performing the identification of areas for new content and performing the composite of such new content into existing and/or legacy content. </p><p id="p0134" num="0134"> [00076] When restoring/regrading legacy content, system 1100 may identify valua ble advertising areas in collaboration with the owner of the movie/TV show 1104. This may be performed by an off-line process 1102 and may be used to create a vertex and pixel shader program 1106. Such a shader program would describe how to map any texture (e.g. a rectangular image 1112) into the 2D shapes needed to composite it into a VDR stream. In one embodiment, creating such shader program 1106 may come at a minor additional cost/effort as it only has to be done for areas of (e.g., advertisement) interest and not the full movie. This may be an automatic, semi-automatic (using computer vision approaches such as feature tracking, motion vector analysis, etc.), or manual (carried out by an artist). 
<!-- EPO <DP n="20"/>-->
 [00077] Vertex and Pixel Shader program 1106 is then provided with the movie/TV show, creates a subset of VD metadata which is provided either as metadata attached to the VDR stream or via external means (e.g. internet). </p><p id="p0135" num="0135"> [00078] This mapping function (1106) can now be used to go from a rectangular texture (1112) to the appropriate mapped pixel data (112') in an appropriate bounding box (1118) by using the vertex and pixel shader program (1106) in conjunction with a geometry mapper and shader (1116). </p><p id="p0136" num="0136"> [00079] The final bounding box (1118) may now be mapped into the dynamic range and/or color gamut (or other image characteristic) using a DM module (1120) to match or substantially match the mapped output of the first image/video data (1104', after 1130). It should be noted that both DM modules (1120 and 1130) may use the same or similar set of VDR metadata 1108 in order to create a matching mapping result. Now it may be composited into the VDR movie (1132) in conjunction with any other desired composites (e.g. GUI, CC, etc. using inputs such as 1122 and 1126) in the same way as described in FIGS. 10A, B and C by using image compositor module (1128). This results in the VDR movie including the perceptually correct composited advert that may be displayed (1134). </p><p id="p0137" num="0137"> [00080] In one embodiment, program 1106 may be reused (once created) indefinitely with any new content 1108. Advertisers only have to provide a texture and, in some embodiments, appearance mapping data (e.g., accurate colorimetric description of elements of their advertisements, such as logos or products). It would be possible to appropriately map that texture into the VDR movie using the vertex and pixel shader programs created while restoring/regrading the movie to VDR. It should be noted that this embodiment is not limited to single frame textures. It is also valid using advertisement clips (e.g., short films). </p><p id="p0138" num="0138"> [00081] A detailed description of one or more embodiments of the invention, read along with accompanying figures, that illustrate the principles of the invention has now been given. It is to be appreciated that the invention is described in connection with such embodiments, but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives, modifications and equivalents. Numerous specific details have been set forth in this description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity, technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured. 
</p></description><claims mxw-id="PCLM70076973" ref-ucid="WO-2014130213-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="21"/>--> CLAIMS: </claim-statement><claim id="clm-0001" num="1"><claim-text> 1. A method for overlaying a second image over a first image, the method comprising: </claim-text><claim-text> receiving said first image and said second image, said first image differing in dynamic range and size than said second image; </claim-text><claim-text> receiving first metadata regarding said first image; </claim-text><claim-text> receiving second metadata regarding said second image; </claim-text><claim-text> performing appearance mapping of said second image to determine an adjusted second image, said adjusted second image differing in dynamic range than said second image, according to said first metadata and said second metadata; and </claim-text><claim-text> forming a composite image overlaying said adjusted second image onto at least a portion of said first image. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. The method of Claim 1 wherein said first image comprises one of a group, said group comprising: HD image/video, EDR image/video and VDR image/video. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. The method of Claim 2 wherein receiving first metadata regarding said first image further comprises: </claim-text><claim-text> receiving image statistics regarding said first image. </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. The method of Claim 3 wherein said image statistics comprises one of a group, said group comprising: average luminance, minimum luminance, mean luminance, maximum luminance, dynamic range, reflective white, color temperature, whitepoint, color gamut and color palette. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. The method of Claim 2 wherein said second image comprises one of a group, said group comprising: graphics, close captioning, text, video overlay, GUI, TV guides, signals from broadcasting company, signals from content creation, subtitles, signals from set top box and signals from AV receiver. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. The method of Claim 5 wherein receiving second metadata regarding said second image further comprises: </claim-text><claim-text> receiving image statistics regarding said second image. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. The method of Claim 6 wherein said image statistics comprises one of a group, said group comprising: average luminance, minimum luminance, mean luminance, maximum luminance, dynamic range, reflective white, color temperature, whitepoint, color gamut and color palette. 
<!-- EPO <DP n="22"/>-->
</claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. The method of Claim 1 wherein performing appearance mapping further comprises: </claim-text><claim-text> mapping the dynamic range of said second image in accordance with the dynamic range of said first image. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. The method of Claim 1 wherein performing appearance mapping further comprises: </claim-text><claim-text> mapping the color gamut of said second image in accordance with the color gamut of said first image. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. The method of Claim 1 wherein performing appearance mapping further comprises: </claim-text><claim-text> mapping the luminance of said second image in accordance with the luminance of said first image . </claim-text></claim><claim id="clm-0011" num="11"><claim-text>11. The method of Claim 1 wherein said method further comprises: </claim-text><claim-text> receiving metadata regarding said display's characteristics. </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. The method of Claim 11 wherein said metadata regarding said display's characteristics comprises one of a group, said group comprising: average luminance, minimum luminance, mean luminance, maximum luminance, reflective white, color temperature, whitepoint and color gamut. </claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. The method of Claim 12 wherein performing appearance mapping further comprises: </claim-text><claim-text> mapping said second image in accordance with said metadata regarding said display's characteristics. </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. The method of Claim 1 wherein said method further comprises: </claim-text><claim-text> performing dynamic mapping of a third image to composite said third image with said first image, said third image intended to replace a subset of said second image previously composited with said first image. </claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. A system for compositing a second image onto a first image, said system comprising: </claim-text><claim-text> a display management module, said display management module capable of receiving said first image; </claim-text><claim-text> a compositor module, said compositor module capable of receiving said second image; 
<!-- EPO <DP n="23"/>-->
 wherein further said compositor module capable of receiving metadata regarding said first image and capable of performing appearance mapping said second image to form an appearance mapped second image in accordance with said metadata regarding said first image; and </claim-text><claim-text> a mixing module, said mixing module capable of mixing said appearance mapped second image onto said first image to form a composite image, said composite image intended to be rendered upon said display. </claim-text></claim><claim id="clm-0016" num="16"><claim-text>16. The system of Claim 15 wherein said system further comprises: </claim-text><claim-text> an image statistics calculating module, said image statistics calculating module capable of calculating image statistics from an image/video stream. </claim-text></claim><claim id="clm-0017" num="17"><claim-text>17. The system of Claim 16 wherein said image statistics comprises one of a group, said group comprising: average luminance, minimum luminance, mean luminance, maximum luminance, dynamic range, reflective white, color temperature, whitepoint, color gamut and color palette. </claim-text></claim><claim id="clm-0018" num="18"><claim-text>18. The system of Claim 17 wherein said compositor module is capable of performing appearance mapping wherein said appearance mapping further comprises one of a group, said group comprising: luminance mapping, dynamic range mapping and color gamut mapping. </claim-text></claim><claim id="clm-0019" num="19"><claim-text>19. The system of Claim 15 wherein said system further comprises: </claim-text><claim-text> a dynamic mapping module, said dynamic mapping module is capable of replacing a subset of said second image that comprises a composite image with a first image with a third image/video data. </claim-text></claim><claim id="clm-0020" num="20"><claim-text>20. The system of Claim 16 wherein said dynamic mapping module is capable of dynamically mapping a first content within a composite image with a second content within said composite image. </claim-text></claim><claim id="clm-0021" num="21"><claim-text>21. A method for dynamic content replacement of a first set of images with a second set of images, said first set of images comprising a subset of images within a first content; the method comprising: </claim-text><claim-text> receiving a first content; </claim-text><claim-text> identifying a first set of images within said first content, said first set of images desired to be replaced; </claim-text><claim-text> creating VD metadata, said VDR metadata associated with said first set of images; </claim-text><claim-text> receiving a second set of images, said second set of images desired to replace said first set of images; 
<!-- EPO <DP n="24"/>-->
 mapping said second set of images to an intermediate second set of images; replacing said first set of images with said intermediate second set of images , according to said VDR metadata; </claim-text><claim-text> mapping said intermediate second set of images, according to a desired image characteristic. </claim-text></claim><claim id="clm-0022" num="22"><claim-text>22. The method of Claim 21 wherein said desired image characteristic is one of a group, said group comprising: dynamic range and color gamut. </claim-text></claim><claim id="clm-0023" num="23"><claim-text>23. The method of Claim 21 wherein said mapping said second set of images to an intermediate second set of image further comprises: </claim-text><claim-text> mapping said second set of images to a bounding box. </claim-text></claim><claim id="clm-0024" num="24"><claim-text>24. The method of Claim 21 wherein creating VDR metadata, said VDR metadata associated with said first set of images further comprises: </claim-text><claim-text> creating a shader program according to said first content. 
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
