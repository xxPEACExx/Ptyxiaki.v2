<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2959742-A1" country="EP" doc-number="2959742" kind="A1" date="20151230" family-id="51390956" file-reference-id="316324" date-produced="20180826" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160452359" ucid="EP-2959742-A1"><document-id><country>EP</country><doc-number>2959742</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14754458-A" is-representative="NO"><document-id mxw-id="PAPP193867686" load-source="patent-office" format="original"><country>EP</country><doc-number>14754458.9</doc-number><date>20140214</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193867687" load-source="docdb" format="epo"><country>EP</country><doc-number>14754458</doc-number><kind>A</kind><date>20140214</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162027302" ucid="JP-2013033508-A" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2013033508</doc-number><kind>A</kind><date>20130222</date></document-id></priority-claim><priority-claim mxw-id="PPC162034045" ucid="JP-2014000769-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>JP</country><doc-number>2014000769</doc-number><kind>W</kind><date>20140214</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1894790009" load-source="docdb">H04W  48/20        20090101ALI20160909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1894790010" load-source="docdb">H04W   4/20        20090101ALI20160909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1894790011" load-source="docdb">H04L  29/08        20060101ALI20160909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1894790012" load-source="docdb">H04W   4/02        20090101ALI20160909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1894790013" load-source="docdb">H04W  76/02        20090101AFI20160909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1894790014" load-source="docdb">H04W  84/12        20090101ALI20160909BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1894790015" load-source="docdb">H04W  84/18        20090101ALI20160909BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1651121469" load-source="docdb" scheme="CPC">H04W  80/00        20130101 LI20180410BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1651121470" load-source="docdb" scheme="CPC">H04W  76/14        20180201 FI20180411BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831567" load-source="docdb" scheme="CPC">H04W   4/20        20130101 LI20171128BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831568" load-source="docdb" scheme="CPC">H04L  67/16        20130101 LI20171128BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831569" load-source="docdb" scheme="CPC">H04L  67/06        20130101 LI20171128BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1727831570" load-source="docdb" scheme="CPC">H04L  67/32        20130101 LI20171128BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984700410" load-source="docdb" scheme="CPC">H04W  84/18        20130101 LA20160108BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984700834" load-source="docdb" scheme="CPC">H04W  84/12        20130101 LA20160108BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1984703171" load-source="docdb" scheme="CPC">H04W  60/00        20130101 LI20160107BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165548543" lang="DE" load-source="patent-office">KOMMUNIKATIONSVORRICHTUNG, STEUERUNGSVERFAHREN DAFÜR UND PROGRAMM</invention-title><invention-title mxw-id="PT165548544" lang="EN" load-source="patent-office">COMMUNICATION APPARATUS, CONTROL METHOD THEREOF, AND PROGRAM</invention-title><invention-title mxw-id="PT165548545" lang="FR" load-source="patent-office">APPAREIL DE COMMUNICATION, PROCÉDÉ DE COMMANDE ASSOCIÉ ET PROGRAMME</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103319877" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>CANON KK</last-name><address><country>JP</country></address></addressbook></applicant><applicant mxw-id="PPAR1103323389" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>CANON KABUSHIKI KAISHA</last-name></addressbook></applicant><applicant mxw-id="PPAR1101652076" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Canon Kabushiki Kaisha</last-name><iid>101093230</iid><address><street>30-2 Shimomaruko 3-chome Ohta-ku</street><city>Tokyo 146-8501</city><country>JP</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103308923" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>FUJITA SHUNJI</last-name><address><country>JP</country></address></addressbook></inventor><inventor mxw-id="PPAR1103312923" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>FUJITA, SHUNJI</last-name></addressbook></inventor><inventor mxw-id="PPAR1101641624" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>FUJITA, SHUNJI</last-name><address><street>c/o CANON KABUSHIKI KAISHA 30-2 Shimomaruko 3-chome Ohta-ku</street><city>Tokyo 146-8501</city><country>JP</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101651290" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Garner, Jonathan Charles Stapleton</last-name><iid>101129203</iid><address><street>Canon Europe Ltd European Patent Department 3 The Square</street><city>Stockley Park Uxbridge, Middlesex UB11 1ET</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="JP-2014000769-W"><document-id><country>JP</country><doc-number>2014000769</doc-number><kind>W</kind><date>20140214</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014129157-A1"><document-id><country>WO</country><doc-number>2014129157</doc-number><kind>A1</kind><date>20140828</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660622554" load-source="docdb">AL</country><country mxw-id="DS660787894" load-source="docdb">AT</country><country mxw-id="DS660622564" load-source="docdb">BE</country><country mxw-id="DS660700931" load-source="docdb">BG</country><country mxw-id="DS660706246" load-source="docdb">CH</country><country mxw-id="DS660623032" load-source="docdb">CY</country><country mxw-id="DS660787895" load-source="docdb">CZ</country><country mxw-id="DS660718420" load-source="docdb">DE</country><country mxw-id="DS660622565" load-source="docdb">DK</country><country mxw-id="DS660623033" load-source="docdb">EE</country><country mxw-id="DS660700391" load-source="docdb">ES</country><country mxw-id="DS660700932" load-source="docdb">FI</country><country mxw-id="DS660700933" load-source="docdb">FR</country><country mxw-id="DS660622566" load-source="docdb">GB</country><country mxw-id="DS660622575" load-source="docdb">GR</country><country mxw-id="DS660622576" load-source="docdb">HR</country><country mxw-id="DS660787896" load-source="docdb">HU</country><country mxw-id="DS660706259" load-source="docdb">IE</country><country mxw-id="DS660622577" load-source="docdb">IS</country><country mxw-id="DS660700934" load-source="docdb">IT</country><country mxw-id="DS660623034" load-source="docdb">LI</country><country mxw-id="DS660718421" load-source="docdb">LT</country><country mxw-id="DS660787897" load-source="docdb">LU</country><country mxw-id="DS660718422" load-source="docdb">LV</country><country mxw-id="DS660718471" load-source="docdb">MC</country><country mxw-id="DS660621132" load-source="docdb">MK</country><country mxw-id="DS660621133" load-source="docdb">MT</country><country mxw-id="DS660787898" load-source="docdb">NL</country><country mxw-id="DS660700392" load-source="docdb">NO</country><country mxw-id="DS660787899" load-source="docdb">PL</country><country mxw-id="DS660700393" load-source="docdb">PT</country><country mxw-id="DS660787900" load-source="docdb">RO</country><country mxw-id="DS660718473" load-source="docdb">RS</country><country mxw-id="DS660787901" load-source="docdb">SE</country><country mxw-id="DS660718474" load-source="docdb">SI</country><country mxw-id="DS660706260" load-source="docdb">SK</country><country mxw-id="DS660706261" load-source="docdb">SM</country><country mxw-id="DS660621134" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA139076738" ref-ucid="WO-2014129157-A1" lang="EN" load-source="patent-office"><p num="0000">A communication apparatus capable of transmitting data to an external device transmits transmission data-related information relating to data to be transmitted to the external device before joining a wireless network, receives a response from the external device after the transmission data-related information has been transmitted, joins a wireless network after the response has been received, and, after joining a wireless network, establishes communication with the external device so that data can be transmitted, and first information is transmitted as the transmission data-related information before the transmission data to be transmitted to the external device is determined.</p></abstract><abstract mxw-id="PA139543708" ref-ucid="WO-2014129157-A1" lang="EN" source="national office" load-source="docdb"><p>A communication apparatus capable of transmitting data to an external device transmits transmission data-related information relating to data to be transmitted to the external device before joining a wireless network, receives a response from the external device after the transmission data-related information has been transmitted, joins a wireless network after the response has been received, and, after joining a wireless network, establishes communication with the external device so that data can be transmitted, and first information is transmitted as the transmission data-related information before the transmission data to be transmitted to the external device is determined.</p></abstract><abstract mxw-id="PA139076739" ref-ucid="WO-2014129157-A1" lang="FR" load-source="patent-office"><p num="0000">L'invention se rapporte à un appareil de communication qui peut transmettre des données à un dispositif externe et qui transmet des informations relatives à des données de transmission se rapportant à des données à transmettre au dispositif externe avant de s'associer à un réseau sans fil, reçoit une réponse en provenance du dispositif externe après la transmission des informations relatives à des données de transmission, s'associe à un réseau sans fil après la réception de la réponse, et, après l'association à un réseau sans fil, met en place une communication avec le dispositif externe afin de pouvoir transmettre les données. Ensuite, des premières informations sont transmises comme les informations relatives à des données de transmission avant que les données de transmission à transmettre au dispositif externe ne soient déterminées.</p></abstract><abstract mxw-id="PA139543709" ref-ucid="WO-2014129157-A1" lang="FR" source="national office" load-source="docdb"><p>L'invention se rapporte à un appareil de communication qui peut transmettre des données à un dispositif externe et qui transmet des informations relatives à des données de transmission se rapportant à des données à transmettre au dispositif externe avant de s'associer à un réseau sans fil, reçoit une réponse en provenance du dispositif externe après la transmission des informations relatives à des données de transmission, s'associe à un réseau sans fil après la réception de la réponse, et, après l'association à un réseau sans fil, met en place une communication avec le dispositif externe afin de pouvoir transmettre les données. Ensuite, des premières informations sont transmises comme les informations relatives à des données de transmission avant que les données de transmission à transmettre au dispositif externe ne soient déterminées.</p></abstract><description mxw-id="PDES78479388" ref-ucid="WO-2014129157-A1" lang="EN" load-source="patent-office"><invention-title lang="EN">COMMUNICATION APPARATUS, CONTROL METHOD THEREOF, AND PROGRAM</invention-title><technical-field><p num="0001">
The present invention relates to a communication apparatus capable of communicating with an external device.
</p></technical-field><background-art><p num="0002">
With the spread of wireless communication, an image file can now be transmitted by mounting a wireless communication function even on a portable terminal, such as a digital camera (PTL 1).  For example, when performing data communication using a wireless local area network (LAN), such a method as first joining a wireless LAN network and then establishing communication with an external device on the network may be employed.
</p></background-art><citation-list><patent-literature><p num="0003"><patcit num="1"><text>Japanese Patent Application Laid-Open No. 2009-152689</text></patcit></p></patent-literature></citation-list><?BRFSUM description="Brief Summary" end="lead"?><summary-of-invention><tech-problem><p num="0004">
However, after a connection based on a wireless layer and communication with an external device have been established, if it is determined that the transmission and reception of data with the external device cannot be performed properly, the connection processing performed up to that point is wasted.  Therefore, there is a need to properly perform the processing for establishing communication and the processing for specifying the data to be transmitted and received.
</p></tech-problem><tech-solution><p num="0005">
According to an aspect of the present invention, a communication apparatus capable of transmitting data to an external device, includes a transmitting unit configured to transmit transmission data-related information relating to data to be transmitted to the external device before joining a wireless network, a receiving unit configured to receive a response from the external device after the transmission data-related information has been transmitted by the transmitting unit, a network joining unit configured to, after the response has been received by the receiving unit, join a wireless network, and a communication unit configured to, after the joining unit has joined a wireless network, establish communication with the external device so that data can be transmitted, wherein the transmitting unit is configured to transmit first information as the transmission data-related information before the transmission data to be transmitted to the external device is determined.
</p></tech-solution><advantageous-effects><p num="0006">
According to the present invention, processing for establishing communication and processing for specifying data to be transmitted and received can be properly performed.<br/>
 
</p></advantageous-effects></summary-of-invention><?BRFSUM description="Brief Summary" end="tail"?><description-of-drawings><p num="0007"><figref num="1">Fig. 1 illustrates hardware function blocks of a communication apparatus.</figref><figref num="2">Fig. 2 illustrates software function blocks of a communication apparatus.</figref><figref num="3">Fig. 3 illustrates an example of a network configuration in which the present invention is applied.</figref><figref num="4">Fig. 4 is a sequence diagram between communication apparatuses according to a first exemplary embodiment.</figref><figref num="5">Fig. 5 is a flowchart illustrating operation of a communication apparatus according to the first exemplary embodiment.</figref><figref num="6A">Fig. 6A illustrates an example of a GUI screen of a communication apparatus according to the first exemplary embodiment.</figref><figref num="6B">Fig. 6B illustrates an example of a GUI screen of a communication apparatus according to the first exemplary embodiment.</figref><figref num="7">Fig. 7 is a sequence diagram between communication apparatuses according to a second exemplary embodiment.</figref><figref num="8">Fig. 8 is a flowchart illustrating operation of a communication apparatus according to the second exemplary embodiment.</figref><figref num="9">Fig. 9 illustrates an example of a GUI screen of a communication apparatus according to the second exemplary embodiment.</figref></p></description-of-drawings><description-of-embodiments><p num="0008">
A communication apparatus according to a first exemplary embodiment will now be described with reference to the drawings.  Although the following description will be made using a wireless LAN system based on the Institute of Electrical and Electronics Engineers (IEEE) 802.11 series as an example, the communication mode is not limited to a wireless LAN system based on IEEE 802.11.
</p><p num="0009">
An example of the hardware configuration according to the present exemplary embodiment will now be described.
</p><p num="0010">
Fig. 1 is a block diagram illustrating an example of the configuration of the respective apparatuses that are described below according to an exemplary embodiment to which the present invention can be applied.
</p><p num="0011">
Fig. 1 illustrates a block configuration of a communication apparatus 101.
</p><p num="0012">
A control unit 102 controls the overall apparatus by executing a control program stored in a storage unit 103.  The control unit 102 includes one or a plurality of processors, such as a central processing unit (CPU) or a micro-processing unit (MPU).  The control unit 102 also controls the setting of a communication parameter between this apparatus and another apparatus.
</p><p num="0013">
The storage unit 103 stores the control program executed by the control unit 102 and various kinds of information, such as a communication parameter.  Further, image data and files generated by the communication apparatus or received from an external device may also be stored in the storage unit 103.  The storage unit 103 may be configured from various types of memories, such as a read-only memory (ROM), a random-access memory (RAM), a hard disk drive (HDD), and a flash memory.  Each of the operations that are described below is performed by the control unit 102 executing a control program stored in the storage unit 103.
</p><p num="0014">
A wireless unit 104 performs wireless LAN communication based on the IEEE 802.11 series.
</p><p num="0015">
A display unit 105 for presenting various displays has a function of outputting visually perceivable information like a liquid crystal display (LCD) or a light-emitting diode (LED), or a function capable of outputting sound like a speaker.  The display unit 105 includes at least either the function of outputting visual information or sound information.
</p><p num="0016">
An antenna control unit 107 transmits and receives signals by wireless communication by controlling an antenna 108.
</p><p num="0017">
An operation unit 109 is used by the user to perform various inputs for operating the communication apparatus.  The operation unit 109 is configured from various buttons, a touch panel, and the like.
</p><p num="0018">
An imaging unit 110, which includes an optical lens, a complementary metal oxide semiconductor (CMOS) sensor, a digital image processing unit, and the like, generates image data by converting an analog signal input via the optical lens into digital data.  The image data generated by the imaging unit 110 is stored in the storage unit 103.
</p><p num="0019">
Note that Fig. 1 is merely an example, and the communication apparatus 101 may include hardware units other than the hardware units illustrated in Fig. 1.
</p><p num="0020">
Fig. 2 is a block diagram illustrating an example of a configuration of the software function blocks executing the below-described communication control functions.
</p><p num="0021">
Fig. 2 illustrates a block configuration of a software function block 201.
</p><p num="0022">
A Discovery control unit 202 operates search processing for searching for a communication apparatus that will be a communication counterparty.
</p><p num="0023">
A GO Negotiation control unit 203 performs control based on a Wi-Fi Direct protocol specification to determine the roles to be performed in a wireless layer, such as which communication apparatus will serve as an access point and which communication apparatus will serve as a wireless LAN station.  In Wi-Fi Direct, the communication apparatus performing the wireless LAN access point function is referred to as a P2P group owner (hereinafter, "GO"), and the communication apparatus performing the wireless LAN station function is referred to as a P2P client (hereinafter, "CL").  If the communication apparatus is to act as the GO or the wireless LAN access point, a below-described wireless LAN access point function control unit 211 is started.  If the communication apparatus is to act as the CL or the wireless LAN station, a below-described wireless LAN station function control unit 210 is started.  The protocol of this GO Negotiation is determined based on the Wi-Fi Direct protocol specification.  Since this is not a major point of the present invention, a description thereof will be omitted here.  In Wi-Fi Direct, a network built by GO is referred to as a P2P group.  In the present specification too, a network is also sometimes described as a P2P group.  In the present exemplary embodiment, these terms are used with the same meaning.  Further, in the present specification, the P2P group owner (GO), P2P client (CL), and a group of communication apparatuses whose roles have not yet been determined are collectively referred to as P2P devices.
</p><p num="0024">
A dynamic host configuration protocol (DHCP) client control unit 204 is started when the role of that communication apparatus is determined by the GO Negotiation control unit 203 to be as a wireless LAN station.
</p><p num="0025">
A DHCP server control unit 205 is started when the role of that communication apparatus is determined by the GO Negotiation control unit 203 to be as a wireless LAN access point.
</p><p num="0026">
A Wi-Fi protected setup (WPS) enrollee control unit 206 receives a communication parameter required for wireless LAN communication from another WPS registrar apparatus.  Similar to the DHCP client control unit 204, the WPS enrollee control unit 206 is started when the role of that communication apparatus is determined to be as a wireless LAN station.
</p><p num="0027">
A WPS registrar control unit 207 provides a communication parameter required for wireless LAN communication to another WPS enrollee apparatus.  Similar to the DHCP server control unit 205, the WPS registrar control unit 207 is started when the role of that communication apparatus is determined to be as a wireless LAN access point.  Examples of the communication parameter provided by the WPS registrar include a service set identifier (SSID) as a network identifier, an encryption key, an encryption method, an authentication key, an authentication method, and the like.
</p><p num="0028">
A wireless LAN packet receiving unit 208 and a wireless LAN packet transmission unit 209 control the transmission and reception of all packets, including those for a higher layer transmission protocol.
</p><p num="0029">
The wireless LAN station function control unit 210 performs authentication and encryption processing when that apparatus operates as a wireless LAN station, and joins a wireless network built by an apparatus operating as a wireless LAN access point.
</p><p num="0030">
The wireless LAN access point function control unit 211 builds a wireless network when that apparatus operates as a wireless LAN access point, and performs authentication and encryption processing and manages communication apparatus counterparties, for example.  The wireless LAN station function control unit 210 and the wireless LAN access point function control unit 211 can operate just either one of these functions or operate both of these functions simultaneously.
</p><p num="0031">
A packet routing control unit 212 performs bridging and routing communication packets when the wireless LAN access point function control unit 211 is operating.
</p><p num="0032">
A data storage unit 213 stores the software itself, wireless LAN parameters, and various tables such as a DHCP address table and Address Resolution Protocol (ARP) table.
</p><p num="0033">
A service discovery control unit 214 controls a service discovery function that is unique to Wi-Fi Direct.  The service discovery function exchanges service information held by a communication counterparty apparatus by transmitting and receiving an action frame defined in IEEE 802.11u.  Specifically, the service discovery control unit 214 transmits an SD query, and receives an SD response as a response.  Alternatively, the service discovery control unit 214 receives an SD query from a counterparty apparatus, and transmits an SD response as a response.  The SD response includes information indicating the type of service, specifically, a service such as a file transmitting service or a printing service.
</p><p num="0034">
A P2P invitation function control unit 215 controls an invitation function defined in the Wi-Fi Direct standard.  Since this invitation function is defined in the Wi-Fi Direct standard, a description thereof will be omitted here, although it is a function that prompts a P2P device whose role as a GO device or as a CL device has not yet been determined to be connected as a P2P client.
</p><p num="0035">
A file transmitting service providing unit 216 provides a file transmitting service of an application layer.  The term application layer refers to a service providing layer in the fifth layer or higher in the open systems interconnection (OSI) reference model.  The file transmitting service transmits and receives various requests and responses utilizing a hypertext transfer protocol (HTTP), and performs file transmission and reception processing.
</p><p num="0036">
A file transmitting service utilization unit 217 in the application layer utilizes a service provided by the file transmitting service providing unit 216 of the application layer of the counterparty apparatus.
</p><p num="0037">
A session management unit 218 manages a logical connection in the file transmitting service.  When utilizing the file transmitting service, a session generating request is transmitted to the counterparty communication apparatus by transmitting information about a file to be transmitted, and a response is received.  When providing the file transmitting service, whether a session can be generated is determined based on the content of the received transmitting target file information, and a response is issued.  The transmitting target file information is information formed from the number of files, the total size, and the file names.  If it is determined that a session can be generated, the session management unit 218 performs connection processing based on a wireless layer.  The exchange of information regarding session management is performed utilizing Public Action frame defined in IEEE 802.11.
</p><p num="0038">
Not all of the function blocks illustrated in Fig. 2 have to be provided by software, at least a portion of the function blocks may be provided by hardware.  Further, the function blocks illustrated in Fig. 2 are interrelated with each other.  Moreover, the respective function blocks illustrated in Fig. 2 are an example.  A plurality of function blocks may configure one function block, or any of the function blocks may be divided into blocks performing a plurality of functions.
</p><p num="0039">
Further, in the present exemplary embodiment, the file transmitting service in the application layer is realized by an apparatus that provides that service and an apparatus that utilizes that service.  The service providing apparatus and the service utilizing apparatus may be a smartphone, a tablet, a digital camera, or the like.
</p><p num="0040">
Fig. 3 illustrates a network A 31 (hereinafter, "network A") configured from a communication apparatus A 32 (hereinafter, "STA-A") and a communication apparatus B 33 (hereinafter, "STA-B").  All of these apparatuses have the configuration illustrated in the above-described Figs. 1 and 2.
</p><p num="0041">
Fig. 4 is a schematic diagram illustrating an operation sequence between communication apparatuses STA-A and STA-B when the STA-A transmits an image file stored in the storage unit 103 to the STA-B.
</p><p num="0042">
In the example illustrated in Fig. 4, the STA-A is operating as a communication apparatus on the transmission side utilizing the file transmitting service, and the STA-B is operating as a communication apparatus on the receiving side providing the file transmitting service.
</p><p num="0043">
In step S401, the STA-A receives an instruction to start image transmitting mode according to a user operation.  Then, in step S402, to utilize the file transmitting service, the STA-A transmits an inquiry signal for searching for the communication apparatus that is providing that service.  In parallel with this process, the STA-A receives a user operation for selecting a file to be transmitted.
</p><p num="0044">
In step S403, the STA-B, which has received the inquiry signal, transmits a detection response signal to the STA-A.
</p><p num="0045">
In step S404, the STA-A, which has received the detection response, transmits a session generating request signal that includes transmitting target file information representing information about the file (transmission data) to be transmitted in order to establish a logical connection for the file transmitting service with the STA-B.  Transmitting the transmitting target file information at this timing enables the STA-B to recognize in advance what kind of file will be transmitted.  However, at this timing, the file to be transmitted may not yet be determined, or the file to be transmitted may change.  Accordingly, at the STA-A according to the present exemplary embodiment, temporary file information is added as transmitting target file information to the session generating request signal to be transmitted in step S404.  Since only temporary information is transmitted at this stage, this information does not have to match the file information that is actually transmitted.  For example, the information may be "number of files: 1, total size: 5 MB, file name: 20130123113154.JPG".  The values in this temporary file information may be transmitted as pre-stored fixed values, or as values that are different each time a session is generated.
</p><p num="0046">
In the present exemplary embodiment, the number of temporary file information files is set as 1.  This allows the possibility of rejection of file transmission due to the temporary file information to be decreased even if, for example, the STA-B is an apparatus that does not accept the transmission of a predetermined number of files or more.  Further, the total file size is set in units of from several megabytes to several tens of megabytes that the STA-B is capable of storing.  Alternatively, a minimum settable value may be set.  This allows the possibility of rejection of file transmission due to the temporary file information to be decreased even if, for example, the STA-B is an apparatus that does not accept the transmission of a file that is equal to or greater than a predetermined size or is equal to or greater than the available space on the STA-B.  Further, a unique value that includes transmission date and time information is set in the file name.  This is to reduce the possibility of the file to be accidentally a file with the same name if, for example, the STA-B is an apparatus that does not accept the transmission of files having the same name as a file that it has already received.  This transmitting target file information is an example of transmission data-related information.
</p><p num="0047">
In step S405, the STA-B, which has received the session generating request signal, transmits a success response signal to the STA-A.
</p><p num="0048">
After the success response is received, in step S406, the STA-A performs wireless layer connection processing with the STA-B.  Connection processing based on a wireless layer is connection processing that is based on the above-described Wi-Fi Direct specification.  More specifically, either one of the STA-A and the STA-B becomes the P2P group owner (GO), and the other becomes the P2P client (CL).  A connection is made by performing network joining processing, in which the CL joins a wireless network built by the GO.
</p><p num="0049">
After the wireless layer connection has been established, in step S407, the STA-A performs predetermined starting processing of the file transmitting service.  Specifically, the STA-A performs setting processing of an Internet protocol (IP) address based on DHCP, and processing for acquiring from the STA-B the detailed information required for HTTP transmission in the file transmitting service.
</p><p num="0050">
Then, in step S408, the STA-A is notified by a user operation, for example, that selection of the file to be transmitted has been completed.  At this point, the file information about the file to be transmitted is settled.
</p><p num="0051">
In step S409, the STA-A transmits the settled transmitting target file information to the STA-B, and issues a session changing request.  The session changing request may be performed utilizing a Public Action frame defined in IEEE 802.11, or may be performed based on an HTTP protocol.  In step S410, the STA-B, which has received the session changing request signal, transmits a success response signal to the STA-A.  By performing the above processing, the temporary file information transmitted in step S404 can be corrected.
</p><p num="0052">
In step S411, the STA-A, which has received the success response, performs transmitting processing of the image file to the STA-B based on the transmitting target file information transmitted in step S409.
</p><p num="0053">
Then, in step S412, the STA-A receives a finishing instruction for the image transmitting mode by a user operation, for example, and in step S413, performs predetermined finishing processing of the file transmitting service.  Specifically, the STA-A executes processing to delete the information generated in step S407 and releases a setting.
</p><p num="0054">
Next, in step S414, the STA-A transmits a session finishing request signal to finish the logical connection of the file transmitting service with the STA-B.  In step S415, the STA-B, which has received the session finishing request signal, transmits a success response signal to the STA-A.
</p><p num="0055">
In step S416, the STA-A, which has received the success response signal, performs processing to disconnect the wireless layer connection with the STA-B.  The wireless layer disconnection processing is disconnection processing based on the above-described Wi-Fi Direct specification.
</p><p num="0056">
Fig. 5 is a flowchart illustrating operation of a communication apparatus transmitting an image file stored in the storage unit 103 to a receiving device utilizing a file transmitting service.  Each step in this flowchart is performed by the control unit 102 executing a program stored in the storage unit 103.
</p><p num="0057">
In step S501, the control unit 102 receives an instruction to start image transmitting mode via the operation unit 109.  Then, in step S502, the control unit 102 displays a screen that allows the user to select the file to be transmitted, and performs file transmitting service search processing.  The following steps S503 to S505 are performed in parallel with the processing in which the user selects the file to be transmitted via the selection screen.
</p><p num="0058">
In step S503, the control unit 102 performs a receiving device search determination.  If a detection response from a receiving device is not received within a predetermined duration from the start of the search processing (NO in step S503), the control unit 102 notifies the user of that fact via the display unit 105, and finishes the transmitting mode.
</p><p num="0059">
If a receiving device is detected (YES in step S503), in step S504, the control unit 102 transmits the above-described temporary transmitting target file information to the receiving device, and performs session generation processing of a file transmitting service.  If a plurality of receiving devices is detected, the control unit 102 may be configured so as to display the detected devices in a list, and receive a user operation for selecting the counterparty to transmit the file to.
</p><p num="0060">
After the session has been generated, in step S505, the control unit 102 performs wireless layer connection processing based on the Wi-Fi Direct specification with the receiving device.  Then, the control unit 102 performs IP address setting processing based on DHCP, and acquisition processing of the detailed information required for HTTP transmission in the file transmitting service.
</p><p num="0061">
In step S506, the control unit 102 waits until selection by the user of the file to be transmitted is completed.  When the file to be transmitted has been settled, and a transmit instruction issued (YES in step S506), in step S507, the control unit 102 transmits the settled transmitting target file information to the receiving device, and performs session information changing processing of the file transmitting service.  Then, in step S508, based on the transmitting target file information transmitted in step S507, the control unit 102 performs transmitting processing of the file to the receiving device to which the data is actually to be transmitted.  After file transmitting processing has been completed, the processing returns to a transmitting target file selection state in step S506.  Then, if a selection operation of the file to be transmitted is performed again by the user (YES in step S506), the control unit 102 again executes the processing of steps S507 and S508.
</p><p num="0062">
If the control unit 102 receives a transmitting mode finishing instruction from the user while waiting for the transmitting target file selection to be completed in step S506 (YES in step S509), in step S510, the control unit 102 performs file transmitting service finishing processing and session finishing processing.  In step S511, after the session has finished, the control unit 102 performs wireless layer disconnection processing.
</p><p num="0063">
Figs. 6A and 6B are screens displayed on the display unit 105 of the communication apparatus utilizing the file transmitting service according to the present exemplary embodiment.
</p><p num="0064">
Fig. 6A illustrates the transmitting target file selection screen displayed in step S502.  The screen includes a thumbnail 601 of an image file and a checkbox 602 indicating a selection.  In Fig. 6A, image A, image B, and image E are selected.  The screen illustrated in Fig. 6A also includes a transmission button 603.  In a state in which a wireless layer connection has been established with a receiving device in step S506, when this transmission button 603 is pressed, step S507 is performed.  If the transmission button 603 is pressed before a wireless layer connection has been established, the control unit 102 waits for a connection, and when a connection is made, performs step S507.  When a stop button 604 is pressed, the transmitting mode is finished.  At this point, the generated session and the wireless layer connection are released.  An area 605 displays the connection status with the receiving device.  At the step S502 stage, the area 605 shows "searching for receiving device".
</p><p num="0065">
Fig. 6B illustrates the transmitting target file selection screen that is displayed after step S505 has been executed.  In step S505, since a connection based on a wireless layer is established with the receiving device, a connection status area 606 shows that the receiving device is "connected".
</p><p num="0066">
Thus, according to the present exemplary embodiment, when transmitting a stored image file to a receiving device, a selection operation by the user of the file to be transmitted can be executed in parallel with connection processing with the receiving device based on a wireless layer.
</p><p num="0067">
Further, in the present exemplary embodiment, after the transmitting mode has been started, although the selection operation of the file to be transmitted can be received before connection based on a wireless layer is performed, the processing can also be performed in such a manner that the screen illustrated in Fig. 6B is displayed after the connection based on a wireless layer is performed (step S505).<br/>
 
</p><p num="0068">
In the first exemplary embodiment, an example of performing a function has been described in which an image file stored in the storage unit 103 is transmitted to a receiving device utilizing the file transmitting service.  In a second exemplary embodiment, an example of performing a function will be described in which a captured image is automatically transmitted to a receiving device utilizing the.
</p><p num="0069">
Since the present exemplary embodiment shares many parts that are common with the first exemplary embodiment, a description of the common parts will be omitted, and the description will mainly be focused on the parts that are specific to the present exemplary embodiment.
</p><p num="0070">
Fig. 7 is a schematic diagram illustrating an operation sequence between communication apparatuses STA-A and STA-B when the STA-A automatically transmits a captured image to the STA-B.
</p><p num="0071">
In Fig. 7, contents that are substantially the same as those in Fig. 4 according to the first exemplary embodiment will be provided with the same reference numerals, and descriptions thereof will not be repeated.  The following description will mainly focus on the portions that feature the second exemplary embodiment.
</p><p num="0072">
After the file transmitting service starting processing has been performed in step S407, for example, in step S701, imaging processing is executed by the imaging unit 110 based on a user operation.  Then, in step S409, information about the generated file is transmitted to the STA-B, and a session changing request is issued.  Although it is assumed that the number of image files generated by the imaging will usually be one, in a case of continuous shooting, information about a plurality of captured image files may be collectively transmitted.  Further, even when moving image recording is performed and the captured data is divided into a plurality of files, information about the plurality of captured image files may be collectively transmitted.
</p><p num="0073">
The series of processing steps (steps S701, S409, S410, and S411) from imaging execution to file transmitting processing may be repeated until image transmitting mode finishing processing in step S412 is performed.  This allows the user to execute a plurality of imaging and transmitting operations while the file transmitting service session is still established.
</p><p num="0074">
Fig. 8 is a flowchart illustrating operation of a communication apparatus that automatically transmits a captured image to a receiving device utilizing a file transmitting service.  Each step in this flowchart is performed by the control unit 102 executing a program stored in the storage unit 103.
</p><p num="0075">
In Fig. 8, processing that is substantially the same as that in Fig. 5 according to the first exemplary embodiment will be provided with the same reference numerals, and descriptions thereof will not be repeated.  The following description will mainly focus on the parts that are feature the second exemplary embodiment.
</p><p num="0076">
In step S501, the control unit 102 receives an instruction to start image transmitting mode via the operation unit 109.  Then, in step S801, the control unit 102 displays an imaging screen to the user, and performs file transmitting service search processing.
</p><p num="0077">
In step S802, the control unit 102 waits for imaging processing to be performed by the user.  When an image has been generated by imaging processing and the file to be transmitted has been settled (YES in step S802), in step S507, the control unit 102 transmits the settled transmitting target file information to the receiving device, and performs session information changing processing of the file transmitting service.  Then, in step S508, the control unit 102 performs transmitting processing of the file to the receiving device based on the transmitting target file information transmitted in step S507.  After file transmitting processing has been completed, the processing returns to a transmitting target file selection state (step S802).
</p><p num="0078">
Fig. 9 illustrates a screen that is displayed on the display unit 105 in a communication apparatus utilizing the file transmitting service according to present exemplary embodiment.
</p><p num="0079">
In Fig. 9, components that are substantially the same those in Fig. 6 according to the first exemplary embodiment will be provided with the same reference numerals, and descriptions thereof will not be repeated.  The following description will be made about the parts that feature the second exemplary embodiment.
</p><p num="0080">
Fig. 9 illustrates a imaging screen that is displayed in step S801.
</p><p num="0081">
The screen includes an area 901 that displays a through image of a camera, and an imaging button 902.  In a state in which a wireless layer connection has been established with a receiving device (step S802), when this imaging button 902 is pressed, image data is generated by executing imaging processing, and step S507 is performed.  If the imaging button 902 is pressed before a wireless layer connection has been established, the control unit 102 waits for a connection, and when a connection is made, performs step S507.  When a stop button 903 is pressed, the transmitting mode is finished.  At this stage, the generated session and the wireless layer connection are released.
</p><p num="0082">
Thus, according to the present exemplary embodiment, when transmitting a captured image to the receiving device simultaneously with capturing the image, the imaging operation by the user can be repeated while maintaining a connection based on a wireless layer with the receiving device.<br/>
 
</p><p num="0083">
Each of the above-described exemplary embodiments, which illustrate an example for carrying out the present invention, may be subjected to various modifications, as long as such modifications do not depart from the gist of the present invention.  Further, the above-described first and second exemplary embodiments can be combined.  In addition, whether the each of the communication apparatuses operates based on the first or the second exemplary embodiment may be arbitrarily selected by the user.
</p><p num="0084">
Although the above exemplary embodiments were described using a wireless LAN based on IEEE 802.11 as an example, the present invention may also be performed based on other types of wireless communication, such as wireless universal serial bus (USB), MultiBand OFDM Alliance (MBOA), Bluetooth (registered trade mark), ultra-wide band (UWB), and ZigBee (registered trade mark).  Further, the present invention may also be performed in a wired communication medium, such as wired LAN.  Further, UWB includes wireless USB, wireless 1394, WINET, and the like.
</p><p num="0085">
Aspects of the present invention can also be realized by a computer of a system or apparatus (or devices such as a CPU or MPU) that reads out and executes software (a program code) recorded on a memory device (computer-readable medium) to perform the functions of the above-described embodiments.  In such a case, this program, and the storage medium where the program is stored, are included within the scope of the present invention.
</p><p num="0086">
While the present invention has been described with reference to exemplary embodiments, it is to be understood that the invention is not limited to the disclosed exemplary embodiments.  The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.
</p><p num="0087">
This application claims the benefit of Japanese Patent Application No. 2013-033508, filed February 22, 2013, which is hereby incorporated by reference herein in its entirety.
</p></description-of-embodiments></description><claims mxw-id="PCLM70079694" ref-ucid="WO-2014129157-A1" lang="EN" load-source="patent-office"><claim num="1"><claim-text>
A communication apparatus capable of transmitting data to an external device, comprising:<br/>
a transmitting unit configured to transmit transmission data-related information relating to data to be transmitted to the external device before joining a wireless network;<br/>
a receiving unit configured to receive a response from the external device after the transmission data-related information has been transmitted by the transmitting unit;<br/>
a network joining unit configured to, after the response has been received by the receiving unit, join a wireless network; and<br/>
a communication unit configured to, after the joining unit has joined a wireless network, establish communication with the external device so that data can be transmitted,<br/>
wherein the transmitting unit is configured to transmit first information as the transmission data-related information before the transmission data to be transmitted to the external device is determined.
</claim-text></claim><claim num="2"><claim-text>
The communication apparatus according to claim 1, wherein the transmission data-related information is required to establish communication with the external device by the communication unit.
</claim-text></claim><claim num="3"><claim-text>
The communication apparatus according to claim 1 or 2, wherein the transmission data-related information is temporary information that exists before the transmission data to be transmitted to the external device is determined.
</claim-text></claim><claim num="4"><claim-text>
The communication apparatus according to claim 3, wherein the first information is information pre-stored in a storage unit in the communication apparatus.
</claim-text></claim><claim num="5"><claim-text>
The communication apparatus according to any one of claims 1 to 4, wherein when the joining unit has joined a wireless network and the transmission data to be transmitted to the external device has been determined, the transmitting unit is configured to transmit second information based on the determined transmission data as the transmission data-related information.
</claim-text></claim><claim num="6"><claim-text>
The communication apparatus according to claim 5, wherein when transmitting the second information, the transmitting unit is configured to notify the external device to change the first information.
</claim-text></claim><claim num="7"><claim-text>
The communication apparatus according to any one of claims 1 to 6, wherein the determination is performed after the network joining unit has joined the wireless network.
</claim-text></claim><claim num="8"><claim-text>
The communication apparatus according to any one of claims 1 to 7, further comprising a data capturing unit,<br/>
wherein the transmitting unit is configured to transmit information based on captured data as the transmission data-related information each time data is captured by the data capturing unit.
</claim-text></claim><claim num="9"><claim-text>
The communication apparatus according to claim 8, wherein the data capturing unit is an imaging unit.
</claim-text></claim><claim num="10"><claim-text>
A method for controlling a communication apparatus capable of transmitting data to an external device, the method comprising:<br/>
transmitting transmission data-related information relating to data to be transmitted to the external device before joining a wireless network;<br/>
receiving a response from the external device after the transmission data-related information has been transmitted;<br/>
joining a wireless network after the response has been received; and<br/>
establishing communication with the external device so that data can be transmitted after joining the wireless network,<br/>
wherein first information is transmitted as the transmission data-related information before the transmission data to be transmitted to the external device is determined.
</claim-text></claim><claim num="11"><claim-text>
A computer-readable program for causing a computer to function as each unit in the communication apparatus according to any one of claims 1 to 9.
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
