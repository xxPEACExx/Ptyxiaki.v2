<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2959088-A1" country="EP" doc-number="2959088" kind="A1" date="20151230" family-id="51351806" file-reference-id="316602" date-produced="20180825" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160452989" ucid="EP-2959088-A1"><document-id><country>EP</country><doc-number>2959088</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14753897-A" is-representative="NO"><document-id mxw-id="PAPP193868946" load-source="patent-office" format="original"><country>EP</country><doc-number>14753897.9</doc-number><date>20140218</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193868947" load-source="docdb" format="epo"><country>EP</country><doc-number>14753897</doc-number><kind>A</kind><date>20140218</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162029042" ucid="US-201313772969-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201313772969</doc-number><kind>A</kind><date>20130221</date></document-id></priority-claim><priority-claim mxw-id="PPC162036709" ucid="US-2014016974-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>2014016974</doc-number><kind>W</kind><date>20140218</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1889087910" load-source="docdb">E06B   5/00        20060101AFI20161006BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1777709832" load-source="docdb" scheme="CPC">G05B  15/02        20130101 LI20170803BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1777709833" load-source="docdb" scheme="CPC">E06B2009/2417      20130101 LA20170803BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1869709713" load-source="docdb" scheme="CPC">E06B   9/24        20130101 LI20161214BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1869710914" load-source="docdb" scheme="CPC">E06B2009/2464      20130101 LA20161214BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987783659" load-source="docdb" scheme="CPC">G02F   1/163       20130101 FI20141101BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165550433" lang="DE" load-source="patent-office">STEUERUNGSVERFAHREN FÜR TÖNBARE FENSTER</invention-title><invention-title mxw-id="PT165550434" lang="EN" load-source="patent-office">CONTROL METHOD FOR TINTABLE WINDOWS</invention-title><invention-title mxw-id="PT165550435" lang="FR" load-source="patent-office">PROCÉDÉ DE COMMANDE POUR DES FENÊTRES POUVANT SE TEINTER</invention-title><citations><patent-citations><patcit mxw-id="PCIT335964668" load-source="docdb" ucid="US-20120133315-A1"><document-id format="epo"><country>US</country><doc-number>20120133315</doc-number><kind>A1</kind><date>20120531</date></document-id><sources><source name="TPO" created-by-npl="N"/></sources></patcit></patent-citations><non-patent-citations><nplcit><text>See also references of WO 2014130471A1</text><sources><source mxw-id="PNPL65177679" load-source="docdb" name="TPO"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR1103331466" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>VIEW INC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR1103343677" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>VIEW, INC.</last-name></addressbook></applicant><applicant mxw-id="PPAR1101644534" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>View, Inc.</last-name><iid>101353526</iid><address><street>195 South Milpitas Boulevard</street><city>Milpitas, CA 95035</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103310623" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>BROWN STEPHEN C</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103312216" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>BROWN, STEPHEN C.</last-name></addressbook></inventor><inventor mxw-id="PPAR1101651842" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>BROWN, STEPHEN C.</last-name><address><street>131 12th Ave.</street><city>San Mateo, California 94402</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103326830" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>KHOWAL DEEPIKA</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103303860" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>KHOWAL, Deepika</last-name></addressbook></inventor><inventor mxw-id="PPAR1101646321" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>KHOWAL, Deepika</last-name><address><street>1717 View Dr.</street><city>Milpitas, California 95035</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103314292" load-source="docdb" sequence="3" format="epo"><addressbook><last-name>VORA NAMRATA</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103325558" load-source="docdb" sequence="3" format="intermediate"><addressbook><last-name>VORA, Namrata</last-name></addressbook></inventor><inventor mxw-id="PPAR1101652974" load-source="patent-office" sequence="3" format="original"><addressbook><last-name>VORA, Namrata</last-name><address><street>6385 Slida Dr.</street><city>San Jose, California 95129</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103315631" load-source="docdb" sequence="4" format="epo"><addressbook><last-name>PHILLIP SANTOSH V</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103333110" load-source="docdb" sequence="4" format="intermediate"><addressbook><last-name>PHILLIP, SANTOSH V.</last-name></addressbook></inventor><inventor mxw-id="PPAR1101652775" load-source="patent-office" sequence="4" format="original"><addressbook><last-name>PHILLIP, SANTOSH V.</last-name><address><street>1947 Dwight Wy. Apt. 3</street><city>Berkeley, California 94704</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101653204" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Johnston, Magnus George</last-name><iid>101117950</iid><address><street>Haseltine Lake LLP Redcliff Quay 120 Redcliff Street</street><city>Bristol BS1 6HU</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="US-2014016974-W"><document-id><country>US</country><doc-number>2014016974</doc-number><kind>W</kind><date>20140218</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014130471-A1"><document-id><country>WO</country><doc-number>2014130471</doc-number><kind>A1</kind><date>20140828</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660631899" load-source="docdb">AL</country><country mxw-id="DS660737055" load-source="docdb">AT</country><country mxw-id="DS660631901" load-source="docdb">BE</country><country mxw-id="DS660632715" load-source="docdb">BG</country><country mxw-id="DS660791013" load-source="docdb">CH</country><country mxw-id="DS660712483" load-source="docdb">CY</country><country mxw-id="DS660737056" load-source="docdb">CZ</country><country mxw-id="DS660631902" load-source="docdb">DE</country><country mxw-id="DS660712484" load-source="docdb">DK</country><country mxw-id="DS660712485" load-source="docdb">EE</country><country mxw-id="DS660717740" load-source="docdb">ES</country><country mxw-id="DS660632716" load-source="docdb">FI</country><country mxw-id="DS660632717" load-source="docdb">FR</country><country mxw-id="DS660631911" load-source="docdb">GB</country><country mxw-id="DS660712486" load-source="docdb">GR</country><country mxw-id="DS660631912" load-source="docdb">HR</country><country mxw-id="DS660737057" load-source="docdb">HU</country><country mxw-id="DS660791014" load-source="docdb">IE</country><country mxw-id="DS660712491" load-source="docdb">IS</country><country mxw-id="DS660632718" load-source="docdb">IT</country><country mxw-id="DS660712492" load-source="docdb">LI</country><country mxw-id="DS660630888" load-source="docdb">LT</country><country mxw-id="DS660737058" load-source="docdb">LU</country><country mxw-id="DS660630889" load-source="docdb">LV</country><country mxw-id="DS660630890" load-source="docdb">MC</country><country mxw-id="DS660709690" load-source="docdb">MK</country><country mxw-id="DS660709695" load-source="docdb">MT</country><country mxw-id="DS660717741" load-source="docdb">NL</country><country mxw-id="DS660632727" load-source="docdb">NO</country><country mxw-id="DS660709696" load-source="docdb">PL</country><country mxw-id="DS660791015" load-source="docdb">PT</country><country mxw-id="DS660717742" load-source="docdb">RO</country><country mxw-id="DS660791016" load-source="docdb">RS</country><country mxw-id="DS660709697" load-source="docdb">SE</country><country mxw-id="DS660791017" load-source="docdb">SI</country><country mxw-id="DS660632728" load-source="docdb">SK</country><country mxw-id="DS660709698" load-source="docdb">SM</country><country mxw-id="DS660712493" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA139073365" ref-ucid="WO-2014130471-A1" lang="EN" load-source="patent-office"><p num="0000">A method of controlling tint of a tintable window to account for occupant comfort in a room of a building. The tintable window is between the interior and exterior of the building. The method predicts a tint level for the tintable window at a future time based on a penetration depth of direct sunlight through the tintable window into the room at the future time and space type in the room. The method also provides instructions over a network to transition tint of the tintable window to the tint level.</p></abstract><abstract mxw-id="PA139541014" ref-ucid="WO-2014130471-A1" lang="EN" source="national office" load-source="docdb"><p>A method of controlling tint of a tintable window to account for occupant comfort in a room of a building. The tintable window is between the interior and exterior of the building. The method predicts a tint level for the tintable window at a future time based on a penetration depth of direct sunlight through the tintable window into the room at the future time and space type in the room. The method also provides instructions over a network to transition tint of the tintable window to the tint level.</p></abstract><abstract mxw-id="PA139073366" ref-ucid="WO-2014130471-A1" lang="FR" load-source="patent-office"><p num="0000">L'invention concerne un procédé de commande de la teinte d'une fenêtre pouvant se teinter afin de rendre compte du confort des occupants dans une pièce d'un immeuble. La fenêtre pouvant se teinter est située entre l'intérieur et l'extérieur de l'immeuble. Le procédé prévoit un niveau de teinte de la fenêtre pouvant se teinter à un moment à venir sur la base d'une profondeur de pénétration de lumière solaire directe à travers la fenêtre pouvant se teinter dans la pièce, au moment à venir et du type d'espace dans la salle. Le procédé fournit aussi des instructions sur un réseau pour faire passer la teinte de la fenêtre pouvant se teinter au niveau de teinte.</p></abstract><abstract mxw-id="PA139541015" ref-ucid="WO-2014130471-A1" lang="FR" source="national office" load-source="docdb"><p>L'invention concerne un procédé de commande de la teinte d'une fenêtre pouvant se teinter afin de rendre compte du confort des occupants dans une pièce d'un immeuble. La fenêtre pouvant se teinter est située entre l'intérieur et l'extérieur de l'immeuble. Le procédé prévoit un niveau de teinte de la fenêtre pouvant se teinter à un moment à venir sur la base d'une profondeur de pénétration de lumière solaire directe à travers la fenêtre pouvant se teinter dans la pièce, au moment à venir et du type d'espace dans la salle. Le procédé fournit aussi des instructions sur un réseau pour faire passer la teinte de la fenêtre pouvant se teinter au niveau de teinte.</p></abstract><description mxw-id="PDES78476926" ref-ucid="WO-2014130471-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="2"/>--><p id="p0001" num="0001"> CONTROL METHOD FOR TINTABLE WINDOWS </p><p id="p0002" num="0002">CROSS-REFERENCE TO RELATED APPLICATION </p><p id="p0003" num="0003">[0001] This application claims benefit of priority under 35 U.S. C. § 119(a) to United States Patent Application serial number 13/772,969, titled "CONTROL METHOD FOR TINTABLE WINDOWS," filed on February 21, 2013, which is hereby incorporated by reference in its entirety and for all purposes. </p><p id="p0004" num="0004">FIELD </p><p id="p0005" num="0005">[0002] The embodiments disclosed herein relate generally to window controllers and related predictive control logic for implementing methods of controlling tint and other functions of tintable windows (e.g., electrochromic windows). </p><p id="p0006" num="0006">BACKGROUND </p><p id="p0007" num="0007">[0003] Electrochromism is a phenomenon in which a material exhibits a reversible electrochemically -mediated change in an optical property when placed in a different electronic state, typically by being subjected to a voltage change. The optical property is typically one or more of color, transmittance, absorbance, and reflectance. One well known electrochromic material is tungsten oxide (W0<sub>3</sub>). Tungsten oxide is a cathodic </p><p id="p0008" num="0008">electrochromic material in which a coloration transition, transparent to blue, occurs by electrochemical reduction. </p><p id="p0009" num="0009">[0004] Electrochromic materials may be incorporated into, for example, windows for home, commercial and other uses. The color, transmittance, absorbance, and/or reflectance of such windows may be changed by inducing a change in the electrochromic material, that is, electrochromic windows are windows that can be darkened or lightened electronically. A small voltage applied to an electrochromic device of the window will cause them to darken; reversing the voltage causes them to lighten. This capability allows control of the amount of light that passes through the windows, and presents an opportunity for electrochromic windows to be used as energy-saving devices. </p><p id="p0010" num="0010">[0005] While electrochromism was discovered in the 1960s, electrochromic devices, and particularly electrochromic windows, still unfortunately suffer various problems and have not 
<!-- EPO <DP n="3"/>-->
 begun to realize their full commercial potential despite many recent advances in electrochromic technology, apparatus and related methods of making and/or using </p><p id="p0011" num="0011">electrochromic devices. </p><p id="p0012" num="0012">SUMMARY </p><p id="p0013" num="0013">[0006] Systems, methods, and apparatus for controlling transitions of electrochromic windows and other tintable windows to different tint levels are provided. Generally, embodiments include predictive control logic for implementing methods of controlling tint levels of electrochromic windows or other tintable windows. Typically, the control logic can be used in a building having one or more electrochromic windows located between the interior and exterior of the building. The windows may have different configurations. For example, some may be vertical windows in offices or lobbies and others may be skylights in hallways. More particularly, disclosed embodiments include predictive control logic that provides a method of predicting and changing the tint level of one or more tintable windows to directly account for occupant comfort. The method can determined the tint level for a future time, for example, to allow for the predicted transition time of the tintable windows. </p><p id="p0014" num="0014">[0007] The comfort has to do with reducing direct glare and/or total radiant energy directed onto an occupant or the occupant's area of activity. In some cases, the comfort also has to do with allowing sufficient natural lighting into the area. The control logic may also make use of considerations for energy conservation. In a particular implementation, control logic may include one or more modules with at least one of the modules being associated with occupant comfort considerations. One or more of the modules may be concerned with energy consumption as well. </p><p id="p0015" num="0015">[0008] In one aspect, one or more modules of the control logic may determine a tint level that is determined based on occupant comfort from direct sunlight or glare on the occupant or their activity area such as their desk. These modules may determine how far into the room the sunlight penetrates at a particular instant in time. The modules may then determine an appropriate tint level that will transmit the level of light that will be comfortable to the occupant. </p><p id="p0016" num="0016">[0009] In another aspect, one or more modules of the control logic may modify the tint level determined based on occupant comfort to also take into account energy considerations from predicted irradiance under clear sky conditions. In this aspect, the tint level may be 
<!-- EPO <DP n="4"/>-->
 darkened to make sure that it performs at least as well as a reference window required in the building as specified by the local municipality codes or standards. The modified tint level will provide at least as much energy savings in cooling as the reference window. In some cases, the tint level may be lightened instead to provide energy savings in heating. </p><p id="p0017" num="0017">[0010] In yet another aspect, one or more modules of the control logic may modify the tint level determined based on occupant comfort and predicted clear sky irradiance to account for actual irradiance. The actual irradiance may be different than the predicted irradiance due to obstructions and reflection of light. A photosensor or other sensor that can measure radiation levels can be used to determine the actual irradiance. These one or more modules determine the lightest tint level that transmits as much or less light into the room than the tint level determined based on occupant comfort and predicted clear sky irradiance. </p><p id="p0018" num="0018">[0011] One embodiment is a method of controlling tint of a tintable window to account for occupant comfort in a room of a building. The tintable window is located between the interior and exterior of the building. The method predicts an appropriate tint level for the tintable window at a future time based on a penetration depth of direct sunlight through the tintable window into the room at the future time and space type in the room. The method provides instructions over a network to transition tint of the tintable window to the tint level. </p><p id="p0019" num="0019">[0012] Another embodiment is a controller for controlling tint of a tintable window to account for occupant comfort in a room of a building. The tintable window is located between the interior and exterior of the building. The controller comprises a processor configured to determine a tint level for the tintable window based on a penetration depth of direct sunlight through the tintable window into a room and space type in the room. The controller also comprises a power width modulator in communication with the processor and with the tintable window over a network. The power width modulator is configured to receive the tint level from the processor and send a signal with tint instructions over the network to transition the tint of the tintable window to the determined tint level. </p><p id="p0020" num="0020">[0013] Another embodiment is a master controller for controlling tint of a tintable window to account for occupant comfort in a building. The tintable window is located between the interior and exterior of the building. The master controller comprises a computer readable medium and a processor in communication with the computer readable medium and in communication with a local window controller for the tintable window. The computer readable medium has a configuration file with a space type associated with the tintable 
<!-- EPO <DP n="5"/>-->
 window. The processor is configured to receive the space type from the computer readable medium, determine a tint level for the tintable window based on a penetration depth of direct sunlight through the tintable window into a room and the space type, and send tint instructions over a network to the local window controller to transition tint of the tintable window to the determined tint level. </p><p id="p0021" num="0021">[0014] Another embodiment is a method of controlling tint of one or more tintable windows in a zone of a building to account for occupant comfort. The method calculates a future time based on a current time and based on a predicted transition time of a </p><p id="p0022" num="0022">representative window of the zone. The method also predicts a solar position at the future time and determines a program designated by a user in schedule. The program includes logic for determining a tint level based on one or more independent variables. The method also employs the determined program to determining the tint level based on the predicted solar position at the future time and occupant comfort. The method also communicates instructions to the one or more tintable windows to transition tint to the determined tint level. </p><p id="p0023" num="0023">[0015] Another embodiment is a window controller for controlling tint of one or more tintable windows in a zone of a building to account for occupant comfort. The window controller comprises a computer readable medium having predictive control logic, and site data and zone/group data associated with the zone. The window controller further comprises a processor in communication with the computer readable medium and in communication with the tintable window. The processor is configured to calculate a future time based on a current time and a predicted transition time of a representative window of the zone. The processor is also configured to predict a solar position at the future time and determine a program designated by a user in a schedule. The program includes logic for determining a tint level based on one or more independent variables. The processor is also configured to employ the determined program to determine a tint level using the predicted solar position at the future time and based on occupant comfort. The processor is also configured to communicate instructions to the one or more tintable windows in the zone to transition tint to the determined tint level. </p><p id="p0024" num="0024">[0016] These and other features and embodiments will be described in more detail below with reference to the drawings. 
<!-- EPO <DP n="6"/>-->
 BRIEF DESCRIPTION OF THE DRAWINGS </p><p id="p0025" num="0025">[0017] FIGS. 1A-1C show schematic diagrams of electrochromic devices formed on glass substrates, i.e., electrochromic lites. </p><p id="p0026" num="0026">[0018] FIGS. 2 A and 2B show cross-sectional schematic diagrams of the electrochromic lites as described in relation to FIGS. 1A-1C integrated into an IGU. </p><p id="p0027" num="0027">[0019] FIG. 3A depicts a schematic cross-section of an electrochromic device. </p><p id="p0028" num="0028">[0020] FIG. 3B depicts a schematic cross-section of an electrochromic device in a bleached state (or transitioning to a bleached state). </p><p id="p0029" num="0029">[0021] FIG. 3C depicts a schematic cross-section of the electrochromic device shown in FIG. 3B, but in a colored state (or transitioning to a colored state). </p><p id="p0030" num="0030">[0022] FIG. 4 depicts a simplified block diagram of components of a window controller. </p><p id="p0031" num="0031">[0023] FIG. 5 depicts a schematic diagram of a room including a tintable window and at least one sensor, according to disclosed embodiments. </p><p id="p0032" num="0032">[0024] FIGS. 6A-6C include diagrams depicting some information collected by each of three Modules A, B, and C of an exemplary control logic, according to disclosed </p><p id="p0033" num="0033">embodiments. </p><p id="p0034" num="0034">[0025] FIG. 7 is a flowchart showing some steps of predictive control logic for a method of controlling one or more electrochromic windows in a building, according to disclosed embodiments. </p><p id="p0035" num="0035">[0026] FIG. 8 is a flowchart showing a particular implementation of a portion of the control logic shown in FIG. 7. </p><p id="p0036" num="0036">[0027] FIG. 9 is a flowchart showing details of Module A according to disclosed embodiments. </p><p id="p0037" num="0037">[0028] FIG. 10 is an example of an occupancy lookup table according to disclosed embodiments. 
<!-- EPO <DP n="7"/>-->
 [0029] FIG. 11A depicts a schematic diagram of a room including an electrochromic window with a space type based on the Desk 1 located near the window, according to disclosed embodiments. </p><p id="p0038" num="0038">[0030] FIG. 11B depicts a schematic diagram of a room including an electrochromic window with a space type based on the Desk 2 located further away from the window than in FIG. 11 A, according to disclosed embodiments. </p><p id="p0039" num="0039">[0031] FIG. 12 is a flowchart showing details of Module B according to disclosed embodiments. </p><p id="p0040" num="0040">[0032] FIG. 13 is a flowchart showing details of Module C according to disclosed embodiments. </p><p id="p0041" num="0041">[0033] FIG. 14 is a diagram showing another implementation of a portion of the control logic shown in FIG. 7. </p><p id="p0042" num="0042">[0034] FIG. 15 depicts a schematic diagram of an embodiment of a building management system. </p><p id="p0043" num="0043">[0035] FIG. 16 depicts a block diagram of an embodiment of a building network. </p><p id="p0044" num="0044">[0036] FIG. 17 is a block diagram of components of a system for controlling functions of one or more tintable windows of a building. </p><p id="p0045" num="0045">[0037] FIG. 18 is a block diagram depicting predictive control logic for a method of controlling the transitioning of tint levels of one or more tintable windows (e.g., </p><p id="p0046" num="0046">electrochromic windows) in a building. </p><p id="p0047" num="0047">[0038] FIG. 19 is screenshot of a user interface used to enter schedule information to generate a schedule employed by a window controller, according to embodiments. </p><p id="p0048" num="0048">[0039] FIG. 20 is an example of an occupancy lookup table and a schematic diagram of a room with a desk and window showing the relationship between acceptance angle, sun angle, and penetration depth, according to embodiments. </p><p id="p0049" num="0049">[0040] FIGS. 21A, 21B, and 21C are schematic drawings of the plan view of a portion of building having three different space types, according to an embodiment. 
<!-- EPO <DP n="8"/>-->
 [0041] FIG. 22 is a block diagram of subsystems that may be present in window controllers used to control the tint level or more tintable windows, according to embodiments. 
<!-- EPO <DP n="9"/>-->
</p><p id="p0050" num="0050">DETAILED DESCRIPTION </p><p id="p0051" num="0051">[0042] In the following description, numerous specific details are set forth in order to provide a thorough understanding of the presented embodiments. The disclosed embodiments may be practiced without some or all of these specific details. In other instances, well-known process operations have not been described in detail to not unnecessarily obscure the disclosed embodiments. While the disclosed embodiments will be described in conjunction with the specific embodiments, it will be understood that it is not intended to limit the disclosed embodiments. </p><p id="p0052" num="0052">[0043] /. Overview of Electrochromic Devices </p><p id="p0053" num="0053">[0044] It should be understood that while disclosed embodiments focus on electrochromic windows (also referred to as smart windows), the concepts disclosed herein may apply to other types of tintable windows. For example, a tintable window incorporating a liquid crystal device or a suspended particle device, instead of an electrochromic device could be incorporated in any of the disclosed embodiments. </p><p id="p0054" num="0054">[0045] In order to orient the reader to the embodiments of systems, window controllers, and methods disclosed herein, a brief discussion of electrochromic devices is provided. This initial discussion of electrochromic devices is provided for context only, and the subsequently described embodiments of systems, window controllers, and methods are not limited to the specific features and fabrication processes of this initial discussion. </p><p id="p0055" num="0055">[0046] A particular example of an electrochromic lite is described with reference to </p><p id="p0056" num="0056">FIGS. 1A-1C, in order to illustrate embodiments described herein. FIG. 1A is a cross- sectional representation (see section cut X'-X' of FIG. 1C) of an electrochromic lite 100, which is fabricated starting with a glass sheet 105. FIG. IB shows an end view (see viewing perspective Y-Y' of FIG. 1C) of electrochromic lite 100, and FIG. 1C shows a top-down view of electrochromic lite 100. FIG. 1A shows the electrochromic lite after fabrication on glass sheet 105, edge deleted to produce area 140, around the perimeter of the lite. The electrochromic lite has also been laser scribed and bus bars have been attached. The glass lite 105 has a diffusion barrier 110, and a first transparent conducting oxide layer (TCO) 115, on the diffusion barrier. In this example, the edge deletion process removes both TCO 115 and diffusion barrier 110, but in other embodiments only the TCO is removed, leaving the diffusion barrier intact. The TCO 115 is the first of two conductive layers used to form the 
<!-- EPO <DP n="10"/>-->
 electrodes of the electrochromic device fabricated on the glass sheet. In this example, the glass sheet includes underlying glass and the diffusion barrier layer. Thus, in this example, the diffusion barrier is formed, and then the first TCO, an electrochromic stack 125, (e.g., having electrochromic, ion conductor, and counter electrode layers), and a second TCO 130, are formed. In one embodiment, the electrochromic device (electrochromic stack and second TCO) is fabricated in an integrated deposition system where the glass sheet does not leave the integrated deposition system at any time during fabrication of the stack. In one embodiment, the first TCO layer is also formed using the integrated deposition system where the glass sheet does not leave the integrated deposition system during deposition of the electrochromic stack and the (second) TCO layer. In one embodiment, all of the layers (diffusion barrier, first TCO, electrochromic stack, and second TCO) are deposited in the integrated deposition system where the glass sheet does not leave the integrated deposition system during deposition. In this example, prior to deposition of electrochromic stack 125, an isolation trench 120, is cut through TCO 115 and diffusion barrier 110. Trench 120 is made in contemplation of electrically isolating an area of TCO 115 that will reside under bus bar 1 after fabrication is complete (see FIG. 1A). This is done to avoid charge buildup and coloration of the electrochromic device under the bus bar, which can be undesirable. </p><p id="p0057" num="0057">[0047] After formation of the electrochromic device, edge deletion processes and additional laser scribing are performed. FIG. 1A depicts areas 140 where the device has been removed, in this example, from a perimeter region surrounding laser scribe trenches 150, 155, 160, and 165. Trenches 150, 160 and 165 pass through the electrochromic stack and also through the first TCO and diffusion barrier. Trench 155 passes through second TCO 130 and the electrochromic stack, but not the first TCO 115. Laser scribe trenches 150, 155, 160, and 165 are made to isolate portions of the electrochromic device, 135, 145, 170, and 175, which were potentially damaged during edge deletion processes from the operable electrochromic device. In this example, laser scribe trenches 150, 160, and 165 pass through the first TCO to aid in isolation of the device (laser scribe trench 155 does not pass through the first TCO, otherwise it would cut off bus bar 2's electrical communication with the first TCO and thus the electrochromic stack). The laser or lasers used for the laser scribe processes are typically, but not necessarily, pulse-type lasers, for example, diode-pumped solid state lasers. For example, the laser scribe processes can be performed using a suitable laser from IPG </p><p id="p0058" num="0058">Photonics (of Oxford, Massachusetts), or from Ekspla (of Vilnius, Lithuania). Scribing can also be performed mechanically, for example, by a diamond tipped scribe. One of ordinary skill in the art would appreciate that the laser scribing processes can be performed at different 
<!-- EPO <DP n="11"/>-->
 depths and/or performed in a single process whereby the laser cutting depth is varied, or not, during a continuous path around the perimeter of the electrochromic device. In one embodiment, the edge deletion is performed to the depth of the first TCO. </p><p id="p0059" num="0059">[0048] After laser scribing is complete, bus bars are attached. Non-penetrating bus bar 1 is applied to the second TCO. Non-penetrating bus bar 2 is applied to an area where the device was not deposited (e.g., from a mask protecting the first TCO from device deposition), in contact with the first TCO or, in this example, where an edge deletion process (e.g., laser ablation using an apparatus having a XY or XYZ galvanometer) was used to remove material down to the first TCO. In this example, both bus bar 1 and bus bar 2 are non-penetrating bus bars. A penetrating bus bar is one that is typically pressed into and through the </p><p id="p0060" num="0060">electrochromic stack to make contact with the TCO at the bottom of the stack. A nonpenetrating bus bar is one that does not penetrate into the electrochromic stack layers, but rather makes electrical and physical contact on the surface of a conductive layer, for example, a TCO. </p><p id="p0061" num="0061">[0049] The TCO layers can be electrically connected using a non-traditional bus bar, for example, a bus bar fabricated with screen and lithography patterning methods. In one embodiment, electrical communication is established with the device's transparent conducting layers via silk screening (or using another patterning method) a conductive ink followed by heat curing or sintering the ink. Advantages to using the above described device </p><p id="p0062" num="0062">configuration include simpler manufacturing, for example, and less laser scribing than conventional techniques which use penetrating bus bars. </p><p id="p0063" num="0063">[0050] After the bus bars are connected, the device is integrated into an insulated glass unit (IGU), which includes, for example, wiring the bus bars and the like. In some embodiments, one or both of the bus bars are inside the finished IGU, however in one embodiment one bus bar is outside the seal of the IGU and one bus bar is inside the IGU. In the former embodiment, area 140 is used to make the seal with one face of the spacer used to form the IGU. Thus, the wires or other connection to the bus bars runs between the spacer and the glass. As many spacers are made of metal, e.g., stainless steel, which is conductive, it is desirable to take steps to avoid short circuiting due to electrical communication between the bus bar and connector thereto and the metal spacer. </p><p id="p0064" num="0064">[0051] As described above, after the bus bars are connected, the electrochromic lite is integrated into an IGU, which includes, for example, wiring for the bus bars and the like. In 
<!-- EPO <DP n="12"/>-->
 the embodiments described herein, both of the bus bars are inside the primary seal of the finished IGU. </p><p id="p0065" num="0065">[0052] FIG. 2A shows a cross-sectional schematic diagram of the electrochromic window as described in relation to FIGS. 1A-1C integrated into an IGU 200. A spacer 205 is used to separate the electrochromic lite from a second lite 210. Second lite 210 in IGU 200 is a non- electrochromic lite, however, the embodiments disclosed herein are not so limited. For example, lite 210 can have an electrochromic device thereon and/or one or more coatings such as low-E coatings and the like. Lite 201 can also be laminated glass, such as depicted in FIG. 2B (lite 201 is laminated to reinforcing pane 230, via resin 235). Between spacer 205 and the first TCO layer of the electrochromic lite is a primary seal material 215. This primary seal material is also between spacer 205 and second glass lite 210. Around the perimeter of spacer 205 is a secondary seal 220. Bus bar wiring/leads traverse the seals for connection to a controller. Secondary seal 220 may be much thicker that depicted. These seals aid in keeping moisture out of an interior space 225, of the IGU. They also serve to prevent argon or other gas in the interior of the IGU from escaping. </p><p id="p0066" num="0066">[0053] FIG. 3A schematically depicts an electrochromic device 300, in cross-section. Electrochromic device 300 includes a substrate 302, a first conductive layer (CL) 304, an electrochromic layer (EC) 306, an ion conducting layer (IC) 308, a counter electrode layer (CE) 310, and a second conductive layer (CL) 314. Layers 304, 306, 308, 310, and 314 are collectively referred to as an electrochromic stack 320. A voltage source 316 operable to apply an electric potential across electrochromic stack 320 effects the transition of the electrochromic device from, for example, a bleached state to a colored state (depicted). The order of layers can be reversed with respect to the substrate. </p><p id="p0067" num="0067">[0054] Electrochromic devices having distinct layers as described can be fabricated as all solid state devices and/or all inorganic devices having low defectivity. Such devices and methods of fabricating them are described in more detail in U.S. Patent Application Serial Number 12/645,111, entitled "Fabrication of Low-Defectivity Electrochromic Devices," filed on December 22, 2009, and naming Mark Kozlowski et al. as inventors, and in U.S. Patent Application Serial Number 12/645,159, entitled, "Electrochromic Devices," filed on </p><p id="p0068" num="0068">December 22, 2009 and naming Zhongchun Wang et al. as inventors, both of which are hereby incorporated by reference in their entireties. It should be understood, however, that any one or more of the layers in the stack may contain some amount of organic material. The 
<!-- EPO <DP n="13"/>-->
 same can be said for liquids that may be present in one or more layers in small amounts. It should also be understood that solid state material may be deposited or otherwise formed by processes employing liquid components such as certain processes employing sol-gels or chemical vapor deposition. </p><p id="p0069" num="0069">[0055] Additionally, it should be understood that the reference to a transition between a bleached state and colored state is non-limiting and suggests only one example, among many, of an electrochromic transition that may be implemented. Unless otherwise specified herein (including the foregoing discussion), whenever reference is made to a bleached-colored transition, the corresponding device or process encompasses other optical state transitions such as non-reflective-reflective, transparent-opaque, etc. Further, the term "bleached" refers to an optically neutral state, for example, uncolored, transparent, or translucent. Still further, unless specified otherwise herein, the "color" of an electrochromic transition is not limited to any particular wavelength or range of wavelengths. As understood by those of skill in the art, the choice of appropriate electrochromic and counter electrode materials governs the relevant optical transition. </p><p id="p0070" num="0070">[0056] In embodiments described herein, the electrochromic device reversibly cycles between a bleached state and a colored state. In some cases, when the device is in a bleached state, a potential is applied to the electrochromic stack 320 such that available ions in the stack reside primarily in the counter electrode 310. When the potential on the electrochromic stack is reversed, the ions are transported across the ion conducting layer 308 to the electrochromic material 306 and cause the material to transition to the colored state. In a similar way, the electrochromic device of embodiments described herein can be reversibly cycled between different tint levels (e.g., bleached state, darkest colored state, and </p><p id="p0071" num="0071">intermediate levels between the bleached state and the darkest colored state). </p><p id="p0072" num="0072">[0057] Referring again to FIG. 3 A, voltage source 316 may be configured to operate in conjunction with radiant and other environmental sensors. As described herein, voltage source 316 interfaces with a device controller (not shown in this figure). Additionally, voltage source 316 may interface with an energy management system that controls the electrochromic device according to various criteria such as the time of year, time of day, and measured environmental conditions. Such an energy management system, in conjunction with large area electrochromic devices (e.g., an electrochromic window), can dramatically lower the energy consumption of a building. 
<!-- EPO <DP n="14"/>-->
 [0058] Any material having suitable optical, electrical, thermal, and mechanical properties may be used as substrate 302. Such substrates include, for example, glass, plastic, and mirror materials. Suitable glasses include either clear or tinted soda lime glass, including soda lime float glass. The glass may be tempered or untempered. </p><p id="p0073" num="0073">[0059] In many cases, the substrate is a glass pane sized for residential window </p><p id="p0074" num="0074">applications. The size of such glass pane can vary widely depending on the specific needs of the residence. In other cases, the substrate is architectural glass. Architectural glass is typically used in commercial buildings, but may also be used in residential buildings, and typically, though not necessarily, separates an indoor environment from an outdoor environment. In certain embodiments, architectural glass is at least 20 inches by 20 inches, and can be much larger, for example, as large as about 80 inches by 120 inches. Architectural glass is typically at least about 2 mm thick, typically between about 3 mm and about 6 mm thick. Of course, electrochromic devices are scalable to substrates smaller or larger than architectural glass. Further, the electrochromic device may be provided on a mirror of any size and shape. </p><p id="p0075" num="0075">[0060] On top of substrate 302 is conductive layer 304. In certain embodiments, one or both of the conductive layers 304 and 314 is inorganic and/or solid. Conductive layers 304 and 314 may be made from a number of different materials, including conductive oxides, thin metallic coatings, conductive metal nitrides, and composite conductors. Typically, conductive layers 304 and 314 are transparent at least in the range of wavelengths where electrochromism is exhibited by the electrochromic layer. Transparent conductive oxides include metal oxides and metal oxides doped with one or more metals. Examples of such metal oxides and doped metal oxides include indium oxide, indium tin oxide, doped indium oxide, tin oxide, doped tin oxide, zinc oxide, aluminum zinc oxide, doped zinc oxide, ruthenium oxide, doped ruthenium oxide and the like. Since oxides are often used for these layers, they are sometimes referred to as "transparent conductive oxide" (TCO) layers. Thin metallic coatings that are substantially transparent may also be used. </p><p id="p0076" num="0076">[0061] The function of the conductive layers is to spread an electric potential provided by voltage source 316 over surfaces of the electrochromic stack 320 to interior regions of the stack, with relatively little ohmic potential drop. The electric potential is transferred to the conductive layers though electrical connections to the conductive layers. In some </p><p id="p0077" num="0077">embodiments, bus bars, one in contact with conductive layer 304 and one in contact with 
<!-- EPO <DP n="15"/>-->
 conductive layer 314, provide the electric connection between the voltage source 316 and the conductive layers 304 and 314. The conductive layers 304 and 314 may also be connected to the voltage source 316 with other conventional means. </p><p id="p0078" num="0078">[0062] Overlaying conductive layer 304 is electrochromic layer 306. In some </p><p id="p0079" num="0079">embodiments, electrochromic layer 306 is inorganic and/or solid. The electrochromic layer may contain any one or more of a number of different electrochromic materials, including metal oxides. Such metal oxides include tungsten oxide (W03), molybdenum oxide (Mo03), niobium oxide (Nb205), titanium oxide (Ti02), copper oxide (CuO), iridium oxide (Ir203), chromium oxide (Cr203), manganese oxide (Mn203), vanadium oxide (V205), nickel oxide (Ni203), cobalt oxide (Co203) and the like. During operation, electrochromic layer 306 transfers ions to and receives ions from counter electrode layer 310 to cause optical transitions. </p><p id="p0080" num="0080">[0063] Generally, the colorization (or change in any optical property - e.g., absorbance, reflectance, and transmittance) of the electrochromic material is caused by reversible ion insertion into the material (e.g., intercalation) and a corresponding injection of a charge balancing electron. Typically some fraction of the ions responsible for the optical transition is irreversibly bound up in the electrochromic material. Some or all of the irreversibly bound ions are used to compensate "blind charge" in the material. In most electrochromic materials, suitable ions include lithium ions (Li+) and hydrogen ions (H+) (that is, protons). In some cases, however, other ions will be suitable. In various embodiments, lithium ions are used to produce the electrochromic phenomena. Intercalation of lithium ions into tungsten oxide (W03-y (0 &lt; y≤ -0.3)) causes the tungsten oxide to change from transparent (bleached state) to blue (colored state). </p><p id="p0081" num="0081">[0064] Referring again to FIG. 3A, in electrochromic stack 320, ion conducting layer 308 is sandwiched between electrochromic layer 306 and counter electrode layer 310. In some embodiments, counter electrode layer 310 is inorganic and/or solid. The counter electrode layer may comprise one or more of a number of different materials that serve as a reservoir of ions when the electrochromic device is in the bleached state. During an electrochromic transition initiated by, for example, application of an appropriate electric potential, the counter electrode layer transfers some or all of the ions it holds to the electrochromic layer, changing the electrochromic layer to the colored state. Concurrently, in the case of NiWO, the counter electrode layer colors with the loss of ions. 
<!-- EPO <DP n="16"/>-->
 [0065] In some embodiments, suitable materials for the counter electrode complementary to W03 include nickel oxide (NiO), nickel tungsten oxide (NiWO), nickel vanadium oxide, nickel chromium oxide, nickel aluminum oxide, nickel manganese oxide, nickel magnesium oxide, chromium oxide (Cr203), manganese oxide (Mn02), and Prussian blue. </p><p id="p0082" num="0082">[0066] When charge is removed from a counter electrode 310 made of nickel tungsten oxide (that is, ions are transported from counter electrode 310 to electrochromic layer 306), the counter electrode layer will transition from a transparent state to a colored state. </p><p id="p0083" num="0083">[0067] In the depicted electrochromic device, between electrochromic layer 306 and counter electrode layer 310, there is the ion conducting layer 308. Ion conducting layer 308 serves as a medium through which ions are transported (in the manner of an electrolyte) when the electrochromic device transitions between the bleached state and the colored state. </p><p id="p0084" num="0084">Preferably, ion conducting layer 308 is highly conductive to the relevant ions for the electrochromic and the counter electrode layers, but has sufficiently low electron conductivity that negligible electron transfer takes place during normal operation. A thin ion conducting layer with high ionic conductivity permits fast ion conduction and hence fast switching for high performance electrochromic devices. In certain embodiments, the ion conducting layer 308 is inorganic and/or solid. </p><p id="p0085" num="0085">[0068] Examples of suitable ion conducting layers (for electrochromic devices having a distinct IC layer) include silicates, silicon oxides, tungsten oxides, tantalum oxides, niobium oxides, and borates. These materials may be doped with different dopants, including lithium. Lithium doped silicon oxides include lithium silicon-aluminum-oxide. In some embodiments, the ion conducting layer comprises a silicate-based structure. In some embodiments, a silicon-aluminum-oxide (SiAlO) is used for the ion conducting layer 308. </p><p id="p0086" num="0086">[0069] Electrochromic device 300 may include one or more additional layers (not shown), such as one or more passive layers. Passive layers used to improve certain optical properties may be included in electrochromic device 300. Passive layers for providing moisture or scratch resistance may also be included in electrochromic device 300. For example, the conductive layers may be treated with anti-reflective or protective oxide or nitride layers. Other passive layers may serve to hermetically seal electrochromic device 300. </p><p id="p0087" num="0087">[0070] FIG. 3B is a schematic cross-section of an electrochromic device in a bleached state (or transitioning to a bleached state). In accordance with specific embodiments, an 
<!-- EPO <DP n="17"/>-->
 electrochromic device 400 includes a tungsten oxide electrochromic layer (EC) 406 and a nickel-tungsten oxide counter electrode layer (CE) 410. Electrochromic device 400 also includes a substrate 402, a conductive layer (CL) 404, an ion conducting layer (IC) 408, and conductive layer (CL) 414. </p><p id="p0088" num="0088">[0071] A power source 416 is configured to apply a potential and/or current to an electrochromic stack 420 through suitable connections (e.g., bus bars) to the conductive layers 404 and 414. In some embodiments, the voltage source is configured to apply a potential of a few volts in order to drive a transition of the device from one optical state to another. The polarity of the potential as shown in FIG. 3A is such that the ions (lithium ions in this example) primarily reside (as indicated by the dashed arrow) in nickel-tungsten oxide counter electrode layer 410 </p><p id="p0089" num="0089">[0072] FIG. 3C is a schematic cross-section of electrochromic device 400 shown in FIG. 3B but in a colored state (or transitioning to a colored state). In FIG. 3C, the polarity of voltage source 416 is reversed, so that the electrochromic layer is made more negative to accept additional lithium ions, and thereby transition to the colored state. As indicated by the dashed arrow, lithium ions are transported across ion conducting layer 408 to tungsten oxide electrochromic layer 406. Tungsten oxide electrochromic layer 406 is shown in the colored state. Nickel-tungsten oxide counter electrode 410 is also shown in the colored state. As explained, nickel-tungsten oxide becomes progressively more opaque as it gives up </p><p id="p0090" num="0090">(deintercalates) lithium ions. In this example, there is a synergistic effect where the transition to colored states for both layers 406 and 410 are additive toward reducing the amount of light transmitted through the stack and substrate. </p><p id="p0091" num="0091">[0073] As described above, an electrochromic device may include an electrochromic (EC) electrode layer and a counter electrode (CE) layer separated by an ionically conductive (IC) layer that is highly conductive to ions and highly resistive to electrons. As conventionally understood, the ionically conductive layer therefore prevents shorting between the </p><p id="p0092" num="0092">electrochromic layer and the counter electrode layer. The ionically conductive layer allows the electrochromic and counter electrodes to hold a charge and thereby maintain their bleached or colored states. In electrochromic devices having distinct layers, the components form a stack which includes the ion conducting layer sandwiched between the electrochromic electrode layer and the counter electrode layer. The boundaries between these three stack 
<!-- EPO <DP n="18"/>-->
 components are defined by abrupt changes in composition and/or micro structure. Thus, the devices have three distinct layers with two abrupt interfaces. </p><p id="p0093" num="0093">[0074] In accordance with certain embodiments, the counter electrode and electrochromic electrodes are formed immediately adjacent one another, sometimes in direct contact, without separately depositing an ionically conducting layer. In some embodiments, electrochromic devices having an interfacial region rather than a distinct IC layer are employed. Such devices, and methods of fabricating them, are described in U.S. Patent No. 8,300,298 and U.S. Patent Application Serial Numberl2/772, 075 filed on April 30, 2010, and U.S. Patent Applications Serial Numbers 12/814,277 and 12/814,279, filed on June 11, 2010 - each of the three patent applications and patent is entitled "Electrochromic Devices," each names Zhongchun Wang et al. as inventors, and each is incorporated by reference herein in its entirety. </p><p id="p0094" num="0094">[0075] //. Window Controllers </p><p id="p0095" num="0095">[0076] A window controller is used to control the tint level of the electrochromic device of an electrochromic window. In some embodiments, the window controller is able to transition the electrochromic window between two tint states (levels), a bleached state and a colored state. In other embodiments, the controller can additionally transition the </p><p id="p0096" num="0096">electrochromic window (e.g., having a single electrochromic device) to intermediate tint levels. In some disclosed embodiments, the window controller is able to transition the electrochromic window to four or more tint levels. Certain electrochromic windows allow intermediate tint levels by using two (or more) electrochromic lites in a single IGU, where each lite is a two-state lite. This is described in reference to FIGS. 2 A and 2B in this section. </p><p id="p0097" num="0097">[0077] As noted above with respect to FIGS. 2A and 2B, in some embodiments, an electrochromic window can include an electrochromic device 400 on one lite of an IGU 200 and another electrochromic device 400 on the other lite of the IGU 200. If the window controller is able to transition each electrochromic device between two states, a bleached state and a colored state, the electrochromic window is able to attain four different states (tint levels), a colored state with both electrochromic devices being colored, a first intermediate state with one electrochromic device being colored, a second intermediate state with the other electrochromic device being colored, and a bleached state with both electrochromic devices being bleached. Embodiments of multi-pane electrochromic windows are further described in U.S. Patent Number 8,270,059, naming Robin Friedman et al. as inventors, titled "MULTI- 
<!-- EPO <DP n="19"/>-->
 PANE ELECTROCHROMIC WINDOWS," which is hereby incorporated by reference in its entirety. </p><p id="p0098" num="0098">[0078] In some embodiments, the window controller is able to transition an </p><p id="p0099" num="0099">electrochromic window having an electrochromic device capable of transitioning between two or more tint levels. For example, a window controller may be able to transition the electrochromic window to a bleached state, one or more intermediate levels, and a colored state. In some other embodiments, the window controller is able to transition an </p><p id="p0100" num="0100">electrochromic window incorporating an electrochromic device between any number of tint levels between the bleached state and the colored state. Embodiments of methods and controllers for transitioning an electrochromic window to an intermediate tint level or levels are further described in U.S. Patent Number 8,254,013, naming Disha Mehtani et al. as inventors, titled "CONTROLLING TRANSITIONS IN OPTICALLY SWITCHABLE DEVICES," which is hereby incorporated by reference in its entirety. </p><p id="p0101" num="0101">[0079] In some embodiments, a window controller can power one or more electrochromic devices in an electrochromic window. Typically, this function of the window controller is augmented with one or more other functions described in more detail below. Window controllers described herein are not limited to those that have the function of powering an electrochromic device to which it is associated for the purposes of control. That is, the power source for the electrochromic window may be separate from the window controller, where the controller has its own power source and directs application of power from the window power source to the window. However, it is convenient to include a power source with the window controller and to configure the controller to power the window directly, because it obviates the need for separate wiring for powering the electrochromic window. </p><p id="p0102" num="0102">[0080] Further, the window controllers described in this section are described as standalone controllers which may be configured to control the functions of a single window or a plurality of electrochromic windows, without integration of the window controller into a building control network or a building management system (BMS). Window controllers, however, may be integrated into a building control network or a BMS, as described further in the Building Management System section of this disclosure. </p><p id="p0103" num="0103">[0081] FIG. 4 depicts a block diagram of some components of a window controller 450 and other components of a window controller system of disclosed embodiments. FIG. 4 is a simplified block diagram of a window controller, and more detail regarding window 
<!-- EPO <DP n="20"/>-->
 controllers can be found in U.S. Patent Application Serial numbers 13/449,248 and </p><p id="p0104" num="0104">13/449,251, both naming Stephen Brown as inventor, both titled "CONTROLLER FOR OPTICALLY-SWITCHABLE WINDOWS," and both filed on April 17, 2012, and in U.S. Patent Serial Number 13/449,235, titled "CONTROLLING TRANSITIONS IN OPTICALLY SWITCHABLE DEVICES," naming Stephen Brown et al. as inventors and filed on April 17, 2012, all of which are hereby incorporated by reference in their entireties. </p><p id="p0105" num="0105">[0082] In FIG. 4, the illustrated components of the window controller 450 include a window controller 450 having a microprocessor 455 or other processor, a power width modulator (PWM) 460, a signal conditioning module 465, and a computer readable medium (e.g., memory) having a configuration file 475. Window controller 450 is in electronic communication with one or more electrochromic devices 400 in an electrochromic window through network 480 (wired or wireless) to send instructions to the one or more </p><p id="p0106" num="0106">electrochromic devices 400. In some embodiments, the window controller 450 may be a local window controller in communication through a network (wired or wireless) to a master window controller. </p><p id="p0107" num="0107">[0083] In disclosed embodiments, a building may have at least one room having an electrochromic window between the exterior and interior of a building. One or more sensors may be located to the exterior of the building and/or inside the room. In embodiments, the output from the one or more sensors may be input to the signal conditioning module 465 of the window controller 450. In some cases, the output from the one or more sensors may be input to a BMS, as described further in the Building Management Systems section. Although the sensors of depicted embodiments are shown as located on the outside vertical wall of the building, this is for the sake of simplicity, and the sensors may be in other locations, such as inside the room or on other surfaces to the exterior, as well. In some cases, two or more sensors may be used to measure the same input, which can provide redundancy in case one sensor fails or has an otherwise erroneous reading. </p><p id="p0108" num="0108">[0084] FIG. 5 depicts a schematic diagram of a room 500 having an electrochromic window 505 with at least one electrochromic device. The electrochromic window 505 is located between the exterior and the interior of a building, which includes the room 500. The room 500 also includes a window controller 450 connected to and configured to control the tint level of the electrochromic window 505. An exterior sensor 510 is located on a vertical surface in the exterior of the building. In other embodiments, an interior sensor may also be 
<!-- EPO <DP n="21"/>-->
 used to measure the ambient light in room 500. In yet other embodiments, an occupant sensor may also be used to determine when an occupant is in the room 500. </p><p id="p0109" num="0109">[0085] Exterior sensor 510 is a device, such as a photosensor, that is able to detect radiant light incident upon the device flowing from a light source such as the sun or from light reflected to the sensor from a surface, particles in the atmosphere, clouds, etc. The exterior sensor 510 may generate a signal in the form of electrical current that results from the photoelectric effect and the signal may be a function of the light incident on the sensor 510. In some cases, the device may detect radiant light in terms of irradiance in units of watts/m<sup>2</sup> or other similar units. In other cases, the device may detect light in the visible range of wavelengths in units of foot candles or similar units. In many cases, there is a linear relationship between these values of irradiance and visible light. </p><p id="p0110" num="0110">[0086] Irradiance values from sunlight can be predicted based on the time of day and time of year as the angle at which sunlight strikes the earth changes. Exterior sensor 510 can detect radiant light in real-time, which accounts for reflected and obstructed light due to buildings, changes in weather (e.g., clouds), etc. For example, on cloudy days, sunlight would be blocked by the clouds and the radiant light detected by an exterior sensor 510 would be lower than on cloudless days. </p><p id="p0111" num="0111">[0087] In some embodiments, there may be one or more exterior sensors 510 associated with a single electrochromic window 505. Output from the one or more exterior sensors 510 could be compared to one another to determine, for example, if one of exterior sensors 510 is shaded by an object, such as by a bird that landed on exterior sensor 510. In some cases, it may be desirable to use relatively few sensors in a building because some sensors can be unreliable and/or expensive. In certain implementations, a single sensor or a few sensors may be employed to determine the current level of radiant light from the sun impinging on the building or perhaps one side of the building. A cloud may pass in front of the sun or a construction vehicle may park in front of the setting sun. These will result in deviations from the amount of radiant light from the sun calculated to normally impinge on the building. </p><p id="p0112" num="0112">[0088] Exterior sensor 510 may be a type of photosensor. For example, exterior sensor 510 may be a charge coupled device (CCD), photodiode, photoresistor, or photovoltaic cell. One of ordinary skill in the art would appreciate that future developments in photosensor and other sensor technology would also work, as they measure light intensity and provide an electrical output representative of the light level. 
<!-- EPO <DP n="22"/>-->
 [0089] In some embodiments, output from exterior sensor 510 may be input to the signal conditioning module 465. The input may be in the form of a voltage signal to signal conditioning module 465. Signal conditioning module 465 passes an output signal to the window controller 450. Window controller 450 determines a tint level of the electrochromic window 505, based on various information from the configuration file 475, output from the signal conditioning module 465, override values. Window controller 450 and then instructs the PWM 460, to apply a voltage and/or current to electrochromic window 505 to transition to the desired tint level. </p><p id="p0113" num="0113">[0090] In disclosed embodiments, window controller 450 can instruct the PWM 460, to apply a voltage and/or current to electrochromic window 505 to transition it to any one of four or more different tint levels. In disclosed embodiments, electrochromic window 505 can be transitioned to at least eight different tint levels described as: 0 (lightest), 5, 10, 15, 20, 25, 30, and 35 (darkest). The tint levels may linearly correspond to visual transmittance values and solar gain heat coefficient (SGHC) values of light transmitted through the electrochromic window 505. For example, using the above eight tint levels, the lightest tint level of 0 may correspond to an SGHC value of 0.80, the tint level of 5 may correspond to an SGHC value of 0.70, the tint level of 10 may correspond to an SGHC value of 0.60, the tint level of 15 may correspond to an SGHC value of 0.50, the tint level of 20 may correspond to an SGHC value of 0.40, the tint level of 25 may correspond to an SGHC value of 0.30, the tint level of 30 may correspond to an SGHC value of 0.20, and the tint level of 35 (darkest) may correspond to an SGHC value of 0.10. </p><p id="p0114" num="0114">[0091] Window controller 450 or a master controller in communication with the window controller 450 may employ any one or more predictive control logic components to determine a desired tint level based on signals from the exterior sensor 510 and/or other input. The window controller 450 can instruct the PWM 460 to apply a voltage and/or current to electrochromic window 505 to transition it to the desired tint level. </p><p id="p0115" num="0115">[0092] III. An example of Predictive Control Logic </p><p id="p0116" num="0116">[0093] In disclosed embodiments, predictive control logic is used to implement methods of determining and controlling a desired tint level for the electrochromic window 505 or other tintable window that accounts for occupant comfort and/or energy conservation </p><p id="p0117" num="0117">considerations. This predictive control logic may employ one or more logic modules. FIGS. 
<!-- EPO <DP n="23"/>-->
 6A-6C include diagrams depicting some information collected by each of three logic modules A, B, and C of an exemplary control logic of disclosed embodiments. </p><p id="p0118" num="0118">[0094] FIG. 6A shows the penetration depth of direct sunlight into a room 500 through an electrochromic window 505 between the exterior and the interior of a building, which includes the room 500. Penetration depth is a measure of how far direct sunlight will penetrate into the room 500. As shown, penetration depth is measured in a horizontal direction away from the sill (bottom) of window. Generally, the window defines an aperture that provides an acceptance angle for direct sunlight. The penetration depth is calculated based upon the geometry of the window (e.g., window dimensions), its position and orientation in the room, any fins or other exterior shading outside of the window, and the position of the sun (e.g. angle of direct sunlight for a particular time of day and date). </p><p id="p0119" num="0119">Exterior shading to an electrochromic window 505 may be due to any type of structure that can shade the window such as an overhang, a fin, etc. In FIG. 6A, there is an overhang 520 above the electrochromic window 505 that blocks a portion of the direct sunlight entering the room 500 thus shortening the penetration depth. The room 500 also includes a local window controller 450 connected to and configured to control the tint level of the electrochromic window 505. An exterior sensor 510 is located on a vertical surface in the exterior of the building. </p><p id="p0120" num="0120">[0095] Module A can be used to determine a tint level that considers occupant comfort from direct sunlight through the electrochromic window 505 onto an occupant or their activity area. The tint level is determined based on a calculated penetration depth of direct sunlight into the room and the space type (e.g., desk near window, lobby, etc.) in the room at a particular instant in time. In some cases, the tint level may also be based on providing sufficient natural lighting into the room. In many cases, the penetration depth is the value calculated at a time in the future to account for glass transition time. The concern addressed in Module A is that direct sunlight may penetrate so deep into the room 500 as to show directly on an occupant working at a desk or other work surface in a room. Publicly available programs can provide calculation of the sun's position and allow for easy calculation of penetration depth. </p><p id="p0121" num="0121">[0096] FIG. 6A also shows a desk in the room 500 as an example of a space type associated with an activity area (i.e. desk) and location of the activity area (i.e. location of desk). Each space type is associated with different tint levels for occupant comfort. For 
<!-- EPO <DP n="24"/>-->
 example, if the activity is a critical activity such as work in an office being done at a desk or computer, and the desk is located near the window, the desired tint level may be higher than if the desk were further away from the window. As another example, if the activity is non- critical, such as the activity in a lobby, the desired tint level may be lower than for the same space having a desk. </p><p id="p0122" num="0122">[0097] FIG. 6B shows direct sunlight and radiation under clear sky conditions entering the room 500 through the electrochromic window 505. The radiation may be from sunlight scattered by molecules and particles in the atmosphere. Module B determines a tint level based on predicted values of irradiance under clear sky conditions flowing through the electrochromic window 505 under consideration. Various software, such as open source RADIANCE program, can be used to predict clear sky irradiance at a certain latitude, longitude, time of year, and time of day, and for a given window orientation. </p><p id="p0123" num="0123">[0098] FIG. 6C shows radiant light from the sky that is measured in real-time by an exterior sensor 510 to account for light that may be obstructed by or reflected from objects such as buildings or weather conditions (e.g., clouds) that are not accounted for in the clear sky predictions. The tint level determined by Module C is based on the real-time irradiance based on measurements taken by the exterior sensor 510. </p><p id="p0124" num="0124">[0099] The predictive control logic may implement one or more of the logic Modules A, B and C separately for each electrochromic window 505 in the building. Each electrochromic window 505 can have a unique set of dimensions, orientation (e.g., vertical, horizontal, tilted at an angle), position, associated space type, etc. A configuration file with this information and other information can be maintained for each electrochromic window 505. The configuration file 475 may be stored in the computer readable medium 470 of the local window controller 450 of the electrochromic window 505 or in the BMS described later in this disclosure. The configuration file 475 can include information such as a window configuration, an occupancy lookup table, information about an associated datum glass, and/or other data used by the predictive control logic. The window configuration may include information such as the dimensions of the electrochromic window 505, the orientation of the electrochromic window 505, the position of the electrochromic window 505, etc. </p><p id="p0125" num="0125">[00100] A lookup table describes tint levels that provide occupant comfort for certain space types and penetration depths. That is, the tint levels in the occupancy lookup table are designed to provide comfort to occupant(s) that may be in the room 500 from direct sunlight 
<!-- EPO <DP n="25"/>-->
 on the occupant(s) or their workspace. An example of an occupancy lookup table is shown in FIG. 10. </p><p id="p0126" num="0126">[00101] The space type is a measure to determine how much tinting will be required to address occupant comfort concerns for a given penetration depth and/or provide comfortable natural lighting in the room. The space type parameter may take into consideration many factors. Among these factors is the type of work or other activity being conducted in a particular room and the location of the activity. Close work associated with detailed study requiring great attention might be at one space type, while a lounge or a conference room might have a different space type. Additionally, the position of the desk or other work surface in the room with respect to the window is a consideration in defining the space type. For example, the space type may be associated with an office of a single occupant having a desk or other workspace located near the electrochromic window 505. As another example, the space type may be a lobby. </p><p id="p0127" num="0127">[00102] In certain embodiments, one or more modules of the predictive control logic can determine desired tint levels while accounting for energy conservation in addition to occupant comfort. These modules may determine energy savings associated with a particular tint level by comparing the performance of the electrochromic window 505 at that tint level to a datum glass or other standard reference window. The purpose of using this reference window can be to ensure that the predictive control logic conforms to requirements of the municipal building code or other requirements for reference windows used in the locale of the building. Often municipalities define reference windows using conventional low emissivity glass to control the amount of air conditioning load in the building. As an example of how the reference window 505 fits into the predictive control logic, the logic may be designed so that the irradiance coming through a given electrochromic window 505 is never greater than the maximum irradiance coming through a reference window as specified by the respective municipality. In disclosed embodiments, predictive control logic may use the solar heat gain coefficient (SHGC) value of the electrochromic window 505 at a particular tint level and the SHGC of the reference window to determine the energy savings of using the tint level. </p><p id="p0128" num="0128">Generally, the value of the SHGC is the fraction of incident light of all wavelengths transmitted through the window. Although a datum glass is described in many embodiments, other standard reference windows can be used. Generally the SHGC of the reference window (e.g., datum glass) is a variable that can be different for different geographical locations and 
<!-- EPO <DP n="26"/>-->
 window orientations, and is based on code requirements specified by the respective municipality. </p><p id="p0129" num="0129">[00103] Generally, buildings are designed to have an HVAC with the capacity to fulfill the maximum expected heating and/or air-conditioning loads required at any given instance. The calculation of required capacity may take into consideration the datum glass or reference window required in a building at the particular location where the building is being constructed. Therefore, it is important that the predictive control logic meet or exceed the functional requirements of the datum glass in order to allow building designers to confidently determine how much HVAC capacity to put into a particular building. Since the predictive control logic can be used to tint the window to provide additional energy savings over the datum glass, the predictive control logic could be useful in allowing building designers to have a lower HVAC capacity than would have been required using the datum glass specified by the codes and standards. </p><p id="p0130" num="0130">[00104] Particular embodiments described herein assume that energy conservation is achieved by reducing air conditioning load in a building. Therefore, many of the </p><p id="p0131" num="0131">implementations attempt to achieve the maximum tinting possible, while accounting for occupant comfort level and perhaps lighting load in a room having with the window under consideration. However, in some climates, such as those at far northern and for southern latitudes, heating may be more of a concern than air conditioning. Therefore, the predictive control logic can be modified, specifically, road reversed in some matters, so that less tinting occurs in order to ensure that the heating load of the building is reduced. </p><p id="p0132" num="0132">[00105] In certain implementations, the predictive control logic has only two independent variables that can be controlled by an occupant (end user), building designer, or building operator. These are the space types for a given window and the datum glass associated with the given window. Often the datum glass is specified when the predictive control logic is implemented for a given building. The space type can vary, but is typically static. In certain implementations, the space type may be part of the configuration file maintained by the building or stored in the local window controller 450. In some cases, the configuration file may be updated to account for various changes in the building. For example, if there is a change in the space type (e.g., desk moved in an office, addition of desk, lobby changed into office area, wall moved, etc.) in the building, an updated configuration file with a modified occupancy lookup table may be stored in the computer readable medium 470. As another 
<!-- EPO <DP n="27"/>-->
 example, if an occupant is hitting manual override repeatedly, then the configuration file may be updated to reflect the manual override. </p><p id="p0133" num="0133">[00106] FIG. 7 is a flowchart showing predictive control logic for a method of controlling one or more electrochromic windows 505 in a building, according to embodiments. The predictive control logic uses one or more of the Modules A, B, and C to calculate tint levels for the window(s) and sends instructions to transition the window(s). The calculations in the control logic are run 1 to n times at intervals timed by the timer at step 610. For example, the tint level can be recalculated 1 to n times by one or more of the Modules A, B, and C and calculated for instances in time = ti, Ϊ2. . . t<sub>n</sub>. n is the number of recalculations performed and n can be at least 1. The logic calculations can be done at constant time intervals in some cases. In one cases, the logic calculations may be done every 2 to 5 minutes. However, tint transition for large pieces of electrochromic glass can take up to 30 minutes or more. For these large windows, calculations may be done on a less frequent basis such as every 30 minutes. </p><p id="p0134" num="0134">[00107] At step 620, logic Modules A, B, and C perform calculations to determine a tint level for each electrochromic window 505 at a single instant in time tj. These calculations can be performed by the window controller 450. In certain embodiments, the predictive control logic predictively calculates how the window should transition in advance of the actual transition. In these cases, the calculations in Modules A, B, and C can be based on a future time around or after transition is complete. In these cases, the future time used in the calculations may be a time in the future that is sufficient to allow the transition to be completed after receiving the tint instructions. In these cases, the controller can send tint instructions in the present time in advance of the actual transition. By the completion of the transition, the window will have transitioned to a tint level that is desired for that time. </p><p id="p0135" num="0135">[00108] At step 630, the predictive control logic allows for certain types of overrides that disengage the algorithm at Modules A, B, and C and define override tint levels at step 640 based on some other consideration. One type of override is a manual override. This is an override implemented by an end user who is occupying a room and determines that a particular tint level (override value) is desirable. There may be situations where the user's manual override is itself overridden. An example of an override is a high demand (or peak load) override, which is associated with a requirement of a utility that energy consumption in the building be reduced. For example, on particularly hot days in large metropolitan areas, it 
<!-- EPO <DP n="28"/>-->
 may be necessary to reduce energy consumption throughout the municipality in order to not overly tax the municipality's energy generation and delivery systems. In such cases, the building may override the tint level from the predictive control logic described herein to ensure that all windows have a particularly high level of tinting. Another example of an override may be if there is no occupant in the room example weekend sin a commercial office building.. In these cases, the building may disengage one or more Modules that relate to occupant comfort and all the windows may have a high level of tinting in cold weather and low level of tinting in warm weather. </p><p id="p0136" num="0136">[00109] At step 650, the tint levels are transmitted over a network to electrochromic device(s) in one or more electrochromic windows 505 in the building. In certain </p><p id="p0137" num="0137">embodiments, the transmission of tint levels to all windows of a building may be </p><p id="p0138" num="0138">implemented with efficiency in mind. For example, if the recalculation of tint level suggests that no change in tint from the current tint level is required, then there is no transmission of instructions with an updated tint level. As another example, the building may be divided into zones based on window size. The predictive control logic may recalculate tint levels for zones with smaller windows more frequently than for zones with larger windows. </p><p id="p0139" num="0139">[00110] In some embodiments, the logic in FIG. 7 for implementing the control methods for multiple electrochromic windows 505 in an entire building can be on a single device, for example, a single master window controller. This device can perform the calculations for each and every window in the building and also provide an interface for transmitting tint levels to one or more electrochromic devices in individual electrochromic windows 505. </p><p id="p0140" num="0140">[00111] Also, there may be certain adaptive components of the predictive control logic of embodiments. For example, the predictive control logic may determine how an end user (e.g. occupant) tries to override the algorithm at particular times of day and makes use of this information in a more predictive manner to determine desired tint levels. In one case, the end user may be using a wall switch to override the tint level provided by the predictive logic at a certain time each day to an override value. The predictive control logic may receive information about these instances and change the predictive control logic to change the tint level to the override value at that time of day. </p><p id="p0141" num="0141">[00112] FIG. 8 is a diagram showing a particular implementation of block 620 from FIG. 7. This diagram shows a method of performing all three Modules A, B, and C in sequence to calculate a final tint level of a particular electrochromic window 505 for a single instant in 
<!-- EPO <DP n="29"/>-->
 time tj. The final tint level may be the maximum permissible transmissivity of the window under consideration. FIG. 8 also includes some exemplary inputs and outputs of Modules A, B, and C. The calculations in Modules A, B, and C are performed by window controller 450 in local window controller 450 in embodiments. In other embodiments, one or more of the modules can be performed by another processor. Although illustrated embodiments show all three Modules A, B, and C being used, other embodiments may use one or more of the Modules A, B, and C or may use additional modules. </p><p id="p0142" num="0142">[00113] At step 700, window controller 450 uses Module A to determine a tint level for occupant comfort to prevent direct glare from sunlight penetrating the room 500. Window controller 450 uses Module A to calculate the penetration depth of direct sunlight into the room 500 based on the sun's position in the sky and the window configuration from the configuration file. The position of the sun is calculated based on the latitude and longitude of the building and the time of day and date. The occupancy lookup table and space type are input from a configuration file for the particular window. Module A outputs the Tint level from A to Module B. </p><p id="p0143" num="0143">[00114] The goal of Module A is to ensure that direct sunlight or glare does not strike the occupant or his or her workspace. The tint level from Module A is determined to accomplish this purpose. Subsequent calculations of tint level in Modules B and C can reduce energy consumption and may require even greater tint. However, if subsequent calculations of tint level based on energy consumption suggest less tinting than required to avoid interfering with the occupant, the predictive logic prevents the calculated greater level of transmissivity from being executed to assure occupant comfort. </p><p id="p0144" num="0144">[00115] At step 800, the tint level calculated in Module A is input into Module B. A tint level is calculated based on predictions of irradiance under clear sky conditions (clear sky irradiance). Window controller 450 uses Module B to predict clear sky irradiance for the electrochromic window 505 based on window orientation from the configuration file and based on latitude and longitude of the building. These predictions are also based on a time of day and date. Publicly available software such as the RADIANCE program, which is an open- source program, can provide the calculations for predicting clear sky irradiance. The SHGC of the datum glass is also input into Module B from the configuration file. Window controller 450 uses Module B to determine a tint level that is darker than the tint level in A and transmits less heat than the datum glass is predicted to transmit under maximum clear sky 
<!-- EPO <DP n="30"/>-->
 irradiance. Maximum clear sky irradiance is the highest level of irradiance for all times predicted for clear sky conditions. </p><p id="p0145" num="0145">[00116] At step 900, a tint level from B and predicted clear sky irradiance are input to Module C. Real-time irradiance values are input to Module C based on measurements from an exterior sensor 510. Window controller 450 uses Module C to calculate irradiance transmitted into the room if the window were tinted to the Tint level from Module B under clear sky conditions. Window controller 450 uses Module C to find the appropriate tint level where the actual irradiance through the window with this tint level is less than or equal to the irradiance through the window with the Tint level from Module B. The tint level determined in Module C is the final tint level. </p><p id="p0146" num="0146">[00117] Much of the information input to the predictive control logic is determined from fixed information about the latitude and longitude, time and date. This information describes where the sun is with respect to the building, and more particularly with respect to the window for which the predictive control logic is being implemented. The position of the sun with respect to the window provides information such as the penetration depth of direct sunlight into the room assisted with the window. It also provides an indication of the maximum irradiance or solar radiant energy flux coming through the window. This calculated level of irradiance can be modified by sensor input which might indicate that there is a reduction from the maximum amount of irradiance. Again, such reduction might be caused by a cloud or other obstruction between the window and the sun. </p><p id="p0147" num="0147">[00118] FIG. 9 is a flowchart showing details of step 700 of FIG. 8. At step 705, Module A begins. At step 710, the window controller 450 uses Module A to calculate the position of the sun for the latitude and longitude coordinates of the building and the date and time of day of a particular instant in time, . The latitude and longitude coordinates may be input from the configuration file. The date and time of day may be based on the current time provided by the timer. The sun position is calculated at the particular instant in time, <sub>,</sub> which may be in the future in some cases. In other embodiments, the position of the sun is calculated in another component (e.g., module) of the predictive control logic. </p><p id="p0148" num="0148">[00119] At step 720, window controller 450 uses Module A to calculate the penetration depth of direct sunlight into the room 500 at the particular instant in time used in step 710. Module A calculates the penetration depth based on the calculated position of the sun and window configuration information including the position of the window, dimensions of the 
<!-- EPO <DP n="31"/>-->
 window, orientation of the window (i.e. direction facing), and the details of any exterior shading. The window configuration information is input from the configuration file associated with the electrochromic window 505. For example, Module A can be used to calculate the penetration depth of the vertical window shown in FIG. 6A by first calculating the angle 6*of the direct sunlight based on the position of the sun calculated at the particular instant in time. The penetration depth can be determined based on calculated angle Θ and the location of the lintel (top of the window). </p><p id="p0149" num="0149">[00120] At step 730, a tint level is determined that will provide occupant comfort for the penetration depth calculated in step 720. The occupancy lookup table is used to find a desired tint level for the space type associated with the window, for the calculated penetration depth, and for the acceptance angle of the window. The space type and occupancy lookup table are provided as input from the configuration file for the particular window. </p><p id="p0150" num="0150">[00121] An example of an occupancy lookup table is provided in FIG. 10. The values in the table are in terms of a Tint level and associated SGHC values in parenthesis. FIG. 10 shows the different tint levels (SGHC values) for different combinations of calculated penetration values and space types. The table is based on eight tint levels including 0 (lightest), 5, 10, 15, 20, 25, 30, and 35 (lightest). The lightest tint level of 0 corresponds to an SGHC value of 0.80, the tint level of 5 corresponds to an SGHC value of 0.70, the tint level of 10 corresponds to an SGHC value of 0.60, the tint level of 15 corresponds to an SGHC value of 0.50, the tint level of 20 corresponds to an SGHC value of 0.40, the tint level of 25 corresponds to an SGHC value of 0.30, the tint level of 30 corresponds to an SGHC value of 0.20, and the tint level of 35 (darkest) corresponds to an SGHC value of 0.10. The illustrated example includes three space types: Desk 1, Desk 2, and Lobby and six penetration depths. FIG. 11A shows the location of Desk 1 in the room 500. FIG. 11B shows the location of Desk 2 in the room 500. As shown in the occupancy lookup table of FIG. 10, the tint levels for Desk 1 close to the window are higher than the tint levels for Desk 2 far from window to prevent glare when the desk is closer to the window. Occupancy lookup tables with other values may be used in other embodiments. For example, one other occupancy lookup table may include only four tint levels associated with the penetration values. Another example of an occupancy table with four tint levels associated with four penetration depths is shown in FIG. 20. 
<!-- EPO <DP n="32"/>-->
 [00122] FIG. 12 is a diagram showing further detail of step 800 of FIG. 8. At step 805,</p><p id="p0151" num="0151">Module B begins. At step 810, Module B can be used to predict the irradiance at the window under clear sky conditions at t,. This clear sky irradiance at t, is predicted based on the latitude and longitude coordinates of the building and the window orientation (i.e. direction the window is facing). At step 820, the Maximum Clear Sky Irradiance incident the window at all times is predicted. These predicted values of clear sky irradiance can be calculated using open source software, such as Radiance. </p><p id="p0152" num="0152">[00123] At step 830, the window controller 450 uses Module B to determine the maximum amount of irradiance that would be transmitted through a datum glass into the room 500 at that time (i.e. determines Maximum Datum Inside Irradiance). The calculated Maximum Clear Sky Irradiance from step 820 and the datum glass SHGC value from the configuration file can be used to calculate the Maximum Irradiance inside the space using the equation: Maximum Datum Inside Irradiance = Datum Glass SHGC x Maximum Clear Sky Irradiance. </p><p id="p0153" num="0153">[00124] At step 840, window controller 450 uses Module B to determine inside irradiance into the room 500 having a window with the current tint level based on the equation. The calculated Clear Sky Irradiance from step 810 and the SHGC value associated with the current tint level can be used to calculate the value of the inside irradiance using the equation: Tint level Irradiance = Tint level SHGC x Clear Sky Irradiance. </p><p id="p0154" num="0154">[00125] In one embodiment, one or more the steps 705, 810 and 820 may be performed by a solar position calculator separate from Modules A and B. A solar position calculator refers to logic that determines the position of the sun at a particular future time and makes predictive determinations (e.g., predicts clear sky irradiance) based on the sun's position at that future time. The solar position calculator may perform one or more steps of the methods disclosed herein. The solar position calculator may be a portion of the predictive control logic performed by one or more of the components of the master window controller (e.g., master window controller 1402 depicted in FIG.17). For example, the solar position calculator may be part of the predictive control logic shown in FIG. 18 implemented by the window controller 1410 (shown in FIG. 17). </p><p id="p0155" num="0155">[00126] At step 850, window controller 450 uses Module B to determine whether the inside irradiance based on the current tint level is less than or equal to the maximum datum inside irradiance and the tint level is darker than the tint level from A. If the determination is NO, the current tint level is incrementally increased (darkened) at step 860 and the inside 
<!-- EPO <DP n="33"/>-->
 irradiance is recalculated at step 840. If the determination is YES at step 850, Module B ends. </p><p id="p0156" num="0156">[00127] FIG. 13 is a diagram showing further detail of step 900 of FIG. 8. At step 905,</p><p id="p0157" num="0157">Module C begins. A tint level from B and predicted clear sky irradiance at the instant in time is input from Module B. Real-time irradiance values are input to Module C based on measurements from an exterior sensor 510. </p><p id="p0158" num="0158">[00128] At step 910, window controller 450 uses Module C to calculate irradiance transmitted into the room through an electrochromic window 505 tinted to the Tint level from B under clear sky conditions. This Calculated Inside Irradiance can be determined using the equation: Calculated Inside Irradiance = SHGC of Tint Level from B x Predicted Clear Sky Irradiance from B. </p><p id="p0159" num="0159">[00129] At step 920, window controller 450 uses Module C to find the appropriate tint level where the actual irradiance (=SR x Tint level SHGC) through the window with this tint level is less than or equal to the irradiance through the window with the Tint level from B (i.e. Actual Inside Irradiance &lt; Calculated Inside Irradiance). In some cases, the module logic starts with the tint level from B and incrementally increases the tint level until the Actual Inside Irradiance &lt; Calculated Inside Irradiance. The tint level determined in Module C is the final tint level. This final tint level may be transmitted in tint instructions over the network to the electrochromic device(s) in the electrochromic window 505. </p><p id="p0160" num="0160">[00130] Figurel4 is a diagram includes another implementation of block 620 from FIG. 7. This diagram shows a method of performing Modules A, B, and C of embodiments. In this method, the position of the sun is calculated based on the latitude and longitude coordinates of the building for a single instant in time . The penetration depth is calculated in Module A based on the window configuration including a position of the window, dimensions of the window, orientation of the window, and information about any external shading. Module A uses a lookup table to determine the tint level from A based on the calculated penetration and the space type. The tint level from A is then input into Module B. </p><p id="p0161" num="0161">[00131] A program such as the open source program Radiance, is used to determine clear sky irradiance based on window orientation and latitude and longitude coordinates of the building for both a single instant in time and a maximum value for all times. The datum glass SHGC and calculated maximum clear sky irradiance are input into Module B. Module 
<!-- EPO <DP n="34"/>-->
 B increases the tint level calculated in Module A in steps and picks a tint level where the Inside radiation is less than or equal to the Datum Inside Irradiance where: Inside Irradiance = Tint level SHGC x Clear Sky Irradiance and Datum Inside Irradiance = Datum SHGC x Maximum Clear Sky Irradiance. However, when Module A calculates the maximum tint of the glass, module B doesn't change the tint to make it lighter. The tint level calculated in B is then input into Module C. The predicted clear sky irradiance is also input into Module C. </p><p id="p0162" num="0162">[00132] Module C calculates the inside irradiance in the room with an electrochromic window 505 having the tint level from B using the equation: Calculated Inside Irradiance = SHGC of Tint Level from B x Predicted Clear Sky Irradiance from B. Module C then finds the appropriate tint level that meets the condition where actual inside irradiance is less than or equal to the Calculated Inside Irradiance. The actual inside irradiance is determined using the equation: Actual Inside Irradiance = SR x Tint level SHGC. The tint level determined by Module C is the final tint level in tint instructions sent to the electrochromic window 505. </p><p id="p0163" num="0163">[00133] IV. Building Management Systems (BMSs) </p><p id="p0164" num="0164">[00134] The window controllers described herein also are suited for integration with a BMS. A BMS is a computer-based control system installed in a building that monitors and controls the building's mechanical and electrical equipment such as ventilation, lighting, power systems, elevators, fire systems, and security systems. A BMS consists of hardware, including interconnections by communication channels to a computer or computers, and associated software for maintaining conditions in the building according to preferences set by the occupants and/or by the building manager. For example, a BMS may be implemented using a local area network, such as Ethernet. The software can be based on, for example, internet protocols and/or open standards. One example of software is software from Tridium, Inc. (of Richmond, Virginia). One communications protocol commonly used with a BMS is BACnet (building automation and control networks). </p><p id="p0165" num="0165">[00135] A BMS is most common in a large building, and typically functions at least to control the environment within the building. For example, a BMS may control temperature, carbon dioxide levels, and humidity within a building. Typically, there are many mechanical devices that are controlled by a BMS such as heaters, air conditioners, blowers, vents, and the like. To control the building environment, a BMS may turn on and off these various devices under defined conditions. A core function of a typical modern BMS is to maintain a comfortable environment for the building's occupants while minimizing heating and cooling 
<!-- EPO <DP n="35"/>-->
 costs/demand. Thus, a modern BMS is used not only to monitor and control, but also to optimize the synergy between various systems, for example, to conserve energy and lower building operation costs. </p><p id="p0166" num="0166">[00136] In some embodiments, a window controller is integrated with a BMS, where the window controller is configured to control one or more electrochromic windows 505 or other tintable windows. In one embodiment, the one or more electrochromic windows include at least one all solid state and inorganic electrochromic device. In one embodiment, the one or more electrochromic windows include only all solid state and inorganic windows. In one embodiment, the electrochromic windows are multistate electrochromic windows, as described in U.S. Patent Application, serial number 12/851,514, filed on August 5, 2010, and entitled "Multipane Electrochromic Windows." </p><p id="p0167" num="0167">[00137] FIG. 15 depicts a schematic diagram of an embodiment of a BMS 1100, that manages a number of systems of a building 1101, including security systems, </p><p id="p0168" num="0168">heating/ventilation/air conditioning (HVAC), lighting of the building, power systems, elevators, fire systems, and the like. Security systems may include magnetic card access, turnstiles, solenoid driven door locks, surveillance cameras, burglar alarms, metal detectors, and the like. Fire systems may include fire alarms and fire suppression systems including a water plumbing control. Lighting systems may include interior lighting, exterior lighting, emergency warning lights, emergency exit signs, and emergency floor egress lighting. Power systems may include the main power, backup power generators, and uninterrupted power source (UPS) grids. </p><p id="p0169" num="0169">[00138] Also, BMS 1100 manages a master window controller 1102. In this example, master window controller 1102 is depicted as a distributed network of window controllers including a master network controller, 1103, intermediate network controllers, 1105a and 1105b, and end or leaf controllers 1110. End or leaf controllers 1110 may be similar to window controller 450 described with respect to FIG. 4. For example, master network controller 1103 may be in proximity to the BMS 1100, and each floor of building 1101 may have one or more intermediate network controllers 1105a and 1105b, while each window of the building has its own end controller 1110. In this example, each of controllers 1110 controls a specific electrochromic window of building 1101. </p><p id="p0170" num="0170">[00139] Each of controllers 1110 can be in a separate location from the electrochromic window that it controls, or be integrated into the electrochromic window. For simplicity, only 
<!-- EPO <DP n="36"/>-->
 ten electrochromic windows of building 1101 are depicted as controlled by master window controller 1102. In a typical setting there may be a large number of electrochromic windows in a building controlled by master window controller 1102. Master window controller 1102 need not be a distributed network of window controllers. For example, a single end controller which controls the functions of a single electrochromic window also falls within the scope of the embodiments disclosed herein, as described above. Advantages and features of incorporating electrochromic window controllers as described herein with BMSs are described below in more detail and in relation to FIG. 15, where appropriate. </p><p id="p0171" num="0171">[00140] One aspect of the disclosed embodiments is a BMS including a multipurpose electrochromic window controller as described herein. By incorporating feedback from a electrochromic window controller, a BMS can provide, for example, enhanced: 1) environmental control, 2) energy savings, 3) security, 4) flexibility in control options, 5) improved reliability and usable life of other systems due to less reliance thereon and therefore less maintenance thereof, 6) information availability and diagnostics, 7) effective use of staff, and various combinations of these, because the electrochromic windows can be automatically controlled. </p><p id="p0172" num="0172">[00141] In some embodiments, a BMS may not be present or a BMS may be present but may not communicate with a master network controller or communicate at a high level with a master network controller. In some embodiments, a master network controller can provide, for example, enhanced: 1) environmental control, 2) energy savings, 3) flexibility in control options, 4) improved reliability and usable life of other systems due to less reliance thereon and therefore less maintenance thereof, 5) information availability and diagnostics, 6) effective use of staff, and various combinations of these, because the electrochromic windows can be automatically controlled. In these embodiments, maintenance on the BMS would not interrupt control of the electrochromic windows. </p><p id="p0173" num="0173">[00142] FIG. 16 depicts a block diagram of an embodiment of a building network 1200 for a building. As noted above, network 1200 may employ any number of different </p><p id="p0174" num="0174">communication protocols, including BACnet. As shown, building network 1200 includes a master network controller 1205, a lighting control panel 1210, a building management system (BMS) 1215, a security control system, 1220, and a user console, 1225. These different controllers and systems in the building may be used to receive input from and/or control a 
<!-- EPO <DP n="37"/>-->
 HVAC system 1230, lights 1235, security sensors 1240, door locks 1245, cameras 1250, and tintable windows 1255, of the building. </p><p id="p0175" num="0175">[00143] Master network controller 1205 may function in a similar manner as master network controller 1103 described with respect to FIG. 15. Lighting control panel 1210 may include circuits to control the interior lighting, the exterior lighting, the emergency warning lights, the emergency exit signs, and the emergency floor egress lighting. Lighting control panel 1210 also may include occupancy sensors in the rooms of the building. BMS 1215 may include a computer server that receives data from and issues commands to the other systems and controllers of network 1200. For example, BMS 1215 may receive data from and issue commands to each of the master network controller 1205, lighting control panel 1210, and security control system 1220. Security control system 1220 may include magnetic card access, turnstiles, solenoid driven door locks, surveillance cameras, burglar alarms, metal detectors, and the like. User console 1225 may be a computer terminal that can be used by the building manager to schedule operations of, control, monitor, optimize, and troubleshoot the different systems of the building. Software from Tridium, Inc. may generate visual representations of data from different systems for user console 1225. </p><p id="p0176" num="0176">[00144] Each of the different controls may control individual devices/apparatus. Master network controller 1205 controls windows 1255. Lighting control panel 1210 controls lights 1235. BMS 1215 may control HVAC 1230. Security control system 1220 controls security sensors 1240, door locks 1245, and cameras 1250. Data may be exchanged and/or shared between all of the different devices/apparatus and controllers that are part of building network 1200. </p><p id="p0177" num="0177">[00145] In some cases, the systems of BMS 1100 or building network 1200 may run according to daily, monthly, quarterly, or yearly schedules. For example, the lighting control system, the window control system, the HVAC, and the security system may operate on a 24 hour schedule accounting for when people are in the building during the work day. At night, the building may enter an energy savings mode, and during the day, the systems may operate in a manner that minimizes the energy consumption of the building while providing for occupant comfort. As another example, the systems may shut down or enter an energy savings mode over a holiday period. </p><p id="p0178" num="0178">[00146] The scheduling information may be combined with geographical information. Geographical information may include the latitude and longitude of the building. 
<!-- EPO <DP n="38"/>-->
 Geographical information also may include information about the direction that each side of the building faces. Using such information, different rooms on different sides of the building may be controlled in different manners. For example, for east facing rooms of the building in the winter, the window controller may instruct the windows to have no tint in the morning so that the room warms up due to sunlight shining in the room and the lighting control panel may instruct the lights to be dim because of the lighting from the sunlight. The west facing windows may be controllable by the occupants of the room in the morning because the tint of the windows on the west side may have no impact on energy savings. However, the modes of operation of the east facing windows and the west facing windows may switch in the evening (e.g., when the sun is setting, the west facing windows are not tinted to allow sunlight in for both heat and lighting). </p><p id="p0179" num="0179">[00147] Described below is an example of a building, for example, like building 1101 in FIG. 15, including a building network or a BMS, tintable windows for the exterior windows of the building (i.e., windows separating the interior of the building from the exterior of the building), and a number of different sensors. Light from exterior windows of a building generally has an effect on the interior lighting in the building about 20 feet or about 30 feet from the windows. That is, space in a building that is more that about 20 feet or about 30 feet from an exterior window receives little light from the exterior window. Such spaces away from exterior windows in a building are lit by lighting systems of the building. </p><p id="p0180" num="0180">[00148] Further, the temperature within a building may be influenced by exterior light and/or the exterior temperature. For example, on a cold day and with the building being heated by a heating system, rooms closer to doors and/or windows will lose heat faster than the interior regions of the building and be cooler compared to the interior regions. </p><p id="p0181" num="0181">[00149] For exterior sensors, the building may include exterior sensors on the roof of the building. Alternatively, the building may include an exterior sensor associated with each exterior window (e.g., as described in relation to FIG. 5, room 500) or an exterior sensor on each side of the building. An exterior sensor on each side of the building could track the irradiance on a side of the building as the sun changes position throughout the day. </p><p id="p0182" num="0182">[00150] Regarding the methods described with respect to FIGS. 7, 8, 9, 12, 13, and 14, when a window controller is integrated into a building network or a BMS, outputs from exterior sensors 510 may be input to a network of BMS and provided as input to the local window controller 450. For example, in some embodiments, output signals from any two or 
<!-- EPO <DP n="39"/>-->
 more sensors are received. In some embodiments, only one output signal is received, and in some other embodiments, three, four, five, or more outputs are received. These output signals may be received over a building network or a BMS. </p><p id="p0183" num="0183">[00151] In some embodiments, the output signals received include a signal indicating energy or power consumption by a heating system, a cooling system, and/or lighting within the building. For example, the energy or power consumption of the heating system, the cooling system, and/or the lighting of the building may be monitored to provide the signal indicating energy or power consumption. Devices may be interfaced with or attached to the circuits and/or wiring of the building to enable this monitoring. Alternatively, the power systems in the building may be installed such that the power consumed by the heating system, a cooling system, and/or lighting for an individual room within the building or a group of rooms within the building can be monitored. </p><p id="p0184" num="0184">[00152] Tint instructions can be provided to change to tint of the tintable window to the determined level of tint. For example, referring to FIG. 15, this may include master network controller 1103 issuing commands to one or more intermediate network controllers 1105a and 1105b, which in turn issue commands to end controllers 1110 that control each window of the building. End controllers 1100 may apply voltage and/or current to the window to drive the change in tint pursuant to the instructions. </p><p id="p0185" num="0185">[00153] In some embodiments, a building including electrochromic windows and a BMS may be enrolled in or participate in a demand response program run by the utility or utilities providing power to the building. The program may be a program in which the energy consumption of the building is reduced when a peak load occurrence is expected. The utility may send out a warning signal prior to an expected peak load occurrence. For example, the warning may be sent on the day before, the morning of, or about one hour before the expected peak load occurrence. A peak load occurrence may be expected to occur on a hot summer day when cooling systems/air conditioners are drawing a large amount of power from the utility, for example. The warning signal may be received by the BMS of the building or by window controllers configured to control the electrochromic windows in the building. This warning signal can be an override mechanism that disengages the Modules A, B, and C as shown in FIG. 7. The BMS can then instruct the window controller(s) to transition the appropriate electrochromic device in the electrochromic windows 505 to a dark tint level aid 
<!-- EPO <DP n="40"/>-->
 in reducing the power draw of the cooling systems in the building at the time when the peak load is expected. </p><p id="p0186" num="0186">[00154] In some embodiments, tintable windows for the exterior windows of the building (i.e., windows separating the interior of the building from the exterior of the building), may be grouped into zones, with tintable windows in a zone being instructed in a similar manner. For example, groups of electrochromic windows on different floors of the building or different sides of the building may be in different zones. For example, on the first floor of the building, all of the east facing electrochromic windows may be in zone 1 , all of the south facing electrochromic windows may be in zone 2, all of the west facing electrochromic windows may be in zone 3, and all of the north facing electrochromic windows may be in zone 4. As another example, all of the electrochromic windows on the first floor of the building may be in zone 1, all of the electrochromic windows on the second floor may be in zone 2, and all of the electrochromic windows on the third floor may be in zone 3. As yet another example, all of the east facing electrochromic windows may be in zone 1 , all of the south facing electrochromic windows may be in zone 2, all of the west facing electrochromic windows may be in zone 3, and all of the north facing electrochromic windows may be in zone 4. As yet another example, east facing electrochromic windows on one floor could be divided into different zones. Any number of tintable windows on the same side and/or different sides and/or different floors of the building may be assigned to a zone. </p><p id="p0187" num="0187">[00155] In some embodiments, electrochromic windows in a zone may be controlled by the same window controller. In some other embodiments, electrochromic windows in a zone may be controlled by different window controllers, but the window controllers may all receive the same output signals from sensors and use the same function or lookup table to determine the level of tint for the windows in a zone. </p><p id="p0188" num="0188">[00156] In some embodiments, electrochromic windows in a zone may be controlled by a window controller or controllers that receive an output signal from a transmissivity sensor. In some embodiments, the transmissivity sensor may be mounted proximate the windows in a zone. For example, the transmissivity sensor may be mounted in or on a frame containing an IGU (e.g., mounted in or on a mullion, the horizontal sash of a frame) included in the zone. In some other embodiments, electrochromic windows in a zone that includes the windows on a single side of the building may be controlled by a window controller or controllers that receive an output signal from a transmissivity sensor. 
<!-- EPO <DP n="41"/>-->
 [00157] In some embodiments, a sensor (e.g., photosensor) may provide an output signal to a window controller to control the electrochromic windows 505 of a first zone (e.g., a master control zone). The window controller may also control the electrochromic windows 505 in a second zone (e.g., a slave control zone) in the same manner as the first zone. In some other embodiments, another window controller may control the electrochromic windows 505 in the second zone in the same manner as the first zone. </p><p id="p0189" num="0189">[00158] In some embodiments, a building manager, occupants of rooms in the second zone, or other person may manually instruct (using a tint or clear command or a command from a user console of a BMS, for example) the electrochromic windows in the second zone (i.e., the slave control zone) to enter a tint level such as a colored state (level) or a clear state. In some embodiments, when the tint level of the windows in the second zone is overridden with such a manual command, the electrochromic windows in the first zone (i.e., the master control zone) remain under control of the window controller receiving output from the transmissivity sensor. The second zone may remain in a manual command mode for a period of time and then revert back to be under control of the window controller receiving output from the transmissivity sensor. For example, the second zone may stay in a manual mode for one hour after receiving an override command, and then may revert back to be under control of the window controller receiving output from the transmissivity sensor. </p><p id="p0190" num="0190">[00159] In some embodiments, a building manager, occupants of rooms in the first zone, or other person may manually instruct (using a tint command or a command from a user console of a BMS, for example) the windows in the first zone (i.e., the master control zone) to enter a tint level such as a colored state or a clear state. In some embodiments, when the tint level of the windows in the first zone is overridden with such a manual command, the electrochromic windows in the second zone (i.e., the slave control zone) remain under control of the window controller receiving outputs from the exterior sensor. The first zone may remain in a manual command mode for a period of time and then revert back to be under control of window controller receiving output from the transmissivity sensor. For example, the first zone may stay in a manual mode for one hour after receiving an override command, and then may revert back to be under control of the window controller receiving output from the transmissivity sensor. In some other embodiments, the electrochromic windows in the second zone may remain in the tint level that they are in when the manual override for the first zone is received. The first zone may remain in a manual command mode for a period of time and then both the 
<!-- EPO <DP n="42"/>-->
 first zone and the second zone may revert back to be under control of the window controller receiving output from the transmissivity sensor. </p><p id="p0191" num="0191">[00160] Any of the methods described herein of control of a tintable window, regardless of whether the window controller is a standalone window controller or is interfaced with a building network, may be used control the tint of a tintable window. </p><p id="p0192" num="0192">[00161] Wireless or Wired Communication </p><p id="p0193" num="0193">[00162] In some embodiments, window controllers described herein include components for wired or wireless communication between the window controller, sensors, and separate communication nodes. Wireless or wired communications may be accomplished with a communication interface that interfaces directly with the window controller. Such interface could be native to the microprocessor or provided via additional circuitry enabling these functions. </p><p id="p0194" num="0194">[00163] A separate communication node for wireless communications can be, for example, another wireless window controller, an end, intermediate, or master window controller, a remote control device, or a BMS. Wireless communication is used in the window controller for at least one of the following operations: programming and/or operating the electrochromic window 505, collecting data from the EC window 505from the various sensors and protocols described herein, and using the electrochromic window 505 as a relay point for wireless communication. Data collected from electrochromic windows 505 also may include count data such as number of times an EC device has been activated, efficiency of the EC device over time, and the like. These wireless communication features is described in more detail below. </p><p id="p0195" num="0195">[00164] In one embodiment, wireless communication is used to operate the associated electrochromic windows 505, for example, via an infrared (IR), and/or radio frequency (RF) signal. In certain embodiments, the controller will include a wireless protocol chip, such as Bluetooth, EnOcean, WiFi, Zigbee, and the like. Window controllers may also have wireless communication via a network. Input to the window controller can be manually input by an end user at a wall switch, either directly or via wireless communication, or the input can be from a BMS of a building of which the electrochromic window is a component. </p><p id="p0196" num="0196">[00165] In one embodiment, when the window controller is part of a distributed network of controllers, wireless communication is used to transfer data to and from each of a plurality of 
<!-- EPO <DP n="43"/>-->
 electrochromic windows via the distributed network of controllers, each having wireless communication components. For example, referring again to FIG. 15, master network controller 1103, communicates wirelessly with each of intermediate network controllers 1105a and 1105b, which in turn communicate wirelessly with end controllers 1110, each associated with an electrochromic window. Master network controller 1103 may also communicate wirelessly with the BMS 1100. In one embodiment, at least one level of communication in the window controller is performed wirelessly. </p><p id="p0197" num="0197">[00166] In some embodiments, more than one mode of wireless communication is used in the window controller distributed network. For example, a master window controller may communicate wirelessly to intermediate controllers via WiFi or Zigbee, while the intermediate controllers communicate with end controllers via Bluetooth, Zigbee, EnOcean, or other protocol. In another example, window controllers have redundant wireless communication systems for flexibility in end user choices for wireless communication. </p><p id="p0198" num="0198">[00167] Wireless communication between, for example, master and/or intermediate window controllers and end window controllers offers the advantage of obviating the installation of hard communication lines. This is also true for wireless communication between window controllers and BMS. In one aspect, wireless communication in these roles is useful for data transfer to and from electrochromic windows for operating the window and providing data to, for example, a BMS for optimizing the environment and energy savings in a building. Window location data as well as feedback from sensors are synergized for such optimization. For example, granular level (window-by-window) microclimate information is fed to a BMS in order to optimize the building's various environments. </p><p id="p0199" num="0199">[00168] VI. Example of System for controlling functions of tintable windows </p><p id="p0200" num="0200">[00169] FIG. 17 is a block diagram of components of a system 1400 for controlling functions (e.g., transitioning to different tint levels) of one or more tintable windows of a building (e.g., building 1101 shown in FIG. 15), according to embodiments. System 1400 may be one of the systems managed by a BMS (e.g., BMS 1100 shown in FIG. 15) or may operate independently of a BMS. </p><p id="p0201" num="0201">[00170] System 1400 includes a master window controller 1402 that can send control signals to the tintable windows to control its functions. System 1400 also includes a network 1410 in electronic communication with master window controller 1402. The predictive 
<!-- EPO <DP n="44"/>-->
 control logic, other control logic and instructions for controlling functions of the tintable window(s), and/or sensor data may be communicated to the master window controller 1402 through the network 1410. Network 1410 can be a wired or wireless network (e.g. cloud network). In one embodiment, network 1410 may be in communication with a BMS to allow the BMS to send instructions for controlling the tintable window(s) through network 1410 to the tintable window(s) in a building. </p><p id="p0202" num="0202">[00171] System 1400 also includes EC devices 400 of the tintable windows (not shown) and wall switches 1490, which are both in electronic communication with master window controller 1402. In this illustrated example, master window controller 1402 can send control signals to EC device(s) 400 to control the tint level of the tintable windows having the EC device(s) 400. Each wall switch 1490 is also in communication with EC device(s) 400 and master window controller 1402. An end user (e.g., occupant of a room having the tintable window) can use the wall switch 1490 to control the tint level and other functions of the tintable window having the EC device(s) 400. </p><p id="p0203" num="0203">[00172] In FIG. 17, master window controller 1402 is depicted as a distributed network of window controllers including a master network controller 1403, a plurality of intermediate network controllers 1405 in communication with the master network controller 1403, and multiple pluralities of end or leaf window controllers 1410. Each plurality of end or leaf window controllers 1410 is in communication with a single intermediate network controller 1405. Although master window controller 1402 is illustrated as a distributed network of window controllers, master window controller 1402 could also be a single window controller controlling the functions of a single tintable window in other embodiments. The components of the system 1400 in FIG. 17 may be similar in some respects to components described with respect to FIG. 15. For example, master network controller 1403 may be similar to master network controller 1103 and intermediate network controllers 1405 may be similar to intermediate network controllers 1105. Each of the window controllers in the distributed network of FIG. 17 may include a processor (e.g., microprocessor) and a computer readable medium in electrical communication with the processor. </p><p id="p0204" num="0204">[00173] In FIG. 17, each leaf or end window controller 1410 is in communication with EC device(s) 400 of a single tintable window to control the tint level of that tintable window in the building. In the case of an IGU, the leaf or end window controller 1410 may be in communication with EC devices 400 on multiple lites of the IGU control the tint level of the 
<!-- EPO <DP n="45"/>-->
 IGU. In other embodiments, each leaf or end window controller 1410 may be in communication with a plurality of tintable windows. The leaf or end window controller 1410 may be integrated into the tintable window or may be separate from the tintable window that it controls. Leaf and end window controllers 1410 in FIG. 17 may be similar to the end or leaf controllers 1110 in FIG. 15 and/or may also be similar to window controller 450 </p><p id="p0205" num="0205">described with respect to FIG. 4. </p><p id="p0206" num="0206">[00174] Each wall switch 1490 can be operated by an end user (e.g., occupant of the room) to control the tint level and other functions of the tintable window in communication with the wall switch 1490. The end user can operate the wall switch 1490 to communicate control signals to the EC devices 400 in the associated tintable window. These signals from the wall switch 1490 may override signals from master window controller 1402 in some cases. In other cases (e.g., high demand cases), control signals from the master window controller 1402 may override the control signals from wall switch 1490. Each wall switch 1490 is also in communication with the leaf or end window controller 1410 to send information about the control signals (e.g. time, date, tint level requested, etc.) sent from wall switch 1490 back to master window controller 1402. In some cases, wall switches 1490 may be manually operated. In other cases, wall switches 1490 may be wirelessly controlled by the end user using a remote device (e.g., cell phone, tablet, etc.) sending wireless communications with the control signals, for example, using infrared (IR), and/or radio frequency (RF) signals. In some cases, wall switches 1490 may include a wireless protocol chip, such as Bluetooth, EnOcean, WiFi, Zigbee, and the like. Although wall switches 1490 depicted in FIG. 17 are located on the wall(s), other embodiments of system 1400 may have switches located elsewhere in the room. </p><p id="p0207" num="0207">[00175] VII. Another Example of Predictive Control Logic </p><p id="p0208" num="0208">[00176] FIG. 18 is a block diagram depicting predictive control logic for a method of controlling the tint level of one or more tintable windows (e.g., electrochromic windows) in different zones of a building, according to embodiments. This logic makes predictive determinations at a time in the future that accounts for the transition time of the EC devices 400 in the tintable windows. This predictive control logic can be employed by components of system 1400 described with respect to FIG. 17 or by components of systems of other disclosed embodiments. In the illustrated example, a portion of the predictive control logic is performed by window controller 1410, another portion is performed by network controller 
<!-- EPO <DP n="46"/>-->
 1408, and the logic in Module 1 1406 is performed by a separate component from the window controller 1410 and network controller 1408. Alternatively, Module 1 1406 may be separate logic that may or may not be loaded onto the window controller 1410. </p><p id="p0209" num="0209">[00177] In FIG. 18, the portions of the predictive control logic employed by window controller 1410 and Module 1 1406 are managed by BMS 1407. BMS 1407 may be similar to BMS 1100 described with respect to FIG. 15. BMS 1407 is in electronic communication with window controller 1410 through a BACnet Interface 1408. In other embodiments, other communications protocol may be used. Although not shown in FIG. 18, Module 1 1406 is also in communication with BMS 1407 through BACnet Interface 1408. In other </p><p id="p0210" num="0210">embodiments, the predictive control logic depicted in FIG. 18 may operate independently of a BMS. </p><p id="p0211" num="0211">[00178] Network controller 1408 receives sensor readings from one or more sensors (e.g., an outside light sensor) and may also convert the sensor reading into W/m<sup>2</sup>. The network controller 1408 is in electronic communication with the window controller 1410 via either CANbus or CANOpen protocol. The network controller 1408 communicates the converted sensor readings to the window controller 1410. Network controller 1408 may be similar to either the intermediate network controller 1405 or the master network controller 1403 of FIG. 17. </p><p id="p0212" num="0212">[00179] In FIG. 18, the portion of the predictive control logic employed by window controller 1410 includes a master scheduler 1502. The master scheduler 1502 includes logic that allows a user (e.g., building administrator) to prepare a schedule that can use different types of control programs at different times of day and/or dates. Each of the control programs includes logic for determining a tint level based on or more independent variables. One type of control program is simply a pure state. A pure state refers to particular level of tint (e.g., transmissivity = 40%) that is fixed during a certain time period, regardless of other conditions. For example, the building manager may specify that the windows are clear after 3 PM every day. As another example, building manager may specify a pure state for the time period between the hours of 8 PM to 6 AM every day. At other times of day, a different type of control program may be employed, for example, one employing a much greater level of sophistication. One type of control program offering a high level of sophistication. For example, a highly sophisticated control program of this type includes predictive control logic described in reference to FIG. 18 and may include the implementation of one or more of the 
<!-- EPO <DP n="47"/>-->
 logic Modules A, B, and C of Module 1 1406. As another example, another highly sophisticated control program of this type includes predictive control logic described in reference to FIG. 18 and may include the implementation of one or more of the logic Modules A, B, and C of Module 1 1406 and Module D described later in this Section VII. As another example, another highly sophisticated control program of this type is the predictive control logic described in reference to FIG. 7 and includes full multi-module implementation of logic Modules A, B, and C described in reference to FIGS. 8, 9, and 12. In this example, the predictive control logic uses sensor feedback in Module C and solar information in Modules A and B. Another example of a highly sophisticated control program is the predictive control logic described in reference to FIG. 7 with partial logic module </p><p id="p0213" num="0213">implementation of one or two of the logic Modules A, B, and C described in reference to FIGS. 8, 9, and 12. Another type of control program is a threshold control program that relies on feedback from one or more sensors (e.g., photosensors) and adjusts the tint level accordingly without regard to solar position. One of the technical advantages of using master scheduler 1502 is that the user can select and schedule the control program (method) being used to determine the tint level. </p><p id="p0214" num="0214">[00180] Master scheduler 1502 runs the control programs in the schedule according to time in terms of the date and time of day based on a 24-hour day. Master scheduler 1502 may determine the date in terms of a calendar date and/or the day of the week based on a 7-day week with five weekdays (Monday through Friday) and two weekend days (Saturday and Sunday). Master scheduler 1502 may also determine whether certain days are holidays. Master scheduler 1502 may automatically adjust the time of day for daylight savings time based on the location of the tintable windows, which is determined by site data 1506. </p><p id="p0215" num="0215">[00181] In one embodiment, master scheduler 1502 may use a separate holiday schedule. The user may have determined which control program(s) to use during the holiday schedule. The user may determine which days will be included in the holiday schedule. Master scheduler 1502 may copy the basic schedule set up by the user and allow the user to set up their modifications for the holidays in the holiday schedule. </p><p id="p0216" num="0216">[00182] When preparing the schedule employed by master scheduler 1502, the user may select the zone or zones (Zone Selection) of the building where the selected program(s) will be employed. Each zone includes one or more tintable windows. In some cases, a zone may be an area associated with a space type (e.g., offices having a desk at a particular position, 
<!-- EPO <DP n="48"/>-->
 conference rooms, etc.) or may be associated with multiple space types. For example, the user may select Zone 1 having offices to: 1) Monday through Friday: heat up at 8 am in morning to 70 degrees and turn on air conditioning to at 3 pm in afternoon to keep temperature in offices to 80 degrees, and then turn off all air conditioning, and heat at 5 pm during weekdays, and 2) (Saturday and Sunday) turn off heat and air conditioning. As another example, the user may set Zone 2 having a conference room to run the predictive control logic of FIG. 18 including full-module implementation of Module 1 using all of the logic Module A, B, and C. In another example, the user may select a Zone 1 having conference rooms to run Module 1 from 8AM to 3PM and a threshold program or pure state after 3 PM. In other cases, a zone may be the entire building or may be one or more windows in a building. </p><p id="p0217" num="0217">[00183] When preparing the schedule with programs that may use sensor input, the user may also be able to select the sensor or sensors used in the programs. For example, the user may select a sensor located on the roof or a sensor located near or at the tintable window. As another example, the user may select an ID value of a particular sensor. </p><p id="p0218" num="0218">[00184] The portion of the predictive control logic employed by window controller 1410 also includes a user interface 1504 in electronic communication with master scheduler 1502. User interface 1504 is also in communication with site data 1506, zone/group data 1508, and sense logic 1516. The user may input their schedule information to prepare the schedule (generate a new schedule or modify an existing schedule) using user interface 1504. User interface 1504 may include an input device such as, for example, a keypad, touchpad, keyboard, etc. User interface 1504 may also include a display to output information about the schedule and provide selectable options for setting up the schedule. User interface 1504 is in electronic communication with a processor (e.g., microprocessor), which is in electronic communication with a computer readable medium (CRM). Both the processor and CRM are components of the window controller 1410. The logic in master scheduler 1502 and other components of the predictive control logic may be stored on the computer readable medium of window controller 1410. </p><p id="p0219" num="0219">[00185] The user may enter their site data 1506 and zone/group data 1508 using user interface 1504. Site data 1506 includes the latitude, longitude, and GMT Offset for the location of the building. Zone/group data includes the position, dimension (e.g., window width, window height, sill width, etc.), orientation (e.g., window tilt), external shading (e.g., 
<!-- EPO <DP n="49"/>-->
 overhang depth, overhang location above window, left/right fin to side dimension, left/right fin depth, etc.), datum glass SHGC, and occupancy lookup table for the one or more tintable windows in each zone of the building. In FIG. 18, site data 1506 and zone/group data 1508 is static information (i.e. information that is not changed by components of the predictive control logic). In other embodiments, this data may be generated on the fly. Site data 1506 and zone/group data 1508 may be stored on a computer readable medium of the window controller 1410. </p><p id="p0220" num="0220">[00186] When preparing (or modifying) the schedule, the user selects the control program that master scheduler 1502 will run at different time periods in each of the zones of a building. In some cases, the user may be able to select from multiple control programs. In one such case, the user may prepare a schedule by selecting a control program from a list of all control programs (e.g., menu) displayed on user interface 1405. In other cases, the user may have limited options available to them from a list of all control programs. For example, the user may have only paid for the use of two control programs. In this example, the user would only be able to select one of the two control programs paid for by the user. </p><p id="p0221" num="0221">[00187] An example of a user interface 1405 is shown in FIG. 19. In this illustrated example, the user interface 1405 is in the form of a table for entering schedule information used to generate or change a schedule employed by the master scheduler 1502. For example, the user can enter the time period into the table by entering start and stop times. The user can also select a sensor used by a program. The user can also enter Site data 1506 and </p><p id="p0222" num="0222">Zone/Group Data 1508. The user can also select an occupancy lookup table to be used by selecting "Sun Penetration Lookup." </p><p id="p0223" num="0223">[00188] Returning to FIG. 18, the portion of the predictive control logic employed by window controller 1410 also includes time of day (look ahead) logic 1510. Time of day (look ahead) logic 1510 determines a time in the future used by predictive control logic to make its predictive determinations. This time in the future accounts for time needed to transition the tint level of the EC devices 400 in the tintable windows. By using a time that accounts for transition time, the predictive control logic can predict a tint level appropriate for the future time at which time the EC devices 400 will have had the time to transition to the tint level after receiving the control signal. Time of day portion 1510 may estimate the transition time of EC device(s) in a representative window based on information about the representative window (e.g., window dimension, etc.) from the Zone/Group Data. Time of day logic 1510 
<!-- EPO <DP n="50"/>-->
 may then determine the future time based on the transition time and the current time. For example, the future time may be equal to or greater than the current time added to the transition time. </p><p id="p0224" num="0224">[00189] The Zone/Group Data includes information about the representative window of each zone. In one case, the representative window may be one of the windows in the zone. In another case, the representative window may be a window having average properties (e.g., average dimensions) based on averaging all the properties from all the windows in that zone. </p><p id="p0225" num="0225">[00190] The predictive control logic employed by window controller 1410 also includes a solar position calculator 1512. Solar position calculator 1512 includes logic that determines the position of the sun, sun azimuth and sun altitude, at an instance in time. In FIG. 18, solar position calculator 1512 makes its determinations based on a future instance in time received from time of day logic 1510. Solar position calculator 1512 is in communication with time of day portion 1510 and site data 1506 to receive the future time, latitude and longitude coordinates of the building, and other information that may be needed to make its </p><p id="p0226" num="0226">calculation(s), such as the solar position calculation. Solar position calculator 1512 may also perform one or more determinations based on the calculated solar position. In one embodiment, solar position calculator 1512 may calculate clear sky irradiance or make other determinations from Modules A, B, and C of Module 1 1406. </p><p id="p0227" num="0227">[00191] The control logic employed by window controller 1410 also includes schedule logic 1518, which is in communication with the sense logic 1516, the user interface 1405, the solar position calculator 1512, and Module 1 1406. The schedule logic 1518 includes logic that determines whether to use the tint level passing through the intelligence logic 1520 from Module 1 1406 or use another tint level based on other considerations. For example, as sunrise and sunset times change throughout the year, the user may not want to reprogram the schedule to account for these changes. The schedule logic 1518 may use the sunrise and sunset times from the solar position calculator 1512 to set an appropriate tint level before sunrise and after sunset without requiring the user to reprogram the schedule for these changing times. For example, the schedule logic 1508 may determine that according to the sunrise time received from the solar position calculator 1512 the sun has not risen and that a pre-sunrise tint level should be used instead of the tint level passed from Module 1 1406. The tint level determined by the schedule logic 1518 is passed to sense logic 1516. 
<!-- EPO <DP n="51"/>-->
 [00192] Sense logic 1516 is in communication with override logic 1514, schedule logic 1518, and user interface 1405. Sense logic 1516 includes logic that determines whether to use the tint level passed from schedule logic 1516 or use another tint level based on the sensor data received through the BACnet interface 1408 from one or more sensors. Using the example in the paragraph above, if schedule logic 1518 determines that it the sun has not risen and passed a pre-sunrise tint level and the sensor data shows that the sun has actually risen, then sense logic 1516 would use the tint level passed from Module 1 1406 through schedule logic 1518. The tint level determined by sense logic 1516 is passed to override logic 1514. </p><p id="p0228" num="0228">[00193] BMS 1407 and network controller 1408 are also in electronic communication with a demand response (e.g., utility company) to receive signals communicating the need for a high demand (or peak load) override. In response to receiving these signals from the demand response, BMS 1407 and/or network controller 1408 may send instructions through BACnet Interface 1408 to override logic 1514 that will process the override information from the demand response. Override logic 1514 is in communication with BMS 1407 and network controller 1408 through the BACnet Interface 1408, and also in communication with sense logic 1516. </p><p id="p0229" num="0229">[00194] Override logic 1514 allows for certain types of overrides to disengage predictive control logic and use an override tint level based on another consideration. Some examples of types of overrides that may disengage predictive control logic include a high demand (or peak load) override, manual override, vacant room override, etc. A high demand (or peak load) override defines a tint level from the demand response. For a manual override, an end user may enter the override value at a wall switch 1490 (shown in FIG.17) either manually or through a remote device. A vacant room override defines an override value based on a vacant room (i.e. no occupant in the room). In this case, the sense logic 1516 may receive sensor data from a sensor (e.g., motion sensor) indicating that the room is vacant and sense logic 1516 may determine an override value and relay the override value to override logic 1514. The override logic 1514 can receive an override value and determine whether to use the override value or use another value, such as another override value received from a source having higher priority (i.e., demand response). In some cases, the override logic 1514 may operate by steps similar to the override steps 630, 640, and 650 described with respect to FIG. 7. 
<!-- EPO <DP n="52"/>-->
 [00195] The control logic employed by window controller 1410 also includes intelligence logic 1520 that can shut off one or more of Modules A 1550, B 1558 and C 1560. In one case, the intelligence logic 1520 may be used to shut off one or more Modules where the user has not paid for those Modules. Intelligence logic 1520 may prevent the use of certain more sophisticated features such as the penetration calculation made in Module A. In such cases, a basic logic is used that "short-circuits" the solar calculator information and uses it to calculate tint levels, possibly with the assistance of one or more sensors. This tint level from the basic logic is communicated to schedule logic 1518. </p><p id="p0230" num="0230">[00196] Intelligence logic 1520 can shut off one or more of the Modules (Module A 1550, Module B 1558 and Module C 1560) by diverting certain communications between the window controller 1410 and Module 1 1406. For example, the communication between the solar position calculator 1512 and Module A 1550 goes through intelligence logic 1520 and can be diverted to schedule logic 1518 by intelligence logic 1520 to shut off Module A 1550, Module B 1558 and Module C 1560. As another example, the communication of tint level from Module A at 1552 to the Clear Sky Irradiance calculations at 1554 goes through intelligence logic 1520 and can be diverted instead to schedule logic 1518 to shut off Module B 1558 and Module C 1560. In yet another example, the communication of tint level from Module B at 1558 to Module C 1560 goes through intelligence logic 1520 and can be diverted to schedule logic 1518 to shut off Module C 1560. </p><p id="p0231" num="0231">[00197] Module 1 1406 includes logic that determines and returns a tint level to the schedule logic 1518 of window controller 1410. The logic predicts a tint level that would be appropriate for the future time provided by the time of day portion 1510. The tint level is determined for a representative tintable window associated with each of the zones in the schedule. </p><p id="p0232" num="0232">[00198] In FIG. 18, Module 1 1406 includes Module A 1550, Module B 1558 and Module C 1560, which may have some steps that are similar in some respects to the steps performed in Modules A, B, and C as described with respect to FIGS. 8, 9, 12 and 13. In another embodiment, Module 1 1406 may be comprised of Modules A, B, and C as described with respect to FIGS. 8, 9, 12 and 13. In yet another embodiment, Module 1 1406 may be comprised of Modules A, B, and C described with respect to FIG. 14. </p><p id="p0233" num="0233">[00199] In FIG. 18, Module A 1550 determines the penetration depth through the representative tintable window. The penetration depth predicted by Module A 1550 is at the 
<!-- EPO <DP n="53"/>-->
 future time. Module A 1550 calculates the penetration depth based on the determined position of the sun (i.e. sun azimuth and sun altitude) received from the solar position calculator 1512 and based on the position of the representative tintable window, acceptance angle, dimensions of the window, orientation of the window (i.e. direction facing), and the details of any exterior shading retrieved from the zone/group data 1508. </p><p id="p0234" num="0234">[00200] Module A 1550 then determines the tint level that will provide occupant comfort for the calculated penetration depth. Module A 1550 uses the occupancy lookup table retrieved from the zone/group data 1508 to determine the desired tint level for the space type associated with the representative tintable window, for the calculated penetration depth, and for the acceptance angle of the window. Module A 1550 outputs a tint level at step 1552. </p><p id="p0235" num="0235">[00201] The maximum clear sky irradiance incident the representative tintable window is predicted for all times in the logic 1554. The clear sky irradiance at the future time is also predicted based on the latitude and longitude coordinates of the building and the </p><p id="p0236" num="0236">representative window orientation (i.e. direction the window is facing) from the site data 1506 and the zone/group data 1508. These clear sky irradiance calculations can be performed by the sun position calculator 1512 in other embodiments. </p><p id="p0237" num="0237">[00202] Module B 1556 then calculates new tint levels by incrementally increasing the tint level. At each of these incremental steps, the Inside Irradiance in the room based on the new tint level is determined using the equation: Inside Irradiance = Tint level SHGC x Clear Sky Irradiance. Module B selects the tint level where Inside Irradiance is less than or equal to Datum Inside Irradiance (Datum SHGC x Max. Clear sky Irradiance) and the tint level is not lighter than Tint Level from A. Module B 1556 outputs the selected tint level from B. From the Tint level from B, logic 1558 calculates the outside irradiance and the calculated skylight irradiance. </p><p id="p0238" num="0238">[00203] Module C 1560 makes a determination of whether a sensor reading of irradiance is less than the clear sky irradiance. If the determination result is YES, then the tint level being calculated is made incrementally lighter (clearer) until the value matches or is less than a tint level calculated as Sensor Reading x Tint Level SHGC, but not to exceed datum inside Irradiance from B. If the determination result is NO, then the tint level being calculated is made darker in incremental steps as done in Module B 1556. Module C outputs the tint level. Logic 1562 determines that the tint level from Module C is the final tint level and returns this 
<!-- EPO <DP n="54"/>-->
 final tint level (Tint level from Module C) to the schedule logic 1518 of the window controller 1410. </p><p id="p0239" num="0239">[00204] In one aspect, Module 1 1406 may also include a fourth Module D that can predict the effects of the surrounding environment on the intensity and direction of sunlight through the tintable windows in the zone. For example, a neighboring building or other structure may shade the building and block some light from passing through the windows. As another example, reflective surfaces (e.g., surfaces having snow, water, etc.) from a neighboring building or other surfaces in the environment surrounding the building may reflect light into the tintable windows. This reflected light can increase the intensity of light into the tintable windows and cause glare in the occupant space. Depending on the values of the intensity and direction of sunlight predicted by Module D, Module D may modify the tint level determined from Modules A, B, and C or may modify certain determinations from Modules A, B, and C such as, for example, the penetration depth calculation or the acceptance angle of the representative window in the Zone/Group data. </p><p id="p0240" num="0240">[00205] In some cases, a site study may be conducted to determine the environment surrounding the building and/or one or more sensors may be used to determine the effects of the surrounding environment. Information from the site study may be static information based on predicting the reflectance and shading (surrounding) effects for a time period (e.g., a year), or may be dynamic information that can be updated on a periodic basis or other timed basis. In one case, Module D may use the site study to modify the standard acceptance angle and associated θι and θ<sub>2</sub> (shown in FIG. 20) of the representative window of each zone retrieved from the Zone/group data. Module D may communicate this modified information regarding the representative windows other modules of the predictive control logic. The one or more sensors employed by Module D to determine the effects of the surrounding environment may be the same sensors used by other modules (e.g., by Module C) or may be different sensors. These sensors may be specifically designed to determine the effects of the surrounding environment for Module D. </p><p id="p0241" num="0241">[00206] To operate the predictive control logic shown in FIG. 18, the user first prepares a schedule with details of the times and dates, zones, sensors, and programs used. </p><p id="p0242" num="0242">Alternatively, a default schedule may be provided. Once the schedule is in place (stored), at certain time intervals (every 1 minute, 5 minutes, 10 minutes, etc.) the time of day portion 1510 determines a future time of day based on the current time and the transition time of the 
<!-- EPO <DP n="55"/>-->
 EC device(s) 400 in the representative window or each zone in the schedule. Using the zone/group data 1508 and site data 1506, the solar position calculator 1512 determines the solar position at the future (look ahead) time for each representative window of each zone in the schedule. Based on the schedule prepared by the user, the intelligence logic 1520 is used to determine which program to employ for each zone in the schedule. For each zone, the scheduled program is employed and predicts an appropriate tint level for that future time. If there is an override in place, an override value will be used. If there is no override in place, then the tint level determined by the program will be used. For each zone, the window controller 1410 will send control signals with the zone-specific tint level determined by the scheduled program to the associated EC device(s) 400 to transition the tint level of the tintable window(s) in that zone by the future time. </p><p id="p0243" num="0243">[00207] VIII. Example of Occupancy Lookup Table </p><p id="p0244" num="0244">[00208] FIG. 20 is an illustration including an example of an occupancy lookup table. The tint level in the table is in terms of T<sub>vis</sub> (visible transmission). The table includes different tint levels (T<sub>vis</sub> values) for different combinations of calculated penetration depth values (2 feet, 4 feet, 8 feet, and 15 feet) for a particular space type and when the sun angle 6<sub>sun</sub> is between the acceptance angle of the window between θι = 30 degrees and 0<sub>2</sub> = 120 degrees. The table is based on four tint levels including 4% (lightest), 20%, 40%, and 63%. FIG. 20 also shows a diagram of a desk near a window and the acceptance angle of the window to sunlight having an angle 0<sub>sun</sub> between the angle of Θ] and * . This diagram shows the relationship between the sun angle 6<sub>sun</sub> and the location of the desk. When the angle of the sun 6<sub>sun</sub> is between the angle of acceptance between θι and #2, then the sunlight could strike the surface of the desk. If the sun angle 6<sub>sun</sub> is between the acceptance angle between θι and *2 (If θι &lt; 6<sub>sun</sub> &lt; 6i) and the penetration depth meets the criteria to tint the window, then that tint level determined by the occupancy lookup table is sent to the window controller, which sends control signals to the EC devices in the window to transition the window to the determined tint level. These two angles θι and *2 can be calculated or measured for each window, and stored in the zone/group data 1508 with the other window parameters for that zone. </p><p id="p0245" num="0245">[00209] FIGS. 21 A, 21B, and 21C are plan views of a portion of a building 2100, according to embodiments. Building 2100 may be similar in some respects to the building 1101 in FIG. 15 and the rooms in building 2100 may be similar in some respects to the room 500 described in FIGS. 5, 6A, 6B, and 6C. The portion of building 2100 includes three 
<!-- EPO <DP n="56"/>-->
 different space types including: a desk in an office, a group of cubicles, and a conference room in the building 2100. FIGS. 21A, 21B, and 21C show the sun at different angles 6<sub>sun</sub>. These figures also illustrate the different acceptance angles of the different types of windows in building 2100. For example, the conference room with the largest window will have the largest acceptance angle allowing the most light into the room. In this example, the T<sub>vis</sub> values in an associated occupancy lookup table may be relatively low (low transmissivity) for the conference room. If however, a similar window having the same acceptance angle was instead in a solarium, then the T<sub>vis</sub> values in an associated occupancy lookup table may be higher values (higher transmissivity) to allow for more sunlight to enter the room. </p><p id="p0246" num="0246">[00210] IX. Subsystems </p><p id="p0247" num="0247">[00211] FIG. 22 is a block diagram of subsystems that may be present in window controllers used to control the tint level or more tintable windows, according to embodiments. For example, window controllers depicted in FIG. 17 may have a processor (e.g., </p><p id="p0248" num="0248">microprocessor) and a computer readable medium in electronic communication with the processor. </p><p id="p0249" num="0249">[00212] The various components previously described in the Figures may operate using one or more of the subsystems to facilitate the functions described herein. Any of the components in the Figures may use any suitable number of subsystems to facilitate the functions described herein. Examples of such subsystems and/or components are shown in a FIG. 22. The subsystems shown in FIG. 22 are interconnected via a system bus 2625. </p><p id="p0250" num="0250">Additional subsystems such as a printer 2630, keyboard 2632, fixed disk 2634 (or other memory comprising computer readable media), display 2430, which is coupled to display adapter 2638, and others are shown. Peripherals and input/output (I/O) devices, which couple to I/O controller 2640, can be connected to the computer system by any number of means known in the art, such as serial port 2642. For example, serial port 2642 or external interface 2644 can be used to connect the computer apparatus to a wide area network such as the Internet, a mouse input device, or a scanner. The interconnection via system bus allows the processor 2410 to communicate with each subsystem and to control the execution of instructions from system memory 2646 or the fixed disk 2634, as well as the exchange of information between subsystems. The system memory 2646 and/or the fixed disk 2634 may embody a computer readable medium. Any of these elements may be present in the previously described features. 
<!-- EPO <DP n="57"/>-->
 [00213] In some embodiments, an output device such as the printer 2630 or display 2430 of one or more systems can output various forms of data. For example, the system 1400 may output schedule information on a display to a user. </p><p id="p0251" num="0251">[00214] Modifications, additions, or omissions may be made to any of the above-described predictive control logic, other control logic and their associated control methods (e.g., logic described with respect to FIG. 18, logic described with respect to FIGS. 7, 8, 9, 12, and 13, and logic described with respect to FIG. 14) without departing from the scope of the disclosure. Any of the logic described above may include more, fewer, or other logic components without departing from the scope of the disclosure. Additionally, the steps of the described logic may be performed in any suitable order without departing from the scope of the disclosure. </p><p id="p0252" num="0252">[00215] Also, modifications, additions, or omissions may be made to the above-described systems (e.g., system described with respect to FIG. 17) or components of a system without departing from the scope of the disclosure. The components of the may be integrated or separated according to particular needs. For example, the master network controller 1403 and intermediate network controller 1405 may be integrated into a single window controller. Moreover, the operations of the systems can be performed by more, fewer, or other components. Additionally, operations of the systems may be performed using any suitable logic comprising software, hardware, other logic, or any suitable combination of the preceding. </p><p id="p0253" num="0253">[00216] It should be understood that the present invention as described above can be implemented in the form of control logic using computer software in a modular or integrated manner. Based on the disclosure and teachings provided herein, a person of ordinary skill in the art will know and appreciate other ways and/or methods to implement the present invention using hardware and a combination of hardware and software. </p><p id="p0254" num="0254">[00217] Any of the software components or functions described in this application, may be implemented as software code to be executed by a processor using any suitable computer language such as, for example, Java, C++ or Perl using, for example, conventional or object- oriented techniques. The software code may be stored as a series of instructions, or commands on a computer readable medium, such as a random access memory (RAM), a read only memory (ROM), a magnetic medium such as a hard-drive or a floppy disk, or an optical medium such as a CD-ROM. Any such computer readable medium may reside on or within a 
<!-- EPO <DP n="58"/>-->
 single computational apparatus, and may be present on or within different computational apparatuses within a system or network. </p><p id="p0255" num="0255">[00218] Although the foregoing disclosed embodiments have been described in some detail to facilitate understanding, the described embodiments are to be considered illustrative and not limiting. It will be apparent to one of ordinary skill in the art that certain changes and modifications can be practiced within the scope of the appended claims. </p><p id="p0256" num="0256">[00219] One or more features from any embodiment may be combined with one or more features of any other embodiment without departing from the scope of the disclosure. </p><p id="p0257" num="0257">Further, modifications, additions, or omissions may be made to any embodiment without departing from the scope of the disclosure. The components of any embodiment may be integrated or separated according to particular needs without departing from the scope of the disclosure. 
</p></description><claims mxw-id="PCLM70077189" ref-ucid="WO-2014130471-A1" lang="EN" load-source="patent-office"><claim-statement><!-- EPO <DP n="59"/>-->CLAIMS What is claimed is: </claim-statement><claim id="clm-0001" num="1"><claim-text>1. A method of controlling tint of a tintable window to account for occupant comfort in a room of a building, wherein the tintable window is located between the interior and exterior of the building, the method comprising: </claim-text><claim-text> (a) predicting a tint level for the tintable window at a future time based on a penetration depth of direct sunlight through the tintable window into the room at the future time and space type in the room; and </claim-text><claim-text> (b) providing instructions over a network to transition tint of the tintable window to the tint level determined in (a). </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. The method of claim 1, further comprising predicting clear sky irradiance through the tintable window at the future time, and using the predicted clear sky irradiance together with the determination in (a) to modify the tint level determined in (a). </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. The method of claim 2, further comprising receiving a signal from a sensor configured to detect actual irradiance at the tintable window, and using the detected irradiance together with the determination in (a) to further modify the tint level. </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. The method of claim 1, further comprising calculating the penetration depth in (a) based on sun position at the future time and window configuration. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. The method of claim 4, wherein the window configuration comprises values of one or more variables selected from the group consisting of position of the window, dimensions of the window, orientation of the window, and dimensions of exterior shading. </claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. The method of any of claims 1-5, wherein the future time is at least a preset interval after the current time, wherein the preset interval is an estimated duration of transitioning the tint of the tintable window. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. The method of claim 1 , wherein the tint level in (a) is determined using a lookup table in which tint levels are specified for combinations of penetration depth and space type. 
<!-- EPO <DP n="60"/>-->
</claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. The method of claim 1, further comprising calculating the sun position in (a) based on longitude and latitude of the building, and time of year and a future time of day. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. The method of any of claims 1-8, wherein the tint level determined in (a) is a minimum tint level. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. The method of claims 1 or 5, wherein the tint level determined in (a) reduces energy consumption by a heating system, a cooling system, and/or lighting in the building while providing occupant comfort. </claim-text></claim><claim id="clm-0011" num="11"><claim-text>11. The method of claim 1 , further comprising using an override value to modify the tint level determined in (a) after an override mechanism is received. </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. The method of claim 1, further comprising providing instructions wherein the instructions are provided by a master controller. </claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. A controller for controlling tint of a tintable window to account for occupant comfort in a room of a building, wherein the tintable window is located between the interior and exterior of the building, the controller comprising: </claim-text><claim-text> a processor configured to determine a tint level for the tintable window based on a penetration depth of direct sunlight through the tintable window into a room and space type in the room; and </claim-text><claim-text> a power width modulator in communication with the processor and with the tintable window over a network, the power width modulator configured to receiving the tint level from the processor and send a signal with tint instructions over the network to transition the tint of the tintable window to the determined tint level. </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. The controller of claim 13, wherein the processor is further configured to predict clear sky irradiance through the tintable window, and use the predicted clear sky irradiance together with the determined tint level to modify the determined tint level. 
<!-- EPO <DP n="61"/>-->
</claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. The controller of claim 14, </claim-text><claim-text> wherein the processor is in communication with a sensor configured to detect actual irradiance at the tintable window, and </claim-text><claim-text> wherein the processor is further configured to receive a signal with detected irradiance from the sensor and use the detected irradiance together with the modified tint level to further modify the tint level. </claim-text></claim><claim id="clm-0016" num="16"><claim-text>16. A master controller for controlling tint of a tintable window to account for occupant comfort in a building, wherein the tintable window is located between the interior and exterior of the building, the master controller comprising: </claim-text><claim-text> a computer readable medium having a configuration file with an space type associated with the tintable window; and </claim-text><claim-text> a processor in communication with the computer readable medium and in </claim-text><claim-text>communication with a local window controller for the tintable window, wherein the processor is configured to: </claim-text><claim-text> receive the space type from the computer readable medium, </claim-text><claim-text> determine a tint level for the tintable window based on a penetration depth of direct sunlight through the tintable window into a room and the space type, and </claim-text><claim-text> send tint instructions over a network to the local window controller to transition tint of the tintable window to the determined tint level. </claim-text></claim><claim id="clm-0017" num="17"><claim-text>17. A method of controlling tint of one or more tintable windows in a zone of a building to account for occupant comfort, the method comprising: </claim-text><claim-text> calculating a future time based on a current time and based on a predicted transition time of a representative window of the zone; </claim-text><claim-text> predicting a solar position at the future time; </claim-text><claim-text> determining a program designated by a user in a schedule, the program including logic for determining a tint level based on one or more independent variables; </claim-text><claim-text> employing the determined program to determining the tint level based on the predicted solar position at the future time and occupant comfort; and </claim-text><claim-text> communicating instructions to the one or more tintable windows to transition tint to the determined tint level. 
<!-- EPO <DP n="62"/>-->
</claim-text></claim><claim id="clm-0018" num="18"><claim-text>18. The method of claim 17, wherein the tintable windows are electrochromic windows and the instructions are communicated to one or more electrochromic devices of each of the electrochromic windows. </claim-text></claim><claim id="clm-0019" num="19"><claim-text>19. The method of claim 17 or 18, further comprising using intelligence logic to determine whether to use one or more logic modules in the program to determine the tint level. </claim-text></claim><claim id="clm-0020" num="20"><claim-text>20. The method of claim 19, further comprising if the intelligence logic determines to use a first logic module, determining the tint level based on a penetration depth of direct sunlight through the representative window and based on space type. </claim-text></claim><claim id="clm-0021" num="21"><claim-text>21. The method of claim 20, further comprising calculating the penetration depth based on the predicted solar position and window configuration. </claim-text></claim><claim id="clm-0022" num="22"><claim-text>22. The method of claim 21, further comprising modifying the calculated penetration depth based on surrounding environment of the building. </claim-text></claim><claim id="clm-0023" num="23"><claim-text>23. The method of claim 19, wherein the tint level is determined using a lookup table in which tint levels are specified for combinations of penetration depth, space type, and acceptance angle. </claim-text></claim><claim id="clm-0024" num="24"><claim-text>24. The method of claim 23, further comprising modifying the acceptance angle of the representative window based on surrounding environment of the building. </claim-text></claim><claim id="clm-0025" num="25"><claim-text>25. The method of claim 17, further comprising predicting clear sky irradiance through the representative window at the future time. </claim-text></claim><claim id="clm-0026" num="26"><claim-text>26. The method of claim 19, if the intelligence logic determines to use a second logic module, further comprising: </claim-text><claim-text> predicting clear sky irradiance through the representative window at the future time; and </claim-text><claim-text> using the predicted clear sky irradiance along with the predicted solar position to determine the tint level. 
<!-- EPO <DP n="63"/>-->
</claim-text></claim><claim id="clm-0027" num="27"><claim-text>27. The method of claim 19, if the intelligence logic determines to use a third logic module, further comprising using actual irradiance detected by a sensor to determine the tint level. </claim-text></claim><claim id="clm-0028" num="28"><claim-text>28. The method of claim 19, if the intelligence logic determines to use both a first logic module and a second logic module, further comprising: </claim-text><claim-text> determining the tint level based on a penetration depth of direct sunlight through the representative window and based on space type; </claim-text><claim-text> predicting clear sky irradiance through the representative window at the future time; and </claim-text><claim-text> modifying the tint level based on the predicted clear sky irradiance along with the predicted solar position if darker. </claim-text></claim><claim id="clm-0029" num="29"><claim-text>29. The method of claim 28, if the intelligence logic determines to also use a third logic module, further comprising using actual irradiance detected by a sensor to modify the tint level if darker. </claim-text></claim><claim id="clm-0030" num="30"><claim-text>30. The method of claim 17, further comprising using override logic to determine whether to use an override value to modify the determined tint level. </claim-text></claim><claim id="clm-0031" num="31"><claim-text>31. The method of claim 17, wherein the schedule was prepared by a user. </claim-text></claim><claim id="clm-0032" num="32"><claim-text>32. The method of any of claims 17-31 , wherein the future time is calculated by adding the predicted transition time of the representative window to the current time. </claim-text></claim><claim id="clm-0033" num="33"><claim-text>33. The method of any of claims 17-32, further comprising estimating the predicted transition time of the representative window. </claim-text></claim><claim id="clm-0034" num="34"><claim-text>34. The method of claim 17, further comprising predicting the solar position at the predicted future time based on longitude and latitude of the building. 
<!-- EPO <DP n="64"/>-->
</claim-text></claim><claim id="clm-0035" num="35"><claim-text>35. A window controller for controlling tint of one or more tintable windows in a zone of a building to account for occupant comfort, the window controller comprising: a computer readable medium having predictive control logic, and site data and zone/group data associated with the zone; and </claim-text><claim-text> a processor in communication with the computer readable medium and in </claim-text><claim-text>communication with the tintable window, wherein the processor is configured to: </claim-text><claim-text> calculate a future time based on a current time and a predicted transition time of a representative window of the zone; </claim-text><claim-text> predict a solar position at the future time; </claim-text><claim-text> determine a program designated by a user in a schedule the program including logic for determining a tint level based on one or more independent variables; </claim-text><claim-text> employ the determined program to determine a tint level using the predicted solar position at the future time and based on occupant comfort; and </claim-text><claim-text> communicate instructions to the one or more tintable windows in the zone to transition tint to the determined tint level. </claim-text></claim><claim id="clm-0036" num="36"><claim-text>36. The window controller of claim 35, wherein the tintable windows are electrochromic windows and the instructions are communicated to one or more </claim-text><claim-text>electrochromic devices of each of the electrochromic windows. 
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
