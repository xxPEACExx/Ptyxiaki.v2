<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2959581-A1" country="EP" doc-number="2959581" kind="A1" date="20151230" family-id="51350756" file-reference-id="252649" date-produced="20180825" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160453080" ucid="EP-2959581-A1"><document-id><country>EP</country><doc-number>2959581</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14709079-A" is-representative="NO"><document-id mxw-id="PAPP193869128" load-source="docdb" format="epo"><country>EP</country><doc-number>14709079</doc-number><kind>A</kind><date>20140221</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193869129" load-source="patent-office" format="original"><country>EP</country><doc-number>14709079.9</doc-number><date>20140221</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162033538" ucid="US-201361767633-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201361767633</doc-number><kind>P</kind><date>20130221</date></document-id></priority-claim><priority-claim mxw-id="PPC162034570" ucid="US-2014017540-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>2014017540</doc-number><kind>W</kind><date>20140221</date></document-id></priority-claim><priority-claim mxw-id="PPC162027688" ucid="US-201414185431-A" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201414185431</doc-number><kind>A</kind><date>20140220</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1988521997" load-source="docdb">H03K   7/08        20060101ALI20140910BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988522786" load-source="docdb">G06F  17/00        20060101ALI20140910BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988524450" load-source="docdb">H03K   3/72        20060101AFI20140910BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988525071" load-source="docdb">H03K   5/26        20060101ALI20140910BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1988525399" load-source="docdb">G06F   1/08        20060101ALI20140910BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1987763381" load-source="docdb" scheme="CPC">G06F   1/08        20130101 LI20151029BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987765467" load-source="docdb" scheme="CPC">H03K   7/08        20130101 LI20151029BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987766718" load-source="docdb" scheme="CPC">H03K   3/72        20130101 LI20151029BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987772861" load-source="docdb" scheme="CPC">H03K   3/017       20130101 LA20151028BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987783947" load-source="docdb" scheme="CPC">H03L   7/083       20130101 LA20151028BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987785579" load-source="docdb" scheme="CPC">H03K   3/02        20130101 LA20151028BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987786644" load-source="docdb" scheme="CPC">H03K   5/26        20130101 LI20151029BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987793080" load-source="docdb" scheme="CPC">H03L   7/06        20130101 FI20140821BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165550706" lang="DE" load-source="patent-office">VERBESSERTER NUMERISCH GESTEUERTER OSZILLATOR</invention-title><invention-title mxw-id="PT165550707" lang="EN" load-source="patent-office">ENHANCED NUMERICAL CONTROLLED OSCILLATOR</invention-title><invention-title mxw-id="PT165550708" lang="FR" load-source="patent-office">OSCILLATEUR À COMMANDE NUMÉRIQUE AMÉLIORÉ</invention-title><citations><non-patent-citations><nplcit><text>See references of WO 2014130754A1</text><sources><source mxw-id="PNPL67568084" load-source="docdb" name="SEA"/></sources></nplcit></non-patent-citations></citations></technical-data><parties><applicants><applicant mxw-id="PPAR1103328210" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>MICROCHIP TECH INC</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR1103335021" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>MICROCHIP TECHNOLOGY INCORPORATED</last-name></addressbook></applicant><applicant mxw-id="PPAR1101650033" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Microchip Technology Incorporated</last-name><iid>100178031</iid><address><street>2355 West Chandler Boulevard</street><city>Chandler, AZ 85224-6199</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103344626" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>WALTERS BRET</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103313519" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>WALTERS, BRET</last-name></addressbook></inventor><inventor mxw-id="PPAR1101647899" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>WALTERS, BRET</last-name><address><street>546 West Highland Street</street><city>Chandler, AZ 85225</city><country>US</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101651212" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Grubert, Andreas</last-name><suffix>et al</suffix><iid>101525189</iid><address><street>c/o Westphal, Mussgnug &amp; Partner Patentanwälte mbB Herzog-Wilhelm-Straße 26</street><city>80331 München</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="US-2014017540-W"><document-id><country>US</country><doc-number>2014017540</doc-number><kind>W</kind><date>20140221</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014130754-A1"><document-id><country>WO</country><doc-number>2014130754</doc-number><kind>A1</kind><date>20140828</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660634426" load-source="docdb">AL</country><country mxw-id="DS660633070" load-source="docdb">AT</country><country mxw-id="DS660634456" load-source="docdb">BE</country><country mxw-id="DS660711023" load-source="docdb">BG</country><country mxw-id="DS660714343" load-source="docdb">CH</country><country mxw-id="DS660791460" load-source="docdb">CY</country><country mxw-id="DS660633083" load-source="docdb">CZ</country><country mxw-id="DS660634457" load-source="docdb">DE</country><country mxw-id="DS660791461" load-source="docdb">DK</country><country mxw-id="DS660791462" load-source="docdb">EE</country><country mxw-id="DS660739285" load-source="docdb">ES</country><country mxw-id="DS660711024" load-source="docdb">FI</country><country mxw-id="DS660719457" load-source="docdb">FR</country><country mxw-id="DS660634458" load-source="docdb">GB</country><country mxw-id="DS660791463" load-source="docdb">GR</country><country mxw-id="DS660634467" load-source="docdb">HR</country><country mxw-id="DS660633084" load-source="docdb">HU</country><country mxw-id="DS660714344" load-source="docdb">IE</country><country mxw-id="DS660791464" load-source="docdb">IS</country><country mxw-id="DS660719458" load-source="docdb">IT</country><country mxw-id="DS660791465" load-source="docdb">LI</country><country mxw-id="DS660711025" load-source="docdb">LT</country><country mxw-id="DS660632043" load-source="docdb">LU</country><country mxw-id="DS660711026" load-source="docdb">LV</country><country mxw-id="DS660711031" load-source="docdb">MC</country><country mxw-id="DS660632044" load-source="docdb">MK</country><country mxw-id="DS660632045" load-source="docdb">MT</country><country mxw-id="DS660711032" load-source="docdb">NL</country><country mxw-id="DS660719463" load-source="docdb">NO</country><country mxw-id="DS660711033" load-source="docdb">PL</country><country mxw-id="DS660714345" load-source="docdb">PT</country><country mxw-id="DS660634469" load-source="docdb">RO</country><country mxw-id="DS660714346" load-source="docdb">RS</country><country mxw-id="DS660711034" load-source="docdb">SE</country><country mxw-id="DS660739286" load-source="docdb">SI</country><country mxw-id="DS660719464" load-source="docdb">SK</country><country mxw-id="DS660711039" load-source="docdb">SM</country><country mxw-id="DS660791466" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA139072175" ref-ucid="WO-2014130754-A1" lang="EN" load-source="patent-office"><p num="0000">A numerical controlled oscillator generating an output signal with a digital clock signal having a variable frequency is disclosed. The numerical oscillator is controlled by a programmable numerical value being subject to a transfer function and comprises a comparator configured to compare an output of the transfer function with a duty cycle register to generate the output signal.</p></abstract><abstract mxw-id="PA139539824" ref-ucid="WO-2014130754-A1" lang="EN" source="national office" load-source="docdb"><p>A numerical controlled oscillator generating an output signal with a digital clock signal having a variable frequency is disclosed. The numerical oscillator is controlled by a programmable numerical value being subject to a transfer function and comprises a comparator configured to compare an output of the transfer function with a duty cycle register to generate the output signal.</p></abstract><abstract mxw-id="PA139072176" ref-ucid="WO-2014130754-A1" lang="FR" load-source="patent-office"><p num="0000">L'invention porte sur un oscillateur à commande numérique générant un signal de sortie avec un signal d'horloge numérique ayant une fréquence variable. L'oscillateur numérique est commandé par une valeur numérique programmable qui est soumise à une fonction de transfert et comprend un comparateur configuré pour comparer une sortie de la fonction de transfert à un registre de rapport cyclique afin de générer le signal de sortie.</p></abstract><abstract mxw-id="PA139539825" ref-ucid="WO-2014130754-A1" lang="FR" source="national office" load-source="docdb"><p>L'invention porte sur un oscillateur à commande numérique générant un signal de sortie avec un signal d'horloge numérique ayant une fréquence variable. L'oscillateur numérique est commandé par une valeur numérique programmable qui est soumise à une fonction de transfert et comprend un comparateur configuré pour comparer une sortie de la fonction de transfert à un registre de rapport cyclique afin de générer le signal de sortie.</p></abstract><description mxw-id="PDES78476424" ref-ucid="WO-2014130754-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="2"/>--><p id="p0001" num="0001"> ENHANCED NUMERICAL CONTROLLED OSCILLATOR </p><p id="p0002" num="0002">CROSS-REFERENCE TO RELATED APPLICATIONS </p><p id="p0003" num="0003">This application claims the benefit of U.S. Provisional Application No. 61/767,633 filed on February 21 , 2013, which is incorporated herein in its entirety. </p><p id="p0004" num="0004">TECHNICAL FIELD </p><p id="p0005" num="0005">The present disclosure relates to a numerical controlled oscillator, in particular a numerical controlled oscillator peripheral for use in a microcontroller. </p><p id="p0006" num="0006">BACKGROUND </p><p id="p0007" num="0007">In many microcontrollers, for example microcontrollers manufactured by the assignee of the present disclosure, a numerical controlled oscillator (NCO) module is available. According to various embodiments, such a numerical controlled oscillator module (NCO) peripheral can be used to provide a linear frequency signal control. To this end, the NCO can be used with a technique called Direct Digital Synthesis to generate a frequency which is, on average, very finely adjustable by adding a precisely controlled sum to the generated output. </p><p id="p0008" num="0008">Fig. 1 shows such a generic numerical oscillator 20 in a peripheral circuit 10 of, for example a microcontroller. The numerical controlled oscillator 20 receives a reference clock r(x) and a numerical value q which may be stored in a configuration register 40, for example a special function register associated with the NCO. The numeric value q entered into the module performs an operation on the reference clock to provide an output frequency f(q). Therefore f(q) = r(x) * A; A is the numeric oscillator transfer function. The transfer function can be as simple as an addition. However other functions can be implemented such as a subtracting, multiplicative, dividing, logarithmic or any other mathematical function. In the following embodiments discussed in this application, a simple adder is used to form a numerical controlled oscillator. However, a numerical controlled oscillator as defined above may have other functions to provide for a numerical controlled clock signal as stated above. Such a numerical oscillator peripheral 10 may provide a fine tunable output frequency which can be used in particular to generate pulse width modulation output in addition to a linear frequency control. 
<!-- EPO <DP n="3"/>-->
 SUMMARY </p><p id="p0009" num="0009">However, there exists a need for an enhanced numerical oscillator that provides a different output signal or functionality or that provides for additional optional output signals. </p><p id="p0010" num="0010">According to an embodiment, a numerical controlled oscillator generates an output signal with a digital clock signal having a variable frequency, wherein the numerical oscillator is controlled by a programmable numerical value being subject to a transfer function and comprises a comparator configured to compare whether an output of the transfer function with a duty cycle register and to generate the output signal. </p><p id="p0011" num="0011">According to a further embodiment, the transfer function can be an addition provided by an adder and an average frequency of the variable frequency can be controlled by an increment register storing the numerical value whose content is added by the adder to an accumulator having an overflow output, and wherein the duty cycle register is coupled with the comparator comprising a "greater" or "equal or greater" function. According to a further embodiment, the numerical controlled oscillator according may further comprise an output multiplexer operable to select an output signal based on the overflow output or an output signal of the comparator. According to a further embodiment, a first input of the adder can be coupled with the increment register, the accumulator is clocked by a selectable clock signal and has an input coupled with an output of the adder and an output coupled with a second input of the adder, wherein the overflow output is coupled with a first input of an AND gate whose second input receives the selected clock signal, and a flip-flop having an input coupled with the output of the AND gate and an output coupled with one input of the output multiplexer. According to a further embodiment, the increment register and/or the duty cycle register can be buffered. According to a further embodiment, the numerical controlled oscillator may further comprise a clock input multiplexer controlled by a control signal to select one of a plurality of input clock signals. According to a further embodiment, the selectable clock signals may comprise an externally provided clock signal and/or an internally provided clock signal. According to a further embodiment, the numerical controlled oscillator may further comprise a ripple counter having a clock input coupled with the selectable clock signal and a multiplexer having a plurality of inputs coupled with a counter value register of the ripple counter, wherein an output of the multiplexer is coupled with a reset input of an SR flip-flop whose set input is coupled with the overflow output of 
<!-- EPO <DP n="4"/>-->
 the accumulator, an inverted output of the SR flip-flop resets the ripple counter and a non- inverted output of the SR flip-flop is coupled with a further input of the output multiplexer. According to a further embodiment, the numerical controlled oscillator may further comprise an AND gate having an output coupled with the clock input of the ripple counter and having a first input receiving the selectable clock signal and a second input coupled with the non- inverting output of the SR flip-flop. </p><p id="p0012" num="0012">According to another embodiment, a microcontroller may comprise numerical controlled oscillator as described above. </p><p id="p0013" num="0013">According to yet another embodiment, a method for generating a clock signal may comprise the steps of: providing an output signal with a digital clock signal having a variable frequency by a numerical controlled oscillator by subjecting a numerical value to a transfer function generating an output value, providing a duty cycle register coupled with a comparator, wherein the comparator compares the output value with the duty cycle register and generates the output signal when the value of the accumulator is equal or greater to the value of the duty cycle register. </p><p id="p0014" num="0014">According to a further embodiment of the method, the transfer function can be provided by an adder which adds the numerical value to an accumulator having an overflow output. </p><p id="p0015" num="0015">According to a further embodiment of the method, the method may further comprise: selecting the overflow output signal or an output signal of the comparator as the output signal of the numerical oscillator. According to a further embodiment of the method, the method may further comprise: coupling a first input of an adder with an increment register, clocking the accumulator by a selectable clock signal and coupling an input of the accumulator with an output of the adder and an output of the accumulator with a second input of the adder, feeding the overflow output of the accumulator to a first input of an AND gate whose second input receives the selected clock signal, and feeding an output signal of the AND gate to a flip-flop having an output providing a selectable clock output signal as the overflow output signal. According to a further embodiment of the method, the increment register and/or the duty cycle register can be buffered. According to a further embodiment of the method, the method may further comprise selecting a clock input signal by a clock input multiplexer controlled by 
<!-- EPO <DP n="5"/>-->
 a control signal. According to a further embodiment of the method, a selectable clock signals may comprise an externally provided clock signal and/or an internally provided clock signal. According to a further embodiment of the method, the method may further comprise: providing a further clock output signal by a ripple counter having a clock input coupled with the selectable clock signal and a multiplexer having a plurality of inputs coupled with a counter value register of the ripple counter, wherein an output of the multiplexer is coupled with a reset input of an SR flip-flop whose set input is coupled with the overflow output of the accumulator, an inverted output of the SR flip-flop resets the ripple counter and a non- inverted output of the SR flip-flop provides the further clock output signal. According to a further embodiment of the method, the method may further comprise ANDing the selectable clock signal and an output signal provided by the non-inverting output of the SR flip-flop by an AND gate and feeding the ANDed signal to the clock input of the ripple counter. According to a further embodiment of the method, the method may further comprise controlling a polarity of the output signal of the numerical controlled oscillator. According to a further embodiment of the method, the method may further comprise providing an output signal of the AND gate as an interrupt signal. According to a further embodiment of the method, the method may further comprise using the digital clock signal within a microcontroller. 
<!-- EPO <DP n="6"/>-->
</p><p id="p0016" num="0016">BRIEF DESCRIPTION OF THE DRAWINGS </p><p id="p0017" num="0017">Fig. 1 shows a block diagram of a generic conventional numerical oscillator. </p><p id="p0018" num="0018">Fig. 2 shows an exemplary conventional numeric oscillator. </p><p id="p0019" num="0019">Fig. 3 shows an embodiment of an enhanced numerical oscillator. Fig. 4 shows a special function register for controlling the enhanced function according to various embodiments. </p><p id="p0020" num="0020">Fig. 5a-c show various output values for the enhanced numerical oscillator according to Fig. 3. </p><p id="p0021" num="0021">DETAILED DESCRIPTION Fig. 2 shows an exemplary conventional numerical controlled oscillator that can be implemented as peripheral device within a microcontroller. The Numerically Controlled Oscillator (NCO) module 100 is a timer that uses the overflow from the addition of an increment value to divide the input frequency. The advantage of the addition method over simple counter driven timer is that the resolution of division does not vary with the divider value. However, as mentioned above, other transfer functions may be used in a numerical oscillator. Thus, the present invention is not limited to a numerical oscillator using an adder per se. The NCO 100 is most useful for applications that require frequency accuracy and fine resolution at a fixed duty cycle. Certain features of such an NCO may include: 16-bit increment function, Fixed Duty Cycle (FDC) mode, Pulse Frequency (PF) mode, Output pulse width control, Multiple clock input sources, Output polarity control, and Interrupt capability. </p><p id="p0022" num="0022">The conventional embodiment as shown in Fig. 2, for example, provides for an input multiplexer 140 controlled by signal NxCKS&lt;l :0&gt; which may be a 2-bit control signal provided by a special function register to select one of four input clock signals NCOICL , LCI OUT, FOSC, or HFINTOSC. NCOI CLK may be an external clock signal that can be applied to a dedicated external pin. LCI OUT can be an internal low frequency signal, for example provided by an internal secondary oscillator. FOSC can be the internal system clock and HFINTOSC can be the internally generated clock from an internal RC oscillator. A pass 
<!-- EPO <DP n="7"/>-->
 gate 150 may be provided, controlled by an enable signal NxEN which again may be provided by a configuration register associated with the numeric controlled oscillator 100. The selected clock signal drives an accumulator 160 to store an output value processed by adder 130 which receives an increment value 1 10 at one input and the output value of the accumulator at its second input. Register 110 can be buffered by an additional buffer register 120 (shown in Fig. 3). Accumulator 160 has an overflow output which is coupled with the set input of RS-Flip-Flop 195 and the first input of AND gate 170. The second input of AND gate 170 receives the selected clock signal. The output of AND gate 170 provides a first internal output and is also connected with the clock input of D-Flip-Flop 180 whose inverted output is fed back to its D-input and whose non-inverted output Q provides a clock output of the numerical controlled oscillator fed to the first input of a output select multiplexer 190. </p><p id="p0023" num="0023">The selected clock is further fed from pass gate 150 to the first input of AND gate 170 whose output is coupled with the clock input of counter 175. The counter value is tapped by a multiplexer 185 whose inputs are connected with the respective bits of counter 175 and whose output is coupled with the reset input of RS-Flip-Flop 195. The inverted output of Flip-Flop 195 resets counter 175 and the non-inverted output Q of Flip-Flop 195 is fed back to the second input of AND gate 170 and provides the second output signal fed to the second input of multiplexer 190. The output of multiplexer 190 is coupled with the first input of OR gate 145 whose output provides a second internal output and is also fed to another switch 155 which feeds the output signal to a tri-state driver 165. OR gate 145 serves to invert or not invert the output of multiplexer 190 based on the state of its other input which is connected to a control register bit NxPOL of, for example, a special function register. </p><p id="p0024" num="0024">The NCO module operates in a fixed duty cycle operation mode by repeatedly adding a fixed value stored in register 1 10 to accumulator 160 by means of adder 130. Additions occur at the input clock rate provided by multiplexer 140 and enable gate 150. The accumulator 160 will overflow with a carry periodically, which is the raw NCO output signal. This output can be ANDed with the input clock by means of AND gate 172 to generate an output signal, for example an internal interrupt signal NCOxIF. This signal can further be routed through other logic 180 as shown in Fig. 2 and fed to a multiplexer 190 to generate a final output signal NCOxOUT which is used as the output signal of the numerical controlled oscillator. When multiplexer 190 selects the first input signal, the numerical controlled 
<!-- EPO <DP n="8"/>-->
 oscillator provides for a fixed duty cycle output signal NCOxOUT. Multiplexer 190 can also be controlled to select alternatively and optionally a pulse frequency modulation mode using counter 175 and associated logic 170, 185, 195 as shown in the lower part of Fig. 2. However, this additional mode is not required for the present embodiments and may thus be omitted. </p><p id="p0025" num="0025">According to the functionality of the NCO 100 when operating in fixed duty cycle mode, the input clock is reduced by the ratio of the addition value to the maximum accumulator value: 
<img id="imgf000008_0001" he="5" wi="26" file="imgf000008_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 clock frequency * Increment Value)/2<sup>n</sup>, wherein n is the accumulator width in bits. </p><p id="p0026" num="0026">The NCO output can be further modified by the additional logic 170, 175, 185, and 195 by stretching the pulse or toggling a flip-flop. The modified NCO output can then be distributed internally to other peripherals and optionally output to an external pin. The accumulator overflow also can generate an interrupt NCOxlF. The NCOxOUT signal period changes in discrete steps to create an average frequency. This output depends on the ability of the receiving circuit to average the NCOxOUT output to reduce uncertainty. </p><p id="p0027" num="0027">The accumulator 160 can be, for example, a 20-bit register. Read and write access to the accumulator 160 may be available, for example, through three 8-bit registers. The NCO Adder 130 can be a full adder, which operates independently from the system clock. The addition of the previous result and the increment value replaces the accumulator value on the rising edge of each input clock. </p><p id="p0028" num="0028">The increment value 1 10 can stored in two 8-bit registers 1 10 making up a 16-bit increment. Both of these registers 1 10 can be readable and writeable. The Increment registers 1 10 can be double-buffered by buffer 120 as shown in Fig. 3 to allow for value changes to be made without first disabling the NCO module 100. The buffer loads are immediate when the module is disabled. Writing to the increment register 1 10 first is necessary because then the buffer 120 is loaded synchronously with the NCO operation after the write is executed on the Increment register 1 10. 
<!-- EPO <DP n="9"/>-->
 In Fixed Duty Cycle (FDC) mode, when multiplexer 190 selects the first input, every time the accumulator 160 overflows, the output is toggled. This provides a 50% duty cycle, provided that the increment value remains constant. A timing diagram can be seen in the background window shown in Fig. 5. The FDC mode is selected by clearing a respective control bit in the NCO control register. </p><p id="p0029" num="0029">In Pulse Frequency (PF) mode, every time the accumulator 160 overflows, the output becomes active for one or more clock periods through additional circuitry 175, 185, 195 as shown in Fig. 2. Once the clock period expires, the output returns to an inactive state. This provides a pulsed output. The output becomes active on the rising clock edge immediately following the overflow event. The value of the active and inactive states depends on a polarity bit in the NCO control register. The PF mode is selected through multiplexer 190 by setting a respective bit in the NCO control register NxPFM which select the second input of multiplexer 190 as shown in Fig. 2. </p><p id="p0030" num="0030">When operating in PF mode, the active state of the output can vary in width by multiple clock periods. Various pulse widths are selected with respective bits in an NCO clock register which controls multiplexer 185. When the selected pulse width is greater than the accumulator overflow time frame, the output of the NCO operation may be indeterminate. </p><p id="p0031" num="0031">The last stage in the NCO module is the optional output polarity OR gate 145. The NxPOL bit in the NCO control register selects the output polarity. Changing the polarity while the interrupts are enabled may cause an interrupt for the resulting output transition. The NCO output can be used internally by source code or other peripherals. </p><p id="p0032" num="0032">The conventional numerical controlled oscillator 100 of Fig. 2 offers just two modes: 50% "fixed" duty cycle and "pulse frequency modulation" mode (one of 8 fixed counts). Therefore its functionality is limited. A frequency change causes unwanted change in duty cycle (PFM mode). </p><p id="p0033" num="0033">According to various embodiments, a numerical controlled oscillator can be enhanced to have additional features. According to various embodiments, for example, an NCO can be enhanced to allow arbitrary duty cycle options. Conventional NCO's do not support arbitrary 
<!-- EPO <DP n="10"/>-->
 duty cycle, but rather only a fixed number of taps. Thus, an NCO as shown in Fig. 2 can be enhanced with minimal additional silicon to provide for an enhanced functionality. </p><p id="p0034" num="0034">According to various embodiments, the design of an NCO peripheral 200, for example, for use in a microcontroller can be enhanced as shown in Fig. 3. As discussed above, conventional numerical controlled oscillators are implemented in microcontrollers for example, in 8 bit microcontroller devices such as the PlC12/16F150x and PIC10F3xx families manufactured by Applicant. The enhanced numerical controlled oscillator greatly improves a conventional NCO design by offering the ability to output an arbitrary duty cycle. The enhancement requires very little increase of silicon and is thus a very low cost improvement. As stated above the options of a conventional NCO as shown in Fig. 2 provide only a fixed 50% duty cycle, or a fixed "active" time based on 8 different settings of the register bits NxPWS. This gives very limited duty cycle options. Figure 3 shows an improved embodiment of a numerical controlled oscillator. The modifications, allow the NCO to add arbitrary duty cycle to the options this modules offers, without disturbing the current modes. To implement this feature, the multiplexer 210 controlled by NxPFM bits in a special function register is expanded to offer additional options. To this end, multiplexer 210 is controlled adding one extra NxPFM bit to select one of four inputs. The 4th option that results from the binary selection design of the multiplexer can be used in future enhancement options to the enhanced NCO peripheral and is marked "RFU" in Fig. 3. To implement the arbitrary duty cycle, a digital (magnitude) compare block 240 is used with a buffered duty cycle register 220/230. The number of bits may be equal to the accumulator 160, or may be less for a simpler implementation, wherein when less bits are used, the bits used in this case would be the most significant bits. The output sets a bit which controls the active and inactive state of the NCOxOUT output when multiplexer 210 selects input "11" as shown in Fig. 3. This change is shown in the circuit diagram of Fig. 3 with the additional elements compared to the conventional solution as shown in Fig. 2. </p><p id="p0035" num="0035">The value of the accumulator 160 in an NCO 200 is compared to a duty cycle register 220/230 which can be buffered according to some embodiments. The output of the comparison by comparator 240 generates a signal which results in a variable duty cycle pulse 
<!-- EPO <DP n="11"/>-->
 width modulation (PWM), wherein the duty cycle is based on the simple ratio between the duty cycle register 220/230 and the bits of the accumulator register 160. Thus, comparator 240 performs an either an "greater" comparison or according to another embodiment an "equal or greater" comparison. The solution allows fixed duty cycle even with changing frequency, as the duty cycle register 230 is always compared to the accumulator 160 which is always the same size. The example shown uses 20 bits, but any number of bits may be used for a wide frequency range. </p><p id="p0036" num="0036">As with other NCO designs, the increment register 1 10/120 sets the frequency. The comparison result between the accumulator 160 and the duty cycl e register 220/230 is not used to reset the output. </p><p id="p0037" num="0037">Any conventional NCO design only looks at the overflow bit which results in a 50% duty cycle. Thus, an enhanced numerical controlled oscillator 200 permits arbitrary duty cycle options and not just 8 time options, by the implementation of a true duty cycle register 220/230. A wide frequency range of operation is thus preserved. The implementation according to some embodiments can be code compatible with a conventional NCO as discussed above. Finally, the implementation does not require a lot of additional logic or redesign and therefore provides for a low cost enhancement. </p><p id="p0038" num="0038">Fig. 4 shows the effect provided by a true duty cycle. A 20 bit register allows selection of a duty cycle up to 100% with a 0.5ppm precision. Thus a duty cycle selection may only be limited due to jitter, however, any number of bits may be implemented. </p><p id="p0039" num="0039">Fig. 5a shows in the front window simulated output values of an enhanced numerical controlled oscillator wherein a duty cycle of 10% is selected. Fig. 5a shows in the front window simulated output values of an enhanced numerical controlled oscillator wherein a duty cycle of 50% is selected. Fig. 5c shows in the front window simulated output values of an enhanced numerical controlled oscillator wherein a duty cycle of 90% is selected. 
</p></description><claims mxw-id="PCLM70076664" ref-ucid="WO-2014130754-A1" lang="EN" load-source="patent-office"><claim id="clm-0001" num="1"><!-- EPO <DP n="12"/>--><claim-text> CLAIMS </claim-text><claim-text>WHAT IS CLAIMED IS: 1. A numerical controlled oscillator generating an output signal with a digital clock signal having a variable frequency, wherein the numerical oscillator is controlled by a programmable numerical value being subject to a transfer function and comprises a comparator configured to compare whether an output of the transfer function with a duty cycle register and to generate the output signal. </claim-text></claim><claim id="clm-0002" num="2"><claim-text>2. The numerical controlled oscillator according to claim 1, wherein the transfer function is an addition provided by an adder and wherein an average frequency of the variable frequency can be controlled by an increment register storing said numerical value whose content is added by the adder to an accumulator having an overflow output, and wherein the duty cycle register is coupled with the comparator comprising a "greater" or "equal or greater" function. </claim-text></claim><claim id="clm-0003" num="3"><claim-text>3. The numerical controlled oscillator according to claim 2, comprising an output multiplexer operable to select an output signal based on the overflow output or an output signal of the comparator. </claim-text></claim><claim id="clm-0004" num="4"><claim-text>4. The numerical controlled oscillator according to claim 3, wherein a first input of the adder is coupled with the increment register, the accumulator is clocked by a selectable clock signal and has an input coupled with an output of the adder and an output coupled with a second input of the adder, wherein the overflow output is coupled with a first input of an AND gate whose second input receives the selected clock signal, and a flip-flop having an input coupled with the output of the AND gate and an output coupled with one input of the output multiplexer. </claim-text></claim><claim id="clm-0005" num="5"><claim-text>5. The numerical controlled oscillator according to claim 2, wherein the increment register is buffered. 
<!-- EPO <DP n="13"/>-->
</claim-text></claim><claim id="clm-0006" num="6"><claim-text>6. The numerical controlled oscillator according to claim 1 , wherein the duty cycle register is buffered. </claim-text></claim><claim id="clm-0007" num="7"><claim-text>7. The numerical controlled oscillator according to claim 4, further comprising a clock input multiplexer controlled by a control signal to select one of a plurality of input clock signals. </claim-text></claim><claim id="clm-0008" num="8"><claim-text>8. The numerical controlled oscillator according to claim 7, wherein the selectable clock signals comprise an externally provided clock signal and/or an internally provided clock signal. </claim-text></claim><claim id="clm-0009" num="9"><claim-text>9. The numerical controlled oscillator according to claim 4, further comprising a ripple counter having a clock input coupled with the selectable clock signal and a multiplexer having a plurality of inputs coupled with a counter value register of said ripple counter, wherein an output of the multiplexer is coupled with a reset input of an SR flip-flop whose set input is coupled with the overflow output of the accumulator, an inverted output of the SR flip-flop resets said ripple counter and a non-inverted output of the SR flip-flop is coupled with a further input of said output multiplexer. </claim-text></claim><claim id="clm-0010" num="10"><claim-text>10. The numerical controlled oscillator according to claim 9, further comprising an AND gate having an output coupled with the clock input of the ripple counter and having a first input receiving the selectable clock signal and a second input coupled with the non-inverting output of the SR flip-flop. </claim-text></claim><claim id="clm-0011" num="11"><claim-text>1 1. A microcontroller comprising a numerical controlled oscillator according to claim 1. </claim-text></claim><claim id="clm-0012" num="12"><claim-text>12. A method of generating a clock signal, comprising the steps of: </claim-text><claim-text> providing an output signal with a digital clock signal having a variable frequency by a numerical controlled oscillator by subjecting a numerical value to a transfer function generating an output value, </claim-text><claim-text> providing a duty cycle register coupled with a comparator, wherein the comparator compares the output value with the duty cycle register and generates the output signal when the value of the accumulator is equal or greater to the value of the duty cycle register. 
<!-- EPO <DP n="14"/>-->
</claim-text></claim><claim id="clm-0013" num="13"><claim-text>13. The method according to claim 12, wherein the transfer function is provided by adder which adds the numerical value to an accumulator having an overflow output. </claim-text></claim><claim id="clm-0014" num="14"><claim-text>14. The method according to claim 13, further comprising </claim-text><claim-text> selecting the overflow output signal or an output signal of the comparator as the output signal of the numerical oscillator. </claim-text></claim><claim id="clm-0015" num="15"><claim-text>15. The method according to claim 14, further comprising </claim-text><claim-text> coupling a first input of an adder with an increment register, </claim-text><claim-text>clocking the accumulator by a selectable clock signal and </claim-text><claim-text>coupling an input of the accumulator with an output of the adder and an output of the accumulator with a second input of the adder, </claim-text><claim-text>feeding the overflow output of the accumulator to a first input of an AND gate whose second input receives the selected clock signal, and </claim-text><claim-text>feeding an output signal of the AND gate to a flip-flop having an output providing a selectable clock output signal as the overflow output signal. </claim-text></claim><claim id="clm-0016" num="16"><claim-text>16. The method according to claim 15, wherein the increment register is buffered. </claim-text></claim><claim id="clm-0017" num="17"><claim-text>17. The method according to claim 12, wherein the duty cycle register is buffered. </claim-text></claim><claim id="clm-0018" num="18"><claim-text>18. The method according to claim 15, further comprising selecting a clock input signal by a clock input multiplexer controlled by a control signal. </claim-text></claim><claim id="clm-0019" num="19"><claim-text>19. The method according to claim 18, wherein an selectable clock signals comprise an externally provided clock signal and/or an internally provided clock signal. 
<!-- EPO <DP n="15"/>-->
</claim-text></claim><claim id="clm-0020" num="20"><claim-text>20. The method according to claim 15, further comprising providing a further clock output signal by a ripple counter having a clock input coupled with the selectable clock signal and a multiplexer having a plurality of inputs coupled with a counter value register of said ripple counter, wherein an output of the multiplexer is coupled with a reset input of an SR flip-flop whose set input is coupled with the overflow output of the accumulator, an inverted output of the SR flip-flop resets said ripple counter and a non-inverted output of the SR flip-flop provides said further clock output signal. </claim-text></claim><claim id="clm-0021" num="21"><claim-text>21. The method according to claim 20, further comprising ANDing the selectable clock signal and an output signal provided by the non-inverting output of the SR flip-flop by an</claim-text><claim-text>AND gate and feeding the ANDed signal to the clock input of the ripple counter. </claim-text></claim><claim id="clm-0022" num="22"><claim-text>22. The method according to claim 12, further comprising controlling a polarity of the output signal of the numerical controlled oscillator. </claim-text></claim><claim id="clm-0023" num="23"><claim-text>23. The method according to claim 21 , further comprising providing an output signal of said AND gate as an interrupt signal. </claim-text></claim><claim id="clm-0024" num="24"><claim-text>24. The method according to claim 12, further comprising using said digital clock signal within a microcontroller. 
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
