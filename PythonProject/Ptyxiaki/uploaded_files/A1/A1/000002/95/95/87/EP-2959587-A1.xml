<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2959587-A1" country="EP" doc-number="2959587" kind="A1" date="20151230" family-id="51350757" file-reference-id="263984" date-produced="20180825" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160453074" ucid="EP-2959587-A1"><document-id><country>EP</country><doc-number>2959587</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14754237-A" is-representative="NO"><document-id mxw-id="PAPP193869116" load-source="docdb" format="epo"><country>EP</country><doc-number>14754237</doc-number><kind>A</kind><date>20140219</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193869117" load-source="patent-office" format="original"><country>EP</country><doc-number>14754237.7</doc-number><date>20140219</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162026205" ucid="US-201361766773-P" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>201361766773</doc-number><kind>P</kind><date>20130220</date></document-id></priority-claim><priority-claim mxw-id="PPC162034972" ucid="US-2014017098-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>US</country><doc-number>2014017098</doc-number><kind>W</kind><date>20140219</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1833755351" load-source="docdb">H03L   7/16        20060101ALI20170313BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1833755352" load-source="docdb">H03L   7/099       20060101AFI20170313BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1833755353" load-source="docdb">H03L   7/085       20060101ALN20170313BHEP        </classification-ipcr><classification-ipcr mxw-id="PCL-1833755354" load-source="docdb">H03L   1/02        20060101ALI20170313BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1892465766" load-source="docdb" scheme="CPC">H03L   7/085       20130101 LA20151015BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1906581606" load-source="docdb" scheme="CPC">H03L   7/091       20130101 LA20160818BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1906589206" load-source="docdb" scheme="CPC">H03L   7/093       20130101 LA20160818BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987764134" load-source="docdb" scheme="CPC">H03L2207/50        20130101 LA20151016BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987765159" load-source="docdb" scheme="CPC">H03L   1/026       20130101 FI20140821BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987769338" load-source="docdb" scheme="CPC">H03L   7/099       20130101 LI20151016BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987779349" load-source="docdb" scheme="CPC">H03L   1/027       20130101 LI20151016BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987780973" load-source="docdb" scheme="CPC">H03L2207/06        20130101 LA20151016BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987786128" load-source="docdb" scheme="CPC">H03L   7/16        20130101 LI20151016BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987790901" load-source="docdb" scheme="CPC">H03L   1/04        20130101 LI20151015BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165550688" lang="DE" load-source="patent-office">EINZELEINSATZBESCHNEIDUNG VON HOCHGENAUEN REFERENZOSZILLATOREN</invention-title><invention-title mxw-id="PT165550689" lang="EN" load-source="patent-office">SINGLE INSERTION TRIMMING OF HIGHLY ACCURATE REFERENCE OSCILLATORS</invention-title><invention-title mxw-id="PT165550690" lang="FR" load-source="patent-office">RÉGLAGE FIN D'INSERTION UNIQUE D'OSCILLATEURS DE RÉFÉRENCE DE TRÈS GRANDE PRÉCISION</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103323663" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>SI WARE SYSTEMS</last-name><address><country>US</country></address></addressbook></applicant><applicant mxw-id="PPAR1103344419" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>SI-WARE SYSTEMS</last-name></addressbook></applicant><applicant mxw-id="PPAR1101653176" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>SI-Ware Systems</last-name><iid>101434343</iid><address><street>1100 Foothill Blvd.</street><city>La Canada, CA 91011</city><country>US</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103313881" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>ELKHOLY AHMED</last-name><address><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103319175" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>ELKHOLY, Ahmed</last-name></addressbook></inventor><inventor mxw-id="PPAR1101648054" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>ELKHOLY, Ahmed</last-name><address><street>3405 Nw Orchard Pkwy. 289</street><city>Covalis, OR 97330</city><country>US</country></address></addressbook></inventor><inventor mxw-id="PPAR1103313487" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>AHMED AYMAN</last-name><address><country>EG</country></address></addressbook></inventor><inventor mxw-id="PPAR1103306185" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>AHMED, AYMAN</last-name></addressbook></inventor><inventor mxw-id="PPAR1101643483" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>AHMED, AYMAN</last-name><address><street>39 Hassan Aflaton Street Nasr City</street><city>Cairo 11341</city><country>EG</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101646146" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Dienwiebel, Thomas</last-name><iid>101390548</iid><address><street>Dienwiebel Transatlantic Intellectual Property Lechnerstraße 25a</street><city>82067 Ebenhausen</city><country>DE</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="US-2014017098-W"><document-id><country>US</country><doc-number>2014017098</doc-number><kind>W</kind><date>20140219</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014130525-A1"><document-id><country>WO</country><doc-number>2014130525</doc-number><kind>A1</kind><date>20140828</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660632987" load-source="docdb">AL</country><country mxw-id="DS660634295" load-source="docdb">AT</country><country mxw-id="DS660632989" load-source="docdb">BE</country><country mxw-id="DS660739196" load-source="docdb">BG</country><country mxw-id="DS660710736" load-source="docdb">CH</country><country mxw-id="DS660631995" load-source="docdb">CY</country><country mxw-id="DS660634296" load-source="docdb">CZ</country><country mxw-id="DS660714259" load-source="docdb">DE</country><country mxw-id="DS660632990" load-source="docdb">DK</country><country mxw-id="DS660631996" load-source="docdb">EE</country><country mxw-id="DS660719369" load-source="docdb">ES</country><country mxw-id="DS660739197" load-source="docdb">FI</country><country mxw-id="DS660739198" load-source="docdb">FR</country><country mxw-id="DS660714260" load-source="docdb">GB</country><country mxw-id="DS660633003" load-source="docdb">GR</country><country mxw-id="DS660714261" load-source="docdb">HR</country><country mxw-id="DS660631997" load-source="docdb">HU</country><country mxw-id="DS660710737" load-source="docdb">IE</country><country mxw-id="DS660633004" load-source="docdb">IS</country><country mxw-id="DS660739203" load-source="docdb">IT</country><country mxw-id="DS660633005" load-source="docdb">LI</country><country mxw-id="DS660714262" load-source="docdb">LT</country><country mxw-id="DS660634297" load-source="docdb">LU</country><country mxw-id="DS660714275" load-source="docdb">LV</country><country mxw-id="DS660714276" load-source="docdb">MC</country><country mxw-id="DS660634298" load-source="docdb">MK</country><country mxw-id="DS660634315" load-source="docdb">MT</country><country mxw-id="DS660719370" load-source="docdb">NL</country><country mxw-id="DS660791430" load-source="docdb">NO</country><country mxw-id="DS660719375" load-source="docdb">PL</country><country mxw-id="DS660634316" load-source="docdb">PT</country><country mxw-id="DS660719376" load-source="docdb">RO</country><country mxw-id="DS660634317" load-source="docdb">RS</country><country mxw-id="DS660719377" load-source="docdb">SE</country><country mxw-id="DS660631998" load-source="docdb">SI</country><country mxw-id="DS660791431" load-source="docdb">SK</country><country mxw-id="DS660791432" load-source="docdb">SM</country><country mxw-id="DS660739204" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA139073257" ref-ucid="WO-2014130525-A1" lang="EN" load-source="patent-office"><p num="0000">A highly integrated monolithic self-compensated oscillator (SCO) with high frequency stability versus temperature variations is described, together with a cost effective single insertion point trimming (SPT) algorithm. The SPT is utilized to adjust the phase and frequency of the SCO to meet frequency stability versus temperature and frequency accuracy requirements for a reference clock.. The techniques used in the SPT algorithm provide a robust, fast and low testing cost for the SCO. Moreover, the concepts and techniques utilized in the SCO SPT can be used effectively for any temperature compensated oscillator (TCO) including TCXO, MEMS, FBAR and RC oscillators. Additionally, the described SPT algorithm is capable of measuring the temperature sensitivity of any oscillator, estimating suitable temperature compensation parameters and adjusting the oscillator frequency to the required value simultaneously.</p></abstract><abstract mxw-id="PA139540906" ref-ucid="WO-2014130525-A1" lang="EN" source="national office" load-source="docdb"><p>A highly integrated monolithic self-compensated oscillator (SCO) with high frequency stability versus temperature variations is described, together with a cost effective single insertion point trimming (SPT) algorithm. The SPT is utilized to adjust the phase and frequency of the SCO to meet frequency stability versus temperature and frequency accuracy requirements for a reference clock.. The techniques used in the SPT algorithm provide a robust, fast and low testing cost for the SCO. Moreover, the concepts and techniques utilized in the SCO SPT can be used effectively for any temperature compensated oscillator (TCO) including TCXO, MEMS, FBAR and RC oscillators. Additionally, the described SPT algorithm is capable of measuring the temperature sensitivity of any oscillator, estimating suitable temperature compensation parameters and adjusting the oscillator frequency to the required value simultaneously.</p></abstract><abstract mxw-id="PA139073258" ref-ucid="WO-2014130525-A1" lang="FR" load-source="patent-office"><p num="0000">La présente invention a trait à un oscillateur autocompensé monolithique hautement intégré (SCO) qui est doté d'une stabilité de fréquence élevée par rapport à des variations de température, ainsi qu'à un algorithme de réglage fin de point d'insertion unique (SPT) rentable. Le SPT est utilisé de manière à ajuster la phase et la fréquence du SCO en vue d'obtenir une stabilité de fréquence par rapport à des exigences de précision de température et de fréquence d'une horloge de référence. Les techniques qui sont utilisées dans l'algorithme SPT offrent un SCO robuste, rapide et présentant un faible coût d'essai. De plus, les concepts et les techniques qui sont utilisées dans le SPT du SCO peuvent être utilisés de façon efficace pour tout oscillateur à compensation de température (TCO) y compris des oscillateurs à quartz à compensation de température, des microsystèmes électromécaniques, des FBAR et des oscillateurs résistance-capacité. En outre, l'algorithme SPT décrit est en mesure de mesurer la sensibilité thermique de tout oscillateur, d'estimer des paramètres de compensation de température appropriés et d'ajuster la fréquence de l'oscillateur sur la valeur requise simultanément.</p></abstract><abstract mxw-id="PA139540907" ref-ucid="WO-2014130525-A1" lang="FR" source="national office" load-source="docdb"><p>La présente invention a trait à un oscillateur autocompensé monolithique hautement intégré (SCO) qui est doté d'une stabilité de fréquence élevée par rapport à des variations de température, ainsi qu'à un algorithme de réglage fin de point d'insertion unique (SPT) rentable. Le SPT est utilisé de manière à ajuster la phase et la fréquence du SCO en vue d'obtenir une stabilité de fréquence par rapport à des exigences de précision de température et de fréquence d'une horloge de référence. Les techniques qui sont utilisées dans l'algorithme SPT offrent un SCO robuste, rapide et présentant un faible coût d'essai. De plus, les concepts et les techniques qui sont utilisées dans le SPT du SCO peuvent être utilisés de façon efficace pour tout oscillateur à compensation de température (TCO) y compris des oscillateurs à quartz à compensation de température, des microsystèmes électromécaniques, des FBAR et des oscillateurs résistance-capacité. En outre, l'algorithme SPT décrit est en mesure de mesurer la sensibilité thermique de tout oscillateur, d'estimer des paramètres de compensation de température appropriés et d'ajuster la fréquence de l'oscillateur sur la valeur requise simultanément.</p></abstract><description mxw-id="PDES78476872" ref-ucid="WO-2014130525-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="2"/>--><p id="p0001" num="0001"> SINGLE INSERTION TRIMMING OF HIGHLY ACCURATE REFERENCE </p><p id="p0002" num="0002"> OSCILLATORS </p><p id="p0003" num="0003">BACKGROUND </p><p id="p0004" num="0004">The techniques described relate to the trimming and calibration of oscillators, and more particularly highly accurate oscillators which can serve as clock references in electronic platforms. </p><p id="p0005" num="0005">Clock reference oscillators must provide a highly stable output frequency versus the variation of the different electrical and environmental conditions such as and not limited to supply voltage, temperature, stress, humidity and aging. The trimming of such oscillator is imperative to achieve high performance. </p><p id="p0006" num="0006"> The ever increasing complexity of electronic systems due to requirements of supporting multiple standards, increased functionality, higher data rates and memory in a smaller size and at a lower cost is pushing designers to increase the integration level through the development of Systems on Chip (SoC) in deep submicron Complimentary MOS (CMOS) technologies to benefit from the increased gate density. Every application requires a reference clock where the oscillator frequency must not vary due to changes in supply voltage and temperature by more than a specific amount. 
<!-- EPO <DP n="3"/>-->
 Quartz crystal oscillators (XOs) are the industry standard for generating a reference clock. The mature and stable technology of quartz crystals permits excellent control on the manufacturing process to select an exact cut angle to produce superior performance. Crystal oscillators stemming from the very high quality factor (Q) of the quartz crystal can achieve high frequency accuracy, low frequency drift with temperature and low phase noise. Consequently, crystal oscillators dominated the commercial market for many decades. However, crystals have not managed to scale nor integrate thus limiting the size and cost reduction of the reference clock. </p><p id="p0007" num="0007">Recent efforts in using high-Q Micro-Electro-Mechanical Systems (MEMS) resonators and Film Bulk Acoustic Resonators (FBARs) have illustrated possibilities of integrating a high-Q element and Application Specific Integrated Circuits (ASIC) in the same package. The cost of a MEMS resonator is lower than a quartz one owing to the very high number of resonators on a single MEMS wafer. Expensive ceramic packaging of crystal oscillators is also reduced to low cost plastic packaging. However, the assembly cost of a MEMS-based solution requires stacking of the wafer level packaged MEMS die and the CMOS die. Additionally, elaborate production testing is required to trim each part to the required performance over the specified temperature range. This process may require more than one temperature insertion to estimate the temperature compensation parameters and to adjust the oscillator frequency to the required value. This makes the testing cost of MEMS and FBAR oscillators too high to compete with XOs for consumer applications. 
<!-- EPO <DP n="4"/>-->
 Another approach is to produce reference clocks using RC oscillators. Due to the low quality factor of an RC oscillator the frequency accuracy is limited, but excellent power consumption and full integration can be achieved, making this solution suitable for applications like wireless sensors networks (WSN). However, the testing cost of RC oscillators like MEMS and FBAR oscillators is very high due the extensive trimming which usually requires more than one temperature insertion point. </p><p id="p0008" num="0008">An alternative technology uses an all silicon CMOS reference clock based on an on- chip LC-tank. Such solutions are by definition highly integrated and have short lead times due to their programmability compared to XOs. Moreover, they can provide frequency accuracy and phase noise performances comparable to XOs. However, the large temperature dependence of LC-tanks has been the main challenge in designing an LC-tank based reference which requires sophisticated compensation techniques to neutralize the frequency variation. To successfully achieve the required accuracy in compensation it is imperative not just to have an accurate temperature measurement but to also have precise knowledge of the oscillator frequency across temperature and its frequency tuning control(s). </p><p id="p0009" num="0009">One trimming routine starts by selecting a center frequency (f<sub>0</sub>) at a first temperature using a capacitor bank. Then at a second temperature the algorithm couples one or more resistances to the resonator as a method of temperature compensation. After that at a next temperature, the algorithm determines whether the required calibration has occurred over the predetermined temperature range or not. In case of not achieving the required performance the previous steps have to be redone iteratively until the total temperature 
<!-- EPO <DP n="5"/>-->
 dependence of the oscillator is minimized over the predetermined temperature range while attaining the required output frequency. Consequently, more than one temperature insertion point is required to achieve acceptable performance thus increasing the complexity of product testing and consequently increasing the overall cost of the product. </p><p id="p0010" num="0010">An all silicon CMOS reference clock is described in U.S. Patent 8,072,281. It uses an on-chip LC-tank designed to operate at a very specific low temperature-sensitivity phase operating point. Thus, the architecture is applicable to a Self-Compensated Oscillator (SCO) that is self-compensated across temperature. 
<!-- EPO <DP n="6"/>-->
</p><p id="p0011" num="0011">BRIEF DESCRIPTION OF THE DRAWING FIGURES The present invention may be understood from the following detailed description in conjunction with the appended drawing figures. In the drawing: </p><p id="p0012" num="0012">FIG. 1(A) is plot illustrating the concept of a temperature null and corresponding phase.</p><p id="p0013" num="0013">FIG. 1(B) is a plot of frequency variation over temperature when operating at the temperature null, for different temperature ranges. </p><p id="p0014" num="0014"> FIG. 2 is a diagram of a temperature-compensated LC oscillator. </p><p id="p0015" num="0015"> FIG. 3 is a diagram illustrating temperature modulation for purposes of determining temperature sensitivity of oscillation frequency. </p><p id="p0016" num="0016"> FIG. 4 is a diagram of a calibration system for determining temperature sensitivity. </p><p id="p0017" num="0017">FIG. 5 is a diagram of another calibration system for determining temperature sensitivity. FIG. 6(A) is a diagram illustrating in circuit form how a phase shift calibration value may be determined. </p><p id="p0018" num="0018"> FIG. 6(B) is a diagram illustrating operation of the circuit of FIG. 6(A). </p><p id="p0019" num="0019"> FIG. 7(A) is a diagram illustrating in circuit form a different way of determining a phase shift calibration value. </p><p id="p0020" num="0020"> FIG. 7(B) is a diagram illustrating operation of the circuit of FIG. 7(A). </p><p id="p0021" num="0021"> FIG. 8 is a diagram illustrating in circuit form how a frequency setting calibration value may be determined. </p><p id="p0022" num="0022"> FIG. 9 is a flow chart of a calibration process. </p><p id="p0023" num="0023"> FIG. 10 is a diagram illustrating in circuit form a different way of determining a frequency setting calibration. 
<!-- EPO <DP n="7"/>-->
 FIG. 11 is a diagram of a calibration system for determining both phase shift and frequency setting calibration values. </p><p id="p0024" num="0024"> FIG. 12 is a diagram of another calibration system for determining both phase shift and frequency setting calibration values. </p><p id="p0025" num="0025"> FIG. 13(A) is a diagram of a heater element. </p><p id="p0026" num="0026"> FIG. 13(B) is a diagram of another heater element. </p><p id="p0027" num="0027"> FIG. 14 is a diagram of oscillation, compensation and sensing circuitry. </p><p id="p0028" num="0028"> FIG. 15 is a diagram of temperature modulation circuitry. </p><p id="p0029" num="0029"> FIG. 16 is a diagram of another temperature modulation circuit. </p><p id="p0030" num="0030"> FIG. 17 is a diagram of still another temperature modulation circuit. </p><p id="p0031" num="0031"> FIG. 18 is a diagram of a frequency-to-digital converter. </p><p id="p0032" num="0032"> FIG. 19 is a diagram of another frequency-to-digital converter. </p><p id="p0033" num="0033"> FIG. 20 is a diagram of a generalized temperature compensation system. </p><p id="p0034" num="0034"> FIG. 21 is a diagram of a generalized calibration system for temperature compensation system. 
<!-- EPO <DP n="8"/>-->
</p><p id="p0035" num="0035">DETAILED DESCRIPTION </p><p id="p0036" num="0036"> Summary </p><p id="p0037" num="0037"> A self compensated oscillator architecture utilizes phase shift circuitry to achieve minimum frequency deviation across temperature. It provides an electrical phase shift that is accurate, temperature independent and programmable through a digital phase setting (PS) word. The SCO requires trimming to get an optimum operating phase setting (PS<sub>opt</sub>) in the predetermined temperature range and to adjust the oscillator output frequency to a target frequency by setting the oscillator's frequency setting (FS). </p><p id="p0038" num="0038">In one embodiment, an SPT alogorithm is provided for the SCO, thus reducing the testing cost while achieving high frequency stability. The present appartus is capable of finding the optimum phase operating point and of adjusting the oscillator frequency to the required value simultaneously. Thus it provides a robust, fast and low cost trimming solution for SCO thus decreasing the complexity of product testing and consequently decreasing the overall cost of the product. </p><p id="p0039" num="0039">Description </p><p id="p0040" num="0040"> An LC oscillator is composed of an LC-Tank and an amplifier which is responsible for overcoming the tank losses. For the oscillator to have sustained oscillations the Barkhausen criterion requires an open loop gain greater than unity and phase equal to zero. Assuming that the used amplifier contributes a zero phase thus, at oscillation conditions, the LC-Tank impedance Z<sub>Tank</sub> will have a zero phase. Figure 1(B) shows ZTank phase versus frequency at different temperatures; a zero phase intersection with the 
<!-- EPO <DP n="9"/>-->
 tank phase curves over temperature (0°C-70°C) results in a large frequency variation ΐι. As seen in Figure 1(A), the tank phase curves across temperature intersect at a negative phase where frequency variation across temperature is minimized (frequency variation ΔίΝυι ). </p><p id="p0041" num="0041">The conditions at which minimum temperature sensitivity of frequency occurs is termed the LC-tank temperature null (TNLXL) and the phase across the tank is referred to as (pNULL- As shown in Figure 2, the oscillator may be formed of a transconductor stage 201 and a phase shift stage 203. Phase magnitude is controlled via a digital phase setting (PS) word with very fine steps, while the oscillator frequency is tuned by changing the effective capacitance value of the tank impedance (Ziank) 205 using a frequency setting (FS) word with very fine steps. At steady state, the transconductor and phase shifter provide a phase that is the negative of the required TNULL phase. Thus, the LC-tank is forced to oscillate at the required non-zero (pNuix- One of the most important design aspects of the phase shift circuitry is to provide a phase that is accurate and temperature independent, otherwise frequency deviation will increase. </p><p id="p0042" num="0042">The SCO relies on operating at c Nui to achieve a high frequency stability across a specific temperature range. However, the value of (pNuix will vary with process, oscillation frequency and the required operating temperature range. Thus, trimming is required to compensate for these variations. Trimming is one of the main challenges in having a highly accurate and fully-integrated LC-based reference oscillator as it can limit the overall cost and accuracy of the oscillator. The main objective of the trimming of the 
<!-- EPO <DP n="10"/>-->
 SCO is to set the oscillator's phase to (p<sub>N</sub>uix and at the same time adjust the oscillator's frequency to the required output frequency. </p><p id="p0043" num="0043">There are many challenges to develop an accurate, robust and cost effective trimming solution for SCO. The first challenge is that a direct method for measuring the tank phase across temperature to determine directly the value of (p<sub>N</sub>ui does not exist. Consequently, the brute force solution to find (pNuix is to measure the oscillator's frequency while varying PS at the two extreme temperature points of the required operating range. The tank PS that minimizes the absolute frequency difference between the two extreme temperature points is considered the global (p<sub>N</sub>uix. However, this two temperature point trimming solution is not cost effective due to the high cost of the two required temperature insertions. Additionally, a very long testing time is usually required for a large number of accurate frequency measurements. The second challenge is that (pNuix slightly changes as the oscillator's frequency changes. Moreover, the oscillator's frequency depends on the tank PS word. Thus, this coupled relation between the oscillator's frequency and the oscillator's temperature dependence imposes multiple trimming iterations to find (pNuix and to adjust the oscillator's frequency to the required value simultaneously. </p><p id="p0044" num="0044">The following robust on-chip SPT algorithm overcomes these two challenges and enables achieving a highly accurate and cost effective SCO reference oscillator. Trimming is required to set PS<sub>opt</sub> so that the oscillator operates at ( Nin with minimum frequency deviation across temperature, and at the same time adjusts the oscillator frequency to the required frequency by setting the oscillator's FS . The trimmed value of 
<!-- EPO <DP n="11"/>-->
 PS and FS are digitally stored on a non-volatile memory for future retrieval such as a One-Time Programmable (OTP) Read Only Memory (ROM) on chip after trimming. </p><p id="p0045" num="0045">SCO Temperature Sensitivity (K<sub>T</sub>) Detection </p><p id="p0046" num="0046"> Conceptually, the temperature dependence of any oscillator can be estimated at T<sub>0</sub> by applying a square wave temperature modulating signal as shown in Figure 3. The output of an oscillator 301 in response to the temperature modulating signal will be a frequency modulated (FM) signal that depends on the frequency versus temperature dependence slope (K<sub>T</sub>) at this temperature. The oscillator frequency (F<sub>osc</sub>) can then be converted into a digital word (D<sub>osc</sub>) using an accurate frequency-to-digital converter (FDC) 303 that performs FM demodulation to the oscillator output. The value of K<sub>T</sub> at T<sub>0</sub> can be estimated from the frequency difference F<sub>0SC</sub>(T<sub>0</sub> + ΔΤ/2) - F<sub>0SC</sub>(T<sub>0</sub> - ΔΤ/2) where ΔΤ represents a variation in temperature around T<sub>0</sub>. Equivalently, the difference between D<sub>0SC</sub>(T<sub>0</sub> + ΔΤ/2) and D<sub>0SC</sub>(T<sub>0</sub>— ΔΤ/2) can be utilized to generate the same estimate. </p><p id="p0047" num="0047">The difference between these two digital words gives an accurate digital representation of K<sub>T</sub> that is utilized in the present SPT trimming algorithm. The concept is illustrated in Figure 3 where K<sub>T</sub> of the SCO is estimated using a temperature modulating signal and an FDC. At (p<sub>NULL</sub>, the SCO temperature dependence can be parabolic-like and T<sub>0</sub> is the center of the required temperature range as illustrated previously in Figure 1(B). Thus at T<sub>0</sub>, if K<sub>T</sub>=0 would imply a minimum SCO oscillation frequency temperature variation across a specific temperature range. 
<!-- EPO <DP n="12"/>-->
 Different methods of temperature modulation of oscillators may be used to determine their temperature sensitivity τ for single insertion temperature point trimming. In one embodiment, on-chip heaters are used to generate different temperature modulation waveforms. The temperature modulation waveform can be any shape including sinusoidal, triangular, saw tooth or square waveform. The example demonstrates a square or an ON/OFF modulating waveform. This approach can be easily extended to trim other reference oscillators including TCXO, MEMS, FBA , and RC oscillators. </p><p id="p0048" num="0048">The architecture may employ a simple ON/OFF temperature modulation, thus simplifying the temperature modulation module. Practically, the thermal modulation frequency is limited by the thermal time constant of the packaged part under test. Thus, the temperature modulating square wave is low pass filtered as illustrated in Figure 4. A temperature modulation module 401 applies temperature modulation to an oscillator 403 under control of a digital controller 405. An output signal of the oscillator is applied to an FDC 407. A temperature sensitivity detection module 409 uses an output signal of the FDC 407 and an excitation signal from the digital controller 405 to determine K<sub>T</sub>. </p><p id="p0049" num="0049">The thermal time constant depends on many factors mainly die size and package size. As the thermal modulation frequency decreases, the trimming routine becomes slower. Thus, testing cost increases, impacting the overall cost of SCO. Consequently, it becomes very important to reach PS<sub>opt</sub> that is equivalent to (p<sub>NULL</sub> in a minimum number of thermal modulation cycles. Oscillator's thermal and flicker phase noise affect the accuracy of the SPT especially when K<sub>T</sub> approaches zero as the magnitude of the demodulated signal becomes very close to zero too. 
<!-- EPO <DP n="13"/>-->
 The impact of phase noise at very low frequency offsets on K<sub>T</sub> is insignificant as sensing K<sub>T</sub> depends on the difference between two frequencies. Thus, most of the noise will be cancelled. However, phase noise at high frequency offsets is effective and can be suppressed by incorporating an integrate and dump filter. Only half of the heating and cooling periods are utilized by the integrate and dump filter due to the low pass filter effect induced by the slow thermal time constant of the package under test. A set percentage of the heating cycle period is integrated into A<sub>hot</sub> while a similar percentage of the cooling cycle period is integrated into A<sub>co</sub>i<sub>d</sub> as shown in Figure 4. The difference between A<sub>hot</sub> and A<sub>cold</sub> is thus a digital word that represents K<sub>T</sub> more accurately in the presence of oscillator phase noise and a large thermal time constant. In this manner, only phase noise at frequency offsets close to the modulation frequency can slightly affect the accuracy of K<sub>T</sub> sensing and consequently the results of SPT. </p><p id="p0050" num="0050">Another method for finding the Κχ of any oscillator at T<sub>0</sub> is illustrated in Figure 5. As compared to Figure 4, a triangular excitation signal is used to obtain a triangular temperature modulation characteristic. A temperature excitation signal superimposed over T<sub>0</sub> is applied to the oscillator through a temperature modulation module. The oscillator frequency will act in response to the temperature modulation signal according to its characteristic K-p. The FDC will convert the oscillator frequency into a digital word (Dose)- If the excitation signal is a triangular wave, then Δί/ΔΤ can be obtained using a difference block 501. During the negative slope of the triangular wave ΔΤ is negative so the output of the difference block 501 is multiplied by the slope sign of the triangular wave using a multiplier 503 to finally obtain a digital word that accurately represents Κχ 
<!-- EPO <DP n="14"/>-->
 at T<sub>0</sub>. The difference block 501 helps to filter out the close-in phase noise of the oscillator while an Integrate &amp; Dump filter 505 is used to suppress high frequency noise. Consequently, Κχ can be measured more accurately. This triangular wave modulation enables using a higher thermal modulation frequency over a square wave modulation technique, consequently a faster trimming routine. (The structure 550 is reused as structure 2150 in Figure 21, described below.) The challenge in this method is to accurately modulate the temperature using a triangular wave; such a requirement may be taken into account in design of the temperature modulation module. </p><p id="p0051" num="0051">SCO Phase Trimming Algorithm </p><p id="p0052" num="0052"> An objective of the phase trimming algorithm is to search for PS<sub>op</sub>t that adjusts the SCO K<sub>T</sub> to a user's slope control word (KCW). The selection of KCW depends on the operating T<sub>0</sub>, the predetermined temperature range and the desired SCO temperature dependence curve. Usually a value of KCW that is equal to zero or very close to zero is used to optimize the SCO temperature dependence using room temperature only (RTO) trimming (T<sub>0</sub>=25°C) for the different temperature ranges illustrated in Figure 1(B). Running the trimming routine at room temperature is highly valuable as it reduces the overall testing and trimming cost of the product. </p><p id="p0053" num="0053">One method to find PS<sub>opt</sub> is to sweep PS and measure its corresponding Κχ to select PSopt which gives K<sub>T</sub>=KCW. However, we may need 2<sup>n</sup> modulation cycles to find PS<sub>op</sub>t, where n is the number of bits of the PS word. Consequently, this method will consume a lot of time thus increase production testing time and cost. A successive approximation 
<!-- EPO <DP n="15"/>-->
 register (SAR) trimming algorithm is adopted to minimize the number of modulation cycles involved in the trimming to n modulation cycles. Figure 6(A) illustrates a block diagram of the present SAR trimming algorithm. The binary search process is illustrated in Figure 6(B). The algorithm starts by loading an initial phase setting (PSini<sub>t</sub>i<sub>a</sub>i) into an output accumulator 601 and loading an initial step into a SAR 603. UsuallyPSinW<sub>a</sub>i is set to middle of phase setting PS range, but the setting can be chosen to reduce the convergence time. Temperature sensitivity Kj, previously determined, is subtracted from a control word KCW by a block 602, and the result is applied to a sign detection, circuit 605. Second, after one modulation cycle the sign of <sub>T</sub> is detected by the block 605 and inverted then multiplied by the SAR step using a multiplier 607. The output of the multiplication is then added to PSinWai to produce PS<sub>ne</sub>xt- The operation of the algorithm requires n cycles to reach PS<sub>op</sub>t , where the SAR step is halved after each cycle to complete the binary search. </p><p id="p0054" num="0054">Slope control word KCW is an input parameter to the trimming algorithm specifying a specific slope criterion to search for, and the trimming algorithm starts searching this criterion just by changing the PS of the oscillator. The relation between PS<sub>opt</sub> and KCW is a result of the algorithm, which assumes that there is a single PS that satisfies P8<sub>opt</sub> where the behavior of the oscillator is a specific shape with a specific slope around T<sub>0</sub> defined by KCW. The design of the oscillator may be such that at PS<sub>opt</sub>, the behavior of the oscillator has a specific shape, for example a parabola or an inverted sine. Based on the knowledge of the shape, the trimming algorithm starts searching for PS<sub>opt</sub> by means of the slope of the expected shape around T<sub>0</sub>. For instance, if the expected shape is a 
<!-- EPO <DP n="16"/>-->
 parabola, the trimming algorithm searches for a KCW=0 around T<sub>0</sub>. If the expected shape is an inverted sine, the trimming algorithm searches for a .CW&gt;0 around T<sub>0</sub>. </p><p id="p0055" num="0055"> The SAR algorithm saves a lot of time compared to extensive sweep techniques, but it depends only on the sign of Κτ and ignores its magnitude. The magnitude may be very helpful to minimize the number of cycles of the algorithm. Figure 7(A) illustrates a block diagram of a least mean square (LMS) trimming algorithm that utilizes both the sign and magnitude of χ to reach PS<sub>opt</sub> faster than the SAR algorithm. Similar to the SAR algorithm, the LMS algorithm starts by loading PSini<sub>t</sub>i<sub>a</sub>i into the output accumulator 701. Temperature sensitivity K<sub>T</sub>, previously determined, is subtracted from a control word KCW by a block 702, and the result is applied to a multiplier circuit 707. After each modulation cycle Κχ is detected and inverted then multiplied by an LMS gain factor (multiplier 707). The LMS gain factor may be constant or variable. Its defines the convergence speed, the steady state error and the stability of the loop. When a large step size is used, the adaptation process converges faster, but it would have a greater steady state error and lower phase margin. After each modulation cycle, the value of PS gets closer to PS<sub>opt</sub> and the magnitude of K<sub>T</sub> gets closer to KCW. The operation of the algorithm is finished when the magnitude of K<sub>T</sub> is smaller than a certain value defined by the user or after certain number of cycles defined by the user. </p><p id="p0056" num="0056">SCO Frequency Trimming </p><p id="p0057" num="0057"> Different methods and apparatus may be used to trim the FS of the oscillator to adjust its output frequency as discussed. Figure 8 shows a generic block diagram of a digital phase locked loop (DPLL) and a digital frequency locked loop (DFLL) depending 
<!-- EPO <DP n="17"/>-->
 on the type of the loop filter. An FDC 801 will convert the oscillator frequency into D<sub>osc</sub>. The FDC uses an external reference clock whose frequency is equal to F<sub>re</sub>f. The reference clock is assumed accurate and it is frequency stable during trimming as the oscillator output frequency will be referenced to it. The FDC output (D<sub>osc</sub>) is subtracted from the user frequency control word (FCW) at block 803 to give a digital word that represents the frequency error (f<sub>e</sub>) between the oscillator frequency (F<sub>osc</sub>) and the target required frequency (FCW . F<sub>ref</sub>). The output of the subtraction f<sub>e</sub> is filtered via a digital loop filter 805 to control FS of the oscillator 807. The accumulator of the digital loop filter may be loaded with an initial frequency setting (FSinit) to speed-up the frequency settling. The loop will settle when the oscillator's frequency is equal to the target required frequency (Fosc <sup>=</sup> FCW . F<sub>ref</sub>) at steady-state. Note if the digital loop filter is only an accumulator then the DPLL loop will turn into a DFLL. The settling time of the DPLL can be faster than a DFLL, but the advantage of a DFLL is being unconditionally stable. </p><p id="p0058" num="0058">SCO Simultaneous Phase and Frequency Trimming </p><p id="p0059" num="0059"> As has been explained previously, the coupled relation between the oscillator's frequency and oscillator's optimum phase has represented a major challenge for the trimming of the integrated oscillators and has required multiple trimming iterations. Phase trimming is much slower than frequency trimming as it is limited by the slow thermal time constant of the packaged part under test. </p><p id="p0060" num="0060">Figure 9 illustrates a flowchart of an iterative trimming routine for the SCO. At block 901, the iterative trimming routine is started by frequency trimming of the SCO by 
<!-- EPO <DP n="18"/>-->
 selecting a certain FCW that defines the oscillator frequency locked in DPLL as
<img id="imgf000018_0001" he="5" wi="27" file="imgf000018_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 The second step (903) is the single temperature point trimming of the SCO by selecting a certain KCW using a Κτ detection module followed by SAR or LMS trimming algorithm to search for PS<sub>op</sub>t. During this process, the DPLL is disabled where the oscillator is not locked anymore and the FDC is used now within the χ detection module. After several temperature modulation cycles, the SAR or LMS algorithm selects PS<sub>opt</sub>- However, changing the value of PS will change the output frequency of the oscillator besides changing its temperature performance. This means that the value of FS of the oscillator needs to be readjusted again using the DPLL (905). </p><p id="p0061" num="0061">Finally, the oscillator's performance across temperature is checked using the Κχ detection module (907). If the performance is acceptable (909) both FS and PS parameters are programmed in the OTP ROM (911). However, the oscillator performance across temperature may be deteriorated after the second frequency trimming step. This happens because the optimum phase operating point ( <sub>N</sub>ui is changed when FS is changed. Consequently, the single temperature point trimming of the SCO has to be repeated again. In conclusion, this conventional trimming routine, even though it employs a single temperature insertion point, requires several iterations and thus increases the production testing time and accordingly increases the overall product cost. </p><p id="p0062" num="0062">In order to minimize the testing time, it is necessary to eliminate multiple phase trimming iterations. The techniques described herein overcome the disadvantages of the iterative trimming routine and performs simultaneous trimming of the oscillator temperature sensitivity and output frequency by controlling both PS and FS at the same 
<!-- EPO <DP n="19"/>-->
 time. The DPLL is used to adjust its output frequency to the required frequency. The DPLL will force the oscillator frequency to be FCW.f<sub>ref</sub>, now the oscillator is locked to that frequency and not free running anymore. A simple ON/OFF temperature modulation is applied to the oscillator. The frequency of the temperature modulation is too low because of the large thermal time constant and it is much smaller than the bandwidth of the DPLL. Consequently, the loop will track the slow changes due to temperature so that the oscillator frequency remains constant while the oscillator FS will invert any low frequency temperature modulation. In this way, the DPLL performs the required frequency demodulation process instead of the FDC while preserving the oscillator frequency to the required frequency. Modified operation of the circuitry of Figure 8 is illustrated in Figure 10. </p><p id="p0063" num="0063">The FS will be used as an input to the K<sub>T</sub> detection module. The second half the heating period is integrated into A<sub>hot</sub> while the second half the cooling period is integrated into A<sub>co</sub>i<sub>d</sub> as shown in Figure 10. Then the difference between A<sub>hot</sub> and A<sub>co</sub>i<sub>d</sub> is a digital word that accurately represents K<sub>T</sub>. At the end of each modulation cycle (heating then cooling) the output of the K<sub>T</sub> detection module is used in the SAR/LMS trimming algorithm to find the new PS. As has been mentioned before, changing PS will change the oscillator frequency. However, the DPLL will rapidly lock to the required target frequency FCW.f<sub>ref</sub> in a period much smaller than half the heating period. Moreover, the settling of the DPLL does not affect the operation of K<sub>T</sub> detection module because it starts integration in the second half of the heating period where the ADPLL is settled and it depends on the difference between A<sub>hot</sub> and A<sub>co</sub>i<sub>d</sub> rather than their absolute value. Now both loops are working at the same time to search for the PS<sub>opt</sub> at the 
<!-- EPO <DP n="20"/>-->
 required frequency FCW.f<sub>ref</sub>, thus canceling the need for several iterations required in the conventional trimming routine. </p><p id="p0064" num="0064"> Figure 11 shows the top-level diagram of the SPT with simultaneous phase and frequency trimming. The digital Implementation of the SPT module is highly programmable to accommodate different oscillators with different characteristics. A serial input/output (I/O) interface is used to communicate with the chip to set different programmable parameters. It utilizes a single insertion temperature point and employs on-chip heaters in the temperature modulation module to measure the oscillator temperature sensitivity Κχ. Moreover, it utilizes smart algorithms including SAR and LMS algorithms rather than extensive sweeps to provide a fast, robust and low cost trimming algorithm. At the end of the trimming routine, the oscillator trimmed parameters PS and FS are programmed in a OTP ROM module. The OTP ROM is used to hold the value of these parameters in normal operation after trimming is done. </p><p id="p0065" num="0065">In Figure 11, a temperature modulation module 1102 applied temperature modulation to an oscillator 1107 under control of a trimming algorithm 1104 having as an input KCW. An output frequency of the oscillator 1107 is detected using a frequency-to-digital converter 1101 having as an input a reference frequency F<sub>ref</sub>. The detected frequency is filtered by a DPLL filter 1105. An output of the DPLL is input to an FS register 1109, the value of which is applied to the oscillator 1107. The output of the DPLL is also output to a K<sub>T</sub> detection module 1111, which detect the value of <sub>T</sub> and applies it to the trimming algorithm 1104. The trimming algorithm determines a value of PS and stores it in a PS register 1113, the value of which is applied to the oscillator 1107. 
<!-- EPO <DP n="21"/>-->
 The PS register is used to hold the value of the phase setting factor of the SCO or the temperature compensation parameter in any other oscillator. PS is adjusted to obtain an oscillator with minimum frequency variation with temperature. The FS register is used to hold the value of the frequency setting of the oscillator and is used to tune the oscillator to the required frequency. </p><p id="p0066" num="0066">However, the use of the DPLL as a frequency demodulator may not be suitable for some oscillators where the relation between FS and output frequency suffers from high non-linearity. This may be the case when the capacitor bank of the oscillator is split into a coarse/fine capacitor bank with overlapping ranges. For such oscillators, the simultaneous operation of the DPLL and phase trimming algorithm may not converge do to the non-linearity of FS. </p><p id="p0067" num="0067">SCO Interleaved Phase and Frequency Trimming </p><p id="p0068" num="0068"> In the case just mentioned, a slightly different approach may be followed. In this approach, the FDC will be used again as a frequency demodulator and its output will be the input of the Κχ detection module as shown in Figure 12. Figure 12 differs from Figure 11 in that in Figure 12, the K detection module receives an output of the FDC 1201 directly, while the oscillator is not locked. As has been mentioned before, PS is changed after each temperature modulation cycle. The DPLL will be enabled for half the heating period of the modulation cycle and is started to reacquire the required frequency FCW.fref. Afterwards, the DPLL is disabled and the oscillator becomes free-running again to respond to the temperature modulation as the K<sub>T</sub> detection module is insensitive to the absolute frequency of the oscillator. The time-interleaving operation of the two 
<!-- EPO <DP n="22"/>-->
 trimming loops allows searching for PS<sub>op</sub>t at the required frequency FCW.f<sub>re</sub>f, thus it eliminates the imperative iterations of the conventional trimming routine and overcomes the non-linearity of the frequency tuning of digitally controlled oscillators. </p><p id="p0069" num="0069">The techniques described herein provide a smart, robust, and all-digital trimming solution for SCO thus decreasing the complexity of production testing and consequently decreasing the overall cost of the product. </p><p id="p0070" num="0070">Temperature Modulation Module Implementations </p><p id="p0071" num="0071"> Different methods and apparatus may be used to modulate the chip temperature using integrated techniques. Figure 13(A) shows a circuit implementation of an on-chip heater cell using only an NMOS transistor Nl. The amount of heat generated is controlled by analog voltage (V<sub>ctI</sub>i). The implementation of Figure 13(B) adds a resistance (R) in series with the NMOS transistor in order to limit the current. Many heater cells Hl-Hn may be distributed around the oscillator, for example an inductor L, which is coupled to other oscillator circuitry 1401 as shown in Figure 14. A temperature sensor 1403 is located in proximity. An objective of this configuration is to achieve a suitable temperature field across the oscillator. The generated heat will increase the temperature of the chip on average by ΔΤ, the magnitude of ΔΤ depends on many factors including but not limited to: number of heater cells, die area, package type and package volume. This configuration can be used to make ON/OFF temperature modulation by setting V<sub>ctr</sub>ito ground or supply voltage. 
<!-- EPO <DP n="23"/>-->
 Figure 15 shows a block diagram of an analog temperature modulation in which the temperature modulation can be accurately controlled. It employs a temperature sensor 1503 to sense the chip temperature and convert it into an analog voltage (V<sub>temp</sub>). The relationship between the chip temperature and V<sub>te</sub>mp is linear. This voltage is subtracted from a user set voltage (V<sub>se</sub>t) from an Analog Waveform Generation Module (AWGM) 1505, then amplified using the error amplifier 1507 whose gain equals to (IQ). An output signal of the error amplifier 1507 is used to control heater cells ΗΓ-Ηη'. The negative feedback loop will force the heaters to generate the required amount of heat so that V<sub>tem</sub>p equals to V<sub>se</sub>t. The loop stability is maintained due to the presence of the very low frequency dominant pole of the heaters. In this manner, the temperature of the chip may be controlled linearly and accurately using V<sub>se</sub>t- Different temperature modulation waveforms can be easily generated in the voltage domain using the AWGM. </p><p id="p0072" num="0072">In order to have precise control on the temperature modulation waveform, AWGM is replaced by a Digital Waveform Generation Module (DWGM) 1605 and a Digital to Analog Converter (DAC) 1606 as shown in Figure 16. The implementation of the DWGM is much simpler than AWGM. </p><p id="p0073" num="0073"> Figure 17 shows a block diagram of a digital temperature modulation module. It employs a digital temperature sensor 1703 to sense the chip temperature and converts it into a digital word (D<sub>temp</sub>). Similar to the analog temperature modulation module, D<sub>te</sub>mp is subtracted (block 1704) from a user set digital word (D<sub>set</sub>) generated by a Digital Waveform Generation 1705 then multiplied by gain equal to (¾) using an amplifier 1701 to control the heaters though a DAC 1706. 
<!-- EPO <DP n="24"/>-->
 Frequency to Digital Converter (FDC) Implementations </p><p id="p0074" num="0074"> The function of the FDC is to measure the frequency of a clock and convert it into a digital word. The main specifications of the FDC are as follows: </p><p id="p0075" num="0075">Frequency Resolution (f<sub>res</sub>) </p><p id="p0076" num="0076"> Sampling Frequency (f<sub>s</sub>) </p><p id="p0077" num="0077"> Dynamic Range </p><p id="p0078" num="0078">Different techniques may be used to design an FDC. Figure 18 shows a block diagram of a counter based FDC. A counter 1801 is clocked with the oscillator frequency (F<sub>osc</sub>) and it starts counting at the positive edge of the reference frequency (F<sub>re</sub>f) after synchronization by synchronizer 1803. At the end of the reference period, the counter output is latched to a register 1802. This means that the counter based FDC is used to compute the integer ratio (D<sub>osc</sub>) between F<sub>osc</sub> and F<sub>re</sub>f. The sampling frequency as well as the frequency resolution of this architecture is equal to F<sub>re</sub>f. This means that there is a trade-off between achieving a high sampling frequency and fine frequency resolution. The dynamic range is determined by the number of bits of the counter. </p><p id="p0079" num="0079"> Figure 19 shows a block diagram of a fractional FDC that breaks the trade -off between achieving a high sampling frequency and a fine frequency resolution. The number of whole F<sub>osc</sub> periods between two reference edges is computed as
<img id="imgf000024_0001" he="5" wi="12" file="imgf000024_0001.tif" img-format="tif" img-content="drawing" orientation="portrait" inline="no"/>
 using a counter as mentioned before. The residual time distance between the reference period and the Di<sub>ntegei</sub> oscillator periods is measured using a time-to-digital converter (TDC) 1904 as Dfr<sub>ac</sub>ti<sub>o</sub>n<sub>a</sub>i- Both integer and fractional parts are added (block 1905) to produce the 
<!-- EPO <DP n="25"/>-->
 digital output of the converter (D<sub>osc</sub>). Here, the sampling frequency is equal to F<sub>ref</sub> while frequency resolution is determined by the resolution of the TDC. </p><p id="p0080" num="0080">Single Point Trimming for TCO </p><p id="p0081" num="0081"> The techniques described can be reconfigured easily to provide a robust, low-cost and fast SPT routine for any temperature compensated oscillator (TCO) including TCXO, MEMS, FBAR, and RC oscillators. Figure 20 illustrates a generic block diagram of an open loop TCO. An open loop temperature compensation technique aims to negate the temperature generated frequency shift of the oscillator 2001 by imposing a frequency shift in the opposite direction of equal magnitude using a temperature sensor 2003 and a digital/analog control module 2010. To achieve this, one can modify the oscillation frequency using one or more frequency tuning controls of the oscillator. Alternatively one can follow the oscillator with a frequency multiplier/divider 2009 and control the multiplication/division factor such that the output frequency is temperature independent. In the illustrated embodiment, the digital/analog control module includes a temperature compensation algorithm 2005 and an OTP ROM 2007. Conversion circuitry 2020 is provided as needed. </p><p id="p0082" num="0082">A smart compensation algorithm can cancel the temperature dependence of the oscillator by utilizing accurate temperature measurement and dynamic adjustment of the oscillator or frequency multiplier/divider based on a linear or higher-order polynomial fit. However, choosing the optimum coefficients of the polynomial fit is difficult and may require extensive characterization of the complete system to achieve tight 
<!-- EPO <DP n="26"/>-->
 temperature stability in the predetermined temperature range. This means that every single part has to be calibrated using multiple insertion temperature points to achieve the required specification. Consequently, the production cost increases dramatically thus increasing the cost of the whole product. </p><p id="p0083" num="0083">The techniques described herein provide an SPT alogorithm for any TCO, thus reducing the testing cost while achieving high frequency stability. The present appartus is capable of finding the optimum temperature compensation parameters and of adjusting the oscillator frequency to the required value simultaneously. Thus it provides a robust, fast and low cost trimming solution for TCO thus decreasing the complexity of product testing and consequently decreasing the overall cost of the product. </p><p id="p0084" num="0084">Assume an oscillator, to be temperature compensated, has temperature dependence as described in equation (1), where T is the operating temperature and T<sub>0</sub> is the center of a predetermined temperature range, ai, i¾and as are constants representing the oscillator's temperature dependence. The aim of the temperature compensation algorithm is to negate this temperature dependence dynamically based on accurate temperature measurement (D<sub>temp</sub>). The compensation algorithm tunes the oscillator and/or the frequency multiplier/divider according to a polynomial function whose coefficients are c c<sub>2</sub> and &lt;¾.The optimum values of the compensation coefficients (&lt;¾ c<sub>2</sub> and &lt;¾) are those which make the temperature dependence coefficients (a<sub>/</sub>, a<sub>2</sub> and as) equal to zero. 
<!-- EPO <DP n="27"/>-->
 F<sub>0Ut</sub> = F<sub>0</sub> + a<sub>l</sub> {T - T<sub>0</sub>) + a {T - T<sub>0</sub>)<sup>2</sup> + a, 'X {T - T<sub>0</sub> (1) </p><p id="p0085" num="0085"> Figure 21 shows a top-level diagram of the SPT for TCO infrastructure based in part on a structure 2150 like that of the structure 550 of Figure 5. The digital implementation of the SPT module may be highly programmable to accommodate different oscillators with different characteristics. A temperature triangular excitation signal superimposed over T<sub>0</sub> is applied to the oscillator through a temperature modulation module. The oscillator frequency will act in response to the temperature modulation signal according to its temperature dependence as described in equation (1). The FDC will convert the oscillator frequency into a digital word D<sub>osc</sub>. </p><p id="p0086" num="0086">An LMS calibration block 2160 includes derivative blocks 2161 and 2162, a coefficients detection module 2163, and an LMS trimming algorithm 2165. As the excitation signal is a triangular wave, then the first derivative of frequency can be represented in a digital word (Dfi) using a difference block. The process can be extended to get higher derivatives (Df<sub>2</sub>, Df ). The coefficients detection module uses frequency derivatives (Dfi, Df<sub>2</sub> andDf<sub>3</sub>) to estimate the oscillator's temperature dependence coefficients (&lt;¾ &lt;¾ and as). An LMS trimming algorithm can be used to search for the optimum compensation coefficients (ci<sub>opt</sub>, C2<sub>0p</sub>t and cs<sub>op</sub>t) similar to Figure 13(A). </p><p id="p0087" num="0087">The accuracy of the trimming algorithm depends on the amplitude of the temperature modulation waveform. As the amplitude of temperature modulation increase the total temperature dependence of the oscillator in the required temperature range increases. The oscillator output frequency can be readjusted after each modulation cycle by enabling the 
<!-- EPO <DP n="28"/>-->
 DPLL module to reacquire the required frequency FCW.f<sub>re</sub>f. Afterwards, the DPLL is disabled and the oscillator becomes free-running again to respond to the temperature modulation. The techniques described herein are capable of adjusting the optimum compensation parameter for minimum temperature dependence besides adjusting the oscillator output frequency at the same time. </p><p id="p0088" num="0088">The techniques described herein provide a smart, robust, and all-digital trimming solution for TCO thus decreasing the complexity of production testing and consequently decreasing the overall cost of the product. 
</p></description><claims mxw-id="PCLM70077134" ref-ucid="WO-2014130525-A1" lang="EN" load-source="patent-office"><claim id="clm-0001" num="0001"><!-- EPO <DP n="29"/>--><claim-text/><claim-text>What is claimed is: </claim-text><claim-text>1. An oscillator circuit comprising: </claim-text><claim-text> an oscillator comprising a frequency determining element; frequency setting circuitry responsive to a digital frequency setting value to cause a change in an output frequency of the oscillator; </claim-text><claim-text> phase setting circuitry responsive to a digital phase setting value to cause a specified phase across the frequency determining element; </claim-text><claim-text> temperature modulation circuitry responsive to a calibration stimulus for causing a temperature of the oscillator to varying in accordance with a temperature modulation pattern; </claim-text><claim-text> memory to store the digital phase setting value and the digital frequency setting value; and </claim-text><claim-text> calibration circuitry configured to determine and store in the memory the digital phase setting value and the digital frequency setting value so as to simultaneously satisfy a frequency accuracy requirement and a requirement of frequency stability over a specified temperature range. </claim-text><claim-text>2. The apparatus of Claim 1 , wherein the calibration stimulus is a square wave. </claim-text><claim-text>3. The apparatus of Claim 1, wherein the calibration stimulus is a triangular wave. </claim-text><claim-text>4. The apparatus of Claim 1 , wherein the temperature modulation circuitry comprises a control loop comprising a plurality of heating elements and a temperature sensor. 
<!-- EPO <DP n="30"/>-->
</claim-text><claim-text>5. The apparatus of Claim 1 , wherein the calibration circuitry comprises a control loop comprising a frequency-to-digital converter. </claim-text><claim-text>6. The apparatus of Claim 1 , wherein the oscillator circuitry and the temperature modulation circuitry are fabricated on a single integrated circuit. </claim-text><claim-text>7. The apparatus of Claim 6, wherein the memory and at least a portion of the calibration circuitry are fabricated on the single integrated circuit. </claim-text><claim-text>8. A method of calibrating an oscillator for frequency-accurate, frequency-stable operation across a temperature range, the oscillator comprising a frequency determining element, circuitry responsive to a digital frequency setting value to cause a change in an output frequency of the oscillator, and circuitry responsive to a digital phase setting value to cause a specified phase across the frequency determining element, the method comprising: </claim-text><claim-text> determining frequency differences at different instants of time between the output frequency of the oscillator and a reference frequency; </claim-text><claim-text> under a temperature condition and under control of a first control loop, applying temperature modulation to the oscillator, determining a temperature sensitivity of the output frequency of the oscillator, and searching for and identifying a final digital phase setting value that results in a temperature sensitivity that matches a predetermined criterion; and </claim-text><claim-text> under said temperature condition and under control of a second control loop, determining a final digital frequency setting value that minimizes the frequency differences; </claim-text><claim-text> wherein the final digital phase setting value and the final digital frequency setting value simultaneously satisfy a frequency accuracy requirement and a requirement of frequency stability over a specified temperature range. 
<!-- EPO <DP n="31"/>-->
</claim-text><claim-text>9. The method of Claim 8, wherein the temperature condition is non-controlled room temperature. </claim-text><claim-text>10. The method of Claim 8, wherein the first control loop uses feedback control to control an average temperature of the oscillator and a temperature modulation profile. </claim-text><claim-text>11. The method of Claim 8, wherein the the first control loop and the second control loop operate simultaneously, with a response time of the second control loop being much faster than a response time of the first control loop, further comprising: </claim-text><claim-text> the second control loop locking the oscillator to the reference frequency; and </claim-text><claim-text> the first control loop using changes in the digital frequency setting in response to the temperature modulation to search for and identify a final digital phase setting value that results in a temperature sensitivity that matches a predetermined criterion. </claim-text><claim-text>12. The method of Claim 8, comprising repeating a plurality of times the steps of determining frequency differences, identifying a final digital phase setting value, and determining a final digital frequency setting value, each time under a different temperature condition. </claim-text><claim-text>13. The method of Claim 8, wherein the the first control loop and the second control loop operate in an interleaved manner in accordance with a period of the temperature modulation, with a response time of the second control loop being much faster than a response time of the first control loop, wherein the second control loop operates during a first portion of the period of the temperature modulation and does not operate during a second portion of the period of the temperature modulation. 
<!-- EPO <DP n="32"/>-->
</claim-text><claim-text>14. The method of Claim 8, wherein searching for the final digital phase setting value is performed using a successive approximation search algorithm. </claim-text><claim-text>15. The method of Claim 8, wherein searching for the final digital phase setting value is performed using a least mean square search algorithm. </claim-text><claim-text>1 . An apparatus comprising : </claim-text><claim-text> an oscillator comprising a frequency determining element; circuitry responsive to a digital frequency setting value to cause a change in an output frequency of the oscillator; </claim-text><claim-text> circuitry responsive to a digital phase setting value to cause a specified phase across the frequency determining element; </claim-text><claim-text> circuitry to determine frequency differences at different instants of time between the output frequency of the oscillator and a reference frequency; </claim-text><claim-text> control logic; </claim-text><claim-text> a first control loop controlled by the control logic to, under a temperature condition, apply temperature modulation to the oscillator, determine a temperature sensitivity of the output frequency of the oscillator, and search for and identifying a final digital phase setting value that results in a temperature sensitivity that matches a predetermined criterion; and </claim-text><claim-text> a second control loop controlled by the control logic to, under the temperature condtion, determine a final digital frequency setting value that minimizes the frequency differences; </claim-text><claim-text> wherein the final digital phase setting value and the final digital frequency setting value simultaneously satisfy a frequency accuracy requirement and a requirement of frequency stability over temperature. 
<!-- EPO <DP n="33"/>-->
</claim-text><claim-text>17. A method of calibrating an oscillator circuit fabricated on an integrated circuit and responsive to a frequency setting signal to cause a change in an output frequency of the oscillator circuit, comprising: </claim-text><claim-text> applying temperature modulation to the oscillator; </claim-text><claim-text> measuring results of the temperature modulation; </claim-text><claim-text> processing the measured results to estimate at least first and second temperature derivatives of the output frequency; </claim-text><claim-text> using the estimates of the temperature derivatives of the output frequency to determine a plurality of coefficients of a temperature compensation function with an objective of causing temperature sensitivity of the output frequency to match a predetermined criterion; and </claim-text><claim-text> storing the plurality of coefficients; </claim-text><claim-text> wherein the oscillator circuit is configured to, during operation, use the plurality of coefficients and a temperature measurement to produce a compensated frequency setting signal that compensates the output frequency in accordance with the temperature measurement. </claim-text><claim-text>18. The method of Claim 17, wherein: </claim-text><claim-text> applying temperature modulation comprises modulating a temperature of the oscillator in accordance with a triangle or sawtooth waveform; </claim-text><claim-text> measuring results of the temperature modulation comprises measuring the output frequency using a frequency-to-digital converter to obtain digital frequency measurements; and </claim-text><claim-text> processing the measured results comprises estimating the at least first and second temperature derivatives using the digital frequency measurements. 
<!-- EPO <DP n="34"/>-->
</claim-text><claim-text>19. An oscillator circuit comprising an oscillator and calibration circuitry and responsive to a frequency setting signal to cause a change in an output frequency of the oscillator circuit, the calibration circuitry comprising: </claim-text><claim-text> temperature modulation circuitry comprising heaters and a feedback control loop for applying temperature modulation to the oscillator; </claim-text><claim-text> measurement circuitry to measure results of the temperature modulation; </claim-text><claim-text> calculation circuitry to use results of the temperature modulation to determine a plurality of coefficients of a temperature compensation function; </claim-text><claim-text> storage to store the plurality of coefficients; </claim-text><claim-text> temperature measurement circuitry; and </claim-text><claim-text> compensation circuitry to, during operation, use the plurality of coefficients and a temperature measurement to produce as a compensated frequency setting signal that compensates the output frequency in accordance with the temperature measurement. </claim-text><claim-text>20. The apparatus of Claim 19, wherein said results comprise at least a first temperature derivative of the output frequency. </claim-text><claim-text>21. The apparatus of Claim 19, wherein said results comprise at least first and second temperature derivatives of the output frequency. </claim-text><claim-text>22. The apparatus of Claim 19, wherein the oscillator circuit is one of the following types: LC oscillator, RC oscillator, MEMS oscillator and FBAR oscillator. </claim-text><claim-text>23. A method of validating temperature performance of an oscillator circuit and responsive to a frequency setting signal to cause a change in an output frequency of the oscillator circuit, comprising: </claim-text><claim-text> applying temperature modulation to the oscillator; </claim-text><claim-text> measuring results of the temperature modulation; 
<!-- EPO <DP n="35"/>-->
 processing the measured results to estimate at least first and second temperature derivatives of the output frequency; and </claim-text><claim-text> using the estimates of the temperature derivatives of the output frequency to determine whether or not temperature sensitivity of the output frequency matches a predetermined criterion. 
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
