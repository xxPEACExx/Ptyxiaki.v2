<?xml version="1.0" encoding="UTF-8"?>
<patent-document ucid="EP-2959455-A1" country="EP" doc-number="2959455" kind="A1" date="20151230" family-id="48048612" file-reference-id="316602" date-produced="20180825" status="corrected" lang="EN"><bibliographic-data><publication-reference fvid="160453206" ucid="EP-2959455-A1"><document-id><country>EP</country><doc-number>2959455</doc-number><kind>A1</kind><date>20151230</date><lang>EN</lang></document-id></publication-reference><application-reference ucid="EP-14706670-A" is-representative="NO"><document-id mxw-id="PAPP193869380" load-source="docdb" format="epo"><country>EP</country><doc-number>14706670</doc-number><kind>A</kind><date>20140219</date><lang>EN</lang></document-id><document-id mxw-id="PAPP193869381" load-source="patent-office" format="original"><country>EP</country><doc-number>14706670.8</doc-number><date>20140219</date><lang>EN</lang></document-id></application-reference><priority-claims><priority-claim mxw-id="PPC162034185" ucid="GB-201302887-A" load-source="docdb"><document-id format="epo"><country>GB</country><doc-number>201302887</doc-number><kind>A</kind><date>20130219</date></document-id></priority-claim><priority-claim mxw-id="PPC162028552" ucid="GB-2014050480-W" linkage-type="W" load-source="docdb"><document-id format="epo"><country>GB</country><doc-number>2014050480</doc-number><kind>W</kind><date>20140219</date></document-id></priority-claim></priority-claims><technical-data><classifications-ipcr><classification-ipcr mxw-id="PCL-1988525128" load-source="docdb">G06T   7/00        20060101AFI20140909BHEP        </classification-ipcr></classifications-ipcr><classifications-cpc><classification-cpc mxw-id="PCL-1858707869" load-source="docdb" scheme="CPC">G06T   7/136       20170101 LI20170102BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1861371305" load-source="docdb" scheme="CPC">G06T   7/32        20170101 LI20170102BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1861372155" load-source="docdb" scheme="CPC">G06T   7/337       20170101 LI20170102BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1937852917" load-source="docdb" scheme="CPC">A61B   3/1225      20130101 LA20160517BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1937854627" load-source="docdb" scheme="CPC">A61B   3/0025      20130101 LI20160517BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1937860373" load-source="docdb" scheme="CPC">G06T2207/20164     20130101 LA20160517BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987762764" load-source="docdb" scheme="CPC">G06T   5/20        20130101 LI20151113BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987770973" load-source="docdb" scheme="CPC">G06T   7/003       20130101 FI20151113BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987778497" load-source="docdb" scheme="CPC">G06T2207/30101     20130101 LA20151114BHEP        </classification-cpc><classification-cpc mxw-id="PCL-1987798121" load-source="docdb" scheme="CPC">G06T2207/30041     20130101 LA20151114BHEP        </classification-cpc></classifications-cpc><invention-title mxw-id="PT165551084" lang="DE" load-source="patent-office">VERBESSERUNGEN AN ODER IN ZUSAMMENHANG MIT EINER BILDVERARBEITUNG</invention-title><invention-title mxw-id="PT165551085" lang="EN" load-source="patent-office">IMPROVEMENTS IN OR RELATING TO IMAGE PROCESSING</invention-title><invention-title mxw-id="PT165551086" lang="FR" load-source="patent-office">AMÉLIORATIONS DU TRAITEMENT D'IMAGE OU RELATIVES À CELUI-CI</invention-title></technical-data><parties><applicants><applicant mxw-id="PPAR1103327366" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>OPTOS PLC</last-name><address><country>GB</country></address></addressbook></applicant><applicant mxw-id="PPAR1103341046" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>OPTOS PLC</last-name></addressbook></applicant><applicant mxw-id="PPAR1101647654" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Optos PLC</last-name><iid>101351472</iid><address><street>Queensferry House Carnegie Business Campus Dunfermline</street><city>Fife KY11 8GR</city><country>GB</country></address></addressbook></applicant></applicants><inventors><inventor mxw-id="PPAR1103320110" load-source="docdb" sequence="1" format="epo"><addressbook><last-name>CLIFTON DAVID</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR1103320642" load-source="docdb" sequence="1" format="intermediate"><addressbook><last-name>CLIFTON, DAVID</last-name></addressbook></inventor><inventor mxw-id="PPAR1101641848" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>CLIFTON, DAVID</last-name><address><street>48 Almondbank Terrace</street><city>Shandon Edinburgh EH11 1SR</city><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR1103326920" load-source="docdb" sequence="2" format="epo"><addressbook><last-name>PINNOCK RALPH ALLEN</last-name><address><country>GB</country></address></addressbook></inventor><inventor mxw-id="PPAR1103311771" load-source="docdb" sequence="2" format="intermediate"><addressbook><last-name>PINNOCK, Ralph Allen</last-name></addressbook></inventor><inventor mxw-id="PPAR1101644893" load-source="patent-office" sequence="2" format="original"><addressbook><last-name>PINNOCK, Ralph Allen</last-name><address><street>10 Bendachin Drive</street><city>Dunfermline Fife KY12 7RZ</city><country>GB</country></address></addressbook></inventor></inventors><agents><agent mxw-id="PPAR1101643698" load-source="patent-office" sequence="1" format="original"><addressbook><last-name>Cooper, John</last-name><iid>101185044</iid><address><street>Murgitroyd &amp; Company Scotland House 165-169 Scotland Street</street><city>Glasgow G5 8PL</city><country>GB</country></address></addressbook></agent></agents></parties><international-convention-data><pct-or-regional-filing-data ucid="GB-2014050480-W"><document-id><country>GB</country><doc-number>2014050480</doc-number><kind>W</kind><date>20140219</date><lang>EN</lang></document-id></pct-or-regional-filing-data><pct-or-regional-publishing-data ucid="WO-2014128456-A1"><document-id><country>WO</country><doc-number>2014128456</doc-number><kind>A1</kind><date>20140828</date><lang>EN</lang></document-id></pct-or-regional-publishing-data><designated-states><ep-contracting-states><country mxw-id="DS660634895" load-source="docdb">AL</country><country mxw-id="DS660636785" load-source="docdb">AT</country><country mxw-id="DS660634897" load-source="docdb">BE</country><country mxw-id="DS660742006" load-source="docdb">BG</country><country mxw-id="DS660712915" load-source="docdb">CH</country><country mxw-id="DS660633718" load-source="docdb">CY</country><country mxw-id="DS660636786" load-source="docdb">CZ</country><country mxw-id="DS660634898" load-source="docdb">DE</country><country mxw-id="DS660633723" load-source="docdb">DK</country><country mxw-id="DS660633724" load-source="docdb">EE</country><country mxw-id="DS660722668" load-source="docdb">ES</country><country mxw-id="DS660742035" load-source="docdb">FI</country><country mxw-id="DS660742036" load-source="docdb">FR</country><country mxw-id="DS660634907" load-source="docdb">GB</country><country mxw-id="DS660633725" load-source="docdb">GR</country><country mxw-id="DS660634908" load-source="docdb">HR</country><country mxw-id="DS660636803" load-source="docdb">HU</country><country mxw-id="DS660712916" load-source="docdb">IE</country><country mxw-id="DS660633726" load-source="docdb">IS</country><country mxw-id="DS660742037" load-source="docdb">IT</country><country mxw-id="DS660633735" load-source="docdb">LI</country><country mxw-id="DS660716668" load-source="docdb">LT</country><country mxw-id="DS660636804" load-source="docdb">LU</country><country mxw-id="DS660716669" load-source="docdb">LV</country><country mxw-id="DS660716670" load-source="docdb">MC</country><country mxw-id="DS660792098" load-source="docdb">MK</country><country mxw-id="DS660792099" load-source="docdb">MT</country><country mxw-id="DS660722669" load-source="docdb">NL</country><country mxw-id="DS660636805" load-source="docdb">NO</country><country mxw-id="DS660792100" load-source="docdb">PL</country><country mxw-id="DS660633736" load-source="docdb">PT</country><country mxw-id="DS660722670" load-source="docdb">RO</country><country mxw-id="DS660633737" load-source="docdb">RS</country><country mxw-id="DS660792101" load-source="docdb">SE</country><country mxw-id="DS660634909" load-source="docdb">SI</country><country mxw-id="DS660636806" load-source="docdb">SK</country><country mxw-id="DS660792102" load-source="docdb">SM</country><country mxw-id="DS660712917" load-source="docdb">TR</country></ep-contracting-states><ep-extended-states><ep-extended-state-data><country>BA</country></ep-extended-state-data><ep-extended-state-data><country>ME</country></ep-extended-state-data></ep-extended-states></designated-states></international-convention-data><office-specific-data><eptags><ep-no-a-document-published>*</ep-no-a-document-published></eptags></office-specific-data></bibliographic-data><abstract mxw-id="PA139078481" ref-ucid="WO-2014128456-A1" lang="EN" load-source="patent-office"><p num="0000">An image processing apparatus uses first and second digital vascular image data to register two images. The two images may be from different imaging modes. The first and second images are processed with a two- dimensional, directional filter (500) that has the effect of producing clusters of orthogonally adjacent image data points in which the magnitude of an intensity gradient between each orthogonally adjacent image data point is less than a predetermined value. Subsequently, common clusters are identified between the first and second image data using a corner detecting algorithm (600). The directional filter produces "stepping" features, where vascular features would otherwise appear with smooth edges. These numerous features are identified by the corner detecting algorithm and can be used (1000) for registering common clusters between the first and second image data. The filter may be a rotating Gabor filter matched to vascular features in the images.</p></abstract><abstract mxw-id="PA139545036" ref-ucid="WO-2014128456-A1" lang="EN" source="national office" load-source="docdb"><p>An image processing apparatus uses first and second digital vascular image data to register two images. The two images may be from different imaging modes. The first and second images are processed with a two- dimensional, directional filter (500) that has the effect of producing clusters of orthogonally adjacent image data points in which the magnitude of an intensity gradient between each orthogonally adjacent image data point is less than a predetermined value. Subsequently, common clusters are identified between the first and second image data using a corner detecting algorithm (600). The directional filter produces "stepping" features, where vascular features would otherwise appear with smooth edges. These numerous features are identified by the corner detecting algorithm and can be used (1000) for registering common clusters between the first and second image data. The filter may be a rotating Gabor filter matched to vascular features in the images.</p></abstract><abstract mxw-id="PA139078482" ref-ucid="WO-2014128456-A1" lang="FR" load-source="patent-office"><p num="0000">La présente invention concerne un appareil de traitement d'image, qui utilise des premières et secondes données d'image vasculaire numériques, afin d'enregistrer deux images. Les deux images peuvent provenir de différents modes d'imagerie. Les première et seconde images sont traitées avec un filtre (500) directionnel à deux dimensions, qui a pour effet de produire des grappes de points de données d'image, adjacents au plan orthogonal, dans lesquelles la magnitude d'un gradient d'intensité entre chaque point de données d'image adjacent au plan orthogonal est inférieure à une valeur prédéfinie. Par la suite, des grappes communes sont identifiées entre les premières et les secondes données d'image à l'aide d'un algorithme (600) de détection de coins. Le filtre directionnel produit des caractéristiques « en marches d'escalier », là où les caractéristiques vasculaires apparaîtraient autrement avec des bords lisses. Ces nombreuses caractéristiques sont identifiées par l'algorithme de détection de coins et peuvent être utilisées (1000) pour enregistrer des grappes communes entre les premières et secondes données d'image. Le filtre peut être un filtre de Gabor rotatif, mis en concordance avec des caractéristiques vasculaires dans les images.</p></abstract><abstract mxw-id="PA139545037" ref-ucid="WO-2014128456-A1" lang="FR" source="national office" load-source="docdb"><p>La présente invention concerne un appareil de traitement d'image, qui utilise des premières et secondes données d'image vasculaire numériques, afin d'enregistrer deux images. Les deux images peuvent provenir de différents modes d'imagerie. Les première et seconde images sont traitées avec un filtre (500) directionnel à deux dimensions, qui a pour effet de produire des grappes de points de données d'image, adjacents au plan orthogonal, dans lesquelles la magnitude d'un gradient d'intensité entre chaque point de données d'image adjacent au plan orthogonal est inférieure à une valeur prédéfinie. Par la suite, des grappes communes sont identifiées entre les premières et les secondes données d'image à l'aide d'un algorithme (600) de détection de coins. Le filtre directionnel produit des caractéristiques « en marches d'escalier », là où les caractéristiques vasculaires apparaîtraient autrement avec des bords lisses. Ces nombreuses caractéristiques sont identifiées par l'algorithme de détection de coins et peuvent être utilisées (1000) pour enregistrer des grappes communes entre les premières et secondes données d'image. Le filtre peut être un filtre de Gabor rotatif, mis en concordance avec des caractéristiques vasculaires dans les images.</p></abstract><description mxw-id="PDES78477575" ref-ucid="WO-2014128456-A1" lang="EN" load-source="patent-office"><!-- EPO <DP n="3"/>--><p id="p0001" num="0001"> IMPROVEMENTS IN OR RELATING TO IMAGE PROCESSING Technical field </p><p id="p0002" num="0002"> The present invention relates to improvements in or relating to image processing, particularly, but not exclusively, to a method and apparatus for registering pairs or sequences of vasculature images, such as retinal images. </p><p id="p0003" num="0003">Background </p><p id="p0004" num="0004">Imaging systems, such as scanning laser ophthalmoscopes (SLOs), are known to capture retinal image data using one or more digital image sensors. Digital image sensors for SLOs are commonly a single sensor in which the light intensity signal is synchronised with the scanning position signal in order to produce a single stream of data that can be synchronised into a 2D image. Digital image sensors may alternatively include an array of light sensitive picture elements (pixels)Retinal images produced by SLOs or other retinal imaging apparatuses such as fundus cameras are typically two dimensional pixel arrays and are termed digital retinal images. </p><p id="p0005" num="0005">The set of intensity values derived from the pixel array is known as image data. The "raw" image data output by the pixel array may be subjected to various post-processing techniques in order to reproduce an image either for viewing by a human or for processing by a machine. Post-processing techniques of retinal images include various statistical methods for image analysis and registration of pairs or sequences of retinal images. </p><p id="p0006" num="0006">Registering pairs or sequences of retinal images generally concerns the scaling, rotation and translation of one or more images with respect to a base image in order to align ("register") the image with the base image. 
<!-- EPO <DP n="4"/>-->
 The registered retinal images are typically superimposed with the base retinal image to facilitate comparisons between the images. </p><p id="p0007" num="0007">Algorithms which enable affine registration of pairs or sequences of retinal images are known. Such algorithms may involve "vasculature tracking", which involves iterative searches and decision trees to map and extract the vasculature. In particular, such approaches commonly search for specific characteristic features such as vasculature branching junctions. While such algorithms provide a reasonable degree of registration accuracy they are computationally inefficient, i.e. computationally expensive. Furthermore, such known algorithms only allow images obtained from common imaging modes to be registered. That is, such known algorithms do not allow images obtained from different imaging modes, such as reflectance or auto-fluorescence, to be registered. </p><p id="p0008" num="0008">Examples of such known algorithms can be found in the following publications: US 2012/0195481 A; Can et al "A feature based, Robust, Hierarchical Algorithm for Registering Pairs of Images of the Curved Human Retina", IEEE Transactions on Pattern Analysis and Machine Intelligence, Vol 24, No, 3 (March 2002); Zana &amp; Klein, "A Multimodal Registration Algorithm of Eye Fundus Images Using Vessels Detection and Hough Transform", IEEE Transactions on Medical Imaging, Vol 18, No 5 (May 1999); and Hu et al "Multimodal Retinal Vessel Segmentation From Spectral-Domain Optical Coherence Tomography and Fundus Photography", IEEE Transactions on Medical Imaging, Vol 31 , No 10 (October 2012). </p><p id="p0009" num="0009">EP 2 064 988 A (Kowa Company, Ltd.) proposes a device and method for creating retinal fundus "maps" by superimposing two or more fundus images on the basis of a matching probability score. Matching is performed on the basis of corner image data identified in a blood vessel 
<!-- EPO <DP n="5"/>-->
 extraction image. However, the inventors believe that the technique proposed in EP'988 will not find sufficient corner features in the vasculature in a typical retinal image to enable reliable matching and registration of images, especially between different imaging modes. Retinal images are subject to very variable lighting, and in high-resolution retinal images produced by modern SLOs, the vascular features are relatively smooth-sided features. Therefore corner extraction will not yield a great number of candidate points for matching, or else will be heavily influenced by noise of various types. </p><p id="p0010" num="0010">Summary </p><p id="p0011" num="0011"> According to a first aspect of the invention there is provided a method of processing digital vascular images comprising the steps of: </p><p id="p0012" num="0012"> providing first and second digital vascular image data; </p><p id="p0013" num="0013"> processing the first and second image data with a directional, two- dimensional filter that has the effect of producing clusters of orthogonally adjacent image data points in which the magnitude of an intensity gradient between each orthogonally adjacent image data point is less than a predetermined value; </p><p id="p0014" num="0014"> identifying clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; </p><p id="p0015" num="0015"> identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; and </p><p id="p0016" num="0016"> registering the common clusters between the first and second image data. </p><p id="p0017" num="0017">The digital vascular images may be retinal images. The digital vascular images may include detail of the vasculature of the retina. The vasculature of the retina includes the blood vessels, arteries and veins in 
<!-- EPO <DP n="6"/>-->
 the retina. The vasculature of the retina includes the circulatory system of the retina. </p><p id="p0018" num="0018">The digital vascular images may be vascular images of an organ or body part of a human or an animal. The digital vascular images may include detail of the vasculature of the organ or the body part. The vasculature of the organ or the body part includes the blood vessels, arteries and veins therein. The vasculature of the organ or the body part includes the circulatory system thereof. </p><p id="p0019" num="0019">The first and second digital vascular image data may include the intensity of the illumination incident on the one or more pixels used to produce the image data. The first and second images may be obtained by different imaging modes. </p><p id="p0020" num="0020">The filter may be a matched filter. The filter may have a form or shape which is matched to the form or shape of vascular features in the vascular image data. </p><p id="p0021" num="0021">The filter may be a Gaussian filter. The filter may be a Gabor filter. </p><p id="p0022" num="0022">The one or more filters may be the same filter or different filters. Using different two-dimensional filter kernels at different orientations may be useful in cases where the vasculature has some shape sensitivity with direction. </p><p id="p0023" num="0023"> The kernel may be a matched kernel. The kernel may have a form or shape which is matched to the form or shape of the vascular image data. The clusters of orthogonally adjacent image data points may include any number or configuration of orthogonally adjacent image data in which the 
<!-- EPO <DP n="7"/>-->
 intensity gradient between each orthogonally adjacent image data point is less than a predetermined value. </p><p id="p0024" num="0024">The step of identifying clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value may include use of a corner detection algorithm. The corner detection algorithm may be used to identify clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value. The corner detection algorithm may be used to identify clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters in two orthogonal directions is simultaneously above a predetermined value. That is, the corner detection algorithm may look for changes in intensity gradients occurring simultaneously in two orthogonal directions above a predetermined threshold. The predetermined value may be for example between 10% and 50% of a maximum possible gradient value. The corner detection algorithm may be a Harris corner detection algorithm. The corner detection algorithm may be a Moravec corner detection algorithm or a Shi-Thomas corner detection algorithm. </p><p id="p0025" num="0025">The step of identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value may include cross correlating the convolved first and second image data. </p><p id="p0026" num="0026">The step of identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or 
<!-- EPO <DP n="8"/>-->
 more adjacent clusters is above a predetermined value may include cross correlating the identified clusters in the first and second image data. </p><p id="p0027" num="0027">The step of identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value may include multiple cross correlations of the convolved first and second image data. For multiple cross correlations of the convolved first and second image data, each successive cross correlation may be incrementally rotated from the last. The multiple cross correlations may be rotated through approximately 40 degrees, or more. The multiple cross correlations may be rotated in steps through approximately 20 degrees or more around a pivot point located substantially around the optic disc point of the retina. The step of cross correlating the convolved first and second image data may include the further step of determining the differences in position between the identified common clusters in each of the first and second image data. The position of the cluster may include its angular position and/or its translational position. The differences in position between the identified common clusters in each of the first and second image data may be termed the translational parameters. </p><p id="p0028" num="0028">The step of registering the common clusters between the first and second image data uses the determined translational parameters to align the first and second image data. The second image data may be registered with the first image data or the first image data may be registered with the second image data. The registered image data may be superimposed. </p><p id="p0029" num="0029">The method may include the additional initial step of reducing the size of the first and/or second digital vascular image data. This may include removing one or more portions of the image data. The step of reducing 
<!-- EPO <DP n="9"/>-->
 the size of the first and/or second digital vascular image data may include the steps of filtering, smoothing, sampling or sub sampling the image data. The steps of filtering, smoothing, sampling or sub sampling the image data may be repeated any number of times. </p><p id="p0030" num="0030">The method may include the additional initial step of down sampling the first and/or second digital vascular image data. The step of down sampling the first and/or second digital vascular image data may include one or more image data scaling computations. The step of down sampling the first and/or second digital vascular image data may include one or more image data pyramid scaling computations. </p><p id="p0031" num="0031">The method may include the additional initial step of increasing the contrast between the vasculature and the background of the first and/or second digital vascular image data. The method may include the additional initial step of optimising the contrast between the vasculature and the background of the first and/or second digital vascular image data. The step of optimising the contrast between the vasculature and the background of the first and/or second digital vascular image data may include using a histogram equalisation. The step of optimising the contrast between the vasculature and the background of the first and/or second digital vascular image data may include using an adaptive histogram equalisation. The method may include the additional step of removing noise from the first and/or second digital vascular image data after the step of increasing the contrast between the vasculature and the background of the first and/or second digital vascular image data. The step of removing noise from the first and/or second digital vascular image data may include use of a low-pass filter. 
<!-- EPO <DP n="10"/>-->
 The method may include the additional step of merging, or linking, together the clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value. The clusters may be "merged" by increasing the intensity data between the clusters. A single pass averaging filter, or kernel, may be used to adjust the intensity value of the image data between clusters to an average intensity value of the clusters in that region. The effect of this is to blur, or average, the intensity values within a given region so that two clusters close together will, in effect, become one cluster. </p><p id="p0032" num="0032">The method may include the additional step of reducing the size of the first and/or second merged cluster image data. This may include removing one or more portions of the image data. The step of reducing the size of the first and/or second merged cluster image data may include the steps of filtering, smoothing, sampling or sub sampling the image data. The steps of filtering, smoothing, sampling or sub sampling the image data may be repeated any number of times. The method may include the additional initial step of down sampling the first and/or second merged cluster image data. The step of down sampling the first and/or second merged cluster image data may include one or more image data scaling computations. The step of down sampling the first and/or second merged cluster image data may include one or more image data pyramid scaling computations. </p><p id="p0033" num="0033">The method may include the additional step of creating first and/or second digital vascular images from the first and second digital vascular image data. 
<!-- EPO <DP n="11"/>-->
 The method may include the additional step of creating a digital image of the first and/or second clusters of orthogonally adjacent image data points in which the intensity gradient between each orthogonally adjacent image data point is less than a predetermined value. </p><p id="p0034" num="0034">The method may include the additional step of creating a digital image of the identified clusters in the first and/or second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value. </p><p id="p0035" num="0035">The method may include the additional step of creating a digital image of the identified common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value. </p><p id="p0036" num="0036">The method may include the additional step of creating a digital image of the registered common clusters between the first and second image data. </p><p id="p0037" num="0037">The method may comprise providing a plurality of digital vascular image data and processing each digital image data according to the first aspect of the invention to register all the common clusters between all the image data. </p><p id="p0038" num="0038">According to a second aspect of the invention there is provided an image processing apparatus comprising: </p><p id="p0039" num="0039"> a digital vascular image provision module arranged to provide first and second digital vascular image data; and </p><p id="p0040" num="0040"> a processor arranged to: </p><p id="p0041" num="0041"> process the first and second image data with a two-dimensional, directional filter that has the effect of producing clusters of orthogonally adjacent image data points in which the magnitude of an intensity gradient 
<!-- EPO <DP n="12"/>-->
 between each orthogonally adjacent image data point is less than a predetermined value; </p><p id="p0042" num="0042"> identify clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; </p><p id="p0043" num="0043"> identify common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; and </p><p id="p0044" num="0044"> register the common clusters between the first and second image data. </p><p id="p0045" num="0045">According to a third aspect of the invention there is provided a scanning laser ophthalmoscope having an image processing apparatus comprising: a digital vascular image provision module arranged to provide first and second digital vascular image data; and </p><p id="p0046" num="0046"> a processor arranged to: </p><p id="p0047" num="0047"> process the first and second image data with a two-dimensional, directional filter that has the effect of producing clusters of orthogonally adjacent image data points in which the magnitude of the intensity gradient between each orthogonally adjacent image data point is less than a predetermined value; </p><p id="p0048" num="0048"> identify clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; </p><p id="p0049" num="0049"> identify common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; and </p><p id="p0050" num="0050"> register the common clusters between the first and second image data. 
<!-- EPO <DP n="13"/>-->
 According to a fourth aspect of the invention there is provided a computer program product encoded with instructions that, when run on a computer, cause the computer to receive image data and perform a method of processing digital vascular images comprising: </p><p id="p0051" num="0051"> providing first and second digital vascular image data; </p><p id="p0052" num="0052"> processing the first and second image data with a two-dimensional, directional filter that has the effect of producing clusters of orthogonally adjacent image data points in which the magnitude of the intensity gradient between each orthogonally adjacent image data point is less than a predetermined value; </p><p id="p0053" num="0053"> identifying clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; </p><p id="p0054" num="0054"> identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; and </p><p id="p0055" num="0055"> registering the common clusters between the first and second image data. The computer program product may be stored on or transmitted over as one or more instructions or code on a computer-readable medium. Computer-readable media includes both computer storage media and communication media including any medium that facilitates transfer of a computer program from one place to another. A storage media may be any available media that can be accessed by a computer. By way of example such computer-readable media can comprise RAM, ROM, EEPROM, CD-ROM or other optical disk storage, magnetic disk storage or other magnetic storage devices, or any other medium that can be used to carry or store desired program code in the form of instructions or data structures and that can be accessed by a computer. Also, any connection is properly termed a computer-readable medium. For example, if the 
<!-- EPO <DP n="14"/>-->
 software is transmitted from a website, server, or other remote source using a coaxial cable, fibre optic cable, twisted pair, digital subscriber line (DSL), or wireless technologies such as infrared, radio, and microwave, then the coaxial cable, fibre optic cable, twisted pair, DSL, or wireless technologies such as infrared, radio, and microwave are included in the definition of medium. Disk and disc, as used herein, includes compact disc (CD), laser disc, optical disc, digital versatile disc (DVD), floppy disk and blu-ray™ disc where disks usually reproduce data magnetically, while discs reproduce data optically with lasers. Combinations of the above should also be included within the scope of computer-readable media. The instructions or code associated with a computer-readable medium of the computer program product may be executed by a computer, e.g., by one or more processors, such as one or more digital signal processors (DSPs), general purpose microprocessors, ASICs, FPGAs, or other equivalent integrated or discrete logic circuitry. 
<!-- EPO <DP n="15"/>-->
</p><p id="p0056" num="0056">Brief Description of the Drawings </p><p id="p0057" num="0057"> An embodiment of the invention will now be described, by way of example only, with reference to the accompanying drawings, in which: Figure 1 is a flow chart diagram detailing a method of processing digital vascular images; </p><p id="p0058" num="0058">Figures 2a and 2b are first and second digital vascular images; Figures 3a and 3b are the first and second digital vascular images of figures 2a and 2b after down sampling, equalisation and filtering; </p><p id="p0059" num="0059">Figures 4a and 4b are the first and second digital vascular images of figures 3a and 3b after convolution with a rotating Gabor kernel; </p><p id="p0060" num="0060">Figures 5a and 5b are the first and second digital vascular images of figures 4a and 4b after processing with a corner detection algorithm, blurring and down sampling; Figure 6 is the first digital vascular image of figure 5a after identification and marking of the micro-corner stepping structure; </p><p id="p0061" num="0061">Figure 7 is a schematic diagram detailing the cross correlation of the first and second digital vascular images of figures 5a and 5b; and </p><p id="p0062" num="0062">Figure 8 illustrates the digital vascular images produced during the processing method and the registered first and second digital vascular images. 
<!-- EPO <DP n="16"/>-->
 Detailed Description of Exemplary Embodiments </p><p id="p0063" num="0063"> Figure 1 is a flow chart detailing the method steps of a registration algorithm for affine registration of pairs or sequences of retinal images. Figure 1 illustrates the method steps of processing the digital retinal image data. The first image may be termed the "base image", with each subsequent image being termed the "input" image. </p><p id="p0064" num="0064">With reference to figures 1 , 2a and 2b, the first step 100 of the method is to provide first and second digital retinal image data. The first and second digital retinal image data is represented by first and second digital retinal images 10a, 10b. The first and second digital vascular image data includes the intensity of the illumination incident on the one or more pixels used to produce the image data. The first and second digital retinal images 10a, 10b illustrated here are obtained by a wide-field scanning laser ophthalmoscope (SLO), as is known in the art. As illustrated in figures 2a and 2b, the first and second retinal images 10a, 10b show the optic disc 1 and vasculature 2 of the retina 3. </p><p id="p0065" num="0065">The second step 200 of the method is to reduce the size of the first and second digital vascular image data. This is achieved by down sampling the data. In the embodiment of the invention described here the first and second digital vascular image data is down sampled via a pyramid scaling computation. However, it should be appreciated that other known filtering, smoothing, sampling or sub sampling computation method could be used. </p><p id="p0066" num="0066">Reducing the size of the first and second digital vascular image data increases the speed of subsequent computations and scales the vasculature features so that an optimum degree of resonance occurs during subsequent convolution operations (described below). The down sampling scales the vasculature so that the typical curvature, and hence 
<!-- EPO <DP n="17"/>-->
 micro-corners, are within the area of interest, i.e. so that the best "resonance" is achieved of the corner detection filter, or kernel. </p><p id="p0067" num="0067">The third step 300 of the method is to optimise the contrast between the vasculature and the background of the first and second digital vascular image data. This is achieved through use of a histogram equalisation computation. In the embodiment of the invention described here an adaptive histogram equalisation is used to optimise the contrast between the vasculature and the background of the first and second digital vascular image data. The adaptive histogram equalisation attenuates variations in general lighting in the image data while increasing local contrast. This has the effect of accentuating vasculature relative to the image background. This effect is most notable in regions where polarisation effects would otherwise tend to swamp out vasculature information. </p><p id="p0068" num="0068">The fourth step 400 of the method is to remove noise from the first and second digital vascular image data which appears through use of the adaptive histogram equalisation. Removal of this noise reduces the chances of recording false "corner hits" during subsequent convolution operations (described below). The step of removing noise from the first and second digital vascular image data is achieved by a low pass (LP) noise filter. </p><p id="p0069" num="0069">Figures 3a and 3b are the first and second digital vascular images 10a, 10b of figures 2a and 2b after down sampling (step 200), equalisation (step 300) and noise reduction (step 400). As can be seen from figures 3a and 3b, the contrast between the vasculature 2 and the background 4 of the retina has been enhanced compared to the initial first and second digital retinal images 2a, 2b. The enhancement of the vasculature 2 relative to the background 4 of the retina improves the results of the subsequent convolution operations (described below). 
<!-- EPO <DP n="18"/>-->
 The fifth step 500 of the method is to process the first and second image data with a directional filter that has the effect of producing clusters of orthogonally adjacent image data points in which the intensity gradient between each orthogonally adjacent image data point is less than a predetermined value. In the embodiment of the invention described here the step 500 of processing the first and second image data with a directional filter is carried out by convolving the first and second image data with a rotating Gabor kernel (or filter). Orthogonally adjacent image data points is considered to mean image data points that are immediately adjacent one another in an array of pixel data, i.e. image data points that are adjacent one another in any given row or column of the array. It should be appreciated that the clusters may comprise any number or configuration of orthogonally adjacent image data. That is, the clusters could be an arrangement 1x1 , 1 x2, 2x1 , 2x2, 3x2, 2x3 image data points, or the like. </p><p id="p0070" num="0070">The Gabor kernel is a form of 2-dimensional Gaussian filter kernel with a profile that, in the present case, is matched to the form or shape of the intensity of the image data across the vasculature, i.e. the vasculature cross section. The Gaussian shape of the Gabor kernel allows it to "fit" to or "resonate with" the profile of the vasculature, thus accentuating the vasculature, while not fitting as well to other (background) regions, thus attenuating these regions. </p><p id="p0071" num="0071">The Gabor kernel is convolved with each of the first and second image data a multiple number of times. For each successive convolution the Gabor kernel is oriented differently relative to the image data. In the embodiment described here the Gabor kernel is effectively convolved eight times with each of the first and second image data, with the Gabor kernel being rotated 45 degrees relative to the image data for each 
<!-- EPO <DP n="19"/>-->
 successive convolution. The Gabor kernel is therefore rotated through 360 degrees relative to the image data over 8 convolutions. The Gabor kernel has been found to be particularly effective in resonating with the characteristics of the vasculature cross sections. In an embodiment where the kernel is symmetrical, the effect of 8 convolutions over 360 degrees can be achieved in practice with only four convolutions spaced over 180 degrees. </p><p id="p0072" num="0072">The first and second digital retinal image data after convolution with the rotating Gabor kernel is represented in figures 4a and 4b. Figures 4a and 4b represent an averaged output of all 8 convolutions. As illustrated, the effect of convolving the first and second digital retinal image data with the rotating Gabor kernel described above is to produce clusters 12 of orthogonally adjacent image data points in which the magnitude of the intensity gradient between each orthogonally adjacent image data point is less than a predetermined value. The convolution in other words produces groups of orthogonally adjacent image data points that have similar intensity values. [DAVID: I have moved this paragraph about setting the threshold down to the section describing the corner detection. I think in Craig's description the "less than" threshold and the "greater than" threshold are the same. As discussed at our meeting, however, the threshold is only explicitly applied in the corner detection step. Therefore it makes more sense to discuss the setting of the threshold in the context of the corner detection step. ] </p><p id="p0073" num="0073">With reference to figures 4a to 6, the first and second digital retinal image data after convolution with the rotating Gabor kernel includes a line of clusters 12 having corner (or "micro-corner") features can be seen that track the vasculature 2 of the retina 3. It is the rotation of the Gabor kernel relative to the image data which creates the corner (or micro-corner) features of the clusters 12. In particular, it is the rotation of the Gabor 
<!-- EPO <DP n="20"/>-->
 kernel through, at least, 90 degrees which creates the corner (or micro- corner) features of the clusters 12. </p><p id="p0074" num="0074">The vasculature 2 of the retina 3 has thus been enhanced at a local level into the form of a high intensity gradient "stepping" structure of corner (or micro-corner) features of the clusters 12 between the clusters 12 and the background 4 of the retina 3. The corner features of the clusters 12 may be any corner of the array of image data, as described above. The term "micro-corner" may refer to a cluster 12 comprising of a 1x2 or 2x1 image data points. </p><p id="p0075" num="0075">The sixth step 600 of the method is to identify (or extract) the clusters 12 in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters 12 is above a predetermined value. The sixth step 600 thus identifies clusters 12 that approximately lie on the boundary between the vasculature 2 of the retina 3 and the background 4. As illustrated in figures 4a to 6, the clusters 12 have a higher intensity than the background 4. Step 600 of the method thus identifies the clusters 12 that track the vasculature 2 of the retina 3. </p><p id="p0076" num="0076">In the embodiment of the invention described here the step 600 of identifying the clusters 12 in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters 12 is above a predetermined value is carried out by using a corner detection algorithm. In the embodiment described here a Harris corner detection algorithm is used to identify the clusters 12 in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters 12 is above a predetermined value. However, it should be appreciated that any other suitable corner detection algorithm could be used. 
<!-- EPO <DP n="21"/>-->
 The corner detection algorithm looks for orthogonal edge points in the convolved first and second digital retinal image. In particular, it will look for points where the gradient exceeds the threshold in two directions simultaneously. The algorithm is configurable to certain sensitivity and quality thresholds, as required. Figure 6 illustrates points (+) identified by the corner detection algorithm. </p><p id="p0077" num="0077">Corner detection algorithms are not typically used with retinal images, since the existence of corner points is not commonly found. However, the pre-processing of the image data with a directional filter such as the rotating Gabor kernel results in image data in which the vasculature 2 has been enhanced at a local level in the form of a high intensity gradient "stepping structure", or lines of corner (or micro-corner) features throughout the vasculature 2. It is this pre-processing with the rotating Gabor kernel which facilitates use of a corner detection algorithm to identify the clusters 12 that outline the vasculature 2 of the retina 3. The advantage of this method, when compared to mapping and extracting the vasculature by use of known tracking algorithms, is a significant decrease in computational loading. </p><p id="p0078" num="0078">Because the image data has been histogram equalised, the intensity gradient thresholds that are of interest will be approximately the same over the whole image data. The value of the predetermined threshold will be dependent on the size of the area of interest used in the equalisation. Setting the actual value need not be done by any analytical method, but may simply be done by trial and error empirical means. In some embodiments, the threshold may be for example between 10% and 50% of the maximum possible gradient. For example, in an embodiment where the maximum gradient is 255, a threshold gradient of 50 might be set, representing about 20% of the maximum possible. 
<!-- EPO <DP n="22"/>-->
 The seventh step 700 of the method is to merge together the clusters 12 in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters 12 is above a predetermined value. The seventh step 700 thus blurs, or merges, the clusters 12 together to further highlight the vasculature 2. When the image data is represented in an image the effect of the seventh step 700 is to "join the dots" of the clusters 12 along the vasculature 2. Step 700 of the method is useful since the positioning of the clusters 12 in each image data could be slightly different, therefore merging the clusters 12 increases the chance that more clusters 12 overlap at characteristic positions. The vasculature corner points that have been "thresholded" from the image are still in greyscale form, i.e. each data point could still have a different intensity value, although all are above the threshold value. The method may therefore include the further step of converting the "thresholded" image data to a binary image in which all "corner" clusters have a value of 1 and all the other image data points have a value of 0. </p><p id="p0079" num="0079">The eighth step 800 of the method is to mask clusters 12 in the image periphery that may be attached to non-relevant features, such as eye lashes. </p><p id="p0080" num="0080">The ninth step 900 of the method is to reduce the size of first and second merged cluster image data. This is achieved by down sampling the data. In the embodiment of the invention described here the first and second digital vascular image data is down sampled via a pyramid scaling computation. However, it should be appreciated that other known filtering, smoothing, sampling or sub sampling computation method could be used. </p><p id="p0081" num="0081">The first and second retinal image data after merging (step 700), masking (800) and down sampling (900) is represented in figures 5a and 5b. 
<!-- EPO <DP n="23"/>-->
 The tenth step 1000 of the method is to identify common clusters 12 between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters 12 is above a predetermined value. The tenth step 1000 thus identifies common clusters 12 between each of the first and second retinal image data. In the embodiment described here the step 1000 involves cross correlating the image data of figures 5a and 5b. </p><p id="p0082" num="0082">The cross correlation of the image data of figures 5a and 5b is illustrated in figures 7 and 1 . In the embodiment described here the second image data of figure 5b is cross correlated with the first image data of figure 5a a number of times. With each subsequent cross correlation the second image data is incrementally rotated relative to the last. The multiple cross correlations may be rotated through approximately 40 degrees. The multiple cross correlations may be rotated through approximately 20 degrees around a pivot point located substantially around the optic disc point of the retina. The multiple cross correlations may, of course, be rotated through approximately any suitable degree around the pivot point located substantially around the optic disc point of the retina. </p><p id="p0083" num="0083">Data is output as a normalised cross correlation. The peak in cross correlation (i.e. best match between image data) is recorded for each correlation angle and confidence is deduced from a measurement of the peak isolation within the correlation surface 5 for each correlation angle. More specifically, a confidence coefficient is calculated as a weighting of the peak height multiplied by the total slope of the peak "walls" divided by the mean of the rest (i.e. excluding the region of the peak) of the correlation surface 5. A high value in this metric is indicative of a sharp, high, isolated peak, which is a characteristic of close correlation and therefore a high confidence in the accuracy of registration. The threshold at which confidence is toggled to low, which can be observed as an 
<!-- EPO <DP n="24"/>-->
 absence in any one isolated correlation peak, is established by weighting the confidence measure so that values less than unity indicate low confidence. The tenth step 1000 of the method also includes determining the differences in position between the identified common clusters 12 in each of the first and second image data. The position of the cluster 12 includes its angular and translational position (rotational angle and x and y translations). The differences in position between the identified common clusters 12 in each of the first and second image data is termed the translational parameters. </p><p id="p0084" num="0084">The eleventh step 1 100 of the method is to register the common clusters 12 between the first and second image data. Here the translation parameters determined from step 1000 are used to align the second image data to the first image data, or align the first and second digital retinal images 10a, 10b, in the known manner. </p><p id="p0085" num="0085">Figure 8 illustrates the digital vascular images produced during the processing method and the registered first and second digital vascular images 10a, 10b. Top-left and top right of figure 8 illustrate the first and second digital vascular images 10a, 10b of figures 2a and 2b after down sampling (step 200), equalisation (step 300) and noise reduction (step 400) (figures 3a and 3b). Middle-left and middle-right of figure 8 illustrate the first and second digital retinal image data after convolution with the rotating Gabor kernel (figures 4a and 4b). Bottom-left and bottom-right of figure 8 illustrate the first and second digital vascular images 10a, 10b in their registered positions. The centre-top of figure 8 is the correlation surface 5 of figure 7. The centre-middle of figure 8 illustrates the peak in cross correlation for each correlation angle. The bottom-middle of figure 8 
<!-- EPO <DP n="25"/>-->
 illustrates the registered and overlaid first and second digital vascular images 10a, 10b. </p><p id="p0086" num="0086">The method of the invention dramatically reduces the computational requirements of the processor, increases accuracy and allows registration for images obtained across a number of imaging modes. The computational efficiency provided by the method of the invention is a result of the realisation that convolving the image data with a rotating Gabor kernel produces image data in which the vasculature has been modified to provide a high intensity gradient "stepping" structure of image data clusters that track the vasculature. The creation of these corner (or micro- corner) features in the image data facilitates the use of a known corner detection algorithm to extract the position of the clusters for comparison and registration. Convolving the image data with a rotating Gabor kernel and using a corner detection algorithm in this manner reduces the computational requirements of the method. Furthermore, using a corner detection algorithm increases the accuracy of the registration process, since the corners (and vasculature) can be accurately determined compared to known retinal image registration techniques. </p><p id="p0087" num="0087">Also, since the method uses feature sets (distances between vasculature points) that are common across different retinal imaging modes (e.g. reflectance, auto-fluorescence etc.), inter-mode registration (i.e. auto- fluorescence to reflectance images) is possible. </p><p id="p0088" num="0088">Modifications and improvements may be made to the above without departing from the scope of the present invention. For example, although the method has been described and illustrated with use of retinal images, it should be appreciated that other digital vascular images may be used, such as vascular images of an organ or body part of a human or an animal. The vasculature of the organ or the body part may include the 
<!-- EPO <DP n="26"/>-->
 blood vessels arteries and veins therein. The vasculature of the organ or the body part may also include the circulatory system thereof. </p><p id="p0089" num="0089">Furthermore, although the method has been described with use of a Gabor kernel, it should be appreciated that any suitably shaped kernel, filter, filter matrix, window, template or mask may be used. For example a Gaussian filter or kernel may be used. Also, although a rotating Gabor kernel has been described that rotates through 360 degrees (with eight convolutions), it should be appreciated that the kernel need not "rotate", it need only be convolved with the image data in two orthogonal dimensions (i.e. a first convolution and then a second convolution at an angle of 90 degrees from the first). Rotating the kernel through 360 degrees does, however, improve the enhancement of the vasculature, as described above, and is preferred. Furthermore, although the method has been described above as using a single kernel convolved with the image data a number of times, it should be appreciated that any number of different kernels could be convolved with the image data at any number of angles relative thereto. Also, although the method has been described and illustrated above as registering two retinal images, it should be appreciated that the method may comprise the step of providing a plurality of digital vascular image data (and a plurality of digital vascular images) and processing each digital image according to the above described method to register all image data and images. 
<!-- EPO <DP n="27"/>-->
 CLAIMS </p><p id="p0090" num="0090"> 1 . A method of processing digital vascular images comprising the steps of: </p><p id="p0091" num="0091"> providing first and second digital vascular image data; </p><p id="p0092" num="0092"> processing the first and second image data with a two-dimensional, directional filter that has the effect of producing clusters of orthogonally adjacent image data points in which the magnitude of an intensity gradient between each orthogonally adjacent image data point is less than a predetermined value; </p><p id="p0093" num="0093"> identifying clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; </p><p id="p0094" num="0094"> identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is greater than a predetermined value; and </p><p id="p0095" num="0095"> registering the common clusters between the first and second image data. </p><p id="p0096" num="0096">2. A method as claimed in claim 1 , wherein the step of processing the first and second image data with said directional filter includes multiple convolutions of the image data with one or more filter kernels, the filter kernel(s) being oriented differently for each convolution. </p><p id="p0097" num="0097">3. A method as claimed in claim 2, wherein the filter is incrementally rotated relative to the image data for each successive convolution. </p><p id="p0098" num="0098">4. A method as claimed in claim 2 or claim 3, wherein the filter is effectively rotated through 360 degrees relative to the image data over a number of convolutions. 
</p></description><claims mxw-id="PCLM70077852" ref-ucid="WO-2014128456-A1" lang="EN" load-source="patent-office"><claim id="clm-0001" num="0001"><!-- EPO <DP n="28"/>--><claim-text/><claim-text>5. A method as claimed in any preceding claim, wherein the directional filter is a Gabor filter. </claim-text><claim-text>6. A method as claimed in any preceding claim, wherein the step of identifying clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value includes use of a corner detection algorithm. 7. A method as claimed in claim 6, wherein the corner detection algorithm is operates by identifying clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters in two orthogonal directions is simultaneously above said predetermined value. </claim-text><claim-text>8. A method as claimed in claim 6 or 7, wherein the predetermined value is between 10% and 50% of a maximum possible gradient value. </claim-text><claim-text>9. A method as claimed in any preceding claim, wherein the step of identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value includes cross correlating the convolved first and second image data. 10. A method as claimed in any preceding claim, wherein the step of identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value includes cross correlating the identified clusters in the first and second image data. 
<!-- EPO <DP n="29"/>-->
</claim-text><claim-text>1 1 . A method as claimed in any preceding claim, wherein the step of identifying common clusters between the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value includes multiple cross correlations of the convolved first and second image data with different orientations. </claim-text><claim-text>12. A method as claimed in claim 1 1 , wherein the multiple cross correlations are rotated in steps through approximately 20 degrees or more around a pivot point located substantially around the optic disc point of the retina. </claim-text><claim-text>13. A method as claimed in any of claims 10 to 12, wherein the step of cross correlating the convolved first and second image data includes the further step of determining differences in position between the identified common clusters in each of the first and second image data. </claim-text><claim-text>14. A method as claimed in claim 13, wherein the position of the cluster includes its angular position and/or its translational position, the differences in position between the identified common clusters in each of the first and second image data being termed the translational parameters, wherein the step of registering the common clusters between the first and second image data uses the determined translational parameters to align the first and second image data. </claim-text><claim-text>15. A method as claimed in any preceding claim, wherein the method includes the step of merging clusters in each of the first and second image data where the magnitude of the intensity gradient between one or more adjacent clusters is above a predetermined value. 
<!-- EPO <DP n="30"/>-->
</claim-text><claim-text>16. A method as claimed in any preceding claim, wherein an averaging filter is used to adjust the intensity value of the image data between clusters to an average intensity value of the clusters in that region. 17. A method as claimed in any preceding claim, wherein the method includes the step of creating first and/or second digital vascular images from the first and second digital vascular image data. </claim-text><claim-text>18. A method as claimed in any preceding claim, wherein the method includes the step of creating a digital image of the registered common clusters between the first and second image data. </claim-text><claim-text>19. A method as claimed in any preceding claim, wherein the method comprises providing a plurality of digital vascular image data and processing each digital image data according to the method of any of claims 1 to 18 to register all the common clusters between all the image data. </claim-text><claim-text>20. A method as claimed in any preceding claim, wherein the digital vascular images are vascular images of an organ or a body part of a human or an animal. </claim-text><claim-text>21 . A method as claimed in any preceding claim, wherein the digital vascular images are retinal images of a human or an animal. </claim-text><claim-text>22. A method as claimed in claim 20 or 21 wherein said digital vascular images are images obtained using different modes of imaging. </claim-text><claim-text>23. An image processing apparatus comprising: </claim-text><claim-text> a digital vascular image provision module arranged to provide first and second digital vascular image data; and 
<!-- EPO <DP n="31"/>-->
 a processor configured to carry out the method of any of claims 1 to</claim-text><claim-text>22. </claim-text><claim-text>24. A scanning laser ophthalmoscope comprising an image processing apparatus of claim 23. </claim-text><claim-text>25. A computer program product encoded with instructions that, when run on a computer, cause the computer to receive image data and perform a method of processing digital vascular images in accordance with any of claims 1 to 22. 
</claim-text></claim></claims><copyright>User acknowledges that Fairview Research LLC and its third party providers retain all right, title and interest in and to this xml under applicable copyright laws.  User acquires no ownership rights to this xml including but not limited to its format.  User hereby accepts the terms and conditions of the Licence Agreement</copyright></patent-document>
